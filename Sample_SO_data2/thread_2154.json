{
  "question" : {
    "question_id" : 79645263,
    "title" : "S3Client&#39;s headobject() function returns 404 when key is auto generated &amp; present",
    "body" : "<p>I have a java application that checks the existence of aws keys in my s3 bucket. I do this to check if key exists before trying to fetch files from the location (because files have unpredictable names, I need to check location's key instead of a specific file). I use <code>.headobject()</code> function of s3 client to achieve that. The code is as so:</p>\n<pre><code>private static S3Client s3Client;\npublic static void main(String[] args) throws Exception {\n  s3Client = S3Client\n          .builder()\n          .region(Region.of(&quot;us-east-2&quot;))\n          .credentialsProvider(EnvironmentVariableCredentialsProvider.create())\n          .build();\ntry {\n  s3Client.headObject(\n             HeadObjectRequest.builder().bucket(&quot;myBucket&quot;).key(&quot;locKey/key/&quot;).build());\n   System.out.println(&quot;It exists&quot;);\n   } catch (NoSuchKeyException e) {\n       System.out.println(&quot;It does not exists&quot;);\n   }\n}\n</code></pre>\n<p>It works if the key is created by hand (i.e. using <code>Create folder</code> option) in aws. But it does not work if something else creates the same key (for example if I to upload a file to s3 without key existing beforehand, say via databricks, the key will be created along with the file). My question is why?</p>\n<p>Is this a known issue? Is there a config I am not accounting for? Why would <code>headobject()</code> correctly identify if a key exists when it was created by hand but will throw an exception if key was generated by something else (despite this key being present)?</p>\n",
    "tags" : [ "java", "amazon-s3", "aws-sdk" ],
    "owner" : {
      "account_id" : 10568655,
      "reputation" : 455,
      "user_id" : 7786149,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ca6ff7779fa37dd5f0077d413622ad91?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Joe",
      "link" : "https://stackoverflow.com/users/7786149/joe"
    },
    "is_answered" : false,
    "view_count" : 64,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1748599519,
    "creation_date" : 1748599519,
    "link" : "https://stackoverflow.com/questions/79645263/s3clients-headobject-function-returns-404-when-key-is-auto-generated-presen",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140473349,
    "post_id" : 79645263,
    "body" : "For what it&#39;s worth, to solve this sort of problem, generally you want to call <code>client.listObjectsV2</code> with a prefix on the settings object.  If there are any objects in the return set, then the &quot;folder&quot; exists, otherwise it doesn&#39;t.",
    "score" : 1,
    "owner" : {
      "account_id" : 303420,
      "reputation" : 10940,
      "user_id" : 2378643,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/mt7f4.png?s=256",
      "display_name" : "Anon Coward",
      "link" : "https://stackoverflow.com/users/2378643/anon-coward"
    },
    "creation_date" : 1748625830,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140472491,
    "post_id" : 79645263,
    "body" : "I see, thank you! Yeah, that means I would need to rethink my approach. I am happy to accept this as the answer @luk2302, if you want to post it as one.",
    "score" : 0,
    "owner" : {
      "account_id" : 10568655,
      "reputation" : 455,
      "user_id" : 7786149,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ca6ff7779fa37dd5f0077d413622ad91?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Joe",
      "link" : "https://stackoverflow.com/users/7786149/joe"
    },
    "creation_date" : 1748609420,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140472248,
    "post_id" : 79645263,
    "body" : "Creating a folder in the console creates a zero byte object. Uploading a file does not create the folders in its path. This is expected. <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/using-folders.html\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/AmazonS3/latest/userguide/&hellip;</a>",
    "score" : 1,
    "owner" : {
      "account_id" : 2843847,
      "reputation" : 57516,
      "user_id" : 2442804,
      "user_type" : "registered",
      "accept_rate" : 80,
      "profile_image" : "https://i.sstatic.net/51a3aQOH.jpg?s=256",
      "display_name" : "luk2302",
      "link" : "https://stackoverflow.com/users/2442804/luk2302"
    },
    "creation_date" : 1748603643,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}