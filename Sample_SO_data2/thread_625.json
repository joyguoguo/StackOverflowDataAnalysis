{
  "question" : {
    "question_id" : 79791280,
    "title" : "Missing constructor when using SELECT NEW DTO with query Java Persist Query Language",
    "body" : "<p>I am using <strong>Spring Data JPA with Hibernate 6</strong>. I want to fetch a list of cars into a DTO using JPQL <code>SELECT NEW</code> syntax, with <code>LEFT JOIN</code>, <code>GROUP BY</code>, and <code>CASE</code> conditions.</p>\n<p>I keep getting the following error:</p>\n<pre class=\"lang-java prettyprint-override\"><code>Caused by: java.lang.IllegalArgumentException: org.hibernate.query.SemanticException: Missing constructor for type 'CarsResponseDto' [    SELECT NEW com.duydev.backend.presentation.dto.response.CarsResponseDto(\n        c.id,\n        c.brand,\n        c.model,\n        c.year,\n        c.pricePerHour\n    )\n    FROM CarsEntity c\n    LEFT JOIN c.location loc\n    LEFT JOIN c.bookings b\n    WHERE (:__$synthetic$__1 IS NULL OR c.brand = :__$synthetic$__2)\n      AND (:__$synthetic$__3 IS NULL OR c.year = :__$synthetic$__4)\n      AND (:__$synthetic$__5 IS NULL OR loc.province = :__$synthetic$__6)\n      AND (:__$synthetic$__7 IS NULL OR loc.ward = :__$synthetic$__8)\n      AND (:__$synthetic$__9 IS NULL OR c.pricePerHour &gt;= :__$synthetic$__10)\n      AND (:__$synthetic$__11 IS NULL OR c.pricePerHour &lt;= :__$synthetic$__12)\n      AND (b.endTime &gt;= :__$synthetic$__13 OR b.id IS NULL)\n    GROUP BY c.id\n    HAVING SUM(\n        CASE\n            WHEN b.id IS NOT NULL\n                 AND b.status = 'CONFIRMED'\n                 AND b.endTime &gt; :__$synthetic$__14\n                 AND b.startTime &lt; :__$synthetic$__15\n            THEN 1\n            ELSE 0\n        END\n    ) = 0\n]\n</code></pre>\n<p>My file CarsRepository:</p>\n<pre><code>package com.duydev.backend.domain.repositories;\n\nimport org.springframework.data.domain.Page;\nimport org.springframework.data.domain.Pageable;\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.data.jpa.repository.Query;\nimport org.springframework.data.repository.query.Param;\nimport org.springframework.stereotype.Repository;\n\nimport com.duydev.backend.domain.model.CarsEntity;\nimport com.duydev.backend.presentation.dto.request.RequestGetCarsDto;\nimport com.duydev.backend.presentation.dto.response.CarsResponseDto;\n\n@Repository\npublic interface CarsRepository extends JpaRepository&lt;CarsEntity, Long&gt; {\n    @Query(&quot;&quot;&quot;\n                SELECT NEW com.duydev.backend.presentation.dto.response.CarsResponseDto(\n                    c.id,\n                    c.brand,\n                    c.model,\n                    c.year,\n                    c.pricePerHour\n                )\n                FROM CarsEntity c\n                LEFT JOIN c.location loc\n                LEFT JOIN c.bookings b\n                WHERE (:#{#requestGetCarsDto.getBrand()} IS NULL OR c.brand = :#{#requestGetCarsDto.getBrand()})\n                  AND (:#{#requestGetCarsDto.getYear()} IS NULL OR c.year = :#{#requestGetCarsDto.getYear()})\n                  AND (:#{#requestGetCarsDto.getProvince()} IS NULL OR loc.province = :#{#requestGetCarsDto.getProvince()})\n                  AND (:#{#requestGetCarsDto.getWard()} IS NULL OR loc.ward = :#{#requestGetCarsDto.getWard()})\n                  AND (:#{#requestGetCarsDto.getMinPrice()} IS NULL OR c.pricePerHour &gt;= :#{#requestGetCarsDto.getMinPrice()})\n                  AND (:#{#requestGetCarsDto.getMaxPrice()} IS NULL OR c.pricePerHour &lt;= :#{#requestGetCarsDto.getMaxPrice()})\n                  AND (b.endTime &gt;= :#{#requestGetCarsDto.getStartTime()} OR b.id IS NULL)\n                GROUP BY c.id\n                HAVING SUM(\n                    CASE\n                        WHEN b.id IS NOT NULL\n                             AND b.status = 'CONFIRMED'\n                             AND b.endTime &gt; :#{#requestGetCarsDto.getStartTime()}\n                             AND b.startTime &lt; :#{#requestGetCarsDto.getEndTime()}\n                        THEN 1\n                        ELSE 0\n                    END\n                ) = 0\n            &quot;&quot;&quot;)\n    public Page&lt;CarsResponseDto&gt; findCars(@Param(&quot;requestGetCarsDto&quot;) RequestGetCarsDto requestGetCarsDto,\n            Pageable pageable);\n}\n</code></pre>\n<p>This is my CarsEntity:</p>\n<pre><code>\npackage com.duydev.backend.domain.model;\n\nimport java.math.BigDecimal;\nimport java.util.List;\n\nimport org.hibernate.annotations.ColumnTransformer;\n\nimport jakarta.persistence.CascadeType;\nimport jakarta.persistence.Column;\nimport jakarta.persistence.Entity;\nimport jakarta.persistence.JoinColumn;\nimport jakarta.persistence.ManyToOne;\nimport jakarta.persistence.OneToMany;\nimport jakarta.persistence.OneToOne;\nimport jakarta.persistence.Table;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Builder;\nimport lombok.Getter;\nimport lombok.NoArgsConstructor;\nimport lombok.Setter;\n\n@Getter\n@Setter\n@Builder\n@AllArgsConstructor\n@NoArgsConstructor\n@Entity\n@Table(name = &quot;tbl_cars&quot;)\npublic class CarsEntity extends AbstractEntity&lt;Long&gt; {\n\n    @ManyToOne\n    @JoinColumn(name = &quot;owner_id&quot;, referencedColumnName = &quot;id&quot;)\n    private User user;\n\n    @Column(name = &quot;brand&quot;)\n    private String brand;\n\n    @Column(name = &quot;model&quot;)\n    private String model;\n\n    @Column(name = &quot;license_plate&quot;)\n    private String licensePlate;\n\n    @Column(name = &quot;year&quot;)\n    private Integer year;\n\n    @Column(name = &quot;price_per_hour&quot;)\n    private BigDecimal pricePerHour;\n\n    @OneToOne(cascade = CascadeType.ALL)\n    @JoinColumn(name = &quot;location_id&quot;, referencedColumnName = &quot;id&quot;)\n    private LocationEntity location;\n\n    @Column(name = &quot;images&quot;, columnDefinition = &quot;jsonb&quot;)\n    @ColumnTransformer(write = &quot;?::jsonb&quot;)\n    private String images;\n\n    @OneToMany(mappedBy = &quot;car&quot;)\n    private List&lt;BookingEntity&gt; bookings;\n}\n</code></pre>\n<p>Here is my CarsResponseDto:</p>\n<pre><code>package com.duydev.backend.presentation.dto.response;\n\nimport lombok.Getter;\nimport lombok.NoArgsConstructor;\nimport lombok.Setter;\n\n@Getter\n@Setter\n@NoArgsConstructor\npublic class CarsResponseDto {\n    Long id;\n    String brand;\n    String model;\n    Integer year;\n    Double pricePerHour;\n\n    public CarsResponseDto(Long id, String brand, String model, Integer year, Double pricePerHour) {\n        this.id = id;\n        this.brand = brand;\n        this.model = model;\n        this.year = year;\n        this.pricePerHour = pricePerHour;\n    }\n}\n</code></pre>\n<p>This is my schema Cars:</p>\n<pre><code>CREATE TABLE tbl_cars (\n    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,\n    created_by BIGINT,\n    updated_by BIGINT,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    owner_id BIGINT NOT NULL,\n    brand VARCHAR(50) NOT NULL,\n    model VARCHAR(50) NOT NULL,\n    year INT NOT NULL,\n    license_plate VARCHAR(20) UNIQUE NOT NULL,\n    price_per_hour DECIMAL(10, 2) NOT NULL,\n    location_id BIGINT,\n    images JSONB,\n    FOREIGN KEY (owner_id) REFERENCES tbl_user(id) ON DELETE CASCADE,\n    FOREIGN KEY (location_id) REFERENCES tbl_locations(id) ON DELETE SET NULL\n);\n</code></pre>\n<p>How can I fix this error while keeping the <code>CASE</code> expressions and DTO projection?</p>\n",
    "tags" : [ "java", "postgresql", "spring-boot", "hibernate", "jpql" ],
    "owner" : {
      "account_id" : 26546160,
      "reputation" : 67,
      "user_id" : 20176201,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/61b2e6674e4a8fd69f8edc9fbafbdf42?s=256&d=identicon&r=PG",
      "display_name" : "Duy Phạm",
      "link" : "https://stackoverflow.com/users/20176201/duy-ph%e1%ba%a1m"
    },
    "is_answered" : true,
    "view_count" : 123,
    "answer_count" : 1,
    "score" : 4,
    "last_activity_date" : 1760542034,
    "creation_date" : 1760538730,
    "link" : "https://stackoverflow.com/questions/79791280/missing-constructor-when-using-select-new-dto-with-query-java-persist-query-lang",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79791343,
    "question_id" : 79791280,
    "body" : "<p>In order for the constructor DTO syntax to work, Hibernate needs to find an exact constructor match.  In your current DTO definition:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Getter\n@Setter\n@NoArgsConstructor\npublic class CarsResponseDto {\n    Long id;\n    String brand;\n    String model;\n    Integer year;\n    Double pricePerHour;\n\n    // ...\n}\n</code></pre>\n<p>you define the <code>pricePerHour</code> to be a <code>Double</code>.  However, in <code>CarsEntity</code>, this field, which is what you select in the HQL query, is defined as a <code>BigDecimal</code>.  Hibernate may not be able to handle this cast internally.  Consider aligning the types as follows:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Getter\n@Setter\n@NoArgsConstructor\n\npublic class CarsResponseDto {\n    Long id;\n    String brand;\n    String model;\n    Integer year;\n    BigDecimal pricePerHour;\n\n    // ...\n}\n</code></pre>\n",
    "score" : 4,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 2094057,
      "reputation" : 525996,
      "user_id" : 1863229,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://i.sstatic.net/4sh1l.png?s=256",
      "display_name" : "Tim Biegeleisen",
      "link" : "https://stackoverflow.com/users/1863229/tim-biegeleisen"
    },
    "creation_date" : 1760542034,
    "last_activity_date" : 1760542034,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79791343" : [ {
      "comment_id" : 140797626,
      "post_id" : 79791343,
      "body" : "@DuyPhạm If the answer solved the issue for you, then you might consider accepting it.",
      "score" : 0,
      "owner" : {
        "account_id" : 194308,
        "reputation" : 80530,
        "user_id" : 436560,
        "user_type" : "registered",
        "accept_rate" : 87,
        "profile_image" : "https://i.sstatic.net/2GESV.jpg?s=256",
        "display_name" : "Lajos Arpad",
        "link" : "https://stackoverflow.com/users/436560/lajos-arpad"
      },
      "creation_date" : 1760544704,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}