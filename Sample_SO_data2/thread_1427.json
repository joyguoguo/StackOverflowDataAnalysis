{
  "question" : {
    "question_id" : 79712186,
    "title" : "How to disable specific Spring components only during Maven test runs without using @ActiveProfiles in every test?",
    "body" : "<p>I am working on a Spring Boot (3.5.3) application with Maven (3.9.10) where I have some components (e.g. initializers) that break certain tests. I want to disable these components only when running tests via Maven (<code>mvn test</code>), but keep them enabled during normal application startup.</p>\n<p>Sure I can disable these components by using <code>@ActiveProfiles(&quot;test&quot;)</code> in each test or via application-test.yml, but I find it tedious to add this annotation everywhere.</p>\n<p>Is there a way to automatically detect if the application is running as part of Maven tests so that I can disable components conditionally in config files or with <code>@ConditionalOnProperty</code>?</p>\n<p>Ideally, I want something like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>component-disabled: ${is.test.running:false}\n</code></pre>\n<p>or a Spring condition that toggles based on whether Maven tests are running, without having to explicitly set profiles or properties in every test.</p>\n<p>Thanks in advance for your suggestions!</p>\n",
    "tags" : [ "java", "spring", "spring-boot", "maven", "testing" ],
    "owner" : {
      "account_id" : 19675128,
      "reputation" : 11,
      "user_id" : 14403480,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c335f2abec8936f46e4d2ca452de8d72?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "kaba4cow ",
      "link" : "https://stackoverflow.com/users/14403480/kaba4cow"
    },
    "is_answered" : false,
    "view_count" : 153,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1753284740,
    "creation_date" : 1753284740,
    "link" : "https://stackoverflow.com/questions/79712186/how-to-disable-specific-spring-components-only-during-maven-test-runs-without-us",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140614230,
    "post_id" : 79712186,
    "body" : "Yep you&#39;re absolutely right, might sound silly but only after your answer I realized that such things may cause troubles being part of the main code, makes total sense now to keep it out entirely and avoid cluttering tests and configs just to support a hack that shouldn&#39;t be there in the first place, thanks a lot. Pretty sure my last brain cell evolved thanks to you",
    "score" : 1,
    "owner" : {
      "account_id" : 19675128,
      "reputation" : 11,
      "user_id" : 14403480,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c335f2abec8936f46e4d2ca452de8d72?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "kaba4cow ",
      "link" : "https://stackoverflow.com/users/14403480/kaba4cow"
    },
    "creation_date" : 1753344537,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140612841,
    "post_id" : 79712186,
    "body" : "A good example of my concerns about having code for playing in sources is your case - you now have problems that require you to fix all of your tests, simply because the source code includes some playing component.  If you need test data in the database for your integration tests, for example, then you could use the embedded H2 database or Testcontainers and populate data there via scripts.",
    "score" : 0,
    "owner" : {
      "account_id" : 18586978,
      "reputation" : 3850,
      "user_id" : 15000097,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/yFl4M.jpg?s=256",
      "display_name" : "Georgii Lvov",
      "link" : "https://stackoverflow.com/users/15000097/georgii-lvov"
    },
    "creation_date" : 1753293125,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140612827,
    "post_id" : 79712186,
    "body" : "Personally, I am opposed to keep any components for testing/playing in the source code that are not used in prod. if I create such files, I don&#39;t commit them and have them locally. Even my advice to add a <code>maven-test</code> profile to the <code>pom.xml</code> leads to cluttering the source code, which is not good. But since it&#39;s already there, it probably doesn&#39;t matter what to use - either conditionals or profiles. In both cases, this leads to a change in the source code (pom.xml, configs, application.yaml). And, fmpov, trying to make it beautiful is pointless - it simply must not be there in any form",
    "score" : 0,
    "owner" : {
      "account_id" : 18586978,
      "reputation" : 3850,
      "user_id" : 15000097,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/yFl4M.jpg?s=256",
      "display_name" : "Georgii Lvov",
      "link" : "https://stackoverflow.com/users/15000097/georgii-lvov"
    },
    "creation_date" : 1753292615,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140612690,
    "post_id" : 79712186,
    "body" : "@Georgii thanks for the answer! Just to clarify: the component I&#39;m referring to isn’t used in production at all, it only helps with manual testing/playing around in Swagger by populating the DB with some dummy data so I don’t waste time doing it manually. Currently, I&#39;m just disabling the comp manually in config before running tests, which works but feels very wrong. Setting <code>test</code>/<code>maven</code> profile in surefire would help but I have one specific profile which needs to be active in tests and surefire setting will just override it afaik",
    "score" : 0,
    "owner" : {
      "account_id" : 19675128,
      "reputation" : 11,
      "user_id" : 14403480,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c335f2abec8936f46e4d2ca452de8d72?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "kaba4cow ",
      "link" : "https://stackoverflow.com/users/14403480/kaba4cow"
    },
    "creation_date" : 1753289397,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140612597,
    "post_id" : 79712186,
    "body" : "So in your case, I would begin by creating some test configurations where I mock or override beans, setting them with <code>@Profile(value = &quot;maven&quot;)</code>, and then update the surefire plugin by setting the <code>maven</code> Spring profile there",
    "score" : 0,
    "owner" : {
      "account_id" : 18586978,
      "reputation" : 3850,
      "user_id" : 15000097,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/yFl4M.jpg?s=256",
      "display_name" : "Georgii Lvov",
      "link" : "https://stackoverflow.com/users/15000097/georgii-lvov"
    },
    "creation_date" : 1753287300,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140612572,
    "post_id" : 79712186,
    "body" : "I would not recommend modifying the source code as you propose by adding <code>@ConditionalOnProperty</code> just to accommodate tests. Thus, I’d recommend setting up your tests to <b>mock</b> or <b>override</b> some beans in the <b>test configuration</b> and applying that to your test.  By the way, just fyi, although it is commendable to try to reduce duplication in tests (<i>...to add this annotation everywhere...</i>), it is often unnecessary and sometimes even detrimental to complicate tests by trying to deal with duplicates using abstractions and similar techniques that are welcome in the source code.",
    "score" : 2,
    "owner" : {
      "account_id" : 18586978,
      "reputation" : 3850,
      "user_id" : 15000097,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/yFl4M.jpg?s=256",
      "display_name" : "Georgii Lvov",
      "link" : "https://stackoverflow.com/users/15000097/georgii-lvov"
    },
    "creation_date" : 1753286758,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}