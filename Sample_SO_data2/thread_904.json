{
  "question" : {
    "question_id" : 79765214,
    "title" : "ClassCastException when traversing childNodes in GWT Elemental2 during text highlighting implementation",
    "body" : "<p>​​Problem Description​​:</p>\n<p>I'm implementing text highlighting functionality using GWT and Elemental2. When traversing through <code>childNodes</code> to process text nodes for highlighting, I'm encountering a <code>ClassCastException</code> when trying to cast nodes to <code>HTMLElement</code>.​​</p>\n<p>Scenario​​:</p>\n<p>I need to highlight text content within a DOM element and its children. My approach involves recursively traversing through <code>childNodes</code> checking node types (<code>Node.TEXT_NODE</code> vs <code>Node.ELEMENT_NODE</code>) and</p>\n<ul>\n<li>For text nodes: creating highlighted spans using <code>DocumentFragment</code></li>\n<li>For element nodes: recursing into child nodes</li>\n</ul>\n<p>During this traversal, I'm getting a <code>ClassCastException</code> when processing non-element nodes.</p>\n<p>​​Code Snippet​​:</p>\n<pre><code>private void highlightText(Node parentNode) {\n    NodeList&lt;Node&gt; childNodes = parentNode.childNodes;\n    for (int i = 0; i &lt; childNodes.length; i++) {\n        Node node = childNodes.getAt(i);\n        if (node.nodeType == Node.TEXT_NODE) {\n            // Process text node - THIS WORKS FINE\n            processTextNode(parentNode, (Text) node);\n        } else if (node instanceof HTMLElement) {\n            // PROBLEM AREA: This cast sometimes fails\n            HTMLElement element = (HTMLElement) node;\n            // Recursively process child nodes\n            if (element.hasChildNodes()) {\n                highlightText(element);\n            }\n        }\n    }\n}\n</code></pre>\n",
    "tags" : [ "java", "gwt", "classcastexception", "gwt-elemental" ],
    "owner" : {
      "account_id" : 29072465,
      "reputation" : 1,
      "user_id" : 22270430,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AAcHTtdS9TAdwUt_FvdoywI1bPX0cwwHWehNE3H6OWYj2Z-_=k-s256",
      "display_name" : "FanTech",
      "link" : "https://stackoverflow.com/users/22270430/fantech"
    },
    "is_answered" : false,
    "view_count" : 39,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1757949888,
    "creation_date" : 1757943606,
    "link" : "https://stackoverflow.com/questions/79765214/classcastexception-when-traversing-childnodes-in-gwt-elemental2-during-text-high",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140745233,
    "post_id" : 79765214,
    "body" : "Testing the nodetype and casting in response to that <i>can</i> in some cases cause this issue, but instanceof and cast are implemented using the same code by the compiler - prefer that approach, or use <code>Js.uncheckedCast</code> to be clear that the cast failing doesn&#39;t matter. Can you confirm that this is elemental2.dom.HTMLElement? Likewise, does this go away if you replace the nodeType check with an instanceof?",
    "score" : 0,
    "owner" : {
      "account_id" : 459879,
      "reputation" : 18461,
      "user_id" : 860630,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/94fa4bedbe5f1737e97a13ead0f2ea37?s=256&d=identicon&r=PG",
      "display_name" : "Colin Alworth",
      "link" : "https://stackoverflow.com/users/860630/colin-alworth"
    },
    "creation_date" : 1758207624,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140737411,
    "post_id" : 79765214,
    "body" : "I&#39;m clearly looking at a different version of GWT than you are using, but even so, I&#39;m inclined to doubt that you need that cast in the first place.  Or the <code>instanceof</code> test or the <code>hasChildNodes()</code> test. Couldn&#39;t you just go straight to recursing for nodes having nodeType different from <code>Node.TEXT_NODE</code>?",
    "score" : 0,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1757950677,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140737358,
    "post_id" : 79765214,
    "body" : "I&#39;m sorry, but I do not believe your apparent claim that you observe <code>node instanceof HTMLElement</code> evaluate to true yet receive a <code>ClassCastException</code> from evaluating <code>(HTMLElement) node</code> for the same value of <code>node</code>.",
    "score" : 0,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1757949671,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140737074,
    "post_id" : 79765214,
    "body" : "Welcome to Stack Overflow. Please edit your post to correctly format your code so it is not one big line/block, to improve readability. I added some newlines to your post but I&#39;m sure I missed some. Readability is important for questions here.",
    "score" : 0,
    "owner" : {
      "account_id" : 3273747,
      "reputation" : 21269,
      "user_id" : 2756409,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://i.sstatic.net/UIrGI.jpg?s=256",
      "display_name" : "TylerH",
      "link" : "https://stackoverflow.com/users/2756409/tylerh"
    },
    "creation_date" : 1757943838,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}