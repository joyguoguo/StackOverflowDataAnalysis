{
  "question" : {
    "question_id" : 79705868,
    "title" : "How to fix PDF gradients step rendering in Apache PDFBox?",
    "body" : "<p>I use <code>Apache PDFBox 3.0.5</code> to place some text inside PDF template and render the result as PNG:</p>\n<pre class=\"lang-java prettyprint-override\"><code>byte[] templateBytes = loadTemplate();\n\ntry (var document = Loader.loadPDF(templateBytes)) {\n    var contentStream = new PDPageContentStream(document, document.getPage(0), PDPageContentStream.AppendMode.APPEND, false, false);\n\n    // places text in document\n\n    contentStream.close();\n\n    renderAndSave(document);\n}\n</code></pre>\n<p>The method <code>renderAndSave(PDDocument)</code>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>private void renderAndSave(PDDocument document) throws IOException {\n    val path = getFilePath();\n\n    var renderer = new PDFRenderer(document);\n    var bufferedImage = renderer.renderImageWithDPI(0, 72, ImageType.RGB);\n\n    try (var byteArrayOutputStream = new ByteArrayOutputStream()) {\n        document.save(byteArrayOutputStream);\n\n        ImageIO.write(bufferedImage, &quot;PNG&quot;, byteArrayOutputStream);\n        var bytes = byteArrayOutputStream.toByteArray();\n\n        fileService.upload(bytes, path);\n    }\n}\n</code></pre>\n<p>The problem is related to how gradients are rendered. Do you see these steps? There are no such abrupt transitions in the primary PDF.</p>\n<p><a href=\"https://i.sstatic.net/9Qsxz8nK.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/9Qsxz8nK.png\" alt=\"enter image description here\" /></a></p>\n<p>This is how the part looks if I don't render result PDF as PNG but just save it as PDF:\n<a href=\"https://i.sstatic.net/51SYsrRH.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/51SYsrRH.png\" alt=\"enter image description here\" /></a></p>\n<p>There are no steps and gradients are very smooth.</p>\n<p>I cannot solve the problem. I already tried:</p>\n<ul>\n<li>Change DPI</li>\n<li>Change quality of template PDF file</li>\n<li>Set <code>RenderDestination</code> to <code>VIEW</code> or <code>PRINT</code></li>\n<li>Render to ARGB instead of RGB</li>\n<li>Render to JPEG instead of PNG</li>\n</ul>\n<p>It does not help. The problem is not related to result PDF because the result PDF contains correct gradients. I tried to render PDF using online website and the result PNG had smooth gradients also. So the problems is related to how <code>Apache PDFBox</code> renders PDFs.</p>\n<p>How can I render PDF in Apache PDFBox to get result PNG with smooth gradients?</p>\n<p><strong>Update 25.05.2025:</strong> tried to save PDF to the file system and then load and render it as PNG. No difference.</p>\n<p><strong>Update 25.05.2025:</strong> used <code>Ghost4J</code> to render image only <em>(the PDF is creating by <code>Apache PDFBox</code> as before)</em> and it solves the problem. So the problem is related to <code>Apache PDFBox</code> library.</p>\n",
    "tags" : [ "java", "pdf", "pdf-generation", "pdfbox" ],
    "owner" : {
      "account_id" : 18442446,
      "reputation" : 458,
      "user_id" : 14614707,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GinvhOuJJRxd4GFujVf5znA-6GvFKosE6OFau7L=k-s256",
      "display_name" : "Zhenyria",
      "link" : "https://stackoverflow.com/users/14614707/zhenyria"
    },
    "is_answered" : false,
    "view_count" : 129,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1753445601,
    "creation_date" : 1752825824,
    "link" : "https://stackoverflow.com/questions/79705868/how-to-fix-pdf-gradients-step-rendering-in-apache-pdfbox",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140599375,
    "post_id" : 79705868,
    "body" : "Please share the saved PDF. Also try what happens if you save first, reload and render.",
    "score" : 2,
    "owner" : {
      "account_id" : 255529,
      "reputation" : 19235,
      "user_id" : 535646,
      "user_type" : "registered",
      "accept_rate" : 40,
      "profile_image" : "https://i.sstatic.net/yGyps.jpg?s=256",
      "display_name" : "Tilman Hausherr",
      "link" : "https://stackoverflow.com/users/535646/tilman-hausherr"
    },
    "creation_date" : 1752828974,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}