{
  "question" : {
    "question_id" : 79594513,
    "title" : "Java/gradle project that builds locally doesn&#39;t build in AWS/CodeBuild/Docker",
    "body" : "<p>Sorry I can't post everything, there is a lot of code - hopefully this is ok</p>\n<p>System:\nOracle Linux 9\nJava Corretto 17\nGradle 7.6</p>\n<p>The layout of my project is</p>\n<p>main\nsubproject_1\nsubproject_2\nsubproject_3\nsubproject_4</p>\n<p>subproject_2 depends on subproject_1</p>\n<p>In the build.grade in project_2 I have the following</p>\n<pre><code> dependencies {\n    implementation project(':subproject_1')\n }\n</code></pre>\n<p>This works fine on my dev box where I have Oracle Linux 9 running in VirtualBox.</p>\n<p>I am trying to build using AWS CodeBuild. I created a docker file which is set up just like my local box, same versions, same tools, pulls source from same repo, etc.\nBUT - it does not compile because when files in subproject_2 reference classes in subproject_1 get the following error.  Like the jar file from subproject_1 is not in the classpath, but it is - more detail below</p>\n<pre><code>/codebuild/output/src1686710177/src/github.com/userdir/main_project/subproject_2/src/main/java/com/xxx/yyy/management/zzz/smdr/Data.java:29: error: package **com.xxx.common.debug** does not exist\n    import **com.xxx.common.debug**.DebugLoggerIfc; \n</code></pre>\n<p>I added code to build.grade to print out the classpath for the gradle compile tasks, which shows that the jar from subproject_1 is in the classpath.</p>\n<p>[partial output of building subproject_2:</p>\n<pre><code>Classpath for subproject_2:\n...\n...\n/codebuild/output/src1686710177/src/github.com/userdir/root_project/subproject_1/build/libs/xxx-common.jar\n</code></pre>\n<p>Why does this not work in CodeBuild using the docker file?</p>\n",
    "tags" : [ "java", "docker", "gradle", "aws-codebuild" ],
    "owner" : {
      "account_id" : 9124114,
      "reputation" : 349,
      "user_id" : 6788557,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/kUOJT.png?s=256",
      "display_name" : "SRJ",
      "link" : "https://stackoverflow.com/users/6788557/srj"
    },
    "is_answered" : true,
    "view_count" : 116,
    "answer_count" : 3,
    "score" : 0,
    "last_activity_date" : 1746024970,
    "creation_date" : 1745709881,
    "link" : "https://stackoverflow.com/questions/79594513/java-gradle-project-that-builds-locally-doesnt-build-in-aws-codebuild-docker",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79600579,
    "question_id" : 79594513,
    "body" : "<p>This was not due to anything CodeBuild or gradle.<br />\nSomeone on the team got overly zealous about adding things to the .gitignore file that was keeping some needed files out.</p>\n<p>Sorry for the fire drill.<br />\nThanks for your responses!</p>\n<p>Props to intellij for showing ignored filenames in a different color - that was the hit I needed!</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 9124114,
      "reputation" : 349,
      "user_id" : 6788557,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/kUOJT.png?s=256",
      "display_name" : "SRJ",
      "link" : "https://stackoverflow.com/users/6788557/srj"
    },
    "creation_date" : 1746024970,
    "last_activity_date" : 1746024970,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79594897,
    "question_id" : 79594513,
    "body" : "<p>I would be expecting, the classpath of the subproject_1 should be</p>\n<pre><code>main_project like\n</code></pre>\n<pre><code>/codebuild/output/src1686710177/src/github.com/userdir/main_project/subproject_1/build/libs/xxx-common.jar\n</code></pre>\n<p>not in the root_project, as you shown below.</p>\n<pre><code>Classpath for subproject_2:\n...\n...\n/codebuild/output/src1686710177/src/github.com/userdir/root_project/subproject_1/build/libs/xxx-common.jar\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 14715869,
      "reputation" : 1,
      "user_id" : 10627854,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/s256-rj/photo.jpg",
      "display_name" : "Kavitha Hawaldar",
      "link" : "https://stackoverflow.com/users/10627854/kavitha-hawaldar"
    },
    "creation_date" : 1745746714,
    "last_activity_date" : 1745746714,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79594955,
    "question_id" : 79594513,
    "body" : "<p>For debugging purpose only, try to add following piece of code in build.gradle of subproject_2</p>\n<pre><code>tasks.named('compileJava'){\n  dependsOn(':subproject_1:build')\n}\n</code></pre>\n<p>Do you have like this layout</p>\n<pre><code>repo/\n├── buildspec.yml            \n├── main_project/\n│   ├── build.gradle\n│   ├── settings.gradle\n│   ├── subproject_1/\n│   ├── subproject_2/\n│   ├── subproject_3/\n│   └── subproject_4/\n└── README.md\n</code></pre>\n<p>buildspec.yml is in repo/\nin buildspec.yml, you need to cd into main_project before running any gradle commands.</p>\n<pre><code>phases:\n  install: \n    commands: \n      -cd /src/github.com/userdir/main_project \n</code></pre>\n<p>in settings.gradle contains</p>\n<pre><code>rootProject.name = 'main_project'\ninclude 'subproject_1','subproject_2','subproject_3','subproject_4'\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 14715869,
      "reputation" : 1,
      "user_id" : 10627854,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/s256-rj/photo.jpg",
      "display_name" : "Kavitha Hawaldar",
      "link" : "https://stackoverflow.com/users/10627854/kavitha-hawaldar"
    },
    "creation_date" : 1745751826,
    "last_activity_date" : 1745752177,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79594955" : [ {
      "comment_id" : 140390945,
      "post_id" : 79594955,
      "body" : "The problem was that a very long time ago someone wrong code in a package com.xxx.logging.debug and added it to git. I was testing github to see if should replace our in-house git repo. Somewhere in between those time someone added a rule to the .gitignore file blocking anything widh &quot;debug&quot; in it.  Everything was working as it should, but the build was failing since the java package was missing the com.xxx.debug.* package.  So not a code build issue at all. Thanks again for your help!",
      "score" : 0,
      "owner" : {
        "account_id" : 9124114,
        "reputation" : 349,
        "user_id" : 6788557,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/kUOJT.png?s=256",
        "display_name" : "SRJ",
        "link" : "https://stackoverflow.com/users/6788557/srj"
      },
      "creation_date" : 1746206392,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140382709,
      "post_id" : 79594955,
      "body" : "can you post your buildspec.yml",
      "score" : 0,
      "owner" : {
        "account_id" : 14715869,
        "reputation" : 1,
        "user_id" : 10627854,
        "user_type" : "registered",
        "profile_image" : "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/s256-rj/photo.jpg",
        "display_name" : "Kavitha Hawaldar",
        "link" : "https://stackoverflow.com/users/10627854/kavitha-hawaldar"
      },
      "creation_date" : 1745992628,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140382227,
      "post_id" : 79594955,
      "body" : "maybe I&#39;m not seeing, but I don&#39;t see the difference in what you have and what I posted a bit above",
      "score" : 0,
      "owner" : {
        "account_id" : 9124114,
        "reputation" : 349,
        "user_id" : 6788557,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/kUOJT.png?s=256",
        "display_name" : "SRJ",
        "link" : "https://stackoverflow.com/users/6788557/srj"
      },
      "creation_date" : 1745974615,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140377568,
      "post_id" : 79594955,
      "body" : "Did you try this command in buildspec.yml   install:      commands:        -cd /src/github.com/userdir/main_project",
      "score" : 0,
      "owner" : {
        "account_id" : 14715869,
        "reputation" : 1,
        "user_id" : 10627854,
        "user_type" : "registered",
        "profile_image" : "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/s256-rj/photo.jpg",
        "display_name" : "Kavitha Hawaldar",
        "link" : "https://stackoverflow.com/users/10627854/kavitha-hawaldar"
      },
      "creation_date" : 1745863187,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140377085,
      "post_id" : 79594955,
      "body" : "I have tried that and it does not change the behavior.",
      "score" : 0,
      "owner" : {
        "account_id" : 9124114,
        "reputation" : 349,
        "user_id" : 6788557,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/kUOJT.png?s=256",
        "display_name" : "SRJ",
        "link" : "https://stackoverflow.com/users/6788557/srj"
      },
      "creation_date" : 1745854873,
      "content_license" : "CC BY-SA 4.0"
    } ],
    "79594897" : [ {
      "comment_id" : 140377172,
      "post_id" : 79594897,
      "body" : "I will try and track that down.   I don&#39;t have control as to how that lines is generated by gradle.",
      "score" : 0,
      "owner" : {
        "account_id" : 9124114,
        "reputation" : 349,
        "user_id" : 6788557,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/kUOJT.png?s=256",
        "display_name" : "SRJ",
        "link" : "https://stackoverflow.com/users/6788557/srj"
      },
      "creation_date" : 1745856172,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140373478,
      "post_id" : 79594897,
      "body" : "For debugging purpose only, add this piece of code in build.gradle of subproject_2 module,    tasks.named(&#39;compileJava&#39;) {     dependsOn(&#39;:subproject_1:build&#39;) }  Can you please get the source code of settings.gradle in codebuild/output/src1686710177/src/github.com/userdir/main_p&zwnj;&#8203;roject",
      "score" : 0,
      "owner" : {
        "account_id" : 14715869,
        "reputation" : 1,
        "user_id" : 10627854,
        "user_type" : "registered",
        "profile_image" : "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/s256-rj/photo.jpg",
        "display_name" : "Kavitha Hawaldar",
        "link" : "https://stackoverflow.com/users/10627854/kavitha-hawaldar"
      },
      "creation_date" : 1745750668,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}