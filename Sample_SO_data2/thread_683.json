{
  "question" : {
    "question_id" : 79786563,
    "title" : "Spring Data Cassandra returns only 2 rows while there are 148",
    "body" : "<p>The query in ScyllaDB when run in console in IntelliJ returns 148 rows.</p>\n<pre class=\"lang-sql prettyprint-override\"><code>select * from posts where author_id=f7af0560-d30a-4e84-adca-ca3acd956d17 ALLOW FILTERING\n</code></pre>\n<p>But when I run it in Spring application, it returns only 2 rows.</p>\n<pre class=\"lang-java prettyprint-override\"><code>// in service\nvar posts = postRepository.findAllByAuthorId(user.getId()); // only 2 rows\n\n// tried different approach\nvar q = query(where(&quot;author_id&quot;).is(user.getId())).withAllowFiltering();\nvar count = cassandraTemplate.stream(q, Post.class).count();\n\n// repository\npublic interface PostRepository extends MapIdCassandraRepository&lt;Post&gt; {\n  @AllowFiltering\n  Collection&lt;Post&gt; findAllByAuthorId(UUID authorId);\n}\n\n// entity\n@Getter\n@Setter\n@Table(&quot;posts&quot;)\n@NoArgsConstructor\n@AllArgsConstructor\n@Builder(toBuilder = true)\npublic class Posts {\n  @PrimaryKeyColumn(name = &quot;post_id&quot;, ordinal = 0, type = PrimaryKeyType.PARTITIONED)\n  private UUID postId;\n\n  @PrimaryKeyColumn(name = &quot;category_id&quot;, ordinal = 1, type = PrimaryKeyType.CLUSTERED)\n  private UUID categoryId;\n\n  @Column(value = &quot;author_id&quot;, isStatic = true)\n  private UUID authorId;\n}\n</code></pre>\n<p>Table definition:</p>\n<pre class=\"lang-sql prettyprint-override\"><code>CREATE TABLE IF NOT EXISTS posts\n(\n  post_id          UUID,\n  author_id        UUID STATIC,\n  category_id      UUID,\n  PRIMARY KEY (post_id, category_id)\n);\n</code></pre>\n<p>ChatGPT says that it's because of paging feature in ScyllaDB.</p>\n<p>Versions:</p>\n<ul>\n<li>Spring Boot: 3.5.6</li>\n<li>Spring Data Cassandra: 4.5.4</li>\n<li>Scylla Driver Mapping: 3.11.5.8</li>\n<li>ScyllaDB Java Driver Core: 4.18.0.2</li>\n</ul>\n<p>In IntellIJ IDEA driver version is 4.12.0.2.</p>\n<p>Why does it return only 2 rows and what to do to return all rows?</p>\n",
    "tags" : [ "java", "spring-boot", "cassandra", "spring-data-cassandra", "scylla" ],
    "owner" : {
      "account_id" : 5297359,
      "reputation" : 513,
      "user_id" : 4784969,
      "user_type" : "registered",
      "accept_rate" : 17,
      "profile_image" : "https://i.sstatic.net/lBsP2.png?s=256",
      "display_name" : "Politechniczny",
      "link" : "https://stackoverflow.com/users/4784969/politechniczny"
    },
    "is_answered" : false,
    "view_count" : 56,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1760021650,
    "creation_date" : 1760021650,
    "link" : "https://stackoverflow.com/questions/79786563/spring-data-cassandra-returns-only-2-rows-while-there-are-148",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140786857,
    "post_id" : 79786563,
    "body" : "For clarity, can you (i) confirm that the two interfaces are querying the same database, and (ii) present a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> that makes it clear that the queries being performed are equivalent? Or (ii&#39;) present debug output showing the query actually executed by Spring?",
    "score" : 0,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1760030955,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140786845,
    "post_id" : 79786563,
    "body" : "ScyllaDB apparently does have a paging feature that, specifically for asynchronous queries, requires the second and subsequent queries to be fetched explicitly.  If that is responsible for your issue then I would attribute that to a bug in the JPA implementation or an issue with the configuration of the persistence unit.  We don&#39;t have enough information to evaluate any of that.",
    "score" : 0,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1760030584,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}