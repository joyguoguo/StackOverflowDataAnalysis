{
  "question" : {
    "question_id" : 79583206,
    "title" : "How to detect the back press and home press in accessibility service",
    "body" : "<p>I have placed the accessibility service in my android app, and want to detect the back key press button. In the Accessibility service:</p>\n<pre><code>override fun onKeyEvent(event: KeyEvent): Boolean {\n        // Only handle key down events to avoid duplicates\n        Log.d(&quot;keyTestLog&quot;, &quot;onKeyEvent: ${event.keyCode} || ${event.keyCode == KeyEvent.KEYCODE_BACK} &quot;)\n    if (event.action == KeyEvent.ACTION_DOWN) {\n        when (event.keyCode) {\n            KeyEvent.KEYCODE_VOLUME_UP,\n            KeyEvent.KEYCODE_VOLUME_DOWN,\n            KeyEvent.KEYCODE_BACK -&gt; {\n                keyEventListener?.invoke(event.keyCode)\n                return true\n            }\n        }\n    }\n    return super.onKeyEvent(event)\n}\n</code></pre>\n<p>when I press the back button, in the service its event is not get. However, I tested in the activity,</p>\n<pre><code>override fun onKeyDown(keyCode: Int, event: KeyEvent?): Boolean {\n        if (keyCode == KeyEvent.KEYCODE_BACK)\n        {\n            Log.d(&quot;keyTestLog&quot;, &quot;onKeyDown: ACTIVITY_KEY_DOWN&quot;)\n        }\n        if (keyCode == KeyEvent.KEYCODE_VOLUME_UP)\n        {\n            Log.d(&quot;keyTestLog&quot;, &quot;onKeyDown: ACTIVITY_KEY_VOLUME_UP&quot;)\n        }\n\n        return super.onKeyDown(keyCode, event)\n    }\n</code></pre>\n<p>its getting the back button event. I want to implement the functionality to get the back button event in the accessibility service.</p>\n",
    "tags" : [ "java", "android", "kotlin", "callback" ],
    "owner" : {
      "account_id" : 35553138,
      "reputation" : 23,
      "user_id" : 27272936,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/299339a770ca7d416cd4174a83369854?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Fahad",
      "link" : "https://stackoverflow.com/users/27272936/fahad"
    },
    "is_answered" : false,
    "view_count" : 96,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1745142660,
    "creation_date" : 1745139615,
    "link" : "https://stackoverflow.com/questions/79583206/how-to-detect-the-back-press-and-home-press-in-accessibility-service",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79583241,
    "question_id" : 79583206,
    "body" : "<h1><strong>Detect Back and Home Button Presses in AccessibilityService</strong></h1>\n<h3>Override onAccessibilityEvent()</h3>\n<p>You can listen for <strong>TYPE_WINDOW_STATE_CHANGED</strong> or <strong>TYPE_WINDOW_CONTENT_CHANGED</strong> events and check which app or activity is currently in the foreground.</p>\n<h3><strong>Back Button Detection</strong></h3>\n<p>Back press usually results in a window change or app closure, so you can infer it by comparing the current and previous window package names or activity classes.</p>\n<h3><strong>Home Button Detection</strong></h3>\n<p>When Home is pressed, your current app/activity will be replaced by the launcher/home screen.</p>\n<p>You can follow the below class for detecting Back and Home button actions using AccessibilityService.</p>\n<p>I hope it will be helpful for you</p>\n<pre><code>class MyAccessibilityService : AccessibilityService() {\n\n    private var previousPackageName: String? = null\n\n    override fun onAccessibilityEvent(event: AccessibilityEvent) {\n        if (event.eventType == AccessibilityEvent.TYPE_WINDOW_STATE_CHANGED) {\n            val currentPackage = event.packageName?.toString()\n\n            // Detect HOME press\n            if (isLauncherApp(currentPackage)) {\n                Log.d(&quot;AccessService&quot;, &quot;Home button pressed&quot;)\n            }\n\n            // Detect BACK press (indirectly)\n            if (previousPackageName != null &amp;&amp; currentPackage != previousPackageName) {\n                Log.d(&quot;AccessService&quot;, &quot;Possibly back button pressed (window changed)&quot;)\n            }\n\n            previousPackageName = currentPackage\n        }\n    }\n\n    override fun onInterrupt() {}\n\n    private fun isLauncherApp(packageName: String?): Boolean {\n        val intent = Intent(Intent.ACTION_MAIN)\n        intent.addCategory(Intent.CATEGORY_HOME)\n        val resolveInfo = packageManager.resolveActivity(intent, PackageManager.MATCH_DEFAULT_ONLY)\n        return packageName == resolveInfo?.activityInfo?.packageName\n    }\n}\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 16785393,
      "reputation" : 423,
      "user_id" : 12134511,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/HKy4a.jpg?s=256",
      "display_name" : "Er.Prem Singh daksha",
      "link" : "https://stackoverflow.com/users/12134511/er-prem-singh-daksha"
    },
    "creation_date" : 1745142660,
    "last_activity_date" : 1745142660,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79583241" : [ {
      "comment_id" : 140373410,
      "post_id" : 79583241,
      "body" : "Let me see if it works, but I don&#39;t see it feasible. Although, thank you!",
      "score" : 0,
      "owner" : {
        "account_id" : 35553138,
        "reputation" : 23,
        "user_id" : 27272936,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/299339a770ca7d416cd4174a83369854?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Fahad",
        "link" : "https://stackoverflow.com/users/27272936/fahad"
      },
      "creation_date" : 1745748670,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140354760,
      "post_id" : 79583241,
      "body" : "I think you should handle as per your requirement, where log is call.",
      "score" : 0,
      "owner" : {
        "account_id" : 16785393,
        "reputation" : 423,
        "user_id" : 12134511,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/HKy4a.jpg?s=256",
        "display_name" : "Er.Prem Singh daksha",
        "link" : "https://stackoverflow.com/users/12134511/er-prem-singh-daksha"
      },
      "creation_date" : 1745247205,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140352341,
      "post_id" : 79583241,
      "body" : "I have tried your solution, but its not actually a feasible solution. It gave me the log at every screen. Also some time the home button and when I launch the app again, it gives me the log of back button.",
      "score" : 0,
      "owner" : {
        "account_id" : 35553138,
        "reputation" : 23,
        "user_id" : 27272936,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/299339a770ca7d416cd4174a83369854?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Fahad",
        "link" : "https://stackoverflow.com/users/27272936/fahad"
      },
      "creation_date" : 1745157608,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}