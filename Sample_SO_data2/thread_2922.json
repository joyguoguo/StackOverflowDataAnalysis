{
  "question" : {
    "question_id" : 79588169,
    "title" : "Spring data jdbc and child entity equality",
    "body" : "<p>I’m studying Spring Data JDBC through Maciej Walkowiak’s video (<a href=\"https://www.youtube.com/watch?v=ccxBXDAPdmo\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=ccxBXDAPdmo</a>), which presents a Movie aggregate root with a one-to-many relationship to Rental entities. The Rental entity lacks an @Id field, and no equals/hashCode is implemented. The rental table has an auto-incrementing id (not mapped to the entity) and an implicit movie_id foreign key.\nHere’s the simplified structure from the video:</p>\n<pre><code>]@Table(&quot;movie&quot;)\nclass Movie {\n    @Id\n    Long id;\n    String title;\n    Set&lt;Rental&gt; rentals;\n}\n\n@Table(&quot;rental&quot;)\nclass Rental {\n    Duration duration; // No @Id, no equals/hashCode\n    Integer price;\n}\n</code></pre>\n<p><strong>My Concern:</strong>\nThe absence of equals/hashCode in Rental troubles me because, in DDD, entities should have identity-based equality, not value-based(such as duration and price). For Movie, equals/hashCode can use id, but Rental has no identity field. Basing equals on duration and price seems to violate DDD, which suggests using identity for equality on entities. The rental table’s auto-incrementing id seems unfit for equals due to Spring Data JDBC’s delete-and-insert update strategy, which changes id values. Or is my concern even valid? If we base equality on object reference and if we only add rentals via Movie (e.g. addRental(Rental rental)) things should be fine. But IRL we probably need someway to interact with certain rental (for example endRental) and for that we need way to distinguish them</p>\n<p><strong>Proposed Solution:</strong>\nI believe Rental should have an application-generated UUID field to ensure DDD-compliant entity identity, with equals/hashCode</p>\n<p><strong>Questions:</strong></p>\n<p>Is the video bit simplistic? I mean in real world we probably need a way to distinguish rentals from each others</p>\n<p>Is my assumption correct that autogenerated id is unfit for equality check?</p>\n<p>Is my UUID approach correct for DDD compliance in Spring Data JDBC?</p>\n<p>Is Spring Data JDBC’s design (omitting @Id for dependent entities like Rental) intentional, and does it align with DDD?</p>\n<p>Thanks for any insights or examples from your experience with Spring Data JDBC and DDD!</p>\n",
    "tags" : [ "java", "spring", "domain-driven-design" ],
    "owner" : {
      "account_id" : 7108228,
      "reputation" : 153,
      "user_id" : 5437156,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ced23d3c1d55acf2fb12d72c1a48d1b0?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "theNikki1",
      "link" : "https://stackoverflow.com/users/5437156/thenikki1"
    },
    "is_answered" : false,
    "view_count" : 70,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1745397626,
    "creation_date" : 1745397110,
    "link" : "https://stackoverflow.com/questions/79588169/spring-data-jdbc-and-child-entity-equality",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}