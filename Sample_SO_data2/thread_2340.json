{
  "question" : {
    "question_id" : 79631389,
    "title" : "How to make my Bluetooth Printer connected always to my android java application for printing reciepts",
    "body" : "<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\" data-babel-preset-react=\"false\" data-babel-preset-ts=\"false\">\n<div class=\"snippet-code\">\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>  @SuppressLint(\"MissingPermission\")\n    public static boolean connectBT(Context context) {\n        Log.d(\"CONNECT_BT\", \"Initializing Bluetooth connection...\");\n\n        // Close any existing connections and streams\n        if (outputStream != null) {\n            try {\n                outputStream.flush();\n                outputStream.close();\n                Log.d(\"CONNECT_BT\", \"OutputStream flushed and closed.\");\n            } catch (IOException e) {\n                Log.e(\"CONNECT_BT\", \"Failed to close existing OutputStream: \" + e.getMessage());\n            }\n        }\n        \n        bluetooth = BluetoothAdapter.getDefaultAdapter();\n        if (bluetooth == null) {\n            printstatus = \"Bluetooth not supported on this device.\";\n            Log.e(\"CONNECT_BT\", printstatus);\n            return false;\n        }\n\n        if (!bluetooth.isEnabled()) {\n            printstatus = \"Bluetooth is not enabled.\";\n            Log.e(\"CONNECT_BT\", printstatus);\n            return false;\n        }\n\n        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.S) {\n            if (ContextCompat.checkSelfPermission(context, Manifest.permission.BLUETOOTH_CONNECT) != PackageManager.PERMISSION_GRANTED ||\n                    ContextCompat.checkSelfPermission(context, Manifest.permission.BLUETOOTH_SCAN) != PackageManager.PERMISSION_GRANTED) {\n\n                ActivityCompat.requestPermissions((Activity) context, new String[]{\n                        Manifest.permission.BLUETOOTH_CONNECT,\n                        Manifest.permission.BLUETOOTH_SCAN\n                }, 100);\n\n                Log.w(\"CONNECT_BT\", \"Missing Bluetooth permissions.\");\n                return false;\n            }\n        }\n\n        if (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.R) {\n            if (ContextCompat.checkSelfPermission(context, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) {\n                ActivityCompat.requestPermissions((Activity) context, new String[]{\n                        Manifest.permission.WRITE_EXTERNAL_STORAGE\n                }, 101);\n                Log.w(\"CONNECT_BT\", \"Missing WRITE_EXTERNAL_STORAGE permission.\");\n                return false;\n            }\n        }\n\n        if (btSocket != null &amp;&amp; btSocket.isConnected() &amp;&amp; outputStream != null) {\n            Log.d(\"CONNECT_BT\", \"Already connected to Bluetooth device.\");\n            return true;\n        }\n\n        Log.d(\"CONNECT_BT\", \"Fetching paired devices...\");\n        Set&lt;BluetoothDevice&gt; pairedDevices = bluetooth.getBondedDevices();\n\n        if (pairedDevices == null || pairedDevices.isEmpty()) {\n            Log.e(\"CONNECT_BT\", \"No paired Bluetooth devices found.\");\n            return false;\n        }\n\n        for (BluetoothDevice device : pairedDevices) {\n            String deviceBTName = device.getName();\n            String deviceBTAddress = device.getAddress();\n            Log.d(\"CONNECT_BT\", \"Trying device: \" + deviceBTName + \" [\" + deviceBTAddress + \"]\");\n\n            try {\n                UUID uuid = (device.getUuids() != null &amp;&amp; device.getUuids().length &gt; 0)\n                        ? device.getUuids()[0].getUuid()\n                        : UUID.fromString(\"00001101-0000-1000-8000-00805F9B34FB\");\n\n                Log.d(\"CONNECT_BT\", \"Using UUID: \" + uuid);\n\n                BluetoothSocket tmpSocket = device.createRfcommSocketToServiceRecord(uuid);\n                bluetooth.cancelDiscovery();\n\n                Thread connectThread = new Thread(() -&gt; {\n                    try {\n                        tmpSocket.connect();\n                    } catch (IOException e) {\n                        Log.e(\"CONNECT_BT_FAILED\", \"Timeout or connection error on: \" + deviceBTName + \" - \" + e.getMessage());\n                    }\n                });\n\n                connectThread.start();\n                connectThread.join(2000);\n\n\n                if (!tmpSocket.isConnected()) {\n                    Log.w(\"CONNECT_BT\", \"Connection timeout for \" + deviceBTName);\n                    try {\n                        tmpSocket.close();\n                    } catch (IOException e) {\n                        Log.e(\"CONNECT_BT\", \"Error closing socket after timeout: \" + e.getMessage());\n                    }\n                    continue;\n                }\n\n                OutputStream tmpOutput = tmpSocket.getOutputStream();\n                if (tmpOutput != null) {\n                    btSocket = tmpSocket;\n                    outputStream = tmpOutput;\n                    m_activeDeviceAddr = deviceBTAddress;\n                    printstatus = \"Connected to \" + deviceBTName + \" and ready to print.\";\n                    Log.i(\"CONNECT_BT_SUCCESS\", printstatus);\n                    return true;\n                }\n\n            } catch (Exception e) {\n                Log.e(\"CONNECT_BT_FAILED\", \"Unexpected error with \" + deviceBTName + \": \" + e.getMessage());\n            }\n        }\n\n        Log.e(\"CONNECT_BT\", \"‚ùå Could not connect to any paired Bluetooth device.\");\n        printstatus = \"No available Bluetooth printer.\";\n        return false;\n    }</code></pre>\n</div>\n</div>\n</p>\n<p>i have this connectBT method where i always use to try to connect before printing the reciept</p>\n<pre><code>    if (btHelper.connectBT(context)) {\n            printReceipt(context, orderId, amountPaid, totalAmountChange);\n        }\n</code></pre>\n<p>however sometimes if the app is on standby or the printer was left for maybe 2 to 5 min i have to restart it again so that i can print out it again...</p>\n<p>are they any methods to continuously OPEN the connection to my printer so that i can always print receipts even if i have left it for sometime?</p>\n<p>PS: the printer is Thermal based printer mobile carry</p>\n",
    "tags" : [ "java", "android", "performance", "thermal-printer" ],
    "owner" : {
      "account_id" : 32070083,
      "reputation" : 31,
      "user_id" : 24873433,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2b5f5ed65d9a5a085bb621573627bcf1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Kurt Bernstein Blancia",
      "link" : "https://stackoverflow.com/users/24873433/kurt-bernstein-blancia"
    },
    "is_answered" : false,
    "view_count" : 80,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1747791897,
    "creation_date" : 1747791897,
    "link" : "https://stackoverflow.com/questions/79631389/how-to-make-my-bluetooth-printer-connected-always-to-my-android-java-application",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140452008,
    "post_id" : 79631389,
    "body" : "Since Bluetooth-connected printers are likely to be mobile printers in most cases, wouldn&#39;t it be normal to communicate only when necessary to save power (open when you want to print, close when printing is done)? It seems that what you want to do goes against the characteristics of the device.",
    "score" : 1,
    "owner" : {
      "account_id" : 12359629,
      "reputation" : 4400,
      "user_id" : 9014308,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/240981a43e5c9f40bdcff3de43505093?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "kunif",
      "link" : "https://stackoverflow.com/users/9014308/kunif"
    },
    "creation_date" : 1747990138,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}