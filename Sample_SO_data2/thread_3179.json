{
  "question" : {
    "question_id" : 79568898,
    "title" : "Communications link failure when trying to connect Wildfly Docker Container to MySQL Docker Container",
    "body" : "<h2>Context</h2>\n<p>I'm trying to containerize my jakarta EE application. But I'm having issues connecting to the database container from the container that my wildfly server is running on.</p>\n<p>The application consists of:</p>\n<ul>\n<li>a Wildfly server with jakarta ws.rest-services with hibernate dao pattern</li>\n<li>a MySQL relational database</li>\n<li>an Angular frontend app that fetches from backend endpoints</li>\n</ul>\n<p>Everything works locally. And I have managed to containerize the frontend and database without issues. I have even tested to deploy my wildfly server locally (through intelliJ war:exploded) and connect to the frontend and database containers, and that works ok.</p>\n<h2>Problem</h2>\n<p>When I try to containerize my wildfly server and start it up it fails with a long list of errors including:</p>\n<ul>\n<li>jdbc.exceptions.CommunicationsException: Communications link failure</li>\n<li>Unable to determine Dialect without JDBC metadata</li>\n</ul>\n<h2>Steps taken to containerize Wildfly</h2>\n<p><strong>Step 1: Created Dockerfile:</strong></p>\n<pre><code>FROM quay.io/wildfly/wildfly\n\nCOPY ./wildfly-config/com /opt/jboss/wildfly/modules/com\n\nCOPY ./wildfly-config/config-script.cli /opt/jboss/config-script.cli\n\nCOPY ./wildfly-config/logging-script.cli /opt/jboss/logging-script.cli\n\nRUN /opt/jboss/wildfly/bin/jboss-cli.sh --file=/opt/jboss/logging-script.cli\n\nRUN /opt/jboss/wildfly/bin/jboss-cli.sh --file=/opt/jboss/config-script.cli\n\nRUN rm -Rf /opt/jboss/wildfly/standalone/configuration/standalone_xml_history/*\n\nRUN /opt/jboss/wildfly/bin/add-user.sh admin test1234\n\nWORKDIR /opt/jboss/wildfly/standalone/deployments\n\nCOPY ./target/SusFund-1.0-SNAPSHOT.war ./SusFund-1.0-SNAPSHOT.war\n\nCMD [&quot;/opt/jboss/wildfly/bin/standalone.sh&quot;, &quot;-b&quot;, &quot;0.0.0.0&quot;, &quot;-bmanagement&quot;, &quot;0.0.0.0&quot;, &quot;--debug&quot;]\n</code></pre>\n<p>(Note: ./wildfly-config/com contains com/mysql/main/module.xml and mysql-connector-j-9.2.0.jar)</p>\n<p><strong>Step 2: Added config-script.cli to modify standalone.xml</strong></p>\n<pre><code>embed-server --server-config=standalone.xml --std-out=echo\n\nbatch\n\n/subsystem=&quot;datasources&quot;/data-source=&quot;MySQLDS&quot;:add(\\\n  connection-url=&quot;jdbc:mysql://db:7777/susfund_db&quot;, \\\n  driver-name=&quot;mysql&quot;, \\\n  enabled=&quot;true&quot;, \\\n  jndi-name=&quot;java:/jdbc/MySQLDataSource&quot;)\n\n/subsystem=&quot;datasources&quot;/jdbc-driver=&quot;mysql&quot;:add(\\\n    driver-name=&quot;mysql&quot;, \\\n    driver-module-name=&quot;com.mysql&quot;, \\\n    driver-class-name=&quot;com.mysql.cj.jdbc.Driver&quot;)\n\nrun-batch\n</code></pre>\n<p><strong>Step 3: Set root password in Database Dockerfile</strong></p>\n<pre><code>FROM mysql:latest\n\nENV MYSQL_ROOT_PASSWORD=test1234\n\nCOPY ./scripts/dbinit.sql /docker-entrypoint-initdb.d/\n</code></pre>\n<p><strong>Step 4: Setup persistence unit in persistence.xml so that it is coherent with standalone.xml after script is run:</strong></p>\n<pre><code> &lt;persistence-unit name=&quot;myUnit&quot; transaction-type=&quot;JTA&quot;&gt;\n        &lt;jta-data-source&gt;jdbc/MySQLDataSource&lt;/jta-data-source&gt;\n        &lt;properties&gt;\n            &lt;property name=&quot;hibernate.show_sql&quot; value=&quot;true&quot;/&gt;\n            &lt;property name=&quot;jakarta.persistence.jdbc.user&quot;   value=&quot;root&quot; /&gt;\n            &lt;property name=&quot;jakarta.persistence.jdbc.password&quot; value=&quot;test1234&quot; /&gt;\n        &lt;/properties&gt;\n    &lt;/persistence-unit&gt;\n</code></pre>\n<p><strong>Step 5: Create docker-compose.yml file with same network so that i can use &quot;db:7777&quot; name in connection-url in standalone.xml</strong></p>\n<pre><code>services:\n  susfund-fe:\n    container_name: susfund-fe\n    build:\n      context: .\n      dockerfile: Dockerfile.frontend\n    ports:\n      - &quot;4200:4200&quot;\n    networks:\n      - susfund\n\n  db:\n    container_name: susfund-db\n    build:\n      context: .\n      dockerfile: Dockerfile.db\n    ports:\n     - &quot;7777:3306&quot;\n    networks:\n      - susfund\n\n  wildfly:\n    container_name: susfund-wildfly\n    build:\n      context: .\n      dockerfile: Dockerfile\n    ports:\n      - &quot;8080:8080&quot;\n      - &quot;9990:9990&quot;\n    networks:\n      - susfund\n    depends_on:\n      - db\n\nnetworks:\n  susfund:\n</code></pre>\n<h2>Maven project structure:</h2>\n<pre><code>susfund-backend\n  --java \n     --org.andreasoo.susfund....\n\n  --resources\n     --META-INF\n       --beans.xml\n       --persistence.xml\n</code></pre>\n<p><strong>After mvn clean install:</strong></p>\n<pre><code>target\n  --classes\n  --maven-archiver\n  --SusFund-1.0-SNAPSHOT\n    --META-INF (empty)\n    --WEB-INF\n      --classes\n         --META-INF\n            --beans.xml\n            --persistence.xml\n         --org.andreasoo.susfund....\n</code></pre>\n<p><strong>I'm not sure why there are two META-INF (och which one is empty) in the SusFund folder</strong></p>\n<h2>pom.xml</h2>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;\n         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n\n    &lt;groupId&gt;org.andreasoo&lt;/groupId&gt;\n    &lt;artifactId&gt;SusFund&lt;/artifactId&gt;\n    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n    &lt;name&gt;SusFund&lt;/name&gt;\n    &lt;packaging&gt;war&lt;/packaging&gt;\n\n    &lt;properties&gt;\n        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;\n        &lt;maven.compiler.target&gt;21&lt;/maven.compiler.target&gt;\n        &lt;maven.compiler.source&gt;21&lt;/maven.compiler.source&gt;\n        &lt;junit.version&gt;5.11.0&lt;/junit.version&gt;\n    &lt;/properties&gt;\n\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;jakarta.enterprise&lt;/groupId&gt;\n            &lt;artifactId&gt;jakarta.enterprise.cdi-api&lt;/artifactId&gt;\n            &lt;version&gt;4.1.0&lt;/version&gt;\n            &lt;scope&gt;provided&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;jakarta.ejb&lt;/groupId&gt;\n            &lt;artifactId&gt;jakarta.ejb-api&lt;/artifactId&gt;\n            &lt;version&gt;4.0.1&lt;/version&gt;\n            &lt;scope&gt;provided&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;mysql&lt;/groupId&gt;\n            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;\n            &lt;version&gt;8.0.32&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;jakarta.persistence&lt;/groupId&gt;\n            &lt;artifactId&gt;jakarta.persistence-api&lt;/artifactId&gt;\n            &lt;version&gt;3.2.0&lt;/version&gt;\n            &lt;scope&gt;provided&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;jakarta.ws.rs&lt;/groupId&gt;\n            &lt;artifactId&gt;jakarta.ws.rs-api&lt;/artifactId&gt;\n            &lt;version&gt;4.0.0&lt;/version&gt;\n            &lt;scope&gt;provided&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;jakarta.servlet&lt;/groupId&gt;\n            &lt;artifactId&gt;jakarta.servlet-api&lt;/artifactId&gt;\n            &lt;version&gt;6.1.0&lt;/version&gt;\n            &lt;scope&gt;provided&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;\n            &lt;artifactId&gt;junit-jupiter-api&lt;/artifactId&gt;\n            &lt;version&gt;${junit.version}&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;\n            &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;\n            &lt;version&gt;${junit.version}&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n\n    &lt;build&gt;\n        &lt;resources&gt;\n            &lt;resource&gt;\n                &lt;directory&gt;susfund-backend/main/java&lt;/directory&gt;\n            &lt;/resource&gt;\n            &lt;resource&gt;\n                &lt;directory&gt;susfund-backend/main/resources&lt;/directory&gt;\n            &lt;/resource&gt;\n        &lt;/resources&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;\n                &lt;version&gt;3.4.0&lt;/version&gt;\n                &lt;configuration&gt;\n                    &lt;failOnMissingWebXml&gt;false&lt;/failOnMissingWebXml&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n&lt;/project&gt;\n</code></pre>\n<h2>UPDATED WITH ERROR LOGS AFTER CHANGING PORT TO 3306 IN SCRIPT</h2>\n<pre><code>&lt;snip&gt;\n18:14:02,508 ERROR [org.hibernate.engine.jdbc.spi.SqlExceptionHelper] (ServerService Thread Pool -- 78) jakarta.resource.ResourceException: IJ000453: Unable to get managed connection for java:/jdbc/MySQLDataSource\n&lt;snip&gt;\n\n\nThe last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.\n        at java.base/jdk.internal.reflect.DirectConstructorHandleAccessor.newInstance(DirectConstructorHandleAccessor.java:62)\n        at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:502)\n        at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:486)\n        at com.mysql@9.2.0//com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:52)\n        at com.mysql@9.2.0//com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:95)\n        at com.mysql@9.2.0//com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:140)\n        at com.mysql@9.2.0//com.mysql.cj.exceptions.ExceptionFactory.createCommunicationsException(ExceptionFactory.java:156)\n        at com.mysql@9.2.0//com.mysql.cj.protocol.a.NativeSocketConnection.connect(NativeSocketConnection.java:79)\n        at com.mysql@9.2.0//com.mysql.cj.NativeSession.connect(NativeSession.java:142)\n        at com.mysql@9.2.0//com.mysql.cj.jdbc.ConnectionImpl.connectOneTryOnly(ConnectionImpl.java:961)\n        at com.mysql@9.2.0//com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:825)\n        ... 56 more\nCaused by: java.net.ConnectException: Connection refused\n        at java.base/sun.nio.ch.Net.connect0(Native Method)\n        at java.base/sun.nio.ch.Net.connect(Net.java:589)\n        at java.base/sun.nio.ch.Net.connect(Net.java:578)\n        at java.base/sun.nio.ch.NioSocketImpl.connect(NioSocketImpl.java:583)\n        at java.base/java.net.SocksSocketImpl.connect(SocksSocketImpl.java:327)\n        at java.base/java.net.Socket.connect(Socket.java:751)\n        at com.mysql@9.2.0//com.mysql.cj.protocol.StandardSocketFactory.connect(StandardSocketFactory.java:144)\n        at com.mysql@9.2.0//com.mysql.cj.protocol.a.NativeSocketConnection.connect(NativeSocketConnection.java:53)\n        ... 59 more\n\n18:14:02,511 ERROR [org.jboss.msc.service.fail] (ServerService Thread Pool -- 78) MSC000001: Failed to start service jboss.persistenceunit.&quot;SusFund-1.0-SNAPSHOT.war#myUnit&quot;.__FIRST_PHASE__: org.jboss.msc.service.StartException in service jboss.persistenceunit.&quot;SusFund-1.0-SNAPSHOT.war#myUnit&quot;.__FIRST_PHASE__: org.hibernate.service.spi.ServiceException: Unable to create requested service [org.hibernate.engine.jdbc.env.spi.JdbcEnvironment] due to: Unable to determine Dialect without JDBC metadata (please set 'jakarta.persistence.jdbc.url' for common cases or 'hibernate.dialect' when a custom Dialect implementation must be provided)\n        at org.jboss.as.jpa@36.0.0.Final//org.jboss.as.jpa.service.PhaseOnePersistenceUnitServiceImpl$1$1.run(PhaseOnePersistenceUnitServiceImpl.java:113)\n        at org.jboss.as.jpa@36.0.0.Final//org.jboss.as.jpa.service.PhaseOnePersistenceUnitServiceImpl$1$1.run(PhaseOnePersistenceUnitServiceImpl.java:89)\n        at java.base/java.security.AccessController.doPrivileged(AccessController.java:400)\n        at org.wildfly.security.elytron-base@2.6.2.Final//org.wildfly.security.manager.WildFlySecurityManager.doChecked(WildFlySecurityManager.java:664)\n        at org.jboss.as.jpa@36.0.0.Final//org.jboss.as.jpa.service.PhaseOnePersistenceUnitServiceImpl$1.run(PhaseOnePersistenceUnitServiceImpl.java:122)\n        at org.jboss.threads@2.4.0.Final//org.jboss.threads.ContextClassLoaderSavingRunnable.run(ContextClassLoaderSavingRunnable.java:35)\n        at org.jboss.threads@2.4.0.Final//org.jboss.threads.EnhancedQueueExecutor.safeRun(EnhancedQueueExecutor.java:1990)\n        at org.jboss.threads@2.4.0.Final//org.jboss.threads.EnhancedQueueExecutor$ThreadBody.doRunTask(EnhancedQueueExecutor.java:1486)\n        at org.jboss.threads@2.4.0.Final//org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1377)\n        at java.base/java.lang.Thread.run(Thread.java:1583)\n        at org.jboss.threads@2.4.0.Final//org.jboss.threads.JBossThread.run(JBossThread.java:513)\nCaused by: org.hibernate.service.spi.ServiceException: Unable to create requested service [org.hibernate.engine.jdbc.env.spi.JdbcEnvironment] due to: Unable to determine Dialect without JDBC metadata (please set 'jakarta.persistence.jdbc.url' for common cases or 'hibernate.dialect' when a custom Dialect implementation must be provided)\n        at org.hibernate@6.6.7.Final//org.hibernate.service.internal.AbstractServiceRegistryImpl.createService(AbstractServiceRegistryImpl.java:276)\n        at org.hibernate@6.6.7.Final//org.hibernate.service.internal.AbstractServiceRegistryImpl.initializeService(AbstractServiceRegistryImpl.java:238)\n        at org.hibernate@6.6.7.Final//org.hibernate.service.internal.AbstractServiceRegistryImpl.getService(AbstractServiceRegistryImpl.java:215)\n        at org.hibernate@6.6.7.Final//org.hibernate.service.ServiceRegistry.requireService(ServiceRegistry.java:68)\n        at org.hibernate@6.6.7.Final//org.hibernate.engine.jdbc.internal.JdbcServicesImpl.configure(JdbcServicesImpl.java:52)\n        at org.hibernate@6.6.7.Final//org.hibernate.boot.registry.internal.StandardServiceRegistryImpl.configureService(StandardServiceRegistryImpl.java:136)\n        at org.hibernate@6.6.7.Final//org.hibernate.service.internal.AbstractServiceRegistryImpl.initializeService(AbstractServiceRegistryImpl.java:247)\n        at org.hibernate@6.6.7.Final//org.hibernate.service.internal.AbstractServiceRegistryImpl.getService(AbstractServiceRegistryImpl.java:215)\n        at org.hibernate@6.6.7.Final//org.hibernate.service.ServiceRegistry.requireService(ServiceRegistry.java:68)\n        at org.hibernate@6.6.7.Final//org.hibernate.boot.internal.MetadataBuilderImpl.resolveWrapperArrayHandling(MetadataBuilderImpl.java:1024)\n        at org.hibernate@6.6.7.Final//org.hibernate.boot.internal.MetadataBuilderImpl$MetadataBuildingOptionsImpl.&lt;init&gt;(MetadataBuilderImpl.java:629)\n        at org.hibernate@6.6.7.Final//org.hibernate.boot.internal.MetadataBuilderImpl.&lt;init&gt;(MetadataBuilderImpl.java:139)\n        at org.hibernate@6.6.7.Final//org.hibernate.boot.MetadataSources.getMetadataBuilder(MetadataSources.java:164)\n        at org.hibernate@6.6.7.Final//org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.&lt;init&gt;(EntityManagerFactoryBuilderImpl.java:278)\n        at org.hibernate@6.6.7.Final//org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.&lt;init&gt;(EntityManagerFactoryBuilderImpl.java:199)\n        at org.hibernate@6.6.7.Final//org.hibernate.jpa.boot.spi.Bootstrap.getEntityManagerFactoryBuilder(Bootstrap.java:35)\n        at org.hibernate@6.6.7.Final//org.hibernate.jpa.boot.spi.Bootstrap.getEntityManagerFactoryBuilder(Bootstrap.java:102)\n        at org.hibernate.jipijapa-hibernate@36.0.0.Final//org.jboss.as.jpa.hibernate.TwoPhaseBootstrapImpl.&lt;init&gt;(TwoPhaseBootstrapImpl.java:27)\n        at org.hibernate.jipijapa-hibernate@36.0.0.Final//org.jboss.as.jpa.hibernate.HibernatePersistenceProviderAdaptor.getBootstrap(HibernatePersistenceProviderAdaptor.java:220)\n        at org.jboss.as.jpa@36.0.0.Final//org.jboss.as.jpa.service.PhaseOnePersistenceUnitServiceImpl.createContainerEntityManagerFactoryBuilder(PhaseOnePersistenceUnitServiceImpl.java:239)\n        at org.jboss.as.jpa@36.0.0.Final//org.jboss.as.jpa.service.PhaseOnePersistenceUnitServiceImpl$1$1.run(PhaseOnePersistenceUnitServiceImpl.java:110)\n        ... 10 more\nCaused by: org.hibernate.HibernateException: Unable to determine Dialect without JDBC metadata (please set 'jakarta.persistence.jdbc.url' for common cases or 'hibernate.dialect' when a custom Dialect implementation must be provided)\n        at org.hibernate@6.6.7.Final//org.hibernate.engine.jdbc.dialect.internal.DialectFactoryImpl.determineDialect(DialectFactoryImpl.java:191)\n        at org.hibernate@6.6.7.Final//org.hibernate.engine.jdbc.dialect.internal.DialectFactoryImpl.buildDialect(DialectFactoryImpl.java:87)\n        at org.hibernate@6.6.7.Final//org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.getJdbcEnvironmentWithDefaults(JdbcEnvironmentInitiator.java:181)\n        at org.hibernate@6.6.7.Final//org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.getJdbcEnvironmentUsingJdbcMetadata(JdbcEnvironmentInitiator.java:392)\n        at org.hibernate@6.6.7.Final//org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.initiateService(JdbcEnvironmentInitiator.java:129)\n        at org.hibernate@6.6.7.Final//org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.initiateService(JdbcEnvironmentInitiator.java:81)\n        at org.hibernate@6.6.7.Final//org.hibernate.boot.registry.internal.StandardServiceRegistryImpl.initiateService(StandardServiceRegistryImpl.java:130)\n        at org.hibernate@6.6.7.Final//org.hibernate.service.internal.AbstractServiceRegistryImpl.createService(AbstractServiceRegistryImpl.java:263)\n        ... 30 more\n\n18:14:02,515 ERROR [org.jboss.as.controller.management-operation] (Controller Boot Thread) WFLYCTL0013: Operation (&quot;deploy&quot;) failed - address: ([(&quot;deployment&quot; =&gt; &quot;SusFund-1.0-SNAPSHOT.war&quot;)]) - failure description: {&quot;WFLYCTL0080: Failed services&quot; =&gt; {&quot;jboss.persistenceunit.\\&quot;SusFund-1.0-SNAPSHOT.war#myUnit\\&quot;.__FIRST_PHASE__&quot; =&gt; &quot;org.hibernate.service.spi.ServiceException: Unable to create requested service [org.hibernate.engine.jdbc.env.spi.JdbcEnvironment] due to: Unable to determine Dialect without JDBC metadata (please set 'jakarta.persistence.jdbc.url' for common cases or 'hibernate.dialect' when a custom Dialect implementation must be provided)\n    Caused by: org.hibernate.service.spi.ServiceException: Unable to create requested service [org.hibernate.engine.jdbc.env.spi.JdbcEnvironment] due to: Unable to determine Dialect without JDBC metadata (please set 'jakarta.persistence.jdbc.url' for common cases or 'hibernate.dialect' when a custom Dialect implementation must be provided)\n    Caused by: org.hibernate.HibernateException: Unable to determine Dialect without JDBC metadata (please set 'jakarta.persistence.jdbc.url' for common cases or 'hibernate.dialect' when a custom Dialect implementation must be provided)&quot;}}\n18:14:02,644 INFO  [org.jboss.as.server] (ServerService Thread Pool -- 45) WFLYSRV0010: Deployed &quot;SusFund-1.0-SNAPSHOT.war&quot; (runtime-name : &quot;SusFund-1.0-SNAPSHOT.war&quot;)\n18:14:02,649 INFO  [org.jboss.as.controller] (Controller Boot Thread) WFLYCTL0183: Service status report\nWFLYCTL0186:   Services which failed to start:      service jboss.persistenceunit.&quot;SusFund-1.0-SNAPSHOT.war#myUnit&quot;.__FIRST_PHASE__: org.hibernate.service.spi.ServiceException: Unable to create requested service [org.hibernate.engine.jdbc.env.spi.JdbcEnvironment] due to: Unable to determine Dialect without JDBC metadata (please set 'jakarta.persistence.jdbc.url' for common cases or 'hibernate.dialect' when a custom Dialect implementation must be provided)\n\n</code></pre>\n<p><strong>After copying .war file to .war.dodeploy in /deployments the server logs say this:</strong></p>\n<pre><code>18:16:22,997 INFO  [org.jboss.as.connector.deployers.jdbc] (MSC service thread 1-8) WFLYJCA0019: Stopped Driver service with driver-name = SusFund-1.0-SNAPSHOT.war_com.mysql.cj.jdbc.Driver_8_0\n18:16:23,026 INFO  [org.jboss.as.clustering.infinispan] (ServerService Thread Pool -- 26) Stopped hibernate cache container\n18:16:23,028 INFO  [org.jboss.as.server.deployment] (MSC service thread 1-2) WFLYSRV0028: Stopped deployment SusFund-1.0-SNAPSHOT.war (runtime-name: SusFund-1.0-SNAPSHOT.war) in 33ms\n18:16:23,033 INFO  [org.jboss.as.server.deployment] (MSC service thread 1-2) WFLYSRV0027: Starting deployment of &quot;SusFund-1.0-SNAPSHOT.war&quot; (runtime-name: &quot;SusFund-1.0-SNAPSHOT.war&quot;)\n18:16:23,600 INFO  [org.jboss.as.jpa] (MSC service thread 1-3) WFLYJPA0002: Read persistence.xml for myUnit\n18:16:23,632 INFO  [org.jipijapa] (MSC service thread 1-4) JIPIORMV6020260: Second level cache enabled for SusFund-1.0-SNAPSHOT.war#myUnit\n18:16:23,636 INFO  [org.jboss.weld.deployer] (MSC service thread 1-2) WFLYWELD0003: Processing weld deployment SusFund-1.0-SNAPSHOT.war\n18:16:23,653 INFO  [org.infinispan.CONTAINER] (ServerService Thread Pool -- 26) ISPN000556: Starting user marshaller 'org.wildfly.clustering.cache.infinispan.marshalling.UserMarshaller'\n18:16:23,707 INFO  [org.jboss.as.clustering.infinispan] (ServerService Thread Pool -- 26) Started hibernate cache container\n18:16:23,713 INFO  [org.jboss.as.jpa] (ServerService Thread Pool -- 26) WFLYJPA0010: Starting Persistence Unit (phase 1 of 2) Service 'SusFund-1.0-SNAPSHOT.war#myUnit'\n18:16:23,714 INFO  [org.hibernate.jpa.internal.util.LogHelper] (ServerService Thread Pool -- 26) HHH000204: Processing PersistenceUnitInfo [name: myUnit]\n18:16:23,754 INFO  [org.jipijapa] (MSC service thread 1-3) JIPIORMV6020260: Second level cache enabled for SusFund-1.0-SNAPSHOT.war#myUnit\n18:16:23,783 INFO  [org.jboss.as.connector.deployers.jdbc] (MSC service thread 1-3) WFLYJCA0005: Deploying non-JDBC-compliant driver class com.mysql.cj.jdbc.Driver (version 8.0)\n18:16:23,846 INFO  [org.jboss.as.connector.deployers.jdbc] (MSC service thread 1-6) WFLYJCA0018: Started Driver service with driver-name = SusFund-1.0-SNAPSHOT.war_com.mysql.cj.jdbc.Driver_8_0\n18:16:24,122 INFO  [org.hibernate.orm.connections.pooling] (ServerService Thread Pool -- 26) HHH10001005: Database info:\n        Database JDBC URL [Connecting through datasource 'org.jboss.as.connector.subsystems.datasources.WildFlyDataSource@6c65ccee']\n        Database driver: undefined/unknown\n        Database version: 9.2\n        Autocommit mode: undefined/unknown\n        Isolation level: undefined/unknown\n        Minimum pool size: undefined/unknown\n        Maximum pool size: undefined/unknown\n18:16:24,131 INFO  [org.hibernate.cache.internal.RegionFactoryInitiator] (ServerService Thread Pool -- 26) HHH000025: Second-level cache region factory [org.infinispan.hibernate.cache.v62.InfinispanRegionFactory]\n18:16:24,226 INFO  [org.hibernate.envers.boot.internal.EnversServiceImpl] (ServerService Thread Pool -- 26) Envers integration enabled? : true\n18:16:24,458 INFO  [org.jboss.as.jpa] (ServerService Thread Pool -- 26) WFLYJPA0010: Starting Persistence Unit (phase 2 of 2) Service 'SusFund-1.0-SNAPSHOT.war#myUnit'\n18:16:25,486 INFO  [org.wildfly.extension.undertow] (ServerService Thread Pool -- 83) WFLYUT0021: Registered web context: '/SusFund-1.0-SNAPSHOT' for server 'default-server'\n18:16:25,544 INFO  [org.jboss.as.server] (DeploymentScanner-threads - 2) WFLYSRV0016: Replaced deployment &quot;SusFund-1.0-SNAPSHOT.war&quot; with deployment &quot;SusFund-1.0-SNAPSHOT.war&quot;\n18:16:25,545 INFO  [org.jboss.as.controller] (DeploymentScanner-threads - 2) WFLYCTL0183: Service status report\nWFLYCTL0185:    Newly corrected services:\n      service jboss.deployment.unit.&quot;SusFund-1.0-SNAPSHOT.war&quot;.WeldStartService (new available)\n      service jboss.deployment.unit.&quot;SusFund-1.0-SNAPSHOT.war&quot;.component.&quot;jakarta.servlet.jsp.jstl.tlv.PermittedTaglibsTLV&quot;.START (new available)\n      service jboss.deployment.unit.&quot;SusFund-1.0-SNAPSHOT.war&quot;.component.&quot;jakarta.servlet.jsp.jstl.tlv.PermittedTaglibsTLV&quot;.WeldInstantiator (new available)\n      service jboss.deployment.unit.&quot;SusFund-1.0-SNAPSHOT.war&quot;.component.&quot;jakarta.servlet.jsp.jstl.tlv.ScriptFreeTLV&quot;.START (new available)\n      service jboss.deployment.unit.&quot;SusFund-1.0-SNAPSHOT.war&quot;.component.&quot;jakarta.servlet.jsp.jstl.tlv.ScriptFreeTLV&quot;.WeldInstantiator (new available)\n      service jboss.deployment.unit.&quot;SusFund-1.0-SNAPSHOT.war&quot;.component.&quot;org.jboss.weld.module.web.servlet.WeldInitialListener&quot;.START (new available)\n      service jboss.deployment.unit.&quot;SusFund-1.0-SNAPSHOT.war&quot;.component.&quot;org.jboss.weld.module.web.servlet.WeldInitialListener&quot;.WeldInstantiator (new available)\n      service jboss.deployment.unit.&quot;SusFund-1.0-SNAPSHOT.war&quot;.component.&quot;org.jboss.weld.module.web.servlet.WeldTerminalListener&quot;.START (new available)\n      service jboss.deployment.unit.&quot;SusFund-1.0-SNAPSHOT.war&quot;.component.&quot;org.jboss.weld.module.web.servlet.WeldTerminalListener&quot;.WeldInstantiator (new available)\n      service jboss.deployment.unit.&quot;SusFund-1.0-SNAPSHOT.war&quot;.deploymentCompleteService (new available)\n      service jboss.deployment.unit.&quot;SusFund-1.0-SNAPSHOT.war&quot;.ee.ComponentRegistry (new available)\n      service jboss.deployment.unit.&quot;SusFund-1.0-SNAPSHOT.war&quot;.undertow-deployment (new available)\n      service jboss.deployment.unit.&quot;SusFund-1.0-SNAPSHOT.war&quot;.undertow-deployment.UndertowDeploymentInfoService (new available)\n      service jboss.deployment.unit.&quot;SusFund-1.0-SNAPSHOT.war&quot;.weld.weldClassIntrospector (new available)\n      service jboss.persistenceunit.&quot;SusFund-1.0-SNAPSHOT.war#myUnit&quot; (new available)\n\n</code></pre>\n<p>The above logs make it seem like the war files have been deployed successfully. And they even say war.deployed in the deployments folder. But when I try to access endpoints from localhost:8080\nfrom dockerhost it gives me 404 response.</p>\n",
    "tags" : [ "java", "docker", "hibernate", "maven", "wildfly" ],
    "owner" : {
      "account_id" : 41340704,
      "reputation" : 1,
      "user_id" : 30244094,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/cf0032e259ed90dbd34420a110c3c2be?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "user30244094",
      "link" : "https://stackoverflow.com/users/30244094/user30244094"
    },
    "is_answered" : true,
    "view_count" : 161,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1744483655,
    "creation_date" : 1744376455,
    "link" : "https://stackoverflow.com/questions/79568898/communications-link-failure-when-trying-to-connect-wildfly-docker-container-to-m",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79569169,
    "question_id" : 79568898,
    "body" : "<p>You are using port 7777, which is mapped externally (via Docker's ports), but containers in the same Docker network should use the internal port, which for MySQL is 3306.</p>\n<p>Change the JDBC URL in your config-script.cli to:</p>\n<pre><code>connection-url=&quot;jdbc:mysql://db:3306/susfund_db&quot;\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 7645025,
      "reputation" : 440,
      "user_id" : 5795975,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-6KwPUS4RnyA/AAAAAAAAAAI/AAAAAAAAC8w/auZqreI45x0/s256-rj/photo.jpg",
      "display_name" : "Vijay",
      "link" : "https://stackoverflow.com/users/5795975/vijay"
    },
    "creation_date" : 1744384000,
    "last_activity_date" : 1744384000,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79570384,
    "question_id" : 79568898,
    "body" : "<h2>Found the solution to Connection issues and 404</h2>\n<p><strong>The database didn't have time too boot up before my wildfly container started to attempt establish connection. I still got 404 responses from the endpoints but that was due to the maven plugin conflicting with my folder setup and specific build resources in the pom.xml.</strong></p>\n<p>I had to add health checks in the db and depends on service_healthy condition in wildfly. As follows:</p>\n<pre><code>services:\n  susfund-fe:\n    container_name: susfund-fe\n    build:\n      context: .\n      dockerfile: Dockerfile.frontend\n    ports:\n      - &quot;4200:4200&quot;\n    networks:\n      - susfund\n\n  db:\n    container_name: susfund-db\n    build:\n      context: .\n      dockerfile: Dockerfile.db\n    ports:\n     - &quot;7777:3306&quot;\n    networks:\n      - susfund\n    healthcheck:\n      test: [ &quot;CMD&quot;, &quot;mysqladmin&quot;, &quot;ping&quot;, &quot;-h&quot;, &quot;localhost&quot;, &quot;-u&quot;, &quot;root&quot;, &quot;-ptest1234&quot; ]\n      interval: 5s\n      timeout: 5s\n      retries: 100\n\n  wildfly:\n    container_name: susfund-wildfly\n    build:\n      context: .\n      dockerfile: Dockerfile\n    ports:\n      - &quot;8080:8080&quot;\n      - &quot;9990:9990&quot;\n    networks:\n      - susfund\n    depends_on:\n       db:\n        condition: service_healthy\n\nnetworks:\n  susfund: \n</code></pre>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 41340704,
      "reputation" : 1,
      "user_id" : 30244094,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/cf0032e259ed90dbd34420a110c3c2be?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "user30244094",
      "link" : "https://stackoverflow.com/users/30244094/user30244094"
    },
    "creation_date" : 1744456833,
    "last_activity_date" : 1744483655,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79569169" : [ {
      "comment_id" : 140330614,
      "post_id" : 79569169,
      "body" : "Thank you. I wrote in the answer section above that I found the solution. The problem was that my war file wasn&#39;t building correctly due to the project structure being incorrect. Now everything is working. Thank you for all your assistance!",
      "score" : 0,
      "owner" : {
        "account_id" : 41340704,
        "reputation" : 1,
        "user_id" : 30244094,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/cf0032e259ed90dbd34420a110c3c2be?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "user30244094",
        "link" : "https://stackoverflow.com/users/30244094/user30244094"
      },
      "creation_date" : 1744568714,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140328263,
      "post_id" : 79569169,
      "body" : "Make sure thereâ€™s an @ApplicationPath annotated class like: @ApplicationPath(&quot;/&quot;) and Check the code if endpoint is properly annotated like &quot;@Path(&quot;/your-endpoint&quot;)&quot; and with simple GET method with no additional mapping, then it should work with below url. <a href=\"http://localhost:8080/SusFund-1.0-SNAPSHOT/your-endpoint\" rel=\"nofollow noreferrer\">localhost:8080/SusFund-1.0-SNAPSHOT/your-endpoint</a>",
      "score" : 0,
      "owner" : {
        "account_id" : 7645025,
        "reputation" : 440,
        "user_id" : 5795975,
        "user_type" : "registered",
        "profile_image" : "https://lh6.googleusercontent.com/-6KwPUS4RnyA/AAAAAAAAAAI/AAAAAAAAC8w/auZqreI45x0/s256-rj/photo.jpg",
        "display_name" : "Vijay",
        "link" : "https://stackoverflow.com/users/5795975/vijay"
      },
      "creation_date" : 1744479628,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140327368,
      "post_id" : 79569169,
      "body" : "Thanks for the reply. I&#39;ve been using localhost:8080/SusFund-1.0-SNAPSHOT/your-endpoint and I don&#39;t have a jboss-web.xml so the path should be the same as the project war file.  I can confirm this in the server logs by the follinging INFO log: Registered web context: &#39;/SusFund-1.0-SNAPSHOT&#39; for server &#39;default-server&#39;",
      "score" : 0,
      "owner" : {
        "account_id" : 41340704,
        "reputation" : 1,
        "user_id" : 30244094,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/cf0032e259ed90dbd34420a110c3c2be?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "user30244094",
        "link" : "https://stackoverflow.com/users/30244094/user30244094"
      },
      "creation_date" : 1744453773,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140326733,
      "post_id" : 79569169,
      "body" : "Your endpoints are probably mapped under: localhost:8080/SusFund-1.0-SNAPSHOT/your-endpoint But you&#39;re likely trying: localhost:8080/your-endpoint you can update the context path in your jboss-web.xml.",
      "score" : 0,
      "owner" : {
        "account_id" : 7645025,
        "reputation" : 440,
        "user_id" : 5795975,
        "user_type" : "registered",
        "profile_image" : "https://lh6.googleusercontent.com/-6KwPUS4RnyA/AAAAAAAAAAI/AAAAAAAAC8w/auZqreI45x0/s256-rj/photo.jpg",
        "display_name" : "Vijay",
        "link" : "https://stackoverflow.com/users/5795975/vijay"
      },
      "creation_date" : 1744420443,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140325805,
      "post_id" : 79569169,
      "body" : "Ah thank you. I added the stacktrace to the question, along with the server logs after the dodeploy copy in standalone/deployments folder inside the container.",
      "score" : 0,
      "owner" : {
        "account_id" : 41340704,
        "reputation" : 1,
        "user_id" : 30244094,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/cf0032e259ed90dbd34420a110c3c2be?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "user30244094",
        "link" : "https://stackoverflow.com/users/30244094/user30244094"
      },
      "creation_date" : 1744395741,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140325576,
      "post_id" : 79569169,
      "body" : "The isseu you mentioned about the connectivity with mysql, now whats the error, can you update the question with details, stacktrace if possible. 404 is soemthing related to wrong endpoint access.",
      "score" : 0,
      "owner" : {
        "account_id" : 7645025,
        "reputation" : 440,
        "user_id" : 5795975,
        "user_type" : "registered",
        "profile_image" : "https://lh6.googleusercontent.com/-6KwPUS4RnyA/AAAAAAAAAAI/AAAAAAAAC8w/auZqreI45x0/s256-rj/photo.jpg",
        "display_name" : "Vijay",
        "link" : "https://stackoverflow.com/users/5795975/vijay"
      },
      "creation_date" : 1744392010,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140325479,
      "post_id" : 79569169,
      "body" : "I just tried this and unfortunately the error remains at startup.   I verified that the script worked by executing bin/bash in the container and doing cat standalone.xml. In there it looked like this: connection-url=&quot;jdbc:mysql://db:3306/susfund_db&quot;  I tried to redeploy the war file by doing copying it in deployments with the dodeploy suffix. Then it could read the persistence.xml without crashing, but the endpoints still yield 404,",
      "score" : 0,
      "owner" : {
        "account_id" : 41340704,
        "reputation" : 1,
        "user_id" : 30244094,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/cf0032e259ed90dbd34420a110c3c2be?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "user30244094",
        "link" : "https://stackoverflow.com/users/30244094/user30244094"
      },
      "creation_date" : 1744390549,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}