{
  "question" : {
    "question_id" : 79846766,
    "title" : "Link in HTML file in AlertDialog isn&#39;t clickable",
    "body" : "<p>I'm trying to load an HTML file in an AlertDialog and have links clickable and have dialog properly formatted with padding.</p>\n<p>The following code shows the dialog box, but the link is not clickable.</p>\n<pre><code>public void showNews(int number) {\n  int last = shared.getInt(&quot;news&quot;, 1);\n  Log.d(&quot;News&quot;, String.valueOf(last));\n\n  if (last &gt;= number) return;\n  AlertDialog.Builder builder = new AlertDialog.Builder(SearchActivity.this, R.style.darkAlertDialog); //, R.style.darkAlertDialog\n  builder.setTitle(&quot;Application News&quot;);\n\n  StringBuilder text = new StringBuilder();\n\n  BufferedReader reader = null;\n  try {\n    reader = new BufferedReader(\n    new InputStreamReader(getAssets().open(&quot;html/&quot; + &quot;news.html&quot;)));\n    String mLine;\n    while ((mLine = reader.readLine()) != null) {\n      text.append(mLine);\n      text.append('\\n');\n    }\n  } catch(IOException e) {\n    Toast.makeText(getApplicationContext(), &quot;Error reading file!&quot;, Toast.LENGTH_LONG).show();\n    e.printStackTrace();\n  } finally {\n    if (reader != null) {\n      try {\n        reader.close();\n      } catch(IOException e) {\n        Log.e(&quot;showNews&quot;, &quot;Error reading file&quot;);\n        return;\n      }\n    }\n  }\n\n  // Trouble\n  Spanned result;\n  if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) {\n    result = Html.fromHtml(text.toString(), Html.FROM_HTML_MODE_LEGACY);\n  } else {\n    result = Html.fromHtml(text.toString());\n  }\n  builder.setMessage(result);\n\n  //        result.setMovementMethod(LinkMovementMethod.getInstance());\n  //        result.setClickable(true);\n  // Trouble\n  builder.setPositiveButton(&quot;Okay&quot;, new DialogInterface.OnClickListener() {@Override\n    public void onClick(DialogInterface dialog, int which) {\n      //                prefs.putInt(&quot;news&quot;, number);\n      //                prefs.apply();\n      dialog.dismiss();\n    }\n  });\n\n  builder.create();\n  builder.show();\n}\n</code></pre>\n<p>The set movement and set clickable gives a syntax error</p>\n<p>If I replace the section between // Trouble, as suggested by <a href=\"https://stackoverflow.com/questions/14652894/using-html-in-android-alert-dialog#14652941\">Using HTML in Android Alert Dialog</a> with</p>\n<pre><code>TextView msg = new TextView(this);\nmsg.setText(Html.fromHtml(String.valueOf(text)));\nbuilder.setView(msg);\nmsg.setMovementMethod(LinkMovementMethod.getInstance());\nmsg.setClickable(true);\n</code></pre>\n<p>the link is clickable but there is no padding between the text and the dialog box.</p>\n<p><a href=\"https://i.sstatic.net/CbKUDjFr.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/CbKUDjFr.jpg\" alt=\"Example from the alternate code\" /></a></p>\n<p>I've also tried using a custom layout but it comes out empty, even though log files show that the text is there.</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;android.support.constraint.ConstraintLayout\n    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;\n    xmlns:tools=&quot;http://schemas.android.com/tools&quot;\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;&gt;\n    &lt;TextView\n        android:id=&quot;@+id/textNews&quot;\n        android:layout_width=&quot;0dp&quot;\n        android:layout_height=&quot;0dp&quot;\n        android:layout_marginStart=&quot;32dp&quot;\n        android:layout_marginTop=&quot;80dp&quot;\n        android:layout_marginEnd=&quot;32dp&quot;\n        android:layout_marginBottom=&quot;80dp&quot;\n        android:scrollbarAlwaysDrawVerticalTrack=&quot;true&quot;\n        android:textColor=&quot;@color/lightgray&quot;\n        android:visibility=&quot;visible&quot;\n        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;\n        app:layout_constraintEnd_toEndOf=&quot;parent&quot;\n        app:layout_constraintStart_toStartOf=&quot;parent&quot;\n        app:layout_constraintTop_toTopOf=&quot;parent&quot;\n        tools:text=&quot;TextNews&quot;\n        tools:visibility=&quot;visible&quot; /&gt;\n&lt;/android.support.constraint.ConstraintLayout&gt;\n</code></pre>\n<pre><code>Log.d(&quot;text&quot;, String.valueOf(text));\n\nAlertDialog.Builder builder = new AlertDialog.Builder(SearchActivity.this, R.style.darkAlertDialog); //, R.style.darkAlertDialog\nbuilder.setTitle(&quot;Application News&quot;);\n\nLayoutInflater inflater = this.getLayoutInflater();\nView dialogView = inflater.inflate(R.layout.app_news, null);\nfinal TextView appNews = dialogView.findViewById(R.id.textNews);\nappNews.setText(result);\nappNews.setMovementMethod(LinkMovementMethod.getInstance());\nappNews.setClickable(true);\n\nLog.d(&quot;msg&quot;, String.valueOf(appNews.getText()));\nbuilder.setView(dialogView);\n</code></pre>\n<p><a href=\"https://i.sstatic.net/ZLdStP1m.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/ZLdStP1m.jpg\" alt=\"Result when using custom layout\" /></a></p>\n",
    "tags" : [ "java", "android", "html", "android-alertdialog" ],
    "owner" : {
      "account_id" : 5123768,
      "reputation" : 77,
      "user_id" : 4106573,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/0ygEnzCY.png?s=256",
      "display_name" : "Dana Bell",
      "link" : "https://stackoverflow.com/users/4106573/dana-bell"
    },
    "is_answered" : false,
    "view_count" : 80,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1765796525,
    "creation_date" : 1765660909,
    "link" : "https://stackoverflow.com/questions/79846766/link-in-html-file-in-alertdialog-isnt-clickable",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79847046,
    "question_id" : 79846766,
    "body" : "<p>Follow the steps mentioned below:</p>\n<ol>\n<li>Create a custom layout for <code>AlertDialog</code>.</li>\n</ol>\n<p><code>dialog_news.xml</code></p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;\n    android:paddingHorizontal=&quot;16dp&quot;\n    android:paddingVertical=&quot;20dp&quot;&gt;\n\n    &lt;androidx.appcompat.widget.AppCompatTextView\n        android:id=&quot;@+id/title&quot;\n        android:layout_width=&quot;0dp&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:textSize=&quot;24sp&quot;\n        android:textStyle=&quot;bold&quot;\n        app:layout_constraintEnd_toEndOf=&quot;parent&quot;\n        app:layout_constraintStart_toStartOf=&quot;parent&quot;\n        app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;\n\n    &lt;androidx.appcompat.widget.AppCompatTextView\n        android:id=&quot;@+id/message&quot;\n        android:layout_width=&quot;0dp&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:layout_marginTop=&quot;16dp&quot;\n        android:textSize=&quot;14sp&quot;\n        app:layout_constraintEnd_toEndOf=&quot;parent&quot;\n        app:layout_constraintStart_toStartOf=&quot;parent&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/title&quot; /&gt;\n&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre>\n<ol start=\"2\">\n<li>Create an <code>interface</code> to listen hyperlink clicks.</li>\n</ol>\n<p><code>OnHyperLinkActionListener.kt</code></p>\n<pre><code>interface OnHyperLinkActionListener {\n\n    fun onOpenUrl(url: String)\n}\n</code></pre>\n<ol start=\"3\">\n<li>Create another class for extension function for <code>Spanned</code>.</li>\n</ol>\n<p><code>SpannedExt.java</code></p>\n<pre><code>public final class SpannedExt {\n\n    private SpannedExt() {\n    }\n\n    public static &lt;S extends CharacterStyle, T extends CharacterStyle&gt; Spanned replaceSpans(\n            Spanned source,\n            Class&lt;S&gt; sourceType,\n            SpanConverter&lt;S, T&gt; converter\n    ) {\n        SpannableStringBuilder result = new SpannableStringBuilder(source);\n\n        var spans = result.getSpans(0, result.length(), sourceType);\n        for (S span : spans) {\n            int start = result.getSpanStart(span);\n            int end = result.getSpanEnd(span);\n            int flags = result.getSpanFlags(span);\n\n            result.removeSpan(span);\n            result.setSpan(converter.convert(span), start, end, flags);\n        }\n        return result;\n    }\n\n    public interface SpanConverter&lt;S, T&gt; {\n        T convert(S span);\n    }\n}\n</code></pre>\n<ol start=\"4\">\n<li>Create a util class to parse the <code>String</code> into <code>HTML</code> and handle the click on URL.</li>\n</ol>\n<p><code>StringToRichTextMapper.java</code></p>\n<pre><code>public final class StringToRichTextMapper implements Function&lt;String, CharSequence&gt; {\n\n    private static final String URL_W3SCHOOLS = &quot;https://www.w3schools.com/&quot;;\n    private static final String URL_UNSPECIFIED = &quot;&quot;;\n\n    private static final String KEY_ACTION_HYPER_LINK_W3SCHOOLS = &quot;HYPER_LINK_W3SCHOOLS&quot;;\n\n    private final OnHyperLinkActionListener actionListener;\n\n    public StringToRichTextMapper(OnHyperLinkActionListener actionListener) {\n        this.actionListener = actionListener;\n    }\n\n    @Override\n    public CharSequence apply(String text) {\n        return SpannedExt.replaceSpans(\n                HtmlCompat.fromHtml(text, HtmlCompat.FROM_HTML_MODE_LEGACY),\n                URLSpan.class,\n                this::toCustomUrlSpan\n        );\n    }\n\n    private URLSpan toCustomUrlSpan(URLSpan span) {\n        String url = span.getURL();\n        if (KEY_ACTION_HYPER_LINK_W3SCHOOLS.equals(url)) {\n            return new UnderlineURLSpan(URL_W3SCHOOLS, actionListener);\n        } else {\n            return new NoUnderlineURLSpan(URL_UNSPECIFIED, actionListener);\n        }\n    }\n\n    /**\n     * URLSpan without underline\n     */\n    private static final class NoUnderlineURLSpan extends URLSpan {\n\n        private final OnHyperLinkActionListener actionListener;\n\n        NoUnderlineURLSpan(String url, OnHyperLinkActionListener actionListener) {\n            super(url);\n            this.actionListener = actionListener;\n        }\n\n        @Override\n        public void updateDrawState(TextPaint ds) {\n            super.updateDrawState(ds);\n            ds.setUnderlineText(false);\n        }\n\n        @Override\n        public void onClick(View widget) {\n            actionListener.onOpenUrl(getURL());\n        }\n    }\n\n    /**\n     * URLSpan with underline\n     */\n    private static final class UnderlineURLSpan extends URLSpan {\n\n        private final OnHyperLinkActionListener actionListener;\n\n        UnderlineURLSpan(String url, OnHyperLinkActionListener actionListener) {\n            super(url);\n            this.actionListener = actionListener;\n        }\n\n        @Override\n        public void updateDrawState(TextPaint ds) {\n            super.updateDrawState(ds);\n            ds.setUnderlineText(true);\n        }\n\n        @Override\n        public void onClick(View widget) {\n            actionListener.onOpenUrl(getURL());\n        }\n    }\n}\n</code></pre>\n<ol start=\"5\">\n<li>Finally, update the <code>showNews(...)</code> and add another function to open URLs in your <code>MainActivity</code>.</li>\n</ol>\n<pre><code>     public void showNews(/*int number*/) {\n//        int last = shared.getInt(&quot;news&quot;,1);\n//        Log.d(&quot;News&quot;, String.valueOf(last));\n//\n//        if (last &gt;= number)\n//            return;\n        AlertDialog.Builder builder = new AlertDialog.Builder(MainActivity.this);\n        View dialogView = getLayoutInflater().inflate(R.layout.dialog_news, null, false);\n        builder.setView(dialogView);\n        AppCompatTextView titleTv = dialogView.findViewById(R.id.title);\n        AppCompatTextView messageTv = dialogView.findViewById(R.id.message);\n        titleTv.setText(&quot;Application News&quot;);\n        messageTv.setMovementMethod(LinkMovementMethod.getInstance());\n        messageTv.setText(new StringToRichTextMapper(new OnHyperLinkActionListener() {\n            @Override\n            public void onOpenUrl(@NonNull String url) {\n                handleUrl(url);\n            }\n        }).apply(getNewsContentFromAssets()));\n\n        builder.setPositiveButton(&quot;Okay&quot;, (dialog, which) -&gt; {\n//                prefs.putInt(&quot;news&quot;, number);\n//                prefs.apply();\n            dialog.dismiss();\n        });\n\n        builder.show();\n    }\n\n    private String getNewsContentFromAssets() {\n        StringBuilder text = new StringBuilder();\n\n        BufferedReader reader = null;\n        try {\n            reader = new BufferedReader(new InputStreamReader(getAssets().open(&quot;html/&quot; + &quot;news.html&quot;)));\n            String mLine;\n            while ((mLine = reader.readLine()) != null) {\n                text.append(mLine);\n                text.append('\\n');\n            }\n        } catch (IOException e) {\n            Toast.makeText(getApplicationContext(), &quot;Error reading file!&quot;, Toast.LENGTH_LONG).show();\n            e.printStackTrace();\n        } finally {\n            if (reader != null) {\n                try {\n                    reader.close();\n                } catch (IOException e) {\n                    Log.e(&quot;showNews&quot;, &quot;Error reading file&quot;);\n                }\n            }\n        }\n        return text.toString();\n    }\n\n    private void handleUrl(String url) {\n        try {\n            Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse(url));\n            intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n            startActivity(intent);\n        } catch (ActivityNotFoundException e) {\n            Toast.makeText(this, &quot;No application found to open the link&quot;, Toast.LENGTH_SHORT).show();\n        }\n    }\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 8061597,
      "reputation" : 941,
      "user_id" : 6076979,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/nSsrQ.jpg?s=256",
      "display_name" : "MojoJojo",
      "link" : "https://stackoverflow.com/users/6076979/mojojojo"
    },
    "creation_date" : 1765718370,
    "last_activity_date" : 1765771886,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79847096,
    "question_id" : 79846766,
    "body" : "<p>If you would like to make this work using the standard <code>AlertDialog</code> title and message fields without requiring a custom layout, you can resolve the <code>TextView</code> via standard IDs such as <code>android.R.id.title</code> or <code>android.R.id.message</code> to apply the <code>LinkMovementMethod</code>:</p>\n<pre><code>AlertDialog dialog = \n  new AlertDialog.Builder(context)\n    .setTitle(&quot;My Title&quot;)\n    .setMessage(readHtmlContent())\n    .create();\n\n// Show the dialog first to create the content view\ndialog.show();\n\n// Resolve the message view and apply the movement method\nTextView messageView = dialog.findViewById(android.R.id.message);\nmessageView.setMovementMethod(LinkMovementMethod.getInstance());\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 125727,
      "reputation" : 134918,
      "user_id" : 321697,
      "user_type" : "registered",
      "accept_rate" : 97,
      "profile_image" : "https://i.sstatic.net/FHlMy.jpg?s=256",
      "display_name" : "Kevin Coppock",
      "link" : "https://stackoverflow.com/users/321697/kevin-coppock"
    },
    "creation_date" : 1765724137,
    "last_activity_date" : 1765740072,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140902511,
    "post_id" : 79846766,
    "body" : "Thank you. That&#39;s what I started with but kept having problems, from errors to no text. I was trying to simplify it here. I&#39;ll use the guide you reference and try again. I use custom layouts with dialog boxes elsewhere but this is the first trying to read a file into it.",
    "score" : 0,
    "owner" : {
      "account_id" : 5123768,
      "reputation" : 77,
      "user_id" : 4106573,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/0ygEnzCY.png?s=256",
      "display_name" : "Dana Bell",
      "link" : "https://stackoverflow.com/users/4106573/dana-bell"
    },
    "creation_date" : 1765672850,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140902407,
    "post_id" : 79846766,
    "body" : "I recommend <a href=\"https://stackoverflow.com/a/38105083/115145\">using a custom layout</a>, not just a bare <code>TextView</code>, so you have greater control over padding, etc.",
    "score" : 0,
    "owner" : {
      "account_id" : 39846,
      "reputation" : 1011235,
      "user_id" : 115145,
      "user_type" : "registered",
      "accept_rate" : 84,
      "profile_image" : "https://i.sstatic.net/wDnd8.png?s=256",
      "display_name" : "CommonsWare",
      "link" : "https://stackoverflow.com/users/115145/commonsware"
    },
    "creation_date" : 1765661888,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79847046" : [ {
      "comment_id" : 140903571,
      "post_id" : 79847046,
      "body" : "@DanaBell Please check - I’ve updated the code from <code>Kotlin</code> to <code>Java</code>. It didn’t take much time either.",
      "score" : 0,
      "owner" : {
        "account_id" : 8061597,
        "reputation" : 941,
        "user_id" : 6076979,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/nSsrQ.jpg?s=256",
        "display_name" : "MojoJojo",
        "link" : "https://stackoverflow.com/users/6076979/mojojojo"
      },
      "creation_date" : 1765772177,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140902921,
      "post_id" : 79847046,
      "body" : "I don&#39;t use androidx or kotlin. Converting to androidx would require too much time to convert everything else in the app. I tried it once.",
      "score" : 0,
      "owner" : {
        "account_id" : 5123768,
        "reputation" : 77,
        "user_id" : 4106573,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/0ygEnzCY.png?s=256",
        "display_name" : "Dana Bell",
        "link" : "https://stackoverflow.com/users/4106573/dana-bell"
      },
      "creation_date" : 1765720027,
      "content_license" : "CC BY-SA 4.0"
    } ],
    "79847096" : [ {
      "comment_id" : 140903552,
      "post_id" : 79847096,
      "body" : "Yes, <code>findViewById</code> is available but throwing NPE if using standard IDs.",
      "score" : 0,
      "owner" : {
        "account_id" : 8061597,
        "reputation" : 941,
        "user_id" : 6076979,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/nSsrQ.jpg?s=256",
        "display_name" : "MojoJojo",
        "link" : "https://stackoverflow.com/users/6076979/mojojojo"
      },
      "creation_date" : 1765771068,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140903202,
      "post_id" : 79847096,
      "body" : "@DanaBell I added the missing &#39;new&#39; keyword. Too used to Kotlin now, but findViewById is definitely an available API on AlertDialog (via Dialog super class: <a href=\"https://developer.android.com/reference/android/app/Dialog#findViewById(int)\" rel=\"nofollow noreferrer\">developer.android.com/reference/android/app/&hellip;</a>)",
      "score" : 0,
      "owner" : {
        "account_id" : 125727,
        "reputation" : 134918,
        "user_id" : 321697,
        "user_type" : "registered",
        "accept_rate" : 97,
        "profile_image" : "https://i.sstatic.net/FHlMy.jpg?s=256",
        "display_name" : "Kevin Coppock",
        "link" : "https://stackoverflow.com/users/321697/kevin-coppock"
      },
      "creation_date" : 1765740164,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140903136,
      "post_id" : 79847096,
      "body" : "Sounds simple  but   using my AlertDialog.Builder .. doesn&#39;t recognize findViewById  using your AlertDialog .. doesn&#39;t recognize setPositiveButton",
      "score" : 0,
      "owner" : {
        "account_id" : 5123768,
        "reputation" : 77,
        "user_id" : 4106573,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/0ygEnzCY.png?s=256",
        "display_name" : "Dana Bell",
        "link" : "https://stackoverflow.com/users/4106573/dana-bell"
      },
      "creation_date" : 1765735126,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}