{
  "question" : {
    "question_id" : 79629015,
    "title" : "Spring boot oauth2 does not invoke successHandler and always redirects to &quot;/&quot; after authentication",
    "body" : "<p>I am trying to set up a basic google oauth setup for a spring boot app. My idea is that frontend will redirect to a url like http://localhost:8081/oauth2/authorization/google and after authentication, the backend creates user, user session then redirects back to localhost:3000 (frontend)</p>\n<p>I have written a Oauth2SuccessHandler and Oauth2FailureHandler for this purpose.\nThis is my SecurityConfig.</p>\n<pre><code>import lombok.RequiredArgsConstructor;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.web.SecurityFilterChain;\n\n@EnableWebSecurity\n@RequiredArgsConstructor\npublic class SecurityConfig {\n\n    private final OAuth2SuccessHandler successHandler;\n    private final OAuth2FailureHandler failureHandler;\n\n    @Bean\n    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n        http\n                .csrf().disable()\n                .authorizeHttpRequests(auth -&gt; auth\n                        .requestMatchers(&quot;/oauth2/**&quot;,&quot;/auth/**&quot;).permitAll()\n                        .anyRequest().authenticated()\n                )\n                .oauth2Login(oauth -&gt; oauth\n                        .successHandler(successHandler)\n                        .failureHandler(failureHandler)\n                );\n        return http.build();\n    }\n\n}\n</code></pre>\n<p>It mostly seems to work however after authentication, the Oauth2successHandler is not invoked. It looks like this</p>\n<pre><code>@Component\n@RequiredArgsConstructor\npublic class OAuth2SuccessHandler implements AuthenticationSuccessHandler {\n\n@Override\npublic void onAuthenticationSuccess(HttpServletRequest request,\n        HttpServletResponse response,\n        Authentication authentication) throws IOException {\n//My logic\n}\n}\n</code></pre>\n<p>&quot;My logic&quot; never gets executed. The authentication seems to be successful, I am able to see my google account details in the logs. After that, it redirects to &quot;/&quot; (localhost:8081/) instead of going to my success handler.</p>\n<p>In case application.properties is useful,</p>\n<pre><code>spring.security.oauth2.client.registration.google.client-id=\nspring.security.oauth2.client.registration.google.client-secret=\nspring.security.oauth2.client.registration.google.scope=openid,email,profile\nspring.security.oauth2.client.registration.google.redirect-uri={baseUrl}/login/oauth2/code/{registrationId}\n\nspring.security.oauth2.client.provider.google.authorization-uri=https://accounts.google.com/o/oauth2/v2/auth\nspring.security.oauth2.client.provider.google.token-uri=https://oauth2.googleapis.com/token\nspring.security.oauth2.client.provider.google.user-info-uri=https://openidconnect.googleapis.com/v1/userinfo\nspring.security.oauth2.client.provider.google.user-name-attribute=sub\n</code></pre>\n<p>My question is to understand why my SuccessHandler is not invoked and how to fix it.</p>\n",
    "tags" : [ "java", "spring", "spring-boot", "google-oauth", "spring-oauth2" ],
    "owner" : {
      "account_id" : 29897314,
      "reputation" : 407,
      "user_id" : 22911863,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/z1YDCFM5.jpg?s=256",
      "display_name" : "authorizeduser",
      "link" : "https://stackoverflow.com/users/22911863/authorizeduser"
    },
    "is_answered" : true,
    "view_count" : 183,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1748231100,
    "creation_date" : 1747667062,
    "link" : "https://stackoverflow.com/questions/79629015/spring-boot-oauth2-does-not-invoke-successhandler-and-always-redirects-to-af",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79638279,
    "question_id" : 79629015,
    "body" : "<p>After I added<code> @Configuration</code> to <code>SecurityConfig</code>, it fixed my issue. The OauthSuccessHandler is getting invoked now. However, I am still not sure how the oauth flow worked before but only my OauthSuccessHandler failed to get invoked.</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 29897314,
      "reputation" : 407,
      "user_id" : 22911863,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/z1YDCFM5.jpg?s=256",
      "display_name" : "authorizeduser",
      "link" : "https://stackoverflow.com/users/22911863/authorizeduser"
    },
    "creation_date" : 1748231100,
    "last_activity_date" : 1748231100,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140458277,
    "post_id" : 79629015,
    "body" : "@TevinS The issue was in my SecurityConfig that did not have the Configuration annotation",
    "score" : 0,
    "owner" : {
      "account_id" : 29897314,
      "reputation" : 407,
      "user_id" : 22911863,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/z1YDCFM5.jpg?s=256",
      "display_name" : "authorizeduser",
      "link" : "https://stackoverflow.com/users/22911863/authorizeduser"
    },
    "creation_date" : 1748231377,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140458276,
    "post_id" : 79629015,
    "body" : "@NamanMadharia The issue was in my SecurityConfig that did not have the ` <code>Configuration</code> annotation",
    "score" : 0,
    "owner" : {
      "account_id" : 29897314,
      "reputation" : 407,
      "user_id" : 22911863,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/z1YDCFM5.jpg?s=256",
      "display_name" : "authorizeduser",
      "link" : "https://stackoverflow.com/users/22911863/authorizeduser"
    },
    "creation_date" : 1748231352,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140440480,
    "post_id" : 79629015,
    "body" : "First, make sure you&#39;re not also setting defaultSuccessUrl() somewhere â€” that can silently override your successHandler. Also worth confirming that your OAuth2SuccessHandler is actually being picked up by Spring (a log in the constructor can help). Finally, double-check that the redirect is actually hitting /login/oauth2/code/google and not getting hijacked by a proxy or fallback route.",
    "score" : 1,
    "owner" : {
      "user_type" : "does_not_exist",
      "display_name" : "user20959944"
    },
    "creation_date" : 1747682731,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}