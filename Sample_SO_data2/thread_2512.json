{
  "question" : {
    "question_id" : 79618136,
    "title" : "Why does WebClient in WebFlux switch from virtual thread to platform thread after async boundary?",
    "body" : "<p>I'm exploring the use of virtual threads (Java 21) in a Spring WebFlux application by using a custom Scheduler backed by a virtual thread executor via .subscribeOn().</p>\n<p>However, Iâ€™ve noticed that while the initial part of the reactive flow runs on virtual threads, once the flow reaches an asynchronous boundary (such as an HTTP call with WebClient or database access), the thread switches to a platform thread, usually a Netty event loop thread.</p>\n<p>Is this behavior expected in WebFlux?</p>\n<p>Specifically:</p>\n<p>Why does the thread switch from virtual to platform after async boundaries?</p>\n<p>Does Project Reactor or Netty intentionally delegate I/O operations to their own thread pools?</p>\n<p>Is it possible to retain virtual thread execution after such boundaries?</p>\n<p>Are there any official recommendations or known limitations regarding virtual thread usage in WebFlux?</p>\n<p>Looking for insights into how WebFlux integrates with virtual threads and whether full flow execution on virtual threads is currently feasible.</p>\n",
    "tags" : [ "java", "spring", "spring-webflux", "reactive-programming", "virtual-threads" ],
    "owner" : {
      "account_id" : 16514934,
      "reputation" : 177,
      "user_id" : 11932679,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/fc5041f16eeb7110f159956d7a1e0255?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Spring boot progammer",
      "link" : "https://stackoverflow.com/users/11932679/spring-boot-progammer"
    },
    "is_answered" : false,
    "view_count" : 117,
    "answer_count" : 0,
    "score" : 2,
    "last_activity_date" : 1747070876,
    "creation_date" : 1747062800,
    "link" : "https://stackoverflow.com/questions/79618136/why-does-webclient-in-webflux-switch-from-virtual-thread-to-platform-thread-afte",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140426170,
    "post_id" : 79618136,
    "body" : "@KrzysztofTomaszewski, then don&#39;t forget to share your own observations if you will and have ones :) Reactive Programming vs Virtual Threads is very interesting topic.",
    "score" : 1,
    "owner" : {
      "account_id" : 2745991,
      "reputation" : 2794,
      "user_id" : 2366397,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/24ee2b89e9791e936235b16af77ebda4?s=256&d=identicon&r=PG",
      "display_name" : "igor.zh",
      "link" : "https://stackoverflow.com/users/2366397/igor-zh"
    },
    "creation_date" : 1747246769,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140425090,
    "post_id" : 79618136,
    "body" : "@igor.zh Thanks for sharing the article. I&#39;m interested to see more of such independent benchmarks.",
    "score" : 1,
    "owner" : {
      "account_id" : 1609777,
      "reputation" : 1264,
      "user_id" : 1489121,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9052c887f0a62c26b6daf370192c595e?s=256&d=identicon&r=PG",
      "display_name" : "Krzysztof Tomaszewski",
      "link" : "https://stackoverflow.com/users/1489121/krzysztof-tomaszewski"
    },
    "creation_date" : 1747228396,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140421461,
    "post_id" : 79618136,
    "body" : "@KrzysztofTomaszewski. Yes, it is possible to streamline concurrent programming model with virtual thread and yet <a href=\"https://dzone.com/articles/demystifying-virtual-thread-performance-unveiling\" rel=\"nofollow noreferrer\">some researches</a> insist that nothing beats Event Loop paradigm in terms of performance. This difficult, multi-factor choice is also discussed <a href=\"https://stackoverflow.com/a/78337631/2366397\">here</a>.",
    "score" : 1,
    "owner" : {
      "account_id" : 2745991,
      "reputation" : 2794,
      "user_id" : 2366397,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/24ee2b89e9791e936235b16af77ebda4?s=256&d=identicon&r=PG",
      "display_name" : "igor.zh",
      "link" : "https://stackoverflow.com/users/2366397/igor-zh"
    },
    "creation_date" : 1747140602,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140420658,
    "post_id" : 79618136,
    "body" : "Ask yourself a question if you really need Spring WebFlux? Spring WebFlux brings in the Project Reactor (<code>Mono</code>, <code>Flux</code> propagating everywhere) which is complex and hard to debug. With virtual threads you can switch to Spring Web MVC and avoid Project Reactor at all.",
    "score" : 1,
    "owner" : {
      "account_id" : 1609777,
      "reputation" : 1264,
      "user_id" : 1489121,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9052c887f0a62c26b6daf370192c595e?s=256&d=identicon&r=PG",
      "display_name" : "Krzysztof Tomaszewski",
      "link" : "https://stackoverflow.com/users/1489121/krzysztof-tomaszewski"
    },
    "creation_date" : 1747126480,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140420226,
    "post_id" : 79618136,
    "body" : "Thanks for the insights, @igor.zh no performance issue as such, just wanted to test out if virtual threads are going to optimise on top on webflux",
    "score" : 1,
    "owner" : {
      "account_id" : 16514934,
      "reputation" : 177,
      "user_id" : 11932679,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/fc5041f16eeb7110f159956d7a1e0255?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Spring boot progammer",
      "link" : "https://stackoverflow.com/users/11932679/spring-boot-progammer"
    },
    "creation_date" : 1747117322,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140419606,
    "post_id" : 79618136,
    "body" : "It might be possible to <a href=\"https://stackoverflow.com/questions/56764801/configuring-spring-webflux-webclient-to-use-a-custom-thread-pool\">configure Web Client with custom thread pool</a> which could be virtual thread executor, but I agree with @M.Deinum: virtual threads in Web Flux is mostly hype.  VT with Web Flux is also discussed <a href=\"https://stackoverflow.com/a/79415607/2366397\">here</a>. Do you have some performance or other issues with Web Flux Event Loop platform threads?",
    "score" : 1,
    "owner" : {
      "account_id" : 2745991,
      "reputation" : 2794,
      "user_id" : 2366397,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/24ee2b89e9791e936235b16af77ebda4?s=256&d=identicon&r=PG",
      "display_name" : "igor.zh",
      "link" : "https://stackoverflow.com/users/2366397/igor-zh"
    },
    "creation_date" : 1747089688,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140418441,
    "post_id" : 79618136,
    "body" : "Webflux and Virtual Threads are different beast. When using virtual threads is kind of defeats to using the reactive api (which generally uses an event loop and dedicated thread pools).",
    "score" : 2,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1747062920,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}