{
  "question" : {
    "question_id" : 79548196,
    "title" : "How can I use streams for reading logs from Azure container instance?",
    "body" : "<p>I have a service that copies logs from an Azure Container Instance to a Storage Account once a job's execution is complete. Currently, I retrieve all logs at once and then upload them to the Storage Account, as shown below:</p>\n<pre class=\"lang-java prettyprint-override\"><code>String logs = azure.containerGroups().getByResourceGroup(RESOURCE_GROUP_NAME, name).getLogContent(containerName);\nbyte[] bytes = logs.getBytes();\nblob.upload(new ByteArrayInputStream(bytes), bytes.length);\n</code></pre>\n<p>However, this approach may cause an Out of Memory (OOM) error if the logs are too large.</p>\n<p>I want to stream the logs directly from the Azure Container Instance to the Storage Account to avoid loading the entire log content into memory. How can I achieve this?</p>\n",
    "tags" : [ "java", "azure", "azure-container-instances" ],
    "owner" : {
      "account_id" : 11613849,
      "reputation" : 1404,
      "user_id" : 8507296,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/VqIhUKth.jpg?s=256",
      "display_name" : "PSKP",
      "link" : "https://stackoverflow.com/users/8507296/pskp"
    },
    "is_answered" : false,
    "view_count" : 64,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1743674981,
    "creation_date" : 1743499178,
    "link" : "https://stackoverflow.com/questions/79548196/how-can-i-use-streams-for-reading-logs-from-azure-container-instance",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79552615,
    "question_id" : 79548196,
    "body" : "<blockquote>\n<p>How can I use streams for reading logs from Azure container instance?</p>\n</blockquote>\n<p>You can use the code below to <strong>stream</strong> logs directly from an Azure Container Instance to Azure Blob Storage, rather than loading the entire log content into memory.</p>\n<p>You can use the Azure CLI (<code>az container logs</code>) to fetch logs in chunks and write them directly to Azure Blob Storage.</p>\n<p><strong>Code:</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code> ProcessBuilder processBuilder = new ProcessBuilder(\n    &quot;az&quot;, &quot;container&quot;, &quot;logs&quot;,\n    &quot;--resource-group&quot;, resourceGroup,\n    &quot;--name&quot;, containerInstance\n);\n\nProcess process = processBuilder.start();\nInputStream inputStream = process.getInputStream();\n\nBlobServiceClient blobServiceClient = new BlobServiceClientBuilder()\n    .connectionString(storageConnectionString)\n    .buildClient();\nBlobContainerClient blobContainerClient = blobServiceClient.getBlobContainerClient(blobContainerName);\nBlobClient blobClient = blobContainerClient.getBlobClient(blobName);\n\ntry (OutputStream outputStream = blobClient.getBlockBlobClient().getBlobOutputStream();\n     BufferedReader reader = new BufferedReader(new InputStreamReader(inputStream, StandardCharsets.UTF_8))) {\n    \n    String line;\n    while ((line = reader.readLine()) != null) {\n        outputStream.write((line + &quot;\\n&quot;).getBytes(StandardCharsets.UTF_8));\n    }\n}\n\nprocess.waitFor();\nSystem.out.println(&quot;Logs streamed successfully!&quot;);\n</code></pre>\n<p>Switching from <code>getLogContent()</code> to <code>az container logs</code> streams logs line by line via <code>BufferedReader</code>, preventing OOM errors. Logs are directly written to Azure Blob Storage via <code>OutputStream</code>, with <code>flush()</code> ensuring immediate writes.</p>\n<p><strong>Reference:</strong></p>\n<ul>\n<li><a href=\"https://learn.microsoft.com/en-us/cli/azure/container?view=azure-cli-latest#az-container-logs\" rel=\"nofollow noreferrer\">az container | Microsoft Learn</a></li>\n<li><a href=\"https://learn.microsoft.com/en-us/azure/container-instances/container-instances-get-logs\" rel=\"nofollow noreferrer\">Get container instance logs &amp; events - Azure Container Instances | Microsoft Learn</a></li>\n</ul>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 25323437,
      "reputation" : 11346,
      "user_id" : 19144428,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/xwLaPRiI.jpg?s=256",
      "display_name" : "Venkatesan",
      "link" : "https://stackoverflow.com/users/19144428/venkatesan"
    },
    "creation_date" : 1743674981,
    "last_activity_date" : 1743674981,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140310260,
    "post_id" : 79548196,
    "body" : "Check if below provided solution works for you? Let me know if I can be helpful here anyway with further input?",
    "score" : 0,
    "owner" : {
      "account_id" : 25323437,
      "reputation" : 11346,
      "user_id" : 19144428,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/xwLaPRiI.jpg?s=256",
      "display_name" : "Venkatesan",
      "link" : "https://stackoverflow.com/users/19144428/venkatesan"
    },
    "creation_date" : 1744089104,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140294092,
    "post_id" : 79548196,
    "body" : "Or, you can use the Azure CLI (az container logs) to fetch logs in chunks and write them directly to Azure Blob Storage.",
    "score" : 0,
    "owner" : {
      "account_id" : 25323437,
      "reputation" : 11346,
      "user_id" : 19144428,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/xwLaPRiI.jpg?s=256",
      "display_name" : "Venkatesan",
      "link" : "https://stackoverflow.com/users/19144428/venkatesan"
    },
    "creation_date" : 1743674811,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140293933,
    "post_id" : 79548196,
    "body" : "Azure Container Instances supports fetching logs with a tail limit (e.g., the last N lines), so you can repeatedly call this in a loop to simulate streaming.",
    "score" : 0,
    "owner" : {
      "account_id" : 25323437,
      "reputation" : 11346,
      "user_id" : 19144428,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/xwLaPRiI.jpg?s=256",
      "display_name" : "Venkatesan",
      "link" : "https://stackoverflow.com/users/19144428/venkatesan"
    },
    "creation_date" : 1743672495,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79552615" : [ {
      "comment_id" : 140320786,
      "post_id" : 79552615,
      "body" : "Does azcli load all logs once or does it use streaming under the hood? There is no point in creating new process if it is going to load all logs once.",
      "score" : 0,
      "owner" : {
        "account_id" : 11613849,
        "reputation" : 1404,
        "user_id" : 8507296,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/VqIhUKth.jpg?s=256",
        "display_name" : "PSKP",
        "link" : "https://stackoverflow.com/users/8507296/pskp"
      },
      "creation_date" : 1744294126,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}