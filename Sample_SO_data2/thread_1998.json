{
  "question" : {
    "question_id" : 79659932,
    "title" : "How to update Kafka Admin Client SSL properties using SslBundle",
    "body" : "<p>I am trying to publish messages to a Kafka cluster that is SSL protected.</p>\n<p>I have correct certificates on the application side. I checked I can consume from this kafka cluster using those. Also, the topic exists, I do not need to create it. I just need to publish into it.</p>\n<p>For some unknown reason, when I am trying to publish to this existing topic, I can see the invocation of the &quot;admin client&quot;</p>\n<pre><code>[nio-8080-exec-1] [4af24028c1d624fb61198f30b483900f-d67a602cf7c48e65] o.a.k.clients.admin.AdminClientConfig    : AdminClientConfig values:\n    auto.include.jmx.reporter = true\n    bootstrap.controllers = []\n    bootstrap.servers = [mykafka.com:9092]\n    client.dns.lookup = use_all_dns_ips\n    client.id =\n    socket.connection.setup.timeout.max.ms = 30000\n    socket.connection.setup.timeout.ms = 10000\n    ssl.cipher.suites = null\n    ssl.enabled.protocols = [TLSv1.2, TLSv1.3]\n    ssl.endpoint.identification.algorithm = https\n    ssl.engine.factory.class = null\n    ssl.key.password = null\n    ssl.keymanager.algorithm = SunX509\n    ssl.keystore.certificate.chain = null\n    ssl.keystore.key = null\n    ssl.keystore.location = null\n    ssl.keystore.password = null\n    ssl.keystore.type = JKS\n    ssl.protocol = TLSv1.3\n    ssl.provider = null\n    ssl.secure.random.implementation = null\n    ssl.trustmanager.algorithm = PKIX\n    ssl.truststore.certificates = null\n    ssl.truststore.location = null\n    ssl.truststore.password = null\n    ssl.truststore.type = JKS\n\n[nio-8080-exec-1] [4af24028c1d624fb61198f30b483900f-d67a602cf7c48e65] o.a.kafka.common.utils.AppInfoParser     : Kafka version: 3.9.1\n[nio-8080-exec-1] [4af24028c1d624fb61198f30b483900f-d67a602cf7c48e65] o.a.kafka.common.utils.AppInfoParser     : Kafka commitId: f745dfdcee2b9851\n[nio-8080-exec-1] [4af24028c1d624fb61198f30b483900f-d67a602cf7c48e65] o.a.kafka.common.utils.AppInfoParser     : Kafka startTimeMs: 1749465196889\n[| adminclient-1] [                                                 ] org.apache.kafka.clients.NetworkClient   : [AdminClient clientId=adminclient-1] Node -1 disconnected.\n[| adminclient-1] [                                                 ] org.apache.kafka.clients.NetworkClient   : [AdminClient clientId=adminclient-1] Cancelled in-flight API_VERSIONS request with correlation id 0 due to node -1 being disconnected (elapsed time since creation: 413ms, elapsed time since send: 413ms, throttle time: 0ms, request timeout: 3600000ms)\n[| adminclient-1] [                                                 ] org.apache.kafka.clients.NetworkClient   : [AdminClient clientId=adminclient-1] Node -1 disconnected.\n[| adminclient-1] [                                                 ] org.apache.kafka.clients.NetworkClient   : [AdminClient clientId=adminclient-1] Cancelled in-flight API_VERSIONS request with correlation id 1 due to node -1 being disconnected (elapsed time since creation: 247ms, elapsed time since send: 247ms, throttle time: 0ms, request timeout: 3600000ms)\n\n</code></pre>\n<p>(Why ?)</p>\n<p>Since the Kafka cluster is SSL protected, I would like to update the SSL properties of this Admin Client (if this admin client is really needed, which I still don't understand why).</p>\n<p>I think it can be configured like this in the application yaml, but it is not using the latest Ssl bundle.</p>\n<pre><code>spring:\n  application:\n    name: question\n  kafka:\n    properties:\n      security.protocol: SSL\n    ssl:\n      key-password: abc\n      keystore-location: 'file:///Users/me/keystore.p12'\n      keystore-password: abc\n      truststore-location: 'file:///Users/me/truststore.p12'\n      truststore-password: abc\n</code></pre>\n<p>Regardless, I would like to update it using the programmatic approach, this is what I tried for the producer.</p>\n<pre><code>@Configuration\npublic class KafkaProducerConfiguration {\n\n    @Bean\n    public KafkaTemplate&lt;String, MyPojo&gt; kafkaTemplate(final MeterRegistry meterRegistry, final SslBundles sslBundles) {\n        final Map&lt;String, Object&gt; properties = new ConcurrentHashMap&lt;&gt;();\n        properties.put(&quot;security.protocol&quot;, &quot;SSL&quot;);\n        properties.put(SslConfigs.SSL_ENGINE_FACTORY_CLASS_CONFIG, SslBundleSslEngineFactory.class.getName());\n        properties.put(SslBundle.class.getName(), sslBundles.getBundle(&quot;my-bundle&quot;));\n        properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, &quot;mykafka.com:9092&quot;);\n        properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);\n        properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, JsonSerializer.class);\n\n\n        final DefaultKafkaProducerFactory&lt;String, MyPojo&gt; defaultKafkaProducerFactory = new DefaultKafkaProducerFactory&lt;&gt;(properties);\n        defaultKafkaProducerFactory.addListener(new MicrometerProducerListener&lt;&gt;(meterRegistry));\n        KafkaTemplate&lt;String, MyPojo&gt; kafkaTemplate = new KafkaTemplate&lt;&gt;(defaultKafkaProducerFactory);\n        kafkaTemplate.setObservationEnabled(true);\n        kafkaTemplate.setObservationConvention(new KafkaTemplateObservation.DefaultKafkaTemplateObservationConvention());\n        return kafkaTemplate;\n    }\n\n}\n</code></pre>\n<p>I would like to come up with some similar approach for the admin client, but I don't see a AdminTemplate.</p>\n<p>How to configure the SSL properties of the Admin Client using SSL Bundle approach, not via properties but using a programmatic way?</p>\n",
    "tags" : [ "java", "spring-boot", "spring-kafka", "kafka-producer-api" ],
    "owner" : {
      "account_id" : 42273671,
      "reputation" : 21,
      "user_id" : 30673520,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c61c14037ace9a3643b6c8c779526691?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "user30673520",
      "link" : "https://stackoverflow.com/users/30673520/user30673520"
    },
    "is_answered" : false,
    "view_count" : 52,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1749538221,
    "creation_date" : 1749538221,
    "link" : "https://stackoverflow.com/questions/79659932/how-to-update-kafka-admin-client-ssl-properties-using-sslbundle",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}