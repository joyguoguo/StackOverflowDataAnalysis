{
  "question" : {
    "question_id" : 79755338,
    "title" : "RedisSearch returns empty documents with lettuce-mod but works correctly via Redis CLI",
    "body" : "<p>I'm experiencing a strange issue with RedisSearch using the lettuce-mod Java client. The search works perfectly via Redis CLI but returns empty documents when executed through Java.</p>\n<p>Redis CLI (works correctly):</p>\n<pre><code>  FT.SEARCH idx:products &quot;@id:[12345 12345]&quot; RETURN 4 id name price category\n  1) &quot;1&quot;\n  2) &quot;product:electronics:12345&quot;\n  3) 1) &quot;id&quot;\n     2) &quot;12345&quot;\n     3) &quot;name&quot;\n     4) &quot;Laptop&quot;\n     5) &quot;price&quot;\n     6) &quot;999.99&quot;\n     7) &quot;category&quot;\n     8) &quot;&quot;\n</code></pre>\n<p>RedisSearch Index Configuration:</p>\n<pre><code>  // Create index for product data - each product is its own hash with prefix\n  CreateOptions&lt;String, String&gt; productOptions = CreateOptions.&lt;String, String&gt;builder()\n          .on(CreateOptions.DataType.HASH)\n          .prefix(&quot;product:&quot;)  // Will index all hashes starting with &quot;product:&quot;\n          .build();\n\n  redisModulesCommands.ftCreate(\n          &quot;idx:products&quot;,\n          productOptions,\n          Field.numeric(&quot;id&quot;).sortable().build(),\n          Field.text(&quot;name&quot;).sortable().build(),\n          Field.numeric(&quot;price&quot;).sortable().build(),\n          Field.text(&quot;category&quot;).build()\n  );\n</code></pre>\n<p>Java Code (returns empty documents):</p>\n<pre><code>  SearchResults&lt;String, String&gt; results = redisModulesCommands.ftSearch(\n      &quot;idx:products&quot;,\n      &quot;@id:[12345 12345]&quot;,\n      SearchOptions.&lt;String, String&gt;builder()\n          .returnFields(&quot;id&quot;, &quot;name&quot;, &quot;price&quot;, &quot;category&quot;)\n          .build()\n  );\n\n  System.out.println(&quot;Count: &quot; + results.getCount()); // Prints: Count: 1\n  if (results.getCount() &gt; 0) {\n      Document&lt;String, String&gt; doc = results.get(0);\n      System.out.println(&quot;Document: &quot; + doc); // Prints: Document: {}\n\n      Map&lt;Object, Object&gt; fields = new HashMap&lt;&gt;();\n      doc.forEach(fields::put);\n      System.out.println(&quot;Fields: &quot; + fields); // Prints: Fields: {}\n  }\n</code></pre>\n<p>Debug logs show:</p>\n<pre><code>[lettuce-nioEventLoop-4-2] DEBUG io.lettuce.core.protocol.CommandHandler - Received: 382 bytes, 1 commands in the stack\n12:27:22.100 [lettuce-nioEventLoop-4-2] DEBUG io.lettuce.core.protocol.RedisStateMachine - Decode done, empty stack: true\n[type=SEARCH, output=SearchOutput [output=[{}, {}, {}], error='null']\n\n</code></pre>\n<p>Client Configuration:</p>\n<pre><code>  RedisURI.Builder builder = RedisURI.builder()\n        .withSentinelMasterId(&quot;mymaster&quot;)\n        .withTimeout(Duration.ofMillis(3000));\n\n  // Add sentinel nodes\n  Arrays.stream(&quot;localhost:26379,localhost:26380&quot;.split(&quot;,&quot;))\n        .forEach(host -&gt; {\n           String[] parts = host.trim().split(&quot;:&quot;);\n           String hostname = parts[0];\n           int port = parts.length &gt; 1 ? Integer.parseInt(parts[1]) : 26379;\n           builder.withSentinel(hostname, port);\n        });\n\n  RedisModulesClient client = RedisModulesClient.create(clientResources, builder.build());\n  RedisModulesCommands&lt;String, String&gt; redisModulesCommands = client.connect().sync();\n</code></pre>\n<p>Environment:</p>\n<ul>\n<li>lettuce-mod 3.8.1</li>\n<li>Java 1.8</li>\n<li>Redis Sentinel setup</li>\n</ul>\n<p>Direct hash access works fine:</p>\n<pre><code>  Map&lt;String, String&gt; hashFields = commands.hgetall(&quot;product:electronics:12345&quot;);\n  // Returns: {id=12345, name=Laptop, price=999.99, category=&quot;&quot;}\n</code></pre>\n<p>The search finds the correct count of documents but the Document objects are completely empty. The same search command\nworks perfectly in Redis CLI. Is this a known issue with lettuce-mod's RedisSearch parsing, or am I missing something\nin my configuration?</p>\n<p>What I've tried:</p>\n<ul>\n<li>Different SearchOptions configurations</li>\n<li>Both with and without returnFields</li>\n<li>Verified Redis connection is working (other commands work fine)</li>\n<li>Confirmed the index exists and has the correct schema</li>\n</ul>\n",
    "tags" : [ "java", "redis", "redis-cluster", "lettuce", "redis-search" ],
    "owner" : {
      "account_id" : 10406130,
      "reputation" : 391,
      "user_id" : 7673019,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6326b8d55f8a706f5bd2eed838c52712?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Vishavjeet",
      "link" : "https://stackoverflow.com/users/7673019/vishavjeet"
    },
    "is_answered" : false,
    "view_count" : 58,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1756970567,
    "creation_date" : 1756966662,
    "link" : "https://stackoverflow.com/questions/79755338/redissearch-returns-empty-documents-with-lettuce-mod-but-works-correctly-via-red",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140739791,
    "post_id" : 79755338,
    "body" : "Have you tried using the new RediSearch API in Lettuce 6.8.x ?",
    "score" : 0,
    "owner" : {
      "account_id" : 435843,
      "reputation" : 334,
      "user_id" : 822655,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/705cba900acbeffb3799d2c42ae6659c?s=256&d=identicon&r=PG",
      "display_name" : "Tihomir Mateev",
      "link" : "https://stackoverflow.com/users/822655/tihomir-mateev"
    },
    "creation_date" : 1758031553,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140717031,
    "post_id" : 79755338,
    "body" : "@GuyRoyse MONITOR shows the same command what I tested in redis-cli, &quot;FT.SEARCH&quot; &quot;idx:products &quot; &quot;@id:[693520 693520]&quot;  I think this is related to lettuce-mod parsing issue, I can see in the logs  382 bytes received, also if I run the same command using eval it works fine, but I dont want to add overhead of running lua script",
    "score" : 0,
    "owner" : {
      "account_id" : 10406130,
      "reputation" : 391,
      "user_id" : 7673019,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6326b8d55f8a706f5bd2eed838c52712?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Vishavjeet",
      "link" : "https://stackoverflow.com/users/7673019/vishavjeet"
    },
    "creation_date" : 1757073679,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140714602,
    "post_id" : 79755338,
    "body" : "Not a solution but a debugging aid. You might want to use the MONITOR command (or the Profiler at the bottom of Redis Insight) and see what command Lettuce is actually sending to Redis. My first thought is it might be the usage of the DIALECT parameter, but that&#39;s just a guess. MONITOR would let you know for sure.",
    "score" : 0,
    "owner" : {
      "account_id" : 242289,
      "reputation" : 4452,
      "user_id" : 513710,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/1e0e9da43623ecdb31a7a1a74c03c1e4?s=256&d=identicon&r=PG",
      "display_name" : "Guy Royse",
      "link" : "https://stackoverflow.com/users/513710/guy-royse"
    },
    "creation_date" : 1756992989,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}