{
  "question" : {
    "question_id" : 79831562,
    "title" : "Intercepting user toggle button clicks",
    "body" : "<p>Can you intercept <code>JToggleButton</code> clicks, making the <code>selected</code> property change conditional? If you add <code>ItemListener</code> or <code>ActionListener</code>, you can't veto the change, it's already happened. Switching the state back would generate an extra event (there should be no events if the click is vetoed).</p>\n<p>Use case: the button state corresponds to some external state, e.g. a DB column value. Once the button is clicked, the external state is mutated accordingly, but the request may be unsuccessful for whatever reason. The GUI state must correspond to an actual external state, so it must follow the latter, not the other way around.</p>\n<p>Keep in mind the initial <code>selected</code> state of the toggle is set programmatically (according to the external state). That call must <strong>not</strong> be intercepted. If it was, then on each GUI load there would be an unnecessary request in the described scenario.</p>\n<p>Is listening to mouse clicks and consuming the event in case of a &quot;veto&quot; the only way? I hate to listen to mouse clicks, it smells of kludgy design.</p>\n<p>If you run the demo, you'll notice this in your console, even before you do any clicking.</p>\n<pre><code>Updating external state to true...\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>import javax.swing.JFrame;\nimport javax.swing.JPanel;\nimport javax.swing.JToggleButton;\nimport javax.swing.WindowConstants;\nimport java.awt.Container;\n\npublic class ToggleButtonDemo {\n\n    public static void main(String[] args) {\n        Container mainPanel = createMainPanel();\n        JFrame frame = new JFrame(&quot;Toggle Button Demo&quot;);\n        frame.setContentPane(mainPanel);\n        frame.setLocationRelativeTo(null);\n        frame.pack();\n        frame.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);\n        frame.setVisible(true);\n    }\n\n    private static JPanel createMainPanel() {\n        JPanel panel = new JPanel();\n        panel.add(toggleButtonPanel());\n        return panel;\n    }\n\n    private static JPanel toggleButtonPanel() {\n        JPanel toggleButtonPanel = new JPanel();\n        toggleButtonPanel.add(createToggleButton());\n        return toggleButtonPanel;\n    }\n\n    private static JToggleButton createToggleButton() {\n        JToggleButton toggleButton = new JToggleButton(&quot;Toggle me&quot;);\n        toggleButton.setModel(new JToggleButton.ToggleButtonModel() {\n            @Override\n            public void setSelected(boolean b) {\n                // intercepts programmatic calls too, unacceptable\n                if (externalStateUpdated(b)) super.setSelected(b);\n            }\n        });\n        toggleButton.setSelected(isSelectedInDb());\n        return toggleButton;\n    }\n\n    private static boolean externalStateUpdated(boolean requestedSelected) {\n        System.out.printf(&quot;Updating external state to %s...\\n&quot;, requestedSelected);\n        return true;\n    }\n\n    private static boolean isSelectedInDb() {\n        // assuming it's always true\n        return true;\n    }\n}\n</code></pre>\n<p>Java 8.</p>\n",
    "tags" : [ "java", "swing" ],
    "owner" : {
      "account_id" : 10187542,
      "reputation" : 2667,
      "user_id" : 20692967,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
      "display_name" : "Sergey Zolotarev",
      "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
    },
    "is_answered" : true,
    "view_count" : 93,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1764314157,
    "creation_date" : 1764235745,
    "link" : "https://stackoverflow.com/questions/79831562/intercepting-user-toggle-button-clicks",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79831575,
    "question_id" : 79831562,
    "body" : "<p><code>isArmed()</code> seems to be a good, solid guard against programmatic calls.</p>\n<pre class=\"lang-java prettyprint-override\"><code>        toggleButton.setModel(new JToggleButton.ToggleButtonModel() {\n            @Override\n            public void setSelected(boolean b) {\n                if (isArmed() &amp;&amp; !externalStateUpdated(b)) return;\n                super.setSelected(b);\n            }\n        });\n</code></pre>\n<p>&quot;Armed&quot; basically means &quot;pressed and has a mouse pointer over it&quot;.</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 10187542,
      "reputation" : 2667,
      "user_id" : 20692967,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
      "display_name" : "Sergey Zolotarev",
      "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
    },
    "creation_date" : 1764236431,
    "last_activity_date" : 1764314157,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140881041,
    "post_id" : 79831562,
    "body" : "Well, it does react on something that already happened, in case of <code>ActionListener</code>, it reacts on the event of the user triggering an action, but not necessarily an item change. That’s what the <code>ItemChangeListener</code> reacts to. I think, if you have custom logic for the decision, when to toggle, it would include the logic of a <code>ButtonGroup</code> anyway, if applicable. This would form a kind of new model class. I don’t think it’s necessary to add a new answer; the other Q&amp;A is now visible in the Linked section.",
    "score" : 1,
    "owner" : {
      "account_id" : 3211603,
      "reputation" : 300941,
      "user_id" : 2711488,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/t2hoD.jpg?s=256",
      "display_name" : "Holger",
      "link" : "https://stackoverflow.com/users/2711488/holger"
    },
    "creation_date" : 1764580670,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140877759,
    "post_id" : 79831562,
    "body" : "@Holger Interesting. I assumed a listener by definition reacts to something that&#39;s already happened, it can&#39;t veto (prevent) the event. I tried it, and it surprisingly works. I&#39;ll try to test it more extensively, hoping to find some caveat. For example, it seems <code>ButtonGroup</code>s are <i>not</i> considered by <code>DefaultButtonModel</code> at all (they <i>are</i> considered by <code>JToggleButton.ToggleButtonModel</code>). Anyway, do you want to post?",
    "score" : 0,
    "owner" : {
      "account_id" : 10187542,
      "reputation" : 2667,
      "user_id" : 20692967,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
      "display_name" : "Sergey Zolotarev",
      "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
    },
    "creation_date" : 1764342102,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140877581,
    "post_id" : 79831562,
    "body" : "@SergeyZolotarev of course, I’m referring to the <i>answer</i>’s approach, not the question’s. It uses a <code>ButtonModel</code>, similar to your answer. But it uses the already existing <code>DefaultButtonModel</code>, which is sufficient for informing an <code>ActionListener</code> on user input, without performing a change, so the listener can decide to call <code>setSelected</code> or not. In your case, it could call <code>externalStateUpdated</code>, followed by <code>setSelected</code>. The <code>setSelected</code> call(s) do not trigger action events.",
    "score" : 1,
    "owner" : {
      "account_id" : 3211603,
      "reputation" : 300941,
      "user_id" : 2711488,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/t2hoD.jpg?s=256",
      "display_name" : "Holger",
      "link" : "https://stackoverflow.com/users/2711488/holger"
    },
    "creation_date" : 1764337004,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140876170,
    "post_id" : 79831562,
    "body" : "@Holger do you mean listening to <code>MouseEvent</code>s? If so, it doesn&#39;t consider the fact that buttons can be clicked with key stroked as well (<code>Space</code>)",
    "score" : 0,
    "owner" : {
      "account_id" : 10187542,
      "reputation" : 2667,
      "user_id" : 20692967,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
      "display_name" : "Sergey Zolotarev",
      "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
    },
    "creation_date" : 1764249131,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140876038,
    "post_id" : 79831562,
    "body" : "Can be done the same way as in <a href=\"https://stackoverflow.com/q/79232295/2711488\">this Q&amp;A</a> which discusses this problem for a <code>JCheckBoxMenuItem</code>.",
    "score" : 2,
    "owner" : {
      "account_id" : 3211603,
      "reputation" : 300941,
      "user_id" : 2711488,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/t2hoD.jpg?s=256",
      "display_name" : "Holger",
      "link" : "https://stackoverflow.com/users/2711488/holger"
    },
    "creation_date" : 1764243379,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140875845,
    "post_id" : 79831562,
    "body" : "@Stultuske as I said, <i>&quot;there should be no events if the click is vetoed&quot;</i>. I must prevent not just a vetoed state change, but also <i>handling</i> of that vetoed state change",
    "score" : 0,
    "owner" : {
      "account_id" : 10187542,
      "reputation" : 2667,
      "user_id" : 20692967,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
      "display_name" : "Sergey Zolotarev",
      "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
    },
    "creation_date" : 1764236358,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140875820,
    "post_id" : 79831562,
    "body" : "what makes you think that using ActionListener or similar you can&#39;t &quot;undo&quot; the change?",
    "score" : 0,
    "owner" : {
      "account_id" : 3116234,
      "reputation" : 9469,
      "user_id" : 2636929,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/85fa83a02c04af43fcd224821ca9b750?s=256&d=identicon&r=PG",
      "display_name" : "Stultuske",
      "link" : "https://stackoverflow.com/users/2636929/stultuske"
    },
    "creation_date" : 1764235841,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79831575" : [ {
      "comment_id" : 140877322,
      "post_id" : 79831575,
      "body" : "<a href=\"https://docs.oracle.com/javase/8/docs/api/javax/swing/ButtonModel.html\" rel=\"nofollow noreferrer\">docs.oracle.com/javase/8/docs/api/javax/swing/ButtonModel.ht&zwnj;&#8203;ml</a>",
      "score" : 0,
      "owner" : {
        "account_id" : 3072614,
        "reputation" : 16438,
        "user_id" : 2602877,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/c76ea7b35660e77624550130276c61d3?s=256&d=identicon&r=PG",
        "display_name" : "Christoph Rackwitz",
        "link" : "https://stackoverflow.com/users/2602877/christoph-rackwitz"
      },
      "creation_date" : 1764326667,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140877030,
      "post_id" : 79831575,
      "body" : "Could you explain what <b>isArmed()</b> does, so your self-answer can help others, and you&#39;ll get some votes in the process.",
      "score" : 0,
      "owner" : {
        "account_id" : 10843443,
        "reputation" : 918,
        "user_id" : 20882864,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/CCQCy.jpg?s=256",
        "display_name" : "Marce Puente",
        "link" : "https://stackoverflow.com/users/20882864/marce-puente"
      },
      "creation_date" : 1764313886,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140876163,
      "post_id" : 79831575,
      "body" : "@MarcePuente From <code>JToggleButton.ToggleButtonModel</code> (or rather its supertype, <code>javax.swing.ButtonModel</code>)",
      "score" : 0,
      "owner" : {
        "account_id" : 10187542,
        "reputation" : 2667,
        "user_id" : 20692967,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
        "display_name" : "Sergey Zolotarev",
        "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
      },
      "creation_date" : 1764248973,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}