{
  "question" : {
    "question_id" : 79561375,
    "title" : "mapstrcut cannot mapping custom type to protobuf repeated filed",
    "body" : "<p>I'm want mapping custom type to protobuf repeated field. Found it occurred compile error.</p>\n<p>Example:</p>\n<ol start=\"0\">\n<li>define annotation</li>\n</ol>\n<pre><code>import java.lang.annotation.ElementType;\nimport java.lang.annotation.Retention;\nimport java.lang.annotation.RetentionPolicy;\nimport java.lang.annotation.Target;\nimport org.mapstruct.Qualifier;\n\n\n@Qualifier\n@Target(ElementType.TYPE)\n@Retention(RetentionPolicy.CLASS)\npublic @interface CustomConverter {\n}\n\n@Qualifier\n@Target(ElementType.METHOD)\n@Retention(RetentionPolicy.CLASS)\npublic @interface String2List {\n}\n</code></pre>\n<ol>\n<li>custom mapping method:</li>\n</ol>\n<pre><code>@CustomConverter\npublic class StringToListConverter {\n\n    @String2List\n    public List&lt;String&gt; splitDataToRoles(String data) {\n        return data != null ?\n                Arrays.stream(data.split(&quot;,&quot;))\n                        .map(String::trim)\n                        .collect(Collectors.toList()) :\n                Collections.emptyList();\n    }\n\n}\n\n</code></pre>\n<ol start=\"2\">\n<li>define java class</li>\n</ol>\n<pre><code>import lombok.Getter;\nimport lombok.Setter;\n\n@Getter\n@Setter\npublic class User {\n\n    public String data;\n    // Getter/Setter\n}\n\n</code></pre>\n<ol start=\"3\">\n<li>define protobuf message</li>\n</ol>\n<pre><code>message UserProto {\n  repeated string roles = 1;\n}\n</code></pre>\n<ol start=\"4\">\n<li>define mapper:</li>\n</ol>\n<pre><code>import org.mapstruct.CollectionMappingStrategy;\nimport org.mapstruct.Mapper;\nimport org.mapstruct.Mapping;\nimport org.mapstruct.factory.Mappers;\n\n@Mapper(uses = StringToListConverter.class, collectionMappingStrategy = CollectionMappingStrategy.ADDER_PREFERRED)\npublic interface UserMapper {\n\n    UserMapper INSTANCE = Mappers.getMapper(UserMapper.class);\n\n    @Mapping(source = &quot;data&quot;, target = &quot;roles&quot;, qualifiedBy = {CustomConverter.class, String2List.class})\n    UserProto toProto(User user);\n\n}\n\n</code></pre>\n<p>compile result:<code>error: Qualifier error. No method found annotated with: [ @CustomConverter and @String2List ].</code></p>\n<p>By the way, if I convert to java class rather then <code>UserProto</code>, it works fine.</p>\n<pre><code>...\n@Getter\n@Setter\npublic class UserV2 {\n    public List&lt;String&gt; roles;\n    // Getter/Setter\n}\n\n...\n@Mapping(source = &quot;data&quot;, target = &quot;roles&quot;, qualifiedBy = {CustomConverter.class, String2List.class})\nUserV2 toProto(User user);\n</code></pre>\n",
    "tags" : [ "java", "mapstruct" ],
    "owner" : {
      "account_id" : 6289587,
      "reputation" : 2574,
      "user_id" : 4887726,
      "user_type" : "registered",
      "accept_rate" : 66,
      "profile_image" : "https://www.gravatar.com/avatar/92923f6040c04138687e0b60c6447545?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "LoranceChen",
      "link" : "https://stackoverflow.com/users/4887726/lorancechen"
    },
    "is_answered" : false,
    "view_count" : 64,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1744095133,
    "creation_date" : 1744095133,
    "link" : "https://stackoverflow.com/questions/79561375/mapstrcut-cannot-mapping-custom-type-to-protobuf-repeated-filed",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140311885,
    "post_id" : 79561375,
    "body" : "@LucaBassoRicci this problem focus on repeated field convertion. Absolutely different with your link which about ignore some field. The only same things is about grpc conversion scenario.",
    "score" : 0,
    "owner" : {
      "account_id" : 6289587,
      "reputation" : 2574,
      "user_id" : 4887726,
      "user_type" : "registered",
      "accept_rate" : 66,
      "profile_image" : "https://www.gravatar.com/avatar/92923f6040c04138687e0b60c6447545?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "LoranceChen",
      "link" : "https://stackoverflow.com/users/4887726/lorancechen"
    },
    "creation_date" : 1744118249,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140310698,
    "post_id" : 79561375,
    "body" : "This question is similar to: <a href=\"https://stackoverflow.com/questions/72646659/customize-mapstruct-to-ignore-protobuff-fields\">Customize mapstruct to ignore protobuff fields</a>. If you believe it’s different, please <a href=\"https://stackoverflow.com/posts/79561375/edit\">edit</a> the question, make it clear how it’s different and/or how the answers on that question are not helpful for your problem.",
    "score" : 0,
    "owner" : {
      "account_id" : 3052937,
      "reputation" : 18534,
      "user_id" : 2587166,
      "user_type" : "registered",
      "accept_rate" : 83,
      "profile_image" : "https://i.sstatic.net/pgHgd.jpg?s=256",
      "display_name" : "Luca Basso Ricci",
      "link" : "https://stackoverflow.com/users/2587166/luca-basso-ricci"
    },
    "creation_date" : 1744097846,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}