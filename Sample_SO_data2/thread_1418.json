{
  "question" : {
    "question_id" : 79713137,
    "title" : "Using Windows cert store in Java application for https fails with java.security.InvalidAlgorithmParameterException",
    "body" : "<p>I have a Java application running on Windows 11 clients. It connects to  a Java server application via https. The JRE is OpenJDK Runtime Environment (Temurin)(build 1.8.0_452-b09). The server is Linux RHEL. When setting up the required root certificates in the client JREs cacert file, all works correctly. I can also access the https resource via browser. So the browser already knows the companies certificates.</p>\n<p>Certificate creation : For all actions I use openssl. I created a certificate request and got a certificate from my company using the companies standard procedure. I created a password protected keystore. Inside the Java application a Jetty instance is used. I set it up to support https. As I said, when I install the root and intermediate certificate into the clients cert store file, it all works.</p>\n<p>Now I try to not use the JREs cert store but the Windows cert store.\nI already studied this : <a href=\"https://stackoverflow.com/questions/34166304/accessing-windows-certificate-store-certs-via-java\">Accessing Windows Certificate Store certs via Java?</a>.</p>\n<p>When I configure this :</p>\n<pre><code>-Djavax.net.ssl.trustStore=NUL\n-Djavax.net.ssl.trustStoreType=Windows-ROOT\n</code></pre>\n<p>it ends up with : <code>javax.net.ssl.SSLHandshakeException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</code></p>\n<p>When I configure this :</p>\n<pre><code>-Djavax.net.ssl.trustStore=NUL\n-Djavax.net.ssl.trustStoreType=Windows-MY\n</code></pre>\n<p>it ends up with : <code>javax.net.ssl.SSLException: Unexpected error: java.security.InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty</code></p>\n<p>Setting</p>\n<pre><code>-Djavax.net.debug=ssl\n</code></pre>\n<p>shows :</p>\n<pre><code>javax.net.ssl|FINE|01|main|2025-07-24 12:20:49.964 CEST|SSLCipher.java:438|jdk.tls.keyLimits:  entry = AES/GCM/NoPadding KeyUpdate 2^37. AES/GCM/NOPADDING:KEYUPDATE = 137438953472\njavax.net.ssl|FINE|01|main|2025-07-24 12:20:55.083 CEST|Utilities.java:73|the previous server name in SNI (type=host_name (0), value=full.qualified.host.name) was replaced with (type=host_name (0), value=full.qualified.host.name)\njavax.net.ssl|FINE|01|main|2025-07-24 12:20:55.136 CEST|SSLCipher.java:1817|KeyLimit read side: algorithm = AES/GCM/NOPADDING:KEYUPDATE\ncountdown value = 137438953472\njavax.net.ssl|FINE|01|main|2025-07-24 12:20:55.141 CEST|SSLCipher.java:1971|KeyLimit write side: algorithm = AES/GCM/NOPADDING:KEYUPDATE\ncountdown value = 137438953472\njavax.net.ssl|WARNING|01|main|2025-07-24 12:20:55.162 CEST|SSLSocketImpl.java:1546|handling exception (\n&quot;throwable&quot; : {\n  java.lang.RuntimeException: Unexpected error: java.security.InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty`\n</code></pre>\n<p>So it seems that the trust store cannot be accessed for some reason.</p>\n<p>Any help on this is highly appreciated.</p>\n<p><strong>[Update]</strong></p>\n<p>I found the solution - it is quit simple if you know the backgrounds ;). These stackoverflow questions led me to the answer :\n<a href=\"https://stackoverflow.com/questions/63610207/java-client-not-picking-root-intermediate-certificates-from-windows-trust-store?rq=2\">Java client not picking root/intermediate certificates from Windows Trust Store</a>\n<a href=\"https://stackoverflow.com/questions/54612772/does-a-tls-client-needs-to-have-intermediate-ca-in-the-trust-store\">Does a TLS client needs to have intermediate CA in the trust store?</a></p>\n<p>I followed the steps as described here :\n<a href=\"https://docs.cloudbees.com/docs/cloudbees-ci-kb/latest/client-and-managed-controllers/how-to-setup-https-within-jetty-with-intermediate-certificates\" rel=\"nofollow noreferrer\">https://docs.cloudbees.com/docs/cloudbees-ci-kb/latest/client-and-managed-controllers/how-to-setup-https-within-jetty-with-intermediate-certificates</a></p>\n<p>Long story short : The server keystore containing the secret also needs the root and intermediate certificates. Then on the Windows site everything works as expected.\nI configure this :</p>\n<pre><code>-Djavax.net.ssl.trustStore=NUL\n-Djavax.net.ssl.trustStoreType=Windows-ROOT\n</code></pre>\n",
    "tags" : [ "java", "windows", "certificate" ],
    "owner" : {
      "account_id" : 8862748,
      "reputation" : 11,
      "user_id" : 6618645,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/7c4ae0c452180f95a234ca6e84d9c83f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "singtur",
      "link" : "https://stackoverflow.com/users/6618645/singtur"
    },
    "is_answered" : false,
    "view_count" : 174,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1753454999,
    "creation_date" : 1753350927,
    "link" : "https://stackoverflow.com/questions/79713137/using-windows-cert-store-in-java-application-for-https-fails-with-java-security",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140615222,
    "post_id" : 79713137,
    "body" : "Hi Robert, thanks for that. For Linux boxes it is easy. There I can simply configure the appropriate cert store file from the system using -Djavax.net.ssl.trustStore=/path/to/system/trustStore . This works without any problems.",
    "score" : 0,
    "owner" : {
      "account_id" : 8862748,
      "reputation" : 11,
      "user_id" : 6618645,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/7c4ae0c452180f95a234ca6e84d9c83f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "singtur",
      "link" : "https://stackoverflow.com/users/6618645/singtur"
    },
    "creation_date" : 1753364875,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140614973,
    "post_id" : 79713137,
    "body" : "For internal servers you can use <a href=\"https://testssl.sh\" rel=\"nofollow noreferrer\">testssl.sh</a>. It requires a Linux system to run and will check the complete SSL/TLS handshake, the certificate chain, available ciphers and so on. A very useful tool...",
    "score" : 0,
    "owner" : {
      "account_id" : 50585,
      "reputation" : 43469,
      "user_id" : 150978,
      "user_type" : "registered",
      "accept_rate" : 78,
      "profile_image" : "https://www.gravatar.com/avatar/feadc214792e2581c3c750140e3eb2c7?s=256&d=identicon&r=PG",
      "display_name" : "Robert",
      "link" : "https://stackoverflow.com/users/150978/robert"
    },
    "creation_date" : 1753360324,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140614887,
    "post_id" : 79713137,
    "body" : "Hi Robert, ah, I forgot to mention that is in my companies intra net, so no public communication at all. The required root and intermediate CAs are from the company too.",
    "score" : 0,
    "owner" : {
      "account_id" : 8862748,
      "reputation" : 11,
      "user_id" : 6618645,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/7c4ae0c452180f95a234ca6e84d9c83f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "singtur",
      "link" : "https://stackoverflow.com/users/6618645/singtur"
    },
    "creation_date" : 1753358692,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140614721,
    "post_id" : 79713137,
    "body" : "Webbrowser are optimized for convenience not for standard conformity. All webbrowsers are shipped with a large set of intermedia CA certificates and they also collect them from valid sites you surf to. Therefore &quot;works in web browser&quot; means nothing regarding TLS certificate chain. If your server is public test it with <a href=\"https://www.ssllabs.com/ssltest\" rel=\"nofollow noreferrer\">ssllabs.com/ssltest</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 50585,
      "reputation" : 43469,
      "user_id" : 150978,
      "user_type" : "registered",
      "accept_rate" : 78,
      "profile_image" : "https://www.gravatar.com/avatar/feadc214792e2581c3c750140e3eb2c7?s=256&d=identicon&r=PG",
      "display_name" : "Robert",
      "link" : "https://stackoverflow.com/users/150978/robert"
    },
    "creation_date" : 1753355188,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140614595,
    "post_id" : 79713137,
    "body" : "Hi Robert, thanks for the quick reply. When I access the resource via a browser, it works. So I assume that all required certificates of the chain are available. (As described in the question I also added the root and intermediate certificates to the JREs cacert store file. This also works.) Just read your hint with the debug option. I&#39;ll try . . .",
    "score" : 0,
    "owner" : {
      "account_id" : 8862748,
      "reputation" : 11,
      "user_id" : 6618645,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/7c4ae0c452180f95a234ca6e84d9c83f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "singtur",
      "link" : "https://stackoverflow.com/users/6618645/singtur"
    },
    "creation_date" : 1753352369,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140614578,
    "post_id" : 79713137,
    "body" : "Assuming that the rot CA certificate used by the server is present in the system wide trust store the error &quot;unable to find valid certification path to requested target&quot; may indicate that the used server is misconfigured. Make sure is also sends the necessary intermediate certificates. For the second error you can try to enabled SSL/TLS debugging in Java: <code>-Djavax.net.debug=ssl</code>",
    "score" : 0,
    "owner" : {
      "account_id" : 50585,
      "reputation" : 43469,
      "user_id" : 150978,
      "user_type" : "registered",
      "accept_rate" : 78,
      "profile_image" : "https://www.gravatar.com/avatar/feadc214792e2581c3c750140e3eb2c7?s=256&d=identicon&r=PG",
      "display_name" : "Robert",
      "link" : "https://stackoverflow.com/users/150978/robert"
    },
    "creation_date" : 1753351998,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}