{
  "question" : {
    "question_id" : 79572412,
    "title" : "Extending a lombok builder without breaking chaining",
    "body" : "<p>I have a class with a builder pattern that extends a class also with a builder (using lombok <code>@SuperBuilder</code>).</p>\n<p>It works fine, but the problem is that return type of methods in the parent builder are naturally of the parent builder - which means that chains breaks in the actual usage of the builders if I use any parent builder methods before any child builder methods.</p>\n<pre><code>@Builder\npublic class Activity {\n    protected String foo;\n    protected String bar;\n\n    public static abstract class ActivityBuilder {\n        public ActivityBuilder baz(String baz) {\n            // ... do something\n            return this;\n        }\n    }\n}\n\n\n@SuperBuilder\npublic class DetailedActivity extends Activity {\n\n    public static abstract class DetailedActivityBuilder extends ActivityBuilder {\n        public DetailedActivityBuilder platform(Platform platform) {\n            this.foo(platform.foo);\n            this.bar(platform.bar)\n            return this;\n        }\n    }\n}\n\n// Works because &quot;DetailedActivityBuilder&quot; methods come first:\nDetailedActivityBuilder.builder().platform(platformData).foo()\n\n// Fails because the parent builder returns ActivityBuilder \nDetailedActivityBuilder.builder().foo().platform(platformData)&quot;\n</code></pre>\n<p>Is there any approach to returning the correct type and allowing chaining to work in any order?</p>\n<p>I thought about passing a generic to <code>ActivityBuilder</code> but that only fixes custom methods - lombok generated methods still return the <code>ActivityBuilder</code> type.</p>\n",
    "tags" : [ "java", "lombok" ],
    "owner" : {
      "account_id" : 48251,
      "reputation" : 38013,
      "user_id" : 143269,
      "user_type" : "registered",
      "accept_rate" : 48,
      "profile_image" : "https://www.gravatar.com/avatar/c601d978f9294ba640b0c82f4b07ecdd?s=256&d=identicon&r=PG",
      "display_name" : "helion3",
      "link" : "https://stackoverflow.com/users/143269/helion3"
    },
    "is_answered" : true,
    "view_count" : 46,
    "answer_count" : 1,
    "score" : 3,
    "last_activity_date" : 1744614010,
    "creation_date" : 1744609799,
    "link" : "https://stackoverflow.com/questions/79572412/extending-a-lombok-builder-without-breaking-chaining",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79572437,
    "question_id" : 79572412,
    "body" : "<p>It is important that <code>Activity</code> is <code>@SuperBuilder</code> too. From <a href=\"https://projectlombok.org/features/experimental/SuperBuilder\" rel=\"nofollow noreferrer\">documentation</a>:</p>\n<blockquote>\n<p>The <code>@SuperBuilder</code> annotation produces complex builder APIs for your classes. In contrast to <code>@Builder</code>, <code>@SuperBuilder</code> also works with fields from superclasses. However, it only works for types. Most importantly, it requires that <em>all superclasses</em> also have the <code>@SuperBuilder</code> annotation.</p>\n</blockquote>\n<p>Then, the builder classes need to match what lombok would have generated. It should have 2 type parameters, <code>C</code> representing the type that is being built, and <code>B</code> representing the builder type that the builder methods return.</p>\n<p>Your custom methods should return <code>B</code>, and use <code>return self();</code> at the end, instead of <code>return this;</code>. <code>self()</code> is a method generated by <code>@SuperBuilder</code>.</p>\n<pre><code>@SuperBuilder\nclass Activity {\n    protected String foo;\n    protected String bar;\n\n    public static abstract class ActivityBuilder&lt;C extends Activity, B extends ActivityBuilder&lt;C, B&gt;&gt; {\n        public B baz(String baz) {\n            // ... do something\n            return self();\n        }\n    }\n}\n\n@SuperBuilder\nclass DetailedActivity extends Activity {\n\n    public static abstract class DetailedActivityBuilder&lt;C extends DetailedActivity, B extends DetailedActivityBuilder&lt;C, B&gt;&gt; extends ActivityBuilder&lt;C, B&gt; {\n        public B platform(Platform platform) {\n            // do something else...\n            return self();\n        }\n    }\n}\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 6651855,
      "reputation" : 292280,
      "user_id" : 5133585,
      "user_type" : "registered",
      "accept_rate" : 96,
      "profile_image" : "https://i.sstatic.net/dfqcw.png?s=256",
      "display_name" : "Sweeper",
      "link" : "https://stackoverflow.com/users/5133585/sweeper"
    },
    "creation_date" : 1744610649,
    "last_activity_date" : 1744614010,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79572437" : [ {
      "comment_id" : 140333359,
      "post_id" : 79572437,
      "body" : "I was starting to figure out this generics approach before I posted but as I&#39;m my dev expertise isn&#39;t in Java I quickly started to feel like I was going down a goofy path. But this answer clarifies some things I missed and confirms it&#39;s how it has to work!",
      "score" : 0,
      "owner" : {
        "account_id" : 48251,
        "reputation" : 38013,
        "user_id" : 143269,
        "user_type" : "registered",
        "accept_rate" : 48,
        "profile_image" : "https://www.gravatar.com/avatar/c601d978f9294ba640b0c82f4b07ecdd?s=256&d=identicon&r=PG",
        "display_name" : "helion3",
        "link" : "https://stackoverflow.com/users/143269/helion3"
      },
      "creation_date" : 1744642363,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}