{
  "question" : {
    "question_id" : 79616321,
    "title" : "403 Forbidden on login via browser when Spring Boot app runs from JAR, but works in IDE and API clients",
    "body" : "<p>I'm facing an issue with my Spring Boot application. When I run the app directly from my IDE, everything works fine — I can log in from my Angular frontend (via POST /login) without any problems.</p>\n<p>However, after I've packaged the app into a JAR file using <code>mvn clean install</code> and run it with <code>java -jar my-app.jar</code>, I get the following behavior:</p>\n<ul>\n<li><p>Logging in via Postman or Insomnia still works (POST request to /login returns token as expected).</p>\n</li>\n<li><p>Logging in via the Angular frontend (in the browser) fails with a 403 Forbidden error.</p>\n</li>\n</ul>\n<p>Backend logs show:</p>\n<blockquote>\n<p>HttpRequestMethodNotSupportedException: Request method 'GET' is not supported</p>\n</blockquote>\n<p>What I've checked:</p>\n<ul>\n<li>CORS configuration in SecurityConfiguration allows <code>http://localhost:4200</code> and includes POST method.</li>\n</ul>\n<pre class=\"lang-java prettyprint-override\"><code>public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n        http.csrf(AbstractHttpConfigurer::disable)\n                .cors(cors -&gt; cors.configurationSource(request -&gt; {\n                    var corsConfiguration = new CorsConfiguration();\n                    corsConfiguration.setAllowedOriginPatterns(List.of(&quot;http://localhost:4200&quot;));\n                    corsConfiguration.setAllowedMethods(List.of(&quot;GET&quot;,&quot;PATCH&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;, &quot;OPTIONS&quot;));\n                    corsConfiguration.setAllowedHeaders(List.of(&quot;Authorization&quot;, &quot;Content-Type&quot;));\n                    \n                    corsConfiguration.setAllowCredentials(true);\n                    return corsConfiguration;\n                }))\n                .authorizeHttpRequests(request -&gt; request\n                        .requestMatchers(&quot;/&quot;,&quot;/login&quot;,&quot;/join&quot;).permitAll()\n                        .requestMatchers(&quot;/users&quot;).hasRole(&quot;ADMIN&quot;)\n                        .requestMatchers(&quot;/uploads/**&quot;).permitAll()\n                        .anyRequest().authenticated())\n                .sessionManagement(manager -&gt; manager.sessionCreationPolicy(STATELESS))\n                .authenticationProvider(authenticationProvider())\n                .addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);\n        return http.build();\n    }\n</code></pre>\n<ul>\n<li>Angular is sending a POST request to <code>/login</code>.</li>\n</ul>\n<pre class=\"lang-js prettyprint-override\"><code>login(loginRequest: LoginRequest): Observable&lt;any&gt; {\n    this.dataService.log(true);\n    return this.http.post&lt;AuthResponse&gt;(`${environment.baseURL}/login`, loginRequest\n)\n    .pipe(\n      tap((response: AuthResponse) =&gt; {\n        if (response.token) {\n          localStorage.setItem('jwtToken', response.token);\n        }\n      }),\n      catchError(error =&gt; {\n        console.error('Login error:', error);\n        return throwError(() =&gt; new Error(error.error?.message || 'Login failed. Please try again.'));\n      })\n    );\n  }\n</code></pre>\n<ul>\n<li>Angular interceptor:</li>\n</ul>\n<pre class=\"lang-js prettyprint-override\"><code>export const headerInterceptor: HttpInterceptorFn = (req: HttpRequest&lt;unknown&gt;,\n  next: HttpHandlerFn\n): Observable&lt;HttpEvent&lt;unknown&gt;&gt; =&gt; {\n  const Authorization = localStorage.getItem('jwtToken') ? `Bearer ${localStorage.getItem('jwtToken')}` : '';\n  if(!req.url.includes('login') &amp;&amp; !req.url.includes('join'))\n    return next(req.clone({ setHeaders: { Authorization } }));\n  else \n  return next(req);\n};\n</code></pre>\n<ul>\n<li>environment.prod.ts:</li>\n</ul>\n<pre class=\"lang-js prettyprint-override\"><code>export const environment = {\n    production: true,\n    baseURL: &quot;http://localhost:8080&quot;,\n    eventsURL: &quot;http://localhost:8080/events&quot;,\n    homeURL: &quot;http://localhost:8080/home&quot;,\n    citiesURL: &quot;http://localhost:8080/cities&quot;,\n    commentsURL: &quot;http://localhost:8080/comments&quot;,\n    usersURL: &quot;http://localhost:8080/users&quot;\n};\n</code></pre>\n<ul>\n<li>and in angular.json:</li>\n</ul>\n<pre class=\"lang-json prettyprint-override\"><code>&quot;fileReplacements&quot;: [\n                {\n                  &quot;replace&quot;: &quot;src/environments/environment.ts&quot;,\n                  &quot;with&quot;: &quot;src/environments/environment.prod.ts&quot;\n                }\n              ]\n</code></pre>\n<ul>\n<li>in application.yml:</li>\n</ul>\n<pre class=\"lang-yaml prettyprint-override\"><code>profiles:\n  active: prod\n</code></pre>\n<ul>\n<li>start .jar with</li>\n</ul>\n<pre class=\"lang-none prettyprint-override\"><code>java -jar my-app.jar --spring.profiles.active=prod\n</code></pre>\n<ul>\n<li><p>Works perfectly in IDE.</p>\n</li>\n<li><p>Fails only after running from the JAR.</p>\n</li>\n</ul>\n<p>No apparent difference in logs or stack traces that explain why only browser requests fail.</p>\n<p>Question:</p>\n<p>What could cause Spring Boot to behave differently (especially for browser-based login requests) when running from a JAR versus running from the IDE?</p>\n",
    "tags" : [ "java", "angular", "spring", "spring-boot", "jwt" ],
    "owner" : {
      "account_id" : 41616869,
      "reputation" : 1,
      "user_id" : 30373557,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/da0fce62942452c0faa85f4d61544002?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Sergey Bazhukov",
      "link" : "https://stackoverflow.com/users/30373557/sergey-bazhukov"
    },
    "is_answered" : false,
    "view_count" : 137,
    "answer_count" : 2,
    "score" : -1,
    "last_activity_date" : 1764607196,
    "creation_date" : 1746953967,
    "link" : "https://stackoverflow.com/questions/79616321/403-forbidden-on-login-via-browser-when-spring-boot-app-runs-from-jar-but-works",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79616576,
    "question_id" : 79616321,
    "body" : "<p>If your IDE is eclipse, and you are using maven (I do not know about gradle) check that none of the security starters are imported as a test dependency. Eclipse has a single classpath, so it could be that a security starter is present in eclipse because it is using a single path, but absent when you package it. Same thing can happen with the <code>.properties</code> files configuring your security being in the <code>./src/test/resources</code></p>\n<p>Edit: I have not used eclipse in the last 2 years so the single classpath might no longer be a thing</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1582578,
      "reputation" : 101,
      "user_id" : 1467602,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/68d286d9eb2a785b6484a0d04f1bdb98?s=256&d=identicon&r=PG",
      "display_name" : "stelios",
      "link" : "https://stackoverflow.com/users/1467602/stelios"
    },
    "creation_date" : 1746973502,
    "last_activity_date" : 1746973502,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79835084,
    "question_id" : 79616321,
    "body" : "<p>This isnt Spring changing in a jar, its just the browser messing with you. In the jar version your frontend ends up doing a GET /login, but your backend only knows POST /login, so Spring throws that lovely <code>GET not supported </code> thing. <br> Postman works because it sends a clean POST and doesnt try to be smart. The browser gets a  <code>401</code> somewhere, tries to load the route, boom, GET hits your login endpoint and everything blows up. <br>\nIn your IDE it probably never hits that path because your dev setup or proxy hides the problem. In the jar, Angular prod env points straight to <code>http://localhost:8080/login</code>, so your SPA route and your auth endpoint fight each other. <br></p>\n<p>Just move the auth to something like POST <code>/api/auth/login </code> and leave <code>/login</code> for Angular. No more GET vs POST war, and both IDE and jar behave the same.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 12972904,
      "reputation" : 1113,
      "user_id" : 9377995,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Hl13jffO.png?s=256",
      "display_name" : "gdoura mohamed",
      "link" : "https://stackoverflow.com/users/9377995/gdoura-mohamed"
    },
    "creation_date" : 1764607196,
    "last_activity_date" : 1764607196,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140417739,
    "post_id" : 79616321,
    "body" : "For tracing the issue, can you allow all origins and the headers? corsConfiguration.setAllowedOriginPatterns(List.of(&quot;<i>&quot;)); corsConfiguration.setAllowedHeaders(List.of(&quot;</i>&quot;));",
    "score" : 0,
    "owner" : {
      "account_id" : 14492892,
      "reputation" : 126,
      "user_id" : 10468506,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Kn6KZIlG.jpg?s=256",
      "display_name" : "Yahya Ibrahim",
      "link" : "https://stackoverflow.com/users/10468506/yahya-ibrahim"
    },
    "creation_date" : 1747050672,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140417159,
    "post_id" : 79616321,
    "body" : "It seems suspicious that your IDE runs the project in <code>prod</code> profile (I think no profile or <code>dev</code> profile is more common). Why don&#39;t you add some logs in you Application class to check out which profile it is really running. Then use the same profile in the command line.",
    "score" : 0,
    "owner" : {
      "account_id" : 269267,
      "reputation" : 4270,
      "user_id" : 558502,
      "user_type" : "registered",
      "accept_rate" : 71,
      "profile_image" : "https://www.gravatar.com/avatar/2fd6831f047d384983f66cd6d559046c?s=256&d=identicon&r=PG",
      "display_name" : "9dan",
      "link" : "https://stackoverflow.com/users/558502/9dan"
    },
    "creation_date" : 1747038849,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140416545,
    "post_id" : 79616321,
    "body" : "thanks, using @PreAuthorize is a good try but still fails",
    "score" : 0,
    "owner" : {
      "account_id" : 41616869,
      "reputation" : 1,
      "user_id" : 30373557,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/da0fce62942452c0faa85f4d61544002?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Sergey Bazhukov",
      "link" : "https://stackoverflow.com/users/30373557/sergey-bazhukov"
    },
    "creation_date" : 1747021902,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140416539,
    "post_id" : 79616321,
    "body" : "Have you used <code>@PreAuthorize</code> annotation on your login controller method?",
    "score" : 0,
    "owner" : {
      "account_id" : 14331879,
      "reputation" : 346,
      "user_id" : 10352428,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/619aa63a0625944a2aa2fd0fdacb95cb?s=256&d=identicon&r=PG",
      "display_name" : "萝莉w",
      "link" : "https://stackoverflow.com/users/10352428/%e8%90%9d%e8%8e%89w"
    },
    "creation_date" : 1747021331,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140416531,
    "post_id" : 79616321,
    "body" : "adding web.ignoring() did not solve my problem, I get a 405 error on /login and a 403 on /",
    "score" : 0,
    "owner" : {
      "account_id" : 41616869,
      "reputation" : 1,
      "user_id" : 30373557,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/da0fce62942452c0faa85f4d61544002?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Sergey Bazhukov",
      "link" : "https://stackoverflow.com/users/30373557/sergey-bazhukov"
    },
    "creation_date" : 1747021220,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140415133,
    "post_id" : 79616321,
    "body" : "you can skip --spring.profiles.active in the cli since you are activating profile via application.yml",
    "score" : 0,
    "owner" : {
      "account_id" : 1658807,
      "reputation" : 32708,
      "user_id" : 1527544,
      "user_type" : "registered",
      "accept_rate" : 54,
      "profile_image" : "https://www.gravatar.com/avatar/6665878d41d42307eb53e9fae311a471?s=256&d=identicon&r=PG",
      "display_name" : "Antoniossss",
      "link" : "https://stackoverflow.com/users/1527544/antoniossss"
    },
    "creation_date" : 1746959396,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140415109,
    "post_id" : 79616321,
    "body" : "For local dev server try this one <a href=\"https://angular.dev/tools/cli/serve#proxying-to-a-backend-server\" rel=\"nofollow noreferrer\">angular.dev/tools/cli/serve#proxying-to-a-backend-server</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 22147751,
      "reputation" : 657,
      "user_id" : 16396735,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/0v13k.jpg?s=256",
      "display_name" : "Evgeny Gurevich",
      "link" : "https://stackoverflow.com/users/16396735/evgeny-gurevich"
    },
    "creation_date" : 1746957722,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79616576" : [ {
      "comment_id" : 140416534,
      "post_id" : 79616576,
      "body" : "No, I don&#39;t use Eclipse.",
      "score" : 0,
      "owner" : {
        "account_id" : 41616869,
        "reputation" : 1,
        "user_id" : 30373557,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/da0fce62942452c0faa85f4d61544002?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Sergey Bazhukov",
        "link" : "https://stackoverflow.com/users/30373557/sergey-bazhukov"
      },
      "creation_date" : 1747021249,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}