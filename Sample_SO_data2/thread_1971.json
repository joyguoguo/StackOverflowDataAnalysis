{
  "question" : {
    "question_id" : 79662530,
    "title" : "JDK Flight Recorder (JFR) error - &quot;event is not allowed under control&quot;",
    "body" : "<p>I am using JDK Mission Control (JMC) 9.1.0 and attempting to connect to an Eclipse Temurin OpenJDK 21.0.2 JVM on the same machine. I'm specifically trying to initiate a Flight Recording within the JMC by double clicking on Fight Recorder on the sidebar. On Eclipse Temurin OpenJDK 11.0.18 and Eclipse Temurin OpenJDK 17.0.6, this pops up a window where I can configure a profile and start the flight recording. On Java21, I get an error: &quot;event is not allowed under control&quot;. I have searched everywhere can can find no information on this error although I assume it is some security restriction related to either the user or the profile data (i'm attempting to use the default profile).</p>\n<pre><code>**Error:**\n\nevent is not allowed under control\n\n**JVM:**\n\nTemurin OpenJDK 21.0.2\n\nopenjdk 21.0.2 2024-01-16 LTS\nOpenJDK Runtime Environment Temurin-21.0.2+13 (build 21.0.2+13-LTS)\nOpenJDK 64-Bit Server VM Temurin-21.0.2+13 (build 21.0.2+13-LTS, mixed mode)\n\nCurrent configuration:\n\n**jvm config:**\n\n-Dcom.sun.management.config.file=jmx-config.properties\n-Djavax.net.ssl.trustStore=jmx-truststore.jks\n-Djavax.net.ssl.trustStorePassword=changeit\n-Djavax.net.ssl.keyStore=jmx-keystore.jks\n-Djavax.net.ssl.keyStorePassword=changeit\n-XX:StartFlightRecording=name=&quot;hotspot-id-1-settings-default&quot;,settings=default\n\n**jmx-config.properties:**\n\ncom.sun.management.jmxremote=true\ncom.sun.management.jmxremote.port=1099\ncom.sun.management.jmxremote.local.only=true\ncom.sun.management.jmxremote.authenticate=true\ncom.sun.management.jmxremote.access.file=jmxremote.access\ncom.sun.management.jmxremote.password.file=jmxremote.password\ncom.sun.management.jmxremote.ssl=true\ncom.sun.management.jmxremote.ssl.need.client.auth=true\n\n**jmxremote.access**\n\nadmin readwrite\nuser  readonly\n\nnote: i'm connecting as admin\n</code></pre>\n<p>Things I have tried:</p>\n<ul>\n<li>I have tried connecting with JMX with secururity (authnentication/ssl) and without it -- no difference</li>\n<li>I have tried agent mode -- no difference</li>\n<li>I have tried changing auth permissions as documented here -- no difference.</li>\n</ul>\n<p><a href=\"https://stackoverflow.com/questions/28189529/java-flight-recorder-does-it-need-jmx-readwrite-access-or-is-readonly-enough\">Java Flight Recorder: Does it need JMX readwrite access or is readonly enough?</a></p>\n<ul>\n<li><p>I have tried running the same software with Java11 and Java17 and it works in both of these JDKs and fails only in Java 21 across two different apps.</p>\n</li>\n<li><p>I have tried inaiting flight recording via &quot;JMX operations&quot; (JFR.start) and it works there -- I just can't initiate it via JMC UI where I'm prompting to select a duration, profile, etc</p>\n</li>\n<li><p>I have tried initiating recording on startup and it works there</p>\n</li>\n<li><p>I have tried various combinations of jmxremote.local.only -- no difference</p>\n</li>\n<li><p>I have enabled fine logging of and it did not help.</p>\n<p>~/Desktop/JDK\\ Mission\\ Control.app/Contents/MacOS/jmc -consoleLog -debug 2&gt;&amp;1 | more</p>\n<p>Jun 11, 2025 3:40:55 PM org.openjdk.jmc.flightrecorder.configuration.model.xml.JFCXMLValidator validate\nFINE: Running JFC validation on Continuous</p>\n</li>\n</ul>\n<p>!ENTRY org.openjdk.jmc.ui.common 4 0 2025-06-11 15:40:55.753\n!MESSAGE event is not allowed under control</p>\n<p>There appears to have been some change in Java21 that I can't quite put my finger on. I'm traced the message down to here.</p>\n<p><a href=\"https://github.com/openjdk/jmc/blob/2458719dcc9bc11e94fb21226f6e5e0f1bdab740/core/org.openjdk.jmc.flightrecorder.configuration/src/main/java/org/openjdk/jmc/flightrecorder/configuration/model/xml/XMLTagInstance.java#L90\" rel=\"nofollow noreferrer\">https://github.com/openjdk/jmc/blob/2458719dcc9bc11e94fb21226f6e5e0f1bdab740/core/org.openjdk.jmc.flightrecorder.configuration/src/main/java/org/openjdk/jmc/flightrecorder/configuration/model/xml/XMLTagInstance.java#L90</a></p>\n",
    "tags" : [ "java", "jfr", "jmc" ],
    "owner" : {
      "account_id" : 13749653,
      "reputation" : 11,
      "user_id" : 12426321,
      "user_type" : "registered",
      "profile_image" : "https://lh5.googleusercontent.com/-WnTEx0qnlu4/AAAAAAAAAAI/AAAAAAAAAAw/aEOQYG5f21k/s256-rj/photo.jpg",
      "display_name" : "Carson Black",
      "link" : "https://stackoverflow.com/users/12426321/carson-black"
    },
    "is_answered" : true,
    "view_count" : 228,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1749726846,
    "creation_date" : 1749668898,
    "link" : "https://stackoverflow.com/questions/79662530/jdk-flight-recorder-jfr-error-event-is-not-allowed-under-control",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79663422,
    "question_id" : 79662530,
    "body" : "<p>Most likely the files default.jfc or profile.jfc on your installed JDK has become corrupt. The files are located in the JDK_HOME/lib/jfr directory. Perhaps they were edited manually and &lt;event&gt; was accidentally put between &lt;control&gt; and &lt;/control&gt;.</p>\n<p>Try to download a fresh version of the JDK.</p>\n<p>If it doesn't work, try another distribution, like Oracle JDK.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 9827,
      "reputation" : 7189,
      "user_id" : 2049208,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/rD9sf.jpg?s=256",
      "display_name" : "Kire Haglin",
      "link" : "https://stackoverflow.com/users/2049208/kire-haglin"
    },
    "creation_date" : 1749726846,
    "last_activity_date" : 1749726846,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79663422" : [ {
      "comment_id" : 140508747,
      "post_id" : 79663422,
      "body" : "Thank you. You are exactly right. While I was not configuring the app to use it, I had manually created a deepprofile.jfc, copied from profile.jfc and had a syntax error in it.  ....   &lt;event name=&quot;dev.morling.jmfrx.JmxDumpEvent&quot;&gt;     &lt;setting name=&quot;period&quot;&gt;5 s&lt;/setting&gt;     &lt;setting name=&quot;filter&quot;&gt;metric.*&lt;/setting&gt;   &lt;/event&gt;     &lt;/control&gt; &lt;/configuration&gt;",
      "score" : 1,
      "owner" : {
        "account_id" : 13749653,
        "reputation" : 11,
        "user_id" : 12426321,
        "user_type" : "registered",
        "profile_image" : "https://lh5.googleusercontent.com/-WnTEx0qnlu4/AAAAAAAAAAI/AAAAAAAAAAw/aEOQYG5f21k/s256-rj/photo.jpg",
        "display_name" : "Carson Black",
        "link" : "https://stackoverflow.com/users/12426321/carson-black"
      },
      "creation_date" : 1749735263,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}