{
  "question" : {
    "question_id" : 79744855,
    "title" : "tested class didn&#39;t arrive",
    "body" : "<p>The following test is failing:</p>\n<pre><code>package io.github.magwas.inez.parse;\n\nimport static org.junit.jupiter.api.Assertions.assertEquals;\n\nimport java.util.Map;\n\nimport org.junit.jupiter.api.Tag;\nimport org.junit.jupiter.api.Test;\nimport org.junit.jupiter.api.extension.ExtendWith;\nimport org.osgi.test.common.annotation.InjectService;\nimport org.osgi.test.junit5.service.ServiceExtension;\n\n@ExtendWith(ServiceExtension.class)\n@Tag(&quot;plugin&quot;)\npublic class ParseTextPluginTest {\n    \n    @InjectService\n    ParseTextService parseText;\n    \n    @Test\n    void test() {\n        ParserOutput actual = parseText.apply(&quot;alice&quot;).toList().get(0);\n        assertEquals(new ParserOutput(&quot;alice&quot;, Map.of()), actual);  }\n}\n</code></pre>\n<p>with the following stack trace:</p>\n<pre><code>-------------------------------------------------------------------------------\nTest set: io.github.magwas.inez.parse.ParseTextPluginTest\n-------------------------------------------------------------------------------\nTests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.290 s &lt;&lt;&lt; FAILURE! -- in io.github.magwas.inez.parse.ParseTextPluginTest\nio.github.magwas.inez.parse.ParseTextPluginTest.test -- Time elapsed: 0.255 s &lt;&lt;&lt; FAILURE!\njava.lang.AssertionError: 1/1 services (objectClass=io.github.magwas.inez.parse.ParseTextService) didn't arrive within 200ms\n    at org.osgi.test.common.service.ServiceConfiguration.init(ServiceConfiguration.java:96)\n    at org.osgi.test.junit5.service.ServiceExtension.lambda$getServiceConfiguration$0(ServiceExtension.java:150)\n    at org.osgi.test.junit5.service.ServiceExtension.getServiceConfiguration(ServiceExtension.java:148)\n    at org.osgi.test.junit5.service.ServiceExtension.resolveValue(ServiceExtension.java:132)\n    at org.osgi.test.junit5.service.ServiceExtension.resolveValue(ServiceExtension.java:58)\n    at org.osgi.test.junit5.inject.InjectingExtension.resolveField(InjectingExtension.java:171)\n    at org.osgi.test.junit5.inject.InjectingExtension.lambda$injectNonStaticFields$4(InjectingExtension.java:225)\n    at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:184)\n    at java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:179)\n    at java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1708)\n    at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)\n    at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)\n    at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)\n    at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)\n    at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n    at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)\n    at org.osgi.test.junit5.inject.InjectingExtension.injectNonStaticFields(InjectingExtension.java:225)\n    at org.osgi.test.junit5.inject.InjectingExtension.beforeEach(InjectingExtension.java:89)\n    at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\n    at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\n\n</code></pre>\n<p>relevant parts of pom.xml:</p>\n<pre><code>    &lt;parent&gt;\n        &lt;groupId&gt;io.github.magwas&lt;/groupId&gt;\n        &lt;artifactId&gt;inez&lt;/artifactId&gt;\n        &lt;version&gt;0.0.1&lt;/version&gt;\n        &lt;relativePath&gt;../pom.xml&lt;/relativePath&gt;\n    &lt;/parent&gt;\n    &lt;packaging&gt;eclipse-test-plugin&lt;/packaging&gt;\n    &lt;artifactId&gt;io.github.magwas.inez.parser.tests&lt;/artifactId&gt;\n\n      &lt;plugin&gt;\n        &lt;groupId&gt;org.eclipse.tycho&lt;/groupId&gt;\n        &lt;artifactId&gt;tycho-surefire-plugin&lt;/artifactId&gt;\n        &lt;version&gt;4.0.12&lt;/version&gt;\n        &lt;executions&gt;\n          &lt;execution&gt;\n            &lt;id&gt;default-test&lt;/id&gt;\n            &lt;phase&gt;integration-test&lt;/phase&gt;\n            &lt;goals&gt;\n              &lt;goal&gt;test&lt;/goal&gt;\n            &lt;/goals&gt;\n            &lt;configuration&gt;\n              &lt;includes&gt;**/*PluginTest.java&lt;/includes&gt;\n            &lt;/configuration&gt;\n          &lt;/execution&gt;\n        &lt;/executions&gt;\n        &lt;configuration&gt;\n          &lt;includes&gt;**/*PluginTest.java&lt;/includes&gt;\n        &lt;/configuration&gt;\n      &lt;/plugin&gt;\n\n</code></pre>\n<p>MANIFEST.MF:</p>\n<pre><code>Manifest-Version: 1.0\nBundle-ManifestVersion: 2\nBundle-Name: Testing\nBundle-SymbolicName: io.github.magwas.inez.parser.tests\nBundle-Version: 0.0.1\nExport-Package: io.github.magwas.inez.parse\nRequire-Bundle: wrapped.io.github.magwas.konveyor-base-testing;bundle-version=&quot;0.4.0&quot;,\n io.github.magwas.inez.parser,\n org.antlr.antlr4-runtime;bundle-version=&quot;4.13.2&quot;,\n wrapped.io.github.magwas.konveyor-base,\n org.osgi.test.junit5;bundle-version=&quot;1.3.0&quot;,\n org.osgi.test.common;bundle-version=&quot;1.3.0&quot;,\n net.bytebuddy.byte-buddy-agent;bundle-version=&quot;1.17.7&quot;,\n net.bytebuddy.byte-buddy;bundle-version=&quot;1.17.7&quot;,\n org.objenesis;bundle-version=&quot;3.4.0&quot;,\n org.mockito.mockito-core;bundle-version=&quot;5.19.0&quot;,\n org.eclipse.jdt.junit5.runtime;bundle-version=&quot;1.1.300&quot;,\n junit-jupiter-api;bundle-version=&quot;5.11.4&quot;,\n junit-platform-commons;bundle-version=&quot;1.11.4&quot;\nAutomatic-Module-Name: io.github.magwas.inez.parser.tests\nBundle-RequiredExecutionEnvironment: JavaSE-21\n</code></pre>\n<p>MANIFEXT.MF of io.github.magwas.inez.parser:</p>\n<pre><code>Manifest-Version: 1.0\nBundle-ManifestVersion: 2\nBundle-Name: io.github.magwas.inez.parser\nBundle-SymbolicName: io.github.magwas.inez.parser;singleton:=true\nSpring-Context: *;create-asynchronously:=false \nBundle-Activator: io.github.magwas.inez.parse.ParserBundleActivator\nBundle-Version: 0.0.1\nBundle-Vendor: Árpád Magosányi\nExport-Package: io.github.magwas.inez.parse,\n io.github.magwas.inez.parser\nRequire-Bundle: wrapped.io.github.magwas.konveyor-base;bundle-version=&quot;0.3.0&quot;,\n org.antlr.antlr4-runtime;bundle-version=&quot;4.13.2&quot;,\n wrapped.org.springframework.boot.spring-boot;bundle-version=&quot;3.5.3&quot;,\n wrapped.org.springframework.boot.spring-boot-autoconfigure;bundle-version=&quot;3.5.3&quot;,\n wrapped.org.springframework.spring-context;bundle-version=&quot;6.2.8&quot;,\n wrapped.org.springframework.spring-core;bundle-version=&quot;6.2.8&quot;,\n wrapped.org.springframework.spring-beans;bundle-version=&quot;6.2.8&quot;,\n io.github.magwas.inez.parser,\n org.eclipse.core.runtime;bundle-version=&quot;3.12.0&quot;\nBundle-RequiredExecutionEnvironment: JavaSE-21\nAutomatic-Module-Name: io.github.magwas.inez.parser\nBundle-ClassPath: .,\n target/classes\n</code></pre>\n<p><code>io.github.magwas.inez.parse.ParseTextService</code> does exist in the bundle <code>io.github.magwas.inez.parser</code>, and gets registered in the bundle activator with</p>\n<pre><code>        ServiceRegistration&lt;ParseTextService&gt; registration = bundleContext.registerService(ParseTextService.class,\n                parseText, new Hashtable&lt;String, String&gt;());\n</code></pre>\n<p>It works okay in the application itself.</p>\n<p>I cannot see however how the parser bundle gets activated, and no documentation I have found had any example of activation. Can you help?</p>\n",
    "tags" : [ "java", "eclipse-plugin", "osgi", "tycho-surefire-plugin" ],
    "owner" : {
      "account_id" : 1029918,
      "reputation" : 1506,
      "user_id" : 1038447,
      "user_type" : "registered",
      "accept_rate" : 31,
      "profile_image" : "https://www.gravatar.com/avatar/2b2c8669d88a7265252b6ede2f0ec677?s=256&d=identicon&r=PG",
      "display_name" : "&#193;rp&#225;d Magos&#225;nyi",
      "link" : "https://stackoverflow.com/users/1038447/%c3%81rp%c3%a1d-magos%c3%a1nyi"
    },
    "is_answered" : false,
    "view_count" : 67,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1756189832,
    "creation_date" : 1756036775,
    "link" : "https://stackoverflow.com/questions/79744855/tested-class-didnt-arrive",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79744910,
    "question_id" : 79744855,
    "body" : "<p>The cause of the error is that  the service it registers (and the test tries to test) does not show up in the OSGI registry.</p>\n<p>In my case the cause was that I did not even try to activate it.<br />\nThe activation is done by</p>\n<pre class=\"lang-xml prettyprint-override\"><code>            &lt;plugin&gt;\n                &lt;groupId&gt;org.eclipse.tycho&lt;/groupId&gt;\n                &lt;artifactId&gt;tycho-surefire-plugin&lt;/artifactId&gt;\n                &lt;configuration&gt;\n                    &lt;bundleStartLevel&gt;\n                        &lt;bundle&gt;\n                            &lt;id&gt;io.github.magwas.inez.parser&lt;/id&gt;\n                            &lt;level&gt;1&lt;/level&gt;\n                            &lt;autoStart&gt;true&lt;/autoStart&gt;\n                        &lt;/bundle&gt;\n                    &lt;/bundleStartLevel&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n</code></pre>\n<p>This may not make the error go away, as there could be  prblems in the course of bundle activation (in this particular case the classloader provided by the test harness was not useable to initialize the Spring context in the bundle actvator). But if the activation is atempted, the log in  `target/work/configuration` helps to figure out the rest.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1029918,
      "reputation" : 1506,
      "user_id" : 1038447,
      "user_type" : "registered",
      "accept_rate" : 31,
      "profile_image" : "https://www.gravatar.com/avatar/2b2c8669d88a7265252b6ede2f0ec677?s=256&d=identicon&r=PG",
      "display_name" : "&#193;rp&#225;d Magos&#225;nyi",
      "link" : "https://stackoverflow.com/users/1038447/%c3%81rp%c3%a1d-magos%c3%a1nyi"
    },
    "creation_date" : 1756042962,
    "last_activity_date" : 1756189832,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79744910" : [ {
      "comment_id" : 140692344,
      "post_id" : 79744910,
      "body" : "@Stultuske I updated the answer to make it clear what is happening, and why it is the answer.",
      "score" : 0,
      "owner" : {
        "account_id" : 1029918,
        "reputation" : 1506,
        "user_id" : 1038447,
        "user_type" : "registered",
        "accept_rate" : 31,
        "profile_image" : "https://www.gravatar.com/avatar/2b2c8669d88a7265252b6ede2f0ec677?s=256&d=identicon&r=PG",
        "display_name" : "&#193;rp&#225;d Magos&#225;nyi",
        "link" : "https://stackoverflow.com/users/1038447/%c3%81rp%c3%a1d-magos%c3%a1nyi"
      },
      "creation_date" : 1756189881,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140689985,
      "post_id" : 79744910,
      "body" : "if you want to add information to the question, edit the question. don&#39;t add it as an answer",
      "score" : 0,
      "owner" : {
        "account_id" : 3116234,
        "reputation" : 9469,
        "user_id" : 2636929,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/85fa83a02c04af43fcd224821ca9b750?s=256&d=identicon&r=PG",
        "display_name" : "Stultuske",
        "link" : "https://stackoverflow.com/users/2636929/stultuske"
      },
      "creation_date" : 1756111483,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}