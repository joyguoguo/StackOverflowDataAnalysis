{
  "question" : {
    "question_id" : 79742036,
    "title" : "App Crashes showing error - java.lang.IllegalStateException: Already closed",
    "body" : "<p>I am using react native pdf, its working &amp; showing pdf but if I scrolling fast OR PDF in loading phase and i press back button of navigation bar or device back button quickly then app crashes,\nI check in adb logcat &amp; sentry also to check error it shows java.lang.IllegalStateException: Already closed.</p>\n<p><strong>I tried below code</strong>,</p>\n<pre><code>import Pdf from 'react-native-pdf';\n&lt;View style={{flex: 1}}&gt;\n        &lt;Pdf\n          trustAllCerts={false}\n          onError={error =&gt; {\n            showToast(0, t('PdfView.FailedToLoad'));\n          }}\n          source={source}\n          onLoadComplete={(\n            numberOfPages,\n            path,\n            {width, height},\n            tableContents,\n          ) =&gt; {\n            setPdfLoading(false);\n            if (params?.type === 'crop') {\n              let data = {\n                id: params?.id,\n                cachedUrl: path,\n              };\n              dispatch(saveCachedPdfs(data));\n            }\n            if (params?.type === 'product') {\n              let data = {\n                id: params?.id,\n                cachedUrl: path,\n              };\n              dispatch(saveProducCachedPdfs(data));\n            }\n\n            if (Platform.OS === 'ios') {\n              let fileName = params?.url.substring(\n                params?.url.lastIndexOf('/') + 1,\n                params?.url.lastIndexOf('.'),\n              );\n\n              ReactNativeBlobUtil.fs\n                .cp(\n                  path,\n                  ReactNativeBlobUtil.fs.dirs.DocumentDir + `/${fileName}.pdf`,\n                )\n                .then(() =&gt; {})\n                .catch(() =&gt; {});\n            }\n          }}\n          renderActivityIndicator={(progress: number) =&gt; {\n            return (\n              &lt;View style={progressContainer}&gt;\n                &lt;LottieView\n                  source={require('../../../assets/loader/spinner.json')}\n                  style={gifStyle}\n                  autoPlay\n                  loop\n                /&gt;\n                &lt;Body1\n                  text={`${parseInt(progress * 100)}%`}\n                  style={{\n                    color: Colors.PrimaryBlue,\n                    marginTop: Sizes._15,\n                    fontSize: Sizes._32,\n                    lineHeight: Sizes._40,\n                    textAlign: 'center',\n                  }}\n                /&gt;\n                &lt;View style={{marginTop: Sizes._15, width: '100%'}}&gt;\n                  &lt;ProgressBar progress={parseInt(progress * 100)} /&gt;\n                &lt;/View&gt;\n              &lt;/View&gt;\n            );\n          }}\n          style={pdfStyle}\n        /&gt;\n&lt;/View&gt;\n</code></pre>\n<p><strong>Error message</strong> -  java.lang.IllegalStateException: Already closed.</p>\n<p><strong>when the error happens</strong>  -</p>\n<ol>\n<li>When Pdf is loading stage, if user quickly pressing back button, instead of wait, that case app crashes.</li>\n<li>suppose user speedily scroll page and quickly press back button in this case also app crashes.</li>\n</ol>\n<p>Adb Logcat OR sentry report - <strong>Logs</strong></p>\n<pre class=\"lang-none prettyprint-override\"><code>java.lang.IllegalStateException: Already closed\n       at io.legere.pdfiumandroid.util.ConfigKt.handleAlreadyClosed(Config.kt:20)\n       at io.legere.pdfiumandroid.PdfPage.renderPageBitmap(PdfPage.kt:358)\n       at io.legere.pdfiumandroid.PdfPage.renderPageBitmap$default(PdfPage.kt:349)\n       at io.legere.pdfiumandroid.PdfiumCore.renderPageBitmap(PdfiumCore.kt:407)\n       at com.github.barteksc.pdfviewer.PdfFile.renderPageBitmap(PdfFile.java:301)\n       at com.github.barteksc.pdfviewer.RenderingHandler.proceed(RenderingHandler.java:109)\n       at com.github.barteksc.pdfviewer.RenderingHandler.handleMessage(RenderingHandler.java:66)\n       at android.os.Handler.dispatchMessage(Handler.java:106)\n       at android.os.Looper.loop(Looper.java:223)\n       at android.os.HandlerThread.run(HandlerThread.java:67)\n       Suppressed: java.lang.IllegalStateException: Already closed\n               at io.legere.pdfiumandroid.util.ConfigKt.handleAlreadyClosed(Config.kt:20)\n               at io.legere.pdfiumandroid.PdfPage.close(PdfPage.kt:582)\n               at kotlin.io.CloseableKt.closeFinally(Closeable.kt:59)\n               at io.legere.pdfiumandroid.PdfiumCore.renderPageBitmap(PdfiumCore.kt:406)\n               ... 6 more\n</code></pre>\n<pre class=\"lang-none prettyprint-override\"><code>java.lang.IllegalStateException: Already closed\n       at io.legere.pdfiumandroid.util.ConfigKt.handleAlreadyClosed(Config.kt:20)\n       at io.legere.pdfiumandroid.PdfPage.close(PdfPage.kt:582)\n       at kotlin.io.CloseableKt.closeFinally(Closeable.kt:56)\n       at io.legere.pdfiumandroid.PdfiumCore.renderPageBitmap(PdfiumCore.kt:406)\n       at com.github.barteksc.pdfviewer.PdfFile.renderPageBitmap(PdfFile.java:301)\n       at com.github.barteksc.pdfviewer.RenderingHandler.proceed(RenderingHandler.java:109)\n       at com.github.barteksc.pdfviewer.RenderingHandler.handleMessage(RenderingHandler.java:66)\n       at android.os.Handler.dispatchMessage(Handler.java:106)\n       at android.os.Looper.loop(Looper.java:223)\n       at android.os.HandlerThread.run(HandlerThread.java:67)\n</code></pre>\n",
    "tags" : [ "java", "android", "react-native", "react-native-pdf" ],
    "owner" : {
      "account_id" : 43073446,
      "reputation" : 1,
      "user_id" : 31060440,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ff55b3dbd54eccbb0bd75d3a2f42a919?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Mayur Sancheti",
      "link" : "https://stackoverflow.com/users/31060440/mayur-sancheti"
    },
    "is_answered" : false,
    "view_count" : 291,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1755771027,
    "creation_date" : 1755764758,
    "link" : "https://stackoverflow.com/questions/79742036/app-crashes-showing-error-java-lang-illegalstateexception-already-closed",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79742139,
    "question_id" : 79742036,
    "body" : "<p>This is a common issue with <strong>react-native-pdf</strong> because it uses <strong>Android’s PdfRenderer</strong>, which <strong>must not be accessed after it’s closed</strong>. If the component unmounts (e.g. when navigating back) while PDF pages are still being rendered, you’ll get this crash.</p>\n<p>Before navigating away, make sure to <strong>destroy</strong> the PDF and stop rendering:</p>\n<pre><code>import React, { useRef, useEffect } from &quot;react&quot;;\nimport { BackHandler } from &quot;react-native&quot;;\nimport Pdf from &quot;react-native-pdf&quot;;\n\nconst PdfViewer = ({ navigation, route }) =&gt; {\n  const pdfRef = useRef(null);\n\n  // Clean up when navigating back\n  useEffect(() =&gt; {\n    const unsubscribe = navigation.addListener(&quot;beforeRemove&quot;, () =&gt; {\n      if (pdfRef.current) {\n        try {\n          pdfRef.current.setNativeProps({ source: null }); // Stop loading\n        } catch (e) {\n          console.log(&quot;PDF cleanup failed:&quot;, e);\n        }\n      }\n    });\n    return unsubscribe;\n  }, [navigation]);\n\n  // Also handle physical back button\n  useEffect(() =&gt; {\n    const backHandler = BackHandler.addEventListener(\n      &quot;hardwareBackPress&quot;,\n      () =&gt; {\n        if (pdfRef.current) {\n          try {\n            pdfRef.current.setNativeProps({ source: null });\n          } catch {}\n        }\n        return false; // Let default back action continue\n      }\n    );\n    return () =&gt; backHandler.remove();\n  }, []);\n\n  return (\n    &lt;Pdf\n      ref={pdfRef}\n      source={{ uri: route.params.pdfUrl }}\n      onLoadComplete={(pages) =&gt; console.log(`Total pages: ${pages}`)}\n      onError={(error) =&gt; console.log(error)}\n      style={{ flex: 1 }}\n    /&gt;\n  );\n};\n\nexport default PdfViewer;\n</code></pre>\n<p>And as the last solution, you should put try catch in the code to avoid app crash:</p>\n<pre class=\"lang-java prettyprint-override\"><code>try {\n    // open page\n    pdfRenderer.openPage(pageIndex);\n} catch (IllegalStateException e) {\n    Log.e(&quot;PDF&quot;, &quot;Renderer already closed&quot;);\n}\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 13942941,
      "reputation" : 421,
      "user_id" : 10741695,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/YyxNy.jpg?s=256",
      "display_name" : "An Nguyen",
      "link" : "https://stackoverflow.com/users/10741695/an-nguyen"
    },
    "creation_date" : 1755771027,
    "last_activity_date" : 1755771027,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79742139" : [ {
      "comment_id" : 140683680,
      "post_id" : 79742139,
      "body" : "@MayurSancheti pdfRef.current.setNativeProps Property &#39;setNativeProps&#39; does not exist on type &#39;never&#39;.  still app crash even if i try - (pdfRef.current as any)?.setNativeProps?.({ source: null });    ,  i also check in sentry this error appears -- RuntimeException Level: Fatal Get page pdf document null Unhandled Ongoing  io.legere.pdfiumandroid.PdfDocument in nativeLoadPage",
      "score" : 0,
      "owner" : {
        "account_id" : 43073446,
        "reputation" : 1,
        "user_id" : 31060440,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/ff55b3dbd54eccbb0bd75d3a2f42a919?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Mayur Sancheti",
        "link" : "https://stackoverflow.com/users/31060440/mayur-sancheti"
      },
      "creation_date" : 1755835382,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}