{
  "question" : {
    "question_id" : 79607831,
    "title" : "JDBC is removing part of my query when I run it in Java but it works in my SQL editor",
    "body" : "<p>This is my fairly simple SQL:</p>\n<pre class=\"lang-sql prettyprint-override\"><code>SELECT\n    CONCAT(\n    '{ ',\n        '&quot;test&quot;: ',\n        '{',\n                '&quot;a&quot;: true,',   /* don't set to false  */\n                '&quot;b&quot;: { &quot;t&quot;: true },',\n                '&quot;c&quot;: 2',\n        '},',\n        '&quot;b&quot;: { &quot;t&quot;: true } ',\n    '}'\n    ) AS test\n</code></pre>\n<p>I'm using <code>mysql-connector-java-5.1.7-bin.jar</code> in Java to connect to a <em>MariaDB</em> database.</p>\n<p>In my SQL editor if I run that sql this is what gets returned with no errors:</p>\n<pre class=\"lang-json prettyprint-override\"><code>{ &quot;test&quot;: {&quot;a&quot;: true,&quot;b&quot;: { &quot;t&quot;: true },&quot;c&quot;: 2},&quot;b&quot;: { &quot;t&quot;: true } }\n</code></pre>\n<p>However, for some reason Java returns:</p>\n<pre class=\"lang-json prettyprint-override\"><code>{ &quot;test&quot;: {&quot;a&quot;: true,&quot;b&quot;: ,&quot;c&quot;: 2},&quot;b&quot;: { &quot;t&quot;: true } }\n</code></pre>\n<p>Notice that the first <code>&quot;b&quot;</code> has its value <code>{ &quot;t&quot;: true }</code> completely removed for some reason, but only the first instance of <code>&quot;b&quot;</code>, the second one is fine.</p>\n<p>This is what I'm doing in Java:</p>\n<pre class=\"lang-java prettyprint-override\"><code>import java.sql.Connection;\nimport java.sql.DriverManager;\nimport java.sql.PreparedStatement;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\n\npublic class testSQL {\n    \n    private static final String DB_URL = &quot;jdbc:mysql://localhost:3306/database?characterEncoding=utf-8&quot;;\n    private static final String DB_USER = &quot;your_username&quot;;\n    private static final String DB_PASSWORD = &quot;your_password&quot;;\n\n    public static void main(String[] args) {\n        String sql = &quot;SELECT\\n\\tCONCAT(\\n\\t'{ ',\\n\\t\\t'\\&quot;test\\&quot;: ',\\n\\t\\t'{',\\n\\t\\t\\t\\t'\\&quot;a\\&quot;: true,',\\t/* don't set to false  */\\n\\t\\t\\t\\t'\\&quot;b\\&quot;: { \\&quot;t\\&quot;: true },',\\n\\t\\t\\t\\t'\\&quot;c\\&quot;: 2',\\n\\t\\t'},',\\n\\t\\t'\\&quot;b\\&quot;: { \\&quot;t\\&quot;: true } ',\\n\\t'}'\\n\\t) AS test&quot;;\n\n        try (Connection conn = DriverManager.getConnection(DB_URL, DB_USER, DB_PASSWORD);\n                PreparedStatement stmt = conn.prepareStatement(sql);\n                ResultSet rs = stmt.executeQuery()) {\n\n            while (rs.next()) {\n                System.out.println(rs.getObject(1));\n            }\n\n        } catch (SQLException e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre>\n<p>What could be causing this?</p>\n",
    "tags" : [ "java", "sql", "jdbc", "mariadb", "mysql-connector" ],
    "owner" : {
      "account_id" : 2316543,
      "reputation" : 3497,
      "user_id" : 2502360,
      "user_type" : "registered",
      "accept_rate" : 60,
      "profile_image" : "https://i.sstatic.net/l74qm.jpg?s=256",
      "display_name" : "Curtis",
      "link" : "https://stackoverflow.com/users/2502360/curtis"
    },
    "is_answered" : true,
    "view_count" : 202,
    "answer_count" : 4,
    "score" : 1,
    "last_activity_date" : 1748258548,
    "creation_date" : 1746494276,
    "link" : "https://stackoverflow.com/questions/79607831/jdbc-is-removing-part-of-my-query-when-i-run-it-in-java-but-it-works-in-my-sql-e",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79608058,
    "question_id" : 79607831,
    "body" : "<p>I would say that you hit some kind of escaping mode, like ODBC escape syntax as seen in <a href=\"https://stackoverflow.com/a/13635070/1346819\">this</a> or <a href=\"https://stackoverflow.com/a/73976656/1346819\">this SO answer</a>, posing <a href=\"https://github.com/spring-projects/spring-framework/issues/30256\" rel=\"nofollow noreferrer\">problems with other RDBMS</a>, probably inherited <a href=\"https://docs.oracle.com/cd/E13157_01/wlevs/docs30/jdbc_drivers/sqlescape.html\" rel=\"nofollow noreferrer\">from Oracle</a>; note that MySQL-based RDBMS would ignore the keyword after the <code>{</code> (thus eating this first word, whatever it is) while other RDBMS <a href=\"https://db.apache.org/derby/docs/10.0/manuals/reference/sqlj230.html\" rel=\"nofollow noreferrer\">only replace well-defined ones</a>;<br />\nor it could be interpreted as some comment mode <a href=\"https://www.ibm.com/docs/en/db2/11.5.x?topic=programming-comments-in-jdbc-application\" rel=\"nofollow noreferrer\">à la DB2</a>.</p>\n<p><a href=\"https://stackoverflow.com/a/50897155/1346819\">Someone</a> got luck embedding it in <code>&quot;</code> SQL strings instead of <code>'</code> strings,<br />\nbut frankly I don't see what would trigger it in your string.<br />\nTo circumvent it <strong>I would try separating the <code>{</code></strong> from everything else, with something like <code>CONCAT(…, '{', '&quot;t&quot;: ', …)</code>.</p>\n",
    "score" : 3,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1422459,
      "reputation" : 7512,
      "user_id" : 1346819,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/XWC5vqjc.png?s=256",
      "display_name" : "Guillaume Outters",
      "link" : "https://stackoverflow.com/users/1346819/guillaume-outters"
    },
    "creation_date" : 1746511085,
    "last_activity_date" : 1748258548,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79607864,
    "question_id" : 79607831,
    "body" : "<h3>1.Do not use <code>getObject(0)</code></h3>\n<p>In JDBC, column indexes <strong>start at 1</strong>, not 0. Using index 0 can lead to undefined behavior, often resulting in partial or incorrect data being returned.</p>\n<p>When you access a column via <code>rs.getObject(0)</code>, it might partially return data or behave inconsistently, exactly as you're experiencing.</p>\n<p>Maybe you can use :</p>\n<pre><code>System.out.println(rs.getString(1)); // or\nSystem.out.println(rs.getString(&quot;test&quot;));\n</code></pre>\n<h3>2. you can print raw string and length to debug potential truncation</h3>\n<pre><code>String json = rs.getString(&quot;test&quot;);\nSystem.out.println(&quot;Length: &quot; + json.length());\nSystem.out.println(&quot;Raw JSON: &quot; + json);\n</code></pre>\n<h3>3.If you must use the old driver, avoid JSON concatenation – encode it</h3>\n<pre><code>String base64 = rs.getString(&quot;encoded_json&quot;);\nbyte[] decodedBytes = Base64.getDecoder().decode(base64);\nString json = new String(decodedBytes, StandardCharsets.UTF_8);\nSystem.out.println(json);\n</code></pre>\n<p><strong>To be honest, i cannot make sure above content is correct. You can try and test it.</strong></p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 41805186,
      "reputation" : 104,
      "user_id" : 30456909,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/DvzmO04E.jpg?s=256",
      "display_name" : "jialin.zhou",
      "link" : "https://stackoverflow.com/users/30456909/jialin-zhou"
    },
    "creation_date" : 1746496827,
    "last_activity_date" : 1746496827,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79609512,
    "question_id" : 79607831,
    "body" : "<h2>The Issue</h2>\n<p>After some experimentation, I discovered that the issue was caused by the comment line in the SQL query that I was running:</p>\n<pre class=\"lang-sql prettyprint-override\"><code>/* don't set to false */\n</code></pre>\n<p>Apparently, the lone apostrophe (<code>'</code>) in the word &quot;don't&quot; confused the JDBC driver, even though it's inside of a comment and should have been ignored. My SQL editor handled it just fine, so the issue seems specific to JDBC. I'm not certain whether this is a bug in the particular version I'm using (<code>mysql-connector-java-5.1.7</code>) or if it persists in newer versions as well.</p>\n<p>I initially overlooked the problem because I had used apostrophes in other comments without issue. But in hindsight, every other case involved a <em>paired</em> apostrophe, which didn’t trigger the problem.</p>\n<p>For example:</p>\n<pre class=\"lang-sql prettyprint-override\"><code>/* Set the setting to 'yes' or 'no' */\n</code></pre>\n<p>...works just fine.</p>\n<h2>The Solution</h2>\n<p>Here are a few workarounds that resolved the issue for me:</p>\n<ul>\n<li><strong>Remove any unpaired apostrophe</strong> — e.g. write <code>/* dont */</code> or <code>/* do not */</code> (the simplest fix).</li>\n<li><strong>Use “curly” apostrophes</strong> — e.g. <code>/* don‘t */</code> or <code>/* don’t */</code> (the typographic versions).</li>\n<li><strong>Escape the apostrophe</strong> — e.g. <code>/* don\\'t */</code> or <code>/* don''t */</code> both ways of escaping the apostrophe worked.</li>\n</ul>\n<p>Keep in mind if you are writing the query as a String in Java and chose to escape the apostrophe with a backslash you will also have to escape the backslash — e.g. <code>&quot;/* don\\\\'t */&quot;</code></p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 2316543,
      "reputation" : 3497,
      "user_id" : 2502360,
      "user_type" : "registered",
      "accept_rate" : 60,
      "profile_image" : "https://i.sstatic.net/l74qm.jpg?s=256",
      "display_name" : "Curtis",
      "link" : "https://stackoverflow.com/users/2502360/curtis"
    },
    "creation_date" : 1746567189,
    "last_activity_date" : 1746567189,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79609746,
    "question_id" : 79607831,
    "body" : "<p>Issue is with <strong>EscapeTokenizer.java</strong> in mysql-connector-java-5.1.7. Apostrophe in comment is not properly interpreted.</p>\n<p>This works fine with mysql-connector-java-5.1.49. If upgrade is not an option, you will have to remove or escape the apostrophe in comment.</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 39994530,
      "reputation" : 79,
      "user_id" : 29556869,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/269e8c4932c4183f4b672023edeed8d0?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Reet",
      "link" : "https://stackoverflow.com/users/29556869/reet"
    },
    "creation_date" : 1746587991,
    "last_activity_date" : 1746587991,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140401472,
    "post_id" : 79607831,
    "body" : "@Georg Richter If it was up to me Id be using a more recent driver and a newer db engine. But its not up to me.",
    "score" : 0,
    "owner" : {
      "account_id" : 2316543,
      "reputation" : 3497,
      "user_id" : 2502360,
      "user_type" : "registered",
      "accept_rate" : 60,
      "profile_image" : "https://i.sstatic.net/l74qm.jpg?s=256",
      "display_name" : "Curtis",
      "link" : "https://stackoverflow.com/users/2502360/curtis"
    },
    "creation_date" : 1746554710,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140400472,
    "post_id" : 79607831,
    "body" : "Do you really expect a serious answer when using a database driver which reached end of life and was released 17 years ago?",
    "score" : 3,
    "owner" : {
      "account_id" : 2892575,
      "reputation" : 7674,
      "user_id" : 2481006,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/fb07215019ed6b599f8663bee80727eb?s=256&d=identicon&r=PG",
      "display_name" : "Georg Richter",
      "link" : "https://stackoverflow.com/users/2481006/georg-richter"
    },
    "creation_date" : 1746536422,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140399466,
    "post_id" : 79607831,
    "body" : "Why not use maria db drivers?",
    "score" : 0,
    "owner" : {
      "account_id" : 17972905,
      "reputation" : 10131,
      "user_id" : 13061224,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/GyOMS.jpg?s=256",
      "display_name" : "siggemannen",
      "link" : "https://stackoverflow.com/users/13061224/siggemannen"
    },
    "creation_date" : 1746520804,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140398729,
    "post_id" : 79607831,
    "body" : "I included everything you needed to know in order to reproduce the issue in my original post. But if it helps, I have now gone in and fully built out an example Java class if you needed it.",
    "score" : 0,
    "owner" : {
      "account_id" : 2316543,
      "reputation" : 3497,
      "user_id" : 2502360,
      "user_type" : "registered",
      "accept_rate" : 60,
      "profile_image" : "https://i.sstatic.net/l74qm.jpg?s=256",
      "display_name" : "Curtis",
      "link" : "https://stackoverflow.com/users/2502360/curtis"
    },
    "creation_date" : 1746500764,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140398595,
    "post_id" : 79607831,
    "body" : "We can not know what your code actually executes if you don&#39;t share a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>.",
    "score" : 2,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1746494818,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140398589,
    "post_id" : 79607831,
    "body" : "sql string please? :)",
    "score" : 0,
    "owner" : {
      "account_id" : 15387,
      "reputation" : 67748,
      "user_id" : 32453,
      "user_type" : "registered",
      "accept_rate" : 92,
      "profile_image" : "https://www.gravatar.com/avatar/bec38d63650c8912b6ba9b557fb953b9?s=256&d=identicon&r=PG",
      "display_name" : "rogerdpack",
      "link" : "https://stackoverflow.com/users/32453/rogerdpack"
    },
    "creation_date" : 1746494572,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79608058" : [ {
      "comment_id" : 140401640,
      "post_id" : 79608058,
      "body" : "You could post it as an auto-answer. This kind of parsing bugs appearing on corner cases by drivers that sincerily try to be smart are quite common (I being a PHP guy have encountered some in PHP&#39;s PostgreSQL client layer), having it clearly referenced would be a plus.",
      "score" : 0,
      "owner" : {
        "account_id" : 1422459,
        "reputation" : 7512,
        "user_id" : 1346819,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/XWC5vqjc.png?s=256",
        "display_name" : "Guillaume Outters",
        "link" : "https://stackoverflow.com/users/1346819/guillaume-outters"
      },
      "creation_date" : 1746558743,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140401484,
      "post_id" : 79608058,
      "body" : "After playing around with it, I figured out it was an issue with the apostrophe in the comment of my sql <code>&#47;* don&#39;t set to false  *&#47;</code>. Interestingly, if I have a comment with an opening and closing apostrophe eg: /* use &#39;do not&#39; to make it work */ it works fine. But the open ended apostrophe from <code>don&#39;t</code> for some reason had an issue. My SQL editor handled it fine, maybe its just an issue with my old version of the JDBC driver though.",
      "score" : 1,
      "owner" : {
        "account_id" : 2316543,
        "reputation" : 3497,
        "user_id" : 2502360,
        "user_type" : "registered",
        "accept_rate" : 60,
        "profile_image" : "https://i.sstatic.net/l74qm.jpg?s=256",
        "display_name" : "Curtis",
        "link" : "https://stackoverflow.com/users/2502360/curtis"
      },
      "creation_date" : 1746555166,
      "content_license" : "CC BY-SA 4.0"
    } ],
    "79607864" : [ {
      "comment_id" : 140398743,
      "post_id" : 79607864,
      "body" : "Also, smart plan to encode the string. My version of mysql doesnt have a base64 function. I used Hex() around the CONCAT. But after converting back from hex, the same section is still missing. And again, it works fine in my SQL editor (even using the hex method) but just not when run through Java.",
      "score" : 0,
      "owner" : {
        "account_id" : 2316543,
        "reputation" : 3497,
        "user_id" : 2502360,
        "user_type" : "registered",
        "accept_rate" : 60,
        "profile_image" : "https://i.sstatic.net/l74qm.jpg?s=256",
        "display_name" : "Curtis",
        "link" : "https://stackoverflow.com/users/2502360/curtis"
      },
      "creation_date" : 1746501566,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140398698,
      "post_id" : 79607864,
      "body" : "thanks for the reply. The index of 0 was actually a error in copying the code over. I am using index 1 in my actual code. I just didnt want to copy the entire section of code that handles the result. I also tried creating it as a Prepared Statement and executing it that way and got the same issue.",
      "score" : 0,
      "owner" : {
        "account_id" : 2316543,
        "reputation" : 3497,
        "user_id" : 2502360,
        "user_type" : "registered",
        "accept_rate" : 60,
        "profile_image" : "https://i.sstatic.net/l74qm.jpg?s=256",
        "display_name" : "Curtis",
        "link" : "https://stackoverflow.com/users/2502360/curtis"
      },
      "creation_date" : 1746499181,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}