{
  "question" : {
    "question_id" : 79653919,
    "title" : "JPA many to many relation always updates the one side",
    "body" : "<p>I have a many to many relationship in JPA</p>\n<p>a MailItem can belong to multiple Subscription and a Subscription can contain multiple MailItem. I have an intermediate SubscriptionMailItem table where I have the foreign keys and additional columns like a rotateValue. When I update the subscriptionMailItem rotateValue I expected that I would see only an update of the SubscriptionMailItem table but I always see that hibernate generates also a update mail item sql statement. But I do not change anything on the mail item object.</p>\n<p>How can I prevent this useless update mail item sql?</p>\n<pre><code>@Entity(name=&quot;SubscriptionMailItem&quot;)\n@Table(name=&quot;MMT_MAIL_ITEM_SUBSCRIPTION&quot;)\npublic class SubscriptionMailItem \n\n@Embeddable\n    public static class SubscriptionMailItemId implements Serializable {\n\n        @Column(name=&quot;SUBSCRIPTION_ID&quot;)\n        private Long subscriptionId;\n\n        @Column(name= &quot;MAIL_ITEM_ID&quot;)\n        private Long mailItemId;\n\n        public SubscriptionMailItemId(){\n        }\n\n        public SubscriptionMailItemId(Long subscriptionId, Long mailItemId){\n            this.subscriptionId = subscriptionId;\n            this.mailItemId = mailItemId;\n        }\n\n        public Long getMailItemId() {\n            return mailItemId;\n        }\n\n        public Long getSubscriptionId() {\n            return subscriptionId;\n        }\n\n        public void setMailItemId(Long mailItemId) {\n            this.mailItemId = mailItemId;\n        }\n\n        public void setSubscriptionId(Long subscriptionId) {\n            this.subscriptionId = subscriptionId;\n        }\n\n        @Override\n        public boolean equals(Object o) {\n            if (this == o) return true;\n\n            if (o == null || getClass() != o.getClass())\n                return false;\n\n            SubscriptionMailItemId that = (SubscriptionMailItemId) o;\n            return Objects.equals(subscriptionId, that.getSubscriptionId()) &amp;&amp;\n                    Objects.equals(mailItemId, that.getMailItemId());\n        }\n\n        @Override\n        public int hashCode() {\n            return Objects.hash(subscriptionId, mailItemId);\n        }\n    }\n\n    @EmbeddedId\n    private SubscriptionMailItemId id;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name=&quot;SUBSCRIPTION_ID&quot;,\n            insertable = false,\n            updatable = false)\n    private Subscription subscription;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name=&quot;MAIL_ITEM_ID&quot;,\n            insertable = false,\n            updatable = false)\n    private MailItem mailItem;\n\n\n    @Column(name = &quot;rotate_value&quot;)\n    private Integer rotateValue;\n\n\n</code></pre>\n<pre><code>@Entity\n@Table(name = &quot;MMT_MAIL_ITEM&quot;)\n@Inheritance(strategy = InheritanceType.SINGLE_TABLE)\n@DiscriminatorColumn(name = &quot;TYPE&quot;)\npublic abstract class MailItem{\n\n@Id\n    @GeneratedValue(generator = &quot;mmt_mail_item_seq&quot;, strategy = GenerationType. SEQUENCE)\n    @SequenceGenerator(name=&quot;mmt_mail_item_seq&quot;, sequenceName = &quot;mmt_mail_item_seq&quot;, allocationSize=1)\n    @Column(name = &quot;id&quot;)\n    private Long id;\n\n    @Column(name=&quot;TYPE&quot;, insertable = false, updatable = false)\n    protected String type;\n\n@OneToMany(\n            mappedBy = &quot;mailItem&quot;\n    )\n    private Set&lt;SubscriptionMailItem&gt; subscriptionMailItems = new HashSet&lt;&gt;();\n\n</code></pre>\n<hr />\n",
    "tags" : [ "java", "hibernate", "jpa", "orm" ],
    "owner" : {
      "account_id" : 28066086,
      "reputation" : 1,
      "user_id" : 21439458,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/4b960700dddbb3c3eaac70b6f26d179c?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "peeteko",
      "link" : "https://stackoverflow.com/users/21439458/peeteko"
    },
    "is_answered" : false,
    "view_count" : 46,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1749231866,
    "creation_date" : 1749106193,
    "link" : "https://stackoverflow.com/questions/79653919/jpa-many-to-many-relation-always-updates-the-one-side",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79654276,
    "question_id" : 79653919,
    "body" : "<ol>\n<li><p>Hibernate compares in-memory collections (<code>Set&lt;SubscriptionMailItem&gt;</code>) with the snapshot from the database and assumes changes if <code>equals()</code> or <code>hashCode()</code> are not aligned.</p>\n</li>\n<li><p>Or itâ€™s trying to reattach a detached entity in a managed context and assumes some fields may have changed.</p>\n</li>\n</ol>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 28700800,
      "reputation" : 9,
      "user_id" : 21978012,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/USfGU.jpg?s=256",
      "display_name" : "vimukthi jayasanka",
      "link" : "https://stackoverflow.com/users/21978012/vimukthi-jayasanka"
    },
    "creation_date" : 1749119863,
    "last_activity_date" : 1749119863,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140493370,
    "post_id" : 79653919,
    "body" : "If you didn&#39;t change anything in MailItem, what is the update statement changing? Any reason you aren&#39;t letting JPA handle your embedded mailItemId value using MapsId annotation on the ManyToOne mailItem mapping?",
    "score" : 0,
    "owner" : {
      "account_id" : 231721,
      "reputation" : 21335,
      "user_id" : 496099,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/efa7510cf47d7bd79e80486246e7e39e?s=256&d=identicon&r=PG",
      "display_name" : "Chris",
      "link" : "https://stackoverflow.com/users/496099/chris"
    },
    "creation_date" : 1749217028,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}