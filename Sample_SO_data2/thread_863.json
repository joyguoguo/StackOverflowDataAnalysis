{
  "question" : {
    "question_id" : 79769087,
    "title" : "Java2D Compositing - Incorrect Java/Oracle Documentation",
    "body" : "<p>I am going to improve and supplement this question but maybe I'm right and someone knowing can help shortcut this question/issue... Isn't the following web documentation by Oracle incorrect?  <a href=\"https://docs.oracle.com/javase/tutorial/2d/advanced/compositing.html\" rel=\"nofollow noreferrer\">https://docs.oracle.com/javase/tutorial/2d/advanced/compositing.html</a></p>\n<p>This seems to have been asked previously by the following post:\n<a href=\"https://stackoverflow.com/questions/54269308/java-graphics-composite-inconsistencies\">Java Graphics Composite inconsistencies</a></p>\n<p>I have some sample code and some screenshots that I will add in the next few days but, again, I feel the web documentation is either wrong or strongly misleading on the examples it gives.  i.e.  I cannot duplicate the examples AT ALL!  At least not in the way they are described on the page.  At best, I can somewhat duplicate the screenshots in the web page but have to swap &quot;destination&quot; and &quot;source&quot; and even then the applied composites do not match the web page.  If I'm simply wrong and anyone has any insight that would help me understand the web page and java2d compositing as explained on that page, please let me know.</p>\n<p>FWIW, I'll go ahead and add some preliminary information.  Here is a screenshot of images created but they have swapped source and destination (as I am interpreting the tutorial).  These images have the composites applied in the following order:</p>\n<pre><code>        AlphaComposite.SRC,\n        AlphaComposite.DST,\n        AlphaComposite.SRC_ATOP,\n        AlphaComposite.DST_ATOP,\n        AlphaComposite.SRC_IN,\n        AlphaComposite.DST_IN,\n        AlphaComposite.SRC_OUT,\n        AlphaComposite.DST_OUT,\n        AlphaComposite.SRC_OVER,\n        AlphaComposite.DST_OVER,\n        AlphaComposite.CLEAR\n</code></pre>\n<p><a href=\"https://i.sstatic.net/6FyouOBM.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/6FyouOBM.png\" alt=\"enter image description here\" /></a></p>\n<p>UPDATE:  I have accepted Robby's answer and posted my own followup as an answer below.  Now... how to get Oracle to clarify/correct their tutorial... :)</p>\n",
    "tags" : [ "java", "java-2d" ],
    "owner" : {
      "account_id" : 5584785,
      "reputation" : 139,
      "user_id" : 4425544,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/946c068ad6ee30c5814968803f2cab91?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "kansasSamurai",
      "link" : "https://stackoverflow.com/users/4425544/kansassamurai"
    },
    "is_answered" : true,
    "view_count" : 102,
    "answer_count" : 2,
    "score" : 3,
    "last_activity_date" : 1758333226,
    "creation_date" : 1758252312,
    "link" : "https://stackoverflow.com/questions/79769087/java2d-compositing-incorrect-java-oracle-documentation",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79769252,
    "question_id" : 79769087,
    "body" : "<p>Alpha compositing works almost (see below) as described in the <a href=\"https://docs.oracle.com/javase/tutorial/2d/advanced/compositing.html\" rel=\"nofollow noreferrer\">Oracle tutorial</a> you referenced.</p>\n<p>Three points that might have led to the confusion:</p>\n<ul>\n<li><p>An unclear understanding of what is source (the pixels being currently written) and what is destination (the pixels that are already present).</p>\n</li>\n<li><p>The <a href=\"https://docs.oracle.com/javase/tutorial/displayCode.html?code=https://docs.oracle.com/javase/tutorial/2d/advanced/examples/Composite.java\" rel=\"nofollow noreferrer\">example code</a> in the tutorial which just overlays two graphic primitives. There, it's important to realize that the area affected is limited to the area occupied by the source primitive. That is to say: the part of the destination primitive that does not overlap with the source primitive is not affected.</p>\n</li>\n<li><p>The example image and the description for the <code>CLEAR</code> rule in the tutorial are flat-out wrong (they're actually describing the <code>XOR</code> rule). The <a href=\"https://docs.oracle.com/javase/8/docs/api/java/awt/AlphaComposite.html#CLEAR\" rel=\"nofollow noreferrer\">JavaDoc</a>, however, is correct in stating that:</p>\n<blockquote>\n<p><code>public static final int CLEAR</code><br />\nBoth the color and the alpha of the destination are cleared (Porter-Duff Clear rule). Neither the source nor the destination is used as input.</p>\n</blockquote>\n</li>\n</ul>\n<p>I have taken the 7 composition rules from the aforementioned <a href=\"https://docs.oracle.com/javase/tutorial/2d/advanced/compositing.html\" rel=\"nofollow noreferrer\">tutorial</a> (<code>SRC_OVER</code>, <code>SRC_IN</code>, <code>SRC_OUT</code>, <code>DST_OVER</code>, <code>DST_IN</code>, <code>DST_OUT</code>, and <code>CLEAR</code>), and used them in this example:</p>\n<pre><code>import java.awt.AlphaComposite;\nimport java.awt.Color;\nimport java.awt.Graphics;\nimport java.awt.Graphics2D;\nimport java.awt.image.BufferedImage;\nimport javax.swing.JFrame;\nimport javax.swing.JPanel;\n\nclass Panel extends JPanel {\n    private final int[] rules = {\n            AlphaComposite.SRC_OVER,\n            AlphaComposite.SRC_IN,\n            AlphaComposite.SRC_OUT,\n            AlphaComposite.DST_OVER,\n            AlphaComposite.DST_IN,\n            AlphaComposite.DST_OUT,\n            AlphaComposite.CLEAR,\n    };\n\n    private void composite(Graphics g) {\n        Graphics2D g2d = (Graphics2D) g.create();\n\n        BufferedImage dst = new BufferedImage(60, 60,\n                BufferedImage.TYPE_INT_ARGB);\n        Graphics2D dstGraphics = dst.createGraphics();\n        dstGraphics.setPaint(Color.black);\n        dstGraphics.fillRect(0, 15, 40, 40);\n        dstGraphics.dispose();\n\n        BufferedImage src = new BufferedImage(60, 60,\n                BufferedImage.TYPE_INT_ARGB);\n        Graphics2D srcGraphics = src.createGraphics();\n        srcGraphics.setPaint(Color.orange);\n        srcGraphics.fillOval(15, 0, 40, 40);\n        srcGraphics.dispose();\n\n        for (int x = 20, y = 20, i = 0; i &lt; rules.length; x += 60, i++) {\n            BufferedImage cmp = new BufferedImage(60, 60,\n                    BufferedImage.TYPE_INT_ARGB);\n            Graphics2D cmpGraphics = cmp.createGraphics();\n            AlphaComposite ac = AlphaComposite.getInstance(rules[i], 1.0f);\n            cmpGraphics.drawImage(dst, 0, 0, null);\n            cmpGraphics.setComposite(ac);\n            cmpGraphics.drawImage(src, 0, 0, null);\n            cmpGraphics.dispose();\n\n            g2d.drawImage(cmp, x, y, null);\n        }\n\n        g2d.dispose();\n    }\n\n    @Override\n    public void paintComponent(Graphics g) {\n        super.paintComponent(g);\n        composite(g);\n    }\n}\n\npublic class Compositing extends JFrame {\n    public Compositing() {\n        add(new Panel());\n\n        setTitle(&quot;Compositing&quot;);\n        setSize(460, 100);\n        setLocationRelativeTo(null);\n        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n    }\n\n    public static void main(String[] args) {\n        Compositing compositing = new Compositing();\n        compositing.setVisible(true);\n    }\n}\n</code></pre>\n<p>This yields the following result, which is in line with the Oracle tutorial, except for the <code>CLEAR</code> rule:\n<a href=\"https://i.sstatic.net/eAb9YYZv.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/eAb9YYZv.png\" alt=\"Compositing\" /></a></p>\n<p>When substituting the <code>XOR</code> rule for the <code>CLEAR</code> rule, we get the expected result:\n<a href=\"https://i.sstatic.net/A5sina8J.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/A5sina8J.png\" alt=\"Compositing with XOR\" /></a></p>\n",
    "score" : 4,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 4362282,
      "reputation" : 98636,
      "user_id" : 3558960,
      "user_type" : "registered",
      "accept_rate" : 60,
      "profile_image" : "https://www.gravatar.com/avatar/a98b52149d419c2aad558befe51c8cc5?s=256&d=identicon&r=PG",
      "display_name" : "Robby Cornelissen",
      "link" : "https://stackoverflow.com/users/3558960/robby-cornelissen"
    },
    "creation_date" : 1758267643,
    "last_activity_date" : 1758274909,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79770059,
    "question_id" : 79769087,
    "body" : "<p>So, there was a main problem with the code I was using to try to duplicate the images in the tutorial and, as stated in my comments to Robby, it revolved around knowing that the composite only applies to the area occupied by the source.</p>\n<p>I had originally assumed that the images in the tutorial were generated by code that was very similar to the example code (snippet immediately below).  As Robby states, it just overlays two graphics primitives... <strong>but the key is:  they do not occupy the same area</strong>.</p>\n<pre><code>BufferedImage buffImg = new BufferedImage(w, h, BufferedImage.TYPE_INT_ARGB);\nGraphics2D gbi = buffImg.createGraphics();\n\n// Draws the rectangle and ellipse into the buffered image.\ngbi.setColor(srcColor);\ngbi.fill(new Rectangle2D.Double(rectx, recty, 150, 100));\n\ngbi.setColor(dstColor);\ngbi.drawRect(rectx+rectx/2,recty+recty/2,150,100);\ngbi.setComposite(ac);\ngbi.fill(new Ellipse2D.Double(rectx+rectx/2,recty+recty/2,150,100));\n\n// Draws the buffered image.\ng2.drawImage(buffImg, null, 0, 0);\n</code></pre>\n<p>Robby's example, that duplicates the tutorial images, has the fundamental and important difference being that his <strong>source image completely overlays the entire destination image</strong>.  Therefore my assumption that tutorial code had been used to generate tutorial images was wrong.</p>\n<p>This is the source that I used to generate the original image.  Slightly modified to draw outlines around the rectangular regions but that can easily be removed by the interested reader:</p>\n<p><a href=\"https://i.sstatic.net/CugDaIrk.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/CugDaIrk.png\" alt=\"enter image description here\" /></a></p>\n<pre><code>import java.awt.AlphaComposite;\nimport java.awt.Color;\nimport java.awt.EventQueue;\nimport java.awt.Graphics;\nimport java.awt.Graphics2D;\nimport java.awt.image.BufferedImage;\n\nimport javax.swing.JFrame;\nimport javax.swing.JPanel;\n\nclass Surface extends JPanel {\n\n    private final int rules[] = {\n            AlphaComposite.SRC,\n            AlphaComposite.DST,\n            AlphaComposite.SRC_ATOP,\n            AlphaComposite.DST_ATOP,\n            AlphaComposite.SRC_IN,\n            AlphaComposite.DST_IN,\n            AlphaComposite.SRC_OUT,\n            AlphaComposite.DST_OUT,\n            AlphaComposite.SRC_OVER,\n            AlphaComposite.DST_OVER,\n            AlphaComposite.CLEAR,\n            AlphaComposite.XOR \n    };\n\n    private void doDrawing(Graphics g) {\n\n        Graphics2D g2d = (Graphics2D) g.create();\n\n        for (int x = 20, y = 20, i = 0; i &lt; rules.length; x += 60, i++) {\n\n            BufferedImage buffImg = new BufferedImage(60, 60, BufferedImage.TYPE_INT_ARGB);\n            Graphics2D gbi = buffImg.createGraphics();\n\n            // Destination is yellow circle\n            gbi.setPaint(Color.yellow);\n            gbi.fillOval(15, 5, 40, 40);\n\n            // Note:  This was re-written to compare against the following\n            // post on Oracle docs; the results do not seem to match:\n            // https://docs.oracle.com/javase/tutorial/2d/advanced/compositing.html\n\n            // Apply the composite - any further painting is considered the &quot;source&quot;\n            gbi.setComposite(AlphaComposite.getInstance(rules[i], 0.8f));\n\n            // Source is the black square\n            gbi.setPaint(Color.black);\n            gbi.fillRect(0, 20, 40, 40);\n\n            g2d.drawImage(buffImg, x, y, null);\n            gbi.dispose();\n        }\n\n        g2d.dispose();\n    }\n\n    @Override\n    public void paintComponent(Graphics g) {\n        super.paintComponent(g);\n\n        doDrawing(g);\n    }\n\n}\n\npublic class CompositionEx extends JFrame {\n\n    public CompositionEx() {\n\n        add(new Surface());\n\n        setTitle(&quot;Composition&quot;);\n        setSize(400, 120);\n        setLocationRelativeTo(null);\n        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n    }\n\n    public static void main(String[] args) {\n\n        EventQueue.invokeLater(new Runnable() {\n            @Override\n            public void run() {\n\n                CompositionEx ex = new CompositionEx();\n                ex.setVisible(true);\n            }\n        });\n    }\n\n}\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 5584785,
      "reputation" : 139,
      "user_id" : 4425544,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/946c068ad6ee30c5814968803f2cab91?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "kansasSamurai",
      "link" : "https://stackoverflow.com/users/4425544/kansassamurai"
    },
    "creation_date" : 1758332973,
    "last_activity_date" : 1758332973,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79769252" : [ {
      "comment_id" : 140747357,
      "post_id" : 79769252,
      "body" : "I will mark your answer as accepted in due time.  I want to compare your code vs mine and post a followup for future readers.  Understandably there&#39;s probably not a lot of NEW work being done using java on the desktop but I still use it for personal projects and professionally I use java graphics more and more in relation to developing charts and graphics for documents (primarily PDFs).",
      "score" : 0,
      "owner" : {
        "account_id" : 5584785,
        "reputation" : 139,
        "user_id" : 4425544,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/946c068ad6ee30c5814968803f2cab91?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "kansasSamurai",
        "link" : "https://stackoverflow.com/users/4425544/kansassamurai"
      },
      "creation_date" : 1758289189,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140747341,
      "post_id" : 79769252,
      "body" : "Thank you, that was MUCH more helpful.  1) yes, it took me a bit to fully absorb what is meant by &quot;source&quot; vs &quot;destination&quot;, 2) Your key point, which helps immensely, is &quot;it&#39;s important to realize that the area affected is limited to the area occupied by the source primitive.&quot; .   3) Indeed, the CLEAR was really throwing me above all else.  As I was focusing on both the tutorial and starting from some example code, I had never noticed the presence of the additional XOR operation.",
      "score" : 0,
      "owner" : {
        "account_id" : 5584785,
        "reputation" : 139,
        "user_id" : 4425544,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/946c068ad6ee30c5814968803f2cab91?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "kansasSamurai",
        "link" : "https://stackoverflow.com/users/4425544/kansassamurai"
      },
      "creation_date" : 1758288938,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}