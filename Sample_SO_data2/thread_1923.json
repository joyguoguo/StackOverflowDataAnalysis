{
  "question" : {
    "question_id" : 79667261,
    "title" : "About spring InterceptorRegistry.addInterceptor() not working",
    "body" : "<p>I am currently learning about spring and the concept of beans. I learned that in spring project you can configure in 3 ways -- xml, annotation-based and java-based. I am trying to configure my interceptor in all ways but the @Configuration way fails, the interceptor cannot be invoked this way. I don't know why the @Bean MappedInterceptor configuration invoke the interceptor, all I know is that there are probably some auto configuring behind the spring but I can't find any articles about it...</p>\n<p>I've read this <a href=\"https://stackoverflow.com/questions/69816821/mappedinterceptor-bean-vs-webmvcconfigurer-addinterceptors-what-is-the-correct\">article</a>, it says the mappedInterceptor bean won't work in plain spring but it helps me invoke the interceptor here. Although I think I am using plain spring now.</p>\n<p>I've also read this <a href=\"https://stackoverflow.com/questions/22633800/spring-mvc-interceptor-never-called/35948730#35948730\">article</a></p>\n<p>InterceptorConfig:</p>\n<pre><code>@Configuration\n@EnableWebMvc\npublic class InterceptorConfig implements WebMvcConfigurer {\n    \n    private final LoginAnnotationInterceptor loginAnnotationInterceptor;\n    \n    public InterceptorConfig(LoginAnnotationInterceptor loginAnnotationInterceptor) {\n        this.loginAnnotationInterceptor = loginAnnotationInterceptor;\n    }\n\n    // the interceptor added here cannot be invoked\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        registry.addInterceptor(loginAnnotationInterceptor);\n    }\n    \n    // the interceptor added here is able to be invoked\n    @Bean\n    public MappedInterceptor loginAnnotationInterceptorBean()\n    {\n        return new MappedInterceptor(null, loginAnnotationInterceptor);\n    }\n}\n</code></pre>\n<p>LoginAnnotationInterceptor:</p>\n<pre><code>@Component\npublic class LoginAnnotationInterceptor implements HandlerInterceptor  {\n    \n    @Override\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) \n            throws Exception {\n        System.out.println(&quot;It's an interceptor!&quot;);\n\n        // some logic...\n\n        return true;\n    }\n}\n</code></pre>\n<p><a href=\"https://i.sstatic.net/KPczR8HG.png\" rel=\"nofollow noreferrer\">this is my lib...don't know if anything is wrong here</a></p>\n<p>This is my web.xml. The context:component-scan/ part to scan the InterceptorConfig is defined in applicationContext.xml. I believe my configuration is loaded in DispatcherServlet.</p>\n<p>web.xml:</p>\n<pre><code>&lt;!-- Root Context --&gt;\n&lt;context-param&gt;\n    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;\n    &lt;param-value&gt;/WEB-INF/root-context.xml&lt;/param-value&gt;\n&lt;/context-param&gt;\n    \n&lt;listener&gt;\n    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;\n&lt;/listener&gt;\n\n&lt;!-- DispatcherServlet --&gt;\n&lt;servlet&gt;\n    &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;\n    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;\n    &lt;init-param&gt;\n        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;\n        &lt;param-value&gt;/WEB-INF/applicationContext.xml&lt;/param-value&gt;\n    &lt;/init-param&gt;\n    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;\n&lt;/servlet&gt;\n</code></pre>\n<p>applicationContext.xml:</p>\n<pre><code>&lt;context:component-scan base-package=&quot;org.com.interceptor&quot;/&gt;\n</code></pre>\n<p>I tried to print out the beans in the ApplicationContext but still doesn't help, is there any other way to debug this problem or understand the reason behind it?</p>\n",
    "tags" : [ "java", "spring", "spring-mvc" ],
    "owner" : {
      "account_id" : 38559673,
      "reputation" : 21,
      "user_id" : 30811137,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/7f4878ce45db0e7ae55bba4bdf626b16?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Joseph Wu",
      "link" : "https://stackoverflow.com/users/30811137/joseph-wu"
    },
    "is_answered" : true,
    "view_count" : 93,
    "answer_count" : 1,
    "score" : 2,
    "last_activity_date" : 1750256368,
    "creation_date" : 1750061760,
    "link" : "https://stackoverflow.com/questions/79667261/about-spring-interceptorregistry-addinterceptor-not-working",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79670799,
    "question_id" : 79667261,
    "body" : "<p>May be not a fix for your exact issue, but if all you need is to intercept your request/responses then you can perhaps use Filters. You don't need to add any filter config or anything jsut creating a component that extends the Filter class will do.</p>\n<p>Taking your example class -</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Slf4j\n@Component\npublic class LoginFilter implements Filter {\n    \n    @Override\n    public void doFilter(ServletRequest request, \n                         ServletResponse response, \n                         FilterChain chain) throws IOException, ServletException {\n        \n        log.info(&quot;Here's your request - {}&quot;, request);\n        // some logic with your request before your API gets processed...\n\n        chain.doFilter(request, response); // request goes to service layer.\n\n        log.info(&quot;Here's your original request - {}&quot;, request);\n        log.info(&quot;Here's your response- {}&quot;, response);\n        // some logic with your response before your API sends out the response...\n    }\n}\n</code></pre>\n",
    "score" : 2,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 19877960,
      "reputation" : 300,
      "user_id" : 14562555,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/QxPjB.jpg?s=256",
      "display_name" : "Kaushik",
      "link" : "https://stackoverflow.com/users/14562555/kaushik"
    },
    "creation_date" : 1750256368,
    "last_activity_date" : 1750256368,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140516828,
    "post_id" : 79667261,
    "body" : "There isn&#39;t really a problem combining xml and java, in fact initially that was the only way to get things started. But as stated from the symptoms you mention it appears as if things are applied at th <code>ContextLoaderListener</code> level and not the <code>DispatcherServlet</code> level.",
    "score" : 1,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1750069244,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140516741,
    "post_id" : 79667261,
    "body" : "Thanks for your kind and helpful response, I will try java based config and WebApplicationInitializer later to test if there is any difference. It may help me clarify my confusion of this problem. Again, I really appreciate your response. BTW, is this kind of mix use of xml and annotation config a bad practice?",
    "score" : 0,
    "owner" : {
      "account_id" : 38559673,
      "reputation" : 21,
      "user_id" : 30811137,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/7f4878ce45db0e7ae55bba4bdf626b16?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Joseph Wu",
      "link" : "https://stackoverflow.com/users/30811137/joseph-wu"
    },
    "creation_date" : 1750067616,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140516698,
    "post_id" : 79667261,
    "body" : "What is scanned and detected by what is impossible to know. We have no idea what is in your XML files, nor do we know the packages the classes reside in. Next to that I would suggest to rename the <code>root-context.xml</code> to <code>applicationContext.xml</code> (default loaded by <code>ContextLoaderListener</code>) and <code>applicationContext.xml</code> to <code>dispatcher-servlet.xml</code> (which will then be automatically loaded by the <code>DispatcherServlet</code>.  Another thing is why XML why not simply java based config and a <code>WebApplicationInitializer</code> to bootstrap your app ...",
    "score" : 1,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1750066752,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140516656,
    "post_id" : 79667261,
    "body" : "The first is that I checked the log that shows only one interceptor is being invoked and the following controller part is invoked as well. The second is updated on the question section above, I believe my configuration is loaded in the DispatcherServlet.",
    "score" : 0,
    "owner" : {
      "account_id" : 38559673,
      "reputation" : 21,
      "user_id" : 30811137,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/7f4878ce45db0e7ae55bba4bdf626b16?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Joseph Wu",
      "link" : "https://stackoverflow.com/users/30811137/joseph-wu"
    },
    "creation_date" : 1750065880,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140516587,
    "post_id" : 79667261,
    "body" : "And it should be invoked because? The <code>MappedInterceptor</code> will probably execute and if the <code>preHandle</code> returns <code>false</code> it will not invoke the next interceptors. Next to that how and where is this configuration being loaded. If it is in the ROOT context (the <code>ContextLoaderListener</code> the <code>@EnableWebMVc</code> is pretty much useless and your <code>addInterceptor</code> will ultimatly be ignored. Where as the <code>MappedInterceptor</code> will still be detected as it detects <code>MappedInterrceptors</code> in the parent. The <code>InterceptorConfig</code> should be loaded by the <code>DispatcherServlet</code> and not the <code>ContextLoaderListener</code>",
    "score" : 1,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1750064301,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140516577,
    "post_id" : 79667261,
    "body" : "sorry for my poor explanation. The interceptor added by registry.addInterceptor() is not being invoked, and the one added by @Bean MappedInterceptor is able to be invoked",
    "score" : 0,
    "owner" : {
      "account_id" : 38559673,
      "reputation" : 21,
      "user_id" : 30811137,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/7f4878ce45db0e7ae55bba4bdf626b16?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Joseph Wu",
      "link" : "https://stackoverflow.com/users/30811137/joseph-wu"
    },
    "creation_date" : 1750063981,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140516543,
    "post_id" : 79667261,
    "body" : "Have you connected the power? Sorry but stating &quot;It doesn&#39;t work&quot; isn&#39;t really helpful (as helpful as my first sentence). What doesn&#39;t work? Isn&#39;t it being invoked?",
    "score" : 2,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1750063312,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79670799" : [ {
      "comment_id" : 140525533,
      "post_id" : 79670799,
      "body" : "Thank you for your response! I am learning Filter as well, but as I know the request won&#39;t reach the annotated RequestMapping method before it passes by the filter. My LoginAnnotationInterceptor is to check if the RequestMapping method also happens to have my custom annotation @Login, if so, my interceptor will check the session to make sure the request is sent with a login verification before it gets into the method. So filter isn&#39;t the way I choose to do so, although I know many people use filter to verify the login problem.",
      "score" : 1,
      "owner" : {
        "account_id" : 38559673,
        "reputation" : 21,
        "user_id" : 30811137,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/7f4878ce45db0e7ae55bba4bdf626b16?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Joseph Wu",
        "link" : "https://stackoverflow.com/users/30811137/joseph-wu"
      },
      "creation_date" : 1750303466,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}