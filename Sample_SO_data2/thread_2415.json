{
  "question" : {
    "question_id" : 79624280,
    "title" : "Application blocking",
    "body" : "<p>I have a parent application that allows blocking certain apps on the child's device. When the child tries to open one of the blocked apps, a message appears in the Logcat indicating that the app is blocked. However, the blocking screen does not appear, meaning the app is not actually being prevented from running. It continues to function normally instead of being stopped or showing the blocking interface that should prevent the child from using it.</p>\n<p>public class AppBlockerService extends Service {</p>\n<pre><code>private static final String CHANNEL_ID = &quot;AppBlockerServiceChannel&quot;;\nprivate Handler handler;\nprivate Runnable runnable;\nprivate List&lt;String&gt; blockedApps = new ArrayList&lt;&gt;();\nprivate DatabaseReference installedAppsRef;\nprivate String lastBlockedApp = null;\n\n@Override\npublic void onCreate() {\n    super.onCreate();\n\n    createNotificationChannel();\n\n    handler = new Handler();\n\n    String childUid = FirebaseAuth.getInstance().getCurrentUser().getUid();\n\n    installedAppsRef = FirebaseDatabase.getInstance().getReference(&quot;Users&quot;)\n            .child(&quot;Children&quot;).child(childUid).child(&quot;InstalledApps&quot;);\n\n    installedAppsRef.addValueEventListener(new ValueEventListener() {\n        @Override\n        public void onDataChange(@NonNull DataSnapshot snapshot) {\n            blockedApps.clear();\n            for (DataSnapshot appSnapshot : snapshot.getChildren()) {\n                Boolean isBlocked = appSnapshot.child(&quot;blocked&quot;).getValue(Boolean.class);\n                String pkg = appSnapshot.child(&quot;packageName&quot;).getValue(String.class);\n\n                if (Boolean.TRUE.equals(isBlocked) &amp;&amp; pkg != null) {\n                    blockedApps.add(pkg);\n                }\n            }\n            Log.d(&quot;AppBlockerService&quot;, &quot;Apps bloquées mises à jour : &quot; + blockedApps.toString());\n        }\n\n        @Override\n        public void onCancelled(@NonNull DatabaseError error) {\n            Log.e(&quot;AppBlockerService&quot;, &quot;Firebase error: &quot; + error.getMessage());\n        }\n    });\n\n    startForeground(1, buildNotification());\n\n    startChecking();\n}\n\nprivate void startChecking() {\n    runnable = new Runnable() {\n        @Override\n        public void run() {\n            String currentApp = getForegroundApp(getApplicationContext());\n\n            if (currentApp != null &amp;&amp; blockedApps.contains(currentApp)) {\n                if (!currentApp.equals(lastBlockedApp)) {\n                    lastBlockedApp = currentApp;\n\n                    Log.d(&quot;AppBlockerService&quot;, &quot;Application bloquée détectée : &quot; + currentApp);\n\n                    Intent blockIntent = new Intent(getApplicationContext(), BlockedAppActivity.class);\n                    blockIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);\n                    blockIntent.putExtra(&quot;blockedAppPackage&quot;, currentApp);\n                    startActivity(blockIntent);\n\n                    Toast.makeText(getApplicationContext(), &quot;Cette application est bloquée&quot;, Toast.LENGTH_SHORT).show();\n                }\n            } else {\n                lastBlockedApp = null;\n            }\n\n            handler.postDelayed(this, 2000);\n        }\n    };\n\n    handler.post(runnable);\n}\n\nprivate Notification buildNotification() {\n    return new NotificationCompat.Builder(this, CHANNEL_ID)\n            .setContentTitle(&quot;Service de blocage d'applications&quot;)\n            .setContentText(&quot;Le contrôle parental est actif&quot;)\n            .setSmallIcon(R.drawable.ic_block) // Remplace par une icône valide dans ton projet\n            .setPriority(NotificationCompat.PRIORITY_LOW)\n            .build();\n}\n\nprivate void createNotificationChannel() {\n    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {\n        CharSequence name = &quot;App Blocker Service&quot;;\n        String description = &quot;Channel pour le service de blocage d'applications&quot;;\n        int importance = NotificationManager.IMPORTANCE_LOW;\n        NotificationChannel channel = new NotificationChannel(CHANNEL_ID, name, importance);\n        channel.setDescription(description);\n\n        NotificationManager notificationManager = getSystemService(NotificationManager.class);\n        if (notificationManager != null) {\n            notificationManager.createNotificationChannel(channel);\n        }\n    }\n}\n\n@Nullable\n@Override\npublic IBinder onBind(Intent intent) {\n    return null;\n}\n\n@Override\npublic int onStartCommand(Intent intent, int flags, int startId) {\n    // Si on veut gérer restart, mais ici on fait rien de spécial\n    return START_STICKY;\n}\n\n@Override\npublic void onDestroy() {\n    super.onDestroy();\n    handler.removeCallbacks(runnable);\n}\n\nprivate String getForegroundApp(Context context) {\n    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {\n        UsageStatsManager usm = (UsageStatsManager) context.getSystemService(Context.USAGE_STATS_SERVICE);\n        long time = System.currentTimeMillis();\n        List&lt;UsageStats&gt; appList = usm.queryUsageStats(UsageStatsManager.INTERVAL_DAILY, time - 2000, time);\n\n        if (appList != null &amp;&amp; !appList.isEmpty()) {\n            SortedMap&lt;Long, UsageStats&gt; sortedMap = new TreeMap&lt;&gt;();\n            for (UsageStats usageStats : appList) {\n                sortedMap.put(usageStats.getLastTimeUsed(), usageStats);\n            }\n            if (!sortedMap.isEmpty()) {\n                return sortedMap.get(sortedMap.lastKey()).getPackageName();\n            }\n        }\n    }\n    return null;\n}\n</code></pre>\n<p>}</p>\n",
    "tags" : [ "java", "android", "firebase" ],
    "owner" : {
      "account_id" : 41845670,
      "reputation" : 1,
      "user_id" : 30476547,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0d77dc14e5930d69799d1b143f069ea3?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "azil rahma",
      "link" : "https://stackoverflow.com/users/30476547/azil-rahma"
    },
    "is_answered" : false,
    "view_count" : 49,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1747350931,
    "creation_date" : 1747350931,
    "link" : "https://stackoverflow.com/questions/79624280/application-blocking",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140434943,
    "post_id" : 79624280,
    "body" : "<a href=\"https://developer.android.com/guide/components/activities/background-starts\" rel=\"nofollow noreferrer\">You cannot start activities from the background</a> on modern versions of Android, except in very specific conditions.",
    "score" : 0,
    "owner" : {
      "account_id" : 39846,
      "reputation" : 1011235,
      "user_id" : 115145,
      "user_type" : "registered",
      "accept_rate" : 84,
      "profile_image" : "https://i.sstatic.net/wDnd8.png?s=256",
      "display_name" : "CommonsWare",
      "link" : "https://stackoverflow.com/users/115145/commonsware"
    },
    "creation_date" : 1747482093,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140430950,
    "post_id" : 79624280,
    "body" : "I&#39;m not sure I understand. What exactly in this code doesn&#39;t work the way you expect? Tell us what is wrong with the shared code. Do you have any errors?",
    "score" : 2,
    "owner" : {
      "account_id" : 6819231,
      "reputation" : 139485,
      "user_id" : 5246885,
      "user_type" : "registered",
      "accept_rate" : 78,
      "profile_image" : "https://i.sstatic.net/269fpDhM.jpg?s=256",
      "display_name" : "Alex Mamo",
      "link" : "https://stackoverflow.com/users/5246885/alex-mamo"
    },
    "creation_date" : 1747367454,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}