{
  "question" : {
    "question_id" : 79731960,
    "title" : "How to read this marble diagram?",
    "body" : "<p>I have already gone through <a href=\"https://projectreactor.io/docs/core/release/reference/apdx-howtoReadMarbles.html\" rel=\"nofollow noreferrer\">https://projectreactor.io/docs/core/release/reference/apdx-howtoReadMarbles.html</a>.</p>\n<p>But I cant seem to understand, how this would map to here. Where does subscribe, onSubscribe, request fit in this diagram? Why did the initial green circle transform to a square if there is no subscribe in the initial timeline?</p>\n<pre><code>  Flux.just(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)\n        .flatMap(i -&gt; Mono.just(i + 1).delayElement(Duration.ofMillis(10)))\n        .subscribe();\n</code></pre>\n<p><a href=\"https://i.sstatic.net/TmM035Jj.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/TmM035Jj.png\" alt=\"enter image description here\" /></a></p>\n",
    "tags" : [ "java", "spring-boot", "spring-webflux", "reactive-programming" ],
    "owner" : {
      "account_id" : 11899514,
      "reputation" : 95,
      "user_id" : 8707914,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3ced8d83a1ca2fd17d1638644affe541?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "fragilepriCe",
      "link" : "https://stackoverflow.com/users/8707914/fragileprice"
    },
    "is_answered" : true,
    "view_count" : 161,
    "answer_count" : 1,
    "score" : 2,
    "last_activity_date" : 1755007391,
    "creation_date" : 1754909421,
    "link" : "https://stackoverflow.com/questions/79731960/how-to-read-this-marble-diagram",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79733295,
    "question_id" : 79731960,
    "body" : "<p>Marble diagrams are used to show what a particular operator does, not to teach you the basics about how publishers and subscribers work. In this case, <code>flatMap</code> doesn't do anything noteworthy with the <code>subscribe</code> and <code>request</code> signals, so they are not shown. The diagram presumes that you know that <a href=\"https://projectreactor.io/docs/core/release/reference/reactiveProgramming.html#reactive.subscribe\" rel=\"nofollow noreferrer\">nothing happens until you <code>subscribe()</code></a>.</p>\n<p>To spell it out for you, when you subscribe to the output flux produced by <code>flatMap</code>, the output flux subscribes to the source flux with some internal subscriber that implements the flat map logic. Whatever your subscriber requests, the internal subscriber will also request the same amount.</p>\n<p>If you really want to draw this on the diagram, it'd just look like an arrow going from the output flux to the <code>flatMap</code> box, then another arrow going from the <code>flatMap</code> box to the source flux:</p>\n<p><a href=\"https://i.sstatic.net/6FqCfoBM.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/6FqCfoBM.png\" alt=\"enter image description here\" /></a></p>\n<p>(I have run out of space to fit in a &quot;request&quot; signal after the &quot;subscribe()&quot; signal.)</p>\n<p>One could argue that showing these signals would be adding noise that <em>distracts</em> the reader from the main point of the diagram.</p>\n<p>I don't think I've ever seen <code>onSubscribe</code> being shown as a signal on a marble diagram. When you subscribe to a publisher with some subscriber, the subscriber's <code>onSubscribe</code> gets called with a <code>Subscription</code> provided by the publisher. I don't think there is any operator that changes how this works. If you really want to show this on the diagram, I suppose you could draw it as arrows going the opposite direction, after each &quot;subscribe()&quot; arrow.</p>\n<hr>\n<p>Here are some operators where showing <code>subscribe</code>/<code>request</code> signals on the diagram actually helps.</p>\n<p>The diagram for the <a href=\"https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html#flatMap-java.util.function.Function-int-\" rel=\"nofollow noreferrer\">two-parameter <code>flatMap</code> overload</a> shows a &quot;request(2)&quot; signal being sent to the source flux. This is used to show how the <code>concurrency</code> parameter affects the initial demand.</p>\n<p>The diagram for <a href=\"https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html#delaySubscription-org.reactivestreams.Publisher-\" rel=\"nofollow noreferrer\"><code>delaySubscription(Publisher)</code></a> shows &quot;subscribe()&quot; signals. After all, how are you going to visualise that the &quot;subscribe()&quot; signal is delayed, without actually drawing the signals?</p>\n<p>The diagram for <a href=\"https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html#takeLast-int-\" rel=\"nofollow noreferrer\"><code>takeLast(int)</code></a> shows a &quot;request(unbounded)&quot; signal at the beginning, indicating that no matter what the subscriber of the output flux requests, it is always going to request an unbounded number of items from the source flux.</p>\n<p>The diagram for <a href=\"https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html#timeout-java.time.Duration-\" rel=\"nofollow noreferrer\"><code>timeout(Duration)</code></a> shows &quot;subscribe()&quot; signals, because without them, it could be unclear when exactly the timer (the green rectangles) starts counting down.</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 6651855,
      "reputation" : 292280,
      "user_id" : 5133585,
      "user_type" : "registered",
      "accept_rate" : 96,
      "profile_image" : "https://i.sstatic.net/dfqcw.png?s=256",
      "display_name" : "Sweeper",
      "link" : "https://stackoverflow.com/users/5133585/sweeper"
    },
    "creation_date" : 1755007391,
    "last_activity_date" : 1755007391,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140659193,
    "post_id" : 79731960,
    "body" : "Yes I am still confused on how it did transform initially",
    "score" : 0,
    "owner" : {
      "account_id" : 11899514,
      "reputation" : 95,
      "user_id" : 8707914,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3ced8d83a1ca2fd17d1638644affe541?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "fragilepriCe",
      "link" : "https://stackoverflow.com/users/8707914/fragileprice"
    },
    "creation_date" : 1754981783,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140657547,
    "post_id" : 79731960,
    "body" : "<a href=\"https://projectreactor.io/docs/core/release/reference/_images/legend-operator-method.svg\" rel=\"nofollow noreferrer\">This diagram</a> from the link also doesn&#39;t show a subscribe signal sent to the source flux. Are you confused by that too? Do you have the same question of &quot;Why did the initial circle transform to a square if there is no subscribe in the initial timeline?&quot; for that diagram too?",
    "score" : 0,
    "owner" : {
      "account_id" : 6651855,
      "reputation" : 292280,
      "user_id" : 5133585,
      "user_type" : "registered",
      "accept_rate" : 96,
      "profile_image" : "https://i.sstatic.net/dfqcw.png?s=256",
      "display_name" : "Sweeper",
      "link" : "https://stackoverflow.com/users/5133585/sweeper"
    },
    "creation_date" : 1754921669,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140657526,
    "post_id" : 79731960,
    "body" : "Why <i>should</i> there be a subscribe signal sent to the &quot;initial timeline&quot;? These diagrams are meant to describe what an operator does to a flux. <code>flatMap</code> itself does not subscribe to the input flux. It just creates another flux.",
    "score" : 0,
    "owner" : {
      "account_id" : 6651855,
      "reputation" : 292280,
      "user_id" : 5133585,
      "user_type" : "registered",
      "accept_rate" : 96,
      "profile_image" : "https://i.sstatic.net/dfqcw.png?s=256",
      "display_name" : "Sweeper",
      "link" : "https://stackoverflow.com/users/5133585/sweeper"
    },
    "creation_date" : 1754921370,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79733295" : [ {
      "comment_id" : 140667912,
      "post_id" : 79733295,
      "body" : "Thank you so much. This was really helpful.",
      "score" : 0,
      "owner" : {
        "account_id" : 11899514,
        "reputation" : 95,
        "user_id" : 8707914,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/3ced8d83a1ca2fd17d1638644affe541?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "fragilepriCe",
        "link" : "https://stackoverflow.com/users/8707914/fragileprice"
      },
      "creation_date" : 1755258418,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}