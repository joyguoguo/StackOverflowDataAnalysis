{
  "question" : {
    "question_id" : 79560683,
    "title" : "Hibernate: OneToMany and OneToOne for two classes in SINGLE_TABLE_STRATEGY",
    "body" : "<p>I have a parent class: <code>Person</code> and two child classes: <code>Hunter</code> and <code>Policeman</code>. A <code>Hunter</code> can have several <code>Dog</code>, and a <code>Policeman</code> can only have one <code>Dog</code>. It's a <strong>unidirectional</strong> relationship, the <code>Dog</code> entity only has an attribute <code>breed</code>:</p>\n<pre><code>@Entity\n@Inheritance(strategy = InheritanceType.SINGLE_TABLE)\npublic class Person {\n  private String name;\n</code></pre>\n<p>and child classes:</p>\n<pre><code>@Entity\npublic class Hunter {\n  private String forest;\n\n  @OneToMany(cascade = CascadeType.ALL, fetch = FetchType.EAGER)\n  @JoinColumn(name = &quot;hunter_id&quot;, referencedColumnName = &quot;id&quot;)\n  private Set&lt;Dog&gt; dogs;\n\n</code></pre>\n<pre><code>@Entity\npublic class Policeman {\n  private String city;\n\n  @OneToOne(cascade = CascadeType.ALL)\n  @JoinColumn(name = &quot;dog_id&quot;)\n  private Dog dog;\n</code></pre>\n<p>It generates table structure like this:</p>\n<p><strong>person</strong></p>\n<pre><code>id, name, forest, city, dog_id, person_type\n</code></pre>\n<p><strong>dog</strong>:</p>\n<pre><code>id, breed, hunter_id\n</code></pre>\n<p>So essentially because the <code>Policeman</code> only has one day, the dog's id FK is put in <code>person</code> table. It would be null for rows that relate to a <code>Hunter</code>.</p>\n<p>And because a <code>Hunter</code> has several dogs, the hunter's ID is put as a FK in the <code>dog</code> table.</p>\n<p>I picked this approach, because it provides compile-time checks - I can't possibly associate more than one dog with a <code>Policeman</code>.</p>\n<p>However, I've been wondering if it's a right approach and if it would have been better to just have <code>person_id</code> FK in the <code>dog</code> table and ensure that the <code>Policeman</code> only  has one dog in the service classes?</p>\n",
    "tags" : [ "java", "database", "hibernate", "spring-data-jpa", "hibernate-mapping" ],
    "owner" : {
      "account_id" : 6099767,
      "reputation" : 5261,
      "user_id" : 4759176,
      "user_type" : "registered",
      "accept_rate" : 74,
      "profile_image" : "https://i.sstatic.net/0U1e5.jpg?s=256",
      "display_name" : "parsecer",
      "link" : "https://stackoverflow.com/users/4759176/parsecer"
    },
    "is_answered" : true,
    "view_count" : 95,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1744065244,
    "creation_date" : 1744055775,
    "link" : "https://stackoverflow.com/questions/79560683/hibernate-onetomany-and-onetoone-for-two-classes-in-single-table-strategy",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79560863,
    "question_id" : 79560683,
    "body" : "<blockquote>\n<p>I picked this approach, because it provides compile-time checks - I can't possibly associate more than one dog with a Policeman.</p>\n</blockquote>\n<p>That's true, but your approach allows the same dog to be associated with both a <code>Policeman</code> and a <code>Hunter</code> at the same time.</p>\n<blockquote>\n<p>However, I've been wondering if it's a right approach and if it would have been better to just have <code>person_id</code> FK in the <code>dog</code> table and ensure that the <code>Policeman</code> only has one dog in the service classes?</p>\n</blockquote>\n<p>Yes, I would model the dog's associated person consistently with respect to the dog, regardless of the specific type of person.  There are both practical and design reasons for this.  For example, it prevents having one dog with two different people associated.</p>\n<p>And if you wanted to do, you could still model <code>Policeman</code> with a one-to-one relationship; it just needs to be owned by the <code>Dog</code> side.  That does leave room for inconsistency in the DB in the form of multiple dog records all associated with one policeman, but that's more or less a break-even: you're trading one means of inconsistency for another.</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1744063404,
    "last_activity_date" : 1744063404,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79560863" : [ {
      "comment_id" : 140316719,
      "post_id" : 79560863,
      "body" : "@parsecer, whether you use a table-per-subclass inheritance strategy or a single-table strategy does not directly affect where in the inheritance hierarchy the relationship with <code>Dog</code> can or should be located.  But if you use a strategy and an entity design that needs to be supported by two separate FK relationships at the <code>dog</code> table, then you allow for inconsistencies in which the same dog is associated with multiple people via different FKs.",
      "score" : 0,
      "owner" : {
        "account_id" : 2792262,
        "reputation" : 190832,
        "user_id" : 2402272,
        "user_type" : "registered",
        "accept_rate" : 85,
        "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
        "display_name" : "John Bollinger",
        "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
      },
      "creation_date" : 1744210851,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140316661,
      "post_id" : 79560863,
      "body" : "@parsecer, <code>@OneToMany</code> in <code>Person</code> and <code>@ManyToOne</code> in Dog are not mutually exclusive.  You need the <code>@ManyToOne</code> because the relationship needs to be owned by the &quot;many&quot; side, but if your application logic would benefit from it then you can have the <code>@OneToMany</code> as well.",
      "score" : 0,
      "owner" : {
        "account_id" : 2792262,
        "reputation" : 190832,
        "user_id" : 2402272,
        "user_type" : "registered",
        "accept_rate" : 85,
        "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
        "display_name" : "John Bollinger",
        "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
      },
      "creation_date" : 1744210216,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140313911,
      "post_id" : 79560863,
      "body" : "I also wondered if maybe I should just use separate tables for <code>Policeman</code> and <code>Hunter</code> and just having the corresponding <code>OneToOne</code> and <code>OneToMany</code> inside each",
      "score" : 0,
      "owner" : {
        "account_id" : 6099767,
        "reputation" : 5261,
        "user_id" : 4759176,
        "user_type" : "registered",
        "accept_rate" : 74,
        "profile_image" : "https://i.sstatic.net/0U1e5.jpg?s=256",
        "display_name" : "parsecer",
        "link" : "https://stackoverflow.com/users/4759176/parsecer"
      },
      "creation_date" : 1744152761,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140313902,
      "post_id" : 79560863,
      "body" : "Would you go for a <code>OneToMany</code> inside <code>Person</code> class or a <code>ManyToOne</code> in <code>Dog</code> class? I&#39;ve read that unidirectional <code>OneToMany</code> are less efficient, but in my application the <code>Dog</code> class doesn&#39;t make sense on its own and would only be accessed from <code>Person</code> classes mostly",
      "score" : 0,
      "owner" : {
        "account_id" : 6099767,
        "reputation" : 5261,
        "user_id" : 4759176,
        "user_type" : "registered",
        "accept_rate" : 74,
        "profile_image" : "https://i.sstatic.net/0U1e5.jpg?s=256",
        "display_name" : "parsecer",
        "link" : "https://stackoverflow.com/users/4759176/parsecer"
      },
      "creation_date" : 1744152413,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}