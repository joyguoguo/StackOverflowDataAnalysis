{
  "question" : {
    "question_id" : 79845063,
    "title" : "Spring Boot Prometheus Push Gateway: Metrics missing label",
    "body" : "<p>In Spring Boot <strong>3.5.6</strong>,  I switched to the new <a href=\"https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.5-Release-Notes#prometheus-pushgateway\" rel=\"nofollow noreferrer\">recommended</a> Prometheus Pushgateway solution.</p>\n<p><strong>lang-yaml</strong>:</p>\n<pre><code>management:\n  prometheus:\n    metrics:\n      export:\n        pushgateway:\n          enabled: ${PROM_PUSH_ENABLED:true}\n          address: ${PROM_PUSH_GATEWAY_ADDRESS:prometheus-pushgateway-cogito-pushgateway.telemetry.svc.cluster.local:9091}\n          scheme: http\n          grouping-key:\n            namespace: ${PROM_PUSH_NAMESPACE_FOR_EXPORT:TBD}\n          shutdown-operation: POST\n          push-rate: ${PROM_PUSH_RATE:5s}\n          job: signal-offload-reconciler\n          format: ${PROM_PUSH_FORMAT:TEXT}\n</code></pre>\n<p>The metrics get pushed to Prometheus (actually Victoria) fine but are missing the label as per the <code>grouping-key</code> (I confirmed that <code>PROM_PUSH_NAMESPACE_FOR_EXPORT</code> is configured on the pod)</p>\n<p>Any ideas?</p>\n",
    "tags" : [ "java", "spring", "spring-boot", "spring-boot-actuator", "prometheus-pushgateway" ],
    "owner" : {
      "account_id" : 103429,
      "reputation" : 7070,
      "user_id" : 277023,
      "user_type" : "registered",
      "accept_rate" : 56,
      "profile_image" : "https://i.sstatic.net/o2cv8.png?s=256",
      "display_name" : "kellyfj",
      "link" : "https://stackoverflow.com/users/277023/kellyfj"
    },
    "is_answered" : false,
    "view_count" : 41,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1765806025,
    "creation_date" : 1765557344,
    "link" : "https://stackoverflow.com/questions/79845063/spring-boot-prometheus-push-gateway-metrics-missing-label",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79846609,
    "question_id" : 79845063,
    "body" : "<p>I suspect that the custom labels are getting exported to the empty instance label because the <a href=\"https://github.com/prometheus/pushgateway\" rel=\"nofollow noreferrer\">documentation </a>says:</p>\n<blockquote>\n<p>The Prometheus server will attach an <code>instance</code> label if no <code>instance</code> label has been set in the first place. Therefore, if a metric is pushed to the Pushgateway without an instance label (and without an instance label in the grouping key, see below), the Pushgateway will export it with an empty instance label (<code>{instance=&quot;&quot;}</code>), which is equivalent to having no <code>instance</code> label at all, but prevents the server from attaching one.</p>\n</blockquote>\n<p>I guess you need to configure <code>instance</code> property present in the <code>grouping-key</code> property to see those labels.</p>\n<p>Example:</p>\n<pre class=\"lang-yaml prettyprint-override\"><code>management:\n  prometheus:\n    metrics:\n      export:\n        pushgateway:\n          enabled: ${PROM_PUSH_ENABLED:true}\n          address: ${PROM_PUSH_GATEWAY_ADDRESS:prometheus-pushgateway-cogito-pushgateway.telemetry.svc.cluster.local:9091}\n          scheme: http\n          grouping-key: \n            instance: http://localhost:9000    \n            namespace: ${PROM_PUSH_NAMESPACE_FOR_EXPORT:TBD}\n          shutdown-operation: POST\n          push-rate: ${PROM_PUSH_RATE:5s}\n          job: signal-offload-reconciler\n          format: ${PROM_PUSH_FORMAT:TEXT}\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 11377012,
      "reputation" : 17227,
      "user_id" : 8340997,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/fQmuF6ta.png?s=256",
      "display_name" : "Anish B.",
      "link" : "https://stackoverflow.com/users/8340997/anish-b"
    },
    "creation_date" : 1765641030,
    "last_activity_date" : 1765642328,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}