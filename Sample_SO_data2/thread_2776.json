{
  "question" : {
    "question_id" : 79598416,
    "title" : "How to capture adb pull and push output?",
    "body" : "<p>I need to run some adb commands through a small java application. Everything works fine but <strong>I can't intercept the output of the pull and push commands</strong>.</p>\n<p>Here's a simplified example of what I've come up with:</p>\n<pre><code>public class Main {\n\n    private static void pullTest() {\n        String strAdbPath = &quot;/my/path/to/android/sdk/folder/platform-tools/adb&quot;;\n        String strRemotePath = &quot;/storage/sdcard0/Android/media/com.package.my/.&quot;;\n        String strLocalPath = &quot;/tmp/.&quot;;\n\n        BufferedReader brBufferedReader = null;\n\n        try {\n            ProcessBuilder pbProcessBuilder = new ProcessBuilder(strAdbPath, &quot;-d&quot;, &quot;pull&quot;, strRemotePath, strLocalPath);\n            pbProcessBuilder.redirectErrorStream(true);\n\n            Process pProcess = pbProcessBuilder.start();\n            brBufferedReader = pProcess.inputReader();\n\n            String strOutputLine;\n            while ((strOutputLine = brBufferedReader.readLine()) != null) {\n                if (!strOutputLine.trim().isEmpty()) {\n                    System.out.println(&quot;Output line: &quot; + strOutputLine);\n                }\n            }\n\n        } catch (IOException e) {\n            throw new RuntimeException(e);\n        } finally {\n            if (brBufferedReader != null) {\n                try {\n                    brBufferedReader.close();\n                } catch (IOException e) {\n                    throw new RuntimeException(e);\n                }\n            }\n        }\n    }\n\n    public static void main(String[] args) {\n        pullTest();\n    }\n}\n</code></pre>\n<p>The adb command works but the System.out.println does not produce any outcome. The same command executed on the command line shows the percentage of progress of the process.</p>\n<p>The adb version is:</p>\n<blockquote>\n<p>Android Debug Bridge version 1.0.41</p>\n</blockquote>\n<blockquote>\n<p>Version 36.0.0-13206524</p>\n</blockquote>\n<p>Thanks for your help!</p>\n",
    "tags" : [ "java", "android", "adb" ],
    "owner" : {
      "account_id" : 23500360,
      "reputation" : 23,
      "user_id" : 17550322,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/HowzH.jpg?s=256",
      "display_name" : "Luca",
      "link" : "https://stackoverflow.com/users/17550322/luca"
    },
    "is_answered" : false,
    "view_count" : 61,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1745936827,
    "creation_date" : 1745931293,
    "link" : "https://stackoverflow.com/questions/79598416/how-to-capture-adb-pull-and-push-output",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79598620,
    "question_id" : 79598416,
    "body" : "<p>The problem is that ADB's progress output is sent to stderr, not stdout.</p>\n<pre><code>public class Main {\n    private static void pullTest() {\n        String strAdbPath = &quot;/my/path/to/android/sdk/folder/platform-tools/adb&quot;;\n        String strRemotePath = &quot;/storage/sdcard0/Android/media/com.package.my/.&quot;;\n        String strLocalPath = &quot;/tmp/.&quot;;\n        \n        try {\n            ProcessBuilder pb = new ProcessBuilder(strAdbPath, &quot;-d&quot;, &quot;pull&quot;, strRemotePath, strLocalPath);\n            \n            pb.redirectErrorStream(false);\n            Process p = pb.start();\n            \n            new Thread(() -&gt; {\n                try (BufferedReader errReader = new BufferedReader(new InputStreamReader(p.getErrorStream()))) {\n                    String line;\n                    while ((line = errReader.readLine()) != null) {\n                        System.out.println(&quot;Progress: &quot; + line);\n                    }\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n            }).start();\n            \n            // Read stdout normally\n            try (BufferedReader reader = new BufferedReader(new InputStreamReader(p.getInputStream()))) {\n                String line;\n                while ((line = reader.readLine()) != null) {\n                    System.out.println(&quot;Output: &quot; + line);\n                }\n            }\n            \n            p.waitFor();\n            \n        } catch (IOException | InterruptedException e) {\n            throw new RuntimeException(e);\n        }\n    }\n    \n    public static void main(String[] args) {\n        pullTest();\n    }\n}\n</code></pre>\n<p>The ADB command's progress updates get sent to stderr, not stdout.</p>\n<p>Set redirectErrorStream(false) and read from both streams separately. Basically one in the main thread and one in a background thread to avoid deadlocks. I hope that helps.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 3345487,
      "reputation" : 1553,
      "user_id" : 2810726,
      "user_type" : "registered",
      "accept_rate" : 0,
      "profile_image" : "https://i.sstatic.net/oLh03.jpg?s=256",
      "display_name" : "Mbuodile Obiosio",
      "link" : "https://stackoverflow.com/users/2810726/mbuodile-obiosio"
    },
    "creation_date" : 1745936827,
    "last_activity_date" : 1745936827,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79598620" : [ {
      "comment_id" : 140395993,
      "post_id" : 79598620,
      "body" : "I read that the progress output is sent to stderr and that&#39;s why I decided to redirect the stream in my code. I tried your code and, unfortunately, it doesn&#39;t change anything...",
      "score" : 0,
      "owner" : {
        "account_id" : 23500360,
        "reputation" : 23,
        "user_id" : 17550322,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/HowzH.jpg?s=256",
        "display_name" : "Luca",
        "link" : "https://stackoverflow.com/users/17550322/luca"
      },
      "creation_date" : 1746428468,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}