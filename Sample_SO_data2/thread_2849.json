{
  "question" : {
    "question_id" : 79593290,
    "title" : "expecting IdClass mapping",
    "body" : "<p>I am upgrading an ancient Spring 3 app to Spring 6. I have found a number of issues with the same message, but they are mostly actually using annotations. The one that isn't: <a href=\"https://stackoverflow.com/questions/73311445/java-hibernate-exception-expecting-idclass-mapping\">java/hibernate Exception: expecting IdClass mapping</a> doesn't have an answer.</p>\n<p>I have a session factory for hibernate:</p>\n<pre><code>&lt;bean id=&quot;jxxSessionFactory&quot; class=&quot;org.springframework.orm.hibernate5.LocalSessionFactoryBean&quot;&gt;\n  &lt;property name=&quot;dataSource&quot; ref=&quot;jxxDatabase&quot;/&gt;\n  &lt;property name=&quot;mappingResources&quot;&gt;\n    &lt;list&gt;\n      &lt;value&gt;mappings/appearance.hbm.xml&lt;/value&gt;\n      &lt;value&gt;mappings/appearMessage.hbm.xml&lt;/value&gt;\n      ...lots of other mapping files\n    &lt;/list&gt;\n  &lt;/property&gt;\n  &lt;property name=&quot;hibernateProperties&quot;&gt;\n    &lt;value&gt;\n      hibernate.dialect=org.hibernate.dialect.InformixDialect\n      hibernate.show.sql=true\n      hibernate.connection.release_mode=after_statement\n    &lt;/value&gt;\n  &lt;/property&gt;\n&lt;/bean&gt;\n</code></pre>\n<p>And I'm getting an error when I start my app:</p>\n<pre><code>...long stack trace\nCaused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'jxxSessionFactory' defined in ServletContext resource [/WEB-INF/conf/spring/dao.xml]: expecting IdClass mapping\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1812) ~[spring-beans-6.2.5.jar:6.2.5]\n...long stack trace\n</code></pre>\n<p>Sadly it doesn't specify which mapping.</p>\n<p>There are several entities that use composite keys, I just picked one.</p>\n\n\n\n    \n        \n            \n            \n        \n        \n        \n        \n        \n    \n\n<p>and here are the classes:</p>\n<pre><code>public class AppearanceKey implements Serializable{\n    \n    private static final long serialVersionUID = 1L;\n    \n    /* (non-Javadoc)\n     * @see java.lang.Object#equals(java.lang.Object)\n     */\n    @Override\n    public boolean equals(Object obj) {\n        AppearanceKey aKey=null;\n        if (obj instanceof AppearanceKey) {\n            aKey = (AppearanceKey) obj;\n        }\n        else{\n            return false;\n        }\n        \n        boolean test=aKey.getParticipantNumber().equals(getParticipantNumber());\n        if(test){\n            return aKey.getDateAttended().equals(getDateAttended());\n        }\n        else{\n            return false;\n        }\n    }\n    \n    /* (non-Javadoc)\n     * @see java.lang.Object#hashCode()\n     */\n    @Override\n    public int hashCode() {\n        return toString().hashCode();\n    }\n    /* (non-Javadoc)\n     * @see java.lang.Object#toString()\n     */\n    @Override\n    public String toString() {\n        StringBuilder sb=new StringBuilder(getParticipantNumber());\n        sb.append(&quot;:&quot;);\n        sb.append(DateAttended.get(Calendar.MONTH+1));\n        sb.append(&quot;/&quot;);\n        sb.append(DateAttended.get(Calendar.DATE));\n        sb.append(&quot;/&quot;);\n        sb.append(DateAttended.get(Calendar.YEAR));\n        \n        return sb.toString();\n    }\n    \n    Calendar    DateAttended;\n    String      ParticipantNumber;\n    \n    /**\n     * @return the dateAttended\n     */\n    public Calendar getDateAttended() {\n        return DateAttended;\n    }\n    /**\n     * @param dateAttended the dateAttended to set\n     */\n    public void setDateAttended(Calendar dateAttended) {\n        DateAttended = dateAttended;\n    }\n    /**\n     * @return the participantNumber\n     */\n    public String getParticipantNumber() {\n        return ParticipantNumber;\n    }\n    /**\n     * @param participantNumber the participantNumber to set\n     */\n    public void setParticipantNumber(String participantNumber) {\n        ParticipantNumber = participantNumber;\n    }\n}\n</code></pre>\n<p>If I have to switch to annotation mapping, I will, but trying to avoid if possible.</p>\n<pre><code>public class Appearance {\n    \n    Courthouse  CourtLocation;\n    Calendar    DateAttended;\n    String      ParticipantNumber;\n    Float       PaymentAmount;\n    \n    /**\n     * @return the dateAttended\n     */\n    public Calendar getDateAttended() {\n        return DateAttended;\n    }\n    /**\n     * @param dateAttended the dateAttended to set\n     */\n    public void setDateAttended(Calendar dateAttended) {\n        DateAttended = dateAttended;\n    }\n    /**\n     * @return the participantNumber\n     */\n    public String getParticipantNumber() {\n        return ParticipantNumber;\n    }\n    /**\n     * @param participantNumber the participantNumber to set\n     */\n    public void setParticipantNumber(String participantNumber) {\n        ParticipantNumber = participantNumber;\n    }\n    /**\n     * @return the paymentAmount\n     */\n    public Float getPaymentAmount() {\n        if(PaymentAmount==null){\n            PaymentAmount=0.0f;\n        }\n        return PaymentAmount;\n    }\n    /**\n     * @param paymentAmount the paymentAmount to set\n     */\n    public void setPaymentAmount(Float paymentAmount) {\n        PaymentAmount = paymentAmount;\n    }\n    \n    /**\n     * @return the courtLocation\n     */\n    public Courthouse getCourtLocation() {\n        return CourtLocation;\n    }\n    \n    /**\n     * @param courtLocation the courtLocation to set\n     */\n    public void setCourtLocation(Courthouse courtLocation) {\n        CourtLocation = courtLocation;\n    }\n}\n</code></pre>\n",
    "tags" : [ "java", "spring", "hibernate", "hibernate-mapping" ],
    "owner" : {
      "account_id" : 938881,
      "reputation" : 15320,
      "user_id" : 967330,
      "user_type" : "registered",
      "accept_rate" : 90,
      "profile_image" : "https://www.gravatar.com/avatar/b731ee0bd2400959e9d13737e42c6418?s=256&d=identicon&r=PG",
      "display_name" : "Thom",
      "link" : "https://stackoverflow.com/users/967330/thom"
    },
    "is_answered" : true,
    "view_count" : 66,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1746038006,
    "creation_date" : 1745614182,
    "link" : "https://stackoverflow.com/questions/79593290/expecting-idclass-mapping",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79600894,
    "question_id" : 79593290,
    "body" : "<p>Turning on trace for hibernate and digging into the source code was a big help in figuring this one out. I finally isolated the classes it was having a problem with, which were all of the ones with composite keys. Evidently the rules have changed some in these versions of hibernate.</p>\n<p>So, to summarize, I had to add @EmbededId:</p>\n<pre><code>@EmbeddedId\nprivate AppearanceKey   id;\n</code></pre>\n<p>with getters and setters of course.</p>\n<p>I then had to re-work my mapping file:</p>\n<pre><code>&lt;hibernate-mapping&gt;\n    &lt;class name=&quot;com.gs.jxx.bo.Appearance&quot; table=&quot;APPEARANCES&quot;&gt;\n       &lt;composite-id name = &quot;id&quot; class=&quot;com.gs.jxx.bo.AppearanceKey&quot;&gt;\n          &lt;key-property name=&quot;participantNumber&quot; column=&quot;PART_NO&quot;/&gt;\n          &lt;key-property name=&quot;dateAttended&quot; column=&quot;ATT_DATE&quot;/&gt;\n       &lt;/composite-id&gt;\n       &lt;property name=&quot;paymentAmount&quot; column=&quot;AMOUNT&quot;/&gt;\n           &lt;many-to-one name=&quot;courtLocation&quot; column=&quot;LOC_CODE&quot; class=&quot;com.gs.juror.bo.Courthouse&quot; lazy=&quot;false&quot;/&gt;\n    &lt;/class&gt;\n&lt;/hibernate-mapping&gt;\n</code></pre>\n<p>I used the hibernate 4 documentation to achieve some of this.</p>\n<p>Anyway, that seemed to solve my DAO griefs.</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 938881,
      "reputation" : 15320,
      "user_id" : 967330,
      "user_type" : "registered",
      "accept_rate" : 90,
      "profile_image" : "https://www.gravatar.com/avatar/b731ee0bd2400959e9d13737e42c6418?s=256&d=identicon&r=PG",
      "display_name" : "Thom",
      "link" : "https://stackoverflow.com/users/967330/thom"
    },
    "creation_date" : 1746037125,
    "last_activity_date" : 1746038006,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140385199,
    "post_id" : 79593290,
    "body" : "@Arno That I would have to rework the application even further than I do now. This app has been neglected for a while and they now have an urgent request from a client to upgrade, so it&#39;s tight time-framed.",
    "score" : 0,
    "owner" : {
      "account_id" : 938881,
      "reputation" : 15320,
      "user_id" : 967330,
      "user_type" : "registered",
      "accept_rate" : 90,
      "profile_image" : "https://www.gravatar.com/avatar/b731ee0bd2400959e9d13737e42c6418?s=256&d=identicon&r=PG",
      "display_name" : "Thom",
      "link" : "https://stackoverflow.com/users/967330/thom"
    },
    "creation_date" : 1746036812,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140381612,
    "post_id" : 79593290,
    "body" : "If you don&#39;t use annotations you need to register manually your classes and classId within <code>&lt;property name=&quot;mappingResources&quot;&gt;</code>. My question refered to that. But what exactly speaks against using annotations when upgrading to spring6?",
    "score" : 0,
    "owner" : {
      "account_id" : 11555562,
      "reputation" : 569,
      "user_id" : 8466853,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/cd7f72b426ce3c46739900b8ba014e26?s=256&d=identicon&r=PG",
      "display_name" : "Arno",
      "link" : "https://stackoverflow.com/users/8466853/arno"
    },
    "creation_date" : 1745955542,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140376386,
    "post_id" : 79593290,
    "body" : "@Arno can you please elucidate some on your answer. I&#39;m not sure I understand what you&#39;re talking about.",
    "score" : 0,
    "owner" : {
      "account_id" : 938881,
      "reputation" : 15320,
      "user_id" : 967330,
      "user_type" : "registered",
      "accept_rate" : 90,
      "profile_image" : "https://www.gravatar.com/avatar/b731ee0bd2400959e9d13737e42c6418?s=256&d=identicon&r=PG",
      "display_name" : "Thom",
      "link" : "https://stackoverflow.com/users/967330/thom"
    },
    "creation_date" : 1745843524,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140376380,
    "post_id" : 79593290,
    "body" : "As of right now, I can&#39;t find any documentation that you can still do this with spring 6. Everything has gone to JPA, which is better, but kind of leaves me high and dry. I might just have to bite the bullet and move to JPA for my entity classes.",
    "score" : 0,
    "owner" : {
      "account_id" : 938881,
      "reputation" : 15320,
      "user_id" : 967330,
      "user_type" : "registered",
      "accept_rate" : 90,
      "profile_image" : "https://www.gravatar.com/avatar/b731ee0bd2400959e9d13737e42c6418?s=256&d=identicon&r=PG",
      "display_name" : "Thom",
      "link" : "https://stackoverflow.com/users/967330/thom"
    },
    "creation_date" : 1745843465,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140372268,
    "post_id" : 79593290,
    "body" : "Are all keys registered in the mappingResources list?",
    "score" : 0,
    "owner" : {
      "account_id" : 11555562,
      "reputation" : 569,
      "user_id" : 8466853,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/cd7f72b426ce3c46739900b8ba014e26?s=256&d=identicon&r=PG",
      "display_name" : "Arno",
      "link" : "https://stackoverflow.com/users/8466853/arno"
    },
    "creation_date" : 1745689620,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}