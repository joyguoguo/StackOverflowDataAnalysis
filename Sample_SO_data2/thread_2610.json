{
  "question" : {
    "question_id" : 79611039,
    "title" : "Is it safe to catch stack overflows? Can it leave objects in messy/intermediate states?",
    "body" : "<p>I've been reviewing ways to kill threads in Java, and the overwhelming conclusion is that it is never safe to stop code at arbitrary points - doing so may leave resources in messy intermediate states. This is why <code>Thread.stop()</code> was deprecated forever and eventually removed in favor of cooperative thread management.</p>\n<p>However, it occurs to me that this is exactly what a stack overflow does - it may be thrown from (as I understand it) any line of java code that tries to reach for more stack space than is available. If you catch a stack overflow exception from an arbitrary thread (in my use case, semi-trusted user code), can that mean runtime objects are left in illegal states? (Un-released locks, open connections, &quot;atomic&quot; operations stopped halfway thru?)</p>\n",
    "tags" : [ "java", "multithreading", "jvm", "stack-overflow" ],
    "owner" : {
      "account_id" : 7971577,
      "reputation" : 4336,
      "user_id" : 6016064,
      "user_type" : "registered",
      "accept_rate" : 71,
      "profile_image" : "https://www.gravatar.com/avatar/ef21e8114f58b4d82ea6c3056812f557?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Edward Peters",
      "link" : "https://stackoverflow.com/users/6016064/edward-peters"
    },
    "is_answered" : true,
    "view_count" : 1809,
    "answer_count" : 2,
    "score" : 17,
    "last_activity_date" : 1748230247,
    "creation_date" : 1746635553,
    "link" : "https://stackoverflow.com/questions/79611039/is-it-safe-to-catch-stack-overflows-can-it-leave-objects-in-messy-intermediate",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79611157,
    "question_id" : 79611039,
    "body" : "<p>A stack overflow in Java is a <code>StackOverflowError</code>, not a <code>StackOverflowException</code>.</p>\n<p>The documentation of <code>Error</code> specifies</p>\n<blockquote>\n<p>An <code>Error</code> is a subclass of <code>Throwable</code> that indicates serious problems that a reasonable application should not try to catch.</p>\n</blockquote>\n<p>As you have correctly observed, a <code>StackOverflowError</code> may occur at any point in a program and may leave objects in arbitrarily broken states.  You cannot reasonably recover from a <code>StackOverflowError</code>.</p>\n<p>Do not try.</p>\n",
    "score" : 22,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 465573,
      "reputation" : 200423,
      "user_id" : 869736,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/ae7bb06b9a23a4dd7eea69e853d47d12?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Louis Wasserman",
      "link" : "https://stackoverflow.com/users/869736/louis-wasserman"
    },
    "creation_date" : 1746640251,
    "last_activity_date" : 1746640251,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79628230,
    "question_id" : 79611039,
    "body" : "<blockquote>\n<p>Is it safe to catch stack overflows? Can it leave objects in messy/intermediate states?</p>\n</blockquote>\n<p>TL;DR - Sometimes yes, sometimes no.</p>\n<p>First of all, catching an <code>Error</code> is not dangerous <em>per se</em>.  The (potential) danger is in what you attempt to do after catching it.  (And not catching the <code>Error</code> is not always totally safe either.)</p>\n<p>Some kinds of <code>Error</code> are not recoverable.  For example, if you attempt to recover from a  <code>NoClassDefFoundError</code>, there is no way (short of discarding the classloader) to get into a state where you can retry the load of the class ... or any other class that depends on it.</p>\n<p>Other kinds of <code>Error</code> are recoverable in some circumstances, but not in general.  For example a <code>OutOfMemoryError</code> caused by allocating an array that is too large is recoverable if you can abandon the computation (or whatever) that required the large array.  But an OOME that is due to a memory leak is not (fully) recoverable.</p>\n<p>Then there is the problem of data structures (or threads) left in inconsistent states.  Sometimes these are recoverable; e.g. if the data structures are designed to be atomic, or they can simply be discarded.  In others, attempting to recover can lead to other problems.  For example, if you get an OOME on one thread that second thread is waiting on, the latter thread may get stuck waiting on a <code>notify</code> or a higher level event that can never occur.</p>\n<hr />\n<p>What about <code>StackOverflowError</code>?</p>\n<p>Well, some of the problems above apply too, but not others.  Also, an SOE will (in practice) only occur when you are making a method or constructor call ... though that call may not be explicit.</p>\n<p>Furthermore, attempting to recover from an arbitrary <code>Exception</code> or <code>RuntimeException</code> can <em>also</em> lead to problems with corrupt data structures, stuck threads and so on.  Indeed, even catching and recovering from <code>NullPointerException</code>s (or similar) is potentially risky ... in that you might catch an NPE caused by something that you didn't anticipate, and that your recovery code can't cope with.</p>\n<hr />\n<p>So what should you do?</p>\n<p>Well ... not trying to catch and recover from a <code>StackOverflowError</code> is a <em>sound strategy</em>.  But sometimes you just have to<sup>1</sup>.  So I recommend that before writing code that catches <em>and attempts to recover from</em> a <code>StackOverflowError</code>, you should analyze the problem thoroughly to:</p>\n<ol>\n<li>make sure you understand the scenarios in which an SOE can occur,</li>\n<li>make sure that your recovery won't lead to corrupt data structures, stuck threads, resource leaks and so on.</li>\n</ol>\n<p>Kinda obvious.  No magic bullets here.</p>\n<hr />\n<p><sup>1 - Or you think you have to ... because you haven't yet given sufficient consideration to possible alternatives.</sup></p>\n",
    "score" : 2,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 47283,
      "reputation" : 723470,
      "user_id" : 139985,
      "user_type" : "registered",
      "accept_rate" : 69,
      "profile_image" : "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=256&d=identicon&r=PG",
      "display_name" : "Stephen C",
      "link" : "https://stackoverflow.com/users/139985/stephen-c"
    },
    "creation_date" : 1747637873,
    "last_activity_date" : 1748230247,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140409625,
    "post_id" : 79611039,
    "body" : "As I read the other question, the OP was interested in the general practice, but misguidedly focused on a specific example and thus got an answer focused on that example. Arguably, it should be duped to here instead; the Q&amp;A here seem higher quality to me, and <a href=\"https://meta.stackoverflow.com/questions/404535\">we don&#39;t care about the chronology by policy</a>.",
    "score" : 0,
    "owner" : {
      "account_id" : 248321,
      "reputation" : 61443,
      "user_id" : 523612,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/4ae512dd708a619496d36b1f681f95e0?s=256&d=identicon&r=PG",
      "display_name" : "Karl Knechtel",
      "link" : "https://stackoverflow.com/users/523612/karl-knechtel"
    },
    "creation_date" : 1746757751,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140407812,
    "post_id" : 79611039,
    "body" : "@DonaldDuckiswithUkraine I&#39;m a little torn, but I think mine is distinct in that it isn&#39;t pointing to a specific use case, but talking only about the practice in general. I also think both the question and answer here go more into the specifics of why it&#39;s bad practice, and the similarity to <code>Thread.stop</code> in terms of leaving objects in intermediate/broken states.",
    "score" : 0,
    "owner" : {
      "account_id" : 7971577,
      "reputation" : 4336,
      "user_id" : 6016064,
      "user_type" : "registered",
      "accept_rate" : 71,
      "profile_image" : "https://www.gravatar.com/avatar/ef21e8114f58b4d82ea6c3056812f557?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Edward Peters",
      "link" : "https://stackoverflow.com/users/6016064/edward-peters"
    },
    "creation_date" : 1746711774,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140407767,
    "post_id" : 79611039,
    "body" : "This question is similar to: <a href=\"https://stackoverflow.com/questions/28551767/is-it-safe-to-catch-stackoverflowerror-in-java\">Is it safe to catch StackOverflowError in Java?</a>. If you believe it’s different, please <a href=\"https://stackoverflow.com/posts/79611039/edit\">edit</a> the question, make it clear how it’s different and/or how the answers on that question are not helpful for your problem.",
    "score" : 1,
    "owner" : {
      "account_id" : 5378624,
      "reputation" : 9000,
      "user_id" : 4284627,
      "user_type" : "registered",
      "accept_rate" : 81,
      "profile_image" : "https://www.gravatar.com/avatar/2e017633cda5465e6683c74992cdec5e?s=256&d=identicon&r=PG",
      "display_name" : "Donald Duck is with Ukraine",
      "link" : "https://stackoverflow.com/users/4284627/donald-duck-is-with-ukraine"
    },
    "creation_date" : 1746710877,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140405138,
    "post_id" : 79611039,
    "body" : "Seems like a duplicate of <a href=\"https://stackoverflow.com/q/28551767/5133585\">stackoverflow.com/q/28551767/5133585</a>?",
    "score" : 5,
    "owner" : {
      "account_id" : 6651855,
      "reputation" : 292280,
      "user_id" : 5133585,
      "user_type" : "registered",
      "accept_rate" : 96,
      "profile_image" : "https://i.sstatic.net/dfqcw.png?s=256",
      "display_name" : "Sweeper",
      "link" : "https://stackoverflow.com/users/5133585/sweeper"
    },
    "creation_date" : 1746638848,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140405026,
    "post_id" : 79611039,
    "body" : "The same is true with <code>OutOfMemoryError</code>. There&#39;s a reason <code>StackOverflowError</code> is an <code>Error</code> and not an <code>Exception</code>.",
    "score" : 12,
    "owner" : {
      "account_id" : 8532578,
      "reputation" : 49904,
      "user_id" : 6395627,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Slaw",
      "link" : "https://stackoverflow.com/users/6395627/slaw"
    },
    "creation_date" : 1746636965,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140405022,
    "post_id" : 79611039,
    "body" : "I would categorize this as the difference between <i>errors</i> -- it&#39;s <code>StackOverflowError</code>, not <code>StackOverflowException</code> -- and <i>exceptions.</i>  I would generally assume errors to be unrecoverable.  You have correctly identified many reasons why you cannot recover from StackOverflowErrors.",
    "score" : 11,
    "owner" : {
      "account_id" : 465573,
      "reputation" : 200423,
      "user_id" : 869736,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/ae7bb06b9a23a4dd7eea69e853d47d12?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Louis Wasserman",
      "link" : "https://stackoverflow.com/users/869736/louis-wasserman"
    },
    "creation_date" : 1746636933,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140405000,
    "post_id" : 79611039,
    "body" : "What makes it different (in my eyes) is that theoretically any function call can trigger a stack overflow. In a multithreaded system, I think even very shallow and non-recursive code could throw a stack overflow, if it happens to be unlucky enough to do so when another thread has gobbled up all-but-one of the available memory... (maybe JVM dependent)",
    "score" : 0,
    "owner" : {
      "account_id" : 7971577,
      "reputation" : 4336,
      "user_id" : 6016064,
      "user_type" : "registered",
      "accept_rate" : 71,
      "profile_image" : "https://www.gravatar.com/avatar/ef21e8114f58b4d82ea6c3056812f557?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Edward Peters",
      "link" : "https://stackoverflow.com/users/6016064/edward-peters"
    },
    "creation_date" : 1746636658,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140404973,
    "post_id" : 79611039,
    "body" : "...What makes stack overflow exceptions problematic is, if there wasn&#39;t enough available stack space to let some function do what it <i>normally</i> needs to do, then maybe there isn&#39;t enough available stack space to let it do what it needs to do in order to clean up.",
    "score" : 7,
    "owner" : {
      "account_id" : 422870,
      "reputation" : 27582,
      "user_id" : 801894,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=256&d=identicon&r=PG",
      "display_name" : "Solomon Slow",
      "link" : "https://stackoverflow.com/users/801894/solomon-slow"
    },
    "creation_date" : 1746635986,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140404966,
    "post_id" : 79611039,
    "body" : "How is a stack overflow exception different from any other exception in that respect? Either the functions whose stack frames propagate the exception clean up their messes before allowing the exception to move further down the stack, or they don&#39;t. If you&#39;re going to call into somebody else&#39;s code—code that you didn&#39;t personally write—then you&#39;re going to have to <i>trust</i> that it will do the right thing. But...",
    "score" : 9,
    "owner" : {
      "account_id" : 422870,
      "reputation" : 27582,
      "user_id" : 801894,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=256&d=identicon&r=PG",
      "display_name" : "Solomon Slow",
      "link" : "https://stackoverflow.com/users/801894/solomon-slow"
    },
    "creation_date" : 1746635901,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79611157" : [ {
      "comment_id" : 140408871,
      "post_id" : 79611157,
      "body" : "I agree some errors are worth handling <i>in specific scenarios</i>, but in general an error means something is seriously wrong. The program should &quot;panic&quot;, the developers should debug the problem, and then the problem should be fixed so the error never happens again. This is different from <code>Exception</code>, particularly checked exceptions, which are part of the API and are meant to be recoverable from. Also, OOME and SOE are two of the more &quot;tame&quot; errors. If you get an <code>InternalError</code> or <code>UnknownError</code> what are you supposed to do? You can&#39;t even guarantee the JVM is in a workable state anymore.",
      "score" : 4,
      "owner" : {
        "account_id" : 8532578,
        "reputation" : 49904,
        "user_id" : 6395627,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Slaw",
        "link" : "https://stackoverflow.com/users/6395627/slaw"
      },
      "creation_date" : 1746732755,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140408424,
      "post_id" : 79611157,
      "body" : "Despite what the documentation says, I&#39;m going to disagree on this one. Errors are not <i>that</i> dangerous. An OutOfMemoryError can occur by actions as trivial as trying to allocate an absurdly large array, which simply fails and causes no harm. Even if a stack overflow during an object&#39;s initialization might leave it in a bad state, the same goes for any exception during initialization. That said, stack overflows are usually a symptom of a coding mistake or oversight, and catching them should not be expected except in very rare circumstances with library code outside your control.",
      "score" : 7,
      "owner" : {
        "account_id" : 2678223,
        "reputation" : 816,
        "user_id" : 2859462,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/8e09460fe9c0fe55dd7cd66b96a3aa23?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Corrodias",
        "link" : "https://stackoverflow.com/users/2859462/corrodias"
      },
      "creation_date" : 1746721954,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}