{
  "question" : {
    "question_id" : 79695894,
    "title" : "olingo-odata4-jpa-processor cannot &quot;resolve attribute&quot; when using $expand",
    "body" : "<p>So I'm trying to get into odata with JPA. I use Spring Data JPA/Hibernate, not EclipseLink. Database is local in-mem H2. I will not include my Config, to not grow the post more than necessary and I don't expect the config to be the problem. If it could, let me know and I edit the post.</p>\n<p>I have two entities, Department and Unit and want to get the ManyToOne unit relationship of the department through $expand. I tried it the other way around but the error remains the same.</p>\n<p>Unit is defined as:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Getter\n@Setter\n@AllArgsConstructor\n@NoArgsConstructor\n@Entity\npublic class Department extends Area {\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = &quot;unit_key&quot;, referencedColumnName = &quot;pkey&quot;)\n    private Area unit;\n\n}\n\n</code></pre>\n<p>and Department is defined as</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Getter\n@Setter\n@AllArgsConstructor\n@NoArgsConstructor\n@Entity\npublic class Unit extends Area {\n    private Integer unitId;\n    private String address;\n\n    @OneToMany(mappedBy = &quot;unit&quot;, cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)\n    private List&lt;Area&gt; units = new ArrayList&lt;&gt;();\n</code></pre>\n<p>When I call $metadata my Department entity seems to be correct:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;EntityType Name=&quot;Department&quot; BaseType=&quot;masterdata.Area&quot;&gt;\n                &lt;NavigationProperty Name=&quot;Unit&quot; Type=&quot;masterdata.Area&quot;/&gt;\n</code></pre>\n<p>I'd expect the following query to work:</p>\n<pre><code>masterdata/v1/Departments(&lt;id&gt;)?$expand=Unit\n</code></pre>\n<p>But instead I get <code>Could not resolve attribute 'unit_key' of '...model.odataExposed.Department'&quot;</code></p>\n<p>As if unit_key would be the field of the class / the attribute of the EntityType. Which is not if I'm not mistaken.</p>\n<p>As the full stacktrace is a bit long, I try a shortened version first:</p>\n<pre class=\"lang-json prettyprint-override\"><code>&quot;stacktrace&quot;: {\n      &quot;exceptions&quot;: [\n        {\n          &quot;class&quot;: &quot;org.hibernate.query.sqm.PathElementException&quot;,\n          &quot;message&quot;: &quot;Could not resolve attribute 'unit_key' of '...model.odataExposed.Department'&quot;,\n          &quot;invocation&quot;: {\n            &quot;class&quot;: &quot;org.hibernate.query.sqm.SqmPathSource&quot;,\n            &quot;method&quot;: &quot;getSubPathSource&quot;,\n            &quot;line&quot;: 95\n          }\n        }\n      ],\n&quot;stacktrace&quot;: [\n        {\n          &quot;class&quot;: &quot;org.hibernate.query.sqm.SqmPathSource&quot;,\n          &quot;method&quot;: &quot;getSubPathSource&quot;,\n          &quot;line&quot;: 95\n        },\n        {\n          &quot;class&quot;: &quot;org.hibernate.query.sqm.tree.domain.AbstractSqmPath&quot;,\n          &quot;method&quot;: &quot;get&quot;,\n          &quot;line&quot;: 196\n        },\n        {\n          &quot;class&quot;: &quot;org.hibernate.query.sqm.tree.domain.AbstractSqmPath&quot;,\n          &quot;method&quot;: &quot;get&quot;,\n          &quot;line&quot;: 42\n        },\n        {\n          &quot;class&quot;: &quot;com.sap.olingo.jpa.processor.core.query.ExpressionUtility&quot;,\n          &quot;method&quot;: &quot;convertToCriteriaPath&quot;,\n          &quot;line&quot;: 82\n        },\n        {\n          &quot;class&quot;: &quot;com.sap.olingo.jpa.processor.core.query.JPAAbstractQuery&quot;,\n          &quot;method&quot;: &quot;createSelectClause&quot;,\n          &quot;line&quot;: 294\n        },\n        {\n          &quot;class&quot;: &quot;com.sap.olingo.jpa.processor.core.query.JPAJoinQuery&quot;,\n          &quot;method&quot;: &quot;execute&quot;,\n          &quot;line&quot;: 43\n        },\n        {\n          &quot;class&quot;: &quot;com.sap.olingo.jpa.processor.core.processor.JPANavigationRequestProcessor&quot;,\n          &quot;method&quot;: &quot;retrieveData&quot;,\n          &quot;line&quot;: 93\n        },\n        {\n          &quot;class&quot;: &quot;com.sap.olingo.jpa.processor.core.api.JPAODataRequestProcessor&quot;,\n          &quot;method&quot;: &quot;readEntity&quot;,\n          &quot;line&quot;: 211\n        },\n        {\n          &quot;class&quot;: &quot;org.apache.olingo.server.core.ODataDispatcher&quot;,\n          &quot;method&quot;: &quot;handleSingleEntityDispatching&quot;,\n          &quot;line&quot;: 621\n        },\n        ...\n        {\n          &quot;class&quot;: &quot;org.apache.olingo.server.core.ODataHandlerImpl&quot;,\n          &quot;method&quot;: &quot;process&quot;,\n          &quot;line&quot;: 89\n        },\n        {\n          &quot;class&quot;: &quot;org.apache.olingo.server.core.ODataHttpHandlerImpl&quot;,\n          &quot;method&quot;: &quot;process&quot;,\n          &quot;line&quot;: 74\n        },\n        {\n          &quot;class&quot;: &quot;org.apache.olingo.server.core.ODataHttpHandlerImpl&quot;,\n          &quot;method&quot;: &quot;process&quot;,\n          &quot;line&quot;: 88\n        },\n        {\n          &quot;class&quot;: &quot;com.sap.olingo.jpa.processor.core.api.JPAODataRequestHandler&quot;,\n          &quot;method&quot;: &quot;processInternal&quot;,\n          &quot;line&quot;: 71\n        },\n        {\n          &quot;class&quot;: &quot;com.sap.olingo.jpa.processor.core.api.JPAODataRequestHandler&quot;,\n          &quot;method&quot;: &quot;process&quot;,\n          &quot;line&quot;: 55\n        },\n        ...\n        {\n          &quot;class&quot;: &quot;java.lang.reflect.Method&quot;,\n          &quot;method&quot;: &quot;invoke&quot;,\n          &quot;line&quot;: 568\n        },\n        {\n          &quot;class&quot;: &quot;org.springframework.aop.support.AopUtils&quot;,\n          &quot;method&quot;: &quot;invokeJoinpointUsingReflection&quot;,\n          &quot;line&quot;: 354\n        },\n        ...\n</code></pre>\n<p>Just for completeness, both entities extend area as you may have seen and Area is defined as:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Getter\n@Setter\n@AllArgsConstructor\n@NoArgsConstructor\n@Entity\n@Inheritance(strategy = InheritanceType.JOINED)\npublic class Area extends BaseEntity {\n    private Integer areaId;\n    @Column(length = 10000)\n    private String comment;\n    \n    private Instant changedDate;\n}\n</code></pre>\n<p>and BaseEntity as:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Getter\n@Setter\n@MappedSuperclass\n@AllArgsConstructor\n@NoArgsConstructor\npublic abstract class BaseEntity {\n    @Column(unique = true)\n    String uuid;\n    @Id\n    private String pkey;\n    private String name;\n\n    @PrePersist\n    public void prePersist() {\n        if (this.uuid == null || this.uuid.isEmpty()) {\n            this.uuid = java.util.UUID.randomUUID().toString();\n        }\n    }\n\n}\n</code></pre>\n<p>Any idea would be appreciated.</p>\n<p>I tried several queries because I know only basics in OData assuming my queries are the problem. I tried to manually set the column name, as I assumed it could be a problem with auto-generated values. I also tried to setup a different relationship with a different class, but the problem persists with all relations I tried. To be fair, I only tried Entities extending my BaseEntity class. I could try to change that, but I don't feel like this would be worth anything.</p>\n<p>What I expected was to get the NavigationProperty embedded into my Entity.</p>\n",
    "tags" : [ "java", "spring", "jpa", "odata", "olingo" ],
    "owner" : {
      "account_id" : 10291776,
      "reputation" : 59,
      "user_id" : 7593321,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/8a4df2f79b9f2dcf622c2604c249904b?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Severus0191",
      "link" : "https://stackoverflow.com/users/7593321/severus0191"
    },
    "is_answered" : false,
    "view_count" : 30,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1752074782,
    "creation_date" : 1752074782,
    "link" : "https://stackoverflow.com/questions/79695894/olingo-odata4-jpa-processor-cannot-resolve-attribute-when-using-expand",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}