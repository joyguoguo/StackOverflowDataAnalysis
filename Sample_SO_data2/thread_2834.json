{
  "question" : {
    "question_id" : 79594588,
    "title" : "How to customize JPA Sequence generator on Entity with @MappedSuperclass ancestor",
    "body" : "<p>How can I customise the sequence generator for each descendant when the generation strategy is defined on the ancestor?</p>\n<p>I get an <code>InvalidDataAccessResourceUsageException</code> when JPA tries to get the next ID before inserting a new record.</p>\n<p>If I create a sequence in the database with the name of the table and the default increment of 50, I do not get any errors. This is not an acceptable solution to the DBA team b/c it does not meet the naming standards.</p>\n<p>The default generator working leads me to believe that the <code>@SequenceGenerator</code> on the child is not being recognized.  I tried various combinations of <code>@Access(AccessType.FIELD)</code> and <code>@Access(AccessType.PROPERTY)</code> on both parent and child but none recognized my custom <code>SequenceGenerator</code> attributes.</p>\n<p>The DBA team wants me to &quot;just&quot; copy/paste the common attributes and code to every descendant. Certainly not DRY!</p>\n<p><strong>Update</strong></p>\n<p>I've tried various combinations of the <code>generator</code> argument for the abstract base class and <code>name</code> argument for the descendant class; only ancestor, only descendant, matching string, non-matching string.  Still errors out.</p>\n<p>This <a href=\"https://stackoverflow.com/a/1791368/1591729\">answer</a> for another question says it can be done but several comments say it can't be done.</p>\n<p><strong>Update 2</strong></p>\n<p>I created a simple project that demonstrates the error / failure of naming sequence generators in the descendant class.  The repo is on GitHub at this <a href=\"https://github.com/tvogel8570/SequenceGenerator/tree/main\" rel=\"nofollow noreferrer\">link</a>.</p>\n<p>Any suggestions on how to get this to work?</p>\n<p>Using Spring Boot 3.4.4</p>\n<p>Console log:</p>\n<blockquote>\n<p>org.springframework.dao.InvalidDataAccessResourceUsageException: could\nnot extract ResultSet [ERROR: relation &quot;descendant_one_id_seq&quot; does\nnot exist   Position: 16] [select nextval('descendant_one_id_seq')];\nSQL [select nextval('descendant_one_id_seq')]</p>\n<p>at\norg.springframework.orm.jpa.vendor.HibernateJpaDialect.convertHibernateAccessException(HibernateJpaDialect.java:277)\nat\norg.springframework.orm.jpa.vendor.HibernateJpaDialect.translateExceptionIfPossible(HibernateJpaDialect.java:241)\nat\norg.springframework.orm.jpa.AbstractEntityManagerFactoryBean.translateExceptionIfPossible(AbstractEntityManagerFactoryBean.java:560)\nat\norg.springframework.dao.support.ChainedPersistenceExceptionTranslator.translateExceptionIfPossible(ChainedPersistenceExceptionTranslator.java:61)\nat\norg.springframework.dao.support.DataAccessUtils.translateIfNecessary(DataAccessUtils.java:343)\nat\norg.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:160)\nat\norg.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)\nat\norg.springframework.data.jpa.repository.support.CrudMethodMetadataPostProcessor$CrudMethodMetadataPopulatingMethodInterceptor.invoke(CrudMethodMetadataPostProcessor.java:165)</p>\n</blockquote>\n<p>Ancestor</p>\n<pre class=\"lang-java prettyprint-override\"><code>@MappedSuperclass\npublic abstract class AbstractDatabaseEntity {\n    @Id\n    @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = &quot;entity_generator&quot;)\n    protected Long id;\n    // other common attributes\n\n    // common methods to all descendants\n}\n</code></pre>\n<p>Descendant</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Entity\n@Table(name = &quot;descendant_one&quot;)\npublic class DescendantOne extends AbstractDatabaseEntity  {\n    @SequenceGenerator(name = &quot;entity_generator&quot;, sequenceName = &quot;descendant_one_id_seq&quot;, allocationSize = 1)\n    public Long getId() {\n        return id;\n    }\n}\n</code></pre>\n<p>Descendant</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Entity\n@Table(name = &quot;descendant_two&quot;)\npublic class DescendantTwo extends AbstractDatabaseEntity  {\n    @SequenceGenerator(name = &quot;entity_generator&quot;, sequenceName = &quot;descendant_two_id_seq&quot;, allocationSize = 1)\n    public Long getId() {\n        return id;\n    }\n}\n</code></pre>\n<p>Test class demonstrating usage</p>\n<pre class=\"lang-java prettyprint-override\"><code>@ServiceTest\nclass SequenceServiceTest {\n    @Autowired\n    DescendantOneRepository repository;\n    @Autowired\n    SequenceService cut;\n\n    @BeforeEach\n    void setUp() {\n        assertThat(cut).isNotNull();\n        assertThat(repository).isNotNull();\n    }\n\n    @Test\n//    @Transactional(propagation = Propagation.NOT_SUPPORTED)\n    void createDescendantOne() {\n        var result = cut.createDescendantOne();\n        assertThat(result).isNotNull();\n    }\n}\n\n</code></pre>\n",
    "tags" : [ "java", "hibernate", "spring-data-jpa" ],
    "owner" : {
      "account_id" : 1740073,
      "reputation" : 1665,
      "user_id" : 1591729,
      "user_type" : "registered",
      "accept_rate" : 93,
      "profile_image" : "https://www.gravatar.com/avatar/aefa758ae16f9a593316b9565edbf560?s=256&d=identicon&r=PG",
      "display_name" : "Timothy Vogel",
      "link" : "https://stackoverflow.com/users/1591729/timothy-vogel"
    },
    "is_answered" : true,
    "view_count" : 185,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1745793912,
    "creation_date" : 1745718201,
    "link" : "https://stackoverflow.com/questions/79594588/how-to-customize-jpa-sequence-generator-on-entity-with-mappedsuperclass-ancesto",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79595129,
    "question_id" : 79594588,
    "body" : "<p>The solution is to move the @SequenceGenerator to the <strong>class</strong>.  The credit for the solution goes to the great IntelliJ plugin <a href=\"https://jpa-buddy.com/\" rel=\"nofollow noreferrer\">JPA Buddy</a>.</p>\n<pre><code>@SequenceGenerator(name = &quot;entity_generator&quot;, sequenceName = &quot;descendant_one_id_seq&quot;, allocationSize = 1)\npublic class DescendantOne extends AbstractDatabaseEntity {\n    @Version\n    private Integer version;\n    private String name;\n}\n</code></pre>\n<p>There is a warning in the console as below.  Per hibernate devs in this GitHub <a href=\"https://github.com/quarkusio/quarkus/issues/15538#issuecomment-793971415\" rel=\"nofollow noreferrer\">issue</a> from Mar, 2021, the warnings can be ignored since I am using @MappedSuperclass.</p>\n<p><code>HHH000069: Duplicate generator name entity_generator</code></p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 1740073,
      "reputation" : 1665,
      "user_id" : 1591729,
      "user_type" : "registered",
      "accept_rate" : 93,
      "profile_image" : "https://www.gravatar.com/avatar/aefa758ae16f9a593316b9565edbf560?s=256&d=identicon&r=PG",
      "display_name" : "Timothy Vogel",
      "link" : "https://stackoverflow.com/users/1591729/timothy-vogel"
    },
    "creation_date" : 1745764020,
    "last_activity_date" : 1745793912,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140376789,
    "post_id" : 79594588,
    "body" : "The sequence descendant_one_id_seq does not exist in your database. If you want to fix this quickly, run the following SQL in your PostgreSQL database:  &quot;CREATE SEQUENCE descendant_one_id_seq START WITH 1 INCREMENT BY 1 NO MINVALUE NO MAXVALUE CACHE 1;&quot;",
    "score" : 0,
    "owner" : {
      "account_id" : 10927511,
      "reputation" : 3218,
      "user_id" : 8031784,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/ikcJL.png?s=256",
      "display_name" : "Aniruddh Parihar",
      "link" : "https://stackoverflow.com/users/8031784/aniruddh-parihar"
    },
    "creation_date" : 1745849842,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140373859,
    "post_id" : 79594588,
    "body" : "I have the solution.  The @SequenceGenerator goes on the <b>class</b> not the <b>getter</b>.",
    "score" : 0,
    "owner" : {
      "account_id" : 1740073,
      "reputation" : 1665,
      "user_id" : 1591729,
      "user_type" : "registered",
      "accept_rate" : 93,
      "profile_image" : "https://www.gravatar.com/avatar/aefa758ae16f9a593316b9565edbf560?s=256&d=identicon&r=PG",
      "display_name" : "Timothy Vogel",
      "link" : "https://stackoverflow.com/users/1591729/timothy-vogel"
    },
    "creation_date" : 1745763938,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140373845,
    "post_id" : 79594588,
    "body" : "@Arno  Thanks for taking time to reply!  I also agree with the DBA team that a sequence per table is preferable.  I am using Postgres 17.  I added a GitHub repo with a minimal project that demonstrates the failure / error.  The Repo is referenced in the question above.  Also added the test method that is generating the error.",
    "score" : 0,
    "owner" : {
      "account_id" : 1740073,
      "reputation" : 1665,
      "user_id" : 1591729,
      "user_type" : "registered",
      "accept_rate" : 93,
      "profile_image" : "https://www.gravatar.com/avatar/aefa758ae16f9a593316b9565edbf560?s=256&d=identicon&r=PG",
      "display_name" : "Timothy Vogel",
      "link" : "https://stackoverflow.com/users/1591729/timothy-vogel"
    },
    "creation_date" : 1745763108,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140373620,
    "post_id" : 79594588,
    "body" : "Nevertheless, I agree with your DBAs and would rather define the ID and sequences per table and dedicated sequence within the db. This is also not a violation of the DRY principle and makes your system more robust, flexible and scalable.",
    "score" : 0,
    "owner" : {
      "account_id" : 11555562,
      "reputation" : 569,
      "user_id" : 8466853,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/cd7f72b426ce3c46739900b8ba014e26?s=256&d=identicon&r=PG",
      "display_name" : "Arno",
      "link" : "https://stackoverflow.com/users/8466853/arno"
    },
    "creation_date" : 1745755861,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140373604,
    "post_id" : 79594588,
    "body" : "Hi Timothy I tried your code as is and it works perfectly as expected with a postgreSQL 16 database and spring jpa. So couple of questions: - which DB and drivers are you using? - how does your JPA config looks like? - how does your code look like, trying to insert some data, producing the error?",
    "score" : 0,
    "owner" : {
      "account_id" : 11555562,
      "reputation" : 569,
      "user_id" : 8466853,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/cd7f72b426ce3c46739900b8ba014e26?s=256&d=identicon&r=PG",
      "display_name" : "Arno",
      "link" : "https://stackoverflow.com/users/8466853/arno"
    },
    "creation_date" : 1745755338,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}