{
  "question" : {
    "question_id" : 79827307,
    "title" : "Get a list of relationships from Neo4J repository using Spring",
    "body" : "<p>I started learning the development of REST API using Spring and Neo4J. I am unable to understand how Repositories work, even I looked to the documentation.</p>\n<p>I have Airport node and LINE relationship. There are stored both-way lines between two airports in the Neo4J databse. I would like to obtain all relationships between all airports. How can I do that? I tried this query. It returns correct number of instances of Line class, but all attributes are null. What am I doing wrong?</p>\n<p>This is <code>AirportNode</code> class:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Node(&quot;Airport&quot;)\n@NoArgsConstructor\n@AllArgsConstructor\n@Getter\n@Setter\npublic class AirportNode implements Serializable {\n\n    /**\n     * The unique identifier for the airport node in Neo4J.\n     */\n    @Id\n    @GeneratedValue\n    private Long id;\n\n    /**\n     * The relational database ID corresponding to this airport.\n     * This links the Neo4j node to its counterpart in a relational database.\n     */\n    @Property(&quot;relational_id&quot;)\n    private Long relationalId;\n\n    /**\n     * IATA code of the airport (3-letter code).\n     * This is a unique identifier for the airport according to the International Air Transport Association standard.\n     */\n    @Property(&quot;code&quot;)\n    private String code;\n\n    @Property(&quot;name&quot;)\n    private String name;\n\n    @Property(&quot;country&quot;)\n    private String country;\n\n    @Property(&quot;zone&quot;)\n    private String zone;\n\n    @Property(&quot;latitude&quot;)\n    private Double latitude;\n\n    @Property(&quot;longitude&quot;)\n    private Double longitude;\n/// Getters, Setters, ctors\n}\n</code></pre>\n<p>This is <code>Line</code> class:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@RelationshipProperties\n@Getter\n@Setter\npublic class Line {\n\n    /**\n     * The unique identifier for this relationship in Neo4J.\n     */\n    @Id\n    @GeneratedValue\n    private Long id;\n\n    /**\n     * The destination airport that this line connects to.\n     */\n    @TargetNode\n    private AirportNode destination;\n\n    @Property(name=&quot;distance&quot;)\n    private Double distance;\n\n    @Property(name=&quot;relational_id&quot;)\n    private Long relationalId;\n\n// getters, setters, ctors\n}\n</code></pre>\n<p>This is the <code>LineRepository</code> with the query:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public interface LineRepository extends Neo4JRepository&lt;Line, Long&gt; {\n    @Query(&quot;&quot;&quot;\n        MATCH (origin:Airport)-[r:LINE]-&gt;(destination:Airport)\n        WHERE id(origin) &lt; id(destination)\n        RETURN r, destination\n    &quot;&quot;&quot;)\n    List&lt;Line&gt; findAllLines();\n}\n</code></pre>\n",
    "tags" : [ "java", "neo4j", "spring-data-neo4j" ],
    "owner" : {
      "account_id" : 21085478,
      "reputation" : 1,
      "user_id" : 15498699,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e02aa7043d9c1b8d820b04a4d0b43d70?s=256&d=identicon&r=PG",
      "display_name" : "Quaky",
      "link" : "https://stackoverflow.com/users/15498699/quaky"
    },
    "is_answered" : false,
    "view_count" : 54,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1764150332,
    "creation_date" : 1763813465,
    "link" : "https://stackoverflow.com/questions/79827307/get-a-list-of-relationships-from-neo4j-repository-using-spring",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79830532,
    "question_id" : 79827307,
    "body" : "<p>First of all: Spring Data Neo4j only works with the <code>@Node</code> entities for repositories and <code>Neo4jTemplate</code> operations. The <code>@RelationshipProperties</code> are not meant to be fetched on their own but e.g. via an <code>Airport</code> in you case.<br />\nAs far as I can see the <code>Airport</code> class is also missing a <code>@Relationship</code> (or two for both directions) definition completely. For now just assume that you have a definition like</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Relationship(type = &quot;LINE&quot;, direction = Relationship.Direction.INCOMING)\nList&lt;Line&gt; incomingFlights;\n@Relationship(type = &quot;LINE&quot;, direction = Relationship.Direction.OUTGOING)\nList&lt;Line&gt; outgoingFlights;\n</code></pre>\n<p>Then you would use an <code>AirportRepository</code> to fetch the <code>Airports</code> and iterate over their <code>Lines</code>.<br />\nIf you're really just interested in the <code>Lines</code> w/o any information about start and end node, I would suggest using the <code>Neo4jClient</code> which is also part of Spring Data Neo4j but is unaware of the metamodel defined via the annotations.</p>\n<pre class=\"lang-java prettyprint-override\"><code>neo4jClient.query(&quot;&quot;&quot;\n       MATCH (origin:Airport)-[r:LINE]-&gt;(destination:Airport)\n       WHERE id(origin) &lt; id(destination)\n       RETURN r, destination    \n        &quot;&quot;&quot;)\n        .fetchAs(Line.class)\n        .mappedBy((typeSystem, record) -&gt; {\n            var lineRelationship = record.get(&quot;r&quot;).asRelationship();\n            // populate and return line\n        })\n        .all();\n</code></pre>\n<p>I am explicitly ignoring the <code>destination</code> in this example because if you would also be interested in this, you could use a <code>AirportRepository extends Neo4jRepository&lt;Airport, Long&gt;</code> and your Java object graph traversal with the returned <code>Airport</code> .<br />\nLast but not least, if you want to put this query into an <code>AirportRepository</code>, you should not return <code>r, destination</code> but <code>collect(r), destination</code>. This will create an array to attach to the destination airport for each record. The original query will yield a record for each line/destination combination and thus leave you in the end with just a single <code>Line</code> (SDN will overwrite the relationships in the Java collection with the last record)</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 3133300,
      "reputation" : 8282,
      "user_id" : 2650436,
      "user_type" : "registered",
      "accept_rate" : 80,
      "profile_image" : "https://www.gravatar.com/avatar/34ecacd077244d141a23c46ea094df5c?s=256&d=identicon&r=PG",
      "display_name" : "meistermeier",
      "link" : "https://stackoverflow.com/users/2650436/meistermeier"
    },
    "creation_date" : 1764150332,
    "last_activity_date" : 1764150332,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}