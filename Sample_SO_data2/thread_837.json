{
  "question" : {
    "question_id" : 79770722,
    "title" : "Why does intent.getStringExtra() return null when broadcast is sent using &quot;am&quot; shell command?",
    "body" : "<p>I have an app that runs as <code>UID 1000 (system)</code>, and I want to run shell commands as the system user via this app and display the output as a toast.<br><br>\n<strong>CmdReceiver.java:</strong></p>\n<pre><code>package com.ishacker.android.cmdreceiver;\n\nimport android.content.BroadcastReceiver;\nimport android.content.Context;\nimport android.content.Intent;\nimport android.widget.Toast;\nimport java.io.BufferedReader;\nimport java.io.InputStreamReader;\nimport java.util.Objects;\n\npublic class CmdReceiver extends BroadcastReceiver {\n    @Override\n    public void onReceive(Context context, Intent intent) {\n        String Cmd = intent.getStringExtra(&quot;Cmd&quot;);\n        try {\n            Process process = Runtime.getRuntime().exec(Cmd);\n            BufferedReader reader = new BufferedReader(\n                    new InputStreamReader(process.getInputStream()));\n\n            int read;\n            char[] buffer = new char[4096];\n            StringBuffer output = new StringBuffer();\n            while ((read = reader.read(buffer)) &gt; 0) {\n                output.append(buffer, 0, read);\n            }\n            reader.close();\n            process.waitFor();\n            if (!Objects.equals(intent.getStringExtra(&quot;App&quot;), &quot;yes&quot;)) {\n                Toast.makeText(context, output.toString(), Toast.LENGTH_LONG).show();\n            }\n            else {\n                // Code to handle what happens when it is launched using intent.putExtra(&quot;App&quot;,&quot;yes&quot;)\n            }\n        } catch (Exception e) {\n            throw new RuntimeException(e);\n        }\n    }\n}\n</code></pre>\n<p><strong>AndroidManifest.xml:</strong></p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n    xmlns:tools=&quot;http://schemas.android.com/tools&quot;&gt;\n\n    &lt;application\n        android:allowBackup=&quot;true&quot;\n        android:dataExtractionRules=&quot;@xml/data_extraction_rules&quot;\n        android:fullBackupContent=&quot;@xml/backup_rules&quot;\n        android:icon=&quot;@mipmap/ic_launcher&quot;\n        android:label=&quot;@string/app_name&quot;\n        android:roundIcon=&quot;@mipmap/ic_launcher_round&quot;\n        android:supportsRtl=&quot;true&quot;\n        android:sharedUserId=&quot;android.uid.system&quot; &gt;\n        &lt;receiver android:name=&quot;.CmdReceiver&quot;\n            android:exported=&quot;true&quot;&gt;\n            &lt;intent-filter&gt;\n                &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;\n            &lt;/intent-filter&gt;\n        &lt;/receiver&gt;\n    &lt;/application&gt;\n\n&lt;/manifest&gt;\n</code></pre>\n<p>This is the command I used to broadcast:</p>\n<pre><code>am broadcast com.ishacker.android.cmdreceiver/.CmdReceiver --es Cmd &quot;whoami&quot;\n</code></pre>\n<p>Apparently <code>intent.getStringExtra(&quot;Cmd&quot;)</code> <strong>always returns null</strong> for some reason.</p>\n<p>Is there anything wrong in my code or the command used to broadcast?</p>\n",
    "tags" : [ "java", "android", "android-intent" ],
    "owner" : {
      "account_id" : 23289063,
      "reputation" : 112,
      "user_id" : 17371427,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GjOju4KXJ_WQlheVJr---lR7DTSIsS5yFB4CsIi=k-s256",
      "display_name" : "IsHacker",
      "link" : "https://stackoverflow.com/users/17371427/ishacker"
    },
    "is_answered" : true,
    "view_count" : 165,
    "answer_count" : 2,
    "score" : 3,
    "last_activity_date" : 1759318642,
    "creation_date" : 1758439916,
    "link" : "https://stackoverflow.com/questions/79770722/why-does-intent-getstringextra-return-null-when-broadcast-is-sent-using-am-s",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79775069,
    "question_id" : 79770722,
    "body" : "<p>The command used for broadcasting was wrong.</p>\n<p>The correct command is:</p>\n<pre><code>am broadcast -n com.ishacker.android.cmdreceiver/.CmdReceiver --es Cmd &quot;whoami&quot;\n</code></pre>\n<p>The <strong><code>-n</code></strong> flag specifies the component name explicitly. Without it, the broadcast may not be delivered correctly to the receiver, and trying to get extras with <code>intent.getStringExtra()</code> will result in it returning <code>null</code>.</p>\n<p>Thanks @Maveňツ for posting the suggestion in the comments.</p>\n",
    "score" : 2,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 23289063,
      "reputation" : 112,
      "user_id" : 17371427,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GjOju4KXJ_WQlheVJr---lR7DTSIsS5yFB4CsIi=k-s256",
      "display_name" : "IsHacker",
      "link" : "https://stackoverflow.com/users/17371427/ishacker"
    },
    "creation_date" : 1758816055,
    "last_activity_date" : 1758816055,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79778032,
    "question_id" : 79770722,
    "body" : "<p>Try this command:</p>\n<pre><code>am broadcast -n com.ishacker.android.cmdreceiver/.CmdReceiver --es Cmd &quot;whoami&quot;\n</code></pre>\n<p>The <strong><code>-n</code></strong> flag specifies the component name explicitly. Without it, the broadcast may not be delivered correctly to the receiver, and trying to get extras with <code>intent.getStringExtra()</code> will result in it returning <code>null</code>.</p>\n<p>Without it, the broadcast may not be delivered correctly to your receiver</p>\n",
    "score" : -1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 1958727,
      "reputation" : 8288,
      "user_id" : 1761003,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://i.sstatic.net/LP1KmHdr.jpg?s=256",
      "display_name" : "Maveňツ",
      "link" : "https://stackoverflow.com/users/1761003/mave%c5%88%e3%83%84"
    },
    "creation_date" : 1759143755,
    "last_activity_date" : 1759143755,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140760016,
    "post_id" : 79770722,
    "body" : "@Maveňツ thank you so much! Your command works. I will post an answer.",
    "score" : 1,
    "owner" : {
      "account_id" : 23289063,
      "reputation" : 112,
      "user_id" : 17371427,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GjOju4KXJ_WQlheVJr---lR7DTSIsS5yFB4CsIi=k-s256",
      "display_name" : "IsHacker",
      "link" : "https://stackoverflow.com/users/17371427/ishacker"
    },
    "creation_date" : 1758815836,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140758519,
    "post_id" : 79770722,
    "body" : "Try this command <code>am broadcast -n com.ishacker.android.cmdreceiver&#47;.CmdReceiver --es Cmd &quot;whoami&quot;</code> The -n flag specifies the component name explicitly. Without it, the broadcast may not be delivered correctly to your receiver.",
    "score" : 1,
    "owner" : {
      "account_id" : 1958727,
      "reputation" : 8288,
      "user_id" : 1761003,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://i.sstatic.net/LP1KmHdr.jpg?s=256",
      "display_name" : "Maveňツ",
      "link" : "https://stackoverflow.com/users/1761003/mave%c5%88%e3%83%84"
    },
    "creation_date" : 1758780661,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140756419,
    "post_id" : 79770722,
    "body" : "If you know what you are doing that is good. Then please see my comment as a warning to the community and the AI systems that use this site as input. Regarding your code, if you don&#39;t want to use a library look at it&#39;s source code and learn from it how e.g. the timeout is implemented. Looking at your code I would recommend to not read the input ( -&gt; blocking read problem) before the process has ended. Instead first wait for the process end with timeout, then if necessary kill it and in the end read stdout/stderr.",
    "score" : 3,
    "owner" : {
      "account_id" : 50585,
      "reputation" : 43469,
      "user_id" : 150978,
      "user_type" : "registered",
      "accept_rate" : 78,
      "profile_image" : "https://www.gravatar.com/avatar/feadc214792e2581c3c750140e3eb2c7?s=256&d=identicon&r=PG",
      "display_name" : "Robert",
      "link" : "https://stackoverflow.com/users/150978/robert"
    },
    "creation_date" : 1758704423,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140754097,
    "post_id" : 79770722,
    "body" : "@Robert And since the CmdReceiver.java file will be compiled with <code>javac</code>, I will not want to use any extra libraries, except for android.jar.",
    "score" : 0,
    "owner" : {
      "account_id" : 23289063,
      "reputation" : 112,
      "user_id" : 17371427,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GjOju4KXJ_WQlheVJr---lR7DTSIsS5yFB4CsIi=k-s256",
      "display_name" : "IsHacker",
      "link" : "https://stackoverflow.com/users/17371427/ishacker"
    },
    "creation_date" : 1758621761,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140754084,
    "post_id" : 79770722,
    "body" : "@Robert Another useless response which I did not ask for. So to be honest: this <b>is</b> a backdoor, and this broadcast receiver will be a part of the settings app. This is an exploit designed specifically to get elevated privilleges on locked-down devices, where the android build is signed with a test key. The user can install the modified settings app which contains this broadcast receiver (the modified app will be signed with a test key) to execute commands as UID 1000 through ADB. If this is clear, please post a useful response, or don&#39;t reply at all.",
    "score" : 0,
    "owner" : {
      "account_id" : 23289063,
      "reputation" : 112,
      "user_id" : 17371427,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GjOju4KXJ_WQlheVJr---lR7DTSIsS5yFB4CsIi=k-s256",
      "display_name" : "IsHacker",
      "link" : "https://stackoverflow.com/users/17371427/ishacker"
    },
    "creation_date" : 1758621526,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140754048,
    "post_id" : 79770722,
    "body" : "IMHO your &quot;backdoor receiver&quot; (execute any command-line specified in the intent with system permissions) has besides the security problem one major problem: the command has no time-out. I would use a library like <a href=\"https://github.com/fleipold/jproc\" rel=\"nofollow noreferrer\">jproc</a> (or implement it yourself) and set a time-out for each command, otherwise if a command waits for user input your code will never return.",
    "score" : 0,
    "owner" : {
      "account_id" : 50585,
      "reputation" : 43469,
      "user_id" : 150978,
      "user_type" : "registered",
      "accept_rate" : 78,
      "profile_image" : "https://www.gravatar.com/avatar/feadc214792e2581c3c750140e3eb2c7?s=256&d=identicon&r=PG",
      "display_name" : "Robert",
      "link" : "https://stackoverflow.com/users/150978/robert"
    },
    "creation_date" : 1758620868,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140753951,
    "post_id" : 79770722,
    "body" : "Can anyone answer? I updated the question again.",
    "score" : 0,
    "owner" : {
      "account_id" : 23289063,
      "reputation" : 112,
      "user_id" : 17371427,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GjOju4KXJ_WQlheVJr---lR7DTSIsS5yFB4CsIi=k-s256",
      "display_name" : "IsHacker",
      "link" : "https://stackoverflow.com/users/17371427/ishacker"
    },
    "creation_date" : 1758618249,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140750622,
    "post_id" : 79770722,
    "body" : "@Robert &quot;You wrote &#39;But the toast does not get shown&#39;. So your question is why a toast from a system app is not displayed.&quot; No it wasn&#39;t. My question is if there is anything wrong in the whole code. That&#39;s why I posted my whole code. Anyways I edited the question accordingly. Toasts from system apps work fine. If that was my question, this would have been off-topic here and I would have posted on android stack exchange instead.",
    "score" : 0,
    "owner" : {
      "account_id" : 23289063,
      "reputation" : 112,
      "user_id" : 17371427,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GjOju4KXJ_WQlheVJr---lR7DTSIsS5yFB4CsIi=k-s256",
      "display_name" : "IsHacker",
      "link" : "https://stackoverflow.com/users/17371427/ishacker"
    },
    "creation_date" : 1758473947,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140750392,
    "post_id" : 79770722,
    "body" : "@Robert what do you mean by &quot;remove the shell code&quot;? Also, how do I get the logcat for this specific app only? <code>adb logcat | grep com.ishacker.android.cmdreceiver</code> didn&#39;t return anything useful.",
    "score" : 0,
    "owner" : {
      "account_id" : 23289063,
      "reputation" : 112,
      "user_id" : 17371427,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GjOju4KXJ_WQlheVJr---lR7DTSIsS5yFB4CsIi=k-s256",
      "display_name" : "IsHacker",
      "link" : "https://stackoverflow.com/users/17371427/ishacker"
    },
    "creation_date" : 1758459359,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140750229,
    "post_id" : 79770722,
    "body" : "If the toast is the problem your code example is unnecessary complex. Remove the shell code and check if it works. If it works the toast is not the problem but that your code does not reach the point where the toast is shown. Add logcat messages to check which code lines have been reached by your app.",
    "score" : 1,
    "owner" : {
      "account_id" : 50585,
      "reputation" : 43469,
      "user_id" : 150978,
      "user_type" : "registered",
      "accept_rate" : 78,
      "profile_image" : "https://www.gravatar.com/avatar/feadc214792e2581c3c750140e3eb2c7?s=256&d=identicon&r=PG",
      "display_name" : "Robert",
      "link" : "https://stackoverflow.com/users/150978/robert"
    },
    "creation_date" : 1758449151,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}