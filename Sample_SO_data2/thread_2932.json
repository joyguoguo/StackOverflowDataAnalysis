{
  "question" : {
    "question_id" : 79587072,
    "title" : "How to &quot;Don&#39;t Mock Things You Dont Own&quot; with JDBC",
    "body" : "<p>This is a question about &quot;testing patterns&quot;.  How to &quot;Don't Mock Things You Dont Own&quot; with JDBC?</p>\n<p>I tried to Proof Of Concept a JDBC Adapter in the below link, and after trying a few things, this is as close as I could get to the Mockito.org commandment &quot;Don't mock things you don't own&quot; .  Is there another way I could achieve this? Does anyone have experience with this?  In this case, I want to test this adapter class without mocking behavior of ResultSet.class, which I don't own.</p>\n<p>My other idea was to import H2 DB lib into my project and test against a real DB with H2, so that I don't need to mock, but testing it that way doesn't necessarily prove a connection to Oracle DB, does it?</p>\n<p><a href=\"https://github.com/austenjt/jdbc-wrapper-and-test-double/blob/main/src/test/java/org/example/adapters/JdbcResultSetAdapterTest.java\" rel=\"nofollow noreferrer\">https://github.com/austenjt/jdbc-wrapper-and-test-double/blob/main/src/test/java/org/example/adapters/JdbcResultSetAdapterTest.java</a></p>\n<p>My adapter</p>\n<pre><code>public class JdbcResultSetAdapter implements DatabaseResultSet {\n\n    private final ResultSet resultSet;\n\n    public JdbcResultSetAdapter(ResultSet resultSet) {\n        if (resultSet == null) {\n            throw new NullPointerException(&quot;ResultSet cannot be null&quot;);\n        }\n        this.resultSet = resultSet;\n    }\n\n    @Override\n    public boolean next() throws SQLException {\n        return resultSet.next();\n    }\n\n    @Override\n    public String getString(String columnLabel) throws SQLException {\n        return resultSet.getString(columnLabel);\n    }\n\n    @Override\n    public void close() throws SQLException {\n        resultSet.close();\n    }\n\n}\n</code></pre>\n<p>And my resulting test code that is mocking things I don't own:</p>\n<pre><code>public class JdbcResultSetAdapterTest {\n\n    @Mock\n    private ResultSet resultSet;\n\n    private JdbcResultSetAdapter resultSetAdapter;\n\n    @BeforeEach\n    void setUp() {\n        resultSetAdapter = new JdbcResultSetAdapter(resultSet);\n    }\n\n    @Test\n    void testNext_DelegatesToResultSet() {\n        assertDoesNotThrow(() -&gt; {\n            when(resultSet.next()).thenReturn(true);\n            boolean hasNext = resultSetAdapter.next();\n            assertTrue(hasNext, &quot;next() should return true&quot;);\n            verify(resultSet).next();\n        });\n    }\n\n    @Test\n    void testGetString_DelegatesToResultSet() {\n        String columnLabel = &quot;name&quot;;\n        assertDoesNotThrow(() -&gt; {\n            when(resultSet.getString(columnLabel)).thenReturn(&quot;John Doe&quot;);\n            String value = resultSetAdapter.getString(columnLabel);\n            assertEquals(&quot;John Doe&quot;, value, &quot;getString() should return the correct value&quot;);\n            verify(resultSet).getString(columnLabel);\n        });\n    }\n   ....\n</code></pre>\n",
    "tags" : [ "java", "unit-testing", "mocking", "mockito" ],
    "owner" : {
      "account_id" : 40774,
      "reputation" : 29843,
      "user_id" : 118228,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://i.sstatic.net/f2tOS.jpg?s=256",
      "display_name" : "djangofan",
      "link" : "https://stackoverflow.com/users/118228/djangofan"
    },
    "is_answered" : false,
    "view_count" : 86,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1747316637,
    "creation_date" : 1745341131,
    "link" : "https://stackoverflow.com/questions/79587072/how-to-dont-mock-things-you-dont-own-with-jdbc",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79623482,
    "question_id" : 79587072,
    "body" : "<p>Set up a test like this:</p>\n<pre><code>import org.junit.jupiter.api.Test;\nimport org.testcontainers.junit.jupiter.Container;\nimport org.testcontainers.junit.jupiter.Testcontainers;\nimport org.testcontainers.oracle.OracleContainer;\n\n@Testcontainers\npublic class OracleDatabaseTest {\n    static String image = &quot;gvenzl/oracle-free:23.6-slim-faststart&quot;;\n    @Container\n    static OracleContainer oracleContainer = new OracleContainer(image)\n            .withStartupTimeout(Duration.ofMinutes(3))\n            .withUsername(&quot;user&quot;)\n            .withPassword(&quot;pass&quot;);\n\n    @Test\n    public void testAdapter() {\n        // .....\n    }\n}\n</code></pre>\n<p><a href=\"https://testcontainers.com/modules/oracle-free/\" rel=\"nofollow noreferrer\">https://testcontainers.com/modules/oracle-free/</a></p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 55989,
      "reputation" : 19067,
      "user_id" : 167745,
      "user_type" : "registered",
      "accept_rate" : 76,
      "profile_image" : "https://i.sstatic.net/wBebv.jpg?s=256",
      "display_name" : "Stewart",
      "link" : "https://stackoverflow.com/users/167745/stewart"
    },
    "creation_date" : 1747316637,
    "last_activity_date" : 1747316637,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140429251,
    "post_id" : 79587072,
    "body" : "+1 to what Georgii said above and Stewart below. Unit tests are not the only type of tests, in the same way mocks are not the only test doubles. You need an integration test for this code, luckily Java has a some packages to run embedded databases (such as <a href=\"https://github.com/zonkyio/embedded-postgres\" rel=\"nofollow noreferrer\">postgres</a> or by using containers.",
    "score" : 0,
    "owner" : {
      "account_id" : 301230,
      "reputation" : 30200,
      "user_id" : 608820,
      "user_type" : "registered",
      "accept_rate" : 89,
      "profile_image" : "https://i.sstatic.net/aGmg7.jpg?s=256",
      "display_name" : "Augusto",
      "link" : "https://stackoverflow.com/users/608820/augusto"
    },
    "creation_date" : 1747320248,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140402931,
    "post_id" : 79587072,
    "body" : "As you said, you need to test against real db - you can take either embedded h2, or use testcontainers and run oracle db there",
    "score" : 1,
    "owner" : {
      "account_id" : 18586978,
      "reputation" : 3850,
      "user_id" : 15000097,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/yFl4M.jpg?s=256",
      "display_name" : "Georgii Lvov",
      "link" : "https://stackoverflow.com/users/15000097/georgii-lvov"
    },
    "creation_date" : 1746603108,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140359031,
    "post_id" : 79587072,
    "body" : "same opinion here.",
    "score" : 0,
    "owner" : {
      "account_id" : 38890247,
      "reputation" : 156,
      "user_id" : 29003408,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/LhjH9Wyd.jpg?s=256",
      "display_name" : "Andrei GreblÄƒ",
      "link" : "https://stackoverflow.com/users/29003408/andrei-grebl%c4%83"
    },
    "creation_date" : 1745348997,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140358900,
    "post_id" : 79587072,
    "body" : "I&#39;m not sure why this was closed.  This seems a clear and unambiguous question to me.",
    "score" : 5,
    "owner" : {
      "account_id" : 465573,
      "reputation" : 200423,
      "user_id" : 869736,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/ae7bb06b9a23a4dd7eea69e853d47d12?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Louis Wasserman",
      "link" : "https://stackoverflow.com/users/869736/louis-wasserman"
    },
    "creation_date" : 1745346251,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}