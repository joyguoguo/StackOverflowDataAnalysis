{
  "question" : {
    "question_id" : 79783396,
    "title" : "Split Package problem in hbase-client module in apache hbase",
    "body" : "<p>I am working on creating module-info.java file for hbase-client module in apache hbase project. Now, hbase-client has direct incoming dependency on hbase-common module.</p>\n<p>In apache hbase project, most of the packages are split across all modules.This is standard split package problem while migrating existing code to JPMS.</p>\n<p>I want some workaround of this split package problem as i cannot re-structure the packages of hbase.</p>\n<p>I've gone through some workaround but that's for like when we have two incoming dependencies which contains the same package. In that case we can create single modular jar but that can't be useful for hbase because that will result in single modular jar for hbase and that defies the motive of this project.</p>\n<p>This is my module-info.java file for hbase-client</p>\n<pre><code>module org.apache.hadoop.hbase.client {\n  requires audience.annotations;\n  requires commons.crypto;\n  requires org.apache.commons.io;\n  requires org.apache.commons.lang3;\n  requires hadoop.common;\n  requires hbase.common;\n  requires com.google.gson;\n  requires com.google.common;\n  requires hbase.unsafe;\n  requires java.management;\n  requires java.security.sasl;\n  requires jcip.annotations;\n  requires org.jruby.jcodings;\n  requires org.jruby.joni;\n  requires metrics.core;\n  requires io.opentelemetry.api;\n  requires io.opentelemetry.context;\n  requires org.slf4j;\n  requires zookeeper;\n  requires hbase.shaded.protobuf;\n  //  requires hbase.protocol.shaded;\n  //  requires hbase.shaded.netty;\n  //  requires zookeeper.jute;\n\n  exports org.apache.hadoop.hbase;\n}\n</code></pre>\n<p>I am getting this error while compiling it</p>\n<pre><code>[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.8.1:compile (default-compile) on project hbase-client: Compilation failure: Compilation failure: \n[ERROR] the unnamed module reads package org.apache.hadoop.hbase from both hbase.common and org.apache.hadoop.hbase.client\n[ERROR] the unnamed module reads package org.apache.hadoop.hbase.exceptions from both hbase.common and org.apache.hadoop.hbase.client\n[ERROR] the unnamed module reads package org.apache.hadoop.hbase.filter from both hbase.common and org.apache.hadoop.hbase.client\n[ERROR] the unnamed module reads package org.apache.hadoop.hbase.security from both hbase.common and org.apache.hadoop.hbase.client\n[ERROR] the unnamed module reads package org.apache.hadoop.hbase.util from both hbase.common and org.apache.hadoop.hbase.client\n[ERROR] the unnamed module reads package org.apache.hadoop.hbase.zookeeper from both hbase.common and org.apache.hadoop.hbase.client\n[ERROR] module org.slf4j reads package org.apache.hadoop.hbase from both org.apache.hadoop.hbase.client and hbase.common\n[ERROR] module org.slf4j reads package org.apache.hadoop.hbase.zookeeper from both org.apache.hadoop.hbase.client and hbase.common\n[ERROR] module org.slf4j reads package org.apache.hadoop.hbase.util from both org.apache.hadoop.hbase.client and hbase.common\n[ERROR] module org.slf4j reads package org.apache.hadoop.hbase.security from both org.apache.hadoop.hbase.client and hbase.common\n[ERROR] module org.slf4j reads package org.apache.hadoop.hbase.filter from both org.apache.hadoop.hbase.client and hbase.common\n[ERROR] module org.slf4j reads package org.apache.hadoop.hbase.exceptions from both org.apache.hadoop.hbase.client and hbase.common\n....\n....\n....\n</code></pre>\n<p>It's like big UnNamed Module(HBase) is reading same package from hbase.client and hbase.common.</p>\n",
    "tags" : [ "java", "hbase", "java-module", "java-platform-module-system", "hbase-client" ],
    "owner" : {
      "account_id" : 44212054,
      "reputation" : 11,
      "user_id" : 31634986,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0e1874220d99fb3e03a28b76f06c20b7?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Dev Hingu",
      "link" : "https://stackoverflow.com/users/31634986/dev-hingu"
    },
    "is_answered" : false,
    "view_count" : 70,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1759731027,
    "creation_date" : 1759731027,
    "link" : "https://stackoverflow.com/questions/79783396/split-package-problem-in-hbase-client-module-in-apache-hbase",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140796108,
    "post_id" : 79783396,
    "body" : "The module system explicitly forbids a module read two or more modules which export the same package. Furthermore, if two or more modules in the same configuration are loaded by the same class loader then they cannot contain identical packages, whether those packages are exported or not. In practice, this means modules loaded from the <code>--module-path</code> can not have any split packages; no workaround. It appears that HBase is not JPMS compatible. Unless you&#39;re willing to put in the work to make it JPMS compatible, I would suggest forgoing modules.",
    "score" : 0,
    "owner" : {
      "account_id" : 8532578,
      "reputation" : 49884,
      "user_id" : 6395627,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Slaw",
      "link" : "https://stackoverflow.com/users/6395627/slaw"
    },
    "creation_date" : 1760492706,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140782528,
    "post_id" : 79783396,
    "body" : "In your build system, you can use a shading plugin (<a href=\"https://maven.apache.org/plugins/maven-shade-plugin/examples/class-relocation.html\" rel=\"nofollow noreferrer\">Maven Shade Plugin</a> or <a href=\"https://gradleup.com/shadow/configuration/relocation/\" rel=\"nofollow noreferrer\">Shadow Gradle Plugin</a>).  When you are importing the dependencies, you can simply rename (relocate) package names.  It&#39;s a common use case when you have different versions of the same dependency.  I&#39;m not sure, however, how it works with modules which expose specific package names so it might not be possible.  In which case the whole project should refactor to rename packages.",
    "score" : 0,
    "owner" : {
      "account_id" : 1187908,
      "reputation" : 9345,
      "user_id" : 1161484,
      "user_type" : "registered",
      "accept_rate" : 93,
      "profile_image" : "https://www.gravatar.com/avatar/371797a0137ad4519049f88afac2d4e7?s=256&d=identicon&r=PG",
      "display_name" : "Daniel Widdis",
      "link" : "https://stackoverflow.com/users/1161484/daniel-widdis"
    },
    "creation_date" : 1759863529,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140781523,
    "post_id" : 79783396,
    "body" : "Hi @DanielWiddis I&#39;m kind of new to java, can you provide me some insights on how shading/relocation can be useful for this kind of problem.",
    "score" : 0,
    "owner" : {
      "account_id" : 44212054,
      "reputation" : 11,
      "user_id" : 31634986,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0e1874220d99fb3e03a28b76f06c20b7?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Dev Hingu",
      "link" : "https://stackoverflow.com/users/31634986/dev-hingu"
    },
    "creation_date" : 1759836039,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140780462,
    "post_id" : 79783396,
    "body" : "Any way you can use shading/relocation to alter the package names?  Otherwise, most other projects I&#39;ve seen in this situation just rename packages and do a major version bump.",
    "score" : 0,
    "owner" : {
      "account_id" : 1187908,
      "reputation" : 9345,
      "user_id" : 1161484,
      "user_type" : "registered",
      "accept_rate" : 93,
      "profile_image" : "https://www.gravatar.com/avatar/371797a0137ad4519049f88afac2d4e7?s=256&d=identicon&r=PG",
      "display_name" : "Daniel Widdis",
      "link" : "https://stackoverflow.com/users/1161484/daniel-widdis"
    },
    "creation_date" : 1759782025,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140779238,
    "post_id" : 79783396,
    "body" : "I don&#39;t believe there is a workaround for this. If you&#39;re modularizing a multi-module project, then you&#39;ll have to restructure the packages so that they aren&#39;t split across modules.",
    "score" : 1,
    "owner" : {
      "account_id" : 8532578,
      "reputation" : 49884,
      "user_id" : 6395627,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Slaw",
      "link" : "https://stackoverflow.com/users/6395627/slaw"
    },
    "creation_date" : 1759746092,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}