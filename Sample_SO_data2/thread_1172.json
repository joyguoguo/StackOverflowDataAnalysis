{
  "question" : {
    "question_id" : 79739567,
    "title" : "Struts 2 @VisitorFieldValidator validates all forms, not just the one you want",
    "body" : "<p>Consider the following Struts 2 action using Struts 2 core and convention plugin 6.7.0, which uses the default interceptor stack.</p>\n<pre><code>package name.matthewgreet.basicstrutsexperiments.experiment4.action;\n\nimport org.apache.struts2.ActionSupport;\nimport org.apache.struts2.convention.annotation.Action;\nimport org.apache.struts2.convention.annotation.Actions;\nimport org.apache.struts2.convention.annotation.InterceptorRef;\nimport org.apache.struts2.convention.annotation.Result;\nimport org.apache.struts2.convention.annotation.Results;\nimport org.apache.struts2.interceptor.validation.SkipValidation;\n\nimport com.opensymphony.xwork2.validator.annotations.VisitorFieldValidator;\n\nimport name.matthewgreet.basicstrutsexperiments.experiment4.form.ArithmeticForm;\nimport name.matthewgreet.basicstrutsexperiments.experiment4.form.DummyForm;\n\n\n\n@InterceptorRef(&quot;defaultStack&quot;)\n@Results({\n    @Result(name=ActionSupport.ERROR, location=&quot;/pages/experiment4/Arithmetic.jsp&quot;),\n    @Result(name=ActionSupport.INPUT, location=&quot;/pages/experiment4/Arithmetic.jsp&quot;),\n    @Result(name=ActionSupport.SUCCESS, location=&quot;/pages/experiment4/Arithmetic.jsp&quot;)\n})\npublic class ArithmeticAction extends ActionSupport {\n    private static final long serialVersionUID = -6084392315736424463L;\n    \n    private ArithmeticForm form;\n    private DummyForm dummyForm;\n\n    private String resultText;\n    \n    \n    @Actions({\n        @Action(&quot;/experiment4/&quot;),\n        @Action(&quot;/experiment4/Arithmetic&quot;)\n    })\n    @Override\n    @SkipValidation\n    public String execute() throws Exception {\n        try {\n            int result;\n            \n            if (form == null) {\n                resultText = &quot;&quot;;\n            } else if (form.getOperand2() != null) {\n                switch (form.getOperator()) {\n                case &quot;+&quot;:\n                    result = form.getOperand1() + form.getOperand2();\n                    break;\n                case &quot;-&quot;:\n                    result = form.getOperand1() - form.getOperand2();\n                    break;\n                case &quot;/&quot;:\n                    result = form.getOperand1() / form.getOperand2();\n                    break;\n                case &quot;*&quot;:\n                    result = form.getOperand1() + form.getOperand2();\n                    break;\n                default:\n                    result = 0;\n                    break;\n                }\n                \n                resultText = form.getOperand1() + &quot; &quot; + form.getOperator() + &quot; &quot; + form.getOperand2() + &quot; = &quot; + result;\n            } else {\n                resultText = &quot;Operand 2 not set&quot;;\n            }\n            \n            return SUCCESS;\n        }\n        catch (Exception e) {\n            System.out.println(&quot;Action failed  reason=&quot; + e.getMessage());\n            return ERROR;\n        }\n    }\n    \n    @Action(&quot;/Arithmetic_submit&quot;)\n    public String submit() throws Exception {\n        try {\n            int result;\n            \n            if (form.getOperand2() != null) {\n                switch (form.getOperator()) {\n                case &quot;+&quot;:\n                    result = form.getOperand1() + form.getOperand2();\n                    break;\n                case &quot;-&quot;:\n                    result = form.getOperand1() - form.getOperand2();\n                    break;\n                case &quot;/&quot;:\n                    result = form.getOperand1() / form.getOperand2();\n                    break;\n                case &quot;*&quot;:\n                    result = form.getOperand1() + form.getOperand2();\n                    break;\n                default:\n                    result = 0;\n                    break;\n                }\n                \n                resultText = form.getOperand1() + &quot; &quot; + form.getOperator() + &quot; &quot; + form.getOperand2() + &quot; = &quot; + result;\n            } else {\n                resultText = &quot;Operand 2 not set&quot;;\n            }\n            \n            return SUCCESS;\n        }\n        catch (Exception e) {\n            System.out.println(&quot;Action failed  reason=&quot; + e.getMessage());\n            return ERROR;\n        }\n    }\n    \n    @VisitorFieldValidator(appendPrefix = true)\n    public ArithmeticForm getForm() {\n        if (form == null) {\n            form = new ArithmeticForm();\n        }\n        return form;\n    }\n\n    @VisitorFieldValidator(appendPrefix = true)\n    public DummyForm getDummyForm() {\n        if (dummyForm == null) {\n            dummyForm = new DummyForm();\n        }\n        return dummyForm;\n    }\n\n    public String getResultText() {\n        return resultText;\n    }\n\n}\n</code></pre>\n<p>The forms are simple.</p>\n<pre><code>package name.matthewgreet.basicstrutsexperiments.experiment4.form;\n\nimport java.io.Serializable;\n\nimport com.opensymphony.xwork2.validator.annotations.ConversionErrorFieldValidator;\nimport com.opensymphony.xwork2.validator.annotations.RequiredFieldValidator;\nimport com.opensymphony.xwork2.validator.annotations.RequiredStringValidator;\n\npublic class ArithmeticForm implements Serializable {\n    private static final long serialVersionUID = -5287580238710655353L;\n    \n    private int operand1;\n    private String operator;\n    private Integer operand2;\n    \n    @ConversionErrorFieldValidator(message = &quot;Operand 1 must be a number!&quot;, repopulateField = true, shortCircuit = true)\n    @RequiredFieldValidator(message = &quot;Operand 1 is required&quot;)\n    public int getOperand1() {\n        return operand1;\n    }\n    public void setOperand1(int operand1) {\n        this.operand1 = operand1;\n    }\n\n    @RequiredStringValidator(message = &quot;Operator is required&quot;)\n    public String getOperator() {\n        return operator;\n    }\n    public void setOperator(String operator) {\n        this.operator = operator;\n    }\n\n    @ConversionErrorFieldValidator(message = &quot;Operand 2 must be a number!&quot;, repopulateField = true, shortCircuit = true)\n    @RequiredFieldValidator(message = &quot;Operand 2 is required&quot;)\n    public Integer getOperand2() {\n        return operand2;\n    }\n    public void setOperand2(Integer operand2) {\n        this.operand2 = operand2;\n    }\n    \n    \n    \n    @Override\n    public String toString() {\n        return &quot;ArithmeticForm [operand1=&quot; + operand1 + &quot;, operator=&quot; + operator + &quot;, operand2=&quot; + operand2 + &quot;]&quot;;\n    }\n\n}\n</code></pre>\n<pre><code>package name.matthewgreet.basicstrutsexperiments.experiment4.form;\n\nimport java.io.Serializable;\n\nimport com.opensymphony.xwork2.validator.annotations.ConversionErrorFieldValidator;\nimport com.opensymphony.xwork2.validator.annotations.RequiredFieldValidator;\n\npublic class DummyForm implements Serializable {\n    private static final long serialVersionUID = -5287580238710655353L;\n    \n    private Integer dummy;\n    \n    @RequiredFieldValidator(message = &quot;Dummy is required&quot;)\n    @ConversionErrorFieldValidator(message = &quot;Dummy must be a number!&quot;, repopulateField = true)\n    public Integer getDummy() {\n        return dummy;\n    }\n    public void setDummy(Integer value) {\n        this.dummy = value;\n    }\n\n    \n    @Override\n    public String toString() {\n        return &quot;DummyForm [dummy=&quot; + dummy + &quot;]&quot;;\n    }\n\n}\n</code></pre>\n<p>/pages/experiment4/Arithmetic.jsp</p>\n<pre><code>&lt;!DOCTYPE HTML&gt;\n&lt;%@ taglib prefix=&quot;s&quot; uri=&quot;/struts-tags&quot; %&gt;\n&lt;HTML&gt;\n&lt;HEAD&gt;\n  &lt;TITLE&gt;Experiment 4&lt;/TITLE&gt;\n&lt;/HEAD&gt;\n&lt;BODY&gt;\n  &lt;H1 STYLE=&quot;text-align: center&quot;&gt;Experiment 4&lt;/H1&gt;\n  &lt;s:fielderror /&gt;\n\n  &lt;H2&gt;Arithmetic&lt;/H2&gt;\n  &lt;FORM ACTION=&quot;&lt;s:url value=&quot;/experiment4/Arithmetic_submit.action&quot; /&gt;&quot; METHOD=&quot;POST&quot;&gt;\n    &lt;UL STYLE=&quot;list-style-type: none; width: 300px;&quot;&gt;\n      &lt;LI&gt;\n        &lt;s:label value=&quot;Operand 1:&quot; cssStyle=&quot;display: inline-block; text-align: right; width: 80px;&quot; /&gt;\n        &lt;s:textfield cssStyle=&quot;width: 40px;&quot; errorPosition=&quot;none&quot; name=&quot;form.operand1&quot; type=&quot;TEXT&quot;/&gt;\n      &lt;/LI&gt;\n      &lt;LI&gt;\n        &lt;s:label value=&quot;Operator:&quot; cssStyle=&quot;display: inline-block; text-align: right; width: 80px;&quot; /&gt;\n        &lt;s:textfield cssStyle=&quot;width: 30px;&quot; errorPosition=&quot;none&quot; name=&quot;form.operator&quot; type=&quot;TEXT&quot;/&gt;\n      &lt;/LI&gt;\n      &lt;LI&gt;\n        &lt;s:label value=&quot;Operand 2:&quot; cssStyle=&quot;display: inline-block; text-align: right; width: 80px;&quot; /&gt;\n        &lt;s:textfield cssStyle=&quot;width: 40px;&quot; errorPosition=&quot;none&quot; name=&quot;form.operand2&quot; type=&quot;TEXT&quot;/&gt;\n      &lt;/LI&gt;\n      &lt;LI&gt;\n        &lt;s:label value=&quot;Result:&quot; cssStyle=&quot;display: inline-block; text-align: right; width: 80px;&quot; /&gt;\n        &lt;s:label style=&quot;width: 100px;&quot; value=&quot;%{resultText}&quot; /&gt;\n      &lt;/LI&gt;\n      &lt;LI&gt;\n        &lt;SPAN STYLE=&quot;display: inline-block; width: 80px;&quot;&gt;&amp;nbsp;&lt;/SPAN&gt;\n        &lt;BUTTON TYPE=&quot;SUBMIT&quot;&gt;Submit&lt;/BUTTON&gt;\n      &lt;/LI&gt;\n    &lt;/UL&gt;\n  &lt;/FORM&gt;\n\n  &lt;H2&gt;Dummy&lt;/H2&gt;\n  &lt;FORM ACTION=&quot;&lt;s:url value=&quot;/experiment4/Arithmetic_submit.action&quot; /&gt;&quot; METHOD=&quot;POST&quot;&gt;\n    &lt;UL STYLE=&quot;list-style-type: none; width: 300px;&quot;&gt;\n      &lt;LI&gt;\n        &lt;s:label value=&quot;Dummy:&quot; cssStyle=&quot;display: inline-block; text-align: right; width: 80px;&quot; /&gt;\n        &lt;s:textfield cssStyle=&quot;width: 40px;&quot; errorPosition=&quot;none&quot; name=&quot;dummyForm.dummy&quot; type=&quot;TEXT&quot;/&gt;\n      &lt;/LI&gt;\n      &lt;LI&gt;\n        &lt;SPAN STYLE=&quot;display: inline-block; width: 80px;&quot;&gt;&amp;nbsp;&lt;/SPAN&gt;\n        &lt;BUTTON TYPE=&quot;SUBMIT&quot;&gt;Submit&lt;/BUTTON&gt;\n      &lt;/LI&gt;\n    &lt;/UL&gt;\n  &lt;/FORM&gt;\n\n&lt;/BODY&gt;\n&lt;/HTML&gt;\n</code></pre>\n<p>The web.xml is standard.</p>\n<pre><code>&lt;web-app&gt;\n    &lt;filter&gt;\n        &lt;filter-name&gt;struts2&lt;/filter-name&gt;\n        &lt;filter-class&gt;org.apache.struts2.dispatcher.filter.StrutsPrepareAndExecuteFilter&lt;/filter-class&gt;\n    &lt;/filter&gt;\n    &lt;filter-mapping&gt;\n        &lt;filter-name&gt;struts2&lt;/filter-name&gt;\n        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;\n    &lt;/filter-mapping&gt;\n    &lt;welcome-file-list&gt;\n        &lt;welcome-file&gt;/index.html&lt;/welcome-file&gt;\n        &lt;welcome-file&gt;/index.jsp&lt;/welcome-file&gt;\n    &lt;/welcome-file-list&gt;\n&lt;/web-app&gt;\n</code></pre>\n<p>No struts.xml is used.</p>\n<p>Before the submit function is called, both @VisitorFieldValidator annotations are noticed and both forms are validated but the dummy fails as it has no data.  There is no mechanism to restrict a form to a specific function.</p>\n<p>Incidentally, validation without annotations can be done with validation functions named like submitValidate.</p>\n<p>Using @ConditionalVisitorFieldValidator seems obvious but I can't work out any condition based on the function to be called if validation succeeds.  It seems, if the action uses two or more forms, non-annotation-based validation is possible but annotation-based validation is not.   Am I missing something?</p>\n",
    "tags" : [ "java", "struts2" ],
    "owner" : {
      "account_id" : 43377924,
      "reputation" : 36,
      "user_id" : 31215990,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/xxUKnsiI.jpg?s=256",
      "display_name" : "Matthew Greet",
      "link" : "https://stackoverflow.com/users/31215990/matthew-greet"
    },
    "is_answered" : false,
    "view_count" : 122,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1755592898,
    "creation_date" : 1755587316,
    "link" : "https://stackoverflow.com/questions/79739567/struts-2-visitorfieldvalidator-validates-all-forms-not-just-the-one-you-want",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}