{
  "question" : {
    "question_id" : 79751028,
    "title" : "DynamoDB table: How to set the Epoch timestamp from Date in Java using Spring JPA?",
    "body" : "<p>I am using Java 17, Spring Boot 2.6.2, Lombok, &amp; aws-java-sdk-1.12.136 to create a RESTful API CRUD service.</p>\n<p>I need to create a DynamoDB table which should be able to sort books in chronological order (based on sort key) with the <code>createdAt</code> attribute which is mapped to a Java Date class.</p>\n<p>CloudFormation yaml section for this new table:</p>\n<pre class=\"lang-yaml prettyprint-override\"><code>BookTable:\n  Type: AWS::DynamoDB::Table\n  Properties:\n    TableName: &quot;books&quot;\n    BillingMode: PAY_PER_REQUEST\n    PointInTimeRecoverySpecification:\n      PointInTimeRecoveryEnabled: True\n    StreamSpecification:\n      StreamViewType: NEW_AND_OLD_IMAGES\n    AttributeDefinitions:\n      - AttributeName: &quot;bookId&quot;\n        AttributeType: &quot;S&quot;\n      - AttributeName: &quot;createdAt&quot;\n        AttributeType: &quot;N&quot;\n    KeySchema:\n      - AttributeName: &quot;bookId&quot;\n        KeyType: HASH\n      - AttributeName: &quot;createdAt&quot;\n        KeyType: RANGE\n</code></pre>\n<p>DynamoDB Entity (which uses the <code>PrimaryKey</code> static inner class as a composite key):</p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.myservice.model;\n\nimport com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBAttribute;\nimport com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBDocument;\nimport com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBHashKey;\nimport com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBIgnore;\nimport com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBRangeKey;\nimport com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBTable;\nimport com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBTypeConvertedEnum;\n\nimport java.io.Serializable;\nimport java.util.Date;\nimport lombok.AllArgsConstructor;\nimport lombok.Builder;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\nimport org.springframework.data.annotation.Id;\n\n@Data\n@Builder\n@NoArgsConstructor\n@AllArgsConstructor\n@DynamoDBTable(tableName = &quot;books&quot;)\npublic class Book {\n\n    @Data\n    @Builder\n    @DynamoDBDocument\n    @NoArgsConstructor\n    @AllArgsConstructor\n    public static class PrimaryKey implements Serializable {\n\n        @DynamoDBHashKey\n        private String bookId;\n\n        @DynamoDBRangeKey\n        private Date createdAt;\n\n        @DynamoDBIgnore\n        public static Book.PrimaryKey of(String bookId, Date createdAt) {\n            return Book.PrimaryKey.builder()\n                .bookId(bookId)\n                .createdAt(createdAt)\n                .build();\n        }\n    }\n\n    @Id\n    @DynamoDBIgnore\n    private PrimaryKey pk;\n    private String description;\n\n    @DynamoDBHashKey\n    @DynamoDBAttribute(attributeName = &quot;bookId&quot;)\n    public String getbookId() {\n        return pk != null ? pk.getbookId() : null;\n    }\n\n    public Book setbookId(final String bookId) {\n        if (pk == null) {\n            pk = new Book.PrimaryKey();\n        }\n        pk.setbookId(bookId);\n        return this;\n    }\n\n    @DynamoDBRangeKey\n    @DynamoDBAttribute(attributeName = &quot;createdAt&quot;)\n    public Date getCreatedAt() {\n        return pk != null ? pk.getCreatedAt() : null;\n    }\n\n    public Book setCreatedAt(final Date createdAt) {\n        if (pk == null) {\n            pk = new Book.PrimaryKey();\n        }\n        pk.setCreatedAt(createdAt);\n        return this;\n    }\n}\n</code></pre>\n<p>Data Access Object:</p>\n<pre><code>@Repository\n@EnableScan\n@EnableScanCount\npublic interface BookDao extends DynamoDBPagingAndSortingRepository&lt;Book, Book.PrimaryKey&gt; {\n\n    Page&lt;Book&gt; findByBookId(String bookId, Pageable page);\n}\n</code></pre>\n<p>Service interface:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public interface BookService {\n\n    Page&lt;Book&gt; getBooksUsingBookId(String bookId, Pageable page);\n}\n</code></pre>\n<p>Service implementation:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Service\n@RequiredArgsConstructor\npublic class BookServiceImpl implements BookService {\n\n    private final BookDao bookDao;\n\n    @Override\n    public Page&lt;Book&gt; getBooksUsingBookId(String bookId, Pageable page) {\n        return bookDao.findByBookId(bookId, page);\n    }\n}\n</code></pre>\n<p>Using this method to convert the <code>createdAt</code> Date object to an Epoch timestamp, how do I set the timestamp inside the <code>createdAt</code> field in DynamoDB?</p>\n<pre class=\"lang-java prettyprint-override\"><code>protected Long createdTimestamp;\n\npublic Long getCreatedTimestamp() {\n    if (isNull(createdTimestamp) &amp;&amp; nonNull(getCreatedAt())) {\n        this.createdTimestamp = getCreatedAt().getTime();\n    }\n    return createdTimestamp;\n}\n</code></pre>\n",
    "tags" : [ "java", "spring", "amazon-web-services", "spring-boot", "amazon-dynamodb" ],
    "owner" : {
      "account_id" : 49142,
      "reputation" : 5494,
      "user_id" : 146234,
      "user_type" : "registered",
      "accept_rate" : 40,
      "profile_image" : "https://www.gravatar.com/avatar/903ccadd292c66cf8d231d664f753f50?s=256&d=identicon&r=PG",
      "display_name" : "PacificNW_Lover",
      "link" : "https://stackoverflow.com/users/146234/pacificnw-lover"
    },
    "is_answered" : true,
    "view_count" : 116,
    "closed_date" : 1756624181,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1757162233,
    "creation_date" : 1756542990,
    "link" : "https://stackoverflow.com/questions/79751028/dynamodb-table-how-to-set-the-epoch-timestamp-from-date-in-java-using-spring-jp",
    "closed_reason" : "Needs more focus"
  },
  "answers" : [ {
    "answer_id" : 79751166,
    "question_id" : 79751028,
    "body" : "<p>We store our createdAt fields in DynamoDB as Strings in <a href=\"https://en.wikipedia.org/wiki/ISO_8601\" rel=\"nofollow noreferrer\">ISO 8601 format</a> in the sort key.  That format is designed to be sortable for a date value.  Consider using that over an integer for the date value when using DynamoDB.</p>\n<p>How to set the converted Epoch time in milliseconds for the sort key:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public static String epochToISO8601(long epochMillis) {\n    return Instant.ofEpochMilli(epochMillis).toString();\n}\n</code></pre>\n",
    "score" : 2,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 3068,
      "reputation" : 1980,
      "user_id" : 4352,
      "user_type" : "registered",
      "accept_rate" : 93,
      "profile_image" : "https://www.gravatar.com/avatar/40c02bdbe36adf6ee1438bb774745f20?s=256&d=identicon&r=PG",
      "display_name" : "Boiler Bill",
      "link" : "https://stackoverflow.com/users/4352/boiler-bill"
    },
    "creation_date" : 1756559356,
    "last_activity_date" : 1757162233,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140704048,
    "post_id" : 79751028,
    "body" : "Related (or should be): <a href=\"https://stackoverflow.com/questions/47218487/best-approach-to-handle-java8-date-and-time-in-dynamodb\">Best approach to handle Java8 date and time in DynamoDB</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 7612423,
      "reputation" : 87409,
      "user_id" : 5772882,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/8283c64511fa80afed5259d10850168f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Anonymous",
      "link" : "https://stackoverflow.com/users/5772882/anonymous"
    },
    "creation_date" : 1756579145,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140703305,
    "post_id" : 79751028,
    "body" : "I don’t know DynamoDB. If there’s any way whatsoever you can avoid touching the <code>Date</code> class, do. It was always poorly designed and has been obsolete since Java 8. For a point in time (like creation time) use the <code>Instant</code> class.",
    "score" : 2,
    "owner" : {
      "account_id" : 7612423,
      "reputation" : 87409,
      "user_id" : 5772882,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/8283c64511fa80afed5259d10850168f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Anonymous",
      "link" : "https://stackoverflow.com/users/5772882/anonymous"
    },
    "creation_date" : 1756547446,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79751166" : [ {
      "comment_id" : 140710106,
      "post_id" : 79751166,
      "body" : "@PacificNW_Lover public static String epochToISO8601(long epochMillis) {      return Instant.ofEpochMilli(epochMillis).toString();  }",
      "score" : 1,
      "owner" : {
        "account_id" : 3068,
        "reputation" : 1980,
        "user_id" : 4352,
        "user_type" : "registered",
        "accept_rate" : 93,
        "profile_image" : "https://www.gravatar.com/avatar/40c02bdbe36adf6ee1438bb774745f20?s=256&d=identicon&r=PG",
        "display_name" : "Boiler Bill",
        "link" : "https://stackoverflow.com/users/4352/boiler-bill"
      },
      "creation_date" : 1756839996,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140704090,
      "post_id" : 79751166,
      "body" : "Thank you both for the quick responses... What I am asking is how to set the converted Epoch time in milliseconds for the sort key?",
      "score" : 0,
      "owner" : {
        "account_id" : 49142,
        "reputation" : 5494,
        "user_id" : 146234,
        "user_type" : "registered",
        "accept_rate" : 40,
        "profile_image" : "https://www.gravatar.com/avatar/903ccadd292c66cf8d231d664f753f50?s=256&d=identicon&r=PG",
        "display_name" : "PacificNW_Lover",
        "link" : "https://stackoverflow.com/users/146234/pacificnw-lover"
      },
      "creation_date" : 1756581685,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}