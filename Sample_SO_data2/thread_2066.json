{
  "question" : {
    "question_id" : 79653768,
    "title" : "Postgres empty varchar as null instead of empty string in Spring Data JPA",
    "body" : "<p>I have a table with a varchar column which represent a data in yyyy-mm-dd format. However, this field could be an empty string.</p>\n<pre><code>| id   | serial      |\n| date | varchar(10) |\n</code></pre>\n<p>I have my entity defined as</p>\n<pre><code>\nimport jakarta.persistence.*;\n\n@Entity\nclass Table {\n  @Id\n  private long Id;\n  private LocalDate date; \n}\n</code></pre>\n<p>And I use a <code>JpaRepository</code> <code>findById()</code></p>\n<p>The problem arise when column date's value is an empty string &quot;&quot;\nIt's trying to convert binary empty string to a date from org.postgresql.jdbc.TimestampUtils. I am getting an IndexOutOfBoundException because it's not expecting the string to be empty.</p>\n<p>I have a few solutions but they don't seem clean enough.</p>\n<ul>\n<li>The most obvious solution would be avoid writing empty string to date column. But this requires upstream change.</li>\n<li>Second solution is change <code>date</code> in my entity from <code>LocalDate</code> to <code>String</code> and do a manual conversion to LocalDate to a DTO. During this conversion, I have more freedom to convert empty string or null object if needed. I am not crazy about this solution since it adds extra step.</li>\n</ul>\n<p>So I am wondering if Jakarta entity has built in annotation where I could consider empty string as null? Or is there any other elegant way to circumvent this problem?</p>\n",
    "tags" : [ "java", "postgresql", "spring-data-jpa" ],
    "owner" : {
      "account_id" : 7238205,
      "reputation" : 156,
      "user_id" : 5522629,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/296b7fd08324211d564cf43a83844b1a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "stackyi",
      "link" : "https://stackoverflow.com/users/5522629/stackyi"
    },
    "is_answered" : true,
    "view_count" : 139,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1749116175,
    "creation_date" : 1749095669,
    "link" : "https://stackoverflow.com/questions/79653768/postgres-empty-varchar-as-null-instead-of-empty-string-in-spring-data-jpa",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79654181,
    "question_id" : 79653768,
    "body" : "<p>You can use AttributeConverter to convert empty string to null.</p>\n<pre class=\"lang-java prettyprint-override\"><code>import jakarta.persistence.AttributeConverter;\nimport jakarta.persistence.Converter;\n\nimport java.time.LocalDate;\n\n@Converter\npublic class LocalDateConverter implements AttributeConverter&lt;LocalDate, String&gt; {\n    @Override\n    public String convertToDatabaseColumn(LocalDate date) {\n        if (date == null) {\n            return null;\n        }\n        return date.toString();\n    }\n\n    @Override\n    public LocalDate convertToEntityAttribute(String str) {\n        if (str == null || str.isEmpty()) {\n            return null;\n        }\n        return LocalDate.parse(str);\n    }\n}\n</code></pre>\n<p>then use @Convert</p>\n<pre><code>@Convert(converter = LocalDateConverter.class)\nprivate LocalDate date;\n</code></pre>\n",
    "score" : 3,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 13244478,
      "reputation" : 56,
      "user_id" : 9564035,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/45628e9334247121b382cdb44eeae880?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Makox",
      "link" : "https://stackoverflow.com/users/9564035/makox"
    },
    "creation_date" : 1749116175,
    "last_activity_date" : 1749116175,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140509729,
    "post_id" : 79653768,
    "body" : "@Tim Biegeleisen Due to legacy codes, it&#39;s impossible to change all &quot;string date&quot; datatype from <code>varchar</code> to <code>date</code>. But next time I have to desing DB, I will keep that in mind for sure and I agree this would be the cleanest solution.",
    "score" : 0,
    "owner" : {
      "account_id" : 7238205,
      "reputation" : 156,
      "user_id" : 5522629,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/296b7fd08324211d564cf43a83844b1a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "stackyi",
      "link" : "https://stackoverflow.com/users/5522629/stackyi"
    },
    "creation_date" : 1749760370,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140491165,
    "post_id" : 79653768,
    "body" : "There is a large list of data types available, use the one that matches your data. A <code>date</code> is not a varchar, unless <code>footer</code> is a valid date on your calendar... See <a href=\"https://www.postgresql.org/docs/current/datatype.html\" rel=\"nofollow noreferrer\">postgresql.org/docs/current/datatype.html</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 101001,
      "reputation" : 129346,
      "user_id" : 271959,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/H3bQRCRO.png?s=256",
      "display_name" : "Frank Heikens",
      "link" : "https://stackoverflow.com/users/271959/frank-heikens"
    },
    "creation_date" : 1749145996,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140489207,
    "post_id" : 79653768,
    "body" : "Try to use custom converter for this field <code>@Convert(converter = LocalDateConverter.class)</code> and check for blank dates in <code>convertToEntityAttribute() </code>. function.",
    "score" : 1,
    "owner" : {
      "account_id" : 39994530,
      "reputation" : 79,
      "user_id" : 29556869,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/269e8c4932c4183f4b672023edeed8d0?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Reet",
      "link" : "https://stackoverflow.com/users/29556869/reet"
    },
    "creation_date" : 1749106155,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140488944,
    "post_id" : 79653768,
    "body" : "There is no standard JPA annotation that says “treat empty string as NULL”; you have to intercept the value yourself.",
    "score" : 2,
    "owner" : {
      "account_id" : 23615250,
      "reputation" : 513,
      "user_id" : 17649464,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/6EewnSBM.jpg?s=256",
      "display_name" : "Silikazi",
      "link" : "https://stackoverflow.com/users/17649464/silikazi"
    },
    "creation_date" : 1749098313,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140488908,
    "post_id" : 79653768,
    "body" : "The best general fix here is to stop storing dates as text in your Postgres database.  Instead, store the date in a proper <code>date</code> column.  Had you done this, the JPA mapping would work behind the scenes without issues.",
    "score" : 5,
    "owner" : {
      "account_id" : 2094057,
      "reputation" : 525996,
      "user_id" : 1863229,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://i.sstatic.net/4sh1l.png?s=256",
      "display_name" : "Tim Biegeleisen",
      "link" : "https://stackoverflow.com/users/1863229/tim-biegeleisen"
    },
    "creation_date" : 1749096291,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}