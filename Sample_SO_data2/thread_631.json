{
  "question" : {
    "question_id" : 79790915,
    "title" : "Axon Framework with postgresql: Using Bytea instead of OID not working",
    "body" : "<p>I'm using axon framework 4.12.1 with postgresql (17), flyway and spring boot (3.5.6).\nFollowing the <a href=\"https://docs.axoniq.io/axon-framework-reference/4.12/tuning/rdbms-tuning/#_postgresql_lob_annotated_columns_and_default_hibernate_mapping\" rel=\"nofollow noreferrer\">recommendations</a> I changed the sql migration files to use bytea instead of oid and configured the appropriate orm.xml.</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;entity-mappings version=&quot;2.0&quot; xmlns=&quot;http://java.sun.com/xml/ns/persistence/orm&quot;&gt;\n    &lt;mapped-superclass access=&quot;FIELD&quot; metadata-complete=&quot;false&quot;\n                       class=&quot;org.axonframework.eventhandling.AbstractSequencedDomainEventEntry&quot;&gt;\n        &lt;attributes&gt;\n            &lt;id name=&quot;globalIndex&quot;&gt;\n                &lt;generated-value strategy=&quot;SEQUENCE&quot; generator=&quot;mySequenceGenerator&quot;/&gt;\n                &lt;sequence-generator name=&quot;mySequenceGenerator&quot; sequence-name=&quot;domain_event_entry_seq&quot;\n                                    allocation-size=&quot;1&quot;/&gt;\n            &lt;/id&gt;\n            &lt;basic name=&quot;metaData&quot;&gt;\n                &lt;column name=&quot;meta_data&quot; column-definition=&quot;BYTEA&quot;/&gt;\n            &lt;/basic&gt;\n            &lt;basic name=&quot;payload&quot;&gt;\n                &lt;column name=&quot;payload&quot; column-definition=&quot;BYTEA&quot;/&gt;\n            &lt;/basic&gt;\n        &lt;/attributes&gt;\n    &lt;/mapped-superclass&gt;\n    &lt;entity class=&quot;org.axonframework.modelling.saga.repository.jpa.SagaEntry&quot;&gt;\n        &lt;attribute-override name=&quot;serializedSaga&quot;&gt;\n            &lt;column name=&quot;serialized_saga&quot; column-definition=&quot;BYTEA&quot;&gt;&lt;/column&gt;\n        &lt;/attribute-override&gt;\n    &lt;/entity&gt;\n    &lt;entity class=&quot;org.axonframework.eventhandling.tokenstore.jpa.TokenEntry&quot;&gt;\n        &lt;attribute-override name=&quot;token&quot;&gt;\n            &lt;column name=&quot;token&quot; column-definition=&quot;BYTEA&quot;&gt;&lt;/column&gt;\n        &lt;/attribute-override&gt;\n    &lt;/entity&gt;\n    &lt;entity class=&quot;org.axonframework.eventsourcing.eventstore.jpa.SnapshotEventEntry&quot;&gt;\n        &lt;attribute-override name=&quot;metaData&quot;&gt;\n            &lt;column name=&quot;meta_data&quot; column-definition=&quot;BYTEA&quot;&gt;&lt;/column&gt;\n        &lt;/attribute-override&gt;\n        &lt;attribute-override name=&quot;payload&quot;&gt;\n            &lt;column name=&quot;payload&quot; column-definition=&quot;BYTEA&quot;&gt;&lt;/column&gt;\n        &lt;/attribute-override&gt;\n    &lt;/entity&gt;\n    &lt;entity class=&quot;org.axonframework.eventhandling.deadletter.jpa.DeadLetterEntry&quot;&gt;\n        &lt;attribute-override name=&quot;diagnostics&quot;&gt;\n            &lt;column name=&quot;diagnostics&quot; column-definition=&quot;BYTEA&quot;&gt;&lt;/column&gt;\n        &lt;/attribute-override&gt;\n        &lt;attribute-override name=&quot;metaData&quot;&gt;\n            &lt;column name=&quot;meta_data&quot; column-definition=&quot;BYTEA&quot;&gt;&lt;/column&gt;\n        &lt;/attribute-override&gt;\n        &lt;attribute-override name=&quot;payload&quot;&gt;\n            &lt;column name=&quot;payload&quot; column-definition=&quot;BYTEA&quot;&gt;&lt;/column&gt;\n        &lt;/attribute-override&gt;\n        &lt;attribute-override name=&quot;token&quot;&gt;\n            &lt;column name=&quot;token&quot; column-definition=&quot;BYTEA&quot;&gt;&lt;/column&gt;\n        &lt;/attribute-override&gt;\n    &lt;/entity&gt;\n&lt;/entity-mappings&gt;\n</code></pre>\n<p>when using the app it's now failing with</p>\n<blockquote>\n<p>org.hibernate.exception.SQLGrammarException: could not execute\nstatement [ERROR: column &quot;meta_data&quot; is of type bytea but expression\nis of type bigint   Hint: You will need to rewrite or cast the\nexpression.   Position: 179] [insert into domain_event_entry\n(aggregate_identifier,event_identifier,meta_data,payload,payload_revision,payload_type,sequence_number,time_stamp,type,global_index)\nvalues (?,?,?,?,?,?,?,?,?,?)]</p>\n</blockquote>\n<p>domain event entry table definition:</p>\n<pre class=\"lang-sql prettyprint-override\"><code>create table public.domain_event_entry\n(\n    global_index         bigserial\n        constraint pk_domain_event_entry\n            primary key,\n    aggregate_identifier varchar(255) not null,\n    sequence_number      bigint       not null,\n    type                 varchar(255),\n    event_identifier     varchar(255) not null\n        constraint uk_domain_event_entry_identifier\n            unique,\n    meta_data            bytea,\n    payload              bytea        not null,\n    payload_revision     varchar(255),\n    payload_type         varchar(255) not null,\n    time_stamp           varchar(255) not null,\n    constraint uk_domain_event_entry\n        unique (aggregate_identifier, sequence_number)\n);\n\ncreate unique index idx_domain_event_entry_aggregate_seq\n    on public.domain_event_entry (aggregate_identifier, sequence_number);\n\ncreate unique index idx_domain_event_entry_event_id\n    on public.domain_event_entry (event_identifier);\n\n</code></pre>\n<p>application.properties (excerpt):</p>\n<pre><code>spring.datasource.driverClassName=org.postgresql.Driver\nspring.jpa.database-platform=com.haufe.zeva.infrastructure.persistence.ByteaEnforcedPostgresSQLDialect # the dialect I copied from the documentation\nspring.jpa.generate-ddl=false\nspring.jpa.hibernate.ddl-auto=none\nspring.jpa.properties.hibernate.hbm2ddl.auto=none\nspring.jpa.properties.jakarta.persistence.schema-generation.database.action=none\nspring.jpa.properties.jakarta.persistence.schema-generation.create-source=none\nspring.jpa.properties.jakarta.persistence.schema-generation.drop-source=none\nspring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl\nspring.jpa.hibernate.naming.strategy=org.hibernate.cfg.EJB3NamingStrategy\nspring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true\nspring.jpa.open-in-view=false\nspring.jpa.properties.hibernate.multiTenancy=DISCRIMINATOR\nspring.jpa.properties.hibernate.tenant_identifier_resolver=com.som.path.TenantResolver\nspring.jpa.properties.hibernate.hbm2ddl.halt_on_error=false\n# axon framework\naxon.axonserver.enabled=false\n</code></pre>\n<p>How to make the configuration work with <code>bytea</code>?</p>\n",
    "tags" : [ "java", "postgresql", "spring-boot", "flyway", "axon" ],
    "owner" : {
      "account_id" : 13704422,
      "reputation" : 1725,
      "user_id" : 9888512,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9dcd79663ed2d8dc76afe278b6674305?s=256&d=identicon&r=PG",
      "display_name" : "MatterOfFact",
      "link" : "https://stackoverflow.com/users/9888512/matteroffact"
    },
    "is_answered" : false,
    "view_count" : 91,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1761744043,
    "creation_date" : 1760515242,
    "link" : "https://stackoverflow.com/questions/79790915/axon-framework-with-postgresql-using-bytea-instead-of-oid-not-working",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79803841,
    "question_id" : 79790915,
    "body" : "<p>I found the issue. in the orm.xml, I had to use</p>\n<pre><code>org.axonframework.eventhandling.AbstractDomainEventEntry\n</code></pre>\n<p>for the attribute config instead of</p>\n<pre><code>org.axonframework.eventhandling.AbstractSequencedDomainEventEntry\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 13704422,
      "reputation" : 1725,
      "user_id" : 9888512,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9dcd79663ed2d8dc76afe278b6674305?s=256&d=identicon&r=PG",
      "display_name" : "MatterOfFact",
      "link" : "https://stackoverflow.com/users/9888512/matteroffact"
    },
    "creation_date" : 1761744043,
    "last_activity_date" : 1761744043,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140824943,
    "post_id" : 79790915,
    "body" : "@M.Deinum Yes, that was all I have. I now found the issue. Thanks for you comments!",
    "score" : 0,
    "owner" : {
      "account_id" : 13704422,
      "reputation" : 1725,
      "user_id" : 9888512,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9dcd79663ed2d8dc76afe278b6674305?s=256&d=identicon&r=PG",
      "display_name" : "MatterOfFact",
      "link" : "https://stackoverflow.com/users/9888512/matteroffact"
    },
    "creation_date" : 1761744153,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140824940,
    "post_id" : 79790915,
    "body" : "@john16384 Yes I did like recommended in the linked documentation. I now found the issue. Thanks for your comments!",
    "score" : 0,
    "owner" : {
      "account_id" : 13704422,
      "reputation" : 1725,
      "user_id" : 9888512,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9dcd79663ed2d8dc76afe278b6674305?s=256&d=identicon&r=PG",
      "display_name" : "MatterOfFact",
      "link" : "https://stackoverflow.com/users/9888512/matteroffact"
    },
    "creation_date" : 1761744119,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140822262,
    "post_id" : 79790915,
    "body" : "Is that all you have for JPA/Hibernate proprties? No accidental <code>hibernate.properties</code> or anoter configuration containing either <code>spring.jpa.database</code> and/or <code>spring.jpa.properties.hibernate.dialect</code>?",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1761645484,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140820123,
    "post_id" : 79790915,
    "body" : "Did you also set a different hibernate dialect for this?  See this part in the guide: &quot;Hibernate dialect changes&quot;.  It sounds like Hibernate still is seeing the <code>Lob</code> type, and wants to store an integer there, but it can&#39;t because the column is now of type <code>bytea</code>.",
    "score" : 0,
    "owner" : {
      "account_id" : 1316033,
      "reputation" : 8088,
      "user_id" : 1262865,
      "user_type" : "registered",
      "accept_rate" : 50,
      "profile_image" : "https://i.sstatic.net/ojvZh.jpg?s=256",
      "display_name" : "john16384",
      "link" : "https://stackoverflow.com/users/1262865/john16384"
    },
    "creation_date" : 1761559650,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140805646,
    "post_id" : 79790915,
    "body" : "@M.Deinum I added the application.properties",
    "score" : 0,
    "owner" : {
      "account_id" : 13704422,
      "reputation" : 1725,
      "user_id" : 9888512,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9dcd79663ed2d8dc76afe278b6674305?s=256&d=identicon&r=PG",
      "display_name" : "MatterOfFact",
      "link" : "https://stackoverflow.com/users/9888512/matteroffact"
    },
    "creation_date" : 1760938254,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140805643,
    "post_id" : 79790915,
    "body" : "@JohnH events are stored by axon so the code for this is in the axon framework",
    "score" : 0,
    "owner" : {
      "account_id" : 13704422,
      "reputation" : 1725,
      "user_id" : 9888512,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9dcd79663ed2d8dc76afe278b6674305?s=256&d=identicon&r=PG",
      "display_name" : "MatterOfFact",
      "link" : "https://stackoverflow.com/users/9888512/matteroffact"
    },
    "creation_date" : 1760938010,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140800725,
    "post_id" : 79790915,
    "body" : "The error occurred during an insert, but the post doesn&#39;t have any code that would insert data.",
    "score" : 0,
    "owner" : {
      "account_id" : 4349512,
      "reputation" : 3293,
      "user_id" : 20151367,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/ALm5wu3uXrolKqgMDGfomizrFVOQ6NQfa6jlM2o5rese=k-s256",
      "display_name" : "JohnH",
      "link" : "https://stackoverflow.com/users/20151367/johnh"
    },
    "creation_date" : 1760651734,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140799684,
    "post_id" : 79790915,
    "body" : "The error would indicate that you have misconfigured the custom dialect or have other configuration in there which overrides that. So add your <code>application.properties</code> file.",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1760621099,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140799585,
    "post_id" : 79790915,
    "body" : "@JohnH which relevant code is missing in your opinion?",
    "score" : 0,
    "owner" : {
      "account_id" : 13704422,
      "reputation" : 1725,
      "user_id" : 9888512,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9dcd79663ed2d8dc76afe278b6674305?s=256&d=identicon&r=PG",
      "display_name" : "MatterOfFact",
      "link" : "https://stackoverflow.com/users/9888512/matteroffact"
    },
    "creation_date" : 1760619226,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140799582,
    "post_id" : 79790915,
    "body" : "@M.Deinum yes i followed the steps in the doc and added the custom dialect class as stated there and i also adapted the application properties file",
    "score" : 0,
    "owner" : {
      "account_id" : 13704422,
      "reputation" : 1725,
      "user_id" : 9888512,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9dcd79663ed2d8dc76afe278b6674305?s=256&d=identicon&r=PG",
      "display_name" : "MatterOfFact",
      "link" : "https://stackoverflow.com/users/9888512/matteroffact"
    },
    "creation_date" : 1760619206,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140799022,
    "post_id" : 79790915,
    "body" : "Have you followed <b>all</b> steps in the guide including the custom dialect you need!",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1760604072,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140797012,
    "post_id" : 79790915,
    "body" : "The error message states that the exception occurred while inserting data. The problem is that the code and revised schema aren&#39;t compatible. Please update the post with the relevant code.",
    "score" : 0,
    "owner" : {
      "account_id" : 4349512,
      "reputation" : 3293,
      "user_id" : 20151367,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/ALm5wu3uXrolKqgMDGfomizrFVOQ6NQfa6jlM2o5rese=k-s256",
      "display_name" : "JohnH",
      "link" : "https://stackoverflow.com/users/20151367/johnh"
    },
    "creation_date" : 1760530095,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}