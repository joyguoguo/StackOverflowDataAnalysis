{
  "question" : {
    "question_id" : 79756714,
    "title" : "Jasypt Hibernate5 Password Decryption Not Working",
    "body" : "<p>Our application was using Hibernate 5 and Jasypt 1.9.3. We have kept the database password encrypted using JasyptCLI. Upon executing the application, the following error was logged:</p>\n<pre class=\"lang-none prettyprint-override\"><code>2025-09-03 13:33:42,275 ERROR [FIEPSBatchmain][][ ] Exception occurred in Class Name : org.hibernate.service.internal.AbstractServiceRegistryImpl    Method Name : createService    Line Number : 244\n2025-09-03 13:33:42,275 DEBUG [FIEPSBatchmain][][ ] there is some exception \norg.hibernate.service.spi.ServiceException: Unable to create requested service [org.hibernate.engine.jdbc.env.spi.JdbcEnvironment]\n    at org.hibernate.service.internal.AbstractServiceRegistryImpl.createService(AbstractServiceRegistryImpl.java:244) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.service.internal.AbstractServiceRegistryImpl.initializeService(AbstractServiceRegistryImpl.java:208) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.service.internal.AbstractServiceRegistryImpl.getService(AbstractServiceRegistryImpl.java:189) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.engine.jdbc.internal.JdbcServicesImpl.configure(JdbcServicesImpl.java:51) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.boot.registry.internal.StandardServiceRegistryImpl.configureService(StandardServiceRegistryImpl.java:94) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.service.internal.AbstractServiceRegistryImpl.initializeService(AbstractServiceRegistryImpl.java:217) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.service.internal.AbstractServiceRegistryImpl.getService(AbstractServiceRegistryImpl.java:189) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.boot.model.process.spi.MetadataBuildingProcess.handleTypes(MetadataBuildingProcess.java:352) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.boot.model.process.spi.MetadataBuildingProcess.complete(MetadataBuildingProcess.java:111) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.boot.model.process.spi.MetadataBuildingProcess.build(MetadataBuildingProcess.java:83) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at  \nCaused by: org.hibernate.exception.JDBCConnectionException: Error calling Driver#connect\n    at org.hibernate.engine.jdbc.connections.internal.BasicConnectionCreator$1$1.convert(BasicConnectionCreator.java:105) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.engine.jdbc.connections.internal.BasicConnectionCreator.convertSqlException(BasicConnectionCreator.java:123) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.engine.jdbc.connections.internal.DriverConnectionCreator.makeConnection(DriverConnectionCreator.java:41) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.engine.jdbc.connections.internal.BasicConnectionCreator.createConnection(BasicConnectionCreator.java:58) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.engine.jdbc.connections.internal.PooledConnections.addConnections(PooledConnections.java:106) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.engine.jdbc.connections.internal.PooledConnections.&lt;init&gt;(PooledConnections.java:40) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.engine.jdbc.connections.internal.PooledConnections.&lt;init&gt;(PooledConnections.java:19) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.engine.jdbc.connections.internal.PooledConnections$Builder.build(PooledConnections.java:138) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.engine.jdbc.connections.internal.DriverManagerConnectionProviderImpl.buildPool(DriverManagerConnectionProviderImpl.java:110) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.engine.jdbc.connections.internal.DriverManagerConnectionProviderImpl.configure(DriverManagerConnectionProviderImpl.java:74) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.boot.registry.internal.StandardServiceRegistryImpl.configureService(StandardServiceRegistryImpl.java:94) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.service.internal.AbstractServiceRegistryImpl.initializeService(AbstractServiceRegistryImpl.java:217) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.service.internal.AbstractServiceRegistryImpl.getService(AbstractServiceRegistryImpl.java:189) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.buildJdbcConnectionAccess(JdbcEnvironmentInitiator.java:145) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.initiateService(JdbcEnvironmentInitiator.java:66) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.initiateService(JdbcEnvironmentInitiator.java:35) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.boot.registry.internal.StandardServiceRegistryImpl.initiateService(StandardServiceRegistryImpl.java:88) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    at org.hibernate.service.internal.AbstractServiceRegistryImpl.createService(AbstractServiceRegistryImpl.java:234) ~[hibernate-core-5.0.9.Final.jar:5.0.9.Final]\n    ... 13 more\nCaused by: java.sql.SQLException: Access denied for user 'root'@'localhost' (using password: YES)\n    at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:129) ~[mysql-connector-java-8.0.16.jar:8.0.16]\n    at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:97) ~[mysql-connector-java-8.0.16.jar:8.0.16]\n    at \n</code></pre>\n<p><strong>Analysis</strong></p>\n<ul>\n<li>There was no issue in the database network or permissions configuration. The password that was sent in the request to connect to the database was not sent in the clear. Jasypt should have decrypted this password using <code>EncryptedPasswordDriverManagerConnectionProvider</code>.</li>\n</ul>\n<p><strong>Details of the configuration</strong></p>\n<ul>\n<li>Hibernate5.0.9-Final.jar</li>\n<li>jasypt-1.9.3.jar</li>\n<li>jasypt-hibernate5-1.9.3.jar</li>\n</ul>\n<p><code>Hibernate.cfg.xml</code>:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;?xml version='1.0'?&gt;\n&lt;!DOCTYPE hibernate-configuration PUBLIC &quot;-//Hibernate/Hibernate Configuration DTD 5.0.9//EN&quot; &quot;http://www.hibernate.org/dtd/hibernate-configuration/hibernate-configuration-5.0.9.dtd&quot;&gt;\n&lt;hibernate-configuration&gt;\n    &lt;session-factory&gt;\n\n         &lt;property name=&quot;hibernate.connection.provider_class&quot;&gt;org.jasypt.hibernate5.connectionprovider.EncryptedPasswordDriverManagerConnectionProvider&lt;/property&gt; \n&lt;property name=&quot;hibernate.connection.encryptor_registered_name&quot;&gt;configurationHibernateEncryptor&lt;/property&gt;    \n        &lt;property name=&quot;hibernate.connection.driver_class&quot;&gt;com.mysql.cj.jdbc.Driver&lt;/property&gt;\n        &lt;property name=&quot;hibernate.connection.url&quot;&gt;jdbc:mysql://localhost:3306/test&lt;/property&gt;\n        &lt;property name=&quot;hibernate.jdbc.batch_size&quot;&gt; 0 &lt;/property&gt;\n        &lt;property name=&quot;hibernate.jdbc.use_streams_for_binary&quot;&gt; true &lt;/property&gt;\n        &lt;property name=&quot;hibernate.connection.username&quot;&gt;root&lt;/property&gt;\n        &lt;property name=&quot;hibernate.connection.password&quot;&gt;ENC(AaQ8B9q34401biN00TKSdjN6OvpJvcDY)&lt;/property&gt; \n        &lt;property name=&quot;hibernate.connection.pool_size&quot;&gt; 10 &lt;/property&gt;\n        &lt;property name=&quot;connection.autocommit&quot;&gt; true &lt;/property&gt;\n        &lt;property name=&quot;show_sql&quot;&gt;false&lt;/property&gt;\n        &lt;property name=&quot;hibernate.dialect&quot;&gt;org.hibernate.dialect.MySQLDialect&lt;/property&gt;\n\n    &lt;/session-factory&gt;      \n\n&lt;/hibernate-configuration&gt; \n</code></pre>\n<p><code>HibernateUtil.java</code></p>\n<pre class=\"lang-java prettyprint-override\"><code>public static void loadSecure() {\n        StandardPBEStringEncryptor strongEncryptor = new StandardPBEStringEncryptor();\n        strongEncryptor.setAlgorithm(&quot;PBEWithMD5AndTripleDES&quot;);\n        strongEncryptor.setPassword(&quot;3758ce1ff7b1462ea6a0a8a054cfd966&quot;);\n        HibernatePBEEncryptorRegistry registry = HibernatePBEEncryptorRegistry\n                .getInstance();\n        registry.registerPBEStringEncryptor(&quot;configurationHibernateEncryptor&quot;,\n                strongEncryptor);\n    }\n\n\n\nFile file = new File(hbConfFileLoc);\nStandardServiceRegistry standardRegistry = new StandardServiceRegistryBuilder().configure(file).build();\nMetadata metaData =  new MetadataSources(standardRegistry).getMetadataBuilder().build();\nsessionFactory = metaData.getSessionFactoryBuilder().build();  //error occurs here\n</code></pre>\n",
    "tags" : [ "java", "hibernate", "jasypt" ],
    "owner" : {
      "account_id" : 1627501,
      "reputation" : 113,
      "user_id" : 1502707,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/UA9xb.jpg?s=256",
      "display_name" : "Karthik_Rajendiran",
      "link" : "https://stackoverflow.com/users/1502707/karthik-rajendiran"
    },
    "is_answered" : false,
    "view_count" : 56,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1757316486,
    "creation_date" : 1757070202,
    "link" : "https://stackoverflow.com/questions/79756714/jasypt-hibernate5-password-decryption-not-working",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140721339,
    "post_id" : 79756714,
    "body" : "It is good you solved the problem. Please post it as an answer to your question.",
    "score" : 0,
    "owner" : {
      "account_id" : 9842376,
      "reputation" : 2313,
      "user_id" : 7465516,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5e167bc0e9829e026d8c9a4bad92e94b?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "julaine",
      "link" : "https://stackoverflow.com/users/7465516/julaine"
    },
    "creation_date" : 1757319427,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140716917,
    "post_id" : 79756714,
    "body" : "FInally, Find out the Solution EncryptedPasswordDriverManagerConnectionProvider ihas configure Method of Signature configure(final Properties props) ,but hibernate expects configure(final Map maps),   <a href=\"https://github.com/jasypt/jasypt/issues/161\" rel=\"nofollow noreferrer\">github.com/jasypt/jasypt/issues/161</a>  We have Taken source code of Jasypt-hibernate5 and added a overloaded method with configure(Map) and made it work  Refer - <a href=\"https://github.com/jasypt/jasypt/issues/26\" rel=\"nofollow noreferrer\">github.com/jasypt/jasypt/issues/26</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 1627501,
      "reputation" : 113,
      "user_id" : 1502707,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/UA9xb.jpg?s=256",
      "display_name" : "Karthik_Rajendiran",
      "link" : "https://stackoverflow.com/users/1502707/karthik-rajendiran"
    },
    "creation_date" : 1757070276,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}