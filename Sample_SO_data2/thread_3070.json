{
  "question" : {
    "question_id" : 79576128,
    "title" : "Is the Java float to double cast lossy?",
    "body" : "<p>I am creating a float value using raw int bits where the mantissa has all bits set to 1. However, casting to double flips the final bit to 0. Why does this happen? From what I've been seeing online, the float to double cast is supposed to preserve the mantissa and exponent since double can accommodate all floats.</p>\n<pre><code>class Main {\n    public static void main(String[] args) {\n        float f = Float.intBitsToFloat((1 &lt;&lt; 23) - 1);\n        // The following line gives 23 consecutive 1s representing a mantissa with all bits set to 1.\n        System.out.println(Integer.toBinaryString(Float.floatToIntBits(f)));\n        double d = f;\n        // The following line gives 11100000001111111111111111111111000000000000000000000000000000.\n        // The mantissa has 22 consecutive 1s not 23 like in the original float\n        System.out.println(Long.toBinaryString(Double.doubleToLongBits(d)));\n    }\n}\n</code></pre>\n<p>I'm using JDK 17, and adding strictfp to the function retains this behavior. I do get a warning saying that strictfp is no longer required.</p>\n",
    "tags" : [ "java", "casting", "floating-point", "precision" ],
    "owner" : {
      "account_id" : 15122696,
      "reputation" : 126,
      "user_id" : 10913049,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-fRbuYGKVbVw/AAAAAAAAAAI/AAAAAAAAACM/jGT6sxrATEs/s256-rj/photo.jpg",
      "display_name" : "Harsh Motwani",
      "link" : "https://stackoverflow.com/users/10913049/harsh-motwani"
    },
    "is_answered" : true,
    "view_count" : 171,
    "answer_count" : 2,
    "score" : 5,
    "last_activity_date" : 1744952882,
    "creation_date" : 1744756679,
    "link" : "https://stackoverflow.com/questions/79576128/is-the-java-float-to-double-cast-lossy",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79576157,
    "question_id" : 79576128,
    "body" : "<p>These numbers are equal. The conversion is not lossy.</p>\n<p>Your float is subnormal. Subnormal floats have an implicit leading bit of 0 rather than 1 in the mantissa.</p>\n<p>Your double is normal. It has an implicit leading bit of 1 in the mantissa.</p>\n<p>Including the implicit leading bit, both of these numbers have a mantissa with 23 consecutive 1s.</p>\n",
    "score" : 11,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 2734060,
      "reputation" : 286135,
      "user_id" : 2357112,
      "user_type" : "registered",
      "accept_rate" : 26,
      "profile_image" : "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=256&d=identicon&r=PG",
      "display_name" : "user2357112",
      "link" : "https://stackoverflow.com/users/2357112/user2357112"
    },
    "creation_date" : 1744757971,
    "last_activity_date" : 1744757971,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79577459,
    "question_id" : 79576128,
    "body" : "<p>Float to <code>double</code> is not lossy, but rounding is handled as default in <a href=\"https://en.m.wikipedia.org/wiki/IEEE_754\" rel=\"nofollow noreferrer\">IEEE 754</a> standard and so, rounds mantissa so last bit is even (to produce equal probability rounding)  but there should be no rounding in that process.</p>\n<p>Anyway, <code>double</code> has 53 mantissa bits and <code>float</code> only 24, there should not be any loss of precission in the conversion... all bits in <code>float</code> have their counterpart in <code>double</code>.  The first 23 bits of the mantissa (If I remember, the <code>float</code> type has the most significative bit of the mantissa implicit ---this is, not represented, as it is always 1---, while that approach is not represented in memory)</p>\n<p><strong>Note:</strong> Indeed I'm wrong, the most significative bit of <code>double</code> is also implicit.  But it is also possible that the bit you see as zero is because of this implicit bit that counts for precision but is not used, except for <em>subnormal</em> values.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 4831287,
      "reputation" : 13152,
      "user_id" : 3899431,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/UeEzu.jpg?s=256",
      "display_name" : "Luis Colorado",
      "link" : "https://stackoverflow.com/users/3899431/luis-colorado"
    },
    "creation_date" : 1744814885,
    "last_activity_date" : 1744952882,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140346962,
    "post_id" : 79576128,
    "body" : "When reading Answers, see also <i>Java Language Specification</i>, section <a href=\"https://docs.oracle.com/javase/specs/jls/se24/html/jls-4.html#jls-4.2.3\" rel=\"nofollow noreferrer\"><i>4.2.3. Floating-Point Types and Values</i></a>.",
    "score" : 1,
    "owner" : {
      "account_id" : 322981,
      "reputation" : 347089,
      "user_id" : 642706,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://i.sstatic.net/ZWEI3.jpg?s=256",
      "display_name" : "Basil Bourque",
      "link" : "https://stackoverflow.com/users/642706/basil-bourque"
    },
    "creation_date" : 1744953087,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140341895,
    "post_id" : 79576128,
    "body" : "convert it back to <code>float</code> and you should get the same bits --&gt; no loss",
    "score" : 0,
    "owner" : {
      "account_id" : 31180,
      "reputation" : 29752,
      "user_id" : 85421,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/kKvXH.gif?s=256",
      "display_name" : "user85421",
      "link" : "https://stackoverflow.com/users/85421/user85421"
    },
    "creation_date" : 1744827131,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140339274,
    "post_id" : 79576128,
    "body" : "<code>strictfp</code> hasn&#39;t done anything in Java <a href=\"https://en.wikipedia.org/wiki/Strictfp\" rel=\"nofollow noreferrer\">since Java 17</a>..",
    "score" : 0,
    "owner" : {
      "account_id" : 71739,
      "reputation" : 311888,
      "user_id" : 207421,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=256&d=identicon&r=PG",
      "display_name" : "user207421",
      "link" : "https://stackoverflow.com/users/207421/user207421"
    },
    "creation_date" : 1744777273,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140338843,
    "post_id" : 79576128,
    "body" : "What version of Java? Some things changed: <a href=\"https://openjdk.org/jeps/306\" rel=\"nofollow noreferrer\"><i>JEP 306: Restore Always-Strict Floating-Point Semantics</i></a>",
    "score" : 0,
    "owner" : {
      "account_id" : 322981,
      "reputation" : 347089,
      "user_id" : 642706,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://i.sstatic.net/ZWEI3.jpg?s=256",
      "display_name" : "Basil Bourque",
      "link" : "https://stackoverflow.com/users/642706/basil-bourque"
    },
    "creation_date" : 1744756881,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}