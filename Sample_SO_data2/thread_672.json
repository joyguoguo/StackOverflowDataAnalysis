{
  "question" : {
    "question_id" : 79787628,
    "title" : "javax.sql.rowset.serial.SerialClob cannot be cast to oracle.sql.CLOB while using preparedStatement.setClob",
    "body" : "<p>I'm trying to insert a <code>java.sql.Clob</code> to an Oracle DB table with a clob column and it fails with the following exception</p>\n<pre class=\"lang-none prettyprint-override\"><code>javax.sql.rowset.serial.SerialClob cannot be cast to oracle.sql.CLOB\n    at oracle.jdbc.driver.OraclePreparedStatement.setClob(OraclePreparedStatement.java:6558)\n    at oracle.jdbc.driver.OraclePreparedStatementWrapper.setClob(OraclePreparedStatementWrapper.java:165)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:498)\n    at org.apache.tomcat.jdbc.pool.StatementFacade$StatementProxy.invoke(StatementFacade.java:118)\n    at com.sun.proxy.$Proxy7.setClob(Unknown Source)\n    at com.ieml.basedata.sheet.DMLStatement.executeWithKeys(DMLStatement.java:106)\n    at com.ieml.basedata.sheet.DMLStatement.execute(DMLStatement.java:26)\n    at com.ieml.sheets.lib.IssueArticles$2.doFunction(IssueArticles.java:268)\n    at com.ieml.basedata.sheet.SheetServlet.performFunction(SheetServlet.java:271)\n    at com.ieml.basedata.sheet.SheetServlet.doPost(SheetServlet.java:106)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:681)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:764)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:227)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162)\n    at org.apache.catalina.filters.SetCharacterEncodingFilter.doFilter(SetCharacterEncodingFilter.java:109)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162)\n    at org.apache.catalina.filters.ExpiresFilter.doFilter(ExpiresFilter.java:1227)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162)\n    at com.ieml.filters.LogFilter.doFilter(LogFilter.java:34)\n</code></pre>\n<p>Oracle version is 21c, ojdbc8 jar java 8.(jdk 8 202).</p>\n<p>Here is the code in question</p>\n<pre class=\"lang-java prettyprint-override\"><code>java.sql.Clob dataClob=null;\n....\ndataClob =  (java.sql.Clob)new javax.sql.rowset.serial.SerialClob((data.get(changedColumns[k])).toString().toCharArray());\nst.setClob(j, dataClob); //problematic line;\n</code></pre>\n<p>Previously the code I'm trying to change was using old now-deprecated <code>oracle.sql.CLOB</code> classes, but it was written to support legacy Oracle 10g. I was hoping to get rid of those by using standard java.sql JDBC classes. Upon researching this, I found the following</p>\n<p><a href=\"https://support.oracle.com/knowledge/Middleware/2024807_1.html\" rel=\"nofollow noreferrer\">https://support.oracle.com/knowledge/Middleware/2024807_1.html</a>\nwhich seems to be my issue, but unfortunately I don't have access to my Oracle support so couldn't find the solution</p>\n<blockquote>\n<p>Java.lang.ClassCastException: Javax.sql.rowset.serial.SerialClob\nCannot Be Cast To Oracle.sql.CLOB Is Reported While Passing A\nSerialClob Object As Parameter In The setClob Method Of A Statement\n(Doc ID 2024807.1) Last updated on FEBRUARY 20, 2025</p>\n<p>Applies to: JDBC - Version 11.2.0.4.0 and later Information in this\ndocument applies to any platform. Symptoms When attempting to insert a\nClob into the database using the next code and JDBC 11.2.0.4:</p>\n</blockquote>\n<p>I was able to avoid <code>setClob</code> entirely by using <code>setCharacterStream</code> by using this code</p>\n<pre class=\"lang-java prettyprint-override\"><code>String data_str=(data.get(changedColumns[k])).toString();\ntry(InputStream in = new ByteArrayInputStream(data_str.getBytes(StandardCharsets.UTF_8));\n        InputStreamReader reader = new InputStreamReader(in))\n{\n    st.setCharacterStream(j, reader,data_str.length());\n}\n</code></pre>\n<p>but I was wondering if anyone has idea why <code>setClob</code> fails with the exception in the first place. Any ideas?</p>\n",
    "tags" : [ "java", "oracle-database", "jdbc", "ojdbc" ],
    "owner" : {
      "account_id" : 212287,
      "reputation" : 133,
      "user_id" : 1928093,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://i.sstatic.net/9d1Bu.jpg?s=256",
      "display_name" : "Azat Usmanov",
      "link" : "https://stackoverflow.com/users/1928093/azat-usmanov"
    },
    "is_answered" : true,
    "view_count" : 123,
    "answer_count" : 2,
    "score" : 2,
    "last_activity_date" : 1760173424,
    "creation_date" : 1760121871,
    "link" : "https://stackoverflow.com/questions/79787628/javax-sql-rowset-serial-serialclob-cannot-be-cast-to-oracle-sql-clob-while-using",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79787916,
    "question_id" : 79787628,
    "body" : "<p>Given the exception, it looks like the Oracle implementation expects <em>only</em> its own implementation of <code>java.sql.Clob</code> (i.e. <code>oracle.jdbc.CLOB</code>), and will not accept other implementations.</p>\n<p>Also, although <code>oracle.sql.CLOB</code> is deprecated, internally the Oracle driver continues to use it (it's only deprecated for public use, i.e. in user code). It is recommended to use <a href=\"https://docs.oracle.com/en/java/javase/21/docs/api/java.sql/java/sql/Connection.html#createClob()\" rel=\"nofollow noreferrer\"><code>Connection.createClob()</code></a> to create an instance suitable for your connection instead of instantiating it directly. As documented in the Oracle 21c JDBC driver <a href=\"https://docs.oracle.com/en/database/oracle/oracle-database/21/jajdb/oracle/sql/CLOB.html\" rel=\"nofollow noreferrer\">API doc of <code>oracle.jdbc.CLOB</code></a>:</p>\n<blockquote>\n<p>Creating a temporary <code>Clob</code> should use <code>Connection.createClob()</code></p>\n<pre class=\"lang-none prettyprint-override\"><code>java.sql.Clob clob = connection.createClob(); \n</code></pre>\n</blockquote>\n<p>Or use one of the alternative methods of creating a clob, like <code>setClob(int, Reader)</code> as suggested by p3consulting in <a href=\"https://stackoverflow.com/a/79787914/466862\">their answer</a>, or <code>setCharacterStream</code> like you already discovered. You should even be able to use <code>setString(j, data_str)</code> directly, but I'm not 100% sure the Oracle JDBC driver actually supports that.</p>\n",
    "score" : 2,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 213468,
      "reputation" : 110280,
      "user_id" : 466862,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d873f397779db38cd510d9ee5416fd43?s=256&d=identicon&r=PG",
      "display_name" : "Mark Rotteveel",
      "link" : "https://stackoverflow.com/users/466862/mark-rotteveel"
    },
    "creation_date" : 1760172534,
    "last_activity_date" : 1760173424,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79787914,
    "question_id" : 79787628,
    "body" : "<p><code>void setClob(int parameterIndex, Reader reader)</code> so <code>new SerialClob(data_str.toCharArray()).getCharacterStream())</code> should give you the needed Reader.</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 6389739,
      "reputation" : 5431,
      "user_id" : 4956336,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/5b2Ij.png?s=256",
      "display_name" : "p3consulting",
      "link" : "https://stackoverflow.com/users/4956336/p3consulting"
    },
    "creation_date" : 1760172226,
    "last_activity_date" : 1760172226,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140789832,
    "post_id" : 79787628,
    "body" : "Also, ojdbc8 is not a <i>version</i> of the driver, it merely means it&#39;s for Java 8.",
    "score" : 0,
    "owner" : {
      "account_id" : 213468,
      "reputation" : 110280,
      "user_id" : 466862,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d873f397779db38cd510d9ee5416fd43?s=256&d=identicon&r=PG",
      "display_name" : "Mark Rotteveel",
      "link" : "https://stackoverflow.com/users/466862/mark-rotteveel"
    },
    "creation_date" : 1760173010,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140789830,
    "post_id" : 79787628,
    "body" : "Tip: <a href=\"https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/io/StringReader.html\" rel=\"nofollow noreferrer\"><code>StringReader</code></a>, avoids the whole convert string to byte array, create a <code>ByteArrayInputStream</code> and <code>InputStreamReader</code> (where you forgot to specify the character set!)",
    "score" : 1,
    "owner" : {
      "account_id" : 213468,
      "reputation" : 110280,
      "user_id" : 466862,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d873f397779db38cd510d9ee5416fd43?s=256&d=identicon&r=PG",
      "display_name" : "Mark Rotteveel",
      "link" : "https://stackoverflow.com/users/466862/mark-rotteveel"
    },
    "creation_date" : 1760172977,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79787914" : [ {
      "comment_id" : 140790605,
      "post_id" : 79787914,
      "body" : "@MarkRotteveel I ended up using String data_str=(data.get(changedColumns[k])).toString(); try(StringReader reader = new StringReader(data_str)) { st.setClob(j, reader); }",
      "score" : 1,
      "owner" : {
        "account_id" : 212287,
        "reputation" : 133,
        "user_id" : 1928093,
        "user_type" : "registered",
        "accept_rate" : 100,
        "profile_image" : "https://i.sstatic.net/9d1Bu.jpg?s=256",
        "display_name" : "Azat Usmanov",
        "link" : "https://stackoverflow.com/users/1928093/azat-usmanov"
      },
      "creation_date" : 1760219667,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140789829,
      "post_id" : 79787914,
      "body" : "<code>new SerialClob(data_str.toCharArray()).getCharacterStream())</code> is unnecessarily complicated to obtain a <code>Reader</code> from a string. That is what <code>StringReader</code> is for. However, it should be possible to call <code>setString(column, data_str)</code> without going through a clob or reader.",
      "score" : 2,
      "owner" : {
        "account_id" : 213468,
        "reputation" : 110280,
        "user_id" : 466862,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/d873f397779db38cd510d9ee5416fd43?s=256&d=identicon&r=PG",
        "display_name" : "Mark Rotteveel",
        "link" : "https://stackoverflow.com/users/466862/mark-rotteveel"
      },
      "creation_date" : 1760172878,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}