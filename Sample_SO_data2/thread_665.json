{
  "question" : {
    "question_id" : 79788043,
    "title" : "Jpa - Join table that contains 2 PK but only one of this two is used",
    "body" : "<p>I'm running a Spring Boot app.</p>\n<p>I have these two tables in my database.\nI fill an example of data that contains these tables.</p>\n<p>Table <code>user</code>\nHere column <code>id</code> is a PK and column <code>state_id</code> is a FK from table <code>state</code> with a reference of column <code>id</code></p>\n<div class=\"s-table-container\"><table class=\"s-table\">\n<thead>\n<tr>\n<th style=\"text-align: center;\">id</th>\n<th style=\"text-align: center;\">name</th>\n<th style=\"text-align: center;\">state_id</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: center;\">33</td>\n<td style=\"text-align: center;\">John Doe</td>\n<td style=\"text-align: center;\">1</td>\n</tr>\n</tbody>\n</table></div>\n<p>Table <code>state</code>\nHere, columns <code>id</code> and <code>century</code> are both primary keys of the table</p>\n<div class=\"s-table-container\"><table class=\"s-table\">\n<thead>\n<tr>\n<th style=\"text-align: center;\">id</th>\n<th style=\"text-align: center;\">century</th>\n<th style=\"text-align: center;\">label</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: center;\">1</td>\n<td style=\"text-align: center;\">21</td>\n<td style=\"text-align: center;\">1</td>\n</tr>\n</tbody>\n</table></div>\n<p>I want to model these two tables as JPA entities, so I did it like that :</p>\n<p>StatePK.java :</p>\n<pre><code>public class StatePK implements Serializable {\n     private Long id;\n     private Integer century;\n}\n</code></pre>\n<p>State.java :</p>\n<pre><code>@Entity\n@Table(name = &quot;state&quot;)\n@IdClass(StatePK.class)\npublic class State {\n\n       @Id\n       private Long id;\n\n       @Id\n       private Integer century;\n\n       private String label;\n}\n</code></pre>\n<p>User.java :</p>\n<pre><code>@Entity\n@Table(name = &quot;user&quot;)\npublic class User implements Serializable {\n\n       @Id\n       private Long id;\n\n       private String name;\n\n       @ManyToOne\n       @JoinColumn(name = &quot;state_id&quot;)\n       private State state;\n}\n</code></pre>\n<p>But when I compile with Maven, it's ok, but when I start my app, I have this error :</p>\n<blockquote>\n<p>Error creating bean with name 'entityManagerFactory' defined in class\npath resource\n[org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]:\nAn association that targets entity\n'fr..infrastructure.provider.jpa.model.State' from entity\n'fr.infrastructure.provider.jpa.model.User' has 1 '@JoinColumn's but\nthe primary key has 2 columns&quot;</p>\n</blockquote>\n<p>Can someone help me with that issue, please?</p>\n",
    "tags" : [ "java", "spring-boot", "jpa" ],
    "owner" : {
      "account_id" : 14878684,
      "reputation" : 863,
      "user_id" : 10744028,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-XAzkrkEpit0/AAAAAAAAAAI/AAAAAAAAAEg/AWErc7qYyNI/s256-rj/photo.jpg",
      "display_name" : "Fizik26",
      "link" : "https://stackoverflow.com/users/10744028/fizik26"
    },
    "is_answered" : true,
    "view_count" : 106,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1760255845,
    "creation_date" : 1760189963,
    "link" : "https://stackoverflow.com/questions/79788043/jpa-join-table-that-contains-2-pk-but-only-one-of-this-two-is-used",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79788057,
    "question_id" : 79788043,
    "body" : "<p>If you want your <code>state</code> table to have a primary key composed of two fields (<code>id</code> and <code>century</code>), both columns must appear in the <code>user</code> table as foreign keys. According to your schema, only <code>state_id</code> seems to be present in <code>user</code> as a foreign key. You need to add also a <code>state_century</code> column within <code>user</code>.</p>\n<p>Furthermore, as @RobSpoor suggested in the comments, this is assuming that multiple states with the same id and different centuries (or the other way around) can be linked to the same user.</p>\n<p>However, if that is the case, once you've amended the <code>user</code> table, you should replace the annotation <code>@JoinColumn</code> in the <code>User</code> class with <code>@JoinColumns</code> to support foreign keys with multiple fields.</p>\n<p>In your snippet, under <code>User.java</code> there is a class named <code>State</code>. I assume that is just a typo and you meant <code>User</code>.</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Entity\n@Table(name = &quot;state&quot;)\n@IdClass(StatePK.class)\npublic class State implements Serializable {\n\n    @Id\n    private Long id;\n\n    @Id\n    private Integer century;\n\n    private String label;\n}\n\n@Entity\n@Table(name = &quot;user&quot;)\npublic class User implements Serializable {\n\n    @Id\n    private Long id;\n\n    private String name;\n\n    @ManyToOne\n    @JoinColumns({\n        @JoinColumn(name = &quot;state_id&quot;, referencedColumnName = &quot;id&quot;),\n        @JoinColumn(name = &quot;state_century&quot;, referencedColumnName = &quot;century&quot;)\n    })\n    private State state;\n}\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 5569841,
      "reputation" : 8674,
      "user_id" : 4415625,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0ea1713807527aa1cf52e40579e35ec4?s=256&d=identicon&r=PG",
      "display_name" : "dani-vta",
      "link" : "https://stackoverflow.com/users/4415625/dani-vta"
    },
    "creation_date" : 1760191642,
    "last_activity_date" : 1760193241,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140790125,
    "post_id" : 79788043,
    "body" : "Your state table looks wrong. If the id column is not the primary key, each of its values can occur multiple times. That means there can be multiple state records with id=1, and your <code>John Doe</code> user record can have more than 1 state. If that&#39;s what you need, perhaps you can give the <code>User</code> entity a <code>Map&lt;Integer, State&gt;</code> instead with the century as map key.",
    "score" : 0,
    "owner" : {
      "account_id" : 1211967,
      "reputation" : 9964,
      "user_id" : 1180351,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/pKB8y.png?s=256",
      "display_name" : "Rob Spoor",
      "link" : "https://stackoverflow.com/users/1180351/rob-spoor"
    },
    "creation_date" : 1760191615,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79788057" : [ {
      "comment_id" : 140792346,
      "post_id" : 79788057,
      "body" : "I have an other question related to that =&gt; <a href=\"https://stackoverflow.com/questions/79789042/jpa-embedded-id-used-as-part-of-it-as-a-pk-and-the-other-part-as-a-fk\" title=\"jpa embedded id used as part of it as a pk and the other part as a fk\">stackoverflow.com/questions/79789042/&hellip;</a>    , but a bit different",
      "score" : 0,
      "owner" : {
        "account_id" : 14878684,
        "reputation" : 863,
        "user_id" : 10744028,
        "user_type" : "registered",
        "profile_image" : "https://lh3.googleusercontent.com/-XAzkrkEpit0/AAAAAAAAAAI/AAAAAAAAAEg/AWErc7qYyNI/s256-rj/photo.jpg",
        "display_name" : "Fizik26",
        "link" : "https://stackoverflow.com/users/10744028/fizik26"
      },
      "creation_date" : 1760344140,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140790173,
      "post_id" : 79788057,
      "body" : "@Fizik26 Either you add <code>state_century</code> under <code>user</code> to complete the foreign key or set only <code>id</code> as the primary key for <code>state</code>.",
      "score" : 1,
      "owner" : {
        "account_id" : 5569841,
        "reputation" : 8674,
        "user_id" : 4415625,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/0ea1713807527aa1cf52e40579e35ec4?s=256&d=identicon&r=PG",
        "display_name" : "dani-vta",
        "link" : "https://stackoverflow.com/users/4415625/dani-vta"
      },
      "creation_date" : 1760194160,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140790160,
      "post_id" : 79788057,
      "body" : "@Fizik26 The typo was fixed by RobSpoor, that&#39;s why you don&#39;t see it. About the <code>century</code> column, you do need it in <code>user</code> if you want to have it as a primary key in <code>state</code>. A foreign key must represent each and every field under the primary key of the referenced table. Think about it, if a state is identified by the pair (<code>1</code>;<code>20</code>), and you also have the states (<code>1</code>;<code>19</code>), (<code>1</code>;<code>18</code>), and so on. Which state is a user supposed to reference when its <code>state_id</code> contains <code>1</code>? You need both columns to uniquely identify a state from a user. PS apologies for mistyping Rob&#39;s name in the anwer.",
      "score" : 1,
      "owner" : {
        "account_id" : 5569841,
        "reputation" : 8674,
        "user_id" : 4415625,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/0ea1713807527aa1cf52e40579e35ec4?s=256&d=identicon&r=PG",
        "display_name" : "dani-vta",
        "link" : "https://stackoverflow.com/users/4415625/dani-vta"
      },
      "creation_date" : 1760193405,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140790152,
      "post_id" : 79788057,
      "body" : "Hello, I don&#39;t see that <code>In your snippet, under User.java there is a class named State. I assume that is just a typo and you meant User.</code> . But, I forgot to tell but the <code>century</code> column is also a partition. I mean, <code>State</code> table is added with <code>PARTITION BY RANGE (century)</code>, is it changing something ? Because I don&#39;t have a <code>century</code> column if my <code>user</code> able and I don&#39;t need one.",
      "score" : 0,
      "owner" : {
        "account_id" : 14878684,
        "reputation" : 863,
        "user_id" : 10744028,
        "user_type" : "registered",
        "profile_image" : "https://lh3.googleusercontent.com/-XAzkrkEpit0/AAAAAAAAAAI/AAAAAAAAAEg/AWErc7qYyNI/s256-rj/photo.jpg",
        "display_name" : "Fizik26",
        "link" : "https://stackoverflow.com/users/10744028/fizik26"
      },
      "creation_date" : 1760193023,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}