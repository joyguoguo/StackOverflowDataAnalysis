{
  "question" : {
    "question_id" : 79778334,
    "title" : "OjAlgo presolving constraints with only the quadratic part",
    "body" : "<p>Using ojAlgo 55.2.0 i'm encountering some problems when defining constraints with only the quadratic part like the code below</p>\n<pre><code>\npublic class PureQuadTest {\n\n    public static void main(String[] args) {\n        System.out.println(&quot;Hello World!&quot;);\n        final ExpressionsBasedModel model = new ExpressionsBasedModel();\n\n        final var vars = List.of(\n            Map.entry(&quot;A&quot;, 0.05),\n            Map.entry(&quot;B&quot;, 0.05),\n            Map.entry(&quot;C&quot;, 0.25),\n            Map.entry(&quot;D&quot;, 0.1),\n            Map.entry(&quot;E&quot;, 0.05));\n        final Map&lt;String, Variable&gt; variables = new HashMap&lt;&gt;();\n        for (final var v : vars) {\n            final var idAndWeight = model.addVariable(v.getKey());\n            variables.put(v.getKey(), idAndWeight);\n            idAndWeight.lower(v.getValue());\n        }\n\n        // Sum to 1 constraint\n        final Expression sumExpr = model.addExpression(&quot;sum&quot;).level(1.0);\n        for (Variable v : variables.values()) {\n            sumExpr.set(v, 1.0);\n        }\n\n        // Objective function: maximize the sum of all variables\n        final Expression objExpr = model.addExpression(&quot;obj&quot;).weight(1.0);\n        for (Variable v : variables.values()) {\n            objExpr.set(v, 1.0);\n        }\n        double[][] matrix = {\n                { 0.00250000, 0.00022000, 0.00010000, 0.00044000, 0.00200000 },\n                { 0.00022000, 0.00048400, 0.00004400, 0.00096800, 0.00088000 },\n                { 0.00010000, 0.00004400, 0.00010000, 0.00008800, 0.00200000 },\n                { 0.00044000, 0.00096800, 0.00008800, 0.00193600, 0.00176000 },\n                { 0.00200000, 0.00088000, 0.00200000, 0.00176000, 0.04000000 }\n        };\n\n        // create a quadratic only constraint\n        var constraintQ = model.addExpression(&quot;quadonly&quot;).weight(1.0);\n\n        for (int i = 0; i &lt; matrix.length; i++) {\n            for (int j = 0; j &lt; matrix[i].length; j++) {\n                var v1 = variables.get(vars.get(i).getKey());\n                var v2 = variables.get(vars.get(j).getKey());\n                var coeff = matrix[i][j];\n\n                constraintQ.set(v1, v2, coeff);\n            }\n        }\n\n        constraintQ.upper(0.0004);\n\n        var res = model.maximise();\n        System.out.println(res.getState());\n    }\n}\n</code></pre>\n<p>the output of this is &quot;feasible&quot; even tough it should be unfeasible.\nI traced the reason to the quadratic constraint being marked &quot;redundant&quot;. I checked the code and during the execution of ExpressionsBasedModel:scanEntities the method tmpExpr.getLinearKeySet() returns an empty set since my constraint does not have linear terms.\nThis brings che presolver Presolvers.ZERO_ONE_TWO.simplify to mark the constraint as redundant.</p>\n<p>Also calling the simplify method of ExpressionsBasedModel, the later invoked method checkSimilarity (in class Presolvers) also finds the constraint as similar to another one and marks it as redundant by looking only at linear terms.</p>\n<p>Am i missing something? is this the expected behavior?</p>\n<p>Tried inspecting the source code and found the probable reson</p>\n",
    "tags" : [ "java", "ojalgo" ],
    "owner" : {
      "account_id" : 32597267,
      "reputation" : 21,
      "user_id" : 25330401,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d2c77051efaefe256b1deeb40395d505?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Leonardo",
      "link" : "https://stackoverflow.com/users/25330401/leonardo"
    },
    "is_answered" : false,
    "view_count" : 38,
    "answer_count" : 0,
    "score" : 2,
    "last_activity_date" : 1759161968,
    "creation_date" : 1759161968,
    "link" : "https://stackoverflow.com/questions/79778334/ojalgo-presolving-constraints-with-only-the-quadratic-part",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140767190,
    "post_id" : 79778334,
    "body" : "From your description it sounds like you found a bug and should open an issue over at GitHub: <a href=\"https://github.com/optimatika/ojAlgo/issues\" rel=\"nofollow noreferrer\">github.com/optimatika/ojAlgo/issues</a>",
    "score" : 1,
    "owner" : {
      "account_id" : 5578339,
      "reputation" : 1330,
      "user_id" : 4421592,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/xaI2H.jpg?s=256",
      "display_name" : "apete",
      "link" : "https://stackoverflow.com/users/4421592/apete"
    },
    "creation_date" : 1759168818,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}