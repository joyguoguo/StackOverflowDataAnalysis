{
  "question" : {
    "question_id" : 79670639,
    "title" : "How to configure Tomcat max file count size",
    "body" : "<p>After updating to Tomcat 10.1.42, I started getting this error when uploading multiple files in a request:</p>\n<pre><code>org.apache.tomcat.util.http.fileupload.impl.FileCountLimitExceededException: attachment\n    at org.apache.tomcat.util.http.fileupload.FileUploadBase.parseRequest(FileUploadBase.java:459)\n    at org.apache.catalina.connector.Request.parseParts(Request.java:2650)\n    at org.apache.catalina.connector.Request.parseParameters(Request.java:2964)\n    at org.apache.catalina.connector.Request.getParameter(Request.java:1111)\n</code></pre>\n<p>How to configure max file count to avoid this error, using tomcat configuration files?</p>\n<p>While searching in tomcat documentation/google/stackoverflow I only found references to max file size, or max parameter count, but nothing related to max file count, except for <a href=\"https://stackoverflow.com/q/76326705/2342529\">this</a> question which is specific to Spring and has no answer.</p>\n",
    "tags" : [ "java", "tomcat" ],
    "owner" : {
      "account_id" : 2714938,
      "reputation" : 6448,
      "user_id" : 2342529,
      "user_type" : "registered",
      "accept_rate" : 98,
      "profile_image" : "https://i.sstatic.net/SSkK4.jpg?s=256",
      "display_name" : "Alexandru Severin",
      "link" : "https://stackoverflow.com/users/2342529/alexandru-severin"
    },
    "is_answered" : true,
    "view_count" : 5050,
    "closed_date" : 1750309552,
    "answer_count" : 2,
    "score" : 3,
    "last_activity_date" : 1750264381,
    "creation_date" : 1750250023,
    "link" : "https://stackoverflow.com/questions/79670639/how-to-configure-tomcat-max-file-count-size",
    "closed_reason" : "Duplicate"
  },
  "answers" : [ {
    "answer_id" : 79671017,
    "question_id" : 79670639,
    "body" : "<p>According to this: <a href=\"https://github.com/spring-projects/spring-boot/issues/45881\" rel=\"noreferrer\">https://github.com/spring-projects/spring-boot/issues/45881</a>, the issue may be caused by the new defaults <code>maxPartCount</code> and <code>maxPartHeaderSize</code> which are 10 and 1024(?) (They used to be unlimited). You can update them in the server.xml as connector options.</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;\n           connectionTimeout=&quot;20000&quot;\n           redirectPort=&quot;8443&quot;\n           maxParameterCount=&quot;1000&quot;\n           maxPartCount=&quot;100&quot;\n           maxPartHeaderSize=&quot;1024&quot;\n           /&gt;\n</code></pre>\n<p>I tried just changing <code>maxPartCount</code> to 100 and that seems to fix it for me. Still testing however, you will need to figure out what good defaults will be for you.</p>\n",
    "score" : 10,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 11343882,
      "reputation" : 116,
      "user_id" : 8316986,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-se9aqwc2Y68/AAAAAAAAAAI/AAAAAAAAARI/txZDLD9718E/s256-rj/photo.jpg",
      "display_name" : "Aaron Ho-Means",
      "link" : "https://stackoverflow.com/users/8316986/aaron-ho-means"
    },
    "creation_date" : 1750264287,
    "last_activity_date" : 1750264381,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79670670,
    "question_id" : 79670639,
    "body" : "<p>Tomcat doesn’t have a specific <code>maxFileCount</code> setting in its server.xml. The error you’re seeing (<code>FileCountLimitExceededException</code>) is triggered when the number of uploaded files in a single request exceeds a limit, usually enforced by the file upload library (e.g., <code>commons-fileupload</code>) or your application framework.</p>\n<ul>\n<li><p>The <code>maxParameterCount</code> attribute in the <code>&lt;Connector&gt;</code> (e.g., <code>&lt;Connector maxParameterCount=&quot;10000&quot; ... /&gt;</code>) controls the total number of request parameters (which includes file inputs), but it’s a generic setting and not file-specific.</p>\n</li>\n<li><p>There’s <strong>no direct Tomcat setting</strong> for max file count; if you need to raise the limit, you’ll likely need to adjust it in your application’s file upload library (e.g., in Spring Boot: <code>spring.servlet.multipart.max-file-count</code>).</p>\n</li>\n<li><p><strong>Caution:</strong> Setting <code>maxPostSize=&quot;-1&quot;</code> and <code>maxSwallowSize=&quot;-1&quot;</code> removes upload limits, which can expose you to DoS attacks. Only do this if you have other limits in place (like in a reverse proxy), and only if you really need it.</p>\n</li>\n</ul>\n<p><strong>Summary:</strong></p>\n<ul>\n<li><p>Try increasing <code>maxParameterCount</code> if you hit a parameter limit, but for actual file count limits, check your app or library config.</p>\n</li>\n<li><p>Be careful with unlimited upload sizes; always consider the security risks.</p>\n</li>\n</ul>\n",
    "score" : -3,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1674229,
      "reputation" : 55,
      "user_id" : 1540090,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/b7c14fbbf11a5ef8ff133a7ca6f1125c?s=256&d=identicon&r=PG",
      "display_name" : "Mickey Joe",
      "link" : "https://stackoverflow.com/users/1540090/mickey-joe"
    },
    "creation_date" : 1750251215,
    "last_activity_date" : 1750251215,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140524573,
    "post_id" : 79670639,
    "body" : "Related: <a href=\"https://stackoverflow.com/questions/79667827/tomcat-multipart-upload-for-many-attachments-10-not-working-after-update-to-9\" title=\"tomcat multipart upload for many attachments 10 not working after update to 9\">stackoverflow.com/questions/79667827/&hellip;</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 881149,
      "reputation" : 10890,
      "user_id" : 225217,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://i.sstatic.net/jLG9V.jpg?s=256",
      "display_name" : "Brice Roncace",
      "link" : "https://stackoverflow.com/users/225217/brice-roncace"
    },
    "creation_date" : 1750267664,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79670670" : [ {
      "comment_id" : 140613750,
      "post_id" : 79670670,
      "body" : "This is no longer correct with newer versions of Tomcat. See <a href=\"https://github.com/spring-projects/spring-boot/issues/45881\" rel=\"nofollow noreferrer\">github.com/spring-projects/spring-boot/issues/45881</a>    This introduced maxPartCount and maxPartHeaderSize which is now by default limited to 50 (and in some intermediate releases was even as low as 10)",
      "score" : 0,
      "owner" : {
        "account_id" : 3387585,
        "reputation" : 41,
        "user_id" : 2843242,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/VV3eh.jpg?s=256",
        "display_name" : "NilsCodes",
        "link" : "https://stackoverflow.com/users/2843242/nilscodes"
      },
      "creation_date" : 1753327221,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140524019,
      "post_id" : 79670670,
      "body" : "Was this answer AI generated?",
      "score" : 2,
      "owner" : {
        "account_id" : 372682,
        "reputation" : 26512,
        "user_id" : 721855,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
        "display_name" : "aled",
        "link" : "https://stackoverflow.com/users/721855/aled"
      },
      "creation_date" : 1750257391,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}