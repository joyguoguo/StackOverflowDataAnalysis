{
  "question" : {
    "question_id" : 79775986,
    "title" : "How do I rollback database changes only after all tests are run?",
    "body" : "<p>For my JUnit 4 tests, a handful of database inserts have to be performed by code. However, the application framework has some overhead, which makes this step really slow.</p>\n<p>To save time, I tried to run this initial step only one time before the first test execution. The tests perform read operations only, no writes, so the risk of test side effects is minimal.</p>\n<p>Using @Transactional however, all inserted data is reverted after the first test, causing test failures or false positives for all other tests.</p>\n<pre><code>    @RunWith(SpringJUnit4ClassRunner.class)\n    @ContextConfiguration(locations = { ... })\n    @Transactional\n    public class DatabaseFilterTest {\n    \n    static boolean setUpIsDone = false;\n\n    @Before\n    public void setUp() {\n      ...\n      if (!setUpIsDone) {\n          // do the setup\n          prepareData();\n          setUpIsDone = true;\n      }\n    }\n</code></pre>\n<p>With JUnit 4, is there a way to perform the transaction rollback at the end, after all tests have been run?</p>\n",
    "tags" : [ "java", "spring", "junit", "transactions" ],
    "owner" : {
      "account_id" : 29836,
      "reputation" : 36734,
      "user_id" : 80901,
      "user_type" : "registered",
      "accept_rate" : 80,
      "profile_image" : "https://i.sstatic.net/fH9bB.png?s=256",
      "display_name" : "mjn",
      "link" : "https://stackoverflow.com/users/80901/mjn"
    },
    "is_answered" : false,
    "view_count" : 76,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1759151752,
    "creation_date" : 1758892551,
    "link" : "https://stackoverflow.com/questions/79775986/how-do-i-rollback-database-changes-only-after-all-tests-are-run",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79778144,
    "question_id" : 79775986,
    "body" : "<p>Mark your setup method or helper as not transactional, so it persists data once and survives across test methods:</p>\n<p>Here the trick is: donâ€™t put @Transactional on the class. Instead, only annotate test methods that need rollback.</p>\n<pre><code>@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(locations = { ... })\npublic class DatabaseFilterTest {\n\n    private static boolean setUpIsDone = false;\n\n    @Autowired\n    private YourRepository repo;\n\n    @Before\n    public void setUp() {\n        if (!setUpIsDone) {\n            insertTestData(); // persists real data, not rolled back\n            setUpIsDone = true;\n        }\n    }\n\n    @Transactional  // applied only at method level if needed\n    @Test\n    public void testSomething() {\n        ...\n    }\n\n    @Rollback(false) // ensures data is committed\n    @Test\n    public void insertTestData() {\n        repo.save(...);\n    }\n}\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1807468,
      "reputation" : 287,
      "user_id" : 1644280,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f18fe15e4ebd5283482de3fc4a939058?s=256&d=identicon&r=PG",
      "display_name" : "Lavi Kumar",
      "link" : "https://stackoverflow.com/users/1644280/lavi-kumar"
    },
    "creation_date" : 1759151752,
    "last_activity_date" : 1759151752,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140765269,
    "post_id" : 79775986,
    "body" : "consider using testcontainer with prepared database as container",
    "score" : 0,
    "owner" : {
      "account_id" : 11555562,
      "reputation" : 569,
      "user_id" : 8466853,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/cd7f72b426ce3c46739900b8ba014e26?s=256&d=identicon&r=PG",
      "display_name" : "Arno",
      "link" : "https://stackoverflow.com/users/8466853/arno"
    },
    "creation_date" : 1759084088,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}