{
  "question" : {
    "question_id" : 79838989,
    "title" : "Spring boot Kafka batching for all partitions",
    "body" : "<p>I have Spring Boot with Kafka batching and a topic with 3 partitions. For example, I want to have 1 batch with 100 records continuously if I have a lot of messages in the topic, but if I have a low rate, then I want my app to send me a batch with 100 records or to wait 10 seconds and send me as big batch as possible.<br />\nRight now, I have the following properties in my test app (concurrency is 1):</p>\n<pre><code>fetch-min-size: 60_000\nfetch-max-wait: 10_000\nmax-poll-records: 100\n</code></pre>\n<p>And the problem is that if I have 1 partition, it works fine, but if I create a topic with 3 partitions, I start getting 3 small batches with a 10-second interval each. I assume that the listener listens for partitions separately and does not combine messages from them.<br />\nIs it possible to achieve it without the creation of a custom implementation of a listener to cache the responses, probably, and then divide them by batch size? Or are there other solutions?</p>\n<p>This property does not help since I use it for now, but it creates just a delay between polls, and in case of a big queue, I process very slowly.</p>\n<pre><code>idle-between-polls\n</code></pre>\n",
    "tags" : [ "java", "spring", "spring-boot", "apache-kafka", "spring-kafka" ],
    "owner" : {
      "account_id" : 16791300,
      "reputation" : 133,
      "user_id" : 12138892,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-ODgFgc7UbZs/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdhwqpf7qo4hCZta5XwFE2nGRRB_A/s256-rj/photo.jpg",
      "display_name" : "Mykyta Piddubskiy",
      "link" : "https://stackoverflow.com/users/12138892/mykyta-piddubskiy"
    },
    "is_answered" : true,
    "view_count" : 47,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1764947235,
    "creation_date" : 1764944254,
    "link" : "https://stackoverflow.com/questions/79838989/spring-boot-kafka-batching-for-all-partitions",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79839039,
    "question_id" : 79838989,
    "body" : "<p>Kafka consumers do not batch across partitions. Each <code>poll()</code> returns records <em>partition-by-partition</em>, and Spring Kafka will pass them to your listener exactly in that structure. With <code>concurrency = 1</code>, you still have <em>one</em> consumer, but it receives 3 independent partition queues, and Kafka will never merge them into one “super-batch”.</p>\n<p>That’s why you see:</p>\n<ul>\n<li><p>With 1 partition → you get the full 100-record batches</p>\n</li>\n<li><p>With 3 partitions → you get up to 3 smaller batches every 10 seconds (one per partition), because each partition reaches the <code>fetch-min-size</code> / <code>fetch-max-wait</code> threshold independently</p>\n</li>\n</ul>\n<p>And unfortunately, at least afaik, there’s no built-in Spring Boot / Spring Kafka setting that will combine messages from multiple partitions into a single batch.</p>\n<p><a href=\"https://kafka.apache.org/35/javadoc/org/apache/kafka/clients/consumer/KafkaConsumer.html\" rel=\"nofollow noreferrer\">See here the KafkaConsumer docs</a></p>\n",
    "score" : 2,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 10854615,
      "reputation" : 206,
      "user_id" : 7981380,
      "user_type" : "registered",
      "profile_image" : "https://lh5.googleusercontent.com/-cCphPGt6Q8k/AAAAAAAAAAI/AAAAAAAALGU/FKufjtUVb94/s256-rj/photo.jpg",
      "display_name" : "Jo&#227;o Quintanilha",
      "link" : "https://stackoverflow.com/users/7981380/jo%c3%a3o-quintanilha"
    },
    "creation_date" : 1764947235,
    "last_activity_date" : 1764947235,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}