{
  "question" : {
    "question_id" : 79636383,
    "title" : "How to insert a specific object into a Controller bean in Micronaut test?",
    "body" : "<p>I have a Micronaut web-service which has a Controller class as below and 2 objects inside a Controller.</p>\n<pre><code>@Controller(ScratchpadService.API_PATH)\n@Validated\npublic class ScratchpadController implements ScratchpadApi {\n\n  private final ScratchpadRequestHandler scratchpadRequestHandler;\n  private TimeProvider timeProvider; \n\n    public ScratchpadController(\n      ScratchpadRequestHandler scratchpadRequestHandler,\n      @Named(&quot;RealTimeProvider&quot;) TimeProvider timeProvider) {\n    this.scratchpadRequestHandler = scratchpadRequestHandler;\n    this.timeProvider = timeProvider;\n  }\n\n  @Override\n  public Mono&lt;HttpResponse&lt;Scratchpad&gt;&gt; getScratchpad(String scratchpadId) {\n    ...\n    ...\n  }\n}\n</code></pre>\n<p>ScratchpadRequestHander bean is easy to resolve as there is only 1 of a kind. However, I have 2 kind of TimProvider classes. RealTimeProvider and FixedTimeProvider. By default, for regular use of service I need RealTimeProvider injected here. For tests, I want to inject FixedTimeProvider.</p>\n<pre><code>public interface TimeProvider {\n  long currentTimeMillis();\n}\n\n@Singleton\n@Named(&quot;RealTimeProvider&quot;)\npublic class RealTimeProvider implements TimeProvider {\n  @Override\n  public long currentTimeMillis() {\n    return System.currentTimeMillis();\n  }\n}\n\npublic class FixedTimeProvider implements TimeProvider {\n  private final long fixedTime;\n\n  public FixedTimeProvider(long fixedTime) {\n    this.fixedTime = fixedTime;\n  }\n  \n  @Override\n  public long currentTimeMillis() {\n    return this.fixedTime;\n  }\n}\n</code></pre>\n<p>I have ScratchoadControllerTest class which makes calls using HttpClient.</p>\n<pre><code>@ExtendWith(MockitoExtension.class)\n@MicronautTest\nclass ScratchpadControllerTest {\n\n  @MockBean(ScratchpadRequestHandler.class)\n  @Mock\n  ScratchpadRequestHandler scratchpadRequestHandler;\n\n  @Inject\n  @Client(&quot;api_path&quot;)\n  HttpClient client;\n\n  private final TimeProvider fixedTimeProvider = new FixedTimeProvider(1738497764000L);\n\n\n @Test\n void testGetScratchpadSuccess() {\n   // Arrange\n   when(scratchpadRequestHandler.getScratchpad(any())).thenReturn(scratchpad);\n\n      // Act\n   var response = client.toBlocking().exchange(HttpRequest.GET(&quot;/some-scratchpad-id&quot;), Scratchpad.class);\n\n  // Asserts\n  ..\n}\n</code></pre>\n<p>How do I insert FixedTimeProvider object that I have created in the Test class above into the ScratchpadController class that is being injected behind the scene? I can add ScratchpadController class object using MockBean annotation but manually creating the object dos not have other information inside the object which is necessary for the Controller to work. Adding the following code to the Test does not work.</p>\n<pre><code>  @Inject\n  ScratchpadController scratchpadController;\n\n  @MockBean(ScratchpadController.class)\n  public ScratchpadController scratchpadController() {\n    return new ScratchpadController(scratchpadRequestHandler, fixedTimeProvider);\n  }\n</code></pre>\n<p>The object created above does not equal to the controller object injected by Micronaut framework.</p>\n<p>The only reason I had to create TimeProvider is to test the functionality properly. ScratchpadController has update method which updates the lastUpdated variable of the objects and I need to control the time in order to test it. If there is a better option then please suggest.</p>\n",
    "tags" : [ "java", "testing", "dependency-injection", "micronaut" ],
    "owner" : {
      "account_id" : 8285930,
      "reputation" : 439,
      "user_id" : 6229026,
      "user_type" : "registered",
      "accept_rate" : 50,
      "profile_image" : "https://i.sstatic.net/o3HjY.jpg?s=256",
      "display_name" : "Abhishek Panjabi",
      "link" : "https://stackoverflow.com/users/6229026/abhishek-panjabi"
    },
    "is_answered" : false,
    "view_count" : 36,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1748053715,
    "creation_date" : 1748053715,
    "link" : "https://stackoverflow.com/questions/79636383/how-to-insert-a-specific-object-into-a-controller-bean-in-micronaut-test",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}