{
  "question" : {
    "question_id" : 79669378,
    "title" : "Moving from Java 11 to Java 17, issues with weld-junit5: NoClassDefFound javax/enterprise/inject/spi/BeanManager",
    "body" : "<p>I am trying to move an app from Java 11 to 17. Maven compile goes fine, but if I try to run tests I get a lot of <em>&quot;NoClassDefFound javax/enterprise/inject/spi/BeanManager&quot;</em> errors. I excluded <code>org.jboss.weld.se:weld-se-core</code> and a few others shipped into <code>org.jboss.weld:weld-junit5:5.0.1-Final</code> to substitute with more recent counterparts, updated the beans.xml to refer CDI 3.0 spec but nothing worked.</p>\n<p>Here is the relevant part of my pom.xml:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;\n    &lt;artifactId&gt;junit-jupiter-api&lt;/artifactId&gt;\n    &lt;version&gt;5.9.3&lt;/version&gt;\n    &lt;scope&gt;compile&lt;/scope&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n    &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;\n    &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;\n    &lt;version&gt;5.9.3&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n    &lt;groupId&gt;org.hamcrest&lt;/groupId&gt;\n    &lt;artifactId&gt;hamcrest&lt;/artifactId&gt;\n    &lt;version&gt;3.0.0&lt;/version&gt;\n    &lt;scope&gt;test&lt;/scope&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n    &lt;groupId&gt;org.mockito&lt;/groupId&gt;\n    &lt;artifactId&gt;mockito-core&lt;/artifactId&gt;\n    &lt;version&gt;5.2.0&lt;/version&gt;\n    &lt;scope&gt;test&lt;/scope&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n    &lt;groupId&gt;org.jboss.weld&lt;/groupId&gt;\n    &lt;artifactId&gt;weld-junit5&lt;/artifactId&gt;\n    &lt;version&gt;5.0.1&lt;/version&gt;\n    &lt;scope&gt;test&lt;/scope&gt;\n    &lt;exclusions&gt;\n        &lt;exclusion&gt;\n            &lt;groupId&gt;org.jboss.weld.se&lt;/groupId&gt;\n            &lt;artifactId&gt;weld-se-core&lt;/artifactId&gt;\n        &lt;/exclusion&gt;\n        &lt;exclusion&gt;\n            &lt;groupId&gt;org.jboss.spec.javax.annotation&lt;/groupId&gt;\n            &lt;artifactId&gt;jboss-annotations-api_1.3_spec&lt;/artifactId&gt;\n        &lt;/exclusion&gt;\n        &lt;exclusion&gt;\n            &lt;groupId&gt;org.jboss.spec.javax.el&lt;/groupId&gt;\n            &lt;artifactId&gt;jboss-el-api_3.0_spec&lt;/artifactId&gt;\n        &lt;/exclusion&gt;\n        &lt;exclusion&gt;\n            &lt;groupId&gt;org.jboss.spec.javax.interceptor&lt;/groupId&gt;\n            &lt;artifactId&gt;jboss-interceptors-api_1.2_spec&lt;/artifactId&gt;\n        &lt;/exclusion&gt;\n    &lt;/exclusions&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n    &lt;groupId&gt;jakarta.enterprise&lt;/groupId&gt;\n    &lt;artifactId&gt;jakarta.enterprise.cdi-api&lt;/artifactId&gt;\n    &lt;version&gt;4.1.0&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n    &lt;groupId&gt;jakarta.inject&lt;/groupId&gt;\n    &lt;artifactId&gt;jakarta.inject-api&lt;/artifactId&gt;\n    &lt;version&gt;4.1.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>Sorry, this is probably all that I can share. I am sure I substitute all the <code>javax.</code> entries in favor of <code>jakarta.</code> ones. So, what I don't get is the <em>&quot;NoClassDefFound javax/enterprise/inject/spi/BeanManager&quot;</em> error. It sounds correct to me that using that <code>BeanManager</code> triggers that exception, I did my best to remove code and dependencies that are about the <code>javax.</code> package, the problem is I can't figure out who's trying to use <code>javax.</code> stuff despite my efforts. Maybe some weld related dependency brings <code>javax</code> in.</p>\n",
    "tags" : [ "java", "junit5", "java-17", "weld-se" ],
    "owner" : {
      "account_id" : 694347,
      "reputation" : 1857,
      "user_id" : 571879,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/0a8fd3090f2bddcef4b9f7b30454d623?s=256&d=identicon&r=PG",
      "display_name" : "Francesco",
      "link" : "https://stackoverflow.com/users/571879/francesco"
    },
    "is_answered" : false,
    "view_count" : 37,
    "closed_date" : 1750183498,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1750240263,
    "creation_date" : 1750174320,
    "link" : "https://stackoverflow.com/questions/79669378/moving-from-java-11-to-java-17-issues-with-weld-junit5-noclassdeffound-javax-e",
    "closed_reason" : "Duplicate"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140523130,
    "post_id" : 79669378,
    "body" : "This sounds unrelated to upgrading from Java 11 to Java 17, but related to upgrading from Java EE/Jakarta EE 8 to Jakarta EE 9 or higher.",
    "score" : 2,
    "owner" : {
      "account_id" : 213468,
      "reputation" : 110280,
      "user_id" : 466862,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d873f397779db38cd510d9ee5416fd43?s=256&d=identicon&r=PG",
      "display_name" : "Mark Rotteveel",
      "link" : "https://stackoverflow.com/users/466862/mark-rotteveel"
    },
    "creation_date" : 1750240163,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140522705,
    "post_id" : 79669378,
    "body" : "Hello! @ControlAltDel you&#39;re corret. I did my best to remove that class in order to use <code>jakarta</code> version so it seems that there is not something at compile time that is there at runtime... I updated my question trying to make it more clear",
    "score" : 0,
    "owner" : {
      "account_id" : 694347,
      "reputation" : 1857,
      "user_id" : 571879,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/0a8fd3090f2bddcef4b9f7b30454d623?s=256&d=identicon&r=PG",
      "display_name" : "Francesco",
      "link" : "https://stackoverflow.com/users/571879/francesco"
    },
    "creation_date" : 1750231784,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140521431,
    "post_id" : 79669378,
    "body" : "NoClassDefFound means that while the class was there at compile time, it is not there are Runtime. This could be from using different versions of Java or Java packages, or possibly (but unlikely) it could be a classpath issue at runtime.",
    "score" : 0,
    "owner" : {
      "account_id" : 1352170,
      "reputation" : 35259,
      "user_id" : 1291492,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/f914cd02166793195d9d950503f8f739?s=256&d=identicon&r=PG",
      "display_name" : "ControlAltDel",
      "link" : "https://stackoverflow.com/users/1291492/controlaltdel"
    },
    "creation_date" : 1750183421,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}