{
  "question" : {
    "question_id" : 79606583,
    "title" : "How can I prevent SQL injection in my code?",
    "body" : "<p>I have a query where there is sql injection in line .I'm currently working on below code</p>\n<p>I noticed that my query is vulnerable to SQL injection. Here's the part of the code that’s causing concern:</p>\n<pre><code>return iSearchResultsService.getSearchResults(searchresultbean);\n</code></pre>\n<p>How can I rewrite this query to prevent SQL injection?</p>\n<p>I’ve heard about parameterized queries or prepared statements, but I’m not sure how to apply that in my case.</p>\n<pre><code>\n public List&lt;SearchResultPojo&gt; getSearchResults(\n            @RequestBody SearchResultsBean searchresultbean,\n            @PathVariable(&quot;cId&quot;) int catalogId, @PathVariable(&quot;region&quot;) String region,\n            @PathVariable(&quot;languageId&quot;) int languageId) {\n        logger.info(&quot;  Search Result Controller Started&quot;);\n\n        if(catalogId &gt;= 0) {\n            int catId=Integer.parseInt(Integer.toString(catalogId));\n            searchresultbean.setCatId(catId);\n        } else {\n            searchresultbean.setCatId(catalogId);\n        }\n\n        searchresultbean.setLangId(languageId);\n        searchresultbean.setRegion(region);\n\n        char[][] replaceChars = new char[1][2];\n        char[] badChars = new char[2];\n\n        // Characters to be replaced (e.g. replace '*' with '%')\n        replaceChars[0][0] = '*';\n        replaceChars[0][1] = '%';\n\n        // Characters to be removed from product description search\n        badChars[0] = '*';\n        badChars[1] = '\\'';\n\n        searchresultbean.setReplaceChars(replaceChars);\n        searchresultbean.setBadChars(badChars);\n\n        Map&lt;String, Object&gt; buuidMap = iSearchResultsService.getUnitId(region, cId,\n                languageId);\n        if (buuidMap.size() &gt; 0) {\n            searchresultbean.setBuId((int) buuidMap.get(&quot;business_unit_id&quot;));\n        }\n        logger.info(&quot; Product Search Result Controller Exit&quot;);\n        return iSearchResultsService.SearchResult(searchresultbean);\n\n    }\n\n}\n\n\n\n    public String getSearchQuery(searchresultbean searchresultbean) {\n        logger.info(&quot;Search Result Sql QueryBuild function started&quot;);\n        searchresultbean.setReturnStyle(1);\n        StringBuilder queryString = new StringBuilder();\n        queryString.append(buildSQLSelectFields(searchresultbean));\n        queryString.append(buildSQLFrom(searchresultbean));\n        queryString.append(buildSQLWhereClause(searchresultbean));\n        queryString.append(this.buildSQLOrderBy(searchresultbean.getOrderBy()));\n        logger.info(&quot; Search Result Sql QueryBuild function Exit&quot;);\n        return queryString.toString();\n    }\n\n\n\n}\n\n\nprivate String buildSQLWhereClause(searchresultbean searchresultbean) {\n        logger.info(&quot;Inside the Search Result Sql WHERE CLAUSE function started&quot;);\n        StringBuilder whereClause = new StringBuilder(&quot; WHERE 1 = 1 &quot;);\n\n        if (searchresultbean.getDId() &gt; 0) {\n            whereClause.append(\n                    SqlHelper.getSqlArgs(&quot;AND&quot;, &quot;v.id&quot;, String.valueOf(searchresultbean.getDId()),\n                            SqlHelper.NUMBER, false, true, searchresultbean.getReplaceChars()));\n        }\n\n        if (!StringUtils.isEmpty(searchresultbean.getNum())) {\n            whereClause\n                    .append(SqlHelper.getSqlArgs(&quot;AND&quot;, &quot;v._num&quot;, searchresultbean.getNum(),\n                            SqlHelper.TEXT, true, true, searchresultbean.getReplaceChars()));\n        }\n\n        if (!StringUtils.isEmpty(searchresultbean.getDesc())) {\n            boolean flag = searchresultbean.isUseBoolAndWhereClause();\n            whereClause.append(buildDescClause(searchresultbean.getDesc(),\n                    searchresultbean.getBadChars(), flag));\n        }\n\n        if (searchresultbean.getId() &gt; 0) {\n            whereClause.append(\n                    SqlHelper.getSqlArgs(&quot;AND&quot;, &quot;v.id&quot;, String.valueOf(searchresultbean.getId()),\n                            SqlHelper.NUMBER, false, true, searchresultbean.getReplaceChars()));\n        }\n\n        if (!StringUtils.isEmpty(searchresultbean.getName())) {\n            whereClause.append(\n                    SqlHelper.getSqlArgs(&quot;AND&quot;, &quot;v.name&quot;, searchresultbean.getName(),\n                            SqlHelper.TEXT, true, true, searchresultbean.getReplaceChars()));\n        }\n\n        if (!StringUtils.isEmpty(searchresultbean.getNum())) {\n            whereClause\n                    .append(SqlHelper.getSqlArgs(&quot;AND&quot;, &quot;v.num&quot;, searchresultbean.getNum(),\n                            SqlHelper.TEXT, true, true, searchresultbean.getReplaceChars()));\n        }\n\n        if (!StringUtils.isEmpty(searchresultbean.getStdNum())) {\n            whereClause.append(\n                    SqlHelper.getSqlArgs(&quot;AND&quot;, &quot;v.stdnum&quot;, searchresultbean.getStdNum(),\n                            SqlHelper.TEXT, true, true, searchresultbean.getReplaceChars()));\n        }\n\n        if (!searchresultbean.getIncludeOff()) {\n            whereClause.append(&quot; AND v.flag = 1&quot;);\n        }\n\n        if (searchresultbean.getFilterFlag()) {\n            whereClause.append(&quot; AND v.flag1 = 1&quot;);\n        }\n        whereClause.append(&quot; AND v.ID=&quot;).append(searchresultbean.getId()).append(' ');\n\n        whereClause.append(&quot;AND ISNULL(bup.FLAG, 0) != 1 &quot;);\n\n        // Software Type filter\n        if (searchresultbean.getSOFTWAREId() &gt; 0) {\n            whereClause.append(&quot; AND dp.software_type_id = &quot;);\n            whereClause.append(searchresultbean.getSoftwareId() + &quot;\\n&quot;);\n        }\n\n        // Licensing filters\n        if (searchresultbean.isLSearch()) {\n\n            buildWhereClauseForsodtware(whereClause, searchresultbean);\n        }\n\n        logger.info(&quot;Search Result Sql WHERE CLAUSE&quot;);\n        return whereClause.toString();\n    }\n\n\n</code></pre>\n<p>How can we avoid these vulnerabilities ?</p>\n",
    "tags" : [ "java", "sql", "database", "security", "snyk" ],
    "owner" : {
      "account_id" : 3566627,
      "reputation" : 43,
      "user_id" : 2977967,
      "user_type" : "registered",
      "profile_image" : "https://graph.facebook.com/776457968/picture?type=large",
      "display_name" : "femalesoftwareengineer",
      "link" : "https://stackoverflow.com/users/2977967/femalesoftwareengineer"
    },
    "is_answered" : false,
    "view_count" : 214,
    "closed_date" : 1746455688,
    "answer_count" : 1,
    "score" : -3,
    "last_activity_date" : 1747290848,
    "creation_date" : 1746434108,
    "link" : "https://stackoverflow.com/questions/79606583/how-can-i-prevent-sql-injection-in-my-code",
    "closed_reason" : "Duplicate"
  },
  "answers" : [ {
    "answer_id" : 79606692,
    "question_id" : 79606583,
    "body" : "<p>Wherever the SQL query is being built, you can do something like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>String sql = &quot;SELECT * FROM products WHERE id = ?&quot;;\nPreparedStatement stmt = connection.prepareStatement(sql);\nstmt.setInt(1, searchresultbean.getId());\nResultSet rs = stmt.executeQuery();\n</code></pre>\n<p>This way, you avoid SQL injection completely since you're not manually concatenating user input into the SQL string.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 41698677,
      "reputation" : 61,
      "user_id" : 30409910,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3789a3ee77ddba9899056fb96c9200ee?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Yash Mote",
      "link" : "https://stackoverflow.com/users/30409910/yash-mote"
    },
    "creation_date" : 1746438205,
    "last_activity_date" : 1746445693,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140399419,
    "post_id" : 79606583,
    "body" : "... to the values found in <code>searchresultbean</code>.",
    "score" : 0,
    "owner" : {
      "account_id" : 1085259,
      "reputation" : 80183,
      "user_id" : 1081110,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Fp4Pm.jpg?s=256",
      "display_name" : "Dawood ibn Kareem",
      "link" : "https://stackoverflow.com/users/1081110/dawood-ibn-kareem"
    },
    "creation_date" : 1746519851,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140399417,
    "post_id" : 79606583,
    "body" : "Unfortunately, the two questions that have been flagged as duplicates of this one are different enough to be unhelpful. I now can&#39;t answer this without reopening it; and I&#39;m not sure whether I&#39;m able to do that. You&#39;ll definitely have to tweak <code>buildSQLWhereClause</code>, so that whenever any of the fields in <code>searchresultbean</code> is populated, you&#39;ll add something to the SQL such as <code>AND v.id = ?</code> or <code>AND v._num = ?</code> and so on - use a <code>?</code> instead of the actual value. But you&#39;ll also need to write a second method, which iterates through the fields again and sets the parameters in the prepared statement",
    "score" : 0,
    "owner" : {
      "account_id" : 1085259,
      "reputation" : 80183,
      "user_id" : 1081110,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Fp4Pm.jpg?s=256",
      "display_name" : "Dawood ibn Kareem",
      "link" : "https://stackoverflow.com/users/1081110/dawood-ibn-kareem"
    },
    "creation_date" : 1746519836,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140398661,
    "post_id" : 79606583,
    "body" : "@DawoodibnKareem  i have read it ready and and which method i need to finetune ,buildSQLWhereClause?",
    "score" : 0,
    "owner" : {
      "account_id" : 3566627,
      "reputation" : 43,
      "user_id" : 2977967,
      "user_type" : "registered",
      "profile_image" : "https://graph.facebook.com/776457968/picture?type=large",
      "display_name" : "femalesoftwareengineer",
      "link" : "https://stackoverflow.com/users/2977967/femalesoftwareengineer"
    },
    "creation_date" : 1746497436,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140396372,
    "post_id" : 79606583,
    "body" : "The question I linked above is focussed on PHP, but the essence is the same because this is really an SQL problem. Read and digest.",
    "score" : 0,
    "owner" : {
      "account_id" : 2095810,
      "reputation" : 5436,
      "user_id" : 14853083,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/tiedu.png?s=256",
      "display_name" : "Tangentially Perpendicular",
      "link" : "https://stackoverflow.com/users/14853083/tangentially-perpendicular"
    },
    "creation_date" : 1746438513,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140396208,
    "post_id" : 79606583,
    "body" : "I could provide you with an answer here, but I think a better idea would be for you to read about prepared statements; and try to understand what they look like, why we need them, and how you&#39;d make one in your code above.  You&#39;ll have to make two passes through your list of fields - one to make the prepared statement, then one to set the parameters.  Please comment here once you&#39;ve read up on prepared statements, if it&#39;s still not clear what to do, and I&#39;ll try to either explain more fully, or find you a similar example online.",
    "score" : 3,
    "owner" : {
      "account_id" : 1085259,
      "reputation" : 80183,
      "user_id" : 1081110,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Fp4Pm.jpg?s=256",
      "display_name" : "Dawood ibn Kareem",
      "link" : "https://stackoverflow.com/users/1081110/dawood-ibn-kareem"
    },
    "creation_date" : 1746435053,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140396202,
    "post_id" : 79606583,
    "body" : "Prepared Statements <a href=\"https://en.wikipedia.org/wiki/Prepared_statement\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Prepared_statement</a>",
    "score" : 9,
    "owner" : {
      "account_id" : 2465829,
      "reputation" : 13627,
      "user_id" : 2148953,
      "user_type" : "registered",
      "accept_rate" : 96,
      "profile_image" : "https://i.sstatic.net/DVHoP84E.jpg?s=256",
      "display_name" : "aran",
      "link" : "https://stackoverflow.com/users/2148953/aran"
    },
    "creation_date" : 1746434919,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79606692" : [ {
      "comment_id" : 140398755,
      "post_id" : 79606692,
      "body" : "@femalesoftwareengineer when I wrote the comment it was <code>getProductSearchResult</code>. Pardon me for not updating my comment after you edited your question and changed the method name.",
      "score" : 0,
      "owner" : {
        "account_id" : 2485939,
        "reputation" : 20969,
        "user_id" : 2164365,
        "user_type" : "registered",
        "accept_rate" : 40,
        "profile_image" : "https://i.sstatic.net/RKSgV.png?s=256",
        "display_name" : "Abra",
        "link" : "https://stackoverflow.com/users/2164365/abra"
      },
      "creation_date" : 1746502293,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140398663,
      "post_id" : 79606692,
      "body" : "@abra its getSearchResults",
      "score" : 0,
      "owner" : {
        "account_id" : 3566627,
        "reputation" : 43,
        "user_id" : 2977967,
        "user_type" : "registered",
        "profile_image" : "https://graph.facebook.com/776457968/picture?type=large",
        "display_name" : "femalesoftwareengineer",
        "link" : "https://stackoverflow.com/users/2977967/femalesoftwareengineer"
      },
      "creation_date" : 1746497502,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140396691,
      "post_id" : 79606692,
      "body" : "I actually meant wherever the SQL query is being built in the code.",
      "score" : 0,
      "owner" : {
        "account_id" : 41698677,
        "reputation" : 61,
        "user_id" : 30409910,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/3789a3ee77ddba9899056fb96c9200ee?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Yash Mote",
        "link" : "https://stackoverflow.com/users/30409910/yash-mote"
      },
      "creation_date" : 1746445657,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140396519,
      "post_id" : 79606692,
      "body" : "Unless I missed something, the code for method <code>getProductSearchResult</code> was <b>not</b> posted, so how do you know what to change in it?",
      "score" : 1,
      "owner" : {
        "account_id" : 2485939,
        "reputation" : 20969,
        "user_id" : 2164365,
        "user_type" : "registered",
        "accept_rate" : 40,
        "profile_image" : "https://i.sstatic.net/RKSgV.png?s=256",
        "display_name" : "Abra",
        "link" : "https://stackoverflow.com/users/2164365/abra"
      },
      "creation_date" : 1746442105,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}