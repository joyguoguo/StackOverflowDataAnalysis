{
  "question" : {
    "question_id" : 79733389,
    "title" : "How to set proxy to create WorkspaceClient in Databricks using Java SDK",
    "body" : "<p>I am working on Azure Databricks Test Automation using Java. There are a number of Jobs and pipelines that are created in Azure Databricks to process data. I want to create WorkspaceClient for them and validate the functionality and logs. I am behind a corporate proxy and on running my Java code, I am getting <code>Unknown host/ Connection Timeout error</code>.</p>\n<p>Here is my Java code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public static WorkspaceClient getWorkspaceClient() throws Exception {\n    \n    System.setProperty(&quot;http.proxyHost&quot;, &quot;xyz.com&quot;);\n    System.setProperty(&quot;http.proxyPort&quot;, &quot;8888&quot;);\n    System.setProperty(&quot;https.proxyHost&quot;, &quot;xyz.com&quot;);\n    System.setProperty(&quot;https.proxyPort&quot;, &quot;8888&quot;);\n    \n    DatabricksConfig cfg = new DatabricksConfig()\n             .setHost(&quot;https://...&quot;)\n\n             .setToken(&quot;xxx&quot;);\n                  \n    WorkspaceClient w = new WorkspaceClient(cfg);\n    \n    \n    System.out.println(&quot;#Jobs: &quot; + w.jobs().list(null));\n</code></pre>\n<p>The proxy is not getting picked up/resolved and I am getting the below error:</p>\n<pre class=\"lang-none prettyprint-override\"><code>20:41:29.105 [main] WARN com.databricks.sdk.core.DefaultCredentialsProvider -- Failed to get OpenID Connect endpoints\n    com.databricks.sdk.core.DatabricksException: Request GET /oidc/.well-known/oauth-authorization-server failed after 4 retries\n        at com.databricks.sdk.core.ApiClient.executeInner(ApiClient.java:261)\n        at com.databricks.sdk.core.ApiClient.execute(ApiClient.java:204)\n        at com.databricks.sdk.core.ApiClient.execute(ApiClient.java:191)\n        at com.databricks.sdk.core.DatabricksConfig.fetchDefaultOidcEndpoints(DatabricksConfig.java:666)\n        at com.databricks.sdk.core.DatabricksConfig.getOidcEndpoints(DatabricksConfig.java:622)\n        at com.databricks.sdk.core.DefaultCredentialsProvider.addOIDCCredentialsProviders(DefaultCredentialsProvider.java:101)\n        at com.databricks.sdk.core.DefaultCredentialsProvider.addDefaultCredentialsProviders(DefaultCredentialsProvider.java:164)\n        at com.databricks.sdk.core.DefaultCredentialsProvider.configure(DefaultCredentialsProvider.java:60)\n        at com.databricks.sdk.core.DatabricksConfig.getTokenSource(DatabricksConfig.java:223)\n        at com.databricks.sdk.service.serving.ServingEndpointsDataPlaneImpl.&lt;init&gt;(ServingEndpointsDataPlaneImpl.java:31)\n        at com.databricks.sdk.service.serving.ServingEndpointsDataPlaneAPI.&lt;init&gt;(ServingEndpointsDataPlaneAPI.java:23)\n        at com.databricks.sdk.WorkspaceClient.&lt;init&gt;(WorkspaceClient.java:445)\n        at com.amdocs.di.testing.steps.tests.demo.DatabricksWConfig.getWorkspaceClient(DatabricksWConfig.java:43)\n        at com.amdocs.di.testing.steps.tests.demo.TestDatabricksJDBCConnection.testWF(TestDatabricksJDBCConnection.java:77)\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.base/java.lang.reflect.Method.invoke(Method.java:568)\n        at org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:141)\n        at org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:686)\n        at org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:230)\n        at org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:63)\n        at org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:992)\n        at org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:203)\n        at org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:154)\n        at org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:134)\n        at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n        at org.testng.TestRunner.privateRun(TestRunner.java:739)\n        at org.testng.TestRunner.run(TestRunner.java:614)\n        at org.testng.SuiteRunner.runTest(SuiteRunner.java:421)\n        at org.testng.SuiteRunner.runSequentially(SuiteRunner.java:413)\n        at org.testng.SuiteRunner.privateRun(SuiteRunner.java:373)\n        at org.testng.SuiteRunner.run(SuiteRunner.java:312)\n        at org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n        at org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n        at org.testng.TestNG.runSuitesSequentially(TestNG.java:1274)\n        at org.testng.TestNG.runSuitesLocally(TestNG.java:1208)\n        at org.testng.TestNG.runSuites(TestNG.java:1112)\n        at org.testng.TestNG.run(TestNG.java:1079)\n        at com.intellij.rt.testng.IDEARemoteTestNG.run(IDEARemoteTestNG.java:65)\n        at com.intellij.rt.testng.RemoteTestNGStarter.main(RemoteTestNGStarter.java:105)\n    Caused by: com.databricks.sdk.core.DatabricksError: xxxxxxxxx\n        at com.databricks.sdk.core.error.ApiErrors.getDatabricksError(ApiErrors.java:23)\n        at com.databricks.sdk.core.ApiClient.executeInner(ApiClient.java:255)\n        ... 40 common frames omitted\n    Caused by: java.net.UnknownHostException: xxxxxxxxxxxxxxxxxxxx\n</code></pre>\n",
    "tags" : [ "java", "azure", "databricks", "azure-databricks" ],
    "owner" : {
      "account_id" : 13243482,
      "reputation" : 385,
      "user_id" : 9563278,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/s256-rj/photo.jpg",
      "display_name" : "ashish chauhan",
      "link" : "https://stackoverflow.com/users/9563278/ashish-chauhan"
    },
    "is_answered" : false,
    "view_count" : 132,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1755088797,
    "creation_date" : 1755012037,
    "link" : "https://stackoverflow.com/questions/79733389/how-to-set-proxy-to-create-workspaceclient-in-databricks-using-java-sdk",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79734288,
    "question_id" : 79733389,
    "body" : "<ul>\n<li><p>The java sdk for databricks doesn’t automatically respect <strong>http(s).proxyHost</strong> system properties for its internal http client, you need to explicitly set the proxy in the <strong>DatabricksConfig</strong> via <strong><code>.setProxyHost()</code></strong> and <strong><code>.setProxyPort()</code></strong> or use a custom <strong>HttpClient</strong> injected into the sdk that’s proxy-aware. otherwise all your system property settings get ignored.</p>\n</li>\n<li><p>corporate proxies often require ssl interception and custom truststores. if your proxy rewrites certificates, you’ll need to add the proxy’s root cert to your java truststore <strong>($JAVA_HOME/lib/security/cacerts)</strong> and point <strong>-Djavax.net.ssl.trustStore</strong> to it, or every https call will silently fail with unknown host / timeout errors even if the dns is fine.</p>\n</li>\n</ul>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 8810425,
      "reputation" : 7006,
      "user_id" : 6583644,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/JCblc.jpg?s=256",
      "display_name" : "Patrick R",
      "link" : "https://stackoverflow.com/users/6583644/patrick-r"
    },
    "creation_date" : 1755088797,
    "last_activity_date" : 1755088797,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}