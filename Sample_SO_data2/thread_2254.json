{
  "question" : {
    "question_id" : 79637457,
    "title" : "How to use tf.withControlDependencies in tensorflow Java API?",
    "body" : "<p>I want to put two tensors into a map, and then get one tensor from the map. To ensure <code>tf.tensorMapInsert</code> is executed, I use <code>tf.withControlDependencies</code> - but it does not work.</p>\n<p>Here is my code:</p>\n<pre><code>Operand&lt;?&gt; map = tf.emptyTensorMap();\nOperand&lt;?&gt; out = tf.withControlDependencies(\n   tf.tensorMapInsert(map, tf.constant(&quot;hidden&quot;), hNext),\n   tf.tensorMapInsert(map, tf.constant(&quot;cell&quot;), cNext)\n).identity(map);\nout = tf.tensorMapLookup(out, tf.constant(&quot;hidden&quot;), TFloat32.class);\n</code></pre>\n<p>When I fetch <code>out</code>, I got an error: <code>Trying to lookup non-existent key. Could not find key &quot;hidden&quot;.</code></p>\n<p>Full stack:</p>\n<pre><code>2025-05-25 02:15:07.809978: W tensorflow/core/framework/local_rendezvous.cc:404] Local rendezvous is aborting with status: INVALID_ARGUMENT: Trying to lookup non-existent key. Could not find key &quot;hidden&quot;.\n     [[{{node TensorMapLookup}}]]\n\norg.tensorflow.exceptions.TFInvalidArgumentException: Trying to lookup non-existent key. Could not find key &quot;hidden&quot;.\n     [[{{node TensorMapLookup}}]]\n\n    at org.tensorflow.internal.c_api.AbstractTF_Status.throwExceptionIfNotOK(AbstractTF_Status.java:76)\n    at org.tensorflow.Session.run(Session.java:826)\n    at org.tensorflow.Session$Runner.runHelper(Session.java:549)\n    at org.tensorflow.Session$Runner.run(Session.java:476)\n    at org.apache.wayang.tensorflow.model.TensorflowOperatorTest.testConvLSTM2D(TensorflowOperatorTest.java:134)\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.base/java.lang.reflect.Method.invoke(Method.java:569)\n    at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)\n    at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n    at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)\n    at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n    at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)\n    at org.junit.runners.BlockJUnit4ClassRunner$1.evaluate(BlockJUnit4ClassRunner.java:100)\n    at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)\n    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:103)\n    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:63)\n    at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)\n    at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)\n    at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)\n    at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)\n    at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)\n    at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)\n    at org.junit.runners.ParentRunner.run(ParentRunner.java:413)\n    at org.junit.runner.JUnitCore.run(JUnitCore.java:137)\n    at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)\n    at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)\n    at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)\n    at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)\n    at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:232)\n    at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:55)\n</code></pre>\n<p>So how to use tf.withControlDependencies in tensorflow Java API?</p>\n",
    "tags" : [ "java", "tensorflow", "control-flow" ],
    "owner" : {
      "account_id" : 42173550,
      "reputation" : 1,
      "user_id" : 30626534,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f4112f7459939cd6573a8858a001f3d4?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Mingxi",
      "link" : "https://stackoverflow.com/users/30626534/mingxi"
    },
    "is_answered" : false,
    "view_count" : 56,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1748158520,
    "creation_date" : 1748158520,
    "link" : "https://stackoverflow.com/questions/79637457/how-to-use-tf-withcontroldependencies-in-tensorflow-java-api",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}