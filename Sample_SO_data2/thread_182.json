{
  "question" : {
    "question_id" : 79823165,
    "title" : "Issue With Jsoup Document Selector",
    "body" : "<p>I'm using java spring boot and jsoup and recently I upgraded jsoup version to <code>1.21.1</code>.</p>\n<p>My code creates search query and searches for it in the document</p>\n<pre class=\"lang-java prettyprint-override\"><code>Elements targetElements = document.select(createSearchQuery(strings)));\n</code></pre>\n<p>Recently however, this isn't working as expected. When search query gets too long (specifically, when query is over 2050 characters) I get <code>SelectorParseException</code></p>\n<pre class=\"lang-java prettyprint-override\"><code>org.jsoup.select.Selector$SelectorParseException: Did not find balanced marker at '\\&lt;string' at org.jsoup.select.QueryParser.parse(QueryParser.java:57)...\n</code></pre>\n<p>Note that this issue happens regardless of what the document contains, it only seems to depend on the length of the query.\nFor example, this query causes exception:</p>\n<pre class=\"lang-java prettyprint-override\"><code>document.select(&quot;:matches(^this-is-very-very-long-string$),:containsOwn(another-long-string&gt;),:containsOwn(&lt;another-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-verrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrry-long-string),:matches(^this-is-very-very-long-string$),:containsOwn(another-long-string&gt;),:containsOwn(&lt;another-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-verrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrry-long-string),:matches(^this-is-very-very-long-string$),:containsOwn(another-long-string&gt;),:containsOwn(&lt;another-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-verrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrry-long-string),:matches(^this-is-very-very-long-string$),:containsOwn(another-long-string&gt;),:containsOwn(&lt;another-verrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrry-long-string)&quot;)\n</code></pre>\n<p>Exception:</p>\n<pre class=\"lang-java prettyprint-override\"><code>Did not find balanced marker at '&lt;another-verrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrry-long-string'\n</code></pre>\n<p>However, if I remove a single <code>r</code> from my string and use this query then everything executes as expected.</p>\n<pre class=\"lang-java prettyprint-override\"><code>document.select(&quot;:matches(^this-is-very-very-long-string$),:containsOwn(another-long-string&gt;),:containsOwn(&lt;another-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-verrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrry-long-string),:matches(^this-is-very-very-long-string$),:containsOwn(another-long-string&gt;),:containsOwn(&lt;another-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-verrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrry-long-string),:matches(^this-is-very-very-long-string$),:containsOwn(another-long-string&gt;),:containsOwn(&lt;another-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-very-verrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrry-long-string),:matches(^this-is-very-very-long-string$),:containsOwn(another-long-string&gt;),:containsOwn(&lt;another-verrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrry-long-string)&quot;)\n</code></pre>\n<p>I haven't found any mention of this issue online. Does anyone know why this happens? Is this a bug? Is there a new feature that there's now a limit to the length of a selector?</p>\n",
    "tags" : [ "java", "html", "string", "jsoup", "html-parsing" ],
    "owner" : {
      "account_id" : 16344337,
      "reputation" : 243,
      "user_id" : 11880235,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/322f5f632987734c1ec4d157d4329844?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "user613",
      "link" : "https://stackoverflow.com/users/11880235/user613"
    },
    "is_answered" : false,
    "view_count" : 56,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1763559868,
    "creation_date" : 1763456657,
    "link" : "https://stackoverflow.com/questions/79823165/issue-with-jsoup-document-selector",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140862362,
    "post_id" : 79823165,
    "body" : "@lance-java no, not really. I&#39;m searching inside html part of emails, so there could be anything at all there and I&#39;m interested is whether or not there&#39;s a specific string (or one of many specific strings) inside the email&#39;s html",
    "score" : 0,
    "owner" : {
      "account_id" : 16344337,
      "reputation" : 243,
      "user_id" : 11880235,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/322f5f632987734c1ec4d157d4329844?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "user613",
      "link" : "https://stackoverflow.com/users/11880235/user613"
    },
    "creation_date" : 1763560018,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140859945,
    "post_id" : 79823165,
    "body" : "Do you have control over the html you are searching? Can you alter the html to include ids instead of relying on these selector queries?",
    "score" : 0,
    "owner" : {
      "account_id" : 1096470,
      "reputation" : 29415,
      "user_id" : 1089967,
      "user_type" : "registered",
      "accept_rate" : 59,
      "profile_image" : "https://www.gravatar.com/avatar/1f256b904ff621d678598d8fa49f86c5?s=256&d=identicon&r=PG",
      "display_name" : "lance-java",
      "link" : "https://stackoverflow.com/users/1089967/lance-java"
    },
    "creation_date" : 1763458460,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}