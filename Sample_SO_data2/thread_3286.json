{
  "question" : {
    "question_id" : 79561960,
    "title" : "Spring Boot @Reference annotation not saving the embedded class data in mongo when unique Index for that embedded doument is used",
    "body" : "<p>I am trying to save a mongo document, that document also has a embedded document, we are using @Reference annotation to avoid embedded document's unique constraint being reflected on the main document, this is working perfectly, but the problem is when i try to save the main document with embedded document, the embedded document is saved as null. grp is where I try to save y as an embedded document and it becomes null since there is no reference present in y.</p>\n<pre><code>@Data\n@EqualsAndHashCode(callSuper=false)\n@Document(collection = &quot;grp&quot;)\n@AllArgsConstructor\n@NoArgsConstructor\npublic class grp extends BaseEntity implements Serializable {\n\n@Indexed(unique = true)\nprivate String x;\n\n@Reference\nprivate List&lt;Z&gt; y;\n\n}\n\n\n\n@Data\n@EqualsAndHashCode(callSuper = false)\n@Document(collection = &quot;Z&quot;)\n@Builder\n@AllArgsConstructor\n@NoArgsConstructor\n@ToString\n@CompoundIndex(name = &quot;unique_index&quot;, def = &quot;{'aaa': 1, 'zzz' : 1}&quot;, unique = true)\n\npublic class Z extends BaseEntity implements Serializable {\n\nprivate String aaa;\n\nprivate String bbb;\n\nprivate Zzz zzz;\n\nprivate Ixxx xxx;\n\n}\n</code></pre>\n",
    "tags" : [ "java", "mongodb", "spring-boot" ],
    "owner" : {
      "account_id" : 21551302,
      "reputation" : 1,
      "user_id" : 15887364,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GhY-kmxb_eIxk2g5iR2CsIHb-Wqpnu3I1sYcA87=k-s256",
      "display_name" : "NAGANATHAN ",
      "link" : "https://stackoverflow.com/users/15887364/naganathan"
    },
    "is_answered" : false,
    "view_count" : 47,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1744133242,
    "creation_date" : 1744113730,
    "link" : "https://stackoverflow.com/questions/79561960/spring-boot-reference-annotation-not-saving-the-embedded-class-data-in-mongo-wh",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79562624,
    "question_id" : 79561960,
    "body" : "<p>@Reference (or its more current equivalent @DBRef) tells Spring Data to store a reference (like an ObjectId) to another document, not to embed it.</p>\n<p>You must save Z documents first:</p>\n<pre><code>Z zObj = zRepository.save(new Z(...)); // save first\nGrp grp = new Grp();\ngrp.setX(&quot;someValue&quot;);\ngrp.setY(List.of(zObj));\ngrpRepository.save(grp); // now it will store the DBRef\n</code></pre>\n<p>or</p>\n<p>You've to embed Z directly inside grp</p>\n<p>Then donâ€™t use @Reference,  just declare it as a regular field:</p>\n<pre><code>private List&lt;Z&gt; y;\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 7645025,
      "reputation" : 440,
      "user_id" : 5795975,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-6KwPUS4RnyA/AAAAAAAAAAI/AAAAAAAAC8w/auZqreI45x0/s256-rj/photo.jpg",
      "display_name" : "Vijay",
      "link" : "https://stackoverflow.com/users/5795975/vijay"
    },
    "creation_date" : 1744130776,
    "last_activity_date" : 1744133242,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}