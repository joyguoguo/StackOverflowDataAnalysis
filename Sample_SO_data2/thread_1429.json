{
  "question" : {
    "question_id" : 79711635,
    "title" : "Selenium DevTools Page.printToPDF throws TimeoutException after a few seconds",
    "body" : "<p>I'm trying to download a PDF of a page using Selenium 4 with Chrome DevTools Protocol.</p>\n<p>After calling <code>driver.get(url)</code>, I wait for rendering to complete using:</p>\n<pre class=\"lang-java prettyprint-override\"><code>Thread.sleep(60000); // wait for 1 minute to allow the page to finish rendering.\n\nPage.PrintToPDFResponse pdfResponse = devTools.send(\n    Page.printToPDF(\n        Optional.empty(), Optional.empty(), Optional.empty(),\n        Optional.of(1), Optional.of(8.27), Optional.of(11.7),\n        Optional.of(0.0), Optional.of(0.0), Optional.of(0.0), Optional.of(0.0),\n        Optional.empty(), Optional.empty(), Optional.empty(),\n        Optional.empty(), Optional.empty(), Optional.empty()\n    )\n);\n</code></pre>\n<p>However, the method fails within a few seconds, not even close to the timeout value I set with Future.get(...). The exception thrown is:</p>\n<p><strong>There’s no problem when the page to be printed as PDF is small, but when the content becomes large, a TimeoutException occurs.</strong></p>\n<pre><code>java.util.concurrent.TimeoutException\nBuild info: version: '4.18.1', revision: 'b1d3319b48'\nSystem info: os.name: 'Linux', os.arch: 'amd64', os.version: '5.15.0-143-generic', java.version: '17.0.2'\nDriver info: driver.version: unknown\n</code></pre>\n<p>Any help would be greatly appreciated!</p>\n<p>Selenium: 4.18.1</p>\n<p>Java: 17</p>\n<p>OS: Ubuntu 22.04</p>\n<p>ChromeDriver: headless mode</p>\n<p>Chrome: version compatible with CDP</p>\n<pre class=\"lang-java prettyprint-override\"><code>System.setProperty(&quot;webdriver.chrome.driver&quot;, &quot;/chromedriver&quot;);\n\n\n        ChromeOptions options = new ChromeOptions();\n        options.addArguments(&quot;--headless=new&quot;);\n        options.addArguments(&quot;--window-size=1920,1080&quot;);\n        options.addArguments(&quot;--no-sandbox&quot;);\n        options.addArguments(&quot;--log-level=2&quot;);\n\n        options.addArguments(&quot;--disable-dev-shm-usage&quot;); \n        options.addArguments(&quot;--disable-gpu&quot;);\n        options.addArguments(&quot;--disable-software-rasterizer&quot;);\n\n        File downloadDir = new File(reportDir.getAbsolutePath() + File.separator + PDF);\n        if (!downloadDir.exists()) {\n            downloadDir.mkdirs();\n        }\n        HashMap&lt;String, Object&gt; chromePrefs = new HashMap&lt;&gt;();\n        chromePrefs.put(&quot;profile.default_content_settings.popups&quot;, 0);\n        options.setExperimentalOption(&quot;prefs&quot;, chromePrefs);\n\n        // Ignore SSL certificate errors\n        options.addArguments(&quot;--ignore-certificate-errors&quot;);\n        options.addArguments(&quot;--allow-insecure-localhost&quot;);\n\n        ChromeDriver driver = null;\n\n        String url = &quot;https://localhost:443/stat-report-pdf&quot;;\n\n        try {\n            driver = new ChromeDriver(options);\n\n            driver.manage().timeouts().pageLoadTimeout(10, TimeUnit.MINUTES);\n\n            DevTools devTools = driver.getDevTools();\n            devTools.createSession();\n\n            driver.get(url);\n\n            try {\n                Thread.sleep(1 * 60 * 1000); \n            } catch (InterruptedException e) {\n                log.error(&quot;processPdfFile InterruptedException 에러&quot;);\n                Thread.currentThread().interrupt(); \n            }\n\n            Page.PrintToPDFResponse pdfResponse = devTools.send(\n                    Page.printToPDF(Optional.empty(), Optional.empty(), Optional.empty(),\n                            Optional.of(1), Optional.of(8.27), Optional.of(11.7),\n                            Optional.of(0.0), Optional.of(0.0), Optional.of(0.0), Optional.of(0.0),\n                            Optional.empty(), Optional.empty(), Optional.empty(), Optional.empty(), Optional.empty(), Optional.empty())\n            );\n\n            byte[] pdfData = Base64.getDecoder().decode(pdfResponse.getData());\n            Path pdfPath = Paths.get(downloadDir.getAbsolutePath(), now.format(DateTimeFormatter.ofPattern(&quot;yyyyMMdd&quot;))+&quot;_MNX_Report.pdf&quot;);\n            Files.write(pdfPath, pdfData);\n\n            if( Files.exists(pdfPath) &amp;&amp; Files.size(pdfPath) &gt; 0) {\n                log.debug(&quot;PDF file generate success: {}&quot;, pdfPath.toString());\n                mailService.sendMailReport(pdfPath, startDate, endDate);\n            } else {\n                log.error(&quot;PDF file generate fail: {}&quot;, pdfPath.toString());\n                return false; \n            }\n\n        } catch (Exception e) {\n            log.error(&quot;processPdfFile error = {}&quot;, e.getMessage());\n            return false; \n        } finally {\n            if (driver != null) {\n                driver.quit();\n            }\n        }\n\n        return true;\n    }\n</code></pre>\n",
    "tags" : [ "java", "selenium-webdriver" ],
    "owner" : {
      "account_id" : 23764267,
      "reputation" : 3,
      "user_id" : 17779228,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f20f24785b7a55adb6a5790eed9bdd56?s=256&d=identicon&r=PG",
      "display_name" : "배효성",
      "link" : "https://stackoverflow.com/users/17779228/%eb%b0%b0%ed%9a%a8%ec%84%b1"
    },
    "is_answered" : false,
    "view_count" : 78,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1753367243,
    "creation_date" : 1753263014,
    "link" : "https://stackoverflow.com/questions/79711635/selenium-devtools-page-printtopdf-throws-timeoutexception-after-a-few-seconds",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79713541,
    "question_id" : 79711635,
    "body" : "<p>It might be because of larger size of PDF.</p>\n<p>Try with giving pageRange parameter with devtools.send();</p>\n<p>Example : Optional.of(&quot;1-3&quot;)</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 3764767,
      "reputation" : 1,
      "user_id" : 3128554,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/515201e6b859d8ca329c7a501bd46e6b?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Amar Sorathiya",
      "link" : "https://stackoverflow.com/users/3128554/amar-sorathiya"
    },
    "creation_date" : 1753367243,
    "last_activity_date" : 1753367243,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140613674,
    "post_id" : 79711635,
    "body" : "What I want to do is generate a PDF from the final, fully rendered page on the frontend and download it. Is there a recommended way to achieve this?",
    "score" : 0,
    "owner" : {
      "account_id" : 23764267,
      "reputation" : 3,
      "user_id" : 17779228,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f20f24785b7a55adb6a5790eed9bdd56?s=256&d=identicon&r=PG",
      "display_name" : "배효성",
      "link" : "https://stackoverflow.com/users/17779228/%eb%b0%b0%ed%9a%a8%ec%84%b1"
    },
    "creation_date" : 1753321768,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140612609,
    "post_id" : 79711635,
    "body" : "2 guesses for the exception: 1) &quot;webdriver.chrome.driver&quot; should probably be set to an absolute path.  2) The PDF file/DOM isn&#39;t be accessible via Selenium.  (there&#39;s no DOM if it&#39;s a file... in that case the browser&#39;s built-in PDF viewer may take over)",
    "score" : 0,
    "owner" : {
      "account_id" : 6077817,
      "reputation" : 1362,
      "user_id" : 4744568,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/125cdb7d43927756913b920de016f420?s=256&d=identicon&r=PG",
      "display_name" : "browsermator",
      "link" : "https://stackoverflow.com/users/4744568/browsermator"
    },
    "creation_date" : 1753287709,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140612604,
    "post_id" : 79711635,
    "body" : "not sure what&#39;s causing the error, but you can do this with one line of code and copyURLToFile: <a href=\"https://commons.apache.org/proper/commons-io/apidocs/org/apache/commons/io/FileUtils.html#copyURLToFile(java.net.URL,java.io.File)\" rel=\"nofollow noreferrer\">commons.apache.org/proper/commons-io/apidocs/org/apache/comm&zwnj;&#8203;ons/&hellip;</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 6077817,
      "reputation" : 1362,
      "user_id" : 4744568,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/125cdb7d43927756913b920de016f420?s=256&d=identicon&r=PG",
      "display_name" : "browsermator",
      "link" : "https://stackoverflow.com/users/4744568/browsermator"
    },
    "creation_date" : 1753287448,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}