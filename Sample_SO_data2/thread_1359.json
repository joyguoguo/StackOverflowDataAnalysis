{
  "question" : {
    "question_id" : 79718863,
    "title" : "JobRunr doesn&#39;t execute recurring jobs after upgrade to 8.0.1",
    "body" : "<p><em>Edit: This is resolved now; see comments.</em></p>\n<p>I upgraded to JobRunr 8.0.1 (from 6.3.5), using it in a plain Java application with a MongoDB storage provider.</p>\n<p>Start up looks fine:</p>\n<pre><code>INFO VirtualThreadJobRunrExecutor - ThreadManager of type 'VirtualThreadPerTask' started\nINFO BackgroundJobServer - JobRunr BackgroundJobServer (8ef68125-5bb4-4a95-abfb-c5f1fe24ff54) using MongoDBStorageProvider and 256 BackgroundJobPerformers started successfully\nINFO ServerZooKeeper - Server 8ef68125-5bb4-4a95-abfb-c5f1fe24ff54 is master (this BackgroundJobServer)\n</code></pre>\n<p>Then I schedule three recurring jobs, one for execution every hour, two for execution every minute.</p>\n<p>After that, nothing happens anymore. On some run, it restarted the background job server after one minute, but nothing more.</p>\n<p>My set up code looks like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>MongoDBStorageProvider storage = new MongoDBStorageProvider(\n    MongoDatastore.get().getMongoClient(),\n    databaseName\n);\n\nJobScheduler scheduler = JobRunr.configure()\n    .useStorageProvider(storage)\n    .useBackgroundJobServer()\n    .initialize()\n    .getJobScheduler();\n</code></pre>\n<p>When creating the job, I do something like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>scheduler.scheduleRecurrently(uuid.toString(), Duration.ofMinutes(1), this::execute);\n</code></pre>\n<p>In the Mongo shell, I see that the documents have been properly created (or so it seems; the IDs are different from the ones in the logs because I copied them from different runs):</p>\n<pre><code>jobrunr&gt; db.background_job_servers.find()\n[\n  {\n    _id: UUID('1e09cc9e-9c58-47f0-84a1-bd31cda21a77'),\n    name: '4efbddd3c64e',\n    workerPoolSize: 256,\n    pollIntervalInSeconds: 15,\n    deleteSucceededJobsAfter: 'PT36H',\n    permanentlyDeleteDeletedJobsAfter: 'PT72H',\n    firstHeartbeat: '2025-07-29T14:38:47.870647198Z',\n    lastHeartbeat: '2025-07-29T14:45:33.073824205Z',\n    running: true,\n    systemTotalMemory: Long('12352139264'),\n    systemFreeMemory: Long('647979008'),\n    systemCpuLoad: 0.04534611688589821,\n    processMaxMemory: Long('3089104896'),\n    processFreeMemory: Long('3035388512'),\n    processAllocatedMemory: Long('53716384'),\n    processCpuLoad: 0.00012545477355413372\n  }\n]\njobrunr&gt; db.recurring_jobs.find()\n[\n  {\n    _id: '5f1a3bae-d048-3e86-adf7-d284b0849ad5',\n    version: 0,\n    jobAsJson: '{&quot;version&quot;:0,&quot;jobSignature&quot;:&quot;...DataSource.execute()&quot;,&quot;jobName&quot;:&quot;...DataSource.execute()&quot;,&quot;labels&quot;:[],&quot;jobDetails&quot;:{&quot;className&quot;:&quot;...DataSource&quot;,&quot;methodName&quot;:&quot;execute&quot;,&quot;jobParameters&quot;:[],&quot;cacheable&quot;:true},&quot;id&quot;:&quot;5f1a3bae-d048-3e86-adf7-d284b0849ad5&quot;,&quot;scheduleExpression&quot;:&quot;PT1H&quot;,&quot;zoneId&quot;:&quot;UTC&quot;,&quot;createdBy&quot;:&quot;API&quot;,&quot;createdAt&quot;:&quot;2025-07-29T14:38:47.923161385Z&quot;}',\n    createdAt: Long('1753799927923')\n  },\n  {\n    _id: 'e56fa5b7-30e9-3b22-9ca5-d8d44396955d',\n    version: 0,\n    jobAsJson: '{&quot;version&quot;:0,&quot;jobSignature&quot;:&quot;...Simulation.execute()&quot;,&quot;jobName&quot;:&quot;...Simulation.execute()&quot;,&quot;labels&quot;:[],&quot;jobDetails&quot;:{&quot;className&quot;:&quot;...Simulation&quot;,&quot;methodName&quot;:&quot;execute&quot;,&quot;jobParameters&quot;:[],&quot;cacheable&quot;:true},&quot;id&quot;:&quot;e56fa5b7-30e9-3b22-9ca5-d8d44396955d&quot;,&quot;scheduleExpression&quot;:&quot;PT1M&quot;,&quot;zoneId&quot;:&quot;UTC&quot;,&quot;createdBy&quot;:&quot;API&quot;,&quot;createdAt&quot;:&quot;2025-07-29T14:38:47.976590979Z&quot;}',\n    createdAt: Long('1753799927976')\n  },\n  {\n    _id: '62f55b7f-2ad7-340f-87aa-98fdd0660269',\n    version: 0,\n    jobAsJson: '{&quot;version&quot;:0,&quot;jobSignature&quot;:&quot;...DatabaseListener.execute()&quot;,&quot;jobName&quot;:&quot;...DatabaseListener.execute()&quot;,&quot;labels&quot;:[],&quot;jobDetails&quot;:{&quot;className&quot;:&quot;...DatabaseListener&quot;,&quot;methodName&quot;:&quot;execute&quot;,&quot;jobParameters&quot;:[],&quot;cacheable&quot;:true},&quot;id&quot;:&quot;62f55b7f-2ad7-340f-87aa-98fdd0660269&quot;,&quot;scheduleExpression&quot;:&quot;PT1M&quot;,&quot;zoneId&quot;:&quot;UTC&quot;,&quot;createdBy&quot;:&quot;API&quot;,&quot;createdAt&quot;:&quot;2025-07-29T14:38:47.980927767Z&quot;}',\n    createdAt: Long('1753799927980')\n  }\n]\n</code></pre>\n<p>When I revert back to 6.3.5 (not changing any of the code), it runs fine again. So I'm a bit lost...</p>\n<p>I checked the documentation for breaking changes in the newest version - probably I'm missing something? (Maybe connected to the job IDs? That's the only part of the code I had to change for the upgrade, because I initially used descriptive names and now have to use UUIDs.)</p>\n",
    "tags" : [ "java", "jobrunr" ],
    "owner" : {
      "account_id" : 6343837,
      "reputation" : 91,
      "user_id" : 4924981,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-dGEFkWlFgWA/AAAAAAAAAAI/AAAAAAAAACw/4s2yqrWoEMo/s256-rj/photo.jpg",
      "display_name" : "Christina Unger",
      "link" : "https://stackoverflow.com/users/4924981/christina-unger"
    },
    "is_answered" : false,
    "view_count" : 145,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1755523279,
    "creation_date" : 1753802741,
    "link" : "https://stackoverflow.com/questions/79718863/jobrunr-doesnt-execute-recurring-jobs-after-upgrade-to-8-0-1",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140658277,
    "post_id" : 79718863,
    "body" : "Indeed, JobRunr saves Instants in microseconds when using MongoDB. If you need to keep it as ISO Strings, I indeed would pass a custom MongoClient to JobRunr and keep your existing MongoClient with the ISO String codec.",
    "score" : 1,
    "owner" : {
      "account_id" : 986840,
      "reputation" : 1011,
      "user_id" : 1005124,
      "user_type" : "registered",
      "accept_rate" : 29,
      "profile_image" : "https://i.sstatic.net/hTmsr.jpg?s=256",
      "display_name" : "rdehuyss",
      "link" : "https://stackoverflow.com/users/1005124/rdehuyss"
    },
    "creation_date" : 1754939164,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140655263,
    "post_id" : 79718863,
    "body" : "I guess I can just use a different MongoClient for JobRunr...",
    "score" : 0,
    "owner" : {
      "account_id" : 6343837,
      "reputation" : 91,
      "user_id" : 4924981,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-dGEFkWlFgWA/AAAAAAAAAAI/AAAAAAAAACw/4s2yqrWoEMo/s256-rj/photo.jpg",
      "display_name" : "Christina Unger",
      "link" : "https://stackoverflow.com/users/4924981/christina-unger"
    },
    "creation_date" : 1754828635,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140651340,
    "post_id" : 79718863,
    "body" : "@rdehuyss I found the problem and put it in a smaller example repository: <a href=\"https://github.com/cunger/waiting-for-godot\" rel=\"nofollow noreferrer\">github.com/cunger/waiting-for-godot</a> -- I define a custom codec for serializing and deserializing Instants as ISO strings in MongoDB documents, which (I think) clashes with what JobRunr&#39;s background job server is expecting. When I don&#39;t use the custom codec, everything works fine. Not sure yet how to solve it, but at least it makes sense now. \uD83D\uDE05",
    "score" : 0,
    "owner" : {
      "account_id" : 6343837,
      "reputation" : 91,
      "user_id" : 4924981,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-dGEFkWlFgWA/AAAAAAAAAAI/AAAAAAAAACw/4s2yqrWoEMo/s256-rj/photo.jpg",
      "display_name" : "Christina Unger",
      "link" : "https://stackoverflow.com/users/4924981/christina-unger"
    },
    "creation_date" : 1754645102,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140633435,
    "post_id" : 79718863,
    "body" : "Yes, I&#39;ll try to reproduce it with a minimal example. Not sure how fast I&#39;ll manage, but it&#39;s not urgent. (Might also be a weird interaction with another dependency. Just wanted to make sure I don&#39;t miss anything obvious.)",
    "score" : 0,
    "owner" : {
      "account_id" : 6343837,
      "reputation" : 91,
      "user_id" : 4924981,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-dGEFkWlFgWA/AAAAAAAAAAI/AAAAAAAAACw/4s2yqrWoEMo/s256-rj/photo.jpg",
      "display_name" : "Christina Unger",
      "link" : "https://stackoverflow.com/users/4924981/christina-unger"
    },
    "creation_date" : 1753981775,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140632069,
    "post_id" : 79718863,
    "body" : "Hi Christina! Could you create a small repo reproducing this and create a github issue for us?",
    "score" : 0,
    "owner" : {
      "account_id" : 986840,
      "reputation" : 1011,
      "user_id" : 1005124,
      "user_type" : "registered",
      "accept_rate" : 29,
      "profile_image" : "https://i.sstatic.net/hTmsr.jpg?s=256",
      "display_name" : "rdehuyss",
      "link" : "https://stackoverflow.com/users/1005124/rdehuyss"
    },
    "creation_date" : 1753948807,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}