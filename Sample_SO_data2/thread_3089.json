{
  "question" : {
    "question_id" : 79574742,
    "title" : "Use keycloak-admin-client with httpclient5",
    "body" : "<p>I migrate legacy application on spring boot 3</p>\n<p>Connect <code>httpclient5</code>, and removed the dependency <code>httpclient4</code>, as it conflicts with many modern libraries that use exactly<code>httpclient5</code>\nAnd update dependency for <code>keycloak-admin-client:22.0.5</code>, <code>resteasy-multipart-provider:6.2.11.Final</code></p>\n<p>My code:</p>\n<pre><code>public KeycloakService(KeycloakProperties properties, KeycloakUserEntityJpa keycloakUserEntityJpa) { \n    this.properties = properties; \n    this.keycloakUserEntityJpa = keycloakUserEntityJpa; \n    KEYCLOAK keycloak = Keycloak.getInstance(properties.getKeycloakServer() + &quot;/auth&quot;, \n    properties.getRealm(), \n    properties.getUsername(), \n    properties.getPassword(), \n    properties.getClientId(), \n    properties.getClientSecret()); \n    this.realmResource = \n    keycloak.realm(properties.getRealm()); \n    this.usersResource = \n    this.realmResource.users(); \n    this.clientsResource = \n    this.realmResource.clients(); \n    this.rolesResource = \n    this.realmResource.roles(); \n}\n</code></pre>\n<p>When application start I get error:</p>\n<pre><code>Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate []: Constructor threw exception at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:117) \n... 110 common frames omitted \nCaused by: java.lang.NoClassDefFoundError: org/apache/hadoop/fs/FSDataOutputStreamBuilder$InstantiateConstructorResolver.java:315 \nat org.jboss.resteasy.client.jaxrs.internal.ResteasyClientBuilderImpl.build(ResteasyClientBuilderImpl.java:392) \nat org.keycloak.admin.client.jaxrs.internal.ResteasyClientBuilderImpl.build(ResteasyClientBuilderImpl.java:49) \nat org.keycloak.admin.client.Keycloak.newRestEasyClient(ResteasyClient.java:43) \nat org.keycloak.admin.client.Keycloak.getInstance(Keycloak.java:98) \nat org.keycloak.admin.client.Keycloak.getInstance(Keycloak.java:110) \nat org.keycloak.admin.client.Keycloak.getInstance(Keycloak.java:114) \nat java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77) \nat java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45) \nat java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:499) \nat org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:208) \n... 112 common frames omitted Caused by: java.lang.ClassNotFoundException: org.apache.http.conn.ssl.SSLConnectionSocketFactory \nat java.base/java.net.`enter code here`URLClassLoader.findClass(URLClassLoader.java:445) \nat java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:587) \nat org.springframework.boot.loader.net.protocol.jar.JarUrlClassLoader.loadClass(JarUrlClassLoader.java:107) \nat org.springframework.boot.loader.LaunchedURLClassLoader.loadClass(LaunchedURLClassLoader.java:91) \n... 125 common frames omitted\n</code></pre>\n<p>I understand that the problem is in deprecating <code>httpclient4</code></p>\n<p>But what is a possible solution to stay on <code>httpclient5</code>and get the required data from Keycloak using actual dependency?</p>\n",
    "tags" : [ "java", "keycloak", "httpclient", "apache-httpclient-4.x", "apache-httpclient-5.x" ],
    "owner" : {
      "account_id" : 32467947,
      "reputation" : 43,
      "user_id" : 25224125,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/331556bd2946bc085b33d2240d0c63b8?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Mike Sonarov",
      "link" : "https://stackoverflow.com/users/25224125/mike-sonarov"
    },
    "is_answered" : false,
    "view_count" : 75,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1744707559,
    "creation_date" : 1744707559,
    "link" : "https://stackoverflow.com/questions/79574742/use-keycloak-admin-client-with-httpclient5",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140337727,
    "post_id" : 79574742,
    "body" : "The keycloak-admin-client still depends on Apache HttpClient v4, which causes ClassNotFoundException if removed. To use it with HttpClient 5 projects, either re-add HttpClient 4 as a runtime dependency or bypass the SDK and call Keycloakâ€™s REST API directly using WebClient or HttpClient 5.",
    "score" : 0,
    "owner" : {
      "account_id" : 7645025,
      "reputation" : 440,
      "user_id" : 5795975,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-6KwPUS4RnyA/AAAAAAAAAAI/AAAAAAAAC8w/auZqreI45x0/s256-rj/photo.jpg",
      "display_name" : "Vijay",
      "link" : "https://stackoverflow.com/users/5795975/vijay"
    },
    "creation_date" : 1744733719,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}