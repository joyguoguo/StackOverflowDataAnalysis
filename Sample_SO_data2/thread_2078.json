{
  "question" : {
    "question_id" : 79653396,
    "title" : "Annotation based code generation fails compilation before code is generated",
    "body" : "<p>I am writing a Java library in which I'm attempting to auto-generate some boilerplate code using annotations. The generated code is a large hierarchy of sealed interfaces with lots of cyclic dependencies. Some of the manually written code depends on part of this hierarchy and it's my expectation that the compiler will use multiple rounds of annotation processing/compilation to satisfy those dependencies. The build always fails, however, before the annotation processor is run and any code is generated. The compilation errors are all of the form <code>error: cannot find symbol</code> and refer to the auto-generated types.</p>\n<p>Now, because my application is large and complex, I created a much smaller program to verify the fundamental premise: that manually created code can validly depend on auto-generated code and that the auto-generated code can include cyclic dependencies in the form of sealed interfaces with permits clauses. This smaller system, like my application, uses 2 modules: one with the annotations and the annotation processor and the other with the primary application. This way, they are built separately with the application module depending on the annotation processor module.</p>\n<p>Building the smaller application succeeds with a relevant portion of the output shown below</p>\n<pre class=\"lang-none prettyprint-override\"><code>[DEBUG] -d /Users/jamie/code/workspaces/zfcj/CodeGenerationTest/target/classes -classpath /Users/jamie/code/workspaces/zfcj/CodeGenerationTest/target/classes: --module-path /Users/jamie/.m2/repository/org/zfcj/MyAnnotationProcessor/1.0/MyAnnotationProcessor-1.0.jar: -sourcepath /Users/jamie/code/workspaces/zfcj/CodeGenerationTest/src/main/java:/Users/jamie/code/workspaces/zfcj/CodeGenerationTest/target/generated-sources: /Users/jamie/code/workspaces/zfcj/CodeGenerationTest/src/main/java/module-info.java /Users/jamie/code/workspaces/zfcj/CodeGenerationTest/src/main/java/my/annotation/test/ClassWithGeneratedDependency1.java /Users/jamie/code/workspaces/zfcj/CodeGenerationTest/src/main/java/my/annotation/test/AnnotationTest.java /Users/jamie/code/workspaces/zfcj/CodeGenerationTest/src/main/java/my/annotation/test/ClassWithGeneratedDependency2.java -s /Users/jamie/code/workspaces/zfcj/CodeGenerationTest/target/generated-sources -processor my.annotation.processor.Processor -processorpath /Users/jamie/.m2/repository/org/zfcj/MyAnnotationProcessor/1.0/MyAnnotationProcessor-1.0.jar: -g -nowarn -target 17 -source 17\n[WARNING] File encoding has not been set, using platform encoding UTF-8, i.e. build is platform dependent!\n[DEBUG] incrementalBuildHelper#beforeRebuildExecution\n[INFO] Compiling 4 source files to /Users/jamie/code/workspaces/zfcj/CodeGenerationTest/target/classes\n[DEBUG] ttcl changed run compileInProcessWithProperClassloader\nProcessing annotations...[my.annotation.processor.GenerateCode]\nProcessing annotations...[]\nProcessing annotations...[]\n</code></pre>\n<p>When I build the library, I see the following output with no indication that the annotation processor has run.</p>\n<pre class=\"lang-none prettyprint-override\"><code>[WARNING] File encoding has not been set, using platform encoding UTF-8, i.e. build is platform dependent!\n[DEBUG] incrementalBuildHelper#beforeRebuildExecution\n[INFO] Compiling 1039 source files to /Users/jamie/code/repos/zfcj/Math/target/classes\n[DEBUG] ttcl changed run compileInProcessWithProperClassloader\n[DEBUG] incrementalBuildHelper#afterRebuildExecution\n[INFO] -------------------------------------------------------------\n... compilation errors follow\n</code></pre>\n<p>Even with full build debug logging turned on, there is no additional information between the start of compilation and the failures that sheds any light on the issue. Why isn't the annotation processor run - generating the code that is necessary to prevent the build from failing? Or what steps should I take next to debug the issue?</p>\n<p>Update: Some additional clues...</p>\n<p>The part of the auto-generated code that the manual code depends on was manually coded before this change. If I restore that code and build (without any other changes), the annotation processor runs but compilation fails with <code>Attempt to recreate a file for type</code>. This is expected as the code generation is attempting to duplicate source files.</p>\n<pre><code>[INFO] Changes detected - recompiling the module!\n[WARNING] File encoding has not been set, using platform encoding UTF-8, i.e. build is platform dependent!\n[INFO] Compiling 1113 source files to /Users/jamie/code/repos/zfcj/Math/target/classes\nINFO: Generating concrete number type hierarchies...\nINFO: Creating ConcreteNumber class... \nSEVERE: Error creating concrete number hierarchies: Attempt to recreate a file for type org.zfcj.math.numbers.concrete.ConcreteNumber\n</code></pre>\n<p>If I update the annotation processor to shunt the auto-generated code to a different package, the build succeeds. Of course, this is not logically correct.</p>\n<p>So the problem doesn't seem related to configuration but internal to javac's annotation processing. Why does the restoration of the previously manually generated code cause the annotation processor to run but not otherwise?</p>\n",
    "tags" : [ "java", "maven", "annotations", "code-generation" ],
    "owner" : {
      "account_id" : 202731,
      "reputation" : 71,
      "user_id" : 449963,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/b3e208263813cdaa711d915cf3814c61?s=256&d=identicon&r=PG",
      "display_name" : "Jamie Mullowney",
      "link" : "https://stackoverflow.com/users/449963/jamie-mullowney"
    },
    "is_answered" : false,
    "view_count" : 104,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1749144097,
    "creation_date" : 1749065813,
    "link" : "https://stackoverflow.com/questions/79653396/annotation-based-code-generation-fails-compilation-before-code-is-generated",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140490912,
    "post_id" : 79653396,
    "body" : "@rzwitserloot I&#39;m using JDK17 and configure the AP jar with <code>&lt;annotationProcessorPaths&gt;</code> element.",
    "score" : 0,
    "owner" : {
      "account_id" : 202731,
      "reputation" : 71,
      "user_id" : 449963,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/b3e208263813cdaa711d915cf3814c61?s=256&d=identicon&r=PG",
      "display_name" : "Jamie Mullowney",
      "link" : "https://stackoverflow.com/users/449963/jamie-mullowney"
    },
    "creation_date" : 1749140051,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140488714,
    "post_id" : 79653396,
    "body" : "Wild stab in the dark: You are attempting to compile on JDK24 which breaks (intentionally, as in, OpenJDK for some reason intentionally did this) auto-discovery of APs. You must pass <code>-proc:full</code> or explicitly name the AP jar as switch in order for it to be applied.",
    "score" : 0,
    "owner" : {
      "account_id" : 401843,
      "reputation" : 107206,
      "user_id" : 768644,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/b13bedc5215730fbce5edff6c130988a?s=256&d=identicon&r=PG",
      "display_name" : "rzwitserloot",
      "link" : "https://stackoverflow.com/users/768644/rzwitserloot"
    },
    "creation_date" : 1749087018,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140488485,
    "post_id" : 79653396,
    "body" : "It would be helpful to provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>.",
    "score" : 0,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1749076430,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}