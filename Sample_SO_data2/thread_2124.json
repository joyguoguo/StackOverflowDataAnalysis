{
  "question" : {
    "question_id" : 79648379,
    "title" : "JAXB XJC encoding UTF-8 -&gt; Unicode problem",
    "body" : "<p>I have a Java 17 application, on Windows OS, configured with Gradle, to unmarshall files into Java classes via .xsd scheme, which contains UTF-8 symbols, specifically, Russian symbols. It was unable to generate classes with original UTF-8 names, but I found the way to force encoding during generation, it allowed me just to see my classes and compile the app. But in runtime I found out that the real problem is Unicode symbols in JAXB's annotations like @XmlElement, it renders the whole unmarhalling process impossible. The app says the file is incorrect starting from the first symbol. Example of generating:</p>\n<pre><code>@XmlElement(name = &quot;\\u041e\\u0442\\u043a\\u0440\\u044b\\u0442\\u0438\\u0435\\u0421\\u0447\\u0435\\u0442\\u043e\\u0432&quot;)\n    protected ОткрытиеСчетов открытиеСчетов;\n</code></pre>\n<p>The name in clauses supposed to be &quot;ОткрытиеСчетов&quot;.</p>\n<p>Fragment of my build.gradle file responsible for JAXB generation task is</p>\n<pre><code>configurations {\n    jaxb\n}\ndependencies {\n    implementation(&quot;org.glassfish.jaxb:jaxb-runtime:4.0.2&quot;)\n    implementation(&quot;jakarta.xml.bind:jakarta.xml.bind-api:4.0.2&quot;)\n\n    jaxb &quot;com.sun.xml.bind:jaxb-xjc:4.0.2&quot;\n    jaxb &quot;org.glassfish.jaxb:jaxb-runtime:4.0.2&quot;\n    jaxb &quot;jakarta.xml.bind:jakarta.xml.bind-api:4.0.2&quot;\n}\n\ntasks.register('xjcGenerate') {\n\n    def generatedSourcesDir = file(&quot;$buildDir/generated/sources/xjc&quot;)\n    outputs.dir generatedSourcesDir\n\n    doLast {\n        ant.taskdef(\n                name: 'xjc',\n                classname: 'com.sun.tools.xjc.XJCTask',\n                classpath: configurations.jaxb.asPath\n        )\n\n        ant.xjc(\n                destdir: generatedSourcesDir,\n                package: 'com.example.generated'\n        ) {\n            schema(dir: 'src/main/resources/xsd', includes: '*.xsd')\n            arg(value: &quot;-encoding&quot;)\n            arg(value: &quot;UTF-8&quot;)\n        }\n    }\n}\n\ncompileJava.dependsOn xjcGenerate\n\ncompileJava.options.encoding = 'UTF-8'\n</code></pre>\n<p>Example .xsd element, used for generation: <code>&lt;xs:complexType name=&quot;ОткрытиеСчетов&quot;&gt;</code>\nActual error during unmarshalling is</p>\n<pre><code>jakarta.xml.bind.UnmarshalException\n - with linked exception:\n[org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 1; Content is not allowed in prolog.\n</code></pre>\n<p>UPD: after fixes to build.gradle, the problem was in xml encoding, according to this <a href=\"https://stackoverflow.com/questions/5138696/org-xml-sax-saxparseexception-content-is-not-allowed-in-prolog?page=1&amp;tab=scoredesc#tab-top\">answer</a>, UTF-8 and UTF-8-BOM are not same, changing file encoding to UTF-8 helped!</p>\n",
    "tags" : [ "java", "gradle", "encoding", "jaxb", "xjc" ],
    "owner" : {
      "account_id" : 33865827,
      "reputation" : 3,
      "user_id" : 30667311,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/06ab6adc80534ec07d1c45c1c8cae70a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Roman Tataev",
      "link" : "https://stackoverflow.com/users/30667311/roman-tataev"
    },
    "is_answered" : true,
    "view_count" : 229,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1748988154,
    "creation_date" : 1748851421,
    "link" : "https://stackoverflow.com/questions/79648379/jaxb-xjc-encoding-utf-8-unicode-problem",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79648404,
    "question_id" : 79648379,
    "body" : "<p>Questions:</p>\n<ol>\n<li>What operating system are you executing this on? I'm guessing windows.</li>\n<li>Are you sure that the xml file is UTF-8 encoded? (note just because it has <code>&lt;?xml encoding=&quot;UTF-8&quot;?&gt;</code> doesn't guarantee it's UTF-8 encoded)</li>\n<li>Please include the relevant error message</li>\n</ol>\n<p>Try setting the following in gradle.properties</p>\n<pre><code>systemProp.file.encoding=UTF-8\n</code></pre>\n<p>Another option is</p>\n<pre class=\"lang-none prettyprint-override\"><code>tasks.withType(JavaCompile).configureEach {\n    options.encoding = 'UTF-8'\n}\n\ntasks.withType(Test).configureEach {\n    systemProperty('file.encoding', 'UTF-8')\n}\n\ntasks.withType(JavaExec).configureEach {\n    systemProperty('file.encoding', 'UTF-8')\n}\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1096470,
      "reputation" : 29424,
      "user_id" : 1089967,
      "user_type" : "registered",
      "accept_rate" : 59,
      "profile_image" : "https://www.gravatar.com/avatar/1f256b904ff621d678598d8fa49f86c5?s=256&d=identicon&r=PG",
      "display_name" : "lance-java",
      "link" : "https://stackoverflow.com/users/1089967/lance-java"
    },
    "creation_date" : 1748852856,
    "last_activity_date" : 1748853667,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79648437,
    "question_id" : 79648379,
    "body" : "<p>I think your problem is that while you managed to generate Java classes using UTF-8 encoding, JAXB annotations such as @XmlElement(name = &quot;...&quot;) contain Unicode escapes (\\uXXXX) instead of actual UTF-8 characters. Which breaks with non-latin chars.</p>\n<p>Try to force xjc to output native characters instead of Unicode escapes. By default, the xjc task writes annotations using Unicode escape sequences rather than native characters.</p>\n<p>Fot that you must launch xjc with proper JVM file encoding, e.g.:<br />\nIn your <strong>build.gradle</strong> add this :</p>\n<pre class=\"lang-none prettyprint-override\"><code>configurations {\n    jaxb\n}\n\ndependencies {\n    implementation(&quot;org.glassfish.jaxb:jaxb-runtime:4.0.2&quot;)\n    implementation(&quot;jakarta.xml.bind:jakarta.xml.bind-api:4.0.2&quot;)\n\n    jaxb &quot;com.sun.xml.bind:jaxb-xjc:4.0.2&quot;\n    jaxb &quot;org.glassfish.jaxb:jaxb-runtime:4.0.2&quot;\n    jaxb &quot;jakarta.xml.bind:jakarta.xml.bind-api:4.0.2&quot;\n}\n\ndef xsdDir = &quot;$projectDir/src/main/resources/xsd&quot;\ndef generatedDir = &quot;$buildDir/generated/sources/xjc&quot;\n\ntasks.register('xjcGenerate', JavaExec) {\n    group = &quot;build&quot;\n    description = &quot;Generate JAXB classes from XSD&quot;\n\n    classpath = configurations.jaxb\n    mainClass.set(&quot;com.sun.tools.xjc.XJCFacade&quot;)\n\n    // Pass all args to XJC\n    args = [\n        &quot;-d&quot;, generatedDir,\n        &quot;-p&quot;, &quot;com.example.generated&quot;,\n        &quot;-encoding&quot;, &quot;UTF-8&quot;,\n        &quot;-no-header&quot;,\n        &quot;$xsdDir/*.xsd&quot;\n    ]\n\n    jvmArgs = [&quot;-Dfile.encoding=UTF-8&quot;]\n    doFirst {\n        file(generatedDir).mkdirs()\n    }\n}\n\ncompileJava.dependsOn xjcGenerate\n\nsourceSets.main.java.srcDir(generatedDir)\ncompileJava.options.encoding = 'UTF-8'\n</code></pre>\n<p>And this line is to force the gradle build to not run with non utf8 by default. Add it in the <strong>gradle.properties</strong>:</p>\n<p><code>org.gradle.jvmargs=-Dfile.encoding=UTF-8</code></p>\n<p>You can try it and tell me if it works otherwise provide the errors log :)</p>\n",
    "score" : -1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 22541690,
      "reputation" : 50,
      "user_id" : 16732181,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c155f702ab88839498ab27c10cc5203f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "azaLiza",
      "link" : "https://stackoverflow.com/users/16732181/azaliza"
    },
    "creation_date" : 1748854679,
    "last_activity_date" : 1748858779,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79648437" : [ {
      "comment_id" : 140482451,
      "post_id" : 79648437,
      "body" : "Yeah, JAXB really hates BOMs. JAXB will blow up if the XML has unexpected bytes at the start.    Glad you figured it out!",
      "score" : 1,
      "owner" : {
        "account_id" : 22541690,
        "reputation" : 50,
        "user_id" : 16732181,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/c155f702ab88839498ab27c10cc5203f?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "azaLiza",
        "link" : "https://stackoverflow.com/users/16732181/azaliza"
      },
      "creation_date" : 1748937182,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140481094,
      "post_id" : 79648437,
      "body" : "Unicode escapes have nothing to do with this.  They are resolved at compile-time.  The bytecode generated by <code>&quot;A&quot;</code> and <code>&quot;\\u0041&quot;</code> is identical.",
      "score" : 0,
      "owner" : {
        "account_id" : 2053598,
        "reputation" : 44991,
        "user_id" : 1831987,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
        "display_name" : "VGR",
        "link" : "https://stackoverflow.com/users/1831987/vgr"
      },
      "creation_date" : 1748886460,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140480622,
      "post_id" : 79648437,
      "body" : "Long story short: my xml file was in UTF-8-BOM encoding, which seems to be incompatible with UTF-8 xsd scheme. But who knows, maybe without your code generation was wrong, too. Anyway. many thanks for the answer!",
      "score" : 0,
      "owner" : {
        "account_id" : 33865827,
        "reputation" : 3,
        "user_id" : 30667311,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/06ab6adc80534ec07d1c45c1c8cae70a?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Roman Tataev",
        "link" : "https://stackoverflow.com/users/30667311/roman-tataev"
      },
      "creation_date" : 1748876529,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140479133,
      "post_id" : 79648437,
      "body" : "That seems to be the normal behaviour and maybe the problem is not caused by the \\uxxx. do your xml files precise encoding ? &quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&quot;  +when reading xml in java use this instead of new File(&quot;file.xml&quot;):  &quot;try (InputStream is = new FileInputStream(&quot;your-file.xml&quot;)) {      JAXBContext context = JAXBContext.newInstance(YourRootClass.class);      Unmarshaller unmarshaller = context.createUnmarshaller();      YourRootClass result = (YourRootClass) unmarshaller.unmarshal(new InputStreamReader(is, StandardCharsets.UTF_8));  }&quot;  And do NOT FORGET TO CLEAN &amp; REBUILD proj",
      "score" : 0,
      "owner" : {
        "account_id" : 22541690,
        "reputation" : 50,
        "user_id" : 16732181,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/c155f702ab88839498ab27c10cc5203f?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "azaLiza",
        "link" : "https://stackoverflow.com/users/16732181/azaliza"
      },
      "creation_date" : 1748865893,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140478925,
      "post_id" : 79648437,
      "body" : "I&#39;ve tried that, still no luck. But i found out, that in my &quot;build&quot; folder there are 2 generated files corresponding with my scheme. It did generate build/classes/java/main/com/example/generated/СчетПК.class with correct symbols, there are no unicode. And there are build/generated/sources/xjc/СчетПК.java, which has unicode symbols. When i try to import class into my service, IDEA suggests the only option com.example.generated.СчетПК, and when i CTRL+Click into it - it leads to build/generated/sources/xjc/СчетПК.java",
      "score" : 0,
      "owner" : {
        "account_id" : 33865827,
        "reputation" : 3,
        "user_id" : 30667311,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/06ab6adc80534ec07d1c45c1c8cae70a?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Roman Tataev",
        "link" : "https://stackoverflow.com/users/30667311/roman-tataev"
      },
      "creation_date" : 1748860841,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140478836,
      "post_id" : 79648437,
      "body" : "Thanks for you reply. Well the problem comes from the fact that XJC2Task class does not support the jvmargs so i updated the gradle.build file.  Can you retry with the new solution please ?  otherwise can you share with me your gradle file please ?",
      "score" : 0,
      "owner" : {
        "account_id" : 22541690,
        "reputation" : 50,
        "user_id" : 16732181,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/c155f702ab88839498ab27c10cc5203f?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "azaLiza",
        "link" : "https://stackoverflow.com/users/16732181/azaliza"
      },
      "creation_date" : 1748858912,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140478829,
      "post_id" : 79648437,
      "body" : "adding everything except that line &quot;jvmargs: [&quot;-Dfile.encoding=UTF-8&quot;]&quot; didn&#39;t make any change, still unicode :(",
      "score" : 0,
      "owner" : {
        "account_id" : 33865827,
        "reputation" : 3,
        "user_id" : 30667311,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/06ab6adc80534ec07d1c45c1c8cae70a?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Roman Tataev",
        "link" : "https://stackoverflow.com/users/30667311/roman-tataev"
      },
      "creation_date" : 1748858705,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140478801,
      "post_id" : 79648437,
      "body" : "Execution failed for task &#39;:xjcGenerate&#39;. &gt; class com.sun.tools.xjc.XJC2Task doesn&#39;t support the &quot;jvmargs&quot; attribute.",
      "score" : 0,
      "owner" : {
        "account_id" : 33865827,
        "reputation" : 3,
        "user_id" : 30667311,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/06ab6adc80534ec07d1c45c1c8cae70a?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Roman Tataev",
        "link" : "https://stackoverflow.com/users/30667311/roman-tataev"
      },
      "creation_date" : 1748858152,
      "content_license" : "CC BY-SA 4.0"
    } ],
    "79648404" : [ {
      "comment_id" : 140484968,
      "post_id" : 79648404,
      "body" : "@RomanTataev Put those technical details into your Question, not Comments. I did so for you this time.",
      "score" : 0,
      "owner" : {
        "account_id" : 322981,
        "reputation" : 347089,
        "user_id" : 642706,
        "user_type" : "registered",
        "accept_rate" : 58,
        "profile_image" : "https://i.sstatic.net/ZWEI3.jpg?s=256",
        "display_name" : "Basil Bourque",
        "link" : "https://stackoverflow.com/users/642706/basil-bourque"
      },
      "creation_date" : 1748988240,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140478839,
      "post_id" : 79648404,
      "body" : "I&#39;ve checked files with Notepad++, .xsd file is UTF-8, .xml file is UTF-8-BOM",
      "score" : 0,
      "owner" : {
        "account_id" : 33865827,
        "reputation" : 3,
        "user_id" : 30667311,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/06ab6adc80534ec07d1c45c1c8cae70a?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Roman Tataev",
        "link" : "https://stackoverflow.com/users/30667311/roman-tataev"
      },
      "creation_date" : 1748858938,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140478793,
      "post_id" : 79648404,
      "body" : "tried that - still no improvements, sorry",
      "score" : 0,
      "owner" : {
        "account_id" : 33865827,
        "reputation" : 3,
        "user_id" : 30667311,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/06ab6adc80534ec07d1c45c1c8cae70a?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Roman Tataev",
        "link" : "https://stackoverflow.com/users/30667311/roman-tataev"
      },
      "creation_date" : 1748858028,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140478610,
      "post_id" : 79648404,
      "body" : "I&#39;ve updated my answer to ask a few more questions, and give another solution",
      "score" : 0,
      "owner" : {
        "account_id" : 1096470,
        "reputation" : 29424,
        "user_id" : 1089967,
        "user_type" : "registered",
        "accept_rate" : 59,
        "profile_image" : "https://www.gravatar.com/avatar/1f256b904ff621d678598d8fa49f86c5?s=256&d=identicon&r=PG",
        "display_name" : "lance-java",
        "link" : "https://stackoverflow.com/users/1089967/lance-java"
      },
      "creation_date" : 1748853693,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140478593,
      "post_id" : 79648404,
      "body" : "tried that, it didn&#39;t help, class still contains unicode",
      "score" : 0,
      "owner" : {
        "account_id" : 33865827,
        "reputation" : 3,
        "user_id" : 30667311,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/06ab6adc80534ec07d1c45c1c8cae70a?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Roman Tataev",
        "link" : "https://stackoverflow.com/users/30667311/roman-tataev"
      },
      "creation_date" : 1748853207,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140478578,
      "post_id" : 79648404,
      "body" : "yes windows, sorry i didn&#39;t mention that",
      "score" : 0,
      "owner" : {
        "account_id" : 33865827,
        "reputation" : 3,
        "user_id" : 30667311,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/06ab6adc80534ec07d1c45c1c8cae70a?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Roman Tataev",
        "link" : "https://stackoverflow.com/users/30667311/roman-tataev"
      },
      "creation_date" : 1748852947,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}