{
  "question" : {
    "question_id" : 79637767,
    "title" : "How do you force a Flux to pull or implement backpressure limits?",
    "body" : "<p>I'm attempting to open a file and reading lines through a Flux. I would then like <code>X</code> number of workers to process lines concurrently. Those workers may be slow and so I would like to prevent the ENTIRE file from being read into buffers and using up memory while waiting. The <code>Flux.parallel</code> seems to force push processing and I can't figure out how to slow down the reading of the file.</p>\n<p>Below is what I have so far.</p>\n<pre><code>Flux.using(() -&gt; Files.lines(path), Flux::fromStream, stream -&gt; {\n  System.out.println(&quot;Close&quot;);\n  stream.close();\n})\n.doOnNext(item -&gt; System.out.println(&quot;Read &quot; + item))\n.onBackpressureBuffer(3)\n.parallel()\n.runOn(Schedulers.newParallel(&quot;z&quot;, 2))\n.map(item -&gt; {\n  System.out.println(&quot;Process &quot; + item);\n  try { Thread.sleep(500); } catch (InterruptedException e) {}\n  return item;\n})\n.sequential()\n.publishOn(Schedulers.single())\n.map(item -&gt; {\n  System.out.println(&quot;Write &quot; + item);\n  return item;\n})\n.blockLast();\n</code></pre>\n",
    "tags" : [ "java", "project-reactor", "flux" ],
    "owner" : {
      "account_id" : 8757802,
      "reputation" : 533,
      "user_id" : 6548796,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/743a5ba24e42cbc634ff89352531cd08?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "CoryO",
      "link" : "https://stackoverflow.com/users/6548796/coryo"
    },
    "is_answered" : true,
    "view_count" : 67,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1748224991,
    "creation_date" : 1748184199,
    "link" : "https://stackoverflow.com/questions/79637767/how-do-you-force-a-flux-to-pull-or-implement-backpressure-limits",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79638227,
    "question_id" : 79637767,
    "body" : "<p>Looks like the solution is to set the <code>prefetch</code> values on the <code>parallel</code> and <code>runOn</code> methods.</p>\n<pre><code>Flux.using(() -&gt; Files.lines(path), Flux::fromStream, stream -&gt; {\n  System.out.println(&quot;Close&quot;);\n  stream.close();\n})\n.doOnNext(item -&gt; System.out.println(&quot;Read &quot; + item))\n.parallel(2, 4)\n.runOn(Schedulers.newParallel(&quot;z&quot;, 2), 1)\n.map(item -&gt; {\n  System.out.println(&quot;Process &quot; + item);\n  try { Thread.sleep(500); } catch (InterruptedException e) {}\n  return item;\n})\n.sequential()\n.publishOn(Schedulers.single())\n.map(item -&gt; {\n  System.out.println(&quot;Write &quot; + item);\n  return item;\n})\n.blockLast();\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 8757802,
      "reputation" : 533,
      "user_id" : 6548796,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/743a5ba24e42cbc634ff89352531cd08?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "CoryO",
      "link" : "https://stackoverflow.com/users/6548796/coryo"
    },
    "creation_date" : 1748224991,
    "last_activity_date" : 1748224991,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}