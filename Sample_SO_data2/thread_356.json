{
  "question" : {
    "question_id" : 79818977,
    "title" : "Spring boot GCP PostgresSQL",
    "body" : "<p>I've been trying to connect my spring boot service to Google cloud Postgres instance but facing an issue. I'm migrating a service from golang, that's using a connector to communicate with the database, to spring boot service. I am following <a href=\"https://github.com/GoogleCloudPlatform/cloud-sql-jdbc-socket-factory/blob/main/docs/jdbc.md\" rel=\"nofollow noreferrer\">this tutorial</a> provided by GCP github account</p>\n<p>pom</p>\n<pre class=\"lang-xml prettyprint-override\"><code>    &lt;dependencyManagement&gt;\n        &lt;dependencies&gt;\n            &lt;dependency&gt;\n                &lt;groupId&gt;com.google.cloud&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-cloud-gcp-dependencies&lt;/artifactId&gt;\n                &lt;version&gt;4.1.0&lt;/version&gt;\n                &lt;type&gt;pom&lt;/type&gt;\n                &lt;scope&gt;import&lt;/scope&gt;\n            &lt;/dependency&gt;\n        &lt;/dependencies&gt;\n    &lt;/dependencyManagement&gt;\n    &lt;dependencies&gt;\n    ... \n        &lt;!-- Database Driver --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.postgresql&lt;/groupId&gt;\n            &lt;artifactId&gt;postgresql&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.google.cloud&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-cloud-gcp-starter-sql-postgresql&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n</code></pre>\n<p>application.properties</p>\n<pre><code>spring.jpa.hibernate.ddl-auto=update\nspring.jpa.show-sql=true\nspring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect\nspring.sql.init.mode=always\n# GCP settings\ngcp.project=project_id\ngcp.project.region=project_region\ngcp.postgres.instance=postgres_instance_id\ngcp.postgres.database=database_name\n# PostgreSQL connection\nspring.cloud.gcp.project-id=${gcp.project}\nspring.cloud.gcp.sql.instance-connection-name=${gcp.project}:${gcp.project.region}:${gcp.postgres.instance}\nspring.cloud.gcp.sql.database-name=${gcp.postgres.database}\n\nspring.datasource.url=jdbc:postgresql:///${gcp.postgres.database}?cloudSqlInstance=${gcp.project}:${gcp.project.region}:${gcp.postgres.instance}&amp;socketFactory=com.google.cloud.sql.postgres.SocketFactory\nspring.datasource.username=db_user\nspring.datasource.password=db_pass\n</code></pre>\n<p>When I run my spring boot app from Intellij I always get:</p>\n<pre><code>2025-11-13T15:03:09.275+01:00  WARN 36220 --- [management] [           main] c.g.a.oauth2.DefaultCredentialsProvider  : Your application has authenticated using end user credentials from Google Cloud SDK. We recommend that most server applications use service accounts instead. If your application continues to use end user credentials from Cloud SDK, you might receive a &quot;quota exceeded&quot; or &quot;API not enabled&quot; error. For more information about service accounts, see https://cloud.google.com/docs/authentication/.\n\n2025-11-13T15:04:09.460+01:00  WARN 36220 --- [management] [           main] com.zaxxer.hikari.pool.PoolBase          : HikariPool-1 - Pool is empty, failed to create/setup connection (3ddfd9fb-cb9a-4533-9dfe-3fd0ded3b497)\n\norg.postgresql.util.PSQLException: The connection attempt failed.\n    at org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl(ConnectionFactoryImpl.java:385) ~[postgresql-42.7.8.jar:42.7.8]\n    at org.postgresql.core.ConnectionFactory.openConnection(ConnectionFactory.java:57) ~[postgresql-42.7.8.jar:42.7.8]\n    at org.postgresql.jdbc.PgConnection.&lt;init&gt;(PgConnection.java:279) ~[postgresql-42.7.8.jar:42.7.8]\n    at org.postgresql.Driver.makeConnection(Driver.java:448) ~[postgresql-42.7.8.jar:42.7.8]\n    at org.postgresql.Driver.connect(Driver.java:298) ~[postgresql-42.7.8.jar:42.7.8]\n    at com.zaxxer.hikari.util.DriverDataSource.getConnection(DriverDataSource.java:144) ~[HikariCP-6.3.3.jar:na]\n    at com.zaxxer.hikari.pool.PoolBase.newConnection(PoolBase.java:370) ~[HikariCP-6.3.3.jar:na]\n    at com.zaxxer.hikari.pool.PoolBase.newPoolEntry(PoolBase.java:207) ~[HikariCP-6.3.3.jar:na]\n    at com.zaxxer.hikari.pool.HikariPool.createPoolEntry(HikariPool.java:488) ~[HikariCP-6.3.3.jar:na]\n    at com.zaxxer.hikari.pool.HikariPool.checkFailFast(HikariPool.java:576) ~[HikariCP-6.3.3.jar:na]\n    at com.zaxxer.hikari.pool.HikariPool.&lt;init&gt;(HikariPool.java:97) ~[HikariCP-6.3.3.jar:na]\n    at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:111) ~[HikariCP-6.3.3.jar:na]\n... \n\nCaused by: java.net.SocketException: Connection reset\n</code></pre>\n<p>What am I doing wrong?</p>\n",
    "tags" : [ "java", "spring", "google-cloud-platform" ],
    "owner" : {
      "account_id" : 10273264,
      "reputation" : 2149,
      "user_id" : 7581022,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://i.sstatic.net/pA0KT.png?s=256",
      "display_name" : "Oussama Ben Ghorbel",
      "link" : "https://stackoverflow.com/users/7581022/oussama-ben-ghorbel"
    },
    "is_answered" : false,
    "view_count" : 56,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1763047475,
    "creation_date" : 1763043120,
    "link" : "https://stackoverflow.com/questions/79818977/spring-boot-gcp-postgressql",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140854156,
    "post_id" : 79818977,
    "body" : "another observation: your config use both spring.cloud.gcp.sql.* and spring.datasource.* - I guess you need to choose one, for example to start with shared example only (use only spring.datasource)",
    "score" : 0,
    "owner" : {
      "account_id" : 7821668,
      "reputation" : 21,
      "user_id" : 5914649,
      "user_type" : "registered",
      "profile_image" : "https://graph.facebook.com/1147849141932610/picture?type=large",
      "display_name" : "Ivan Viliamov",
      "link" : "https://stackoverflow.com/users/5914649/ivan-viliamov"
    },
    "creation_date" : 1763124509,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140854150,
    "post_id" : 79818977,
    "body" : "do you have the same service composition as it was for Go? i mean: you need to have VPC connection to sql (if it is a cloudrun) or may be your SQL instance have restrictions on subnet/ip level.  you need to clear isolated connection test from the node where you run your Spring app to SQL connection with proper creds <a href=\"https://docs.cloud.google.com/sql/docs/debugging-connectivity\" rel=\"nofollow noreferrer\">docs.cloud.google.com/sql/docs/debugging-connectivity</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 7821668,
      "reputation" : 21,
      "user_id" : 5914649,
      "user_type" : "registered",
      "profile_image" : "https://graph.facebook.com/1147849141932610/picture?type=large",
      "display_name" : "Ivan Viliamov",
      "link" : "https://stackoverflow.com/users/5914649/ivan-viliamov"
    },
    "creation_date" : 1763124390,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140852684,
    "post_id" : 79818977,
    "body" : "@M.Deinum done. PSQLException the connection attempt failed. I am confused because the same settings work for the golang service.",
    "score" : 0,
    "owner" : {
      "account_id" : 10273264,
      "reputation" : 2149,
      "user_id" : 7581022,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://i.sstatic.net/pA0KT.png?s=256",
      "display_name" : "Oussama Ben Ghorbel",
      "link" : "https://stackoverflow.com/users/7581022/oussama-ben-ghorbel"
    },
    "creation_date" : 1763047598,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140852641,
    "post_id" : 79818977,
    "body" : "Use <a href=\"https://stackoverflow.com/editing-help#code\">code format</a> for logs, not quote format. Quote is for human text, not logs and other pre formatted text. Quote breaks the existing format of the log, makes it very hard to read and gets in the way of trying to copy text for investigation.",
    "score" : 0,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1763046371,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140852563,
    "post_id" : 79818977,
    "body" : "Please don&#39;t use quotes to format a stacktrace, use code tags that way it remains readable. Judging from what I can decipher is you get a connection reset, which generally is a routing/fw issues.",
    "score" : 1,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1763043881,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140852561,
    "post_id" : 79818977,
    "body" : "according to the logs you posted, you don&#39;t have actual errors, only warnings. Did you read the warnings you got?",
    "score" : 0,
    "owner" : {
      "account_id" : 3116234,
      "reputation" : 9469,
      "user_id" : 2636929,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/85fa83a02c04af43fcd224821ca9b750?s=256&d=identicon&r=PG",
      "display_name" : "Stultuske",
      "link" : "https://stackoverflow.com/users/2636929/stultuske"
    },
    "creation_date" : 1763043794,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}