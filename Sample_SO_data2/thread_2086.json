{
  "question" : {
    "question_id" : 79652904,
    "title" : "Native Memory Tracking GC stats",
    "body" : "<p>We have a java app that runs on <code>openjdk version &quot;11.0.18&quot; 2023-01-17 LTS</code> and it started swapping for a few weeks.</p>\n<p>When running <code>jcmd &lt;PID&gt; VM.native_memory</code>, we get something like this:</p>\n<pre><code> Java Heap (reserved=22528MB, committed=22528MB)\n ....\n GC (reserved=4253MB, committed=4253MB)\n</code></pre>\n<p>which shows that the heap is around <code>23GB</code> and the GC data is around <code>4.2GB</code>.</p>\n<hr />\n<p>This is why we think the app started to swap, because GC needs more memory and swap is the only place to get it, under our current settings (no more RAM, but swap is available).</p>\n<p>This looks suspicious as we have not seen the app swapping for at least 2 years in production. We are inclined to believe that heap allocation patterns have changed recently and GC needs more memory, mainly because:</p>\n<p><code>top</code> reveals an <code>RSS size that ~= 'Java Heap' + 'GC'</code> (as seen in the NMT)</p>\n<hr />\n<p>The first miss-understanding that I have, is that I thought that if I run : <code>jcmd &lt;PID&gt; VM.native_memory detail</code>, then search entries like :</p>\n<pre><code>reserved and committed 1MB for GC from\n</code></pre>\n<p>and count all the <code>MB</code>, I would get the value as seen in the <code>GC (reserved=4253MB, committed=4253MB)</code>, but that is not the case.</p>\n<hr />\n<p>The second question I have is how do I see what is GC actually taking space for? I assume its <code>Remembered Sets</code>, because our <code>Eden Space</code> is at an average of <code>500MB</code> (with a pause of <code>MaxGCPauseMillis=100</code>), which in theory would mean that Remembered Sets should be big. If that is the case, I could increase the <code>MaxGCPauseMillis=200</code> in hopes that the remembered sets would go down. From what i have read, the only way to get the size of that would be to enabled:</p>\n<pre><code>G1SummarizeRSetStatsPeriod=...\n</code></pre>\n<p>and</p>\n<pre><code>gc+remset=debug\n</code></pre>\n<p>is there any other way?</p>\n",
    "tags" : [ "java", "jvm", "garbage-collection", "g1gc" ],
    "owner" : {
      "account_id" : 1056871,
      "reputation" : 121845,
      "user_id" : 1059372,
      "user_type" : "registered",
      "accept_rate" : 97,
      "profile_image" : "https://i.sstatic.net/W6OMC.png?s=256",
      "display_name" : "Eugene",
      "link" : "https://stackoverflow.com/users/1059372/eugene"
    },
    "is_answered" : false,
    "view_count" : 53,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1749044728,
    "creation_date" : 1749044728,
    "link" : "https://stackoverflow.com/questions/79652904/native-memory-tracking-gc-stats",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}