{
  "question" : {
    "question_id" : 79705567,
    "title" : "Spring WebFlux caching with Caffeine",
    "body" : "<p>I am having trouble understanding how to cache Reactive streams using the spring-data-starter-cache library. From tutorials such as <a href=\"https://www.baeldung.com/spring-webflux-cacheable\" rel=\"nofollow noreferrer\">https://www.baeldung.com/spring-webflux-cacheable</a>, I see that they make use of either <code>Mono.cache</code> or <code>Caffine.newBuilder</code> to instantiate some type of Map-like cache object that needs to be managed. Seems like the issue stems from <code>@Cacheable</code> only caching the wrapper and not the actual results itself</p>\n<pre><code>// application.yml\nspring:\n  cache:\n    type: caffeine\n    caffeine:\n      spec: maximumSize=1000,expireAfterAccess=3600s\n\n\n// Code logic\n@Cacheable(value = &quot;stuff&quot;)\npublic Mono&lt;String&gt; getInfo(int id) {\n    return infoProvider.getInfo(id);\n}\n</code></pre>\n<p>What do I need to do to fix this to cache the value emitted by the <code>Mono</code>?</p>\n<p>My inital thought is that it could just be a matter of using return <code>infoProvider.getInfo(id).cache();</code> with some duration, but I was told that this would not work. Why not?</p>\n",
    "tags" : [ "java", "spring-boot", "caching", "spring-webflux", "reactive-programming" ],
    "owner" : {
      "account_id" : 2177275,
      "reputation" : 1227,
      "user_id" : 1927638,
      "user_type" : "registered",
      "accept_rate" : 50,
      "profile_image" : "https://www.gravatar.com/avatar/d3e829ec9e4b689837b878e923f23254?s=256&d=identicon&r=PG",
      "display_name" : "user1927638",
      "link" : "https://stackoverflow.com/users/1927638/user1927638"
    },
    "is_answered" : true,
    "view_count" : 211,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1752838680,
    "creation_date" : 1752801748,
    "link" : "https://stackoverflow.com/questions/79705567/spring-webflux-caching-with-caffeine",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79706100,
    "question_id" : 79705567,
    "body" : "<p>I believe you'll need to build a custom cache using <code>buildAsync</code>.</p>\n<p><strong>Example config</strong></p>\n<p>Please note that I'm using <code>expireAfterWrite</code> because <code>expireAfterAccess</code> resets the expiration timer every time the entry is accessed, which is not very efficient.</p>\n<pre><code>import com.github.benmanes.caffeine.cache.Caffeine;\nimport org.springframework.cache.CacheManager;\nimport org.springframework.cache.caffeine.CaffeineCacheManager;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport java.util.concurrent.TimeUnit;\n\n@Configuration(proxyBeanMethods = false)\npublic class CacheConfig {\n\n    @Bean\n    public CacheManager cacheManager() {\n        var cacheManager = new CaffeineCacheManager();\n\n        cacheManager.registerCustomCache(&quot;stuff&quot;,\n                Caffeine.newBuilder()\n                        .expireAfterWrite(1, TimeUnit.HOURS)\n                        .maximumSize(1000)\n                        .buildAsync()); // Note: buildAsync\n\n        return cacheManager;\n    }\n}\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 19255478,
      "reputation" : 11544,
      "user_id" : 14072498,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/a55d298fc2cb250243c15bd619f95613?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Roar S.",
      "link" : "https://stackoverflow.com/users/14072498/roar-s"
    },
    "creation_date" : 1752837849,
    "last_activity_date" : 1752838680,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}