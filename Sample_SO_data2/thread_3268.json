{
  "question" : {
    "question_id" : 79562889,
    "title" : "Update from Tomcat 8.5 to 9: different caching behaviour",
    "body" : "<p>I have a web-application, which displays some 3D objects. The 3D objects are static files in a TomCat subdirectory. The app is based on Java 8 and JavaScript. If it runs under TomCat 8.5 everything works well for every web-browser. Using TomCat 9.0 it does not display the objects. I figured out so far, that it seems to be a caching problem: when I switch off caching in the developer modes of Edge or Chrome everything loads perfectly again.</p>\n<p>My question is, how can I switch off caching in TomCat 9?</p>\n<p>I have already tried some ideas which I found in the forum, like:</p>\n<ol>\n<li>adding the Cache-Control, Pragma and Expires meta tags to the head-section in html</li>\n<li>adding a TOMCATROUTE/conf/context.xml file with &lt; Context&gt;&lt; Resources antiResourceLocking=&quot;false&quot; cachingAllowed=&quot;false&quot;/&gt;&lt; /Context&gt;</li>\n<li>use the context.xml file below in conf/Catalina/localhost (the files not to be cached are situated in c:\\xxx\\service and are invoked by TOMCATINVOKE/service/... )</li>\n</ol>\n<p>but neither worked. Any ideas?</p>\n<p>Thank you.</p>\n<pre><code>&lt;Context&gt;\n  &lt;Resources&gt;\n    &lt;PreResources className=&quot;org.apache.catalina.webresources.DirResourceSet&quot;\n                  base=&quot;C:\\xxx\\service&quot;\n                  webAppMount=&quot;/service&quot; /&gt;\n  &lt;/Resources&gt;\n&lt;/Context&gt;\n</code></pre>\n<p>PS: The most weired thing is, that is works fine with FireFox, but not in Edge or Chrome (except I change to developer mode and switch off caching).</p>\n",
    "tags" : [ "javascript", "java", "html", "tomcat", "caching" ],
    "owner" : {
      "account_id" : 5949342,
      "reputation" : 33,
      "user_id" : 4677898,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/N32uW.gif?s=256",
      "display_name" : "RoR",
      "link" : "https://stackoverflow.com/users/4677898/ror"
    },
    "is_answered" : true,
    "view_count" : 70,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1744149223,
    "creation_date" : 1744140014,
    "link" : "https://stackoverflow.com/questions/79562889/update-from-tomcat-8-5-to-9-different-caching-behaviour",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79563038,
    "question_id" : 79562889,
    "body" : "<p>You can use a simple servlet filter to disable caching for app resources,\nbelow is a simple servlet filter</p>\n<pre><code>package com.yourapp.filters;\n\nimport javax.servlet.*;\nimport javax.servlet.http.HttpServletResponse;\nimport java.io.IOException;\n\npublic class NoCacheFilter implements Filter {\n\n    @Override\n    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)\n            throws IOException, ServletException {\n\n        HttpServletResponse httpRes = (HttpServletResponse) response;\n\n        httpRes.setHeader(&quot;Cache-Control&quot;, &quot;no-store, no-cache, must-revalidate, proxy-revalidate&quot;);\n        httpRes.setHeader(&quot;Pragma&quot;, &quot;no-cache&quot;);\n        httpRes.setDateHeader(&quot;Expires&quot;, 0);\n\n        chain.doFilter(request, response);\n    }\n}\n</code></pre>\n<p>Register in web.xml</p>\n<pre><code>&lt;filter&gt;\n    &lt;filter-name&gt;NoCacheFilter&lt;/filter-name&gt;\n    &lt;filter-class&gt;com.yourapp.filters.NoCacheFilter&lt;/filter-class&gt;\n&lt;/filter&gt;\n\n&lt;filter-mapping&gt;\n    &lt;filter-name&gt;NoCacheFilter&lt;/filter-name&gt;\n    &lt;url-pattern&gt;/service/*&lt;/url-pattern&gt;\n&lt;/filter-mapping&gt;\n</code></pre>\n<p>Place your 3D files under:</p>\n<pre><code>&lt;your-webapp-root&gt;/webapp/service/\n</code></pre>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 7645025,
      "reputation" : 440,
      "user_id" : 5795975,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-6KwPUS4RnyA/AAAAAAAAAAI/AAAAAAAAC8w/auZqreI45x0/s256-rj/photo.jpg",
      "display_name" : "Vijay",
      "link" : "https://stackoverflow.com/users/5795975/vijay"
    },
    "creation_date" : 1744145624,
    "last_activity_date" : 1744149223,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140313429,
    "post_id" : 79562889,
    "body" : "Let us <a href=\"https://chat.stackoverflow.com/rooms/259385/discussion-between-vijay-and-ror\">continue this discussion in chat</a>.",
    "score" : 0,
    "owner" : {
      "account_id" : 7645025,
      "reputation" : 440,
      "user_id" : 5795975,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-6KwPUS4RnyA/AAAAAAAAAAI/AAAAAAAAC8w/auZqreI45x0/s256-rj/photo.jpg",
      "display_name" : "Vijay",
      "link" : "https://stackoverflow.com/users/5795975/vijay"
    },
    "creation_date" : 1744142417,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140313426,
    "post_id" : 79562889,
    "body" : "I think It is available in newer version of tomcat, In your case, If you can move the static files into webapp/service/, you can use a simple Filter to set cache headers.",
    "score" : 0,
    "owner" : {
      "account_id" : 7645025,
      "reputation" : 440,
      "user_id" : 5795975,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-6KwPUS4RnyA/AAAAAAAAAAI/AAAAAAAAC8w/auZqreI45x0/s256-rj/photo.jpg",
      "display_name" : "Vijay",
      "link" : "https://stackoverflow.com/users/5795975/vijay"
    },
    "creation_date" : 1744142322,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140313411,
    "post_id" : 79562889,
    "body" : "@Vijay; thank you, but I edited this file now and it displays an error:  java.lang.ClassNotFoundException: org.apache.catalina.valves.ResponseHeaderValve  Seems not to be available in TomCat 9 ?",
    "score" : 0,
    "owner" : {
      "account_id" : 5949342,
      "reputation" : 33,
      "user_id" : 4677898,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/N32uW.gif?s=256",
      "display_name" : "RoR",
      "link" : "https://stackoverflow.com/users/4677898/ror"
    },
    "creation_date" : 1744142036,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140313405,
    "post_id" : 79562889,
    "body" : "its for your app.xml, this will apply headers to your app. If you want to add headers to all apps deployed in tomcat, config shoudl go to context.xml, you may need to omit &quot;Resources&quot; for global config.",
    "score" : 0,
    "owner" : {
      "account_id" : 7645025,
      "reputation" : 440,
      "user_id" : 5795975,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-6KwPUS4RnyA/AAAAAAAAAAI/AAAAAAAAC8w/auZqreI45x0/s256-rj/photo.jpg",
      "display_name" : "Vijay",
      "link" : "https://stackoverflow.com/users/5795975/vijay"
    },
    "creation_date" : 1744141934,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140313385,
    "post_id" : 79562889,
    "body" : "@Vijay: do you mean in the app.xml file?",
    "score" : 0,
    "owner" : {
      "account_id" : 5949342,
      "reputation" : 33,
      "user_id" : 4677898,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/N32uW.gif?s=256",
      "display_name" : "RoR",
      "link" : "https://stackoverflow.com/users/4677898/ror"
    },
    "creation_date" : 1744141620,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140313379,
    "post_id" : 79562889,
    "body" : "Correction: the file in 3. is called &quot;app.xml&quot;, where &quot;app&quot; is the name of the TomCat-application.",
    "score" : 0,
    "owner" : {
      "account_id" : 5949342,
      "reputation" : 33,
      "user_id" : 4677898,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/N32uW.gif?s=256",
      "display_name" : "RoR",
      "link" : "https://stackoverflow.com/users/4677898/ror"
    },
    "creation_date" : 1744141518,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140313366,
    "post_id" : 79562889,
    "body" : "Can you try adding &quot;ResponseHeaderValve&quot; to your context like below.  &lt;Context&gt;   &lt;Valve className=&quot;org.apache.catalina.valves.ResponseHeaderValve&quot;&gt;     &lt;Header name=&quot;Cache-Control&quot; value=&quot;no-cache, no-store, must-revalidate&quot; /&gt;     &lt;Header name=&quot;Pragma&quot; value=&quot;no-cache&quot; /&gt;     &lt;Header name=&quot;Expires&quot; value=&quot;0&quot; /&gt;   &lt;/Valve&gt;    &lt;Resources&gt;     &lt;PreResources className=&quot;org.apache.catalina.webresources.DirResourceSet&quot;                   base=&quot;C:\\xxx\\service&quot;                   webAppMount=&quot;/service&quot; /&gt;   &lt;/Resources&gt; &lt;/Context&gt;",
    "score" : 0,
    "owner" : {
      "account_id" : 7645025,
      "reputation" : 440,
      "user_id" : 5795975,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-6KwPUS4RnyA/AAAAAAAAAAI/AAAAAAAAC8w/auZqreI45x0/s256-rj/photo.jpg",
      "display_name" : "Vijay",
      "link" : "https://stackoverflow.com/users/5795975/vijay"
    },
    "creation_date" : 1744141297,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79563038" : [ {
      "comment_id" : 140313585,
      "post_id" : 79563038,
      "body" : "Many thanks for the great solution, which worked perfectly for me!",
      "score" : 1,
      "owner" : {
        "account_id" : 5949342,
        "reputation" : 33,
        "user_id" : 4677898,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/N32uW.gif?s=256",
        "display_name" : "RoR",
        "link" : "https://stackoverflow.com/users/4677898/ror"
      },
      "creation_date" : 1744145751,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}