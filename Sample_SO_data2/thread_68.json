{
  "question" : {
    "question_id" : 79841620,
    "title" : "Java SNMP Simulator is running fine but SNMPGet/SNMPWalk giving timeout error",
    "body" : "<p>Following is the Java Code for SNMP Simulator:</p>\n<pre><code>package org.example;\nimport org.snmp4j.*;\nimport org.snmp4j.agent.*;\nimport org.snmp4j.agent.mo.*;\nimport org.snmp4j.agent.mo.snmp.*;\nimport org.snmp4j.agent.security.MutableVACM;\nimport org.snmp4j.mp.*;\nimport org.snmp4j.security.*;\nimport org.snmp4j.smi.*;\nimport org.snmp4j.transport.DefaultUdpTransportMapping;\n\nimport java.io.*;\nimport java.nio.charset.StandardCharsets;\nimport java.util.*;\nimport java.util.concurrent.Executors;\nimport java.util.concurrent.ScheduledExecutorService;\nimport java.util.concurrent.TimeUnit;\n\npublic class CsvSnmpSimulator2 extends BaseAgent {\n\n    private TransportMapping&lt;UdpAddress&gt; transport;\n    private final ScheduledExecutorService scheduler = Executors.newScheduledThreadPool(1);\n\n    private final String csvPath;\n    private final int listenPort;\n    private final String v2cCommunity;\n    private final String v3User;\n    private final String v3AuthPass;\n    private final String v3PrivPass;\n    private final MOFactory moFactory;\n\n    public CsvSnmpSimulator2(File bootCounterFile,\n                             File configFile,\n                             String csvPath,\n                             int listenPort,\n                             String v2cCommunity,\n                             String v3User,\n                             String v3AuthPass,\n                             String v3PrivPass) throws Exception {\n        super(bootCounterFile, configFile,\n                new CommandProcessor(new OctetString(MPv3.createLocalEngineID()))\n        );\n\n        this.csvPath = csvPath;\n        this.listenPort = listenPort;\n        this.v2cCommunity = v2cCommunity;\n        this.v3User = v3User;\n        this.v3AuthPass = v3AuthPass;\n        this.v3PrivPass = v3PrivPass;\n        this.moFactory = DefaultMOFactory.getInstance();\n    }\n\n    // ---------------- BaseAgent hooks ----------------\n\n    @Override\n    protected void initTransportMappings() throws IOException {\n        // IMPORTANT: do NOT call transport.listen() here. BaseAgent will call listen/startup.\n        transport = new DefaultUdpTransportMapping(new UdpAddress(&quot;0.0.0.0/&quot; + listenPort));\n        transportMappings = new TransportMapping[]{ transport };\n    }\n\n    @Override\n    protected void addCommunities(SnmpCommunityMIB communityMIB) {\n        // SNMP-COMMUNITY-MIB columns order:\n        // communityName, securityName, contextEngineID, contextName, transportTag, storageType, rowStatus\n        Variable[] vars = new Variable[]{\n                new OctetString(v2cCommunity),                      // communityName\n                new OctetString(v2cCommunity),                      // securityName (map community to same secName)\n                getAgent().getContextEngineID(),                    // contextEngineID\n                new OctetString(),                                  // contextName (default context)\n                new OctetString(),                                  // transportTag\n                new Integer32(StorageType.nonVolatile),             // storageType\n                new Integer32(RowStatus.active)                     // rowStatus (active)\n        };\n\n        SnmpCommunityMIB.SnmpCommunityEntryRow row =\n                communityMIB.getSnmpCommunityEntry()\n                        .createRow(new OctetString(v2cCommunity).toSubIndex(true), vars);\n        communityMIB.getSnmpCommunityEntry().addRow(row);\n    }\n\n    @Override\n    protected void addUsmUser(USM usm) {\n        // Register protocols FIRST before USM user creation\n        SecurityProtocols.getInstance().addPrivacyProtocol(new PrivAES128());\n        SecurityProtocols.getInstance().addAuthenticationProtocol(new AuthSHA());\n\n        // Now create/add v3 user\n        UsmUser user = new UsmUser(\n                new OctetString(v3User),\n                AuthSHA.ID, new OctetString(v3AuthPass),\n                PrivAES128.ID, new OctetString(v3PrivPass));\n        usm.addUser(user.getSecurityName(), null, user);\n    }\n\n    @Override\n    protected void addViews(VacmMIB vacm) {\n        // Allow read/write/notify for subtree 1.3 for demo\n        OctetString group = new OctetString(&quot;v3group&quot;);\n        vacm.addGroup(SecurityModel.SECURITY_MODEL_USM, new OctetString(v3User), group, StorageType.nonVolatile);\n\n        // Use default (empty) context consistently via new OctetString()\n        vacm.addAccess(group, new OctetString(), SecurityModel.SECURITY_MODEL_USM,\n                SecurityLevel.AUTH_PRIV, MutableVACM.VACM_MATCH_EXACT,\n                new OctetString(&quot;readView&quot;), new OctetString(&quot;writeView&quot;), new OctetString(&quot;notifyView&quot;),\n                StorageType.nonVolatile);\n\n        OID subtree = new OID(&quot;1.3&quot;);\n        vacm.addViewTreeFamily(new OctetString(&quot;readView&quot;), subtree, new OctetString(),\n                VacmMIB.vacmViewIncluded, StorageType.nonVolatile);\n        vacm.addViewTreeFamily(new OctetString(&quot;writeView&quot;), subtree, new OctetString(),\n                VacmMIB.vacmViewIncluded, StorageType.nonVolatile);\n        vacm.addViewTreeFamily(new OctetString(&quot;notifyView&quot;), subtree, new OctetString(),\n                VacmMIB.vacmViewIncluded, StorageType.nonVolatile);\n    }\n\n    @Override\n    protected void registerManagedObjects() {\n        List&lt;Row&gt; rows = loadCsv(csvPath);\n        if (rows.isEmpty()) {\n            System.err.println(&quot;No rows loaded from &quot; + csvPath);\n            return;\n        }\n\n        // Ensure contexts exist (use new OctetString() for default context)\n        Set&lt;OctetString&gt; contexts = new HashSet&lt;&gt;();\n        for (Row r : rows) {\n            OctetString ctx = r.context == null || r.context.isEmpty() ? new OctetString() : new OctetString(r.context);\n            if (!contexts.contains(ctx)) {\n                contexts.add(ctx);\n                server.addContext(ctx);\n            }\n        }\n\n        for (Row r : rows) {\n            try {\n                OID oid = new OID(r.oid);\n                Variable initial = toVariable(r.type, r.value);\n                boolean writable = &quot;RW&quot;.equalsIgnoreCase(r.access);\n\n                MOAccess access = writable ? MOAccessImpl.ACCESS_READ_WRITE : MOAccessImpl.ACCESS_READ_ONLY;\n\n                @SuppressWarnings(&quot;unchecked&quot;)\n                MOScalar&lt;Variable&gt; scalar = new MOScalar&lt;&gt;(oid, access, initial) {\n                    @Override\n                    public synchronized Variable getValue() {\n                        Variable v = super.getValue();\n                        System.out.println(&quot;[GET] OID &quot; + oid + &quot; requested â†’ returning: &quot; + v);\n                        return v;\n                    }\n                };\n\n                OctetString ctx = r.context == null || r.context.isEmpty() ? new OctetString() : new OctetString(r.context);\n                server.register(scalar, ctx);\n\n                // Optional: auto-behavior for TimeTicks\n                if (r.type.equalsIgnoreCase(&quot;TIME_TICKS&quot;) || r.type.equalsIgnoreCase(&quot;TIMETICKS&quot;)) {\n                    scheduler.scheduleAtFixedRate(() -&gt; {\n                        try {\n                            Variable v = scalar.getValue();\n                            if (v instanceof TimeTicks) {\n                                TimeTicks t = (TimeTicks) v;\n                                scalar.setValue(new TimeTicks(t.getValue() + 100)); // increment by 1 second (100 hundredths)\n                            }\n                        } catch (Exception ignored) {}\n                    }, 1, 1, TimeUnit.SECONDS);\n                }\n\n            } catch (Exception ex) {\n                System.err.println(&quot;Failed to register OID &quot; + r + &quot; : &quot; + ex.getMessage());\n            }\n        }\n    }\n\n    @Override\n    protected void unregisterManagedObjects() {\n        // no-op\n    }\n\n    @Override\n    protected void addNotificationTargets(SnmpTargetMIB targetMIB, SnmpNotificationMIB notificationMIB) {\n        // noop\n    }\n\n    // ---------------- Utility: CSV parsing &amp; type coercion ----------------\n\n    private static class Row {\n        String oid;\n        String type;\n        String value;\n        String context; // optional\n        String access;  // RO/RW\n        @Override public String toString() { return oid + &quot;,&quot; + type + &quot;,&quot; + value + &quot;,&quot; + context + &quot;,&quot; + access; }\n    }\n\n    private static List&lt;Row&gt; loadCsv(String path) {\n        List&lt;Row&gt; rows = new ArrayList&lt;&gt;();\n        try (BufferedReader br = new BufferedReader(new InputStreamReader(new FileInputStream(path), StandardCharsets.UTF_8))) {\n            String line;\n            while ((line = br.readLine()) != null) {\n                line = line.trim();\n                if (line.isEmpty() || line.startsWith(&quot;#&quot;)) continue;\n                String[] parts = splitCsv(line);\n                if (parts.length &lt; 3) {\n                    System.err.println(&quot;Skipping malformed line: &quot; + line);\n                    continue;\n                }\n                Row r = new Row();\n                r.oid = parts[0].trim();\n                r.type = parts[1].trim();\n                r.value = parts[2].trim();\n                if (parts.length &gt;= 4) r.context = parts[3].trim();\n                if (parts.length &gt;= 5) r.access = parts[4].trim();\n                rows.add(r);\n            }\n        } catch (IOException e) {\n            System.err.println(&quot;Error reading CSV &quot; + path + &quot;: &quot; + e.getMessage());\n        }\n        return rows;\n    }\n\n    private static String[] splitCsv(String line) {\n        List&lt;String&gt; tokens = new ArrayList&lt;&gt;();\n        boolean inQuote = false;\n        StringBuilder sb = new StringBuilder();\n        for (int i = 0; i &lt; line.length(); i++) {\n            char c = line.charAt(i);\n            if (c == '&quot;') {\n                inQuote = !inQuote;\n            } else if (c == ',' &amp;&amp; !inQuote) {\n                tokens.add(sb.toString());\n                sb.setLength(0);\n            } else {\n                sb.append(c);\n            }\n        }\n        tokens.add(sb.toString());\n        return tokens.toArray(new String[0]);\n    }\n\n    private static Variable toVariable(String type, String value) {\n        String t = type.trim().toUpperCase(Locale.ROOT);\n        switch (t) {\n            case &quot;INTEGER&quot;: return new Integer32(Integer.parseInt(value));\n            case &quot;OCTET_STRING&quot;: return new OctetString(value);\n            case &quot;OID&quot;: return new OID(value);\n            case &quot;COUNTER32&quot;: return new Counter32(Long.parseLong(value));\n            case &quot;GAUGE32&quot;: return new Gauge32(Long.parseLong(value));\n            case &quot;TIMETICKS&quot;:\n            case &quot;TIME_TICKS&quot;: return new TimeTicks(Long.parseLong(value));\n            case &quot;IPADDRESS&quot;: return new IpAddress(value);\n            case &quot;COUNTER64&quot;: return new Counter64(Long.parseLong(value));\n            case &quot;NULL&quot;: return Null.noSuchObject;\n            default:\n                throw new IllegalArgumentException(&quot;Unsupported type: &quot; + type);\n        }\n    }\n\n    // ---------------- Main ----------------\n\n    public static void main(String[] args) throws Exception {\n        String csv = args.length &gt; 0 ? args[0] : &quot;data.csv&quot;;\n        int port = args.length &gt; 1 ? Integer.parseInt(args[1]) : 10161;\n        String community = args.length &gt; 2 ? args[2] : &quot;public&quot;;\n        String user = args.length &gt; 3 ? args[3] : &quot;usr-sha-aes&quot;;\n        String auth = args.length &gt; 4 ? args[4] : &quot;authpass123&quot;;\n        String priv = args.length &gt; 5 ? args[5] : &quot;privpass123&quot;;\n\n        File boot = new File(&quot;bootCounter.dat&quot;);\n        File cfg = new File(&quot;simulator.cfg&quot;);\n\n        CsvSnmpSimulator2 sim = new CsvSnmpSimulator2(boot, cfg, csv, port, community, user, auth, priv);\n        sim.init();\n        sim.addShutdownHook();\n        // contexts are created from CSV; don't add duplicate default context here\n        sim.run();\n\n        System.out.printf(&quot;SNMP simulator listening on UDP/%d (v1/v2c/v3). Data: %s%n&quot;, port, csv);\n        System.out.println(&quot;v2c community: &quot; + community + &quot; | v3 user: &quot; + user);\n    }\n}\n</code></pre>\n<p>Following is the data.csv:</p>\n<pre><code># OID,Type,Value,Context,Access\n1.3.6.1.2.1.1.1.0,OCTET_STRING,Simulated Router R9000,default,read-only\n1.3.6.1.2.1.1.3.0,TIME_TICKS,123456,default,read-only\n1.3.6.1.2.1.1.4.0,OCTET_STRING,admin@example.com,default,read-write\n1.3.6.1.2.1.1.5.0,OCTET_STRING,TestDevice01,default,read-only\n1.3.6.1.2.1.1.6.0,OCTET_STRING,Lab Environment,default,read-write\n1.3.6.1.2.1.2.2.1.1.1,INTEGER,1,default,read-only\n1.3.6.1.2.1.2.2.1.2.1,OCTET_STRING,eth0,default,read-only\n1.3.6.1.2.1.2.2.1.8.1,INTEGER,1,default,read-write\n</code></pre>\n<p>The above program running well but below command giving time out response:</p>\n<blockquote>\n<p>snmpget -v2c -c public localhost:10161 1.3.6.1.2.1.1.1.0</p>\n</blockquote>\n<p>The error is:</p>\n<blockquote>\n<p>Timeout: No Response from localhost:10161.</p>\n</blockquote>\n<p>Could you please let me know what exact mistake I am doing here.</p>\n",
    "tags" : [ "java", "snmp", "simulator", "net-snmp" ],
    "owner" : {
      "account_id" : 10041916,
      "reputation" : 95,
      "user_id" : 7424466,
      "user_type" : "registered",
      "accept_rate" : 57,
      "profile_image" : "https://lh3.googleusercontent.com/--vi8FTCtvEM/AAAAAAAAAAI/AAAAAAAAHdA/-BXgc3I65fQ/s256-rj/photo.jpg",
      "display_name" : "Jagadeesh Musham",
      "link" : "https://stackoverflow.com/users/7424466/jagadeesh-musham"
    },
    "is_answered" : false,
    "view_count" : 33,
    "closed_date" : 1765297896,
    "answer_count" : 0,
    "score" : -1,
    "last_activity_date" : 1765265276,
    "creation_date" : 1765265276,
    "link" : "https://stackoverflow.com/questions/79841620/java-snmp-simulator-is-running-fine-but-snmpget-snmpwalk-giving-timeout-error",
    "closed_reason" : "Not suitable for this site"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140894259,
    "post_id" : 79841620,
    "body" : "Thank you for your response. However, the provided code appears to be more of a basic template and does not contain much logic. What I specifically need to understand is why the SNMPGet command is returning a Timeout message, even though the simulator has the data available. It seems that the request is not actually reaching the simulator, and I would like clarification on this point.",
    "score" : 0,
    "owner" : {
      "account_id" : 10041916,
      "reputation" : 95,
      "user_id" : 7424466,
      "user_type" : "registered",
      "accept_rate" : 57,
      "profile_image" : "https://lh3.googleusercontent.com/--vi8FTCtvEM/AAAAAAAAAAI/AAAAAAAAHdA/-BXgc3I65fQ/s256-rj/photo.jpg",
      "display_name" : "Jagadeesh Musham",
      "link" : "https://stackoverflow.com/users/7424466/jagadeesh-musham"
    },
    "creation_date" : 1765284341,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140893780,
    "post_id" : 79841620,
    "body" : "There&#39;s a significant amount of code here. What have you done to narrow down the problem so that you can post only a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>? Please see <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a>",
    "score" : 2,
    "owner" : {
      "account_id" : 2095810,
      "reputation" : 5436,
      "user_id" : 14853083,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/tiedu.png?s=256",
      "display_name" : "Tangentially Perpendicular",
      "link" : "https://stackoverflow.com/users/14853083/tangentially-perpendicular"
    },
    "creation_date" : 1765265548,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}