{
  "question" : {
    "question_id" : 79826514,
    "title" : "Spring Security 3.1.4 requestmatchers with Pathvariable",
    "body" : "<p>I have an unclear situation. I'm using a controller with any endpoints. I have a two methods with Get endpoints /short and /{idOrCode}. Pathvariable is a String type. Endpoint with this pathvariable is have permitAll() configuration at securityFilterChain. According to the documentation these endpoints are different for Authorization. However when I call /short endpoint without authorization I get data from it.\nSpring Security config:</p>\n<pre><code>   @Bean\n    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n        http\n                .csrf(AbstractHttpConfigurer::disable)\n                .cors(Customizer.withDefaults())\n                .authorizeHttpRequests(auth -&gt;\n                        auth.requestMatchers(&quot;/api/v1/auth/authenticate&quot;,\n                                        &quot;/actuator/**&quot;,\n                                        &quot;/api/v1/service-point/{idOrCode}&quot;,\n                                        &quot;/api/v1/service-point/parent/{servicePointId}&quot;)\n                                .permitAll()\n                                .requestMatchers(AUTH_WHITELIST)\n                                .permitAll()\n                                .requestMatchers(&quot;/api/v1/auth/change/admindata&quot;).hasRole(RoleEnum.BURNS.name())\n                                .requestMatchers(&quot;/api/v1/auth/register&quot;).hasRole(RoleEnum.ADMIN.name())\n                                .requestMatchers(&quot;/api/v1/auth/change/password&quot;)\n                                .hasAnyRole(RoleEnum.ADMIN.name())\n                                .requestMatchers(HttpMethod.POST).hasRole(RoleEnum.ADMIN.name())\n                                .requestMatchers(HttpMethod.DELETE).hasRole(RoleEnum.ADMIN.name())\n                                .requestMatchers(HttpMethod.PUT).hasRole(RoleEnum.ADMIN.name())\n                                .requestMatchers(HttpMethod.PATCH).hasRole(RoleEnum.ADMIN.name())\n                                .anyRequest()\n                                .authenticated())\n                .sessionManagement(ssmng -&gt; ssmng.sessionCreationPolicy(SessionCreationPolicy.STATELESS))\n                .authenticationProvider(authProvider)\n                .addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);\n\n        return http.build();\n    }\n</code></pre>\n<p>and the JWTFilter checks for the absence of jwt and sends it further down the chain:</p>\n<pre><code>@Override\n    protected void doFilterInternal(\n            @NonNull HttpServletRequest request,\n            @NonNull HttpServletResponse response,\n            @NonNull FilterChain filterChain\n    ) throws ServletException, IOException {\n\n        final String authHeader = request.getHeader(&quot;Authorization&quot;);\n        final String jwt;\n        final String userName;\n        if (StringUtils.isBlank(authHeader) || !authHeader.startsWith(&quot;Bearer &quot;)) {\n            filterChain.doFilter(request, response);\n            return;\n        }\n...\n    }\n</code></pre>\n<p>The only way out that I found is to add regexp for pathvariable in configuration. BUT WY Standard rule not working?</p>\n<p>Two endpoints in controller:</p>\n<pre><code>    @GetMapping(&quot;/{idOrCode}&quot;)\n    public ResponseEntity&lt;ServicePointDTO&gt; getServicePoint(@PathVariable String servicePointIdOrCode) {\n        LogUtil.info(log, &quot;getServicePoint&quot;, &quot;Get service point by id '%s'.&quot;, servicePointIdOrCode);\n\n        ServicePointDTO servicePointDTO = servicePointsService.getServicePoint(servicePointIdOrCode);\n\n        return ResponseEntity.ok(servicePointDTO);\n    }\n\n @GetMapping(&quot;/short&quot;)\n    public ResponseEntity&lt;List&lt;ServicePointShortDTO&gt;&gt; getAllServicePointsShort() {\n        LogUtil.info(log, &quot;getAllServicePointsShort&quot;, &quot;Get all short service points.&quot;);\n\n        List&lt;ServicePointShortDTO&gt; servicePointsShort = servicePointsService.getServicePointsShort();\n\n        return ResponseEntity.ok(servicePointsShort);\n    }\n</code></pre>\n",
    "tags" : [ "java", "spring", "spring-boot", "spring-security" ],
    "owner" : {
      "account_id" : 21427279,
      "reputation" : 71,
      "user_id" : 15784373,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14Gg8qeN5gQMUX-5Ubx79-JicP1oQWicydEIfxz7vBA=k-s256",
      "display_name" : "ivvasch",
      "link" : "https://stackoverflow.com/users/15784373/ivvasch"
    },
    "is_answered" : false,
    "view_count" : 63,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1763976530,
    "creation_date" : 1763729505,
    "link" : "https://stackoverflow.com/questions/79826514/spring-security-3-1-4-requestmatchers-with-pathvariable",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140870522,
    "post_id" : 79826514,
    "body" : "Thank you. For now, I will continue to use regexp to separate the logic. This will avoid cluttering up the configuration.",
    "score" : 0,
    "owner" : {
      "account_id" : 21427279,
      "reputation" : 71,
      "user_id" : 15784373,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14Gg8qeN5gQMUX-5Ubx79-JicP1oQWicydEIfxz7vBA=k-s256",
      "display_name" : "ivvasch",
      "link" : "https://stackoverflow.com/users/15784373/ivvasch"
    },
    "creation_date" : 1763999954,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140870394,
    "post_id" : 79826514,
    "body" : "Which configuration, the security one, no. There is no relation in the security URL expressions and the ones in your <code>@RequestMapping</code> (and friends). So if you have something with a wildcard (or variable) you need to take care of the ordering and the exceptions. Generally what you can do is add an <code>@PreAuthorize</code> to those next or instead of the URL security.",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1763996061,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140870315,
    "post_id" : 79826514,
    "body" : "@M.Deinum but shouldn&#39;t the configuration be guided by Pathvariable? Otherwise, if there are a large number of controllers with similar paths, they will all have to be added to the exceptions.",
    "score" : 0,
    "owner" : {
      "account_id" : 21427279,
      "reputation" : 71,
      "user_id" : 15784373,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14Gg8qeN5gQMUX-5Ubx79-JicP1oQWicydEIfxz7vBA=k-s256",
      "display_name" : "ivvasch",
      "link" : "https://stackoverflow.com/users/15784373/ivvasch"
    },
    "creation_date" : 1763993104,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140870301,
    "post_id" : 79826514,
    "body" : "@Toerktumlare Hi, which part of trace log I need to upload?",
    "score" : 0,
    "owner" : {
      "account_id" : 21427279,
      "reputation" : 71,
      "user_id" : 15784373,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14Gg8qeN5gQMUX-5Ubx79-JicP1oQWicydEIfxz7vBA=k-s256",
      "display_name" : "ivvasch",
      "link" : "https://stackoverflow.com/users/15784373/ivvasch"
    },
    "creation_date" : 1763992798,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140869917,
    "post_id" : 79826514,
    "body" : "again as stated if youo have <code>api&#47;v1&#47;{idOrCode}</code> <b>before</b> <code>api&#47;v1&#47;short</code> in your security configuration your <code>api&#47;v1&#47;short</code> is useless. As it will match <code>api&#47;v1&#47;{idOrCode}</code> not <code>api&#47;v1&#47;short</code>. A good rule of thumb is to have all <b><code>permitAll</code></b> rules always as last (before the <code>.anyRequest().authenticated()</code> rule) in your list of rules not as first to prevent these kind of things. Or if you don&#39;t have a rule for <code>&#47;short</code> and expect that to be caught by <code>.anyRequest().authenticated()</code> (which it doesn&#39;t), so add it explicitly (before the <code>{idOrCode}</code> one.",
    "score" : 1,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1763978020,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140869862,
    "post_id" : 79826514,
    "body" : "That&#39;s the whole point. The endpoint api/v1/short have to be available only for authorization user. There are two endpoints in controller added to question.",
    "score" : 0,
    "owner" : {
      "account_id" : 21427279,
      "reputation" : 71,
      "user_id" : 15784373,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14Gg8qeN5gQMUX-5Ubx79-JicP1oQWicydEIfxz7vBA=k-s256",
      "display_name" : "ivvasch",
      "link" : "https://stackoverflow.com/users/15784373/ivvasch"
    },
    "creation_date" : 1763976222,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140869769,
    "post_id" : 79826514,
    "body" : "I don&#39;t see <code>&#47;short</code> and your pathvariable in your configuration. So provide some actual values that we can relate. One thing to take into consideration is the ordering of rules, the first one that matches is the one being used. So if <code>&#47;{idOrCode}</code> is <b>before</b> <code>&#47;short</code> URL, that will match and renders basically your security configuration for <code>&#47;short</code> unused.",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1763971557,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140868636,
    "post_id" : 79826514,
    "body" : "Hi, thanks. I&#39;ll try to attach the result on Monday",
    "score" : 0,
    "owner" : {
      "account_id" : 21427279,
      "reputation" : 71,
      "user_id" : 15784373,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14Gg8qeN5gQMUX-5Ubx79-JicP1oQWicydEIfxz7vBA=k-s256",
      "display_name" : "ivvasch",
      "link" : "https://stackoverflow.com/users/15784373/ivvasch"
    },
    "creation_date" : 1763890900,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140867285,
    "post_id" : 79826514,
    "body" : "enable spring debug logs, or trace logs and check, its impossible for us to tell without proper debugging information.",
    "score" : 0,
    "owner" : {
      "account_id" : 2064278,
      "reputation" : 15107,
      "user_id" : 1840146,
      "user_type" : "registered",
      "accept_rate" : 86,
      "profile_image" : "https://i.sstatic.net/JXdxm.png?s=256",
      "display_name" : "Toerktumlare",
      "link" : "https://stackoverflow.com/users/1840146/toerktumlare"
    },
    "creation_date" : 1763778569,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}