{
  "question" : {
    "question_id" : 79660642,
    "title" : "Error while decrypting in Java for an encrypted string generated in C# using ECIES algorithm",
    "body" : "<p>We have a target Java codebase responsible for decrypting an incoming payload. The payload is being encrypted within a .NET Core isolated Azure Function before being sent to the endpoint where the Java code attempts decryption. The encryption logic in .NET has been implemented to mirror the approach used in the Java code. However, during decryption on the Java side, we are encountering an <em>&quot;Invalid MAC&quot;</em> error.</p>\n<p>The Java code for encryption:</p>\n<pre class=\"lang-java prettyprint-override\"><code>package encrypt;\n\nimport java.nio.charset.StandardCharsets;\nimport java.security.InvalidAlgorithmParameterException;\nimport java.security.InvalidKeyException;\nimport java.security.KeyFactory;\nimport java.security.NoSuchAlgorithmException;\nimport java.security.NoSuchProviderException;\nimport java.security.PrivateKey;\nimport java.security.PublicKey;\nimport java.security.Security;\nimport java.security.Signature;\nimport java.security.SignatureException;\nimport java.security.spec.InvalidKeySpecException;\nimport java.security.spec.PKCS8EncodedKeySpec;\nimport java.security.spec.X509EncodedKeySpec;\nimport java.time.Instant;\nimport java.util.Base64;\n\nimport javax.crypto.Cipher;\n\nimport org.bouncycastle.crypto.digests.Blake2bDigest;\nimport org.bouncycastle.jce.provider.BouncyCastleProvider;\nimport org.bouncycastle.jce.spec.IESParameterSpec;\n\npublic class Encrypt {\n\n    public static void main(String[] args) throws Exception {\n        // plain-text request\n        String input = &quot;Encryption with ECIES&quot;;\n        String encryptedpayload = encryptECIES(input);\n        System.out.println(encryptedpayload);\n    }\n\n    public static String encryptECIES(String payLoad) throws Exception {\n        Security.addProvider(new BouncyCastleProvider());\n\n        String key = {{PUBLIC KEY}};\n\n        KeyFactory keyFactory = KeyFactory.getInstance(&quot;EC&quot;);\n        X509EncodedKeySpec x509EncodedKeySpec = new X509EncodedKeySpec(Base64.getDecoder().decode((base64PublicKey)));\n        PublicKey publicKey = keyFactory.generatePublic(x509EncodedKeySpec);\n        Cipher cipher = Cipher.getInstance(&quot;ECIESwithSHA512/NONE/NoPadding&quot;);\n        IESParameterSpec iesParamSpec = new IESParameterSpec(null, null, 256);\n        cipher.init(1, publicKey, iesParamSpec);\n        return Base64.getEncoder().encodeToString(cipher.doFinal(payLoad.getBytes()));\n    }\n}\n</code></pre>\n<p>The Java code snippet for decryption:</p>\n<pre class=\"lang-java prettyprint-override\"><code>package encrypt;\n\nimport java.security.InvalidAlgorithmParameterException;\nimport java.security.InvalidKeyException;\nimport java.security.KeyFactory;\nimport java.security.NoSuchAlgorithmException;\nimport java.security.PrivateKey;\nimport java.security.PublicKey;\nimport java.security.Security;\nimport java.security.Signature;\nimport java.security.SignatureException;\nimport java.security.spec.InvalidKeySpecException;\nimport java.security.spec.PKCS8EncodedKeySpec;\nimport java.security.spec.X509EncodedKeySpec;\nimport java.time.Instant;\nimport java.util.Base64;\nimport java.util.HashMap;\nimport java.util.Map;\n\nimport javax.crypto.BadPaddingException;\nimport javax.crypto.Cipher;\nimport javax.crypto.IllegalBlockSizeException;\nimport javax.crypto.NoSuchPaddingException;\n\nimport org.bouncycastle.crypto.digests.Blake2bDigest;\nimport org.bouncycastle.jce.provider.BouncyCastleProvider;\nimport org.bouncycastle.jce.spec.IESParameterSpec;\nimport org.json.JSONObject;\n\npublic class Decrypt {\n\n    public static void main(String[] args) throws Exception{\n      // encrypted payload\n      String input = &quot;BEXNm796h82FKz79//6spJ/u9Aq7W+972N+vdx6dBnjiFibP+2XXHuHOzsLKqgKslj6NW8gIKk3//LPOckKnsWyETUtTKLF7LXRWzOp1jQbQfBHXqOu1J81N85r2PvHiL9vQG/oKxJMXXPLlSfJ0m1GTfG7FKzrELqhxAUoG3jUpIujjgycOHIw+iw9oQDcCGNZtpm7D&quot;;\n        String payload = createDecryptionCipher(input);\n    }\n\n    private static String createDecryptionCipher(String input) throws NoSuchPaddingException, NoSuchAlgorithmException, InterruptedException,\n            InvalidKeySpecException, InvalidAlgorithmParameterException, InvalidKeyException, IllegalBlockSizeException, BadPaddingException {\n        Security.addProvider(new BouncyCastleProvider());\n        Cipher cipher = Cipher.getInstance(&quot;ECIESwithSHA512/NONE/NoPadding&quot;);\n\n        String privateKey = &quot;{{PRIVATE KEY}}&quot;;\n        IESParameterSpec iesParamSpec = new IESParameterSpec(null, null,256);\n        cipher.init(2, getDecryptedPrivateKey(privateKey), iesParamSpec);\n        return new String(cipher.doFinal(Base64.getDecoder().decode(input.getBytes())));\n    }\n}\n</code></pre>\n<p>I've used similar encryption logic in C# that is used in the Java code snippet.</p>\n<p>The C# encryption logic that is used:</p>\n<pre class=\"lang-cs prettyprint-override\"><code>using Microsoft.AspNetCore.Http;\nusing Microsoft.AspNetCore.Http.HttpResults;\nusing Microsoft.AspNetCore.Mvc;\nusing Microsoft.Azure.Functions.Worker;\nusing Microsoft.Azure.Functions.Worker.Http;\nusing Microsoft.Extensions.Logging;\nusing Newtonsoft.Json;\nusing NSec.Cryptography;\nusing System.Text;\nusing System.Text.Json;\nusing System.Security.Cryptography;\nusing Org.BouncyCastle.Crypto.Digests;\nusing Org.BouncyCastle.Crypto.Parameters;\nusing Org.BouncyCastle.Crypto.Signers;\nusing Org.BouncyCastle.OpenSsl;\nusing System.Text.RegularExpressions;\nusing Org.BouncyCastle.Crypto;\nusing Org.BouncyCastle.Crypto.Agreement;\nusing Org.BouncyCastle.Crypto.Engines;\nusing Org.BouncyCastle.Crypto.Generators;\nusing Org.BouncyCastle.Crypto.Macs;\nusing Org.BouncyCastle.Security;\nusing Org.BouncyCastle.Asn1.X509;\nusing Org.BouncyCastle.Asn1;\nusing Org.BouncyCastle.Asn1.X9;\nusing Org.BouncyCastle.Crypto.EC;\nusing Org.BouncyCastle.Asn1.Anssi;\nusing Org.BouncyCastle.Asn1.Nist;\nusing Org.BouncyCastle.Asn1.TeleTrust;\nusing Org.BouncyCastle.Math.EC;\nusing Org.BouncyCastle.Asn1.Sec;\nusing Org.BouncyCastle.Asn1.X509;\nusing System.Security.Cryptography.X509Certificates;\nusing Org.BouncyCastle.Bcpg.OpenPgp;\n\nnamespace BharatConnectEncryption;\n\npublic class Encryption_Demo\n{\n    private readonly ILogger&lt;Encryption_Demo&gt; _logger;\n\n    public Encryption_Demo(ILogger&lt;Encryption_Demo&gt; logger)\n    {\n        _logger = logger;\n    }\n\n    [Function(&quot;Encryption_Demo&quot;)]\n    public async Task&lt;HttpResponseData&gt; Run([HttpTrigger(AuthorizationLevel.Function, &quot;post&quot;)] HttpRequestData req)\n    {\n        try\n        {\n            string input = &quot;Encryption with ECIES&quot;;\n            Console.WriteLine(&quot;Original: &quot; + input);\n           \n            string pemPublicKey = &quot;{{PUBLIC KEY}}&quot;\n            ECPublicKeyParameters pubKey = LoadPublicKeyFromPem(pemPublicKey);         \n\n            string encrypted = ECIESEncryptionUtil.Encrypt(input, pubKey);\n            Console.WriteLine(&quot;Encrypted: &quot; + encrypted);\n\n            var response = req.CreateResponse(System.Net.HttpStatusCode.OK);\n            await response.WriteStringAsync(encrypted);\n            return response;\n        }\n        catch (Exception ex)\n        {\n            var response = req.CreateResponse(System.Net.HttpStatusCode.InternalServerError);\n            await response.WriteStringAsync($&quot;There is some error. The reason is : {ex.Message}&quot;);\n            return response;\n        }\n    }\n\n    public static ECPublicKeyParameters LoadPublicKeyFromPem(string pem)\n    {\n        using var reader = new StringReader(pem);\n        var pemReader = new PemReader(reader);\n        var keyObject = pemReader.ReadObject();\n\n        if (keyObject is ECPublicKeyParameters pubKey)\n            return pubKey;\n\n        if (keyObject is SubjectPublicKeyInfo info)\n            return (ECPublicKeyParameters)PublicKeyFactory.CreateKey(info);\n\n        throw new Exception(&quot;Unsupported public key format&quot;);\n    }\n\npublic static class ECIESEncryptionUtil\n{\n    // Encrypt using ECIESwithSHA512/NONE/NoPadding\n    public static string Encrypt(string plainText, ECPublicKeyParameters recipientPublicKey)\n    {\n        var ecParams = recipientPublicKey.Parameters;\n        var random = new SecureRandom();\n\n        // Generate ephemeral key pair\n        var keyGen = new ECKeyPairGenerator();\n        keyGen.Init(new ECKeyGenerationParameters(ecParams, random));\n        AsymmetricCipherKeyPair ephKp = keyGen.GenerateKeyPair();\n\n        var iesEngine = new IesEngine(\n            new ECDHBasicAgreement(),\n            new Kdf2BytesGenerator(new Sha512Digest()),\n            new HMac(new Sha512Digest())\n        );\n\n        var derivation = new byte[0];\n        var encoding = new byte[0];\n        \n        var iesParams = new IesWithCipherParameters(derivation, encoding, 256, 512);\n        iesEngine.Init(true, ephKp.Private, recipientPublicKey, iesParams);\n\n        byte[] input = Encoding.UTF8.GetBytes(plainText);\n        byte[] ciphertext = iesEngine.ProcessBlock(input, 0, input.Length);\n\n        // Prepend ephemeral public key\n        byte[] ephPublicBytes = ((ECPublicKeyParameters)ephKp.Public).Q.GetEncoded(false);\n        byte[] result = new byte[ephPublicBytes.Length + ciphertext.Length];\n        Array.Copy(ephPublicBytes, 0, result, 0, ephPublicBytes.Length);\n        Array.Copy(ciphertext, 0, result, ephPublicBytes.Length, ciphertext.Length);\n\n        return Convert.ToBase64String(result);\n    }\n}\n</code></pre>\n<p>After generating the encrypted string from C# when we're using the string for decryption from the Java code, we're getting the error as <em>&quot;Invalid MAC&quot;</em>.</p>\n",
    "tags" : [ "java", "c#", "encryption", "bouncycastle", "ecies" ],
    "owner" : {
      "account_id" : 21687780,
      "reputation" : 29,
      "user_id" : 30767305,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2585ab95cc28d6f8ff3a65c5952998cb?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Ayan Panjal",
      "link" : "https://stackoverflow.com/users/30767305/ayan-panjal"
    },
    "is_answered" : true,
    "view_count" : 276,
    "answer_count" : 1,
    "score" : 2,
    "last_activity_date" : 1750425476,
    "creation_date" : 1749565976,
    "link" : "https://stackoverflow.com/questions/79660642/error-while-decrypting-in-java-for-an-encrypted-string-generated-in-c-using-eci",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79662703,
    "question_id" : 79660642,
    "body" : "<p>Java/BouncyCastle implements (among others) the classes <a href=\"https://github.com/bcgit/bc-java/blob/r1v81/prov/src/main/java/org/bouncycastle/jcajce/provider/asymmetric/ec/IESCipher.java#L535\" rel=\"nofollow noreferrer\"><code>ECIESwithSHAXXX</code></a>, <a href=\"https://github.com/bcgit/bc-java/blob/r1v81/prov/src/main/java/org/bouncycastle/jcajce/provider/asymmetric/ec/IESCipher.java#L501\" rel=\"nofollow noreferrer\"><code>ECIES</code></a> and <a href=\"https://github.com/bcgit/bc-java/blob/r1v81/prov/src/main/java/org/bouncycastle/jcajce/provider/asymmetric/ec/IESCipher.java#L57\" rel=\"nofollow noreferrer\"><code>IESCipher</code></a>. I can't find any comparable classes in C#/BouncyCastle. The closest is <a href=\"https://github.com/bcgit/bc-csharp/blob/release-2.6.1/crypto/src/crypto/BufferedIesCipher.cs#L8\" rel=\"nofollow noreferrer\"><code>BufferedIesCipher</code></a>, but this class seems to cover only part of the required functionality.</p>\n<p>Another relevant class in Java/BouncyCastle is <a href=\"https://github.com/bcgit/bc-java/blob/r1v81/core/src/main/java/org/bouncycastle/crypto/engines/IESEngine.java#L56\" rel=\"nofollow noreferrer\"><code>IESEngine</code></a>, in which (among other things) the ephemeral key pair is generated (in <a href=\"https://github.com/bcgit/bc-java/blob/r1v81/core/src/main/java/org/bouncycastle/crypto/engines/IESEngine.java#L391\" rel=\"nofollow noreferrer\"><code>processBlock()</code></a>). I can't find this functionality in C#/BouncyCastle either (s. <a href=\"https://github.com/bcgit/bc-csharp/blob/8e739fbb42a8cd5245f62d220f50e9721698870f/crypto/src/crypto/engines/IesEngine.cs#L220\" rel=\"nofollow noreferrer\"><code>processBlock()</code></a>).</p>\n<p>There may be other classes that I have overlooked and that provide the required functionality. If not, the C#/BouncyCastle library can be extended by the missing classes, e.g. by yourself, if you are willing to invest the corresponding effort.</p>\n<hr />\n<p>A faster solution is to debug Java/BouncyCastle in order to determine the details of the logic and implement it with C#/BouncyCastle. However, this C# implementation only works for the specific ECIES configuration of the posted Java code and is not a <em>general</em> solution that covers all possible ECIES variants of the Java/BouncyCastle library (e.g. this code will be incompatible with an ECIES configuration that applies ciphers like AES).</p>\n<p>When the Java code is debugged, the following logic is revealed:</p>\n<ul>\n<li>Importing the public key.</li>\n<li>Generating an ephemeral key pair.</li>\n<li>Generating the key agreement.</li>\n<li>Generating the key using the KDF: As input for the key derivation, the concatenation of the ephemeral public uncompressed key and the key agreement is used. The optional parameter <code>derivation</code> (first parameter passed in <a href=\"https://downloads.bouncycastle.org/java/docs/bcprov-jdk18on-javadoc/org/bouncycastle/jce/spec/IESParameterSpec.html#%3Cinit%3E(byte%5B%5D,byte%5B%5D,int)\" rel=\"nofollow noreferrer\"><code>IESParameterSpec</code></a>, <code>null</code> in the sample code) is taken into account if provided. The length of the key <code>KEnc</code> for encryption corresponds to the length of the plaintext, and the length of the key <code>KMac</code> for integrity is set to 256 bits. Both are determined from the key derivation as <code>KMac|KEnc</code>.</li>\n<li>Encrypting the plaintext with the plaintext and <code>KEnc</code> are XORed bit by bit (in particular no AES is involved).</li>\n<li>Generating a MAC for the ciphertext. The optional parameter <code>encoding</code> (second parameter passed in <a href=\"https://downloads.bouncycastle.org/java/docs/bcprov-jdk18on-javadoc/org/bouncycastle/jce/spec/IESParameterSpec.html#%3Cinit%3E(byte%5B%5D,byte%5B%5D,int)\" rel=\"nofollow noreferrer\"><code>IESParameterSpec</code></a>, <code>null</code> in the sample code) is taken into account if provided.</li>\n</ul>\n<hr />\n<p>The following is a possible C# implementation (without values for <code>derivation</code> and <code>encoding</code>) whose ciphertext can be decrypted with the Java code:</p>\n<pre class=\"lang-cs prettyprint-override\"><code>using System;\nusing System.IO;\nusing System.Buffers.Binary;\nusing System.Text;\nusing Org.BouncyCastle.Crypto;\nusing Org.BouncyCastle.Crypto.Agreement;\nusing Org.BouncyCastle.Crypto.Digests;\nusing Org.BouncyCastle.Crypto.Generators;\nusing Org.BouncyCastle.Crypto.Macs;\nusing Org.BouncyCastle.Crypto.Parameters;\nusing Org.BouncyCastle.Math;\nusing Org.BouncyCastle.OpenSsl;\nusing Org.BouncyCastle.Security;\nusing Org.BouncyCastle.Utilities;\n...\npublic static string EncryptECIES(string payLoad)\n{\n    byte[] plaintext = Encoding.UTF8.GetBytes(payLoad);\n    byte[] derivation = new byte[0]; // corresponds to 1st param in IESParameterSpec\n    byte[] encoding = new byte[0]; // corresponds to 2nd param in IESParameterSpec\n\n    // import public key and create ephemeral key pair\n    ECPublicKeyParameters publicKey = ImportPublicKey();\n    AsymmetricCipherKeyPair ephKeyPair = CreateEphemeralKeyPair(publicKey.Parameters);\n    ECPrivateKeyParameters ephemeralPrivateKey = (ECPrivateKeyParameters)ephKeyPair.Private;\n    byte[] ephemeralPublicKey = ((ECPublicKeyParameters)ephKeyPair.Public).Q.GetEncoded();\n\n    // create ECDH key agreement\n    ECDHBasicAgreement ecdhBasicAgreement = new ECDHBasicAgreement();\n    ecdhBasicAgreement.Init(ephemeralPrivateKey);\n    BigInteger agreementBI = ecdhBasicAgreement.CalculateAgreement(publicKey);\n    byte[] agreement = Arrays.Concatenate(\n            ephemeralPublicKey,\n            BigIntegers.AsUnsignedByteArray(ecdhBasicAgreement.GetFieldSize(), agreementBI));\n\n    // key derivation\n    Kdf2BytesGenerator kdf2BytesGenerator = new Kdf2BytesGenerator(new Sha512Digest());\n    KdfParameters kdfParam = new KdfParameters(agreement, derivation); \n    kdf2BytesGenerator.Init(kdfParam);\n    byte[] KEnc = new byte[plaintext.Length];         \n    byte[] KMac = new byte[256/8];                  \n    byte[] K = new byte[KEnc.Length + KMac.Length];\n    kdf2BytesGenerator.GenerateBytes(K, 0, K.Length);\n    Buffer.BlockCopy(K, 0, KMac, 0, KMac.Length);\n    Buffer.BlockCopy(K, KMac.Length, KEnc, 0, KEnc.Length);\n\n    // encryption\n    byte[] ct = new byte[plaintext.Length];\n    for (int i = 0; i != plaintext.Length; ++i)\n    {\n        ct[i] = (byte)(plaintext[i] ^ KEnc[i]);\n    }\n\n    // MAC\n    byte[] encodingLength = GetLengthTag(encoding);  \n    HMac mac = new HMac(new Sha512Digest());\n    byte[] tag = new byte[mac.GetMacSize()];\n    mac.Init(new KeyParameter(KMac));\n    mac.BlockUpdate(ct, 0, ct.Length);\n    if (encoding != null)\n    {\n        mac.BlockUpdate(encoding, 0, encoding.Length);\n    }\n    mac.BlockUpdate(encodingLength, 0, encodingLength.Length);\n    mac.DoFinal(tag, 0);\n\n    // concatenate\n    return Convert.ToBase64String(Arrays.Concatenate(ephemeralPublicKey, ct, tag));\n}\n\nprivate static ECPublicKeyParameters ImportPublicKey()\n{\n    string spkiPem = @&quot;-----BEGIN PUBLIC KEY-----\n                    MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEMpHT+HNKM7zjhx0jZDHyzQlkbLV0\n                    xk0H/TFo6gfT23ish58blPNhYrFI51Q/czvkAwCtLZz/6s1n/M8aA9L1Vg==\n                    -----END PUBLIC KEY-----&quot;;\n    PemReader pemReader = new PemReader(new StringReader(spkiPem));\n    return (ECPublicKeyParameters)pemReader.ReadObject();\n}\n\nprivate static AsymmetricCipherKeyPair CreateEphemeralKeyPair(ECDomainParameters ecParams)\n{\n    var keyGen = new ECKeyPairGenerator();\n    keyGen.Init(new ECKeyGenerationParameters(ecParams, new SecureRandom()));\n    return keyGen.GenerateKeyPair();\n}\n\nprotected static byte[] GetLengthTag(byte[] p)\n{\n    byte[] L = new byte[8];\n    if (p != null)\n    {\n        BinaryPrimitives.WriteInt64BigEndian(L, (long)p.Length * 8L);\n    }\n    return L;\n}  \n</code></pre>\n<p>Alternatively, the C# code posted in the question can be retained and the required functions/changes implemented in a modified <code>IesEngine</code> class.</p>\n<p>If the ephemeral key pair is still to be generated in <code>ECIESEncryptionUtil.Encrypt()</code>, the ephemeral public key must be passed to the modified <code>IesEngine</code> class, e.g. with an <code>Init()</code> overload (this is necessary because the ephemeral public key is not only required for decryption, but is also used for key derivation, where it is concatenated with the key agreement).</p>\n<hr />\n<p>Test:</p>\n<pre class=\"lang-cs prettyprint-override\"><code>string ct = EncryptECIES(&quot;The quick brown fox jumps over the lazy dog&quot;);\nConsole.WriteLine(ct);\n</code></pre>\n<p>Sample Output:</p>\n<pre class=\"lang-none prettyprint-override\"><code>BAexCkJ6AtfjRIEXF/ytMyLXvLDZZ5og94ZeVMA7B1XtofYPZ+XjTld1QO4UFkHc8SbwCOgYnPE/hSijWBvQZp8rGGnKdF0CT5HF/AJWX+VdcDafHzAww/Wx7WruXlNKaeAA8qDHPSBdF03OAfgN5RpzccCKIHGIsp9r/kEejwyTOlWoRJzqkOkQdL/DixsONDsrx9iEts8vmuHz6kCQwE/9b5LXBPj1EcnCoQ==\n</code></pre>\n<p>The ciphertext generated in this way can be decrypted using the posted Java code from the question.</p>\n",
    "score" : 3,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 12359353,
      "reputation" : 50593,
      "user_id" : 9014097,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Y9EVM.jpg?s=256",
      "display_name" : "Topaco",
      "link" : "https://stackoverflow.com/users/9014097/topaco"
    },
    "creation_date" : 1749678221,
    "last_activity_date" : 1749731567,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140505832,
    "post_id" : 79660642,
    "body" : "@PresidentJamesK.Polk, I&#39;ve not found any minimal code in C# which is equivalent to the Java",
    "score" : 0,
    "owner" : {
      "account_id" : 21687780,
      "reputation" : 29,
      "user_id" : 30767305,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2585ab95cc28d6f8ff3a65c5952998cb?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Ayan Panjal",
      "link" : "https://stackoverflow.com/users/30767305/ayan-panjal"
    },
    "creation_date" : 1749652517,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140503975,
    "post_id" : 79660642,
    "body" : "The Java code is minimal but the C# code contains much code that isn&#39;t necessary to demonstrating the problem.",
    "score" : 0,
    "owner" : {
      "account_id" : 85671,
      "reputation" : 42272,
      "user_id" : 238704,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/VgOZI.png?s=256",
      "display_name" : "President James K. Polk",
      "link" : "https://stackoverflow.com/users/238704/president-james-k-polk"
    },
    "creation_date" : 1749595878,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140502952,
    "post_id" : 79660642,
    "body" : "@cliff2310 :D You do realize that <i>that</i> MAC (Media Access Control) has nothing to do with the MAC (Message Authentication Code) in the question?",
    "score" : 6,
    "owner" : {
      "account_id" : 957028,
      "reputation" : 16497,
      "user_id" : 982149,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://i.sstatic.net/LdDoZ.png?s=256",
      "display_name" : "Fildor",
      "link" : "https://stackoverflow.com/users/982149/fildor"
    },
    "creation_date" : 1749568772,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140502798,
    "post_id" : 79660642,
    "body" : "Do both encryption codes generate the same encrypted result, given the same input?",
    "score" : 2,
    "owner" : {
      "account_id" : 1888781,
      "reputation" : 2498,
      "user_id" : 1707427,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/4d1a2608ee35e2df7d2400a02e62bb20?s=256&d=identicon&r=PG",
      "display_name" : "S&#246;ren",
      "link" : "https://stackoverflow.com/users/1707427/s%c3%b6ren"
    },
    "creation_date" : 1749566315,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79662703" : [ {
      "comment_id" : 140509403,
      "post_id" : 79662703,
      "body" : "@Topaco-Thank you very much for the solution. It&#39;s actually worked. Thank you once again",
      "score" : 0,
      "owner" : {
        "account_id" : 21687780,
        "reputation" : 29,
        "user_id" : 30767305,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/2585ab95cc28d6f8ff3a65c5952998cb?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Ayan Panjal",
        "link" : "https://stackoverflow.com/users/30767305/ayan-panjal"
      },
      "creation_date" : 1749751244,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140508472,
      "post_id" : 79662703,
      "body" : "OK, revised the answer and used <code>null</code> (Java side) and <code>new byte[0]</code> (C# side) for both optional parameters. This should be less confusing. Decryption is possible using the <i>unchanged</i> Java method as demonstrated in the following online example: See <a href=\"https://dotnetfiddle.net/8g4itS\" rel=\"nofollow noreferrer\">.NET Fiddle</a> for encryption with C# and <a href=\"https://www.jdoodle.com/ia/1I2I\" rel=\"nofollow noreferrer\">jdoodle</a> for decryption with the unchanged Java code.",
      "score" : 1,
      "owner" : {
        "account_id" : 12359353,
        "reputation" : 50593,
        "user_id" : 9014097,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/Y9EVM.jpg?s=256",
        "display_name" : "Topaco",
        "link" : "https://stackoverflow.com/users/9014097/topaco"
      },
      "creation_date" : 1749729737,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140508257,
      "post_id" : 79662703,
      "body" : "@AyanPanjal - This solution requires <b>no change</b> to the Java code! <code>derivation</code> and <code>encoding</code> can have <b>any value</b> including <code>null</code> (as in the sample Java code posted).  I only used the sample values to demonstrate that it also works for arbitrary values for <code>derivation</code> and <code>encoding</code>.",
      "score" : 0,
      "owner" : {
        "account_id" : 12359353,
        "reputation" : 50593,
        "user_id" : 9014097,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/Y9EVM.jpg?s=256",
        "display_name" : "Topaco",
        "link" : "https://stackoverflow.com/users/9014097/topaco"
      },
      "creation_date" : 1749725864,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140508228,
      "post_id" : 79662703,
      "body" : "Thanks for the update. The thing is we can&#39;t modify the Java code as you mentioned. The Java logic will remain same.",
      "score" : 0,
      "owner" : {
        "account_id" : 21687780,
        "reputation" : 29,
        "user_id" : 30767305,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/2585ab95cc28d6f8ff3a65c5952998cb?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Ayan Panjal",
        "link" : "https://stackoverflow.com/users/30767305/ayan-panjal"
      },
      "creation_date" : 1749725351,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}