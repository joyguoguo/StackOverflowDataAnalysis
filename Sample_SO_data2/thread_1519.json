{
  "question" : {
    "question_id" : 79701834,
    "title" : "How to prevent exception bubbling after retries with @RetryableTopic in Spring Kafka",
    "body" : "<p>I'm using Java 17 and a Spring Boot application to consume Kafka messages with retry handling via Spring Kafka's.</p>\n<p>I have a custom KafkaTemplate and a custom Kafka listener container factory.</p>\n<pre class=\"lang-java prettyprint-override\"><code>@RetryableTopic(\nattempts = &quot;3&quot;,\nbackoff = @Backoff(delay = 1000),\nkafkaTemplate = &quot;kafkaTemplate&quot;,\nlistenerContainerFactory = &quot;customKafkaListenerContainerFactory&quot;)\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>@KafkaListener(\ntopics = &quot;my-topic&quot;,\ngroupId = &quot;my-group&quot;,\ncontainerFactory = &quot;customKafkaListenerContainerFactory&quot;)\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>public void listen(String message) {\n  if (!processMessage(message)) {\n    throw new RuntimeException(&quot;Processing failed&quot;);\n  }\n}\n</code></pre>\n<p>This setup successfully retries failed messages, and after exhausting all attempts, the message is sent to the Dead Letter Topic (DLT).\nI want to prevent the exception from propagating or appearing as unhandled</p>\n<p>I also tried adding a <code>@DltHandler</code> method to handle final failures:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@DltHandler\npublic void handleDlt(String message) {\n  log.warn(&quot;Message permanently failed after retries: {}&quot;, message);\n}\n</code></pre>\n<p>This method is invoked correctly when the message lands in the DLT. Although the <code>@DltHandler</code> logs the failed message, the exception still bubbles up and appears in the logs as an unhandled error. I want to suppress this exception after itâ€™s handled (according to the logs the exception is thrown before the <code>@DltHandler</code> logs the final attempt).</p>\n",
    "tags" : [ "java", "spring-boot", "spring-kafka", "retry-logic" ],
    "owner" : {
      "account_id" : 42134204,
      "reputation" : 11,
      "user_id" : 30609155,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/8a212027fb00c230c576ea49dbb00d0d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Itay Zadik",
      "link" : "https://stackoverflow.com/users/30609155/itay-zadik"
    },
    "is_answered" : false,
    "view_count" : 91,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1752572712,
    "creation_date" : 1752571742,
    "link" : "https://stackoverflow.com/questions/79701834/how-to-prevent-exception-bubbling-after-retries-with-retryabletopic-in-spring-k",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79701864,
    "question_id" : 79701834,
    "body" : "<p>I have been reading about this <a href=\"https://docs.spring.io/spring-kafka/reference/retrytopic/dlt-strategies.html\" rel=\"nofollow noreferrer\">here</a> and <a href=\"https://docs.spring.io/spring-kafka/api/org/springframework/kafka/retrytopic/RetryTopicConfigurer.html\" rel=\"nofollow noreferrer\">here</a> and it seems to me that this is not possible based on existing features of the tool so this seems to be a feature request.</p>\n<p>Anyway, before you file a letter to them, you will need to debug the app (it's open-source <a href=\"https://github.com/spring-projects/spring-kafka/tree/main\" rel=\"nofollow noreferrer\">https://github.com/spring-projects/spring-kafka/tree/main</a>) and figure out what is the exact method that is bubbling up the exception. Then you will be able to file a message to them, like:</p>\n<blockquote>\n<p>I would need to stop exception bubbling when DLT is successfully handled. Is there a configuration that allows for this, or are there feature plans to implement this?</p>\n</blockquote>\n<p>And then they will answer with a yes or a no. If the answer is yes, then you can apply a temporary solution while you await for it. If it's a no, then you will either need to accept the way it works, restructure your application to ameliorate the problem or create a fork where you change the method. This last approach is very hacky and should be avoided unless you have no other means to achieve it.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 194308,
      "reputation" : 80530,
      "user_id" : 436560,
      "user_type" : "registered",
      "accept_rate" : 87,
      "profile_image" : "https://i.sstatic.net/2GESV.jpg?s=256",
      "display_name" : "Lajos Arpad",
      "link" : "https://stackoverflow.com/users/436560/lajos-arpad"
    },
    "creation_date" : 1752572712,
    "last_activity_date" : 1752572712,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140644107,
    "post_id" : 79701834,
    "body" : "Did you try to implement custom error handler at container level?",
    "score" : 0,
    "owner" : {
      "account_id" : 7692774,
      "reputation" : 1282,
      "user_id" : 5828464,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/de54db63fab1e3c3d00d0dbef1a0a0f1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Yuri G",
      "link" : "https://stackoverflow.com/users/5828464/yuri-g"
    },
    "creation_date" : 1754411334,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}