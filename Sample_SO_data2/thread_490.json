{
  "question" : {
    "question_id" : 79794275,
    "title" : "Subcontext in Embedded Tomcat Server Spring Boot 1.5",
    "body" : "<p>I'm trying to make a Spring Boot 1.5 project to use the embedded Tomcat Server it can come with. The project is configured for Tomcat 8.5, with a META-INF/context.xml, WEB-INF/web.xml and a specific server.xml holding the global resources the context is referring to.</p>\n<p>I followed online guides and was able to include most of my Resource objects from those configuration files into my embedded server. To do so, I extended the TomcatEmbeddedServletContainerFactory class and override the postProcessContext function. For the most part, it works and the project can lookup JNDI names successfully.</p>\n<p>There is, however, one Resource I'm unable to import.</p>\n<p>META-INF/context.xml</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;ResourceLink name=&quot;rlname&quot;\n              type=&quot;java.lang.Object&quot;\n              global=&quot;path/to/resource&quot; /&gt;\n</code></pre>\n<p>There is no Resource in the GlobalNamingResources element that is directly referred by this global property. There are, however, multiple Resource with name/global which are children to this path:</p>\n<p>server.xml</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;GlobalNamingResources&gt;\n    &lt;Resource global=&quot;path/to/resource/0/item1&quot;\n              name=&quot;path/to/resource/0/item1&quot; /&gt;\n    &lt;Resource global=&quot;path/to/resource/0/item2&quot;\n              name=&quot;path/to/resource/0/item2&quot; /&gt;\n    &lt;Resource global=&quot;path/to/resource/0/item3&quot;\n              name=&quot;path/to/resource/0/item3&quot; /&gt;\n&lt;/GlobalNamingResources&gt;   \n              \n</code></pre>\n<p>Here's how this Resource is being called in Java code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>Context initialContext = new InitialContext();\nContext rlContext = (Context) initialContext.lookup(&quot;java:comp/env/rlname&quot;);\nNamingEnumeration&lt;Binding&gt; names = rlContext.listBindings(&quot;&quot;); // this would contain only one item in this isntance, with the binding for &quot;path/to/resource/0&quot;\n\nContext contextZero = (Context) names.next().getObject();\n\n// with this, we can access the three child subitems\ncontextZero.lookup(&quot;item1&quot;);\ncontextZero.lookup(&quot;item2&quot;);\ncontextZero.lookup(&quot;item3&quot;);\n</code></pre>\n<p>Basically, the ResourceLink is used as a &quot;subcontext&quot;, used later to get the other Resource. This works for an external Tomcat installation, but I'm unable to make it work with the embedded one. The lookup always fails.</p>\n<p>How can I translate this Tomcat configuration quirk into embedded server configuration language?</p>\n<p>I tried the following:</p>\n<ul>\n<li>Adding the rlname ResourceLink as a ContextResource object. This makes the lookup throw a NamingException.</li>\n<li>Adding the rlname ResourceLink as a ContextResourceLink object. <strong>With this, the lookup does not throw an exception but returns null instead.</strong></li>\n<li>Replacing the type property from &quot;java.lang.Object&quot; to &quot;javax.naming.Context&quot;. Changes nothing.</li>\n</ul>\n<pre class=\"lang-java prettyprint-override\"><code>@Override\nprotected TomcatEmbeddedServletContainer getTomcatEmbeddedServletContainer (Tomcat tomcat) {\n    tomcat.enableNaming();\n    return super.getTomcatEmbeddedServletContainer(tomcat);\n}\n\n@Override\npublic void postProcessContext(Context context) {\n    ContextResource resource1 = new ContextResource();\n    resource1.setName(&quot;path/to/resource/0/item1&quot;);\n    resource1.setProperty(&quot;global&quot;, &quot;path/to/resource/0/item1&quot;);\n    context.getNamingResources().addResource(resource1);\n\n    ContextResource resource2 = new ContextResource();\n    resource2.setName(&quot;path/to/resource/0/item2&quot;);\n    resource2.setProperty(&quot;global&quot;, &quot;path/to/resource/0/item2&quot;);\n    context.getNamingResources().addResource(resource2);\n\n    ContextResource resource3 = new ContextResource();\n    resource3.setName(&quot;path/to/resource/0/item3&quot;);\n    resource3.setProperty(&quot;global&quot;, &quot;path/to/resource/0/item3&quot;);\n    context.getNamingResources().addResource(resource3);\n\n    // Scenario 1. As a ContextResourceLink\n    ContextResourceLink rLink1 = new ContextResourceLink();\n    rLink1.setName(&quot;rlink&quot;);\n    rLink1.setType(&quot;java.lang.Object&quot;);\n    rLink1.setProperty(&quot;global&quot;, &quot;path/to/resource&quot;);\n    context.getNamingResources().addResourceLink(rLink1);\n\n    // Scenario 2. As a ContextResource\n    ContextResource rLink2 = new ContextResource();\n    rLink2.setName(&quot;rlink&quot;);\n    rLink2.setType(&quot;java.lang.Object&quot;);\n    rLink2.setProperty(&quot;global&quot;, &quot;path/to/resource&quot;);\n    context.getNamingResources().addResource(rLink2);\n}\n</code></pre>\n<p>I also tried other things, including messing around with the Tomcat object given by getTomcatEmbeddedServletContainer function, but to no avail.</p>\n<p>One thing to note is that, with other Resource, I don't use the ContextResourceLink object. For those, I created a single ContextResource object and &quot;merged&quot; the properties from the link and the GlobalNamingResources element into a single object. From my testings, applying the same distinction of global resources and context resource links and adding them onto <code>context.getNamingResources()</code> doesn't work. Same thing goes with <code> tomcat.getServer().getGlobalNamingResources()</code> .</p>\n",
    "tags" : [ "java", "xml", "spring-boot", "tomcat", "embedded-tomcat-8" ],
    "owner" : {
      "account_id" : 44347313,
      "reputation" : 1,
      "user_id" : 31706798,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/712e6d4b29386108abceb26606adb564?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Shifa",
      "link" : "https://stackoverflow.com/users/31706798/shifa"
    },
    "is_answered" : false,
    "view_count" : 65,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1760878318,
    "creation_date" : 1760878318,
    "link" : "https://stackoverflow.com/questions/79794275/subcontext-in-embedded-tomcat-server-spring-boot-1-5",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}