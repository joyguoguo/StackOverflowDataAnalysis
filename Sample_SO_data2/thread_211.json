{
  "question" : {
    "question_id" : 79829984,
    "title" : "Why does my Java code behave differently inside a loop when checking conditions using a HashSet?",
    "body" : "<p>I am trying to solve a coding problem where I need to repeatedly double a number (<code>original</code>) as long as it exists in an integer array. To make the lookup faster, I am inserting all elements of the array into a <code>HashSet</code>. My understanding is that this should allow constant-time <code>contains()</code> checks.</p>\n<p>However, when I put the doubling condition <strong>inside the loop that builds the set</strong>, my code fails on certain inputs. Here is the code:</p>\n<pre><code>public int findFinalValue(int[] nums, int original) {\n    Set&lt;Integer&gt; set = new HashSet&lt;&gt;();\n    for (int num : nums) {\n        set.add(num);\n        if (set.contains(original)) {\n            original *= 2;\n        }\n    }\n    return original;\n}\n</code></pre>\n<p>For example, with <code>nums = [5,3,6,1,12]</code> and <code>original = 3</code>, this code returns <strong>12</strong>, but the correct result should be <strong>24</strong> because 3 → 6 → 12 → 24 (all appear in the array).</p>\n<p>When I move the condition outside the loop like this:</p>\n<pre><code>while (set.contains(original)) {\n    original *= 2;\n}\n</code></pre>\n<p>…it works correctly.</p>\n<p>My question is:</p>\n<p><strong>Why does checking <code>contains(original)</code> inside the same loop where the set is being built cause incorrect behavior?</strong><br />\nI assumed adding elements one by one and checking in the same pass should logically work, since ultimately the same set gets built.</p>\n<p>Is there some detail about iteration order, timing of updates, or HashSet behavior that I am misunderstanding?</p>\n<p>Any explanation about <em>why the logic only works after the full set is constructed</em> would be greatly appreciated.</p>\n",
    "tags" : [ "java" ],
    "owner" : {
      "account_id" : 44804289,
      "reputation" : 11,
      "user_id" : 31944464,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0bbcfc68e88fcd14b794086c550970b4?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Gurkirat Singh",
      "link" : "https://stackoverflow.com/users/31944464/gurkirat-singh"
    },
    "is_answered" : true,
    "view_count" : 115,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1764090187,
    "creation_date" : 1764088948,
    "link" : "https://stackoverflow.com/questions/79829984/why-does-my-java-code-behave-differently-inside-a-loop-when-checking-conditions",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79829991,
    "question_id" : 79829984,
    "body" : "<p>The argument does not quite work for your values. If you are sure about those, try preparing a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>.</p>\n<p>But let's assume <code>nums = [5,3,1,12,6]</code> instead. When adding 6, the current value will be checked against 6 once and doubled to 12. 12 will not be checked against the set again and gets returned.</p>\n<p>You will do at most one doubling per loop. Adding one value can reveal the need to perform multiple doublings. This can happen too late in the loop to get you the right result in time.</p>\n<p>You could fix that by making the inner if to a <code>while</code> as in:</p>\n<pre><code>    for (int num : nums) {\n        set.add(num);\n        while (set.contains(original)) {\n            original *= 2;\n        }\n    }\n</code></pre>\n",
    "score" : 3,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 19435569,
      "reputation" : 2968,
      "user_id" : 21105992,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/kKQkV.png?s=256",
      "display_name" : "teapot418",
      "link" : "https://stackoverflow.com/users/21105992/teapot418"
    },
    "creation_date" : 1764089306,
    "last_activity_date" : 1764090187,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140874826,
    "post_id" : 79829984,
    "body" : "Your assumption is wrong. It doesn&#39;t make any difference if ultimately the same set gets built, if you are using the partial set before it is properly built.",
    "score" : 1,
    "owner" : {
      "account_id" : 318670,
      "reputation" : 16477,
      "user_id" : 636009,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/IIQJV.jpg?s=256",
      "display_name" : "David Conrad",
      "link" : "https://stackoverflow.com/users/636009/david-conrad"
    },
    "creation_date" : 1764177924,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140873588,
    "post_id" : 79829984,
    "body" : "Why not take the two subtasks apart? First add all the numbers. Then start checking if <code>original</code> is in the set and double it as long as it is. Would seem simpler to argue about to me.",
    "score" : 0,
    "owner" : {
      "account_id" : 7612423,
      "reputation" : 87409,
      "user_id" : 5772882,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/8283c64511fa80afed5259d10850168f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Anonymous",
      "link" : "https://stackoverflow.com/users/5772882/anonymous"
    },
    "creation_date" : 1764139260,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140872799,
    "post_id" : 79829984,
    "body" : "Regardless, I think there might be a flaw in checking for membership in a partial set.  What happens with an array like <code>[12,5,3,6,1]</code> when original is 3?  I think you have to build the entire set first.",
    "score" : 0,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44991,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1764094435,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140872670,
    "post_id" : 79829984,
    "body" : "I can&#39;t reproduce that behavior with your input - see <a href=\"https://www.programiz.com/online-compiler/4Gw0KLm0LNDUA\" rel=\"nofollow noreferrer\">programiz.com/online-compiler/4Gw0KLm0LNDUA</a> for example. It&#39;s <i>really</i> important that people can reproduce the results you&#39;re seeing. The answer from teapot418 is absolutely right, but doesn&#39;t explain the result you&#39;re supposedly seeing for <code>[5,3,6,1,12]</code>.",
    "score" : 3,
    "owner" : {
      "account_id" : 11683,
      "reputation" : 1521090,
      "user_id" : 22656,
      "user_type" : "registered",
      "accept_rate" : 86,
      "profile_image" : "https://www.gravatar.com/avatar/6d8ebb117e8d83d74ea95fbdd0f87e13?s=256&d=identicon&r=PG",
      "display_name" : "Jon Skeet",
      "link" : "https://stackoverflow.com/users/22656/jon-skeet"
    },
    "creation_date" : 1764089722,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}