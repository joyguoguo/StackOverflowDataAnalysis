{
  "question" : {
    "question_id" : 79840829,
    "title" : "BouncyCastle BKS Keystore fails to load on Oracle JDK 21 but works on OpenJDK 21",
    "body" : "<p>I am facing an issue when loading a <strong>BKS (BouncyCastle) keystore</strong> in a Spring-based application running on <strong>Oracle JDK 21</strong>. The same code works without any issues on <strong>OpenJDK 21</strong>.</p>\n<p>Environment details:</p>\n<ul>\n<li><strong>OS</strong>: Oracle Linux 9.6</li>\n<li><strong>JDK (problematic)</strong>: Oracle JDK 21.0.9</li>\n<li><strong>JDK (working)</strong>: OpenJDK 21.0.9.0.10</li>\n<li><strong>App Server</strong>: JBoss EAP 8</li>\n<li><strong>Keystore Type</strong>: BKS</li>\n<li><strong>Provider</strong>: BouncyCastle 1.82</li>\n</ul>\n<p>I reproduced the issue locally by setting up the exact same environment (Oracle Linux 9.6 + Oracle JDK 21).\nOn OpenJDK 21 the keystore loads successfully; on Oracle JDK 21 it fails.</p>\n<pre class=\"lang-java prettyprint-override\"><code>static {\n    // Force BC to load first\n    Security.removeProvider(&quot;BC&quot;);\n    Security.insertProviderAt(new BouncyCastleProvider(), 1);\n}\nprivate void contextInitialized() {\n    Security.addProvider(new BouncyCastleProvider());\n\n    InputStream keystoreStream = getClass().getClassLoader()\n            .getResourceAsStream(propertyConfig.getMcashKeystoreConfig());\n\n    KeyStore keystore = KeyStore.getInstance(&quot;BKS&quot;, &quot;BC&quot;);\n    keystore.load(keystoreStream, propertyConfig.getMcashKeystorePassword().toCharArray());\n\n    key = keystore.getKey(\n            propertyConfig.getMcashKeyAlias(),\n            propertyConfig.getMcashKeyPassword().toCharArray()\n    );\n}\n</code></pre>\n<p><strong>Provider list (Oracle JDK 21)</strong></p>\n<p>Even after inserting the provider at index 1, the keystore still fails:</p>\n<pre><code>[BC version 1.82, SUN version 21, SunRsaSign version 21, SunEC version 21, SunJSSE version 21, SunJCE version 21, ...]\n</code></pre>\n<p><strong>Error stack trace</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>{&quot;WFLYCTL0062: Composite operation failed and was rolled back. Steps that failed:&quot; =&gt; {&quot;Operation step-2&quot; =&gt; {&quot;WFLYCTL0080: Failed services&quot; =&gt; {&quot;jboss.deployment.unit.\\&quot;WalletManagement-0.0.1.war\\&quot;.undertow-deployment&quot; =&gt; &quot;java.lang.RuntimeException: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'dashboardController': Unsatisfied dependency e\nxpressed through field 'dashboardService': Error creating bean with name 'dashboardServiceImpl': Unsatisfied dependency expressed through field 'walletDao': Error creating bean with name 'walletDaoImpl': Unsati\nsfied dependency expressed through field 'util': Error creating bean with name 'util': Unsatisfied dependency expressed through field 'contextProvider': Error creating bean with name 'contextProvider': Invocati\non of init method failed\n    Caused by: java.lang.RuntimeException: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'dashboardController': Unsatisfied dependency expressed through field '\ndashboardService': Error creating bean with name 'dashboardServiceImpl': Unsatisfied dependency expressed through field 'walletDao': Error creating bean with name 'walletDaoImpl': Unsatisfied dependency express\ned through field 'util': Error creating bean with name 'util': Unsatisfied dependency expressed through field 'contextProvider': Error creating bean with name 'contextProvider': Invocation of init method failed\n    Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'dashboardController': Unsatisfied dependency expressed through field 'dashboardService': Error cre\nating bean with name 'dashboardServiceImpl': Unsatisfied dependency expressed through field 'walletDao': Error creating bean with name 'walletDaoImpl': Unsatisfied dependency expressed through field 'util': Err\nor creating bean with name 'util': Unsatisfied dependency expressed through field 'contextProvider': Error creating bean with name 'contextProvider': Invocation of init method failed\n    Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'dashboardServiceImpl': Unsatisfied dependency expressed through field 'walletDao': Error creating\nbean with name 'walletDaoImpl': Unsatisfied dependency expressed through field 'util': Error creating bean with name 'util': Unsatisfied dependency expressed through field 'contextProvider': Error creating bean\n with name 'contextProvider': Invocation of init method failed\n    Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'walletDaoImpl': Unsatisfied dependency expressed through field 'util': Error creating bean with na\nme 'util': Unsatisfied dependency expressed through field 'contextProvider': Error creating bean with name 'contextProvider': Invocation of init method failed\n    Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'util': Unsatisfied dependency expressed through field 'contextProvider': Error creating bean with\nname 'contextProvider': Invocation of init method failed\n    Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'contextProvider': Invocation of init method failed\n    Caused by: java.lang.RuntimeException: java.security.UnrecoverableKeyException: no match\n    Caused by: java.security.UnrecoverableKeyException: no match&quot;}}}}\n</code></pre>\n<p>The alias exists, and passwords are correct in both environments.\nThe keystore loads perfectly on OpenJDK 21 with the same file and password.</p>\n<p><strong>What I have tried</strong></p>\n<ol>\n<li>Added BouncyCastle to <code>java.security</code>:</li>\n</ol>\n<pre class=\"lang-java prettyprint-override\"><code>security.provider.2=org.bouncycastle.jce.provider.BouncyCastleProvider\n</code></pre>\n<ol start=\"2\">\n<li>Forced the provider programmatically:</li>\n</ol>\n<pre class=\"lang-java prettyprint-override\"><code>Security.removeProvider(&quot;BC&quot;);\nSecurity.insertProviderAt(new BouncyCastleProvider(), 1);\n</code></pre>\n<ol start=\"3\">\n<li>Verified the provider order via logging.</li>\n<li>Verified keystore integrity using <code>keytool -list</code>.</li>\n<li>Recreated the entire environment locally â€” issue only appears on Oracle JDK 21.</li>\n</ol>\n<p><strong>Expected result</strong></p>\n<ul>\n<li>BKS keystore should load successfully on Oracle JDK 21, same as OpenJDK 21.</li>\n</ul>\n<p><strong>Actual result</strong></p>\n<ul>\n<li>Oracle JDK 21 always throws <code>UnrecoverableKeyException: no match</code>.</li>\n<li>OpenJDK 21 works without any issues.</li>\n</ul>\n<p><strong>Question</strong></p>\n<p>Is there a known incompatibility or restriction in Oracle JDK 21 related to the BouncyCastle <code>BKS</code> keystore type?</p>\n<p>Why does the same BKS keystore load correctly under OpenJDK 21 but fail under Oracle JDK 21, even with BouncyCastle inserted at provider position 1?</p>\n<p>What is the correct way to make Oracle JDK 21 load a BKS keystore reliably?</p>\n",
    "tags" : [ "java", "jboss", "java-21" ],
    "owner" : {
      "account_id" : 12861581,
      "reputation" : 347,
      "user_id" : 9303161,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/4zhu4.jpg?s=256",
      "display_name" : "Thilina Sandaruwan",
      "link" : "https://stackoverflow.com/users/9303161/thilina-sandaruwan"
    },
    "is_answered" : false,
    "view_count" : 87,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1765272356,
    "creation_date" : 1765189656,
    "link" : "https://stackoverflow.com/questions/79840829/bouncycastle-bks-keystore-fails-to-load-on-oracle-jdk-21-but-works-on-openjdk-21",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140893668,
    "post_id" : 79840829,
    "body" : "(4) Verification: For each test (TEST-1 through TEST-4), observe and report whether the <code>App.java</code> program can successfully read the specified keystore file.",
    "score" : 1,
    "owner" : {
      "account_id" : 26698569,
      "reputation" : 4090,
      "user_id" : 20306007,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/98bbc403493aee3681b71dae7abef66e?s=256&d=identicon&r=PG",
      "display_name" : "life888888",
      "link" : "https://stackoverflow.com/users/20306007/life888888"
    },
    "creation_date" : 1765260887,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140893667,
    "post_id" : 79840829,
    "body" : "(3) The <code>App.java</code> program will be executed in four scenarios to test cross-compatibility between the different JDKs and keystores: (3-a) TEST-1: Oracle JDK 21 reads <code>my-keystore-oracle-jdk-21.bks</code>. (3-b) TEST-2: Oracle JDK 21 reads <code>my-keystore-open-jdk-21.bks</code>. (3-c) TEST-3: Open JDK 21 reads <code>my-keystore-oracle-jdk-21.bks</code>. (3-d) TEST-4: Open JDK 21 reads <code>my-keystore-open-jdk-21.bks</code>.",
    "score" : 1,
    "owner" : {
      "account_id" : 26698569,
      "reputation" : 4090,
      "user_id" : 20306007,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/98bbc403493aee3681b71dae7abef66e?s=256&d=identicon&r=PG",
      "display_name" : "life888888",
      "link" : "https://stackoverflow.com/users/20306007/life888888"
    },
    "creation_date" : 1765260872,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140893665,
    "post_id" : 79840829,
    "body" : "(2) Separate Keystore Generation: Generate two distinct keystore files, both using BouncyCastle 1.82, but each generated under a different JDK environment: (2-a) Oracle JDK Keystore: <code>my-keystore-oracle-jdk-21.bks</code> (Generated using Oracle JDK 21 + BouncyCastle 1.82) (2-b) Open JDK Keystore: <code>my-keystore-open-jdk-21.bks</code> (Generated using Open JDK 21 + BouncyCastle 1.82)",
    "score" : 1,
    "owner" : {
      "account_id" : 26698569,
      "reputation" : 4090,
      "user_id" : 20306007,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/98bbc403493aee3681b71dae7abef66e?s=256&d=identicon&r=PG",
      "display_name" : "life888888",
      "link" : "https://stackoverflow.com/users/20306007/life888888"
    },
    "creation_date" : 1765260850,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140893662,
    "post_id" : 79840829,
    "body" : "To simplify the problem and isolate the key issue (avoiding potential complications from an AP Server), please structure your test as follows:  (1) Direct Testing Program: Create a simple Java program named <code>App.java</code> using a standard <code>public static void main(String[] args)</code> method to conduct the tests directly.",
    "score" : 1,
    "owner" : {
      "account_id" : 26698569,
      "reputation" : 4090,
      "user_id" : 20306007,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/98bbc403493aee3681b71dae7abef66e?s=256&d=identicon&r=PG",
      "display_name" : "life888888",
      "link" : "https://stackoverflow.com/users/20306007/life888888"
    },
    "creation_date" : 1765260814,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140892884,
    "post_id" : 79840829,
    "body" : "Please edit your question and include the exact sub-version of the used Oracle/OpenJDK. In the stack trace the <code>XXX</code> were removed by you, correct? Why? This code is part if the JDK, so obfuscating he stack trace doesn&#39;t help.",
    "score" : 1,
    "owner" : {
      "account_id" : 50585,
      "reputation" : 43469,
      "user_id" : 150978,
      "user_type" : "registered",
      "accept_rate" : 78,
      "profile_image" : "https://www.gravatar.com/avatar/feadc214792e2581c3c750140e3eb2c7?s=256&d=identicon&r=PG",
      "display_name" : "Robert",
      "link" : "https://stackoverflow.com/users/150978/robert"
    },
    "creation_date" : 1765210129,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}