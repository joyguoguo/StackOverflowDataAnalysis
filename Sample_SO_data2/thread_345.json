{
  "question" : {
    "question_id" : 79819646,
    "title" : "Storing biometric data in a PDF without breaking the digital signature",
    "body" : "<p>I'm developing a tool that stores a signer's biometric data inside a PDF together with the digital signature, but I'm unsure where this information should be embedded.</p>\n<p>The biometric data is captured through a specialized signature pad, and I need to embed the dynamic/biometric data in the PDF at the moment the digital signature is applied.</p>\n<p>I first tried storing the data in custom metadata, but that doesn't seem like good practice. Then I attempted to place it in the signature dictionary, but Adobe marks the signature as invalid. I also tested storing it in an extended DSS, but modifying that structure wouldn't invalidate the signature.</p>\n<p>From what I understand, the correct approach would be to store the data somewhere <em>inside the signed PDF</em>, encrypted, such that any modification would break the signature. My plan is to encrypt the biometric data with AES-256 before embedding it.</p>\n<p>However, I haven't found much technical documentation on where this should be stored. Some providers offer this feature, but treat their implementations as a black box.</p>\n<p><strong>Where in the PDF file structure is it appropriate—and technically correct—to store encrypted biometric data so that it is covered by the digital signature?</strong></p>\n",
    "tags" : [ "java", "pdf", "cryptography", "itext", "digital-signature" ],
    "owner" : {
      "account_id" : 44670248,
      "reputation" : 23,
      "user_id" : 31874549,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/22fac435ead3dd43148ec2472ca30325?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "nex0",
      "link" : "https://stackoverflow.com/users/31874549/nex0"
    },
    "is_answered" : true,
    "view_count" : 161,
    "answer_count" : 2,
    "score" : 2,
    "last_activity_date" : 1763675241,
    "creation_date" : 1763093652,
    "link" : "https://stackoverflow.com/questions/79819646/storing-biometric-data-in-a-pdf-without-breaking-the-digital-signature",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79821561,
    "question_id" : 79819646,
    "body" : "<p>Interesting we are doing the same. There is at least one standard (which I know) which defines where to put this information. It is a standard in the German insurance industry so maybe not so widely known...</p>\n<blockquote>\n<p>first tried storing the data in custom metadata, but that doesn't seem like good practice.</p>\n</blockquote>\n<p>Where exactly did you try to put it?</p>\n<blockquote>\n<p>Then I attempted to place it in the signature dictionary, but Adobe marks the signature as invalid. I also tested storing it in an extended DSS, but modifying that structure wouldn't invalidate the signature.</p>\n</blockquote>\n<p>Both would be strange - any change to a signed PDF should result in an invalid signature.</p>\n<p>What did we do?</p>\n<ol>\n<li><p>Register a 2nd class prefix with the <a href=\"https://github.com/adobe/pdf-names-list\" rel=\"nofollow noreferrer\">ISO</a>. Why? It is possible to extend the standard to e.g. use your own keys.  (Syntax is: 4 letter (e.g. company name) + name of your attribute - like ADBE_biometricDataContainer</p>\n</li>\n<li><p>It makes sense to put the key in the Signature Dictionary since it is closely related to a signature</p>\n</li>\n<li><p>First record the biometric data, encrypt it and then store it as part of the signature and then sign the PDF. The order is important, since every change (except it is done in the append mode later) results in an invalid document</p>\n</li>\n</ol>\n<p>There are a lot of follow up questions. E.g. why use AES256? We use asymmetric encryption (encryption with the public key) so that only the private key owner can decrypt the (sensitive) biometric data. But this is a specific requirement in the whole chain of evidence.<br />\nAlso do you use the <a href=\"https://www.iso.org/standard/77910.html\" rel=\"nofollow noreferrer\">ISO standard</a> for biometric data? If not you should. You mentioned a signature pad, so 'Part 7: Signature/sign time series data' is the place you should look into...</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 2674923,
      "reputation" : 9967,
      "user_id" : 2311528,
      "user_type" : "registered",
      "accept_rate" : 59,
      "profile_image" : "https://i.sstatic.net/dLeM9.png?s=256",
      "display_name" : "Lonzak",
      "link" : "https://stackoverflow.com/users/2311528/lonzak"
    },
    "creation_date" : 1763307718,
    "last_activity_date" : 1763308028,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79825980,
    "question_id" : 79819646,
    "body" : "<p>That's exactly the approach we implemented, but we refined it a bit for performance and scalability. Here is how we did it:</p>\n<p><strong>1-</strong> Custom Dictionary Entry: We inject a custom key (e.g., /BiometricData) directly into the Signature Dictionary. As you pointed out, this is crucial because it inextricably links the biometric evidence to that specific signature instance. If the signature is invalidated, the link to the data is also broken.</p>\n<p><strong>2 -</strong> Indirect Object Storage: Instead of embedding the raw bytes directly in the dictionary, we store them as an Indirect Object (PDF Stream). The dictionary key just holds a reference (like 15 0 R) to that stream. This keeps the signature dictionary clean and allows us to store heavy biometric payloads (XML, pressure points, images) without breaking the PDF structure or bloating the dictionary itself.</p>\n<p><strong>3 -</strong> Hybrid Encryption (The &quot;Why AES?&quot; part): You asked why we use AES-256 if we already have asymmetric keys. The answer is Hybrid Encryption, and it's a necessity, not just a choice:</p>\n<p><strong>The Problem:</strong> Asymmetric encryption (RSA) is computationally expensive and, more importantly, has a hard size limit. You cannot directly encrypt a 50KB biometric XML file with a 2048-bit RSA key (it can only encrypt data smaller than the key size itself).</p>\n<p><strong>Our Solution:</strong></p>\n<p>We generate a random, ephemeral AES-256 key on the fly for each signature.</p>\n<p>We encrypt the heavy biometric payload with this AES key (which is super fast and has no size limit).</p>\n<p>We then encrypt only that tiny AES key with the RSA Public Key.</p>\n<p>We package both (the RSA-encrypted AES key + the AES-encrypted Payload) into the PDF Stream.</p>\n<p><strong>The Result:</strong> We get the speed and capacity of symmetric encryption (AES) combined with the security of asymmetric encryption (RSA). Only the holder of the private key can decrypt the AES key, and thus, only they can access the biometric data.</p>\n<p>This approach ensures the data is secure, legally binding (part of the signed structure), and technically robust enough to handle high-resolution biometric data without performance issues.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 44670248,
      "reputation" : 23,
      "user_id" : 31874549,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/22fac435ead3dd43148ec2472ca30325?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "nex0",
      "link" : "https://stackoverflow.com/users/31874549/nex0"
    },
    "creation_date" : 1763675241,
    "last_activity_date" : 1763675241,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140853938,
    "post_id" : 79819646,
    "body" : "<i>I first tried storing the data in custom metadata, but that doesn&#39;t seem like good practice</i> Sounds like a good approach to me. And if they were my biometric data, I&#39;d want them encrypted with my public key!",
    "score" : 1,
    "owner" : {
      "account_id" : 22124137,
      "reputation" : 4244,
      "user_id" : 16376827,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/1ImPw.png?s=256",
      "display_name" : "g00se",
      "link" : "https://stackoverflow.com/users/16376827/g00se"
    },
    "creation_date" : 1763115928,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140853622,
    "post_id" : 79819646,
    "body" : "<i>&quot;Then I attempted to place it in the signature dictionary, but Adobe marks the signature as invalid.&quot;</i> - you could try this road again. Others do it this way, too, and Acrobat accepts their signatures. So you simply appear to have made some mistake in your approach.",
    "score" : 0,
    "owner" : {
      "account_id" : 1916831,
      "reputation" : 97023,
      "user_id" : 1729265,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/VMMeP.jpg?s=256",
      "display_name" : "mkl",
      "link" : "https://stackoverflow.com/users/1729265/mkl"
    },
    "creation_date" : 1763102072,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140853608,
    "post_id" : 79819646,
    "body" : "Have you checked whether there are any standards for embedding such data in CMS signature containers as signed or unsigned attributes? If there are, you can use them for embedding, current PDF signature schemes work with CMS signature containers embedded in the PDF file after all.",
    "score" : 0,
    "owner" : {
      "account_id" : 1916831,
      "reputation" : 97023,
      "user_id" : 1729265,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/VMMeP.jpg?s=256",
      "display_name" : "mkl",
      "link" : "https://stackoverflow.com/users/1729265/mkl"
    },
    "creation_date" : 1763101346,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79821561" : [ {
      "comment_id" : 140866475,
      "post_id" : 79821561,
      "body" : "@nex0 The standard is called BiPRO 262. It is however not (yet) publicly available I fear. Regarding ISO there is an open source project which did implement it - maybe you can use it? <a href=\"https://github.com/szimek/signature_pad\" rel=\"nofollow noreferrer\">github.com/szimek/signature_pad</a>",
      "score" : 0,
      "owner" : {
        "account_id" : 2674923,
        "reputation" : 9967,
        "user_id" : 2311528,
        "user_type" : "registered",
        "accept_rate" : 59,
        "profile_image" : "https://i.sstatic.net/dLeM9.png?s=256",
        "display_name" : "Lonzak",
        "link" : "https://stackoverflow.com/users/2311528/lonzak"
      },
      "creation_date" : 1763738698,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140865209,
      "post_id" : 79821561,
      "body" : "Hi, thanks for the reply. I wasn’t aware of that. Could you clarify which standard you mean and where I can find its documentation? I stored the data in a custom PDF metadata field. I’m not using the ISO standard; I use Wacom’s proprietary format because their SDK is free. I may switch to ISO later when I can pay for the SDK. I’ll post my current solution in another answer so you can share your opinion.",
      "score" : 0,
      "owner" : {
        "account_id" : 44670248,
        "reputation" : 23,
        "user_id" : 31874549,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/22fac435ead3dd43148ec2472ca30325?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "nex0",
        "link" : "https://stackoverflow.com/users/31874549/nex0"
      },
      "creation_date" : 1763675182,
      "content_license" : "CC BY-SA 4.0"
    } ],
    "79825980" : [ {
      "comment_id" : 140866467,
      "post_id" : 79825980,
      "body" : "Regarding the key we also use hybrid encryption - so that is a valid approach. For the rest note mkl comments regarding direct/indirect objects etc.",
      "score" : 0,
      "owner" : {
        "account_id" : 2674923,
        "reputation" : 9967,
        "user_id" : 2311528,
        "user_type" : "registered",
        "accept_rate" : 59,
        "profile_image" : "https://i.sstatic.net/dLeM9.png?s=256",
        "display_name" : "Lonzak",
        "link" : "https://stackoverflow.com/users/2311528/lonzak"
      },
      "creation_date" : 1763738469,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140865619,
      "post_id" : 79825980,
      "body" : "<i>&quot;custom key (e.g., /BiometricData)&quot;</i> - when introducing custom keys, please consider Annex E of ISO 32000-2 and use a second class name with a prefix registered to you, see also item 1 in Lonzak&#39;s answer.",
      "score" : 0,
      "owner" : {
        "account_id" : 1916831,
        "reputation" : 97023,
        "user_id" : 1729265,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/VMMeP.jpg?s=256",
        "display_name" : "mkl",
        "link" : "https://stackoverflow.com/users/1729265/mkl"
      },
      "creation_date" : 1763705468,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140865607,
      "post_id" : 79825980,
      "body" : "<i>&quot;Indirect Object Storage&quot;</i> - beware, according to the PDF specification <i>all values in the signature dictionary shall be direct objects</i> <i>(ISO 32000-2 section 12.8.1)</i>. PDF (signature or format) validators, therefore,  may reject a PDF with indirect objects in it.  I&#39;d at least make the <i>immediate entries</i> in the signature dictionary direct. You could consider using a dictionary as direct value of your private key and only inside that dictionary of yours refer to the indirect stream object.",
      "score" : 0,
      "owner" : {
        "account_id" : 1916831,
        "reputation" : 97023,
        "user_id" : 1729265,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/VMMeP.jpg?s=256",
        "display_name" : "mkl",
        "link" : "https://stackoverflow.com/users/1729265/mkl"
      },
      "creation_date" : 1763705005,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}