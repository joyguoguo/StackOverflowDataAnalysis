{
  "question" : {
    "question_id" : 79564555,
    "title" : "Does Spring Boot MVC RestClient support returning SSE in Flux type for streaming data?",
    "body" : "<p>We know that in Spring WebFlux, SSE data can be handled elegantly. This is due to the support of the Flux type and the reactive WebClient client.</p>\n<pre><code>   @GetMapping(value = &quot;/chat&quot;, produces = MediaType.TEXT_EVENT_STREAM_VALUE)\n    public Flux&lt;String&gt; streamChatResponses() {\n        //eg: call openai\n        return webClient.post()\n                .uri(&quot;/chat/completions&quot;) \n                .contentType(MediaType.APPLICATION_JSON)\n                .bodyValue(requestBody)\n                .retrieve()\n                .bodyToFlux(String.class);\n    }\n</code></pre>\n<p>For Spring Boot MVC (Servlet) projects, we can introduce Spring AI to achieve the Flux stream type, enabling controllers to return SSE data. However, there is always a lack of an HttpClient that supports the Flux type.</p>\n<pre><code>&lt;dependency&gt;\n            &lt;groupId&gt;com.alibaba.cloud.ai&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-ai-alibaba-starter&lt;/artifactId&gt;\n           \n &lt;/dependency&gt;\n\n\n@RestController\npublic class SseController {\n\n    @GetMapping(value = &quot;/sse&quot;, produces = MediaType.TEXT_EVENT_STREAM_VALUE)\n    public Flux&lt;String&gt; streamEvents() {\n        //[[TODO]] :Whether RestClient or RestTemplate supports returning SSE in Flux type ?\n        return Flux.interval(Duration.ofSeconds(1))\n                   .map(sequence -&gt; &quot;SSE Event - &quot; + LocalTime.now());\n    }\n}\n</code></pre>\n<p><strong>In a Spring Boot (Servlet) project, is there a client that supports Flux data streams without introducing the WebFlux dependency?</strong></p>\n<p><em>The original implementation is very rudimentary, requiring manual handling of JSON conversion and setting response information.</em></p>\n<pre><code> @GetMapping(&quot;/sse-stream-old-code&quot;)\n    public void streamSse(HttpServletResponse response) {\n        response.setContentType(&quot;text/event-stream&quot;);\n        response.setCharacterEncoding(StandardCharsets.UTF_8.name());\n\n        RestTemplate restTemplate = new RestTemplate();\n        String url = &quot;http://*******/chat_stream&quot;;\n\n        ResponseExtractor&lt;Void&gt; responseExtractor = restResponse -&gt; {\n            try (BufferedReader reader = new BufferedReader(new InputStreamReader(restResponse.getBody(), StandardCharsets.UTF_8))) {\n                String line;\n                while ((line = reader.readLine()) != null) {\n                    response.getWriter().write(&quot;data: &quot; + line + &quot;\\n\\n&quot;);\n                    response.getWriter().flush();\n                }\n            }\n            return null;\n        };\n\n        restTemplate.execute(url, HttpMethod.POST, null, responseExtractor);\n    }\n</code></pre>\n",
    "tags" : [ "java", "spring", "spring-boot", "spring-webflux", "spring-ai" ],
    "owner" : {
      "account_id" : 9148659,
      "reputation" : 463,
      "user_id" : 6803950,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6a1391d455ff78871000dacdd83ac490?s=256&d=identicon&r=PG",
      "display_name" : "zy_sun",
      "link" : "https://stackoverflow.com/users/6803950/zy-sun"
    },
    "is_answered" : false,
    "view_count" : 105,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1744207588,
    "creation_date" : 1744207588,
    "link" : "https://stackoverflow.com/questions/79564555/does-spring-boot-mvc-restclient-support-returning-sse-in-flux-type-for-streaming",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140316512,
    "post_id" : 79564555,
    "body" : "No it won&#39;t and no it isn&#39;t strange. The <code>RestClient</code> uses the same underlying infrastructure as the <code>RestTemplate</code> does it is just a different API. You can also just include the <code>spring-webflux</code> dependency but without a concrete Reactive implementation that doesn&#39;t do much.",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1744208478,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140316501,
    "post_id" : 79564555,
    "body" : "Introducing both spring-boot-starter-web and spring-boot-starter-webflux simultaneously seems very strange. I hope the newly released RestClient can solve this problem in the future. @M.Deinum",
    "score" : 0,
    "owner" : {
      "account_id" : 9148659,
      "reputation" : 463,
      "user_id" : 6803950,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6a1391d455ff78871000dacdd83ac490?s=256&d=identicon&r=PG",
      "display_name" : "zy_sun",
      "link" : "https://stackoverflow.com/users/6803950/zy-sun"
    },
    "creation_date" : 1744208253,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140316466,
    "post_id" : 79564555,
    "body" : "That is what Spring Webflux is for, use it. Nothing prevents you from using <code>WebClient</code> in a regular Spring MVC application. Just add the dependency use the <code>WebClient</code> (as intended) and configure Spring Boot to start as a servlet application.",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1744207805,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}