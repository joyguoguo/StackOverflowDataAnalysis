{
  "question" : {
    "question_id" : 79792966,
    "title" : "RestEasy mapping Client vs. Server Exceptions",
    "body" : "<p>We're using, for historic reasons, RestEasy 5.0.10 here in some services and I problem sometimes:</p>\n<p>When the user send bad input, be it wrongly formatted json, wrong types for <code>@FormParam</code>s or whatever, typically we want to return 400 with the underlying message. Not a huge problem with <code>ExceptionMapper</code>s, can be done.</p>\n<p>In case of <code>@FormParam</code> problems, for example, RestEasy already throws nice <code>BadRequestExceptions</code> when this happens, so an <code>ExceptionMapper</code> can simply return the response of them.</p>\n<p>But we also use RestEasy for further api calls, so, for example...</p>\n<ul>\n<li>User A calls (our) service X</li>\n<li>Service X calls service Y (may or may not be ours)</li>\n</ul>\n<p>Now, when a <code>BadRequestException</code> occurs, one of two possibilities can be true (ignoring catching exception in between):</p>\n<ul>\n<li>The the request from User A was somehow &quot;wrong&quot;</li>\n<li>The the request service X sent to service Y was somehow &quot;wrong&quot;</li>\n</ul>\n<p>Both cases would result in a <code>BadRequestException</code>.</p>\n<p>So the question is, can I somehow differentiate between the first and the second case, since in the second case, I would prefer a 500 error instead of a 400 seen by the user? What I can, of course, do is parse the stacktrace and see if it happened in a client or core library, but honestly, that seems... unwise.</p>\n<p>So does RestEasy have a good way of knowing which exceptions happened before they reach our code (when processing the request on a purely technical level) and which exceptions happen afterward, in the &quot;business&quot; code, so to speak?</p>\n<hr />\n<p>Example... Let's assume we provide an arbitrary api endpoint, defined by...</p>\n<pre><code>@POST\n@Path(&quot;someEndpoint&quot;)\n@Consumes(MediaType.APPLICATION_FORM_URLENCODED)\nString someMethod(@FormParam(&quot;id&quot;) long id, @FormParam(&quot;status&quot;) String status);\n</code></pre>\n<p>Sending, for example &quot;abc&quot; as <code>id</code> would result in a BadRequestException (wrapping the Long.parse Exception) the services that goes into my ExceptionMapper and can, of course, be directly given to the client as the included 400 Response. No real problem here... Imagine now this being implemented in my code...</p>\n<pre><code>public String someMethod(long id, String status) {\n    // do some random stuff\n\n    // now let's build a (RestEasy) client via clientBuilder...\n    var client = clientBuilder.build().target(thirdPartyBaseUrl).proxy(clientClass);\n   \n    var existingObjects = client.get(new ArbitraryFilterDto(status));\n\n    // etc.\n}\n</code></pre>\n<p>Now assume that there is a bug in my <code>ArbitraryFilterDto</code> mapping and the call to the client under <code>thirdPartyBaseUrl</code> leads to a 400 response. This ALSO gets translated into a <code>BadRequestException</code>. But THIS one I of course do not want to send to MY client, since it's not really their problem and nothing they can fix.</p>\n<p>What I can do here is add code to my ExceptionMapper and do something like...</p>\n<pre><code>boolean isClientException = Arrays.stream(webApplicationException.getStackTrace())\n.anyMatch(s -&gt; s.getClassName().startsWith(&quot;org.jboss.resteasy.client&quot;));\n</code></pre>\n<p>...by relying on the fact that the client stack will be org.jboss.resteasy.client.*, but honestly, that sounds... awful.</p>\n",
    "tags" : [ "java", "resteasy" ],
    "owner" : {
      "account_id" : 5955901,
      "reputation" : 10682,
      "user_id" : 4682610,
      "user_type" : "registered",
      "accept_rate" : 29,
      "profile_image" : "https://i.sstatic.net/sMhnZ.jpg?s=256",
      "display_name" : "Florian Schaetz",
      "link" : "https://stackoverflow.com/users/4682610/florian-schaetz"
    },
    "is_answered" : false,
    "view_count" : 42,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1760859373,
    "creation_date" : 1760695214,
    "link" : "https://stackoverflow.com/questions/79792966/resteasy-mapping-client-vs-server-exceptions",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140814340,
    "post_id" : 79792966,
    "body" : "That is exactly the question here. Personally, I now find it bad design to have server and client code throw the same exception for basically two different things.",
    "score" : 0,
    "owner" : {
      "account_id" : 5955901,
      "reputation" : 10682,
      "user_id" : 4682610,
      "user_type" : "registered",
      "accept_rate" : 29,
      "profile_image" : "https://i.sstatic.net/sMhnZ.jpg?s=256",
      "display_name" : "Florian Schaetz",
      "link" : "https://stackoverflow.com/users/4682610/florian-schaetz"
    },
    "creation_date" : 1761287145,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140807107,
    "post_id" : 79792966,
    "body" : "As it is a legitimate case that your business code throws a <code>BadRequestException</code> if it detects wrong input (not just by the validation, could also be a wrong state of an object e.g.), how would your exception handler differentiate between exceptions from your business code and from outside calls?",
    "score" : 0,
    "owner" : {
      "account_id" : 3391382,
      "reputation" : 5350,
      "user_id" : 2846138,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/2sp68.png?s=256",
      "display_name" : "cyberbrain",
      "link" : "https://stackoverflow.com/users/2846138/cyberbrain"
    },
    "creation_date" : 1760987882,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140806311,
    "post_id" : 79792966,
    "body" : "@cyberbrain If I did this, I could basically ignore the ExceptionHandler. What do I have an ExceptionHandler for that can transform everything nicely if I have to wrap try-catch around any critical method anyway? Sure I can wrap everything, no doubt, but it somewhat defeats the purpose of having an ExceptionHandler that could also take care of something like that. I would prefer only using try-catch when I can actually DO something about it, not to handle a problematic exception class tree.",
    "score" : 0,
    "owner" : {
      "account_id" : 5955901,
      "reputation" : 10682,
      "user_id" : 4682610,
      "user_type" : "registered",
      "accept_rate" : 29,
      "profile_image" : "https://i.sstatic.net/sMhnZ.jpg?s=256",
      "display_name" : "Florian Schaetz",
      "link" : "https://stackoverflow.com/users/4682610/florian-schaetz"
    },
    "creation_date" : 1760963234,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140805722,
    "post_id" : 79792966,
    "body" : "So you want to have a generic exception handling inside your <code>someMethod</code> for the <code>client.get(...)</code> call. Is this really RestEasy specific? What if you had used any other REST client framework? I would just wrap the <code>client.get</code> call in a try-catch and have either a specific exception handling or a translation of the caught exception.",
    "score" : 0,
    "owner" : {
      "account_id" : 3391382,
      "reputation" : 5350,
      "user_id" : 2846138,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/2sp68.png?s=256",
      "display_name" : "cyberbrain",
      "link" : "https://stackoverflow.com/users/2846138/cyberbrain"
    },
    "creation_date" : 1760942161,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140804591,
    "post_id" : 79792966,
    "body" : "@cyberbrain Added an example, not quite complete, but I hope it makes the case clear.",
    "score" : 0,
    "owner" : {
      "account_id" : 5955901,
      "reputation" : 10682,
      "user_id" : 4682610,
      "user_type" : "registered",
      "accept_rate" : 29,
      "profile_image" : "https://i.sstatic.net/sMhnZ.jpg?s=256",
      "display_name" : "Florian Schaetz",
      "link" : "https://stackoverflow.com/users/4682610/florian-schaetz"
    },
    "creation_date" : 1760859467,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140804589,
    "post_id" : 79792966,
    "body" : "@JamesR.Perkins 5.0.10 currently, upgrade planned (and any solution requiring an update is totally fine, not a critical issue).",
    "score" : 0,
    "owner" : {
      "account_id" : 5955901,
      "reputation" : 10682,
      "user_id" : 4682610,
      "user_type" : "registered",
      "accept_rate" : 29,
      "profile_image" : "https://i.sstatic.net/sMhnZ.jpg?s=256",
      "display_name" : "Florian Schaetz",
      "link" : "https://stackoverflow.com/users/4682610/florian-schaetz"
    },
    "creation_date" : 1760859436,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140802882,
    "post_id" : 79792966,
    "body" : "Not a good answer, but I don&#39;t think there is anything specific in RESTEasy. However, which version are you using? I can definitely have a look.",
    "score" : 0,
    "owner" : {
      "account_id" : 51161,
      "reputation" : 17960,
      "user_id" : 152794,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/eX5Ms.jpg?s=256",
      "display_name" : "James R. Perkins",
      "link" : "https://stackoverflow.com/users/152794/james-r-perkins"
    },
    "creation_date" : 1760739529,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140801698,
    "post_id" : 79792966,
    "body" : "can you provide some <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> for the case &quot;Service X calls service Y&quot;?",
    "score" : 0,
    "owner" : {
      "account_id" : 3391382,
      "reputation" : 5350,
      "user_id" : 2846138,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/2sp68.png?s=256",
      "display_name" : "cyberbrain",
      "link" : "https://stackoverflow.com/users/2846138/cyberbrain"
    },
    "creation_date" : 1760699899,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}