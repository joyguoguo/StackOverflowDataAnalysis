{
  "question" : {
    "question_id" : 79839168,
    "title" : "Gradle does not add the correct main-class entry in the manifest.mf file",
    "body" : "<p>I have tried for days now to get the Gradle build to produce a Spring Boot jar file that will run. Everything builds ok except for one thing. Gradle does not put the correct main-class entry in the manifest.mf file. It puts:</p>\n<pre><code>Main-Class: org.springframework.boot.loader.JarLauncher\ninstead of:\nMain-Class: org.springframework.boot.loader.PropertiesLauncher\n</code></pre>\n<p>in the manifest file. No matter what I've tried so far that Gradle accepts as a properly formatted build.gradle file, will produce a manifest.mf file with that one entry that I need the PropertiesLauncher class.</p>\n<p>I've tried every example I could fine with Google in my build.gradle file. It builds fine but refuses to add the correct main-class entry in the manifest.</p>\n<p>If I manually add the main-class entry in the file and splice it back into the jar everything work fine. My program launches just fine and everything is great. This is a multi-project Gradle build.</p>\n<p>The following is my gutted build.gradle. There is some possible proprietary stuff in it, and delete hopefully unnecessary stuff. I'm hopping there is enough here for analysis. If more is needed I might have to cough up more info. Hopefully most of what's needed is in the bootJar task.</p>\n<pre><code>import java.text.SimpleDateFormat\n\nimport java.nio.file.Files;\nimport java.nio.file.Paths;\nimport java.nio.file.StandardCopyOption;\nimport java.nio.file.StandardCopyOption\n\nplugins {\n//    id 'org.springframework.boot' version '3.2.0'\n    id 'application'\n    id 'java'\n    alias(libs.plugins.springBootPlugin)\n//    alias(libs.plugins.springDependencyManagementPlugin)\n//    id 'org.springframework.boot' version '3.2.0' // Apply the Spring Boot plugin\n    id 'io.spring.dependency-management' version '1.1.4' // Recommended for managing Spring Boot dependencies\n}\n\napplication {\n    mainClass = 'org.springframework.boot.loader.PropertiesLauncher' \n}\n//mainClassName = 'org.springframework.boot.loader.PropertiesLauncher'\n\njava {\n  sourceCompatibility = JavaVersion.VERSION_1_8\n  targetCompatibility = JavaVersion.VERSION_1_8\n}\n\napply plugin: 'org.springframework.boot'\n\next{\n  group   = rootProject.properties.get('groupId')\n//  version = rootProject.properties.get('cupps.platform.version')\n}\n\nconfigurations {\n    wrapperservice\n}\n\next {\n}\n\ndependencies {\n            \n    // The following JMX stuff does not exist on Maven anymore.\n    // So we get them from maven-releases on our Nexus repository\n    implementation 'com.sun.jmx:jmxri:1.2.1'\n    implementation 'com.sun.jdmk:jmxtools:1.2.1'\n    implementation 'javax.management:jmxremote:1.0.1_04'\n}\n\ntasks.named(&quot;compileJava&quot;) {\n}\n\n// To disable the standard 'jar' task if you only want the bootJar\njar {\n    enabled = false\n}\n\n// Configuring the Main Class\n// https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/htmlsingle/#packaging-executable.configuring.main-class\ntasks.named(&quot;bootJar&quot;) {\n\n    archiveFileName = &quot;${artifactId}-${project.property('cupps.platform.version')}.jar&quot; \n    println &quot;version2: &quot; + &quot;${artifactId}-${project.property('cupps.platform.version')}.jar&quot; \n\n    duplicatesStrategy = DuplicatesStrategy.EXCLUDE\n\n    //mainClassName = 'com.arinc.afd.cupps.Application'   // For Spring Boot Gradle Plugin version 2.6.x and above\n//    mainClassName = 'org.springframework.boot.loader.PropertiesLauncher' // For Spring Boot Gradle Plugin version 2.5.x and below\n\n    exclude ('**/batik*.*')\n    exclude ('**/service-wrapper.zip')\n    \n    // To include the properties files, conf files, and xml file, etc under the resources folder into the JAR file.\n    from sourceSets.main.resources\n\n// 'Main-Class': 'org.springframework.boot.loader.PropertiesLauncher'\n\n    manifest {\n        attributes (\n                'Start-Class' : 'com.arinc.afd.cupps.Application',\n                'Built-By' : &quot;${builtBy}&quot;,\n                'Build-Timestamp': new SimpleDateFormat(&quot;yyyy-MM-dd'T'HH:mm:ss.SSSZ&quot;).format(new Date()),\n                'Build-OS' : &quot;${System.properties['os.name']} ${System.properties['os.arch']} ${System.properties['os.version']}&quot;,\n                'Created-By' : &quot;${createdBy}&quot;,\n                'Specification-Title' : &quot;${specTitle}&quot;,\n                'Specification-Vendor' : &quot;${specVendor}&quot;,\n                'Specification-Version' : &quot;${specVersion}&quot;,\n                'Implementation-Title' : &quot;${implementTitle}&quot;,\n                'Implementation-Vendor' : &quot;${implementVendor}&quot;,\n                'Implementation-Version' : &quot;${implementVersion}&quot;,\n        )\n    }\n}\n\nI forgot to add one very important item here. I'm using Spring Boot 2.2.13.\n\nIn rely to Robert and Murrat I can use layout in this version of Spring Boot because is has been deprecated. However, I tried it anyway and the build failed immediately with the error - &quot;Cannot set the value of read-only property 'layout' for root project 'demo' of type org.gradle.api.Project.&quot;. Layout is for Spring Boot version 1.4 or earlier I believe.\n\n</code></pre>\n",
    "tags" : [ "java", "spring", "gradle", "boot" ],
    "owner" : {
      "account_id" : 1534311,
      "reputation" : 59,
      "user_id" : 1430752,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/248d54f4af0ca39386c7eeaf8013acb9?s=256&d=identicon&r=PG",
      "display_name" : "Al Harper",
      "link" : "https://stackoverflow.com/users/1430752/al-harper"
    },
    "is_answered" : false,
    "view_count" : 47,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1765152060,
    "creation_date" : 1764956361,
    "link" : "https://stackoverflow.com/questions/79839168/gradle-does-not-add-the-correct-main-class-entry-in-the-manifest-mf-file",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79839247,
    "question_id" : 79839168,
    "body" : "<p>Have you tried to configure the main class as documented? <a href=\"https://docs.spring.io/spring-boot/docs/2.1.17.RELEASE/gradle-plugin/reference/html/#packaging-executable-configuring-main-class\" rel=\"nofollow noreferrer\">https://docs.spring.io/spring-boot/docs/2.1.17.RELEASE/gradle-plugin/reference/html/#packaging-executable-configuring-main-class</a></p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 50585,
      "reputation" : 43469,
      "user_id" : 150978,
      "user_type" : "registered",
      "accept_rate" : 78,
      "profile_image" : "https://www.gravatar.com/avatar/feadc214792e2581c3c750140e3eb2c7?s=256&d=identicon&r=PG",
      "display_name" : "Robert",
      "link" : "https://stackoverflow.com/users/150978/robert"
    },
    "creation_date" : 1764962823,
    "last_activity_date" : 1764962823,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79840303,
    "question_id" : 79839168,
    "body" : "<p>The problem is that setting Main-Class directly in the manifest attributes doesn't work because the Spring Boot plugin overwrites it based on the configured layout. The solution is to set the layout property on the bootJar task. To get PropertiesLauncher, you need to use the ZIP layout:</p>\n<pre><code>tasks.named(&quot;bootJar&quot;) {\n    layout = 'ZIP'  // This tells Spring Boot to use PropertiesLauncher\n    \n    archiveFileName = &quot;${artifactId}-${project.property('cupps.platform.version')}.jar&quot;\n    duplicatesStrategy = DuplicatesStrategy.EXCLUDE\n    \n    // ...\n    \n    manifest {\n        attributes(\n            'Start-Class': 'com.arinc.afd.cupps.Application',\n            // Don't set Main-Class here - the layout handles it\n            'Built-By': &quot;${builtBy}&quot;,\n            // ... \n        )\n    }\n}\n</code></pre>\n<p>Also, remove the application plugin and its mainClass setting - those are for non-Spring Boot applications and can cause conflicts.</p>\n<p>Remove application block entirely.</p>\n<p>Remove id:application in plugin block.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 25583936,
      "reputation" : 1527,
      "user_id" : 19361968,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/1d19c6d51232c67af617cf944af5a30c?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Murat K.",
      "link" : "https://stackoverflow.com/users/19361968/murat-k"
    },
    "creation_date" : 1765119521,
    "last_activity_date" : 1765119521,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}