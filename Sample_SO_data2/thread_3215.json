{
  "question" : {
    "question_id" : 79566898,
    "title" : "JVM doesn&#39;t terminate when using Spring Batch and force System.exit(0)",
    "body" : "<p>To put it in context, I have a Spring batch application and before executing the steps and loading beans I want to check the databases (I use Mongo and MySQL).</p>\n<p>The idea is to avoid Control-M warnings due to database unavailability. I wrote the following code and it works very well on Windows, but on Linux the JVM does not finish, even when reaching System.exit(0). And this is strange because Java's idea is to write once...</p>\n<p>`</p>\n<pre><code>@SpringBootApplication public class DemoApplication {\n    @PostConstructor\n    public void checkDataBaseConnection() {\n        // method for check mongoDB\n    // method for check mysql\n\n    if(database unavailable) {\n        System.exit(0); // The idea is to avoid notifications due to momentary database unavailability.\n        // It works on Windows, on Linux the JVM continues to run.\n    }\n    }\n\n    public static void main(String[] args) {\n    SpringApplication app = new SpringApplication(DemoApplication.class);\n    app.setWebApplicationType(WebApplicationType.NONE);\n    app.run(DemoApplication.class, args);\n    }\n}\n</code></pre>\n<p>`</p>\n<p>This indicates that there are blocking threads, is there any way to get around this? I've tried every way. And why does this behavior work well on Windows and not on Linux? Is it an architectural issue? So in post-construct there may be non-daemon threads and that is causing this?</p>\n",
    "tags" : [ "java", "spring-boot", "spring-framework-beans" ],
    "owner" : {
      "account_id" : 19129288,
      "reputation" : 1,
      "user_id" : 14585666,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d42931671862613b89a4ac86e0958c12?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "cmms",
      "link" : "https://stackoverflow.com/users/14585666/cmms"
    },
    "is_answered" : true,
    "view_count" : 83,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1744350578,
    "creation_date" : 1744294312,
    "link" : "https://stackoverflow.com/questions/79566898/jvm-doesnt-terminate-when-using-spring-batch-and-force-system-exit0",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79566985,
    "question_id" : 79566898,
    "body" : "<p>Use <code>SpringApplication.exit</code> and then <code>System.exit</code>.</p>\n<pre class=\"lang-java prettyprint-override\"><code>if (databaseUnavailable) {\n    int exitCode = SpringApplication.exit(ctx, () -&gt; 0);\n    System.exit(exitCode);\n}\n</code></pre>\n",
    "score" : 3,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 16477377,
      "reputation" : 3147,
      "user_id" : 12283863,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/sNtbo.png?s=256",
      "display_name" : "Rawley Fowler",
      "link" : "https://stackoverflow.com/users/12283863/rawley-fowler"
    },
    "creation_date" : 1744296480,
    "last_activity_date" : 1744296480,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140320912,
    "post_id" : 79566898,
    "body" : "<i>System.exit(0) may not get honored immediately due to shutdown hooks, non-daemon threads, or exception swallowing in native wrappers (especially with Docker or init systems on Linux).</i>",
    "score" : 1,
    "owner" : {
      "account_id" : 2465829,
      "reputation" : 13627,
      "user_id" : 2148953,
      "user_type" : "registered",
      "accept_rate" : 96,
      "profile_image" : "https://i.sstatic.net/DVHoP84E.jpg?s=256",
      "display_name" : "aran",
      "link" : "https://stackoverflow.com/users/2148953/aran"
    },
    "creation_date" : 1744295648,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140320909,
    "post_id" : 79566898,
    "body" : "This is Springboot&#39;s non-daemon threads&#39; fault. One or more are created before System.exit(0) is processed. You shouldn&#39;t use System.exit(0) when using springboot, which I hate btw but that&#39;s a personal oppinion",
    "score" : 1,
    "owner" : {
      "account_id" : 2465829,
      "reputation" : 13627,
      "user_id" : 2148953,
      "user_type" : "registered",
      "accept_rate" : 96,
      "profile_image" : "https://i.sstatic.net/DVHoP84E.jpg?s=256",
      "display_name" : "aran",
      "link" : "https://stackoverflow.com/users/2148953/aran"
    },
    "creation_date" : 1744295567,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140320880,
    "post_id" : 79566898,
    "body" : "Oops, I wrote the code off the top of my head, I can&#39;t share the actual code. But the bug was actually fixed.",
    "score" : 0,
    "owner" : {
      "account_id" : 19129288,
      "reputation" : 1,
      "user_id" : 14585666,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d42931671862613b89a4ac86e0958c12?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "cmms",
      "link" : "https://stackoverflow.com/users/14585666/cmms"
    },
    "creation_date" : 1744295262,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140320844,
    "post_id" : 79566898,
    "body" : "I doubt this is the actual code. As you do <code>System.out</code> and not <code>System.exit</code> next to that you have <code>SpringApplication.run</code> which probably should be <code>app.run</code> else your other setup is useless. So please include the actual code.",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1744294764,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}