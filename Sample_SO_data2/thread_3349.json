{
  "question" : {
    "question_id" : 79556664,
    "title" : "Is something more flexible than Flux.collectMap(function, function) with null skip value?",
    "body" : "<p>There is useful, but not enough smart method:\n<code>reactor.core.publisher.Flux#collectMap(java.util.function.Function&lt;? super T,? extends K&gt;, java.util.function.Function&lt;? super T,? extends V&gt;)</code></p>\n<p>It can return <code>Mono&lt;Map&lt;Object,Object&gt;</code> with <code>null</code> value. So the question is: how to implement method to filter / skip such a null value (only value, not key) during conversion from Flux? Example code:</p>\n<pre><code>    public Mono&lt;Map&lt;String, String&gt;&gt; askForHeaders(String urlBase, String token, List&lt;String&gt; paths) {\n        try {\n            ClientImpl clientBase = ClientImpl.getClient(urlBase, token, wiretapEnabled);\n            return clientBase.getHeadersByEndPathsExt(paths)\n                    .collectMap(HttpHeadersExt::getPathExt,\n                            this::recognizeRedirection // can be null?\n                    );\n        } catch (Exception e) {\n            log.error(&quot;Url check error {}! &lt;&lt;&quot;, e.getMessage(), e.getCause());\n            return Mono.empty();\n        }\n    }\n</code></pre>\n<p><code>recognizeRedirection</code> method example:</p>\n<pre><code>    private String recognizeRedirection(HttpHeadersExt aHeaders) {\n        return aHeaders.toSingleValueMap().entrySet().stream()\n                .filter(Objects::nonNull)\n                .filter(e -&gt; e.getKey().equals(&quot;Location&quot;))\n                .findFirst().map(Map.Entry::getValue).orElse(null);\n    }\n</code></pre>\n<p><code>HttpHeadersExt</code> utility class example:</p>\n<pre><code>\n@Getter\npublic class HttpHeadersExt extends HttpHeaders {\n\n    private final String pathExt;\n\n    public HttpHeadersExt(MultiValueMap&lt;String, String&gt; headers, String pathExt) {\n        super(headers);\n        this.pathExt = pathExt;\n    }\n}\n</code></pre>\n",
    "tags" : [ "java", "function", "project-reactor", "flux" ],
    "owner" : {
      "account_id" : 40775716,
      "reputation" : 51,
      "user_id" : 29947528,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/a7ffd00f260bcd32c64499c46d73a5bd?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Ainz Sama",
      "link" : "https://stackoverflow.com/users/29947528/ainz-sama"
    },
    "is_answered" : false,
    "view_count" : 55,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1743842701,
    "creation_date" : 1743837033,
    "link" : "https://stackoverflow.com/questions/79556664/is-something-more-flexible-than-flux-collectmapfunction-function-with-null-sk",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140301894,
    "post_id" : 79556664,
    "body" : "Please <a href=\"https://stackoverflow.com/posts/79556664/edit\">edit</a> your question to include your source code as a working <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>, which can be compiled and tested by others to provide an answer faster.",
    "score" : 0,
    "owner" : {
      "account_id" : 108033,
      "reputation" : 20089,
      "user_id" : 286934,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f16a184d26b72795ff243464d715cffe?s=256&d=identicon&r=PG",
      "display_name" : "Progman",
      "link" : "https://stackoverflow.com/users/286934/progman"
    },
    "creation_date" : 1743839106,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140301893,
    "post_id" : 79556664,
    "body" : "Please <a href=\"https://stackoverflow.com/posts/79556664/edit\">edit</a> your question to include a description if it is feasible to filter the values before applying <code>collectMap()</code>.",
    "score" : 0,
    "owner" : {
      "account_id" : 108033,
      "reputation" : 20089,
      "user_id" : 286934,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f16a184d26b72795ff243464d715cffe?s=256&d=identicon&r=PG",
      "display_name" : "Progman",
      "link" : "https://stackoverflow.com/users/286934/progman"
    },
    "creation_date" : 1743839089,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}