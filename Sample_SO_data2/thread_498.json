{
  "question" : {
    "question_id" : 79804174,
    "title" : "Java 21 multi-key map collector",
    "body" : "<p>In my Java 21+ projects, I often have objects with multiple unique keys maps that I keep in multi-key maps like below. How can I build a multi-key map using the stream collector?</p>\n<p>For example:</p>\n<pre><code>// id and symbol are guaranteed unique\nrecord Foo(int id, String symbol) {};\n</code></pre>\n<p>then I create a multi-key map:</p>\n<pre><code>    var fooA = new Foo(1, &quot;A&quot;);\n    var fooB = new Foo(2, &quot;B&quot;);\n    var fooList = List.of(fooA, fooB);\n\n    var fooMap = new HashMap&lt;Object,Foo&gt;();\n    for (var foo : fooList) {\n        fooMap.put(foo.id(), foo);\n        fooMap.put(foo.symbol(), foo);\n    }\n\n    assertThat(fooMap.get(1)).isEqualTo(fooA);\n    assertThat(fooMap.get(&quot;A&quot;)).isEqualTo(fooA);\n    assertThat(fooMap.get(2)).isEqualTo(fooB);\n    assertThat(fooMap.get(&quot;B&quot;)).isEqualTo(fooB);\n</code></pre>\n<p>What is the streams collector equivalent? Perhaps something like:</p>\n<pre><code>var fooMap = fooList.stream().collect(\n    Collectors.flatMapping(???...)\n    );\n</code></pre>\n<p>or with a custom <code>multiKeyMap</code> varargs helper:</p>\n<pre><code>var fooMap = fooList.stream().collect(\n    multiKeyMap(Function.identity(), Foo::id, Foo::symbol)\n    );\n</code></pre>\n<hr />\n<p>I'll summarize the solutions; I feel the &quot;best practice&quot; format difficult to read quickly in part because I cannot edit for clarity for also the visual noise of the comments vs. solutions:</p>\n<p><strong>@shmosel solution #1</strong>:</p>\n<pre><code>var fooMap = fooList.stream()\n    .map(foo -&gt; Map.of(foo.id(), foo, foo.symbol(), foo))\n    .collect(HashMap::new, Map::putAll, Map::putAll);\n</code></pre>\n<p><strong>@shmosel solution #2</strong>:</p>\n<pre><code>var fooMap = fooList.stream().collect(\n    HashMap::new,\n    (map, foo) -&gt; {\n        map.put(foo.id(), foo);\n        map.put(foo.symbol(), foo);\n    },\n    HashMap::putAll);\n</code></pre>\n",
    "tags" : [ "java", "java-stream", "collectors" ],
    "owner" : {
      "account_id" : 4068081,
      "reputation" : 11979,
      "user_id" : 3342253,
      "user_type" : "registered",
      "accept_rate" : 94,
      "profile_image" : "https://i.sstatic.net/bHXDR.jpg?s=256",
      "display_name" : "Jan Nielsen",
      "link" : "https://stackoverflow.com/users/3342253/jan-nielsen"
    },
    "is_answered" : true,
    "view_count" : 232,
    "answer_count" : 7,
    "score" : 1,
    "last_activity_date" : 1762743180,
    "creation_date" : 1761768128,
    "link" : "https://stackoverflow.com/questions/79804174/java-21-multi-key-map-collector",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79804186,
    "question_id" : 79804174,
    "body" : "<p>You could do something like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>.map(foo -&gt; Map.of(foo.id(), foo, foo.symbol(), foo))\n.collect(HashMap::new, Map::putAll, Map::putAll)\n</code></pre>\n<p>But this is a pretty ugly way to map data. Why keep all the keys in one structure instead of having one map for <code>id</code> and another for <code>symbol</code>?</p>\n",
    "score" : 3,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1691630,
      "reputation" : 51067,
      "user_id" : 1553851,
      "user_type" : "registered",
      "accept_rate" : 73,
      "profile_image" : "https://www.gravatar.com/avatar/ad333c218c8f2fb917cf506919fc95f4?s=256&d=identicon&r=PG",
      "display_name" : "shmosel",
      "link" : "https://stackoverflow.com/users/1553851/shmosel"
    },
    "creation_date" : 1761769024,
    "last_activity_date" : 1761769024,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79804217,
    "question_id" : 79804174,
    "body" : "<p>Moving logic from the map to the accumulator:</p>\n<pre><code>fooMap = fooList.stream().collect(\n    HashMap::new,\n    (map, foo) -&gt; {\n        map.put(foo.id(), foo);\n        map.put(foo.symbol(), foo);\n    },\n    HashMap::putAll\n);\n</code></pre>\n",
    "score" : 3,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 4068081,
      "reputation" : 11979,
      "user_id" : 3342253,
      "user_type" : "registered",
      "accept_rate" : 94,
      "profile_image" : "https://i.sstatic.net/bHXDR.jpg?s=256",
      "display_name" : "Jan Nielsen",
      "link" : "https://stackoverflow.com/users/3342253/jan-nielsen"
    },
    "creation_date" : 1761771528,
    "last_activity_date" : 1761772232,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79804195,
    "question_id" : 79804174,
    "body" : "<p>Yeah; I'm trying to avoid the <code>map</code> operation. As you note, I use two separate maps in most places but often is a bit tidier to just have one map with both keys.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 4068081,
      "reputation" : 11979,
      "user_id" : 3342253,
      "user_type" : "registered",
      "accept_rate" : 94,
      "profile_image" : "https://i.sstatic.net/bHXDR.jpg?s=256",
      "display_name" : "Jan Nielsen",
      "link" : "https://stackoverflow.com/users/3342253/jan-nielsen"
    },
    "creation_date" : 1761769524,
    "last_activity_date" : 1761769524,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79804199,
    "question_id" : 79804174,
    "body" : "<p>If you don't want to <code>map()</code>, you could replace the accumulator with</p>\n<pre class=\"lang-java prettyprint-override\"><code>(map, foo) -&gt; {\n    map.put(foo.id(), foo);\n    map.put(foo.symbol(), foo);\n}\n</code></pre>\n<p>But at this point it's hard to see how streaming is an improvement over a simple loop. What do you have against <code>map()</code> anyway?</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1691630,
      "reputation" : 51067,
      "user_id" : 1553851,
      "user_type" : "registered",
      "accept_rate" : 73,
      "profile_image" : "https://www.gravatar.com/avatar/ad333c218c8f2fb917cf506919fc95f4?s=256&d=identicon&r=PG",
      "display_name" : "shmosel",
      "link" : "https://stackoverflow.com/users/1553851/shmosel"
    },
    "creation_date" : 1761770169,
    "last_activity_date" : 1761770169,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79815147,
    "question_id" : 79804174,
    "body" : "<p>alternate could be to make use of `Map.entry`</p>\n<pre class=\"lang-java prettyprint-override\"><code>Map&lt;Object, Foo&gt; fooMap = fooList.stream()\n        .flatMap(e -&gt; Stream.of(Map.entry(e.id, e), Map.entry(e.symbol, e)))\n        .collect(Collectors.toMap(e -&gt; e.getKey(),\n                e -&gt; e.getValue(),\n                (a, b) -&gt; a));\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1939636,
      "reputation" : 32753,
      "user_id" : 1746118,
      "user_type" : "registered",
      "accept_rate" : 95,
      "profile_image" : "https://www.gravatar.com/avatar/dea2252138dd9905af87cd6803fb5665?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Naman",
      "link" : "https://stackoverflow.com/users/1746118/naman"
    },
    "creation_date" : 1762743180,
    "last_activity_date" : 1762743180,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79804212,
    "question_id" : 79804174,
    "body" : "<p>Probably just my style preference -- I prefer having the logic in the accumulator -- seem more like the imperative solution.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 4068081,
      "reputation" : 11979,
      "user_id" : 3342253,
      "user_type" : "registered",
      "accept_rate" : 94,
      "profile_image" : "https://i.sstatic.net/bHXDR.jpg?s=256",
      "display_name" : "Jan Nielsen",
      "link" : "https://stackoverflow.com/users/3342253/jan-nielsen"
    },
    "creation_date" : 1761771311,
    "last_activity_date" : 1761771311,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79804215,
    "question_id" : 79804174,
    "body" : "<p>If it's the imperative approach you're after, the original loop should do just fine.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1691630,
      "reputation" : 51067,
      "user_id" : 1553851,
      "user_type" : "registered",
      "accept_rate" : 73,
      "profile_image" : "https://www.gravatar.com/avatar/ad333c218c8f2fb917cf506919fc95f4?s=256&d=identicon&r=PG",
      "display_name" : "shmosel",
      "link" : "https://stackoverflow.com/users/1553851/shmosel"
    },
    "creation_date" : 1761771466,
    "last_activity_date" : 1761771466,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}