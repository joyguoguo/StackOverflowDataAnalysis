{
  "question" : {
    "question_id" : 79816327,
    "title" : "Jakarta CDI - Two &quot;Singletons&quot; of the same class",
    "body" : "<p>I'm new to injection frameworks. And my question is a contradiction in itself, but - hypothetically - is it possible to have CDI inject exactly 2 different instances of the same class throughout my code? Two singletons of one class so to speak? And if yes, what would the annotations look like? Producing two different @Named instances with @Produces methods?</p>\n<p>---- edit ----</p>\n<p>Here is what I came up with:</p>\n<pre><code>@Singleton\npublic final class StartupBean {\n  @Inject\n  StartupBean(SomeManager someManager) {\n    // nothing happening here\n  }\n\n  @Produces\n  @Named(&quot;fooObject&quot;)\n  public MyImplementation produceFooObject() {\n    return new MyImplementation();\n  }\n\n  @Produces\n  @Named(&quot;barObject&quot;)\n  public MyImplementation produceBarObject() {\n    return new MyImplementation();\n  }\n}\n\n\n// class implementing two interfaces\nfinal class MyImplementation \n    extends SomethingElse\n    implements MyInterface, MyOtherInterface {\n}\n\n// manager class using both named instances\n@Singleton\nfinal class SomeManager {\n  private final MyInterface foo;\n  private final MyInterface bar;\n\n  @Inject\n  SomeManager(\n      @Named(&quot;fooObject&quot;) MyInterface fooObject,\n      @Named(&quot;barObject&quot;) MyInterface barObject) {\n    this.foo = fooObject;\n    this.bar = barObject;\n    // stuff happening\n  }\n}\n\n// class using one of the object with different type\npublic final class ClassA {\n  private final MyOtherInterface bla;\n\n  @Inject\n  ClassA(@Named(&quot;fooObject&quot;) MyOtherInterface fooObject) {\n    this.bla = fooObject;\n  }\n}\n</code></pre>\n<p>But this causes a StackOverFlowError exception. Any suggestions?</p>\n",
    "tags" : [ "java", "jakarta-ee", "cdi" ],
    "owner" : {
      "account_id" : 11754933,
      "reputation" : 185,
      "user_id" : 8602917,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/C319F.png?s=256",
      "display_name" : "numberfourteen",
      "link" : "https://stackoverflow.com/users/8602917/numberfourteen"
    },
    "is_answered" : true,
    "view_count" : 103,
    "answer_count" : 5,
    "score" : 0,
    "last_activity_date" : 1762959198,
    "creation_date" : 1762845051,
    "link" : "https://stackoverflow.com/questions/79816327/jakarta-cdi-two-singletons-of-the-same-class",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79816375,
    "question_id" : 79816327,
    "body" : "<p>It doesnt look like a DI issue but more of a code design issue. StartupBean produces your two MyImplementations, but it also needs to inject a SomeManager during construction, but this manager needs the two MyImplementations... I m guessing the init is not complete and there is some sort of circular dependency? I would just delete the StartupBean constructor since nothing happens there</p>\n",
    "score" : 3,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 21724606,
      "reputation" : 1431,
      "user_id" : 16034206,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/MRBdT.jpg?s=256",
      "display_name" : "pebble unit",
      "link" : "https://stackoverflow.com/users/16034206/pebble-unit"
    },
    "creation_date" : 1762849002,
    "last_activity_date" : 1762849002,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79816337,
    "question_id" : 79816327,
    "body" : "<p>You answered it already yourself. Though it should not be a pure <strong>singleton</strong> class, where the java code takes care of the class being a singleton, one instance only.</p>\n",
    "score" : 2,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 960307,
      "reputation" : 110397,
      "user_id" : 984823,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Z2KYN.jpg?s=256",
      "display_name" : "Joop Eggen",
      "link" : "https://stackoverflow.com/users/984823/joop-eggen"
    },
    "creation_date" : 1762845768,
    "last_activity_date" : 1762845768,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79816379,
    "question_id" : 79816327,
    "body" : "<p>Ok, this suggestion removed the StackOverFlowError exception, but it also seems that the SomeManager is not being instantiated at all. Where would I do that instead?</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 11754933,
      "reputation" : 185,
      "user_id" : 8602917,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/C319F.png?s=256",
      "display_name" : "numberfourteen",
      "link" : "https://stackoverflow.com/users/8602917/numberfourteen"
    },
    "creation_date" : 1762849204,
    "last_activity_date" : 1762850917,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79816439,
    "question_id" : 79816327,
    "body" : "<p>If I am not mistaken, you can put @Startup on your manager to have it perform eager initialization at startup. Else your container will decide when to initialize it. Alternatively, move the instantiation of the two MyImplementation beans into its own class, then add the constructor back with the SomeManager, so that the construction of startup bean does not have circular dependency</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 21724606,
      "reputation" : 1431,
      "user_id" : 16034206,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/MRBdT.jpg?s=256",
      "display_name" : "pebble unit",
      "link" : "https://stackoverflow.com/users/16034206/pebble-unit"
    },
    "creation_date" : 1762852054,
    "last_activity_date" : 1762875845,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79817874,
    "question_id" : 79816327,
    "body" : "<p>In CDI, a bean is defined by the <em>set of its types and qualifiers</em>.\nIf you create a singleton (either using <code>jakarta.inject.@Singleton</code> or <code>@ApplicationScoped</code>) it is, well, a singleton. You cannot have more instances of that particular bean by definition.</p>\n<p>However, you can create two beans that will implement the same type you are after and give them different qualifier. In CDI terms they are different beans but in your code that can share the same functionality.</p>\n<p>Note that you should in fact <strong>not use <code>@Named</code></strong> for this (<a href=\"https://jakarta.ee/specifications/cdi/4.1/jakarta-cdi-spec-4.1#named_at_injection_point\" rel=\"nofollow noreferrer\">specification discourages that as well</a>)! It is an annotation that has special treatment in CDI with regard to <code>@Default</code> qualifier. Instead, create your custom qualifier and use that.</p>\n<p>Last but not least, the code you posted will likely have a circular dependency. Ideally you want to design your code to avoid that but if you cannot, use <code>@ApplicationScoped</code> - such bean uses client proxy and can side step the circular dependency issue (as stated <a href=\"https://jakarta.ee/specifications/cdi/4.1/jakarta-cdi-spec-4.1#injection_and_resolution\" rel=\"nofollow noreferrer\">here in the spec</a>).</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 6963528,
      "reputation" : 7021,
      "user_id" : 5342297,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ec65b3838b1d1ea981cdb5be0a7a4a57?s=256&d=identicon&r=PG",
      "display_name" : "Siliarus",
      "link" : "https://stackoverflow.com/users/5342297/siliarus"
    },
    "creation_date" : 1762959198,
    "last_activity_date" : 1762959198,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}