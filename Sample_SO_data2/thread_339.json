{
  "question" : {
    "question_id" : 79819843,
    "title" : "Multiple instances of test class using Weld-JUnit5",
    "body" : "<p>I have &quot;simple&quot; Junit5 Test which I would like to run with Weld.\nThe test fails, because observer method is invoked on other instance of test class as the one which was started. Even thou I marked the Test class as a @Singleton. Any idea why is that so?</p>\n<p>Thank you\nDalibor</p>\n<pre><code>@EnableWeld\n@Singleton\npublic class EventsTest {\n\n    @WeldSetup\n    WeldInitiator weld = WeldInitiator.performDefaultDiscovery();\n\n    private Address address;\n\n    public void onFixtureBeanConfigured(@Observes final FixtureBeanConfigured beanConfigured) {\n        if (beanConfigured.getFixtureBean() instanceof Address) {\n            this.address = (Address) beanConfigured.getFixtureBean();\n        }\n    }\n\n    @Test\n    public void testFixtureBeanConfiguredEvent() {\n        assertNull(address);\n        addressFixtureObject.get();\n        assertNotNull(address);\n    }\n}\n</code></pre>\n",
    "tags" : [ "java", "junit5", "jboss-weld" ],
    "owner" : {
      "account_id" : 13293455,
      "reputation" : 77,
      "user_id" : 9597256,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9f1f3894aaec42c5fddcbb042069b5ac?s=256&d=identicon&r=PG",
      "display_name" : "dkalna",
      "link" : "https://stackoverflow.com/users/9597256/dkalna"
    },
    "is_answered" : true,
    "view_count" : 48,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1763294084,
    "creation_date" : 1763112349,
    "link" : "https://stackoverflow.com/questions/79819843/multiple-instances-of-test-class-using-weld-junit5",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79820114,
    "question_id" : 79819843,
    "body" : "<p>This is expected behavior - the test class used by JUnit is <em>not</em> provided by Weld JUnit5 extension.</p>\n<p>Instead, Weld simply enriches the test instance provided by JUnit (meaning it injects into fields and method parameters) but does not own it.</p>\n<p>By declaring the test instance as a bean as well, Weld will create and use its own instance of that class for any CDI-oriented request (observer notifications, injections of that type etc).\nWe deliberately allow test class to become a bean as that allows for easy mocking (<a href=\"https://github.com/weld/weld-testing/tree/master/junit5#adding-mock-beans\" rel=\"nofollow noreferrer\">see here</a>).</p>\n<p>Note that when we originally created the Weld JUnit 5 extension, it wasn't even possible to provide the test instance. From there on, we kept it as changing that proves to be rather invasive towards other use cases and brings more limitations than gains.\nIf you are curious, I did an investigation some time ago - the sum up and links to other places can be seen in <a href=\"https://github.com/weld/weld-testing/issues/233\" rel=\"nofollow noreferrer\">this issue</a>.</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 6963528,
      "reputation" : 7041,
      "user_id" : 5342297,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ec65b3838b1d1ea981cdb5be0a7a4a57?s=256&d=identicon&r=PG",
      "display_name" : "Siliarus",
      "link" : "https://stackoverflow.com/users/5342297/siliarus"
    },
    "creation_date" : 1763129237,
    "last_activity_date" : 1763129237,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79820114" : [ {
      "comment_id" : 140866367,
      "post_id" : 79820114,
      "body" : "@dkalna Can&#39;t you inject the bean into the test instead? If not, you can also declare some <code>TestUtil</code> bean that holds the same observer logic that you had and just query that bean before proceeding to testing. You could place that into before-each method as well",
      "score" : 0,
      "owner" : {
        "account_id" : 6963528,
        "reputation" : 7041,
        "user_id" : 5342297,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/ec65b3838b1d1ea981cdb5be0a7a4a57?s=256&d=identicon&r=PG",
        "display_name" : "Siliarus",
        "link" : "https://stackoverflow.com/users/5342297/siliarus"
      },
      "creation_date" : 1763735863,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140859846,
      "post_id" : 79820114,
      "body" : "Is there any better/elegant way to do this then in my previous comment?",
      "score" : 0,
      "owner" : {
        "account_id" : 13293455,
        "reputation" : 77,
        "user_id" : 9597256,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/9f1f3894aaec42c5fddcbb042069b5ac?s=256&d=identicon&r=PG",
        "display_name" : "dkalna",
        "link" : "https://stackoverflow.com/users/9597256/dkalna"
      },
      "creation_date" : 1763456114,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140856177,
      "post_id" : 79820114,
      "body" : "Ok, if I understand it right, the following should be correct, no?     <code>@Test public void testFixtureBeanConfiguredEvent() { assertNull(weld.select(EventsTest.class).get().address); addressFixtureObject.get();  assertNotNull(weld.select(EventsTest.class).get().address); }</code>     It works, but does exist more elegant way of &quot;weld.select(EventsTest.class).get().address&quot;?",
      "score" : 0,
      "owner" : {
        "account_id" : 13293455,
        "reputation" : 77,
        "user_id" : 9597256,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/9f1f3894aaec42c5fddcbb042069b5ac?s=256&d=identicon&r=PG",
        "display_name" : "dkalna",
        "link" : "https://stackoverflow.com/users/9597256/dkalna"
      },
      "creation_date" : 1763246623,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}