{
  "question" : {
    "question_id" : 79679459,
    "title" : "About JVM&#39;s tiered compilation sequence, does isolated method optimization occur before inlining?",
    "body" : "<p>The tiered steps provided by Oracle are:\n<a href=\"https://i.sstatic.net/U2AIMRED.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/U2AIMRED.png\" alt=\"enter image description here\" /></a></p>\n<p>It seems to me that...</p>\n<p>I'd be a reasonable assumption to think that optimizations should occur with methods in isolation (detached from its call-site context), before the inlining actually occurs.</p>\n<p>As this would prevent future deoptimizations, since the inlined unoptimized method, would &quot;trickle down&quot; its imperfections directly on to the call-site as many times as the method was called.</p>\n<p>Increasing the method size makes it more difficult to profile it.</p>\n<p>So, I'd assume that independent isolated profiling occurs at the method level, that eventually translates into isolated optimizations, before being eligible for inlining.</p>\n<p>The issue with my assumption is that my assumption ~seems~ to go against the established knowledge that JIT works/optimizes on a context-based necessity.\nBut my argument is that doing the optimizations based on context, does not contradict the isolated-first approach.</p>\n<p>There would be at least some things that could be optimized without the need of looking at cross-method interaction.</p>\n<p>If the method is perfected in isolation, it was because the call-site demanded it first.</p>\n<p>The real difference would be:</p>\n<p>Is the profiling/optimizing:</p>\n<ul>\n<li>top-down?</li>\n<li>or bottom-up?</li>\n<li>It could do both with ease... which would validate my argument.</li>\n</ul>\n<p>Now, I haven't found a more granular explanation, but I'd assume that the &quot;inlining&quot; step is part of the C1 or C2 process. But maybe optimizations like dead branch elimination is also part of C1 and C2 since they may occur directly on the bytecode level.</p>\n<p>By inlining, what I mean is the actual method body insertion, not &quot;direct-call&quot; which would be categorized as a devirtualization, but not an inlining per-se.</p>\n<p>Example:</p>\n<pre class=\"lang-java prettyprint-override\"><code>void extremelyHotPath() {\n   obj.something();\n   obj2.something();\n   obj3.something();\n   obj4.something();\n   obj5.something();\n   obj6.something();\n}\n// ---&gt; obj scope\nfinal boolean flag = false;\nvoid doSomething() {\n   if (flag) throw new IllegalStateException();\n}\n</code></pre>\n<p>So, if JIT performs &quot;top-down&quot; optimization... the conditional constant propagation/dead-code elimination will be done after the inlining.</p>\n<pre class=\"lang-java prettyprint-override\"><code>void extremelyHotPath() {\n   if (obj.flag) throw new IllegalStateException();\n   if (obj2.flag) throw new IllegalStateException();\n   if (obj3.flag) throw new IllegalStateException();\n   if (obj4.flag) throw new IllegalStateException();\n   if (obj5.flag) throw new IllegalStateException();\n   if (obj6.flag) throw new IllegalStateException();\n}\n</code></pre>\n",
    "tags" : [ "java", "compiler-optimization", "jit", "jvm-hotspot", "inlining" ],
    "owner" : {
      "account_id" : 15545149,
      "reputation" : 1385,
      "user_id" : 11214643,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-RP1GwpkAYX4/AAAAAAAAAAI/AAAAAAAAAEc/fknm-MHAJYU/s256-rj/photo.jpg",
      "display_name" : "Delark",
      "link" : "https://stackoverflow.com/users/11214643/delark"
    },
    "is_answered" : false,
    "view_count" : 133,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1751108567,
    "creation_date" : 1750873362,
    "link" : "https://stackoverflow.com/questions/79679459/about-jvms-tiered-compilation-sequence-does-isolated-method-optimization-occur",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140583513,
    "post_id" : 79679459,
    "body" : "If <code>method_a</code> hits a wall when trying to compile <code>m_b</code>... the compiler may still be able to optimize <code>m_c</code> once the priority queue reaches it.  conclusion: C1 and C2 have a bottom-up tendency.",
    "score" : 0,
    "owner" : {
      "account_id" : 15545149,
      "reputation" : 1385,
      "user_id" : 11214643,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-RP1GwpkAYX4/AAAAAAAAAAI/AAAAAAAAAEc/fknm-MHAJYU/s256-rj/photo.jpg",
      "display_name" : "Delark",
      "link" : "https://stackoverflow.com/users/11214643/delark"
    },
    "creation_date" : 1752264659,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140583510,
    "post_id" : 79679459,
    "body" : "If JIT encounters a &quot;perfect&quot; scenario... where <code>method_a</code> calls <code>m_b</code> calls <code>m_c</code>.... EXACTLY one time each... the first one to be eligible... wil <b>not be <code>main</code></b> ... even under a perfect scenario... method_a... which is <b>NOT</b> the root of the calling process... will get compiled first... not <code>main</code>. In a real situation... the first methods to be eligible for compilation will be the ones that are the deepest which are the ones that are usually called the most....",
    "score" : 0,
    "owner" : {
      "account_id" : 15545149,
      "reputation" : 1385,
      "user_id" : 11214643,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-RP1GwpkAYX4/AAAAAAAAAAI/AAAAAAAAAEc/fknm-MHAJYU/s256-rj/photo.jpg",
      "display_name" : "Delark",
      "link" : "https://stackoverflow.com/users/11214643/delark"
    },
    "creation_date" : 1752264609,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140583497,
    "post_id" : 79679459,
    "body" : "method (as it reached an optimization wall) and continues calling &quot;.next()&quot; in the priority queue... and if it finds the same callee previously compiled... it will find the same machine code generated through this &quot;shared-runtime&quot;.  This is why deoptimizations are/may be later required... as I suspected.",
    "score" : 0,
    "owner" : {
      "account_id" : 15545149,
      "reputation" : 1385,
      "user_id" : 11214643,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-RP1GwpkAYX4/AAAAAAAAAAI/AAAAAAAAAEc/fknm-MHAJYU/s256-rj/photo.jpg",
      "display_name" : "Delark",
      "link" : "https://stackoverflow.com/users/11214643/delark"
    },
    "creation_date" : 1752264165,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140583496,
    "post_id" : 79679459,
    "body" : "Even to the extent that the compiler (the priorityQueue context calling .next() on to-be-compiled methods) uses a shared storage of compiled machine code... so that when an inlining occurs (while optimizing a caller (in the cascade inlining mechanic within the caller)).... the compiler redirects to a (paraphrasing) &quot;shared runtime&quot; to store the on-the-fly compiled machine code generated.  This means that even if the code is generated as part of the cascading process within a caller... when the compiler &quot;goes out&quot; of the ... ...",
    "score" : 0,
    "owner" : {
      "account_id" : 15545149,
      "reputation" : 1385,
      "user_id" : 11214643,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-RP1GwpkAYX4/AAAAAAAAAAI/AAAAAAAAAEc/fknm-MHAJYU/s256-rj/photo.jpg",
      "display_name" : "Delark",
      "link" : "https://stackoverflow.com/users/11214643/delark"
    },
    "creation_date" : 1752264160,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140583459,
    "post_id" : 79679459,
    "body" : "And there are indeed optimizations that are still done around the edges of unoptimized callees... that <b>does not involve reordering mechanics</b>. I have deeply profiled code that demonstrates this behavior... and I&#39;ve looked enough C++ JIT code to understand that hitting inlining walls... do not stop the optimization process. The process has <b>a bottom-up</b> optimization tendency.",
    "score" : 0,
    "owner" : {
      "account_id" : 15545149,
      "reputation" : 1385,
      "user_id" : 11214643,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-RP1GwpkAYX4/AAAAAAAAAAI/AAAAAAAAAEc/fknm-MHAJYU/s256-rj/photo.jpg",
      "display_name" : "Delark",
      "link" : "https://stackoverflow.com/users/11214643/delark"
    },
    "creation_date" : 1752263483,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140583457,
    "post_id" : 79679459,
    "body" : "@Holger... I&#39;ve been somewhat busy... but it seems I do in fact stand correct after some recent tests... and some assembler prints... It seems to me that it is clear... that when a caller reaches an inlining threshold (method too large)... The compiler (the event loop that <b>began</b> the compilation process by polling the head of the priority queue of <code>to-be-compiled</code> methods).... it just <b>goes to the next</b> method in the queue... and keeps optimizing from the bottom-up. So, hitting this inlining wall DOES NOT prevent C1 or C2 to keep inlining. 1/2",
    "score" : 0,
    "owner" : {
      "account_id" : 15545149,
      "reputation" : 1385,
      "user_id" : 11214643,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-RP1GwpkAYX4/AAAAAAAAAAI/AAAAAAAAAEc/fknm-MHAJYU/s256-rj/photo.jpg",
      "display_name" : "Delark",
      "link" : "https://stackoverflow.com/users/11214643/delark"
    },
    "creation_date" : 1752263477,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140546562,
    "post_id" : 79679459,
    "body" : "I don’t know whether it’s just the odd terminology you’re using or a wrong way of thinking. A method does not profile itself. A method gets profiled. And when method B is profiled while being called from A, it is not “profiled in isolation”, it’s profiled in the context of being invoked from A. While the profiling of A doesn’t stop in the meanwhile. <i>The JVM profiles the entire application.</i> All methods. Which means, all actually executed methods. There is no such thing as “profiling in isolation”.",
    "score" : 2,
    "owner" : {
      "account_id" : 3211603,
      "reputation" : 301001,
      "user_id" : 2711488,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/t2hoD.jpg?s=256",
      "display_name" : "Holger",
      "link" : "https://stackoverflow.com/users/2711488/holger"
    },
    "creation_date" : 1751012388,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140545276,
    "post_id" : 79679459,
    "body" : "We could profile methods in isolation... &gt;Method_A gets called. &gt; Method_A begins profiling. &gt; Mehod_A calls M_B. &gt; M_B begins profiling.  - In parallel: Profiling of A and B. &gt; Method_A optimizes on the edges (around M_B). &gt; M_B optimizes (in isolation). &gt;M_B&#39;s profiling rating reaches a point in which it becomes eligible for inlining. &gt; M_B gets inlined. &gt; M_AB gets compiled. * Rinse and repeat",
    "score" : 0,
    "owner" : {
      "account_id" : 15545149,
      "reputation" : 1385,
      "user_id" : 11214643,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-RP1GwpkAYX4/AAAAAAAAAAI/AAAAAAAAAEc/fknm-MHAJYU/s256-rj/photo.jpg",
      "display_name" : "Delark",
      "link" : "https://stackoverflow.com/users/11214643/delark"
    },
    "creation_date" : 1750960157,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140545257,
    "post_id" : 79679459,
    "body" : "@Holger. The action of <i>profiling</i> an instruction sequence, allows for many things... not just identifying hot paths. Profiling involves rating whether the sequence deserves other optimizations like <code>proof-based techniques</code> , <code>speculative techniques</code>, etc... None of these related strictly to inlining. And many of which can be measured without leaving the method. If you think profiling relates only between cross-method interaction... then, in the absence of proof of what you say... consider how that would make JIT extremely inefficient based on the example provided in the question.",
    "score" : 0,
    "owner" : {
      "account_id" : 15545149,
      "reputation" : 1385,
      "user_id" : 11214643,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-RP1GwpkAYX4/AAAAAAAAAAI/AAAAAAAAAEc/fknm-MHAJYU/s256-rj/photo.jpg",
      "display_name" : "Delark",
      "link" : "https://stackoverflow.com/users/11214643/delark"
    },
    "creation_date" : 1750959739,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140545127,
    "post_id" : 79679459,
    "body" : "“methods are being profiled in isolation” makes no sense at all. The term “profiling” refers to measuring the runtime behavior which is the result of the interaction of all methods. It starts with recording the fact that a method has been called (by some other method) at all and of course, recording the actual caller when we are at it. You can’t profile methods in isolation (unless you’re performing some sort of unit tests, but you’re referring to JIT compilers, so no, this is not a thing here).",
    "score" : 2,
    "owner" : {
      "account_id" : 3211603,
      "reputation" : 301001,
      "user_id" : 2711488,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/t2hoD.jpg?s=256",
      "display_name" : "Holger",
      "link" : "https://stackoverflow.com/users/2711488/holger"
    },
    "creation_date" : 1750957260,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140544975,
    "post_id" : 79679459,
    "body" : "@aled Isolated is a word, Optimization is another word, Holger thought the word was &quot;Isolated Method&quot; but the complete semantic is &quot;Isolated Method Optimization&quot;. So, the thing that&#39;s occurring in isolation is not the method... but the optimization.  My question is: Is JIT <b>top-down</b> or <b>bottom-up</b>?",
    "score" : 0,
    "owner" : {
      "account_id" : 15545149,
      "reputation" : 1385,
      "user_id" : 11214643,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-RP1GwpkAYX4/AAAAAAAAAAI/AAAAAAAAAEc/fknm-MHAJYU/s256-rj/photo.jpg",
      "display_name" : "Delark",
      "link" : "https://stackoverflow.com/users/11214643/delark"
    },
    "creation_date" : 1750953811,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140544938,
    "post_id" : 79679459,
    "body" : "@Holger <i>Isolated Optimization</i> is not a standard technical term. It is the combination of two words, each with an independent meaning. &quot;Isolated: happening or existing only once, separate&quot;... &quot;not with others.&quot; Under the framework that <b>JIT works context-based</b>... it would be counterintuitive to think that JIT works &quot;bottom-up&quot; as that would imply methods are being profiled <b>in isolation</b>, <b>context-less FIRST</b> and then move up, towards the call-site. Then comes the inline... People say inlining imperfect/unpolished methods comes first.",
    "score" : 0,
    "owner" : {
      "account_id" : 15545149,
      "reputation" : 1385,
      "user_id" : 11214643,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-RP1GwpkAYX4/AAAAAAAAAAI/AAAAAAAAAEc/fknm-MHAJYU/s256-rj/photo.jpg",
      "display_name" : "Delark",
      "link" : "https://stackoverflow.com/users/11214643/delark"
    },
    "creation_date" : 1750953187,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140543943,
    "post_id" : 79679459,
    "body" : "You have ignored the comment from @aled. Where did you get those terms from? There is no point in asking questions about made up things. In the OpenJDK/HotSpot JVM context, the term “<a href=\"https://bugs.openjdk.org/browse/JDK-8158765\" rel=\"nofollow noreferrer\">isolated methods</a>” does not match what you are discussing here.",
    "score" : 2,
    "owner" : {
      "account_id" : 3211603,
      "reputation" : 301001,
      "user_id" : 2711488,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/t2hoD.jpg?s=256",
      "display_name" : "Holger",
      "link" : "https://stackoverflow.com/users/2711488/holger"
    },
    "creation_date" : 1750935666,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140542261,
    "post_id" : 79679459,
    "body" : "Thanks @LouisWasserman. Is there any information I could read that explicitly states that per method optimizations (isolated optimizations) <b>do not</b> occur before inlining?",
    "score" : 0,
    "owner" : {
      "account_id" : 15545149,
      "reputation" : 1385,
      "user_id" : 11214643,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-RP1GwpkAYX4/AAAAAAAAAAI/AAAAAAAAAEc/fknm-MHAJYU/s256-rj/photo.jpg",
      "display_name" : "Delark",
      "link" : "https://stackoverflow.com/users/11214643/delark"
    },
    "creation_date" : 1750877311,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140542171,
    "post_id" : 79679459,
    "body" : "It&#39;s a lot easier to cut out completely unused bits of code after inlining that lets you figure out if a condition is always, or never, met.",
    "score" : 2,
    "owner" : {
      "account_id" : 465573,
      "reputation" : 200423,
      "user_id" : 869736,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/ae7bb06b9a23a4dd7eea69e853d47d12?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Louis Wasserman",
      "link" : "https://stackoverflow.com/users/869736/louis-wasserman"
    },
    "creation_date" : 1750875463,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140542124,
    "post_id" : 79679459,
    "body" : "Where did you see those terms related to the JVM compilers?",
    "score" : 2,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1750874127,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}