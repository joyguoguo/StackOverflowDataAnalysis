{
  "question" : {
    "question_id" : 79833607,
    "title" : "Looking for workaround for library with missing interface",
    "body" : "<p>I have a Java library (FIHR) where there are conventions in a bean class hierarchy that were NOT formalized as an interface.</p>\n<p>For example many subclasses have a <code>getStatus()</code> property  but there is no interface that formalizes that in a way that allows for me to share code as follows:</p>\n<pre><code>if (bean instanceof HasStatusProperty bean2) {\n    System.out.println(&quot;Status for this bean: &quot; + bean2.getStatus();\n    }\n</code></pre>\n<p>Can anyone think of a way to sortof project such an interface on a class that comes from a library.</p>\n<p>The best I can think of is to use the Reflection API to test if it has that property  and get the value.  But that's cumbersome.</p>\n",
    "tags" : [ "java" ],
    "owner" : {
      "account_id" : 953426,
      "reputation" : 988,
      "user_id" : 979145,
      "user_type" : "registered",
      "accept_rate" : 25,
      "profile_image" : "https://i.sstatic.net/YeMQP.jpg?s=256",
      "display_name" : "DaBlick",
      "link" : "https://stackoverflow.com/users/979145/dablick"
    },
    "is_answered" : true,
    "view_count" : 105,
    "answer_count" : 5,
    "score" : 0,
    "last_activity_date" : 1764716665,
    "creation_date" : 1764460768,
    "link" : "https://stackoverflow.com/questions/79833607/looking-for-workaround-for-library-with-missing-interface",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79833668,
    "question_id" : 79833607,
    "body" : "<p>You can use <code>java.beans.Expression</code>, which is a way of writing all the reflective code in one line. If the method doesn't exist it will throw an exception.</p>\n<pre><code>try\n{\n    int status = (Integer)new Expression(bean, &quot;getStatus&quot;, new Object[0]).getValue();\n    // ...\n}\ncatch (NoSuchMethodException exc)\n{\n    ;\n}\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 71739,
      "reputation" : 311872,
      "user_id" : 207421,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=256&d=identicon&r=PG",
      "display_name" : "user207421",
      "link" : "https://stackoverflow.com/users/207421/user207421"
    },
    "creation_date" : 1764475321,
    "last_activity_date" : 1764549928,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79834021,
    "question_id" : 79833607,
    "body" : "<p>You can make this interface yourself, and then use <code>java.lang.reflect.Proxy</code> to wrap objects so that they 'implement' the interface.</p>\n<p>But before we go any deeper, this is <strong>fundamentally</strong> un-java-like. Unfortunately, this is part of the beanspec as an issue: A lot of the underlying semantics of beanspec are fundamentally unjavalike.</p>\n<p>The problem is <strong>structural typing</strong>: Java doesn't do that. Period. It's nominal to a fault. The problem with structural typing is this. Imagine the following types:</p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.smithandwesson;\n\npublic interface Gun {\n  void shoot(Person p);\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>package com.canon;\n\npublic interface Camera {\n  void shoot(Person p);\n}\n</code></pre>\n<p>Hopefully you now see the problem: Treating simple english identifiers such as <code>shoot</code> or <code>getStatus</code> as having inherent programmatic meaning <em>is going to result in you killing your friend</em>. The solution to this problem is namespaces: Nobody gets to just claim the word 'shoot' and define exactly what that means; that word is far too general. However, canon <strong>does</strong> get to 'claim' (i.e. exactly define with precision) the qualified identifier <code>com.canon.Camera.shoot(Person)</code>. That's why package names are meant to follow domain names. <code>com.canon</code> cannot possibly conflict with smith and wesson because we're piggy-backing on top of the domain name registration system which is global.</p>\n<p>Hence, treating <strong>any</strong> object that so happens to have a <code>String getStatus()</code> method as being specifically up to your standards is very dangerous.</p>\n<p>If you must:</p>\n<pre><code>import java.lang.reflect.Proxy;\n\n// I'm assuming 'status' is a 'String' - adjust accordingly if not.\n\npublic interface HasStatus {\n  String getStatus();\n}\n\n@UtilityClass\npublic class FhirBeanUtility {\n  private final Method STATUS_METHOD; static {\n    try {\n      STATUS_METHOD = HasStatus.class.getMethod(&quot;getStatus&quot;);\n    } catch (Exception e) {\n      throw new RuntimeException(&quot;Core bug: HasStatus doesn't have getStatus()?&quot;);\n    }\n  }\n\n  /**\n   * Turns a bean object that has {@code getStatus()} into a {@code HasStatus} wrapper.\n   *\n   * @throws IllegalArgumentException If {@code obj} does not have {@code getStatus()},\n   *                                  or that method doesn't return a {@code String}.\n   */\n  public HasStatus asHasStatus(Object obj) throws IllegalArgumentException {\n    Method target; {\n      target = obj.getClass().getMethod(&quot;getStatus&quot;);\n    } catch (NoSuchMethodException e) {\n      throw new IllegalArgumentException(&quot;No public getStatus() method found in &quot; + obj.getClass(), e);\n    }\n\n    if (target.getReturnType() != String.class) throw new IllegalArgumentException(&quot;getStatus() must return a String: &quot; + obj.getClass());\n\n    return (HasStatus) Proxy.newProxyInstance(obj.getClass().getClassLoader(),\n      new Class&lt;?&gt; [] { HasStatus.class },\n      (proxy, method, args) -&gt; {\n        if (method == STATUS_METHOD) target.invoke(obj);\n        else {\n          // link through all methods from Object itself, such as toString()\n        }\n      }\n  }\n}\n</code></pre>\n<p>Note that proxies can be slow and doing reflection lookups is <em>very</em> slow, so do that up front (like I do here, looking up the <code>getStatus()</code> in the target class), or add a cache system, such as a simple HashMap, but note: Overloads exist. You can't cache on just the name, you have to cache on name+non-genericsed fully qualified param type names. And technically, even return type as well.</p>\n<p>Also, this means your object is no longer any of its other types. You can <em>only</em> invoke .getStatus() on this proxy (and everything in j.l.Object of course), nothing else.</p>\n<h2>Holy cripes how difficult is that??</h2>\n<p>Well, yes, when I said 'java does not want you to do this', you should take that seriously. Java goes out of its way to ensure you don't do this.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 401843,
      "reputation" : 107136,
      "user_id" : 768644,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/b13bedc5215730fbce5edff6c130988a?s=256&d=identicon&r=PG",
      "display_name" : "rzwitserloot",
      "link" : "https://stackoverflow.com/users/768644/rzwitserloot"
    },
    "creation_date" : 1764518340,
    "last_activity_date" : 1764518340,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79833625,
    "question_id" : 79833607,
    "body" : "<p>You can create a wrapper with any structure you wish. Declare interfaces with the contract you want, create concrete implementations which call the library appropriately, and use your interfaces in lieu of the library classes throughout the project where possible. This is arguably good practice even when the library classes are &quot;well designed&quot;, for reasons including improved maintainability and separation of concerns.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 14914414,
      "reputation" : 1150,
      "user_id" : 10808904,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Ts8fIsJj.png?s=256",
      "display_name" : "Xavier Pedraza",
      "link" : "https://stackoverflow.com/users/10808904/xavier-pedraza"
    },
    "creation_date" : 1764464073,
    "last_activity_date" : 1764464073,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79834165,
    "question_id" : 79833607,
    "body" : "<p>@rzwitserloot   for some reason (perhaps my lack of reputation points) StackOverflow won't let me post this as a reply to your answer.   So..</p>\n<p>I take your points and your concerns.    Obviously one praftfall that can happen here is that if I create a proxy that makes assumptions about methods with identical method signatures, and the library authors enhance their library by introducing new methods of that signature that do not ADHERE to my assumptions, I will have problems.</p>\n<p>I intend to create a PR for this library that formalizes this interface with an actual interface.   And if they accept that, I think the tactic of a workaround UNTIL my changes are released (and I update my dependency) is a low risk, valid approach.</p>\n<p>I'm nothing but grateful for the effort and thought you put into your answer.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 953426,
      "reputation" : 988,
      "user_id" : 979145,
      "user_type" : "registered",
      "accept_rate" : 25,
      "profile_image" : "https://i.sstatic.net/YeMQP.jpg?s=256",
      "display_name" : "DaBlick",
      "link" : "https://stackoverflow.com/users/979145/dablick"
    },
    "creation_date" : 1764534621,
    "last_activity_date" : 1764534621,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79836391,
    "question_id" : 79833607,
    "body" : "<p>I added the code for my one-liner, which makes it an 8-liner including the <code>try/catch</code> block.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 71739,
      "reputation" : 311872,
      "user_id" : 207421,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=256&d=identicon&r=PG",
      "display_name" : "user207421",
      "link" : "https://stackoverflow.com/users/207421/user207421"
    },
    "creation_date" : 1764716665,
    "last_activity_date" : 1764716665,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}