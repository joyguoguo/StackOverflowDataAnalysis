{
  "question" : {
    "question_id" : 79565942,
    "title" : "gmail imap Invalid credentials Failure since I changed the password",
    "body" : "<p>Since I changed the password for a Gmail account, a code in Java for reading emails that worked fine no longer works with the new password, resulting in the error:</p>\n<blockquote>\n<p>[AUTHENTICATIONFAILED] Invalid credentials (Failure).</p>\n</blockquote>\n<p>I use javaxmail 1.5 and access to less secure applications is enabled.\nWhat's happening?</p>\n<pre class=\"lang-java prettyprint-override\"><code>import javax.mail.*;\nimport javax.mail.internet.*;\nimport javax.mail.search.*;\nimport java.util.*;\nimport java.text.SimpleDateFormat;\n\n// Extraction de texte à partir du contenu HTML\nprivate static String extractTextFromHtml(String html) {\n  if (html == null) {\n    return &quot;&quot;;\n  }\n\n  // Supprimer les balises &lt;script&gt; et leur contenu\n  html = html.replaceAll(&quot;(?i)&lt;script[^&gt;]*&gt;.*?&lt;/script&gt;&quot;, &quot;&quot;);\n\n  // Remplacer les balises critiques par des sauts de ligne\n  html = html.replaceAll(&quot;(?i)&lt;(br|div|p|tr|td|li)&gt;&quot;, &quot;\\n&quot;);\n\n  // Supprimer toutes les autres balises HTML\n  html = html.replaceAll(&quot;&lt;[^&gt;]+&gt;&quot;, &quot;&quot;);\n\n  // Remplacer les entités HTML courantes\n  html = html.replaceAll(&quot;&amp;nbsp;&quot;, &quot; &quot;)\n             .replaceAll(&quot;&amp;amp;&quot;, &quot;&amp;&quot;)\n             .replaceAll(&quot;&amp;lt;&quot;, &quot;&lt;&quot;)\n             .replaceAll(&quot;&amp;gt;&quot;, &quot;&gt;&quot;)\n             .replaceAll(&quot;&amp;quot;&quot;, &quot;\\&quot;&quot;)\n             .replaceAll(&quot;&amp;apos;&quot;, &quot;'&quot;);\n\n  // Supprimer les espaces multiples mais conserver les nouvelles lignes\n  html = html.replaceAll(&quot;[\\\\s&amp;&amp;[^\\\\n]]+&quot;, &quot; &quot;).trim();\n\n  return html;\n}\n\npublic static String fetchEmails(String username, String password, String folderName, String inputDate) {\n  String     host  = &quot;imap.gmail.com&quot;;\n  Properties props = new Properties();\n  props.put(&quot;mail.store.protocol&quot;, &quot;imaps&quot;);\n  props.put(&quot;mail.imaps.host&quot;, host);\n  props.put(&quot;mail.imaps.port&quot;, &quot;993&quot;);\n  props.put(&quot;mail.imaps.starttls.enable&quot;, &quot;true&quot;);\n\n  try {\n    //Session session = Session.getDefaultInstance(props, null);\n    Session session = Session.getInstance(props);\n            session.setDebug(true)\n    Store   store   = session.getStore(&quot;imaps&quot;);\n            store.connect(host, username, password);\n\n    Folder  folder  = store.getFolder(folderName);\n            folder.open(Folder.READ_ONLY);\n\n    // Convertir la chaîne de date en objet Date\n    SimpleDateFormat inputFormat = new SimpleDateFormat(&quot;dd/MM/yyyy&quot;);\n    Date             searchDate  = inputFormat.parse(inputDate);\n\n    // Créer un filtre pour les messages à partir de la date fournie\n    SearchTerm searchTerm = new ReceivedDateTerm(ComparisonTerm.GE, searchDate);\n    Message[]  messages   = folder.search(searchTerm)\n\n    if (messages.length == 0) {\n      return &quot;Aucun message trouvé.&quot;;\n    }\n\n    StringBuilder result        = new StringBuilder();\n    SimpleDateFormat dateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);\n\n    for (Message message : messages) {\n      result.append(&quot;début message&quot;).append(System.lineSeparator());\n      result.append(&quot;Date : &quot;).append(dateFormat.format(message.getSentDate())).append(System.lineSeparator());\n      result.append(&quot;De : &quot;).append(InternetAddress.toString(message.getFrom())).append(System.lineSeparator());\n      result.append(&quot;Sujet : &quot;).append(message.getSubject()).append(System.lineSeparator());\n\n      Object content = message.getContent();\n      if (content instanceof String) {\n        result.append(&quot;Contenu : &quot;)\n          .append(extractTextFromHtml((String) content))\n          .append(System.lineSeparator());\n      } else if (content instanceof Multipart) {\n        Multipart multipart = (Multipart) content;\n        for (int i = 0; i &lt; multipart.getCount(); i++) {\n          BodyPart bodyPart = multipart.getBodyPart(i);\n          if (bodyPart.isMimeType(&quot;text/plain&quot;)) {\n            result.append(&quot;Contenu : &quot;)\n              .append(bodyPart.getContent().toString())\n              .append(System.lineSeparator());\n          } else if (bodyPart.isMimeType(&quot;text/html&quot;)) {\n            result.append(&quot;Contenu :&quot;)\n              .append(extractTextFromHtml(bodyPart.getContent().toString()))\n              .append(System.lineSeparator());\n          }\n        }\n      }\n      result.append(&quot;fin message&quot;).append(System.lineSeparator());\n    }\n\n    folder.close(false);\n    store.close();\n    return result.toString().trim();\n  } catch (Exception e) {\n    return &quot;Erreur : &quot; + e.getMessage();\n  }\n}\n\n// Appel principal pour ScriptMaster\nString username   = FMusername;\nString password   = FMpassword;\nString folderName = FMfolderName;\nString inputDate  = FMinputDate;\nString emails     = fetchEmails( username, password, folderName, inputDate );\nreturn emails;\n</code></pre>\n",
    "tags" : [ "java", "gmail", "gmail-imap" ],
    "owner" : {
      "account_id" : 2567285,
      "reputation" : 427,
      "user_id" : 2226984,
      "user_type" : "registered",
      "accept_rate" : 30,
      "profile_image" : "https://www.gravatar.com/avatar/8919351aebe1914394dd0eae698f8b06?s=256&d=identicon&r=PG",
      "display_name" : "ericire",
      "link" : "https://stackoverflow.com/users/2226984/ericire"
    },
    "is_answered" : false,
    "view_count" : 48,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1744320279,
    "creation_date" : 1744268604,
    "link" : "https://stackoverflow.com/questions/79565942/gmail-imap-invalid-credentials-failure-since-i-changed-the-password",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}