{
  "question" : {
    "question_id" : 79556533,
    "title" : "How to automate ollama server and ollama run mistral command in my docker compose?",
    "body" : "<p>I'm building an application with Spring AI. I've already integrated the mistral model into my container! But I do it using a command inside the container, and it works perfectly. I want to automate these commands in my docker compose (or entrypoint.sh).</p>\n<p>I try it in my docker-compose:</p>\n<pre><code>services:\n  db:\n    image: postgres:16.8\n    environment:\n      POSTGRES_USER: postgres\n      POSTGRES_PASSWORD: 12345\n      POSTGRES_DB: ai-finance\n    volumes:\n      - database_data:/var/lib/postgresql/data\n\n  ai:\n    image: ollama/ollama\n    ports:\n      - &quot;11435:11434&quot;\n    volumes:\n      - ollama_data:/root/.ollama\n      - ./entrypoint.sh:/entrypoint.sh\n    entrypoint: [&quot;/bin/bash&quot;, &quot;/entrypoint.sh&quot;]\n    restart: unless-stopped\n\n  api:\n    image: ai-finance:0.7\n    ports:\n      - &quot;8080:8080&quot;\n    environment:\n      - SPRING_AI_OLLAMA_BASE-URL=http://ai:11434\n    depends_on:\n      - db\n      - ai\nvolumes:\n  ollama_data:\n  database_data:\n    driver: local\n</code></pre>\n<p>And i try it in my entrypoint.sh:</p>\n<pre><code>#!/bin/bash\necho &quot;Starting Ollama server...&quot;\nollama serve &amp;\nollama pull mistral\n</code></pre>\n<p>By doing it this way, ollama is downloaded into the ai container and it simply closes the container after that, and so I can't make requests from my application.</p>\n",
    "tags" : [ "java", "docker", "docker-compose", "ollama", "spring-ai" ],
    "owner" : {
      "account_id" : 30448424,
      "reputation" : 1,
      "user_id" : 23333727,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/b0aa07c7f78255ced766dd530b9ad349?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "wendoxx",
      "link" : "https://stackoverflow.com/users/23333727/wendoxx"
    },
    "is_answered" : false,
    "view_count" : 35,
    "closed_date" : 1743850155,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1743824824,
    "creation_date" : 1743824824,
    "link" : "https://stackoverflow.com/questions/79556533/how-to-automate-ollama-server-and-ollama-run-mistral-command-in-my-docker-compos",
    "closed_reason" : "Duplicate"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140302169,
    "post_id" : 79556533,
    "body" : "You need to <code>wait</code> for the Ollama server to exit.  Otherwise you get to the end of the entrypoint script and the container exits.  The linked question has a couple of examples of this.",
    "score" : 0,
    "owner" : {
      "account_id" : 13863020,
      "reputation" : 164909,
      "user_id" : 10008173,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/bc86d913c15f3b126673faa654e9668c?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "David Maze",
      "link" : "https://stackoverflow.com/users/10008173/david-maze"
    },
    "creation_date" : 1743850200,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140301972,
    "post_id" : 79556533,
    "body" : "Did you try changing the ports in the docker-compose file?",
    "score" : 0,
    "owner" : {
      "account_id" : 2179728,
      "reputation" : 81081,
      "user_id" : 10819573,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/MWKel.jpg?s=256",
      "display_name" : "Arvind Kumar Avinash",
      "link" : "https://stackoverflow.com/users/10819573/arvind-kumar-avinash"
    },
    "creation_date" : 1743842682,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}