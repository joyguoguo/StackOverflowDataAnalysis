{
  "question" : {
    "question_id" : 79670450,
    "title" : "How to get sessionId Spring Boot MCP server /mcp/message?sessionId=63bb3566-bd1d-4315-a5ba-761d794714ee) and pass it to (@Tool) tool execution logic?",
    "body" : "<p>I am currently developing an MCP Server using Spring AI. I have defined tools using the @Tool annotation and integrated them with Claude/Copilot.</p>\n<p>The issue I'm facing is: I want to uniquely identify users using a sessionId for login and authentication logic. This sessionId is passed as a query parameter in the request URL like:</p>\n<p>POST /mcp/message?sessionId=<strong>63bb3566-bd1d-4315-a5ba-761d794714ee</strong>\nI need to extract this sessionId and pass it into the tool function.</p>\n<p>I tried using ThreadLocal and RequestContextHolder to access the HttpServletRequest and extract the sessionId, but it doesn’t work because the tool execution happens in a separate thread, and the context is lost.</p>\n<p>What I need:\nA reliable way to extract the sessionId from the query param in the /mcp/message endpoint.</p>\n<p>Ensure the sessionId is available inside the @Tool function, even when tool execution is asynchronous or handled in a different thread.</p>\n<p>Please suggest a proper solution or design pattern for passing this context value (like sessionId) across threads and into the tool logic in Spring AI.</p>\n",
    "tags" : [ "java", "spring", "spring-boot", "spring-ai", "model-context-protocol" ],
    "owner" : {
      "account_id" : 36847666,
      "reputation" : 11,
      "user_id" : 27949630,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/b2062bda8e2b91b10405cf7c946a567e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Abhijith G",
      "link" : "https://stackoverflow.com/users/27949630/abhijith-g"
    },
    "is_answered" : false,
    "view_count" : 695,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1752335382,
    "creation_date" : 1750242393,
    "link" : "https://stackoverflow.com/questions/79670450/how-to-get-sessionid-spring-boot-mcp-server-mcp-messagesessionid-63bb3566-bd1d",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79699401,
    "question_id" : 79670450,
    "body" : "<p>add a <code>ToolContext</code> parameter；\nthen use this to get sessionID</p>\n<pre class=\"lang-java prettyprint-override\"><code>\npublic class SessionIdUtil {\n\n    static final Field exchangeField;\n    static final Field sessionField;\n    static final Field idField;\n\n    static {\n        exchangeField = getField(McpSyncServerExchange.class, &quot;exchange&quot;);\n        sessionField = getField(McpAsyncServerExchange.class, &quot;session&quot;);\n        idField = getField(McpServerSession.class, &quot;id&quot;);\n    }\n\n    static Field getField(Class&lt;?&gt; clazz, String fieldName) {\n        try {\n            Field field = clazz.getDeclaredField(fieldName);\n            field.setAccessible(true);\n            return field;\n        } catch (Exception e) {\n            return null;\n        }\n    }\n\n\n    public static String getSessionId(ToolContext toolContext) {\n        try {\n            Optional&lt;McpSyncServerExchange&gt; mcpExchange = McpToolUtils.getMcpExchange(toolContext);\n            McpSyncServerExchange syncServerExchange = mcpExchange.get();\n            McpAsyncServerExchange asyncServerExchange = (McpAsyncServerExchange) exchangeField.get(syncServerExchange);\n            McpServerSession session = (McpServerSession) sessionField.get(asyncServerExchange);\n            return (String) idField.get(session);\n        } catch (Exception e) {\n            return null;\n        }\n    }\n}\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 5248387,
      "reputation" : 1,
      "user_id" : 4193359,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-kcEAw9tlq9A/AAAAAAAAAAI/AAAAAAAAAGA/zXRN9aJrlYk/s256-rj/photo.jpg",
      "display_name" : "杨自强",
      "link" : "https://stackoverflow.com/users/4193359/%e6%9d%a8%e8%87%aa%e5%bc%ba"
    },
    "creation_date" : 1752335382,
    "last_activity_date" : 1752335382,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140541507,
    "post_id" : 79670450,
    "body" : "this is a valid question and in fact - seems like there is no easy way of reaching this information  theoretically you could add <code>ToolContext</code> argument to the <code>@Tool</code> method and then reach the <code>sessionId</code> inside the objects inside it, but it would require a whole lot of private-field accesses via reflection",
    "score" : 0,
    "owner" : {
      "account_id" : 16863110,
      "reputation" : 51,
      "user_id" : 12193450,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/7b60eb10488b29c1a0d5fb87ab9492ca?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "karolkoltundev",
      "link" : "https://stackoverflow.com/users/12193450/karolkoltundev"
    },
    "creation_date" : 1750860856,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140526309,
    "post_id" : 79670450,
    "body" : "You can include the session ID in the user prompt before calling the LLM. Then, add the session ID as a parameter to the tool function—if necessary, the AI will automatically forward it to the tool from the prompt.",
    "score" : 1,
    "owner" : {
      "account_id" : 29231405,
      "reputation" : 163,
      "user_id" : 22395035,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f29a6c01cf0e794be1f7eba72fa48149?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "kush parsaniya",
      "link" : "https://stackoverflow.com/users/22395035/kush-parsaniya"
    },
    "creation_date" : 1750328202,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140523760,
    "post_id" : 79670450,
    "body" : "Please provide enough code so others can better understand or reproduce the problem.",
    "score" : 1,
    "owner" : {
      "account_id" : -1,
      "reputation" : 1,
      "user_id" : -1,
      "user_type" : "moderator",
      "profile_image" : "https://www.gravatar.com/avatar/a007be5a61f6aa8f3e85ae2fc18dd66e?s=256&d=identicon&r=PG",
      "display_name" : "Community",
      "link" : "https://stackoverflow.com/users/-1/community"
    },
    "creation_date" : 1750252761,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79699401" : [ {
      "comment_id" : 140664210,
      "post_id" : 79699401,
      "body" : "Can I get the SecurityContext this way?. I need in tools the user who sent the request for working with roles.",
      "score" : 0,
      "owner" : {
        "account_id" : 41652750,
        "reputation" : 1,
        "user_id" : 31270585,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/eab8a7ac1ffd9686324dd396c17775cf?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Iv&#225;n Eliseo Tinajero D&#237;az",
        "link" : "https://stackoverflow.com/users/31270585/iv%c3%a1n-eliseo-tinajero-d%c3%adaz"
      },
      "creation_date" : 1755135160,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140584873,
      "post_id" : 79699401,
      "body" : "Your answer could be improved with additional supporting information. Please <a href=\"https://stackoverflow.com/posts/79699401/edit\">edit</a> to add further details, such as citations or documentation, so that others can confirm that your answer is correct. You can find more information on how to write good answers <a href=\"/help/how-to-answer\">in the help center</a>.",
      "score" : 0,
      "owner" : {
        "account_id" : -1,
        "reputation" : 1,
        "user_id" : -1,
        "user_type" : "moderator",
        "profile_image" : "https://www.gravatar.com/avatar/a007be5a61f6aa8f3e85ae2fc18dd66e?s=256&d=identicon&r=PG",
        "display_name" : "Community",
        "link" : "https://stackoverflow.com/users/-1/community"
      },
      "creation_date" : 1752335567,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}