{
  "question" : {
    "question_id" : 79564855,
    "title" : "&quot;skip&quot; parameter of maven deploy:deploy-file seems not to detect snapshots and releases properly",
    "body" : "<p>We are trying to deploy a generated pom.xml for publishing purpose.\nAfter attempting to use flatten plugin but not ending up we what we really wanted to (flatten do a lot of stuff we don't need and do not do some we need regarding fine tuning which dependency to include or not) we wrote a small Mojo which is doing exactly what we need.</p>\n<p>For context we have something like that :</p>\n<pre><code>parent-project\n - module-1\n - module-2\n - module-3\n - my-custom-bom\n</code></pre>\n<p>The mojo automatically scan the parent-project for specific dependencies and gather them into a custom pom.xml in the target folder of my-custom-bom</p>\n<p>Now our goal is to deploy this custom pom.xml instead of my-custom-bom pom.xml which contains only the goals to generate the custom one.</p>\n<p>We ended up using the deploy-file goal with the following configuration :</p>\n<pre><code>      &lt;plugin&gt;\n        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n        &lt;artifactId&gt;maven-deploy-plugin&lt;/artifactId&gt;\n        &lt;executions&gt;\n          &lt;execution&gt;\n            &lt;id&gt;default-deploy&lt;/id&gt;\n            &lt;phase&gt;none&lt;/phase&gt;\n          &lt;/execution&gt;\n          &lt;execution&gt;\n            &lt;id&gt;bom-deploy-snapshot&lt;/id&gt;\n            &lt;phase&gt;deploy&lt;/phase&gt;\n            &lt;goals&gt;\n              &lt;goal&gt;deploy-file&lt;/goal&gt;\n            &lt;/goals&gt;\n            &lt;configuration&gt;\n              &lt;file&gt;${project.build.directory}/pom.xml&lt;/file&gt;\n              &lt;pomFile&gt;${project.build.directory}/pom.xml&lt;/pomFile&gt;\n              &lt;repositoryId&gt;${project.distributionManagement.snapshotRepository.id}&lt;/repositoryId&gt;\n              &lt;url&gt;${project.distributionManagement.snapshotRepository.url}&lt;/url&gt;\n              &lt;skip&gt;releases&lt;/skip&gt;\n            &lt;/configuration&gt;\n          &lt;/execution&gt;\n          &lt;execution&gt;\n            &lt;id&gt;bom-deploy-release&lt;/id&gt;\n            &lt;phase&gt;deploy&lt;/phase&gt;\n            &lt;goals&gt;\n              &lt;goal&gt;deploy-file&lt;/goal&gt;\n            &lt;/goals&gt;\n            &lt;configuration&gt;\n              &lt;file&gt;${project.build.directory}/pom.xml&lt;/file&gt;\n              &lt;pomFile&gt;${project.build.directory}/pom.xml&lt;/pomFile&gt;\n              &lt;repositoryId&gt;${project.distributionManagement.repository.id}&lt;/repositoryId&gt;\n              &lt;url&gt;${project.distributionManagement.repository.url}&lt;/url&gt;\n              &lt;skip&gt;snapshots&lt;/skip&gt;\n            &lt;/configuration&gt;\n          &lt;/execution&gt;\n        &lt;/executions&gt;\n      &lt;/plugin&gt;\n</code></pre>\n<p>But it seems the &quot;releases&quot; and &quot;snapshots&quot; described here <a href=\"https://maven.apache.org/plugins/maven-deploy-plugin/deploy-file-mojo.html#skip\" rel=\"nofollow noreferrer\">https://maven.apache.org/plugins/maven-deploy-plugin/deploy-file-mojo.html#skip</a> does not behave as expected.</p>\n<p>When run on a 2.0.2-SNAPSHOT version with the &quot;uniqueVersion&quot; flag on the snapshotRepository to true we end up with the following situation in our CI/CD :</p>\n<pre><code>18:06:52  [INFO] --- deploy:3.1.4:deploy-file (bom-deploy-snapshot) @ my-custom-bom ---\n18:06:52  [INFO] Skipping artifact deployment\n18:06:52  [INFO] \n18:06:52  [INFO] --- deploy:3.1.4:deploy-file (bom-deploy-release) @ my-custom-bom ---\n18:06:52  [INFO] Downloading from maven-internal-releases: http://mynexus.mybiz/repository/maven-internal-releases/my-custom-bom/2.0.2-SNAPSHOT/maven-metadata.xml\n18:06:52  [INFO] Uploading to maven-internal-releases: http://mynexus.mybiz/repository/maven-internal-releases/my-custom-bom/2.0.2-SNAPSHOT/my-custom-bom-2.0.2-20250409.160452-1.pom\n...\n18:06:52  [INFO] my-custom-bom ................................. FAILURE [  0.171 s]\n18:06:52  [INFO] ------------------------------------------------------------------------\n18:06:52  [INFO] BUILD FAILURE\n18:06:52  [INFO] ------------------------------------------------------------------------\n18:06:52  [INFO] Total time:  01:59 min\n18:06:52  [INFO] Finished at: 2025-04-09T18:06:52+02:00\n18:06:52  [INFO] ------------------------------------------------------------------------\n18:06:52  [ERROR] Failed to execute goal org.apache.maven.plugins:maven-deploy-plugin:3.1.4:deploy-file (bom-deploy-release) on project my-custom-bom: Failed to deploy artifacts: Could not transfer artifact my.group.id:my-custom-bom:pom:2.0.2-20250409.160452-1 from/to maven-internal-releases (http://mynexus.mybiz/repository/maven-internal-releases/): status code: 400, reason phrase: Repository version policy: RELEASE does not allow version: 2.0.2-20250409.160452-1 (400) -&gt; [Help 1]\n18:06:52  [ERROR] \n18:06:52  [ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n18:06:52  [ERROR] Re-run Maven using the -X switch to enable full debug logging.\n18:06:52  [ERROR] \n18:06:52  [ERROR] For more information about the errors and possible solutions, please read the following articles:\n18:06:52  [ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n18:06:52  [ERROR] \n18:06:52  [ERROR] After correcting the problems, you can resume the build with the command\n18:06:52  [ERROR]   mvn &lt;args&gt; -rf :my-custom-bom\n</code></pre>\n<p>Version inside the custom pom.xml is identical to the version inside the reactor so my only clue is that it would have something to do with the &quot;true&quot; or the timestamped timestamp in my repository management.</p>\n",
    "tags" : [ "java", "maven", "deployment" ],
    "owner" : {
      "account_id" : 26391949,
      "reputation" : 3,
      "user_id" : 20043701,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/dfa809d1fd9b808621eac9a5df45613f?s=256&d=identicon&r=PG",
      "display_name" : "B. Meert",
      "link" : "https://stackoverflow.com/users/20043701/b-meert"
    },
    "is_answered" : false,
    "view_count" : 51,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1744216274,
    "creation_date" : 1744216274,
    "link" : "https://stackoverflow.com/questions/79564855/skip-parameter-of-maven-deploydeploy-file-seems-not-to-detect-snapshots-and-r",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140331530,
    "post_id" : 79564855,
    "body" : "Maybe i am going the wrong way but currently it is &quot;parent-project&quot; which is the only one built. (install is use in dev, deploy for snapshot and release for release). My issues are :  If I want to use &quot;mvn deploy&quot; on a generated pom I can only automate it in CI/CD but not during during local devs. I wanted to move that down from CI/CD to the maven built to avoid any sort of manual steps. An alternative is to use a dummy bom to pass validation stage and replace it with the generated bom but I don&#39;t like the idea of a generated bom replacing the original one after validate is finished...",
    "score" : 0,
    "owner" : {
      "account_id" : 26391949,
      "reputation" : 3,
      "user_id" : 20043701,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/dfa809d1fd9b808621eac9a5df45613f?s=256&d=identicon&r=PG",
      "display_name" : "B. Meert",
      "link" : "https://stackoverflow.com/users/20043701/b-meert"
    },
    "creation_date" : 1744612052,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140328810,
    "post_id" : 79564855,
    "body" : "Just a simply <code>mvn deploy</code> will do it... What kind of generated pom? Use the pom you have defined... and test it on some branches or create a multi module build where you use a pom file... ?",
    "score" : 0,
    "owner" : {
      "account_id" : 112317,
      "reputation" : 98455,
      "user_id" : 296328,
      "user_type" : "registered",
      "accept_rate" : 60,
      "profile_image" : "https://i.sstatic.net/DSpH6.jpg?s=256",
      "display_name" : "khmarbaise",
      "link" : "https://stackoverflow.com/users/296328/khmarbaise"
    },
    "creation_date" : 1744499860,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140319027,
    "post_id" : 79564855,
    "body" : "This was my first intent but I couldn&#39;t find any way to trigger the &quot;deploy&quot; on the generated pom directly from the build of the multi-module project. Our idea was to configure it once and forget about it forever (and to do so in the ten or so project with the same structure that could benefit from it) The why we use generation is because this is currently a time consuming but highly predictable process.",
    "score" : 0,
    "owner" : {
      "account_id" : 26391949,
      "reputation" : 3,
      "user_id" : 20043701,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/dfa809d1fd9b808621eac9a5df45613f?s=256&d=identicon&r=PG",
      "display_name" : "B. Meert",
      "link" : "https://stackoverflow.com/users/20043701/b-meert"
    },
    "creation_date" : 1744266190,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140317130,
    "post_id" : 79564855,
    "body" : "Why not using the usual pom file and just deploy that... why using deploy-file etc. ?  Use the convention ... maven-deploy-plugin via the life cycle...",
    "score" : 0,
    "owner" : {
      "account_id" : 112317,
      "reputation" : 98455,
      "user_id" : 296328,
      "user_type" : "registered",
      "accept_rate" : 60,
      "profile_image" : "https://i.sstatic.net/DSpH6.jpg?s=256",
      "display_name" : "khmarbaise",
      "link" : "https://stackoverflow.com/users/296328/khmarbaise"
    },
    "creation_date" : 1744216781,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}