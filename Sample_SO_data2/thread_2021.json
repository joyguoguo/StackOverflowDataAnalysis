{
  "question" : {
    "question_id" : 79658269,
    "title" : "Using JNI library (libnfc) to use PN532 reader in the android application. Cannot build a 32-bit shared library for the purpose of running in Emulator",
    "body" : "<p>As mentioned above, I am using the PN532 reader to connect it with the application.\nUsing the 'libnfc' as JNI library, I built the pn532_uart library as a shared library for 'Arm' based to use the application in a Linux distribution board running Android Operating Software.</p>\n<p>This is the NfcNativeInteractive.java</p>\n<pre><code>\npublic class NfcNativeInteractive {\n    static {\n        System.loadLibrary(&quot;pn532_jni&quot;);\n    }\n\n    public native int initialize();\n    public native byte[] readTag();\n    public native boolean writeTag(byte[] data);\n        // Add other native methods as needed\n}\n</code></pre>\n<p>Does the above method of loading the library correct?\nThis is the pn532_jni.cpp</p>\n<pre><code>#include &lt;jni.h&gt;\n#include &lt;string&gt;\n#include &lt;android/log.h&gt;\n\n#define LOG_TAG &quot;PN532_JNI&quot;\n#define LOGI(...) __android_log_print(ANDROID_LOG_INFO, LOG_TAG, __VA_ARGS__)\n\nextern &quot;C&quot;\nJNIEXPORT jint JNICALL\nJava_com_example_mynfcapp_NfcNativeInteractive_initialize(JNIEnv *env, jobject thiz) {\n    LOGI(&quot;Initializing PN532...&quot;);\n    // Replace this with actual init logic\n    return 1;  // Return 1 on success\n}\n\nextern &quot;C&quot;\nJNIEXPORT jbyteArray JNICALL\nJava_com_example_mynfcapp_NfcNativeInteractive_readTag(JNIEnv *env, jobject thiz) {\n    LOGI(&quot;Reading from tag...&quot;);\n    // Dummy data (replace with real tag data)\n    const uint8_t dummy_data[] = {0x01, 0x02, 0x03, 0x04};\n    jbyteArray result = env-&gt;NewByteArray(sizeof(dummy_data));\n    env-&gt;SetByteArrayRegion(result, 0, sizeof(dummy_data), reinterpret_cast&lt;const jbyte *&gt;(dummy_data));\n    return result;\n}\n\nextern &quot;C&quot;\nJNIEXPORT jboolean JNICALL\nJava_com_example_mynfcapp_NfcNativeInteractive_writeTag(JNIEnv *env, jobject thiz, jbyteArray data) {\n    LOGI(&quot;Writing to tag...&quot;);\n    jsize length = env-&gt;GetArrayLength(data);\n    jbyte *nativeData = env-&gt;GetByteArrayElements(data, nullptr);\n\n    // Log the data size (for debug)\n    LOGI(&quot;Data size: %d&quot;, length);\n\n    // write `nativeData` to the tag here\n\n    env-&gt;ReleaseByteArrayElements(data, nativeData, JNI_ABORT); // No changes, so discard\n    return JNI_TRUE; // Return true on success\n}\n</code></pre>\n<p>I have build a '.so' file from the libnfc which is cross compiled with 'ARM' based to use on the Linux distro board.</p>\n<pre><code>autoreconf -vif\n./configure --prefix=/usr --with-drivers=pn532_uart\nmake\nsudo make install\npython3 &quot;/path/to/ndk/make_standalone_toolchain.py&quot; --arch arm --api 21 --install-dir $HOME/android-toolchain\nexport PATH=$HOME/android-toolchain/bin:$PATH\nexport CC=arm-linux-androideabi-clang\nexport LD=arm-linux-androideabi-ld\nexport AR=arm-linux-androideabi-ar\nexport AS=arm-linux-androideabi-as\nexport RANLIB=arm-linux-androideabi-ranlib\nexport STRIP=arm-linux-androideabi-strip\nmake distclean  # clean old build if any\n./configure --host=arm-linux-androideabi --prefix=$HOME/libnfc-android-install\nmake -j4\nmake install\n</code></pre>\n<p>All the steps above works and can be used in the application.\nCurrently, I am running it in android emulator in the Android Studio. The error shows</p>\n<pre><code>java.lang.UnsatisfiedLinkError:dlopen failed: &quot;/data/app/com.example.mynfcapp-n6-6QN8EZJGNK0WbBtF7Eg==/lib/x86/libnfc.so&quot; is 64-bit instead of 32-bit.\n</code></pre>\n<p>Is there any 32-bit library cross compiled method because I've been trying so many methods to build a 32-bit shared library to run it in the Android Studio emulator?</p>\n",
    "tags" : [ "java", "android", "c++", "linux", "java-native-interface" ],
    "owner" : {
      "account_id" : 28715718,
      "reputation" : 23,
      "user_id" : 22182740,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f45c28e25de0742b9a15a9e59f1540ea?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Wan Ammar",
      "link" : "https://stackoverflow.com/users/22182740/wan-ammar"
    },
    "is_answered" : false,
    "view_count" : 132,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1749497949,
    "creation_date" : 1749432487,
    "link" : "https://stackoverflow.com/questions/79658269/using-jni-library-libnfc-to-use-pn532-reader-in-the-android-application-canno",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79658590,
    "question_id" : 79658269,
    "body" : "<p>Build .so libraries for each ABI you want to support</p>\n<p>You must compile your native library separately for:</p>\n<ul>\n<li><p>armeabi-v7a (32-bit ARM)</p>\n</li>\n<li><p>arm64-v8a (64-bit ARM)</p>\n</li>\n<li><p>x86 (32-bit Intel)</p>\n</li>\n<li><p>x86_64 (64-bit Intel)</p>\n</li>\n</ul>\n<p>Because the emulator is x86-based, you need to build an x86 (or x86_64) version of your native library.</p>\n<p>2. Use Android NDK to cross-compile for x86</p>\n<p>Example using standalone toolchain or clang wrapper:</p>\n<pre><code>export NDK=/path/to/android-ndk\nexport API=21\nexport TARGET=i686-linux-android\nexport PATH=$NDK/toolchains/llvm/prebuilt/linux-x86_64/bin:$PATH\nexport CC=&quot;${TARGET}${API}-clang&quot;\nexport CXX=&quot;${TARGET}${API}-clang++&quot;\n</code></pre>\n<p>Then configure and build your native library with <code>--host=i686-linux-android</code> or equivalent</p>\n<pre><code>./configure --host=i686-linux-android --prefix=your_install_dir\nmake clean\nmake -j4\nmake install\n</code></pre>\n<p>This will generate <code>libnfc.so</code> for x86.</p>\n<p>3. Include all your .so files in your APK under <code>jniLibs/</code></p>\n<p>Place the .so files under:</p>\n<ul>\n<li><p><code>app/src/main/jniLibs/armeabi-v7a/libnfc.so</code></p>\n</li>\n<li><p><code>app/src/main/jniLibs/arm64-v8a/libnfc.so</code></p>\n</li>\n<li><p><code>app/src/main/jniLibs/x86/libnfc.so</code></p>\n</li>\n<li><p><code>app/src/main/jniLibs/x86_64/libnfc.so</code></p>\n</li>\n</ul>\n<p>This way, your app will load the correct native library based on the device or emulator ABI.</p>\n<p>4. Alternatively, run an ARM emulator</p>\n<p>If building x86 .so is complex, you can create an ARM emulator image (slow but straightforward) in Android Studio and run your ARM .so there.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 42444345,
      "reputation" : 1,
      "user_id" : 30755278,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2fe0bc2792b97e8033e6b17369368a99?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Gourav Sarmah",
      "link" : "https://stackoverflow.com/users/30755278/gourav-sarmah"
    },
    "creation_date" : 1749457835,
    "last_activity_date" : 1749497949,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140498317,
    "post_id" : 79658269,
    "body" : "I&#39;ve edited the question above.thank you sir.",
    "score" : 0,
    "owner" : {
      "account_id" : 28715718,
      "reputation" : 23,
      "user_id" : 22182740,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f45c28e25de0742b9a15a9e59f1540ea?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Wan Ammar",
      "link" : "https://stackoverflow.com/users/22182740/wan-ammar"
    },
    "creation_date" : 1749449174,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140498291,
    "post_id" : 79658269,
    "body" : "If you are trying to run an &#39;arm&#39; NFC binary on a &#39;x86/x64&#39; AVD, please read: <a href=\"https://stackoverflow.com/q/49146532/295004\">NFC tag emulation for Android virtual device (AVD)</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 111736,
      "reputation" : 12346,
      "user_id" : 295004,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/a29d6038e4dcb7fac98ef41c002975e1?s=256&d=identicon&r=PG",
      "display_name" : "Morrison Chang",
      "link" : "https://stackoverflow.com/users/295004/morrison-chang"
    },
    "creation_date" : 1749448068,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140498095,
    "post_id" : 79658269,
    "body" : "It is unclear what is your question. Did what you did work? Are there errors? Pleas <a href=\"https://stackoverflow.com/posts/79658269/edit\">edit</a> the question to add an explanation of what is the question or issue.",
    "score" : 2,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1749434740,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79658590" : [ {
      "comment_id" : 140498668,
      "post_id" : 79658590,
      "body" : "thank you for the info. I&#39;ll get back to you if anything",
      "score" : 0,
      "owner" : {
        "account_id" : 28715718,
        "reputation" : 23,
        "user_id" : 22182740,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/f45c28e25de0742b9a15a9e59f1540ea?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Wan Ammar",
        "link" : "https://stackoverflow.com/users/22182740/wan-ammar"
      },
      "creation_date" : 1749460431,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}