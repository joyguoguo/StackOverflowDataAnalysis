{
  "question" : {
    "question_id" : 79672197,
    "title" : "Spring boot Framework LDAPTemplate PoolingContextSource not working during ldle scenario",
    "body" : "<p><strong>Problem Description:</strong>\nLDAP server suspended new connections due to Spring LDAP Template pool created so many connections in a short period of time. After a while, LDAP server resumed serving requests normally.</p>\n<p><strong>Background of the Problem:</strong></p>\n<p>We have below setting in our app\nminEvictableIdleTimeMillis = 90000\ntimeBetweenEvictionRunsMillis = 15000\nSo, every 15 seconds, the pool scans for idle connections, and evicts those that have been idle for 90+ seconds.</p>\n<p>Under high traffic, application is actively being used and there are no/very less idle connections, pooling settings are working. But during idle scenarios, new connections are keep on getting created even beyond defined total no. of connections.</p>\n<p>But if we keep testWhileIdle=false or timeBetweenEvictionRunsMillis is -1 then pooling works even in low traffic. What we are missing? testOnBorrow is true. What can be a problem here?</p>\n",
    "tags" : [ "java", "spring-boot", "ldap", "apache-commons-pool" ],
    "owner" : {
      "account_id" : 8074430,
      "reputation" : 1,
      "user_id" : 6085991,
      "user_type" : "registered",
      "profile_image" : "https://lh5.googleusercontent.com/-RUzR8IaLSYM/AAAAAAAAAAI/AAAAAAAAADw/Ta597tzPYSY/s256-rj/photo.jpg",
      "display_name" : "vikas thakur",
      "link" : "https://stackoverflow.com/users/6085991/vikas-thakur"
    },
    "is_answered" : false,
    "view_count" : 92,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1750843119,
    "creation_date" : 1750342325,
    "link" : "https://stackoverflow.com/questions/79672197/spring-boot-framework-ldaptemplate-poolingcontextsource-not-working-during-ldle",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79678786,
    "question_id" : 79672197,
    "body" : "<p>We figured out that it was due to memory leak in Apache commons library (probably 1.6x) and spring 2.4.x was using it because of imports in our code. After we made code changes for spring imports using pool2, it started working.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 8074430,
      "reputation" : 1,
      "user_id" : 6085991,
      "user_type" : "registered",
      "profile_image" : "https://lh5.googleusercontent.com/-RUzR8IaLSYM/AAAAAAAAAAI/AAAAAAAAADw/Ta597tzPYSY/s256-rj/photo.jpg",
      "display_name" : "vikas thakur",
      "link" : "https://stackoverflow.com/users/6085991/vikas-thakur"
    },
    "creation_date" : 1750843119,
    "last_activity_date" : 1750843119,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140529155,
    "post_id" : 79672197,
    "body" : "I would suggest aligning the timeouts/idle settings withyour server. What do you see in the logs when you enable DEBUG logging for <code>org.springframework.ldap</code>. Internally Apache Commons Pool is being used which should call destroy Object. The fact that there are 70 TCP/IP connections (that is the netstat thing) doesn&#39;t mean there are 70 active connections in the pool.",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1750414587,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140527119,
    "post_id" : 79672197,
    "body" : "<a href=\"https://www.ibm.com/support/pages/excessive-db-connections-opened-websphere-lombardi-edition-under-load\" rel=\"nofollow noreferrer\">ibm.com/support/pages/&hellip;</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 8074430,
      "reputation" : 1,
      "user_id" : 6085991,
      "user_type" : "registered",
      "profile_image" : "https://lh5.googleusercontent.com/-RUzR8IaLSYM/AAAAAAAAAAI/AAAAAAAAADw/Ta597tzPYSY/s256-rj/photo.jpg",
      "display_name" : "vikas thakur",
      "link" : "https://stackoverflow.com/users/6085991/vikas-thakur"
    },
    "creation_date" : 1750345755,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140527117,
    "post_id" : 79672197,
    "body" : "LDAP server(with timeout=300secs) netstat shows no. of connections  increasing  beyond 70 which all are in ESTABLISHED state, when the max total is only 30 connections. We are using default context validator and because we are using testonborrow hence the validation works. FW could be silently dropping but from spring debug logs we could see the active no. of connections are increasing even for 1 request after being idle. Issue is similar to link",
    "score" : 0,
    "owner" : {
      "account_id" : 8074430,
      "reputation" : 1,
      "user_id" : 6085991,
      "user_type" : "registered",
      "profile_image" : "https://lh5.googleusercontent.com/-RUzR8IaLSYM/AAAAAAAAAAI/AAAAAAAAADw/Ta597tzPYSY/s256-rj/photo.jpg",
      "display_name" : "vikas thakur",
      "link" : "https://stackoverflow.com/users/6085991/vikas-thakur"
    },
    "creation_date" : 1750345739,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140526973,
    "post_id" : 79672197,
    "body" : "I doubt it creates more connections then the total you specified. I suspect your periods are too small for the LDAP server and you churn through your allowed created connections in a said timeframe. So contact the maintainers of your LDAP server and figure out the right numbers.",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1750342858,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}