{
  "question" : {
    "question_id" : 79738866,
    "title" : "Mockito, Java not producing reliable results",
    "body" : "<p>I have a Java test class setup with Mockito and get some strange behavior. My class looks as follows:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@ExtendWith(MockitoExtension.class)\npublic class FrameworkTest {\n    @Mock private OrderService orderService;\n\n    @InjectMocks private CompanyService companyService;\n\n    @Test\n    void testexecuteOrder() {\n        Mockito.when(orderService.executeAuftrag((OrderData) Mockito.any()))\n        .thenReturn(OrderAnswer.builder().successful(true).build());\n\n        Output output = companyService.execute();\n        // ...\n    }\n\n}\n</code></pre>\n<p>The method <code>orderService.executeAuftrag()</code> is overloaded, only one method has as parameter <code>OrderData</code>, so I have to cast <code>Mockito.any()</code> to make it work.</p>\n<p>Now my intuition is that <code>company.execute()</code> is executed with the <code>orderService</code> Mock and returns a successful <code>OrderAnswer</code> when the method <code>executeAuftrag</code> is called with OrderData (since I mocked it that way).</p>\n<p>And that is actually what happens. Some of the times. Some other times - executing the exact same code without changes - the method <code>executeAuftrag()</code> returns a <code>null</code> object, making my test fail, because in the following line in CompanyService, a NPE is produced.</p>\n<p>I find it very confusing that the exact same code without any changes sometimes does what it is expected to do and sometimes returns a <code>null</code> where it is supposed to return a <code>OrderAnswer</code> object.</p>\n<p>Am I missing something?</p>\n<p>Maybe I am using the wrong methods for mocking? Maybe there is some state saved between tests that I don't see?</p>\n<p>My Mockito version is</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.mockito&lt;/groupId&gt;\n    &lt;artifactId&gt;mockito-core&lt;/artifactId&gt;\n    &lt;version&gt;3.12.4&lt;/version&gt;\n    &lt;scope&gt;test&lt;/scope&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>I use <code>org.junit.jupiter:junit-jupiter-api:5.10.1</code>.</p>\n",
    "tags" : [ "java", "mockito", "junit5" ],
    "owner" : {
      "account_id" : 1634731,
      "reputation" : 3964,
      "user_id" : 1508529,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/974a4e8de28274c71bf5e08a39ca1b86?s=256&d=identicon&r=PG",
      "display_name" : "Mathias Bader",
      "link" : "https://stackoverflow.com/users/1508529/mathias-bader"
    },
    "is_answered" : true,
    "view_count" : 147,
    "answer_count" : 1,
    "score" : 2,
    "last_activity_date" : 1755601624,
    "creation_date" : 1755526948,
    "link" : "https://stackoverflow.com/questions/79738866/mockito-java-not-producing-reliable-results",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79739815,
    "question_id" : 79738866,
    "body" : "<p>Just found the problem. Posting it here since the behavior is kind of interesting and other people might have the same problem.</p>\n<p>The problem was the following:<br />\n<code>OrderService</code> is an interface - the mocking here was correct. But the implementation <code>OrderServiceImpl</code> was also mocked:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Mock private OrderService orderService;\n@Mock private OrderServiceImpl orderServiceImpl;\n</code></pre>\n<p>The names of the variables in my case were not as obvious as above so I overlooked it. After removing the Mock of the implementation, it works exactly as it should.</p>\n<p>Interesting to me that there is no warning by Mockito when you mock an interface and the implementation for it. Also interesting that it sometimes worked and sometimes didn't - that made it really difficult to analyze.</p>\n<p>Thanks for the comments which helped me finding the solution.</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 1634731,
      "reputation" : 3964,
      "user_id" : 1508529,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/974a4e8de28274c71bf5e08a39ca1b86?s=256&d=identicon&r=PG",
      "display_name" : "Mathias Bader",
      "link" : "https://stackoverflow.com/users/1508529/mathias-bader"
    },
    "creation_date" : 1755601624,
    "last_activity_date" : 1755601624,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140676056,
    "post_id" : 79738866,
    "body" : "<code>code</code>(OrderData) Mockito.any())<code>code</code>  does look like a suspect. One of the question I would ask is that what would that code becomes after compiled into ByteCode. I guess the result will never be as dynamic as we might imagine. The exact type of the method call can only be decided in runtime. But a type-cast is already been done in compile time.  this is a question almost like having a suspect candidate in spot-light. just don&#39;t have concrete evidence yet.",
    "score" : 0,
    "owner" : {
      "account_id" : 2401468,
      "reputation" : 2821,
      "user_id" : 2099049,
      "user_type" : "registered",
      "accept_rate" : 43,
      "profile_image" : "https://i.sstatic.net/aA9xW.jpg?s=256",
      "display_name" : "cscmh99",
      "link" : "https://stackoverflow.com/users/2099049/cscmh99"
    },
    "creation_date" : 1755602395,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140675679,
    "post_id" : 79738866,
    "body" : "Sorry, <code>OrderService</code> is an interface, I just double checked",
    "score" : 0,
    "owner" : {
      "account_id" : 1634731,
      "reputation" : 3964,
      "user_id" : 1508529,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/974a4e8de28274c71bf5e08a39ca1b86?s=256&d=identicon&r=PG",
      "display_name" : "Mathias Bader",
      "link" : "https://stackoverflow.com/users/1508529/mathias-bader"
    },
    "creation_date" : 1755592658,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140675661,
    "post_id" : 79738866,
    "body" : "If OrderService is a class, then <code>when(orderService.executeAuftrag(â€¦))</code> will execute the <i>real</i> method (passing <code>null</code>; <code>any()</code> records the matcher and returns null). Can you <a href=\"https://stackoverflow.com/posts/79738866/edit\">edit</a> the question to show the impl of <code>executeAuftrag</code> and <code>companyService.execute</code>?",
    "score" : 0,
    "owner" : {
      "account_id" : 39208,
      "reputation" : 269427,
      "user_id" : 112968,
      "user_type" : "registered",
      "accept_rate" : 68,
      "profile_image" : "https://i.sstatic.net/zHTaT.png?s=256",
      "display_name" : "knittl",
      "link" : "https://stackoverflow.com/users/112968/knittl"
    },
    "creation_date" : 1755592086,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140675556,
    "post_id" : 79738866,
    "body" : "Which unit testing framework (and which version) do you use? It looks obvious, but just to be sure that one can understand the questions in a few months/years from now.",
    "score" : 0,
    "owner" : {
      "account_id" : 3391382,
      "reputation" : 5350,
      "user_id" : 2846138,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/2sp68.png?s=256",
      "display_name" : "cyberbrain",
      "link" : "https://stackoverflow.com/users/2846138/cyberbrain"
    },
    "creation_date" : 1755589089,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140675500,
    "post_id" : 79738866,
    "body" : "<code>OrderService</code> is a class. Since I do a <code>.when().thenReturn()</code> there should be no side-effects like with <code>.verify(myObject).methodCalled(withParam)</code>. The <code>.when().thenReturn()</code> is idempotent, right? I get the above mentioned results when I execute only this Test and then the same test (and only this) again, without executing something else.",
    "score" : 0,
    "owner" : {
      "account_id" : 1634731,
      "reputation" : 3964,
      "user_id" : 1508529,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/974a4e8de28274c71bf5e08a39ca1b86?s=256&d=identicon&r=PG",
      "display_name" : "Mathias Bader",
      "link" : "https://stackoverflow.com/users/1508529/mathias-bader"
    },
    "creation_date" : 1755587844,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140675471,
    "post_id" : 79738866,
    "body" : "Do you get a consistent result when running the test in debug mode with a breakpoint at the beginning of the test? Given that it passes some times, I think it may have to do with the order of test execution. Alternatively, you can use thd <code>@Order</code> annotation and test the hypothesis.",
    "score" : 0,
    "owner" : {
      "account_id" : 12810928,
      "reputation" : 2738,
      "user_id" : 9269177,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/hnZVJ.jpg?s=256",
      "display_name" : "Debargha Roy",
      "link" : "https://stackoverflow.com/users/9269177/debargha-roy"
    },
    "creation_date" : 1755586982,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140675219,
    "post_id" : 79738866,
    "body" : "A minimal reproducible example, as mentioned above, would be helpful. You can set breakpoints on all the overloaded methods you were mentioning and then debug the test to see which one is actually called (any maybe from there you can also see why).",
    "score" : 0,
    "owner" : {
      "account_id" : 27708010,
      "reputation" : 43,
      "user_id" : 21151246,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0966383c8c043b2954425aefe5848acc?s=256&d=identicon&r=PG",
      "display_name" : "Tonypsilon",
      "link" : "https://stackoverflow.com/users/21151246/tonypsilon"
    },
    "creation_date" : 1755575622,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140674471,
    "post_id" : 79738866,
    "body" : "I suspect conditional logic in your application, resulting in methods invoked which you did not expect.",
    "score" : 1,
    "owner" : {
      "account_id" : 3977767,
      "reputation" : 24085,
      "user_id" : 3280538,
      "user_type" : "registered",
      "accept_rate" : 74,
      "profile_image" : "https://i.sstatic.net/pYuGC.jpg?s=256",
      "display_name" : "flakes",
      "link" : "https://stackoverflow.com/users/3280538/flakes"
    },
    "creation_date" : 1755543185,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140674178,
    "post_id" : 79738866,
    "body" : "It seems that you need to provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> in the question.",
    "score" : 3,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1755535814,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140674007,
    "post_id" : 79738866,
    "body" : "Is <code>OrderService</code> an interface?",
    "score" : 1,
    "owner" : {
      "account_id" : 39208,
      "reputation" : 269427,
      "user_id" : 112968,
      "user_type" : "registered",
      "accept_rate" : 68,
      "profile_image" : "https://i.sstatic.net/zHTaT.png?s=256",
      "display_name" : "knittl",
      "link" : "https://stackoverflow.com/users/112968/knittl"
    },
    "creation_date" : 1755531498,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140674006,
    "post_id" : 79738866,
    "body" : "Try <code>Mockito.any(OrderData.class)</code> or <code>Mockito.nullable(OrderData.class)</code>",
    "score" : 0,
    "owner" : {
      "account_id" : 39208,
      "reputation" : 269427,
      "user_id" : 112968,
      "user_type" : "registered",
      "accept_rate" : 68,
      "profile_image" : "https://i.sstatic.net/zHTaT.png?s=256",
      "display_name" : "knittl",
      "link" : "https://stackoverflow.com/users/112968/knittl"
    },
    "creation_date" : 1755531476,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140673835,
    "post_id" : 79738866,
    "body" : "I tried both variants with the same results. I opted to the version I have above because IntelliJ IDEA suggested it and I thought that migth then not be the worst option",
    "score" : 0,
    "owner" : {
      "account_id" : 1634731,
      "reputation" : 3964,
      "user_id" : 1508529,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/974a4e8de28274c71bf5e08a39ca1b86?s=256&d=identicon&r=PG",
      "display_name" : "Mathias Bader",
      "link" : "https://stackoverflow.com/users/1508529/mathias-bader"
    },
    "creation_date" : 1755528277,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140673823,
    "post_id" : 79738866,
    "body" : "Why do you cast the parameter in your <code>when</code> instead of just passing the class to the any call? (<code>Mockito.any(OrderData.class)</code> instead of <code>(OderData) Mockito.any()</code>)",
    "score" : 4,
    "owner" : {
      "account_id" : 3391382,
      "reputation" : 5350,
      "user_id" : 2846138,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/2sp68.png?s=256",
      "display_name" : "cyberbrain",
      "link" : "https://stackoverflow.com/users/2846138/cyberbrain"
    },
    "creation_date" : 1755528012,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79739815" : [ {
      "comment_id" : 140680199,
      "post_id" : 79739815,
      "body" : "You are right, that was difficult. I had a hard time providing just the minimal example and I thougth / hoped what I provided was enough.",
      "score" : 1,
      "owner" : {
        "account_id" : 1634731,
        "reputation" : 3964,
        "user_id" : 1508529,
        "user_type" : "registered",
        "accept_rate" : 82,
        "profile_image" : "https://www.gravatar.com/avatar/974a4e8de28274c71bf5e08a39ca1b86?s=256&d=identicon&r=PG",
        "display_name" : "Mathias Bader",
        "link" : "https://stackoverflow.com/users/1508529/mathias-bader"
      },
      "creation_date" : 1755717535,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140677267,
      "post_id" : 79739815,
      "body" : "But how could anyone have answered this question when you didn&#39;t provide this part of the code?",
      "score" : 1,
      "owner" : {
        "account_id" : 39208,
        "reputation" : 269427,
        "user_id" : 112968,
        "user_type" : "registered",
        "accept_rate" : 68,
        "profile_image" : "https://i.sstatic.net/zHTaT.png?s=256",
        "display_name" : "knittl",
        "link" : "https://stackoverflow.com/users/112968/knittl"
      },
      "creation_date" : 1755627886,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}