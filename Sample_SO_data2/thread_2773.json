{
  "question" : {
    "question_id" : 79598519,
    "title" : "Channel closing when application is restarting",
    "body" : "<p>When my application gets an unexpected type of exception I use</p>\n<pre class=\"lang-java prettyprint-override\"><code>channel.basicNack(tag, false, true);\nSpringApplication.exit(context);\n</code></pre>\n<p>to stop the app and put the message in its original queue.\nAfter that the application restarts and sometimes the application dies while starting with these kinds of logs:</p>\n<pre><code>:: Spring Boot ::                (v3.1.0)\n: Created new connection: aggregator-step-input/SimpleConnection@65a3660b [delegate=amqp://sesam-aggr@10.96.24.73:5672/mdm, localPort=50432]\n Started AggregatorSesamApplication in 74.105 seconds (process running for 81.451)\n Waiting for workers to finish.\n receiving object type OTP_PRODUCT\n Workers not finished.\n Closing channel for unresponsive consumer: Consumer@7d93bed1: tags=[[amq.ctag-8ZzSRpC9mLC6-c7mVK2KIg]], channel=Cached Rabbit Channel: AMQChannel(amqp://sesam-aggr@10.96.24.73:5672/mdm,1), conn: Proxy@18f716bc Shared Rabbit Connection: SimpleConnection@65a3660b [delegate=amqp://sesam-aggr@10.96.24.73:5672/mdm, localPort=50432], acknowledgeMode=MANUAL local queue size=0\nShutdown ignored - container is already stopped\n</code></pre>\n<p>I can see that the reason for it is an unresponsive consumer, but I don't know how to fix it.\nI've already tried to abort the channel, disable the restart main from Spring devtools or disable the durable option of the Queue object that I'm using. I guess the problem comes from the way I'm stopping the channel, but I can't manage to find the right way to do it.</p>\n<p>I should mention that when the exception first arrives, I also get the logs of Waiting for workers to finish. and Workers not finished. except when I use <code>channel.abort()</code> but even with this I still get these at the restart.\nI should also mention that I use the AcknowledgeMode : MANUAL.</p>\n",
    "tags" : [ "java", "spring", "rabbitmq", "amqp" ],
    "owner" : {
      "account_id" : 27418771,
      "reputation" : 11,
      "user_id" : 20917561,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/71279b7f5efa75991248ad27d2a731b7?s=256&d=identicon&r=PG",
      "display_name" : "Ikarus",
      "link" : "https://stackoverflow.com/users/20917561/ikarus"
    },
    "is_answered" : false,
    "view_count" : 44,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1745936461,
    "creation_date" : 1745934473,
    "link" : "https://stackoverflow.com/questions/79598519/channel-closing-when-application-is-restarting",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}