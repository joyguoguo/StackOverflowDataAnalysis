{
  "question" : {
    "question_id" : 79558178,
    "title" : "How can I dynamically choose a Log4j2 appender at runtime using only a shell script?",
    "body" : "<p>I have a Java application that uses Log4j2 for logging. I want to control which appender is used at runtime—but only via a shell script, without modifying the Java source code.</p>\n<p>My log4j2.xml configuration defines three RollingFile appenders: logger1-Appender, logger2-Appender, and logger3-Appender. Each writes to a different file, and I’d like to decide which one to use based on the shell (or .bat) script that starts the application.</p>\n<p>Is this even possible without modifying the Java code?</p>\n<p>Here's a simplified version of my shell script:</p>\n<p><strong>sh file:</strong></p>\n<pre><code>#!/bin/bash\n\nAPPENDER=$1\njava -Dlog.appender=$APPENDER -jar app.jar\n</code></pre>\n<p>** log4j2.xml rolling files**</p>\n<pre><code>    &lt;RollingFile name=&quot;logger1-Appender&quot;\n             fileName=&quot;${log-path}logger1.log&quot;\n             filePattern=&quot;${log-path}logger1_%i.log&quot;&gt;\n    &lt;PatternLayout pattern=&quot;${log-pattern}&quot;/&gt;\n    &lt;Policies&gt;\n        &lt;SizeBasedTriggeringPolicy size=&quot;10 MB&quot;/&gt;\n        &lt;OnStartupTriggeringPolicy/&gt;\n        &lt;TimeBasedTriggeringPolicy interval=&quot;1&quot; modulate=&quot;true&quot;/&gt;\n    &lt;/Policies&gt;\n    &lt;DefaultRolloverStrategy fileIndex=&quot;min&quot; max=&quot;5&quot;/&gt;\n&lt;/RollingFile&gt;\n\n&lt;RollingFile name=&quot;logger2-Appender&quot;\n             fileName=&quot;${log-path}logger2-${date:dd-MM-yyyy}.log&quot;\n             filePattern=&quot;${log-path}logger2-%d{yyyy-MM-dd}-%i.log&quot;&gt;\n    &lt;PatternLayout pattern=&quot;${log-pattern}&quot;/&gt;\n    &lt;Policies&gt;\n        &lt;SizeBasedTriggeringPolicy size=&quot;10 MB&quot;/&gt;\n        &lt;OnStartupTriggeringPolicy/&gt;\n        &lt;TimeBasedTriggeringPolicy interval=&quot;1&quot; modulate=&quot;true&quot;/&gt;\n    &lt;/Policies&gt;\n    &lt;DefaultRolloverStrategy fileIndex=&quot;min&quot; max=&quot;40&quot;/&gt;\n&lt;/RollingFile&gt;\n\n    &lt;RollingFile name=&quot;logger3-Appender&quot;\n             fileName=&quot;${log-path}logger3.log&quot;\n             filePattern=&quot;${log-path}logger3_%i.log&quot;&gt;\n    &lt;PatternLayout pattern=&quot;${log-pattern}&quot;/&gt;\n    &lt;Policies&gt;\n        &lt;SizeBasedTriggeringPolicy size=&quot;10 MB&quot;/&gt;\n        &lt;OnStartupTriggeringPolicy/&gt;\n        &lt;TimeBasedTriggeringPolicy interval=&quot;1&quot; modulate=&quot;true&quot;/&gt;\n    &lt;/Policies&gt;\n    &lt;DefaultRolloverStrategy fileIndex=&quot;min&quot; max=&quot;5&quot;/&gt;\n&lt;/RollingFile&gt;\n</code></pre>\n<p>Thanks in advance for any help or suggestions!</p>\n",
    "tags" : [ "java", "logging", "log4j", "log4j2" ],
    "owner" : {
      "account_id" : 41226626,
      "reputation" : 1,
      "user_id" : 30185210,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/500f637dac443c58493f449ec7e39200?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "gal kar",
      "link" : "https://stackoverflow.com/users/30185210/gal-kar"
    },
    "is_answered" : true,
    "view_count" : 124,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1744120176,
    "creation_date" : 1743941838,
    "link" : "https://stackoverflow.com/questions/79558178/how-can-i-dynamically-choose-a-log4j2-appender-at-runtime-using-only-a-shell-scr",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79558775,
    "question_id" : 79558178,
    "body" : "<p>You can use an Arbiter to select which appender ref you want to use for example:</p>\n<pre><code>&lt;Root level=&quot;debug&quot;&gt;\n    &lt;Select&gt;\n        &lt;SystemPropertyArbiter property=&quot;log.loggerRef&quot; value=&quot;logger1&quot;&gt;\n            &lt;AppenderRef ref=&quot;logger1-Appender&quot;/&gt;\n        &lt;/SystemPropertyArbiter&gt;\n        &lt;SystemPropertyArbiter property=&quot;log.loggerRef&quot; value=&quot;logger2&quot;&gt;\n            &lt;AppenderRef ref=&quot;logger2-Appender&quot;/&gt;\n        &lt;/SystemPropertyArbiter&gt;\n        &lt;DefaultArbiter&gt;\n            &lt;AppenderRef ref=&quot;logger3-Appender&quot;/&gt;\n        &lt;/DefaultArbiter&gt;\n    &lt;/Select&gt;\n&lt;/Root&gt;\n</code></pre>\n<p>Or as a slick suggestion by @piotr-p-karwasz.</p>\n<pre><code>&lt;Root level=&quot;debug&quot;&gt;\n   &lt;AppenderRef ref=&quot;${sys:log.appender:-logger3-Appender}&quot;/&gt;\n&lt;/Root&gt;\n</code></pre>\n<p>Definitely cuts down on the keystrokes.  The only downside is if you passed <code>log.appender</code> = <code>logger2-Appendre</code> or <code>logger4-Appender</code> this would blow up where the first one would gracefully pick the default arbiter.</p>\n<p>Then in your script you do this:</p>\n<pre><code>#!/bin/bash\n\n#APPENDER=$1\n#java -Dlog.appender=$APPENDER -jar app.jar\njava -Dlog.loggerRef=logger1 -jar app.jar\n</code></pre>\n<p>Of course you can use your <code>$1</code> argument to pass that value into your script as you had shown.  But, I wanted to make it clear what value you'd use in your java invocation.  Hence why I simply commented it out so you can see the two ways to invoke Java.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 51881,
      "reputation" : 39410,
      "user_id" : 155020,
      "user_type" : "registered",
      "accept_rate" : 80,
      "profile_image" : "https://i.sstatic.net/fEqVo.png?s=256",
      "display_name" : "chubbsondubs",
      "link" : "https://stackoverflow.com/users/155020/chubbsondubs"
    },
    "creation_date" : 1743975564,
    "last_activity_date" : 1744115575,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79562238,
    "question_id" : 79558178,
    "body" : "<p>this solved the issue for me<br />\nin .sh file:</p>\n<pre><code>if [ &quot;${APPENDER}&quot; = &quot;logger1&quot; ]; then\n    # Use the ChangeDebugLevelLog4j.xml configuration file\n    log4j_config=&quot;-Dlog4j.configurationFile=${config_path}/log4j2.xml -DlogName=logger1&quot;\nelif [ &quot;${APPENDER}&quot; = &quot;logger1&quot; ]; then\n    # Use the ArcDiagLog4j.xml configuration file\n    log4j_config=&quot;-Dlog4j.configurationFile=${config_path}/log4j2.xml -DlogName=logger2&quot;\nelse\n    # Default to ArchiveLog4j.xml configuration file\n    log4j_config=&quot;-Dlog4j.configurationFile=${config_path}/log4j2.xml -DlogName=logger3&quot;\nfi\njava log4j_config app.java\n</code></pre>\n<p>in log4j2.xml file:</p>\n<pre><code>\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;Configuration status=&quot;WARN&quot;&gt;\n\n    &lt;Properties&gt;\n        &lt;Property name=&quot;LOG_PATTERN&quot;&gt;\n            %-40.40c{1.} : %notEmpty{%m}%n%ex\n        &lt;/Property&gt;\n        &lt;Property name=&quot;PID&quot;&gt;${sys:PID}&lt;/Property&gt;\n        &lt;Property name=&quot;FS&quot;&gt;${sys:file.separator}&lt;/Property&gt;\n        &lt;Property name=&quot;log-path&quot;&gt;log${sys:file.separator}&lt;/Property&gt;\n        &lt;Property name=&quot;log-pattern&quot;&gt;%d{yyyy-MM-dd HH:mm:ss,SSS} PID:${sys:PID} %-2p [T@%tid-%t] %notEmpty{%marker} %m%n&lt;/Property&gt;\n    &lt;/Properties&gt;\n    \n    &lt;Appenders&gt;\n        &lt;Routing name=&quot;Routing&quot;&gt;\n            &lt;Routes pattern=&quot;$${sys:logName}&quot;&gt;\n                &lt;Route key=&quot;ArchiveLog&quot;&gt;\n                    &lt;File name=&quot;ArchiveLog&quot; fileName=&quot;${log-path}logger1-${date:dd-MM-yyyy}.log&quot;&gt;\n                    &lt;PatternLayout pattern=&quot;${log-pattern}&quot;/&gt;\n                    &lt;/File&gt;\n                &lt;/Route&gt;\n                &lt;Route key=&quot;ArcDiag&quot;&gt;\n                    &lt;File name=&quot;ArcDiag&quot; fileName=&quot;${log-path}logger2-${date:dd-MM-yyyy}.log&quot;&gt;\n                    &lt;PatternLayout pattern=&quot;${log-pattern}&quot;/&gt;\n                    &lt;/File&gt;\n                &lt;/Route&gt;\n                &lt;Route key=&quot;ChangeDebugLevel&quot;&gt;\n                    &lt;File name=&quot;ChangeDebugLevel&quot; fileName=&quot;${log-path}logger3-${date:dd-MM-yyyy}.log&quot;&gt;\n                    &lt;PatternLayout pattern=&quot;${log-pattern}&quot;/&gt;\n                    &lt;/File&gt;\n                &lt;/Route&gt;\n            &lt;/Routes&gt;\n        &lt;/Routing&gt;\n    &lt;/Appenders&gt;\n\n    &lt;Loggers&gt;\n        &lt;Logger name=&quot;logger1&quot; level=&quot;trace&quot; additivity=&quot;false&quot;&gt;\n            &lt;AppenderRef ref=&quot;Routing&quot; /&gt;\n        &lt;/Logger&gt;\n        &lt;Logger name=&quot;logger2&quot; level=&quot;trace&quot; additivity=&quot;false&quot;&gt;\n            &lt;AppenderRef ref=&quot;Routing&quot; /&gt;\n        &lt;/Logger&gt;\n        &lt;Logger name=&quot;logger3&quot; level=&quot;trace&quot; additivity=&quot;false&quot;&gt;\n            &lt;AppenderRef ref=&quot;Routing&quot; /&gt;\n        &lt;/Logger&gt;\n        &lt;Root level=&quot;info&quot;&gt;\n            &lt;AppenderRef ref=&quot;Routing&quot;/&gt;\n        &lt;/Root&gt;\n    &lt;/Loggers&gt;\n\n&lt;/Configuration&gt;\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 41226626,
      "reputation" : 1,
      "user_id" : 30185210,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/500f637dac443c58493f449ec7e39200?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "gal kar",
      "link" : "https://stackoverflow.com/users/30185210/gal-kar"
    },
    "creation_date" : 1744120176,
    "last_activity_date" : 1744120176,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140305234,
    "post_id" : 79558178,
    "body" : "explore on &lt;Routing name=&quot;RoutingAppender&quot;&gt;, it should solve this issue, let me know if you need the sample code.",
    "score" : 0,
    "owner" : {
      "account_id" : 7645025,
      "reputation" : 440,
      "user_id" : 5795975,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-6KwPUS4RnyA/AAAAAAAAAAI/AAAAAAAAC8w/auZqreI45x0/s256-rj/photo.jpg",
      "display_name" : "Vijay",
      "link" : "https://stackoverflow.com/users/5795975/vijay"
    },
    "creation_date" : 1743959950,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140304838,
    "post_id" : 79558178,
    "body" : "Hi , I don&#39;t want to add default property i want to be able to choose which property to use when triggering the java app in the sh/bat file",
    "score" : 0,
    "owner" : {
      "account_id" : 41226626,
      "reputation" : 1,
      "user_id" : 30185210,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/500f637dac443c58493f449ec7e39200?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "gal kar",
      "link" : "https://stackoverflow.com/users/30185210/gal-kar"
    },
    "creation_date" : 1743949240,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140304634,
    "post_id" : 79558178,
    "body" : "This question is similar to: <a href=\"https://stackoverflow.com/questions/22028399/log4j2-property-substitution-default\">Log4J2 property substitution - default</a>. If you believe it’s different, please <a href=\"https://stackoverflow.com/posts/79558178/edit\">edit</a> the question, make it clear how it’s different and/or how the answers on that question are not helpful for your problem.",
    "score" : 1,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1743942395,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79562238" : [ {
      "comment_id" : 140345089,
      "post_id" : 79562238,
      "body" : "In <a href=\"https://stackoverflow.com/a/79558775/11748454\">@chubbsondubbs solution</a> the appender to use is chosen only <b>once</b> at configuration time. In your solution <code>${sys:logName}</code> is evaluated at <b>each log event</b>, which will provide a worse performance.",
      "score" : 0,
      "owner" : {
        "account_id" : 16269349,
        "reputation" : 16729,
        "user_id" : 11748454,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/qyBNp.jpg?s=256",
        "display_name" : "Piotr P. Karwasz",
        "link" : "https://stackoverflow.com/users/11748454/piotr-p-karwasz"
      },
      "creation_date" : 1744902921,
      "content_license" : "CC BY-SA 4.0"
    } ],
    "79558775" : [ {
      "comment_id" : 140311720,
      "post_id" : 79558775,
      "body" : "Thanks @piotr-p-karwasz that was a great suggestion.",
      "score" : 0,
      "owner" : {
        "account_id" : 51881,
        "reputation" : 39410,
        "user_id" : 155020,
        "user_type" : "registered",
        "accept_rate" : 80,
        "profile_image" : "https://i.sstatic.net/fEqVo.png?s=256",
        "display_name" : "chubbsondubs",
        "link" : "https://stackoverflow.com/users/155020/chubbsondubs"
      },
      "creation_date" : 1744115672,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140310534,
      "post_id" : 79558775,
      "body" : "Note that property substitution like <code>${sys:log.appender:-logger3-Appender}</code> can also be used in the <code>ref</code> attribute, but using arbiters is much more resilient to invalid appender name values.",
      "score" : 1,
      "owner" : {
        "account_id" : 16269349,
        "reputation" : 16729,
        "user_id" : 11748454,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/qyBNp.jpg?s=256",
        "display_name" : "Piotr P. Karwasz",
        "link" : "https://stackoverflow.com/users/11748454/piotr-p-karwasz"
      },
      "creation_date" : 1744095433,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}