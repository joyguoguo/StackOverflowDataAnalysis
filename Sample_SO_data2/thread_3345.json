{
  "question" : {
    "question_id" : 79557012,
    "title" : "I am using LangChain4j to develop a knowledge base and encountered the &quot;different vector dimensions 1024 and 384&quot;",
    "body" : "<p>I want to know if there are any other settings required for pgvector or what content needs to be set in the code to enable pgvector to support higher vector dimensions. I found on the official website that pgvector can support vector dimensions up to 2000.The pgvector version is pgvector/pgvector:pg17</p>\n<p>This model supports vector values of 1024. This is the Alibaba Cloud dashscope model</p>\n<pre class=\"lang-yaml prettyprint-override\"><code>langchain4j:\n  community:\n    dashscope:\n       chat-model:\n         model-name: deepseek-r1\n       embedding-model:\n         model-name: text-embedding-v3\n</code></pre>\n<p>This is the POM file, the version of the related dependencies</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;maven.compiler.source&gt;21&lt;/maven.compiler.source&gt;\n&lt;maven.compiler.target&gt;21&lt;/maven.compiler.target&gt;\n&lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;\n&lt;lombok.version&gt;1.18.30&lt;/lombok.version&gt;\n&lt;junit.version&gt;5.11.4&lt;/junit.version&gt;\n&lt;log4j2.version&gt;2.24.3&lt;/log4j2.version&gt;\n&lt;springboot.version&gt;3.3.2&lt;/springboot.version&gt;\n&lt;postgresql.version&gt;42.3.8&lt;/postgresql.version&gt;\n&lt;mybatis-plus.version&gt;3.5.8&lt;/mybatis-plus.version&gt;\n&lt;oapi-sdk&gt;2.4.8&lt;/oapi-sdk&gt;\n&lt;caffeine.version&gt;3.1.8&lt;/caffeine.version&gt;\n&lt;httpclient.version&gt;5.4.1&lt;/httpclient.version&gt;\n&lt;springai.version&gt;1.0.0-SNAPSHOT&lt;/springai.version&gt;\n&lt;langchain.version&gt;1.0.0-beta1&lt;/langchain.version&gt;\n</code></pre>\n<p>Initialization EmbeddingStore and PgVectorEmbeddingStore</p>\n<pre><code>@Bean\npublic Assistant init(EmbeddingStore&lt;TextSegment&gt; embeddingStore) {\n    return AiServices.builder(Assistant.class)\n        .chatMemoryProvider(memoryId -&gt; MessageWindowChatMemory.withMaxMessages(10))\n        .contentRetriever(EmbeddingStoreContentRetriever.from(embeddingStore))\n        .chatLanguageModel(chatLanguageModel).build();\n}\n\n@Bean\npublic EmbeddingStore&lt;TextSegment&gt; initEmbeddingStore() {\n    return PgVectorEmbeddingStore.builder()\n        .table(pgConfig.getTable())\n        .dropTableFirst(true)\n        .createTable(true)\n        .host(pgConfig.getHost())\n        .port(pgConfig.getPort())\n        .user(pgConfig.getUser())\n        .password(pgConfig.getPassword())\n        .dimension(1024)\n        .database(pgConfig.getDatabase())\n        .build();\n}\n</code></pre>\n<p>The first step was to load the file into the vector table in pgvector through the load interface, and this step was successful. In the second part, I called assistant.chat through the/high/chat interface to answer my question and implement the RAG function, but the second is fail</p>\n<pre><code>@GetMapping(&quot;/load&quot;)\npublic String load(@RequestParam(value = &quot;maxSegmentSizeInChars&quot;,required = false,defaultValue = &quot;50&quot;) int maxSegmentSizeInChars\n        , @RequestParam(value = &quot;maxOverlapSizeInChars&quot;,required = false ,defaultValue = &quot;10&quot;) int maxOverlapSizeInChars) {\n\n    List&lt;Document&gt; documents = FileSystemDocumentLoader.loadDocuments(&quot;D:\\\\work\\\\lecture-langchain-20250525\\\\documents&quot;);\n    // EmbeddingStoreIngestor.ingest(documents,embeddingStore);\n    EmbeddingStoreIngestor.builder().embeddingStore(embeddingStore)\n            .embeddingModel(embeddingModel)\n            .documentSplitter(new DocumentByLineSplitter(maxSegmentSizeInChars, maxOverlapSizeInChars))\n            .build().ingest(documents);\n    return &quot;success&quot;;\n}\n\n@GetMapping(&quot;/high/chat&quot;)\npublic String lowChat(@RequestParam(value = &quot;message&quot;) String message) {\n    return assistant.chat(message);\n}\n</code></pre>\n<p>Error message</p>\n<pre class=\"lang-none prettyprint-override\"><code>org.postgresql.util.PSQLException: ERROR: different vector dimensions 1024 and 384\n    at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2675) ~[postgresql-42.3.8.jar:42.3.8]\n    at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2365) ~[postgresql-42.3.8.jar:42.3.8]\n    at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:355) ~[postgresql-42.3.8.jar:42.3.8]\n    at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:490) ~[postgresql-42.3.8.jar:42.3.8]\n    at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:408) ~[postgresql-42.3.8.jar:42.3.8]\n    at org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:167) ~[postgresql-42.3.8.jar:42.3.8]\n    at org.postgresql.jdbc.PgPreparedStatement.executeQuery(PgPreparedStatement.java:119) ~[postgresql-42.3.8.jar:42.3.8]\n    at dev.langchain4j.store.embedding.pgvector.PgVectorEmbeddingStore.search(PgVectorEmbeddingStore.java:294) ~[langchain4j-pgvector-1.0.0-beta1.jar:na]\n    at dev.langchain4j.rag.content.retriever.EmbeddingStoreContentRetriever.retrieve(EmbeddingStoreContentRetriever.java:241) ~[langchain4j-core-1.0.0-beta1.jar:na]\n    at dev.langchain4j.rag.DefaultRetrievalAugmentor.process(DefaultRetrievalAugmentor.java:182) ~[langchain4j-core-1.0.0-beta1.jar:na]\n    at dev.langchain4j.rag.DefaultRetrievalAugmentor.augment(DefaultRetrievalAugmentor.java:162) ~[langchain4j-core-1.0.0-beta1.jar:na]\n    at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:140) ~[langchain4j-1.0.0-beta1.jar:na]\n    at jdk.proxy2/jdk.proxy2.$Proxy60.chat(Unknown Source) ~[na:na]\n    at com.xmin.lecture.rag.RagAPI.lowChat(RagAPI.java:31) ~[classes/:na]\n    at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]\n    at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]\n    at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255) ~[spring-web-6.1.11.jar:6.1.11]\n    at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188) ~[spring-web-6.1.11.jar:6.1.11]\n    at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.1.11.jar:6.1.11]\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926) ~[spring-webmvc-6.1.11.jar:6.1.11]\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831) ~[spring-webmvc-6.1.11.jar:6.1.11]\n    at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.1.11.jar:6.1.11]\n    at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.1.11.jar:6.1.11]\n    at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.1.11.jar:6.1.11]\n    at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.1.11.jar:6.1.11]\n    at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903) ~[spring-webmvc-6.1.11.jar:6.1.11]\n    at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.1.11.jar:6.1.11]\n    at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.26.jar:10.1.26]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.1.11.jar:6.1.11]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.11.jar:6.1.11]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.1.11.jar:6.1.11]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.11.jar:6.1.11]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.1.11.jar:6.1.11]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.11.jar:6.1.11]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:389) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:904) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.26.jar:10.1.26]\n    at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]\n</code></pre>\n<p>I have tried changing the model or modifying the parameters, but due to my limited knowledge of PgVector, I would like to know how to set PgVector to solve this problem</p>\n",
    "tags" : [ "java", "rag", "pgvector", "langchain4j" ],
    "owner" : {
      "account_id" : 24837011,
      "reputation" : 3,
      "user_id" : 18715535,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GjTbuCIaoolmaeli34oj0tsO8s0wfXYufIr0t15=k-s256",
      "display_name" : "tom",
      "link" : "https://stackoverflow.com/users/18715535/tom"
    },
    "is_answered" : true,
    "view_count" : 444,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1744617282,
    "creation_date" : 1743858763,
    "link" : "https://stackoverflow.com/questions/79557012/i-am-using-langchain4j-to-develop-a-knowledge-base-and-encountered-the-differen",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79572624,
    "question_id" : 79557012,
    "body" : "<p>you need to change <code>.dimension(1024)</code> to <code>.dimension(384)</code>.</p>\n<p>You can always get the dimention of your <code>EmbeddingModel</code> by calling <code>EmbeddingModel.dimension()</code>.</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 30940783,
      "reputation" : 96,
      "user_id" : 23757366,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6ec3f0de7aa21c7f83d3e32d9f4a2b4b?s=256&d=identicon&r=PG",
      "display_name" : "LangChain4j",
      "link" : "https://stackoverflow.com/users/23757366/langchain4j"
    },
    "creation_date" : 1744617282,
    "last_activity_date" : 1744617282,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}