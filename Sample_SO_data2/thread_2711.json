{
  "question" : {
    "question_id" : 79603409,
    "title" : "Problem with displaying image sent through Spring Boot EmailService on Gmail",
    "body" : "<p>I try to send an account activation email through Java/Spring Boot Email Service, but the logo image is not displayed on Gmail. (ofc on localhost everything is fine). The image is being sent as an attachment to the email correctly, but it isn't displayed in the email.</p>\n<p>It just looks like this: <a href=\"https://i.sstatic.net/7AwL43eK.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/7AwL43eK.png\" alt=\"enter image description here\" /></a></p>\n<p>I use a static <code>activation-mail.html</code>, where I try to display it like this:</p>\n<pre><code>    &lt;div class=&quot;logo&quot;&gt;\n        &lt;img src=&quot;cid:logo&quot; alt=&quot;Logo&quot; style=&quot;max-width: 250px;&quot;/&gt;\n    &lt;/div&gt;\n</code></pre>\n<p>I use this method in <code>EmailConfiguration.java</code>:</p>\n<pre><code>public void sendMailWithInlineImage(String recipientEmail,\n                                        String contentHtml,\n                                        String subject,\n                                        byte[] imageBytes,\n                                        String contentId,\n                                        String contentType,\n                                        boolean onCreate)\n            throws MessagingException {\n\n        if (session == null) {\n            refreshSession();\n        }\n\n        try {\n            MimeMessage message = new MimeMessage(session);\n            message.setFrom(new InternetAddress(email));\n            message.setRecipients(Message.RecipientType.TO, InternetAddress.parse(recipientEmail));\n            message.setSubject(subject, StandardCharsets.UTF_8.name());\n\n            MimeBodyPart htmlPart = new MimeBodyPart();\n            htmlPart.setContent(contentHtml, &quot;text/html; charset=UTF-8&quot;);\n            \n            ByteArrayDataSource ds = new ByteArrayDataSource(imageBytes, contentType);\n            ds.setName(&quot;logo.png&quot;);\n\n            MimeBodyPart imagePart = new MimeBodyPart();\n            imagePart.setDataHandler(new DataHandler(ds));\n            imagePart.setContentID(&quot;&lt;&quot; + contentId + &quot;&gt;&quot;);\n            imagePart.setDisposition(MimeBodyPart.INLINE);\n            imagePart.setFileName(&quot;logo.png&quot;);\n            imagePart.setHeader(&quot;Content-Type&quot;, contentType + &quot;; name=logo.png&quot;);\n\n            MimeMultipart multipart = new MimeMultipart(&quot;related&quot;);\n            multipart.addBodyPart(htmlPart);\n            multipart.addBodyPart(imagePart);\n            message.setContent(multipart);\n\n            Transport.send(message);\n\n        } catch (MessagingException ex) {\n            if (onCreate) {\n                refreshSession();\n                sendMailWithInlineImage(recipientEmail, contentHtml, subject,\n                        imageBytes, contentId, contentType, false);\n            } else {\n                throw ex;\n            }\n        }\n    }\n</code></pre>\n<p>and this in <code>EmailService.java</code>:</p>\n<pre><code>    public void sendActivation(User user) {\n        log.info(&quot;--START sendActivation&quot;);\n        try {\n            String html = Files.toString(activeTemplate.getFile(), Charsets.UTF_8);\n            html = html.replace(&quot;https://google.com&quot;, fontendUrl + &quot;/activate/&quot; + user.getUuid());\n\n            byte[] logoBytes = Files.toByteArray(logoResource.getFile());\n\n            emailConfiguration.sendMailWithInlineImage(\n                    user.getEmail(),\n                    html,\n                    &quot;Aktywacja konta&quot;,\n                    logoBytes,\n                    &quot;logo&quot;,\n                    &quot;image/png&quot;,\n                    true\n            );\n        } catch (IOException | MessagingException e) {\n            log.error(&quot;Błąd wysyłania maila&quot;, e);\n            throw new RuntimeException(e);\n        }\n        log.info(&quot;--STOP sendActivation&quot;);\n    }\n</code></pre>\n<p>the path to logo.png is: <code>resources/static/img/logo.png</code></p>\n<p>I also have this warning in IntelliJ Idea in the .html file: <a href=\"https://i.sstatic.net/numml9XP.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/numml9XP.png\" alt=\"enter image description here\" /></a></p>\n<p>ps. I also tried to display the logo using imgur hosting etc. but the result was identical.</p>\n",
    "tags" : [ "java", "spring-boot", "gmail", "html-email", "email-attachments" ],
    "owner" : {
      "account_id" : 23782627,
      "reputation" : 65,
      "user_id" : 17795116,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/8b9c03927a8f42b9acf11a0e9c0ef33e?s=256&d=identicon&r=PG",
      "display_name" : "lordlaurent",
      "link" : "https://stackoverflow.com/users/17795116/lordlaurent"
    },
    "is_answered" : true,
    "view_count" : 113,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1746435415,
    "creation_date" : 1746189922,
    "link" : "https://stackoverflow.com/questions/79603409/problem-with-displaying-image-sent-through-spring-boot-emailservice-on-gmail",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79606607,
    "question_id" : 79603409,
    "body" : "<p>If you only want to appeared a logo on email then Embed the Image as a Base64 Data URI (Less Recommended for Large Images). You can embed the image directly into the HTML as a Base64 encoded string. This eliminates the need for an external URL.</p>\n<p><strong>Convert the image to Base64:</strong></p>\n<p>Use an online tool (like https://www.base64-image.de/(opens in a new tab)) or a programming language to convert your image to a Base64 string.</p>\n<p><strong>Embed the Base64 string in the src attribute:</strong></p>\n<pre><code>&lt;img src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w+gYQQAAZIAA8jQXYgAAAABJRU5ErkJggg==&quot; alt=&quot;Logo&quot; style=&quot;max-width:250px;&quot;&gt;\n</code></pre>\n<p>(Replace the example Base64 string with your actual image's Base64 data.)</p>\n<p><strong>Pros</strong>: No external HTTP requests.</p>\n<p><strong>Cons</strong>:</p>\n<p><strong>Increases email size:</strong> Base64 encoding makes the image data larger, which can increase email size and potentially trigger spam filters.</p>\n<p><strong>Not suitable for large images:</strong> Embedding large images as Base64 can significantly increase email size and slow down rendering.</p>\n<p><strong>Can be less efficient</strong>: Some email clients might not handle Base64 images as efficiently as regular images.</p>\n<p>Use this method only for very small images (e.g., small icons).</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 10927511,
      "reputation" : 3218,
      "user_id" : 8031784,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/ikcJL.png?s=256",
      "display_name" : "Aniruddh Parihar",
      "link" : "https://stackoverflow.com/users/8031784/aniruddh-parihar"
    },
    "creation_date" : 1746435415,
    "last_activity_date" : 1746435415,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140396200,
    "post_id" : 79603409,
    "body" : "Try to generate a public link from google Drive not photos OR You can provide the public link from any other website because Google User Content (images hosted on lh3.googleusercontent.com) often has restrictions on direct linking, especially from external sources like emails. Gmail&#39;s proxy might be triggering these restrictions, resulting in a 302 redirect (temporary redirect) because Google&#39;s servers are refusing to serve the image directly to the proxy. The redirect might be to a login page or some other resource that the proxy can&#39;t handle.",
    "score" : 0,
    "owner" : {
      "account_id" : 10927511,
      "reputation" : 3218,
      "user_id" : 8031784,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/ikcJL.png?s=256",
      "display_name" : "Aniruddh Parihar",
      "link" : "https://stackoverflow.com/users/8031784/aniruddh-parihar"
    },
    "creation_date" : 1746434810,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140391190,
    "post_id" : 79603409,
    "body" : "There is a 302 response on this image, the problem occurs only on gmail, on outlook it&#39;s ok - I can send the .eml file of this email",
    "score" : 0,
    "owner" : {
      "account_id" : 23782627,
      "reputation" : 65,
      "user_id" : 17795116,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/8b9c03927a8f42b9acf11a0e9c0ef33e?s=256&d=identicon&r=PG",
      "display_name" : "lordlaurent",
      "link" : "https://stackoverflow.com/users/17795116/lordlaurent"
    },
    "creation_date" : 1746211160,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140391005,
    "post_id" : 79603409,
    "body" : "I tried this &#39;&lt;img src=&quot;<a href=\"https://lh3.googleusercontent.com/d/1dncs2uCZNJIpvtxBChgQXgmbR8IrnQSn\" rel=\"nofollow noreferrer\">lh3.googleusercontent.com/d/1dncs2uCZNJIpvtxBChgQXgmbR8&zwnj;&#8203;IrnQSn</a>&quot; alt=&quot;Logo&quot; style=&quot;max-width:250px;&quot;&gt;&#39; and it didn&#39;t work.",
    "score" : 0,
    "owner" : {
      "account_id" : 23782627,
      "reputation" : 65,
      "user_id" : 17795116,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/8b9c03927a8f42b9acf11a0e9c0ef33e?s=256&d=identicon&r=PG",
      "display_name" : "lordlaurent",
      "link" : "https://stackoverflow.com/users/17795116/lordlaurent"
    },
    "creation_date" : 1746207556,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140390139,
    "post_id" : 79603409,
    "body" : "try to put that logo image on gDrive with public access and Provide the path to email content. if its got Downloaded/Preview then issue of protocol i.e. http/https.",
    "score" : 0,
    "owner" : {
      "account_id" : 10927511,
      "reputation" : 3218,
      "user_id" : 8031784,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/ikcJL.png?s=256",
      "display_name" : "Aniruddh Parihar",
      "link" : "https://stackoverflow.com/users/8031784/aniruddh-parihar"
    },
    "creation_date" : 1746191392,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}