{
  "question" : {
    "question_id" : 79548911,
    "title" : "Showing differences between non-matching strings using assertJ",
    "body" : "<p>I'm currently working on a unit test for a kotlin function that will generate a csv file from some model data. I'm running into some strange test failures and the default output from assertJ isn't much help in diagnosing the problem. From what I can tell, the failure is caused by character encoding. The &quot;was expecting X but was Y&quot; message doesn't tell me anything since X and Y appear to be the same. Is there a way to get the test output to display exactly which characters didn't match in the strings?</p>\n<p>For reference my test function looks like:</p>\n<pre><code>internal fun List&lt;Contact&gt;.buildCsv(dp: INT293DependencyProvider):File\n{\n    val file = File(&quot;/tmp/${dp.outputFileName}.csv&quot;)\n    file.bufferedWriter(Charsets.ISO_8859_1).use { out -&gt;\n\n            out.write(RaveOutput.HEADER)\n            this.forEach {\n                out.write(it.toCsvRow())\n            }\n        }\n    return file\n}\n\n\n    @Test\n    fun `Test generate csv from contacts`()\n    {\n\n        mockContext(300).value().let { context -&gt;\n            testInt293DependencyProvider(context).let { dp -&gt;\n                javaClass.classLoader.getResourceAsStream(&quot;rave-contacts.csv&quot;).use { stream -&gt;\n                    val expected = IOUtils.toString(stream, Charsets.ISO_8859_1)                   \n\n                    val contacts = listOf(\n                        Contact(&quot;123456&quot;, &quot;foo&quot;, &quot;bar&quot;, &quot;foo@bar.com&quot;, &quot;5704445555&quot;, Type.EMPLOYEE, &quot;fbar&quot;),\n                        Contact(&quot;654321&quot;, &quot;john&quot;, &quot;doe&quot;, &quot;jdoe@bucknell.edu&quot;, &quot;+15556667777&quot;, Type.STUDENT, &quot;jdoe&quot;)\n                    )\n                    val output = contacts.buildCsv(dp)\n\n                    val actual = IOUtils.toString(output.inputStream(), Charsets.ISO_8859_1)\n\n                    assertNotNull(actual)\n                    assertThat(actual).isEqualTo(expected)\n\n                    \n                }\n            }\n        }\n    }\n\n\n\n[ERROR]   Test.Test generate csv from contacts \nexpected: \n  &quot;Unique Loader ID,Last Name,First Name,Registration Email Address,Email Address 2,Email Address 3,Site Username,Role,Mobile Phone 1,Mobile Phone 2,Mobile Phone 3,Mobile 1 Voice,Mobile 2 Voice,Mobile 3 Voice,Mobile Carrier 1,Mobile Carrier 2,Mobile Carrier 3,Landline Phone 1,Landline 1 Extension,Landline Phone 2,Landline 2 Extension,Landline Phone 3,Landline 3 Extension,Language Preference,Notify by SMS,Notify by Email,String Attribute 1,String Attribute 2,String Attribute 3,String Attribute 4,String Attribute 5,String Attribute 6,String Attribute 7,String Attribute 8,String Attribute 9,String Attribute 10,String Attribute 11,String Attribute 12,String Attribute 13,String Attribute 14,String Attribute 15,String Attribute 16,String Attribute 17,String Attribute 18,String Attribute 19,String Attribute 20,Integer Attribute 1,Integer Attribute 2,Integer Attribute 3,Integer Attribute 4,Integer Attribute 5,True/False Attribute 1,True/False Attribute 2,True/False Attribute 3,True/False Attribute 4,True/False Attribute 5,Date Attribute 1,Date Attribute 2,Date Attribute 3,Date Attribute 4,Date Attribute 5\n  123456,bar,foo,foo@bar.com,,,fbar,EMPLOYEE,5704445555,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,\n  654321,doe,john,jdoe@bucknell.edu,,,jdoe,STUDENT,+15556667777,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,&quot;\n but was: \n  &quot;Unique Loader ID,Last Name,First Name,Registration Email Address,Email Address 2,Email Address 3,Site Username,Role,Mobile Phone 1,Mobile Phone 2,Mobile Phone 3,Mobile 1 Voice,Mobile 2 Voice,Mobile 3 Voice,Mobile Carrier 1,Mobile Carrier 2,Mobile Carrier 3,Landline Phone 1,Landline 1 Extension,Landline Phone 2,Landline 2 Extension,Landline Phone 3,Landline 3 Extension,Language Preference,Notify by SMS,Notify by Email,String Attribute 1,String Attribute 2,String Attribute 3,String Attribute 4,String Attribute 5,String Attribute 6,String Attribute 7,String Attribute 8,String Attribute 9,String Attribute 10,String Attribute 11,String Attribute 12,String Attribute 13,String Attribute 14,String Attribute 15,String Attribute 16,String Attribute 17,String Attribute 18,String Attribute 19,String Attribute 20,Integer Attribute 1,Integer Attribute 2,Integer Attribute 3,Integer Attribute 4,Integer Attribute 5,True/False Attribute 1,True/False Attribute 2,True/False Attribute 3,True/False Attribute 4,True/False Attribute 5,Date Attribute 1,Date Attribute 2,Date Attribute 3,Date Attribute 4,Date Attribute 5\n  123456,bar,foo,foo@bar.com,,,fbar,EMPLOYEE,5704445555,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,\n  654321,doe,john,jdoe@bucknell.edu,,,jdoe,STUDENT,+15556667777,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,&quot;\n</code></pre>\n",
    "tags" : [ "java", "string", "kotlin", "unit-testing", "assertj" ],
    "owner" : {
      "account_id" : 2090213,
      "reputation" : 1839,
      "user_id" : 1860222,
      "user_type" : "registered",
      "accept_rate" : 52,
      "profile_image" : "https://www.gravatar.com/avatar/dcd9cf0881ee1e7a5f28175308628e25?s=256&d=identicon&r=PG",
      "display_name" : "pbuchheit",
      "link" : "https://stackoverflow.com/users/1860222/pbuchheit"
    },
    "is_answered" : true,
    "view_count" : 101,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1743587677,
    "creation_date" : 1743532690,
    "link" : "https://stackoverflow.com/questions/79548911/showing-differences-between-non-matching-strings-using-assertj",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79550308,
    "question_id" : 79548911,
    "body" : "<p>Give a try to  <a href=\"https://www.javadoc.io/doc/org.assertj/assertj-core/latest/org.assertj.core/org/assertj/core/api/AbstractCharSequenceAssert.html#inHexadecimal()\" rel=\"nofollow noreferrer\">inHexadecimal()</a>, that should produce an output with the hex code of the characters and you should find the difference (in hexa of course)</p>\n<p>Ex:</p>\n<pre><code> // With standard message:\n\n assertThat(&quot;µµµ&quot;).contains(&quot;μμμ&quot;);\n\n java.lang.AssertionError:\n Expecting:\n   &lt;&quot;µµµ&quot;&gt;\n to contain:\n   &lt;&quot;μμμ&quot;&gt;\n\n// With Hexadecimal message:\n\n assertThat(&quot;µµµ&quot;).inHexadecimal().contains(&quot;μμμ&quot;);\n\n java.lang.AssertionError:\n Expecting:\n   &lt;&quot;['00B5', '00B5', '00B5']&quot;&gt;\n to contain:\n   &lt;&quot;['03BC', '03BC', '03BC']&quot;&gt;\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1407336,
      "reputation" : 7309,
      "user_id" : 1348834,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/cca907a8681a3bdf665a604d316fae00?s=256&d=identicon&r=PG",
      "display_name" : "Joel Costigliola",
      "link" : "https://stackoverflow.com/users/1348834/joel-costigliola"
    },
    "creation_date" : 1743587677,
    "last_activity_date" : 1743587677,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140291331,
    "post_id" : 79548911,
    "body" : "Is it the case that <code>assertThat(String).isEqualTo(String)</code> is expected to highlight a mismatch and a specially crafted test is required to reproduce a scenario where that is failing?",
    "score" : 0,
    "owner" : {
      "account_id" : 85850,
      "reputation" : 9394,
      "user_id" : 239101,
      "user_type" : "registered",
      "accept_rate" : 57,
      "profile_image" : "https://i.sstatic.net/zEXWJ.jpg?s=256",
      "display_name" : "David Soroko",
      "link" : "https://stackoverflow.com/users/239101/david-soroko"
    },
    "creation_date" : 1743612326,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140289767,
    "post_id" : 79548911,
    "body" : "Would you be able to raise an issue to AssertJ with a reproducible test ?",
    "score" : 1,
    "owner" : {
      "account_id" : 1407336,
      "reputation" : 7309,
      "user_id" : 1348834,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/cca907a8681a3bdf665a604d316fae00?s=256&d=identicon&r=PG",
      "display_name" : "Joel Costigliola",
      "link" : "https://stackoverflow.com/users/1348834/joel-costigliola"
    },
    "creation_date" : 1743587541,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140287368,
    "post_id" : 79548911,
    "body" : "To determine what the actual difference is, why not add debug code that compares <code>actual</code> and <code>expected</code> char by char?",
    "score" : 1,
    "owner" : {
      "account_id" : 85850,
      "reputation" : 9394,
      "user_id" : 239101,
      "user_type" : "registered",
      "accept_rate" : 57,
      "profile_image" : "https://i.sstatic.net/zEXWJ.jpg?s=256",
      "display_name" : "David Soroko",
      "link" : "https://stackoverflow.com/users/239101/david-soroko"
    },
    "creation_date" : 1743533610,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79550308" : [ {
      "comment_id" : 140290585,
      "post_id" : 79550308,
      "body" : "Output Example:  Expecting actual:   [&quot;Yoda&quot;, &quot;Han&quot;] to contain exactly in any order:   [&quot;Luke&quot;, &quot;Yoda&quot;] elements not found:   [&quot;Luke&quot;] and elements not expected:   [&quot;Han&quot;]",
      "score" : 1,
      "owner" : {
        "account_id" : 1407336,
        "reputation" : 7309,
        "user_id" : 1348834,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/cca907a8681a3bdf665a604d316fae00?s=256&d=identicon&r=PG",
        "display_name" : "Joel Costigliola",
        "link" : "https://stackoverflow.com/users/1348834/joel-costigliola"
      },
      "creation_date" : 1743599504,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140290564,
      "post_id" : 79550308,
      "body" : "Use <code>containsExactly</code> or <code>containsExactlyInAnyOrder</code> to get the diff between the tested collections (or whatever flavor of <code>containsXXX</code> that matches your needs)",
      "score" : 0,
      "owner" : {
        "account_id" : 1407336,
        "reputation" : 7309,
        "user_id" : 1348834,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/cca907a8681a3bdf665a604d316fae00?s=256&d=identicon&r=PG",
        "display_name" : "Joel Costigliola",
        "link" : "https://stackoverflow.com/users/1348834/joel-costigliola"
      },
      "creation_date" : 1743599239,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140290493,
      "post_id" : 79550308,
      "body" : "While that would at least solve the problem of indistinguishable differences, it still leaves the issue of scanning through a long output playing &#39;spot the difference&#39;. I&#39;m hoping to find a solution that will show only the non-matches.",
      "score" : 0,
      "owner" : {
        "account_id" : 2090213,
        "reputation" : 1839,
        "user_id" : 1860222,
        "user_type" : "registered",
        "accept_rate" : 52,
        "profile_image" : "https://www.gravatar.com/avatar/dcd9cf0881ee1e7a5f28175308628e25?s=256&d=identicon&r=PG",
        "display_name" : "pbuchheit",
        "link" : "https://stackoverflow.com/users/1860222/pbuchheit"
      },
      "creation_date" : 1743598351,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}