{
  "question" : {
    "question_id" : 79743718,
    "title" : "Problems when trying to alternate frame transparency",
    "body" : "<p>A few days ago, I encountered a Swing error when trying to change the transparency of the JFrame (undecorated), which lost its color and transparency information (instead of displaying the selected color with its transparency, it displays the “default” color completely opaque).</p>\n<p>When the application starts, it starts as “transparent,” then I change it to ‘opaque’ (no problems up to that point), but when I try to change it back to “transparent,” the error mentioned above appears.</p>\n<p>Here is the code that show the problem:</p>\n<pre><code>public class TheSwingError extends JFrame {\n\n   Color transparent = new Color( 255, 0, 0, 100 ),\n           opaque = new Color( 255, 0, 0, 255 );\n\n   public TheSwingError() {\n      setDefaultCloseOperation( javax.swing.WindowConstants.EXIT_ON_CLOSE );\n      setBounds( 10, 10, 500, 500 );\n      setUndecorated( true );\n      setLayout( null );\n      \n      setBackground( transparent );\n      \n      JButton alternate = new JButton( &quot;Transparent&quot; );\n      alternate.setBounds( 10, 10, 160, 26 );\n      add( alternate );\n\n      setVisible( true );\n\n      alternate.addMouseListener( new java.awt.event.MouseAdapter() {\n         @Override\n         public void mouseClicked( java.awt.event.MouseEvent evt ) {\n            JButton aux = ( JButton ) evt.getSource();\n            if( aux.getText().equals( &quot;Transparent&quot; ) ) {\n               setBackground( opaque );\n               aux.setText( &quot;Opaque&quot; );\n            }\n            else {\n               setBackground( transparent );\n               aux.setText( &quot;Transparent&quot; );\n            }\n         }\n      } );\n   }\n   \n   public static void main( String[] args ) {\n      SwingUtilities.invokeLater( () -&gt; {\n         new TheSwingError();\n      } );\n   }\n}\n</code></pre>\n<p>How can I fix this without resorting to overwriting the <strong>paintComponent()</strong> method?.</p>\n<p>As you will see in my response, this post is intended, rather than to provide a way to achieve the objective, to prevent others from wasting a considerable amount of time solving a problem that stems from a language <strong>bug</strong>.</p>\n",
    "tags" : [ "java", "swing", "jframe" ],
    "owner" : {
      "account_id" : 10843443,
      "reputation" : 924,
      "user_id" : 20882864,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/CCQCy.jpg?s=256",
      "display_name" : "Marce Puente",
      "link" : "https://stackoverflow.com/users/20882864/marce-puente"
    },
    "is_answered" : false,
    "view_count" : 62,
    "answer_count" : 1,
    "score" : -1,
    "last_activity_date" : 1755953754,
    "creation_date" : 1755885130,
    "link" : "https://stackoverflow.com/questions/79743718/problems-when-trying-to-alternate-frame-transparency",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79743719,
    "question_id" : 79743718,
    "body" : "<p>The code that follows these lines, although an unpleasant solution, is the only way (or not?) to achieve the objective (following the rule of not overwriting <strong>paintComponent()</strong>).</p>\n<pre><code>public class TheSwingError extends JFrame {\n\n   Color transparent = new Color( 255, 0, 0, 100 ),\n           opaque = new Color( 255, 0, 0, 254 );\n\n   public TheSwingError() {\n      setDefaultCloseOperation( javax.swing.WindowConstants.EXIT_ON_CLOSE );\n      setBounds( 10, 10, 500, 500 );\n      setUndecorated( true );\n      setLayout( null );\n      \n      setBackground( transparent );\n      \n      JButton alternate = new JButton( &quot;Transparent&quot; );\n      alternate.setBounds( 10, 10, 160, 26 );\n      add( alternate );\n\n      setVisible( true );\n\n      alternate.addMouseListener( new java.awt.event.MouseAdapter() {\n         @Override\n         public void mouseClicked( java.awt.event.MouseEvent evt ) {\n            JButton aux = ( JButton ) evt.getSource();\n            if( aux.getText().equals( &quot;Transparent&quot; ) ) {\n               setBackground( opaque );\n               aux.setText( &quot;Opaque&quot; );\n            }\n            else {\n               setBackground( transparent );\n               aux.setText( &quot;Transparent&quot; );\n            }\n         }\n      } );\n   }\n\n   public static void main( String[] args ) {\n      SwingUtilities.invokeLater( () -&gt; {\n         new TheSwingError();\n      } );\n   }\n}\n</code></pre>\n<p>As can be seen, the solution to the problem (perhaps I should call it a “patch” rather than a solution) involves modifying the value of the <strong>opaque</strong> attribute, changing it from <strong>opaque = new Color( 255, 0, 0, 255 );</strong> to <strong>opaque = new Color( 255, 0, 0, 254 );</strong>.<br />\nThis patch does not have a valid explanation for “why it works,” since we are working on a <em>bug</em>; I only arrived at it through trial and error.</p>\n<p>Here is the code I sent to <em><em>Oracle</em> reporting the <em>bug</em></em>, which was confirmed by them, and the address to follow up on it.</p>\n<pre><code>public class TheSwingError extends JFrame {\n\n   Color transparent = new Color( 255, 0, 0, 100 ),\n           almostOpaque = new Color( 255, 0, 0, 254 ),\n           completelyOpaque = new Color( 255, 0, 0, 255 ),\n           opaque = almostOpaque;\n\n   public TheSwingError() {\n      setUndecorated( true );\n      setDefaultCloseOperation( javax.swing.WindowConstants.EXIT_ON_CLOSE );\n      setBounds( 10, 10, 500, 500 );\n      setBackground( transparent );\n      setLayout( null );\n\n      JButton colorChooser = new JButton( &quot;opaque = 255,0,0,254&quot; );\n      JButton alternate = new JButton( &quot;Transparent&quot; );\n\n      colorChooser.setBounds( 10, 50, 160, 26 );\n      alternate.setBounds( 10, 10, 160, 26 );\n      add( colorChooser );\n      add( alternate );\n\n      setVisible( true );\n\n      alternate.addMouseListener( new java.awt.event.MouseAdapter() {\n         @Override\n         public void mouseClicked( java.awt.event.MouseEvent evt ) {\n            JButton aux = ( JButton ) evt.getSource();\n            if( aux.getText().equals( &quot;Transparent&quot; ) ) {\n               setBackground( opaque );\n               aux.setText( &quot;Opaque&quot; );\n            }\n            else {\n               setBackground( transparent );\n               aux.setText( &quot;Transparent&quot; );\n            }\n         }\n      } );\n\n      colorChooser.addMouseListener( new java.awt.event.MouseAdapter() {\n         @Override\n         public void mouseClicked( java.awt.event.MouseEvent evt ) {\n            JButton aux = ( JButton ) evt.getSource();\n            if( aux.getText().equals( &quot;opaque = 255,0,0,254&quot; ) ) {\n               opaque = completelyOpaque;\n               aux.setText( &quot;color = 255,0,0,255&quot; );\n            }\n            else {\n               opaque = almostOpaque;\n               aux.setText( &quot;opaque = 255,0,0,254&quot; );\n            }\n         }\n      } );\n   }\n\n   public static void main( String[] args ) {\n      SwingUtilities.invokeLater( () -&gt; {\n         new TheSwingError();\n      } );\n   }\n}\n</code></pre>\n<p>If we repeatedly press the first button, we will see that the frame changes from transparent to opaque without any problems. As the second button “informs” us, you are using an opacity of “254.” If we press the second button, the opacity is set to “255,” and that's where the problem arises. When you try to make it transparent again, it loses its color and transparency. If you press it again, it returns to normal functioning.</p>\n<p>You can follow the status <a href=\"https://bugs.java.com/bugdatabase/view_bug?bug_id=JDK-8365803\" rel=\"nofollow noreferrer\">here</a></p>\n<p>Edit:\nAs @camickr suggests in the comments, calling <strong>repaint()</strong> after assigning the color solves the problem.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 10843443,
      "reputation" : 924,
      "user_id" : 20882864,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/CCQCy.jpg?s=256",
      "display_name" : "Marce Puente",
      "link" : "https://stackoverflow.com/users/20882864/marce-puente"
    },
    "creation_date" : 1755885130,
    "last_activity_date" : 1755953754,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140686787,
    "post_id" : 79743718,
    "body" : "Thank you for your comment. I have edited my question to try to be more specific in describing the problem (I&#39;m not sure if I&#39;ve succeeded).  The code in the question reproduces the problem in <i>Kubuntu 24.0.04*</i> and <b>JVM 23</b> (tested by me) and <i>Windows 11*</i> (tested by <i>Oracle</i>). I don&#39;t know if all platforms reproduce it. I agree with your opinion about the “way” I created the program, but it&#39;s just to show the problem, not production code, and yes, you&#39;re right, the <i>LAF</i> isn&#39;t needed to show the problem, I&#39;ve removed it.",
    "score" : 0,
    "owner" : {
      "account_id" : 10843443,
      "reputation" : 924,
      "user_id" : 20882864,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/CCQCy.jpg?s=256",
      "display_name" : "Marce Puente",
      "link" : "https://stackoverflow.com/users/20882864/marce-puente"
    },
    "creation_date" : 1755953208,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140685828,
    "post_id" : 79743718,
    "body" : "Is setting the Look &amp; feel necessary for you to observe the issue?  If so, then you should call that out in the question.  If not, then you should remove that whole bit from the example code.",
    "score" : 0,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1755895769,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140685773,
    "post_id" : 79743718,
    "body" : "BTW, do not write applications like that.  Your program should not itself <i>be</i> a <code>JFrame</code>.  It may <i>have</i> a <code>JFrame</code> as the top-level element of a GUI, but you should distinguish.  In most cases you can and should build your GUI with stock classes.  This is certainly such a case.",
    "score" : 0,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1755894340,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140685750,
    "post_id" : 79743718,
    "body" : "In fact, even running your code does not make the issue clear to me.  I had supposed that it would be something like not being able to make the background transparent again, but I don&#39;t observe any such problem.",
    "score" : 0,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1755893171,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140685743,
    "post_id" : 79743718,
    "body" : "You&#39;ve presented code (thank you), but the question is very unclear about the nature of the problem it&#39;s supposed to demonstrate.  I appreciate that you have provided a self-answer, but others will be unlikely to benefit from it if they don&#39;t recognize that it addresses their problem.",
    "score" : 1,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1755892931,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79743719" : [ {
      "comment_id" : 140686812,
      "post_id" : 79743719,
      "body" : "You&#39;re right about the mouse (the code is just to show the problem, yes, I know, it&#39;s no excuse...) and about the call to <b>repaint()</b>, which solves the problem.",
      "score" : 0,
      "owner" : {
        "account_id" : 10843443,
        "reputation" : 924,
        "user_id" : 20882864,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/CCQCy.jpg?s=256",
        "display_name" : "Marce Puente",
        "link" : "https://stackoverflow.com/users/20882864/marce-puente"
      },
      "creation_date" : 1755953995,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140685772,
      "post_id" : 79743719,
      "body" : "1) Don&#39;t use a MouseLister to handle clicking of the button. If the mouse moves even a pixel between the mousePressed/mouseReleased events a click event will not be generated. You should be using an ActionListener for this. 2) I&#39;m still using Java 11 and I don&#39;t have a problem, so I can&#39;t really test. 3) Maybe try adding a frame.repaint() to force repainting of the frame. Maybe add the repaint() to a SwingUtilities.invokeLater() to make sure it is added to the end of the EDT.",
      "score" : 3,
      "owner" : {
        "account_id" : 44852,
        "reputation" : 324711,
        "user_id" : 131872,
        "user_type" : "registered",
        "accept_rate" : 100,
        "profile_image" : "https://www.gravatar.com/avatar/a0ced8e21d2a761db718acb6362b9225?s=256&d=identicon&r=PG",
        "display_name" : "camickr",
        "link" : "https://stackoverflow.com/users/131872/camickr"
      },
      "creation_date" : 1755894154,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}