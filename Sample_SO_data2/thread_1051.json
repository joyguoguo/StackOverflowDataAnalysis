{
  "question" : {
    "question_id" : 79752016,
    "title" : "Kafka Auto Commit and current Poll behavior",
    "body" : "<p>I am trying to understand a behavior which is a bit confusing. We are using Spring boot and KafkaListener approach for the consumers. The configuration has auto commit set to true with the default interval of 5 seconds.</p>\n<p>As per the docs, with Kafka auto commit enabled, the commit happens automatically every 5 seconds in the background.</p>\n<p>We have a consumer that polls for messages and processes them in about 100 milliseconds. So within the 5 second interval there will be about 50 polls of the messages. When things are working fine, i don't see any issues. There are a couple of scenarios that i am trying to understand:</p>\n<ol>\n<li>We continue to poll for messages and say polled for 4.5 seconds and the pod crashes in the middle of processing a polled batch, before the 5 seconds auto commit interval is reached. This in theory should reprocess all the messages since the last commit 4.5 seconds ago, but it reprocesses only the polled batch that did not finish successfully. Does that mean there is some incremental commit that happens in the background, and only the current unfinished batch is not included in the commit offset?</li>\n<li>Say I have a polled batch that takes longer than the auto commit interval. I had induced an explicit sleep of 10 seconds in the listener. Per docs, this means the batch should get auto committed so if the batch fails after processing, it would have been committed as the interval is passed. However, when i try to do reproduce this by explicitly force killing the pod, the messages got reprocessed/republished as part of the next poll. Per #1 above, may be the background process is not including the current batch as it's not completed yet?</li>\n</ol>\n<p>Any explanation to this behavior? My assumption seems to make sense but I want to be sure that's what is happening. Thanks in advance!</p>\n",
    "tags" : [ "java", "spring-boot", "spring-kafka", "kafka-consumer-api" ],
    "owner" : {
      "account_id" : 18044566,
      "reputation" : 325,
      "user_id" : 13115896,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6d35ea24f31161f110fed75caf9d2d04?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "sg2000",
      "link" : "https://stackoverflow.com/users/13115896/sg2000"
    },
    "is_answered" : false,
    "view_count" : 110,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1763414120,
    "creation_date" : 1756673758,
    "link" : "https://stackoverflow.com/questions/79752016/kafka-auto-commit-and-current-poll-behavior",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140708054,
    "post_id" : 79752016,
    "body" : "Interestingly, i tried to set the auto commit interval explicitly to 6 seconds hoping for it to be effective and then i had a sleep in the listener for 10 seconds - if the auto commit worked, then the message should have been committed. But when i force restarted the pod, the message was received again making me think the auto commit interval doesn&#39;t have any effect whether explicitly set or not..",
    "score" : 0,
    "owner" : {
      "account_id" : 18044566,
      "reputation" : 325,
      "user_id" : 13115896,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6d35ea24f31161f110fed75caf9d2d04?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "sg2000",
      "link" : "https://stackoverflow.com/users/13115896/sg2000"
    },
    "creation_date" : 1756777070,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140705914,
    "post_id" : 79752016,
    "body" : "Thank you! I see this comment which is what you are referring to - Starting with version 2.3, the framework sets enable.auto.commit to false unless explicitly set in the configuration. Previously, the Kafka default (true) was used if the property was not set",
    "score" : 0,
    "owner" : {
      "account_id" : 18044566,
      "reputation" : 325,
      "user_id" : 13115896,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6d35ea24f31161f110fed75caf9d2d04?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "sg2000",
      "link" : "https://stackoverflow.com/users/13115896/sg2000"
    },
    "creation_date" : 1756693860,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140705745,
    "post_id" : 79752016,
    "body" : "<a href=\"https://docs.spring.io/spring-kafka/reference/kafka/receiving-messages/message-listener-container.html#committing-offsets\" rel=\"nofollow noreferrer\">docs.spring.io/spring-kafka/reference/kafka/receiving-messag&zwnj;&#8203;es/&hellip;</a>",
    "score" : 1,
    "owner" : {
      "account_id" : 2465829,
      "reputation" : 13627,
      "user_id" : 2148953,
      "user_type" : "registered",
      "accept_rate" : 96,
      "profile_image" : "https://i.sstatic.net/DVHoP84E.jpg?s=256",
      "display_name" : "aran",
      "link" : "https://stackoverflow.com/users/2148953/aran"
    },
    "creation_date" : 1756678343,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140705734,
    "post_id" : 79752016,
    "body" : "Thanks. Does that mean the listener uses batch mode with commit at the end of each successful poll processing? Is there any documentation that explains this further?",
    "score" : 0,
    "owner" : {
      "account_id" : 18044566,
      "reputation" : 325,
      "user_id" : 13115896,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6d35ea24f31161f110fed75caf9d2d04?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "sg2000",
      "link" : "https://stackoverflow.com/users/13115896/sg2000"
    },
    "creation_date" : 1756678087,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140705722,
    "post_id" : 79752016,
    "body" : "Even if you set enable.auto.commit=true, Spring Kafka’s @KafkaListener containers by default don’t use Kafka’s native auto-commit. They use container-managed commits: offsets are committed only after your listener method finishes.",
    "score" : 0,
    "owner" : {
      "account_id" : 2465829,
      "reputation" : 13627,
      "user_id" : 2148953,
      "user_type" : "registered",
      "accept_rate" : 96,
      "profile_image" : "https://i.sstatic.net/DVHoP84E.jpg?s=256",
      "display_name" : "aran",
      "link" : "https://stackoverflow.com/users/2148953/aran"
    },
    "creation_date" : 1756677571,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}