{
  "question" : {
    "question_id" : 79757132,
    "title" : "Is this SOAP envelope valid?",
    "body" : "<p>I am using JAXB to process XML input wrapped in a SOAP 1.2. However, I am getting an exception during unmarshaling:</p>\n<pre><code>javax.xml.bind.UnmarshalException: unexpected element (uri:&quot;&quot;, local:&quot;d2LogicalModel&quot;). Expected elements are &lt;{http://datex2.eu/schema/2/2_0}d2LogicalModel&gt;\n</code></pre>\n<p>This is the XML code:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;soap:Envelope xmlns:soap=&quot;http://www.w3.org/2003/05/soap-envelope&quot;&gt;\n  &lt;soap:Body&gt;\n    &lt;d2LogicalModel xmlns:ns2=&quot;http://datex2.eu/schema/2/2_0&quot; modelBaseVersion=&quot;2&quot;&gt;\n      &lt;ns2:exchange&gt;\n        &lt;ns2:supplierIdentification&gt;\n          &lt;ns2:country&gt;fr&lt;/ns2:country&gt;\n          &lt;ns2:nationalIdentifier&gt;Tipi&lt;/ns2:nationalIdentifier&gt;\n        &lt;/ns2:supplierIdentification&gt;\n        &lt;ns2:subscription&gt;\n          &lt;ns2:operatingMode&gt;operatingMode3&lt;/ns2:operatingMode&gt;\n          &lt;ns2:subscriptionStartTime&gt;2025-09-05T15:06:26.906+02:00&lt;/ns2:subscriptionStartTime&gt;\n          &lt;ns2:subscriptionState&gt;active&lt;/ns2:subscriptionState&gt;\n          &lt;ns2:subscriptionStopTime&gt;2025-09-05T15:06:26.906+02:00&lt;/ns2:subscriptionStopTime&gt;\n          &lt;ns2:updateMethod&gt;snapshot&lt;/ns2:updateMethod&gt;\n          &lt;ns2:target&gt;\n            &lt;ns2:address/&gt;\n            &lt;ns2:protocol/&gt;\n          &lt;/ns2:target&gt;\n        &lt;/ns2:subscription&gt;\n      &lt;/ns2:exchange&gt;\n      &lt;ns2:payloadPublication xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:type=&quot;ns2:SituationPublication&quot; lang=&quot;fr&quot;&gt;\n        &lt;feedType xmlns=&quot;http://datex2.eu/schema/2/2_0&quot;&gt;2736545&lt;/feedType&gt;\n        &lt;ns2:publicationTime&gt;2025-09-05T15:06:26.906+02:00&lt;/ns2:publicationTime&gt;\n        &lt;ns2:publicationCreator&gt;\n          &lt;ns2:country&gt;fr&lt;/ns2:country&gt;\n          &lt;ns2:nationalIdentifier&gt;Tipi&lt;/ns2:nationalIdentifier&gt;\n        &lt;/ns2:publicationCreator&gt;\n        &lt;!-- several ms2:situation elements omitted for brevity --&gt;\n      &lt;/ns2:payloadPublication&gt;\n    &lt;/d2LogicalModel&gt;\n  &lt;/soap:Body&gt;\n&lt;/soap:Envelope&gt;\n</code></pre>\n<p>And the code to unmarshal it:</p>\n<pre class=\"lang-java prettyprint-override\"><code>JAXBElement&lt;D2LogicalModel&gt; root;\nJAXBContext jc = JAXBContext.newInstance(D2LogicalModel.class);\nUnmarshaller unmarshaller = jc.createUnmarshaller();\nMessageFactory mf = MessageFactory.newInstance(SOAPConstants.SOAP_1_2_PROTOCOL);\nSOAPMessage soapMessage = mf.createMessage(null, is);\nSOAPBody body = soapMessage.getSOAPBody();\nroot = (JAXBElement&lt;D2LogicalModel&gt;)unmarshaller.unmarshal(body.getFirstChild());\nD2LogicalModel d2lm = root.getValue();\nreturn d2lm;\n</code></pre>\n<p><code>D2LogicalModel</code> was auto-generated from the Datex-II XML schema found at <a href=\"https://docs.datex2.eu/downloads/modelv23/#datex-ii-xml-schema-23\" rel=\"nofollow noreferrer\">https://docs.datex2.eu/downloads/modelv23/#datex-ii-xml-schema-23</a> using</p>\n<pre><code>xjc -no-header -d schemas -b xsd/binding.xml xsd\n</code></pre>\n<p>Class declaration is as follows:</p>\n<pre><code>@XmlAccessorType(XmlAccessType.FIELD)\n@XmlType(name = &quot;D2LogicalModel&quot;, propOrder = {\n    &quot;exchange&quot;,\n    &quot;payloadPublication&quot;,\n    &quot;d2LogicalModelExtension&quot;\n})\npublic class D2LogicalModel {\n    // body omitted\n}\n</code></pre>\n<p>The helpful AI assistant tells me that the <code>d2LogicalModel</code> element is missing <code>xmlns=&quot;http://datex2.eu/schema/2/2_0&quot;</code>. Indeed, when I add <code>xmlns</code> alongside <code>xmlns:ns2</code> in the XML input, it unmarshals with no issues.</p>\n<p>However, it seems strange that I’d be the first to notice an error in a resource published by a national road network operator. Also, having to add almost the same namespace definition twice seems odd to me.</p>\n<p>Is this really an error in the input, or am I doing something wrong in my unmarshaling code?</p>\n",
    "tags" : [ "java", "xml", "soap", "jaxb" ],
    "owner" : {
      "account_id" : 2636263,
      "reputation" : 6299,
      "user_id" : 2703209,
      "user_type" : "registered",
      "accept_rate" : 89,
      "profile_image" : "https://www.gravatar.com/avatar/01cc31c9b124d090aeb3e06f94bb8ed8?s=256&d=identicon&r=PG",
      "display_name" : "user149408",
      "link" : "https://stackoverflow.com/users/2703209/user149408"
    },
    "is_answered" : true,
    "view_count" : 72,
    "answer_count" : 1,
    "score" : -4,
    "last_activity_date" : 1757110746,
    "creation_date" : 1757103870,
    "link" : "https://stackoverflow.com/questions/79757132/is-this-soap-envelope-valid",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79757204,
    "question_id" : 79757132,
    "body" : "<p>From the comments above, I conclude that two things are odd:</p>\n<ul>\n<li>one single XML schema (<code>D2LogicalModel</code> and children) spread across two namespaces (empty namespace and <code>ns2</code>)</li>\n<li>no definition for the empty namespace</li>\n</ul>\n<p>As soon as I either add a definition for the empty namespace (in <code>D2LogicalModel</code>) or prefix the <code>d2LogicalModel</code> tag with <code>ns2:</code>, the document unmarshals with no issues.</p>\n<p>A workaround I have found is to change the call to <code>unmarshal</code>, specifying the target class explicitly:</p>\n<pre><code>root = (JAXBElement&lt;D2LogicalModel&gt;)unmarshaller.unmarshal(body.getFirstChild(), D2LogicalModel.class);\n</code></pre>\n<p>As long as the anomalies affect only the root element of the payload (as is the case here), this modification causes the XML data to unmarshal as-is with no issues.</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 2636263,
      "reputation" : 6299,
      "user_id" : 2703209,
      "user_type" : "registered",
      "accept_rate" : 89,
      "profile_image" : "https://www.gravatar.com/avatar/01cc31c9b124d090aeb3e06f94bb8ed8?s=256&d=identicon&r=PG",
      "display_name" : "user149408",
      "link" : "https://stackoverflow.com/users/2703209/user149408"
    },
    "creation_date" : 1757110746,
    "last_activity_date" : 1757110746,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140718647,
    "post_id" : 79757132,
    "body" : "Your xml does not reference the xsd.  So code is not recognizing D2LogicalModel because it is not defined in a xsd.",
    "score" : 1,
    "owner" : {
      "account_id" : 6156307,
      "reputation" : 34503,
      "user_id" : 5015238,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f8790f8091d3c6c58fd45664a165117a?s=256&d=identicon&r=PG",
      "display_name" : "jdweng",
      "link" : "https://stackoverflow.com/users/5015238/jdweng"
    },
    "creation_date" : 1757147672,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140718144,
    "post_id" : 79757132,
    "body" : "@jdweng My project uses classes generated from XSD files, see question. <code>D2LogicalModel</code> and its children are defined in the same XSD. I process XML input from various sources, some wrap the <code>D2LogcalModel</code> into a SOAP envelope, others have it as the root element.",
    "score" : 0,
    "owner" : {
      "account_id" : 2636263,
      "reputation" : 6299,
      "user_id" : 2703209,
      "user_type" : "registered",
      "accept_rate" : 89,
      "profile_image" : "https://www.gravatar.com/avatar/01cc31c9b124d090aeb3e06f94bb8ed8?s=256&d=identicon&r=PG",
      "display_name" : "user149408",
      "link" : "https://stackoverflow.com/users/2703209/user149408"
    },
    "creation_date" : 1757110013,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140718124,
    "post_id" : 79757132,
    "body" : "The xml is valid but is missing the default namespace that contains the definition for D2LogicalModel .  Does you project have any xsd files?  I think xjc is producing a schema.  You need to add the default this schema to your xml file. Modify following : &lt;soap:Envelope xmlns:soap=&quot;<a href=\"http://www.w3.org/2003/05/soap-envelope\" rel=\"nofollow noreferrer\">w3.org/2003/05/soap-envelope</a>&quot; xmlns= &quot;the name of the schema&quot;&gt;",
    "score" : 0,
    "owner" : {
      "account_id" : 6156307,
      "reputation" : 34503,
      "user_id" : 5015238,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f8790f8091d3c6c58fd45664a165117a?s=256&d=identicon&r=PG",
      "display_name" : "jdweng",
      "link" : "https://stackoverflow.com/users/5015238/jdweng"
    },
    "creation_date" : 1757109259,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140718087,
    "post_id" : 79757132,
    "body" : "Well, one of the reasons to change a version is bug fixes. :-)",
    "score" : 0,
    "owner" : {
      "account_id" : 3377022,
      "reputation" : 14393,
      "user_id" : 2834978,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ff9af10001f37bc0de566ca2caf2f558?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "LMC",
      "link" : "https://stackoverflow.com/users/2834978/lmc"
    },
    "creation_date" : 1757107709,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140718084,
    "post_id" : 79757132,
    "body" : "@LMC how likely is it in your opinion that the error I’m getting is caused by the version mismatch?",
    "score" : 0,
    "owner" : {
      "account_id" : 2636263,
      "reputation" : 6299,
      "user_id" : 2703209,
      "user_type" : "registered",
      "accept_rate" : 89,
      "profile_image" : "https://www.gravatar.com/avatar/01cc31c9b124d090aeb3e06f94bb8ed8?s=256&d=identicon&r=PG",
      "display_name" : "user149408",
      "link" : "https://stackoverflow.com/users/2703209/user149408"
    },
    "creation_date" : 1757107492,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140718069,
    "post_id" : 79757132,
    "body" : "Here&#39;s a datex client that might help <a href=\"https://github.com/svvsaga/datex-client\" rel=\"nofollow noreferrer\">github.com/svvsaga/datex-client</a>",
    "score" : 1,
    "owner" : {
      "account_id" : 3377022,
      "reputation" : 14393,
      "user_id" : 2834978,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ff9af10001f37bc0de566ca2caf2f558?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "LMC",
      "link" : "https://stackoverflow.com/users/2834978/lmc"
    },
    "creation_date" : 1757107139,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140718066,
    "post_id" : 79757132,
    "body" : "Make sure the xsd version matches the URI version. Download URL is 23 (2.3?) but xmlns URI is 2_0",
    "score" : 0,
    "owner" : {
      "account_id" : 3377022,
      "reputation" : 14393,
      "user_id" : 2834978,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ff9af10001f37bc0de566ca2caf2f558?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "LMC",
      "link" : "https://stackoverflow.com/users/2834978/lmc"
    },
    "creation_date" : 1757106993,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140718035,
    "post_id" : 79757132,
    "body" : "I edited the question to add that. Basically, this is Datex-II, classes were auto-generated from XSD, no manual changes.",
    "score" : 0,
    "owner" : {
      "account_id" : 2636263,
      "reputation" : 6299,
      "user_id" : 2703209,
      "user_type" : "registered",
      "accept_rate" : 89,
      "profile_image" : "https://www.gravatar.com/avatar/01cc31c9b124d090aeb3e06f94bb8ed8?s=256&d=identicon&r=PG",
      "display_name" : "user149408",
      "link" : "https://stackoverflow.com/users/2703209/user149408"
    },
    "creation_date" : 1757106239,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140718001,
    "post_id" : 79757132,
    "body" : "What is D2LogicalModel code?",
    "score" : 0,
    "owner" : {
      "account_id" : 3377022,
      "reputation" : 14393,
      "user_id" : 2834978,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ff9af10001f37bc0de566ca2caf2f558?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "LMC",
      "link" : "https://stackoverflow.com/users/2834978/lmc"
    },
    "creation_date" : 1757104912,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140717984,
    "post_id" : 79757132,
    "body" : "The element name is not prefixed by <code>ns2:</code> as declared in its namespace xmlns:ns2. Looks like a bad practice to declare the same namespace as anonymous and qualified at the same time",
    "score" : 1,
    "owner" : {
      "account_id" : 3377022,
      "reputation" : 14393,
      "user_id" : 2834978,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ff9af10001f37bc0de566ca2caf2f558?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "LMC",
      "link" : "https://stackoverflow.com/users/2834978/lmc"
    },
    "creation_date" : 1757104104,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}