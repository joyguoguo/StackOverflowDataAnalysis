{
  "question" : {
    "question_id" : 79560247,
    "title" : "How do I auto-configure my Spring Boot starter’s JPA repositories without overriding the user&#39;s repository scan?",
    "body" : "<p>I'm developing a Spring Boot starter library for handling Saga orchestration (including an outbox pattern) and want users to simply add my library dependency and annotate their main application with @EnableSidgcSagaOutbox to get all my beans (including JPA repositories and entities) automatically wired.</p>\n<p>My library contains JPA entities and repositories in the packages:</p>\n<p><code>dz.corepulse.saga.internal.entity</code> (e.g., <code>OutboxEntity</code>)</p>\n<p><code>dz.corepulse.saga.internal.repository</code> (e.g., <code>OutboxRepository</code>)</p>\n<p>I’ve set up my auto-configuration as follows:</p>\n<p><em><strong>SidgcSagaOutboxAutoConfiguration.java</strong></em></p>\n<pre><code>package dz.corepulse.saga.configue;\n\nimport org.springframework.boot.autoconfigure.AutoConfiguration;\nimport org.springframework.context.annotation.ComponentScan;\nimport org.springframework.scheduling.annotation.EnableScheduling;\n\n/**\n * Auto-configuration for the SIDGC Saga Outbox library.\n * &lt;p&gt;\n * Automatically scans for all internal beans under &quot;dz.corepulse.saga&quot;.\n * It does not override the user's own repository or entity scanning.\n */\n@AutoConfiguration\n@EnableScheduling\n@ComponentScan(basePackages = &quot;dz.corepulse.saga&quot;)\npublic class SidgcSagaOutboxAutoConfiguration {\n    // Intentionally empty – beans are discovered via component scan.\n}\n</code></pre>\n<p><em><strong>SidgcSagaOutboxJpaAutoConfiguration.java:</strong></em></p>\n<pre><code>package dz.corepulse.saga.configue;\n\nimport dz.corepulse.saga.internal.entity.OutboxEntity;\nimport dz.corepulse.saga.internal.repository.OutboxRepository;\nimport org.springframework.boot.autoconfigure.AutoConfiguration;\nimport org.springframework.boot.autoconfigure.domain.EntityScan;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.jpa.repository.config.EnableJpaRepositories;\n\n/**\n * Auto-configuration for the JPA components of the SIDGC Saga Outbox library.\n * &lt;p&gt;\n * Registers the library's JPA repositories and entities by using basePackageClasses to target only the library’s classes.\n */\n@Configuration\n@AutoConfiguration\n@EnableJpaRepositories(basePackageClasses = OutboxRepository.class)\n@EntityScan(basePackageClasses = OutboxEntity.class)\npublic class SidgcSagaOutboxJpaAutoConfiguration {\n    // No additional bean definitions required.\n}\n</code></pre>\n<p>I then register these classes using a file in:</p>\n<pre><code>src/main/resources/META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports\n</code></pre>\n<p>with the content:</p>\n<pre><code>dz.corepulse.saga.configue.SidgcSagaOutboxAutoConfiguration\ndz.corepulse.saga.configue.SidgcSagaOutboxJpaAutoConfiguration\n</code></pre>\n<p>In the consuming application, the user only adds:</p>\n<pre><code>@SpringBootApplication\n@EnableSidgcSagaOutbox\npublic class MoypmApp {\n    public static void main(String[] args) {\n        SpringApplication.run(MoypmApp.class, args);\n    }\n}\n</code></pre>\n<p>The Issue: At runtime, I get the following error:</p>\n<pre><code>No qualifying bean of type 'dz.corepulse.saga.internal.repository.OutboxRepository' available: expected at least 1 bean which qualifies as autowire candidate.\n</code></pre>\n<p>It seems that my auto-configuration is either not registering the library’s repositories or overriding the default scan, causing the user's repositories (e.g., dz.corepulse.moypm.repository) to be ignored.</p>\n<p>What I've Tried:</p>\n<ul>\n<li><p>Using @EnableJpaRepositories(basePackageClasses = OutboxRepository.class) and @EntityScan(basePackageClasses = OutboxEntity.class) in my JPA auto-configuration.</p>\n</li>\n<li><p>Registering auto-config via the new AutoConfiguration.imports mechanism.</p>\n</li>\n<li><p>Ensuring my library beans are in a different package from the user's code.</p>\n</li>\n</ul>\n<p>My Question: How can I configure my Spring Boot starter so that:</p>\n<ul>\n<li><p>The library's JPA repositories and entities are automatically registered in the application context.</p>\n</li>\n<li><p>The user's own repositories/entities are still scanned and not overridden.</p>\n</li>\n<li><p>The user only needs to add one annotation (e.g., @EnableSidgcSagaOutbox) without any extra manual configuration.</p>\n</li>\n</ul>\n<p>Any pointers or examples of how to “extend” the repository and entity scan rather than overriding it would be greatly appreciated.</p>\n<p>Thanks in advance!</p>\n",
    "tags" : [ "java", "spring", "spring-boot", "hibernate", "jpa" ],
    "owner" : {
      "account_id" : 5527036,
      "reputation" : 1870,
      "user_id" : 4388228,
      "user_type" : "registered",
      "accept_rate" : 97,
      "profile_image" : "https://i.sstatic.net/hV2a6.png?s=256",
      "display_name" : "Mohammed Housseyn Taleb",
      "link" : "https://stackoverflow.com/users/4388228/mohammed-housseyn-taleb"
    },
    "is_answered" : false,
    "view_count" : 163,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1744039065,
    "creation_date" : 1744039065,
    "link" : "https://stackoverflow.com/questions/79560247/how-do-i-auto-configure-my-spring-boot-starter-s-jpa-repositories-without-overri",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140313836,
    "post_id" : 79560247,
    "body" : "sorry since  I m noob in building spring starters and the auto configuration is new to me, how can I retrieve this report ???",
    "score" : 0,
    "owner" : {
      "account_id" : 5527036,
      "reputation" : 1870,
      "user_id" : 4388228,
      "user_type" : "registered",
      "accept_rate" : 97,
      "profile_image" : "https://i.sstatic.net/hV2a6.png?s=256",
      "display_name" : "Mohammed Housseyn Taleb",
      "link" : "https://stackoverflow.com/users/4388228/mohammed-housseyn-taleb"
    },
    "creation_date" : 1744150726,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140310248,
    "post_id" : 79560247,
    "body" : "Have you looked at spring boots auto configuration report? Can you attach relevant parts to the question? What did it tell you?",
    "score" : 1,
    "owner" : {
      "account_id" : 1580843,
      "reputation" : 13706,
      "user_id" : 1466267,
      "user_type" : "registered",
      "accept_rate" : 91,
      "profile_image" : "https://www.gravatar.com/avatar/c47d1f7544a8c4a1bb7a41d511f53604?s=256&d=identicon&r=PG",
      "display_name" : "SpaceTrucker",
      "link" : "https://stackoverflow.com/users/1466267/spacetrucker"
    },
    "creation_date" : 1744088501,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140309039,
    "post_id" : 79560247,
    "body" : "If this is a Spring Data repository you don&#39;t need <code>@Repository</code> it only adds confusion. Ditch the <code>@EnableJpaRepositories</code>, <code>@EntityScan</code> and replace <code>@ComponentScan</code> with <code>@AutoConfigurationPackage</code>. Now you can ditch your <code>SidgcSagaOutboxJpaAutoConfiguration</code>. Depending on what your <code>@EnableSidgcSagaOutbox</code> does you could also remove the auto registration",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1744049761,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140308781,
    "post_id" : 79560247,
    "body" : "Does it work if you apply your annotations directly onto <code>MoypmApp</code> ? If not, make it work first. If it does, well it should work as is.",
    "score" : 0,
    "owner" : {
      "account_id" : 1658807,
      "reputation" : 32708,
      "user_id" : 1527544,
      "user_type" : "registered",
      "accept_rate" : 54,
      "profile_image" : "https://www.gravatar.com/avatar/6665878d41d42307eb53e9fae311a471?s=256&d=identicon&r=PG",
      "display_name" : "Antoniossss",
      "link" : "https://stackoverflow.com/users/1527544/antoniossss"
    },
    "creation_date" : 1744044552,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140308507,
    "post_id" : 79560247,
    "body" : "yes all needed annotations are good @ Repository, @ Service .....",
    "score" : 0,
    "owner" : {
      "account_id" : 5527036,
      "reputation" : 1870,
      "user_id" : 4388228,
      "user_type" : "registered",
      "accept_rate" : 97,
      "profile_image" : "https://i.sstatic.net/hV2a6.png?s=256",
      "display_name" : "Mohammed Housseyn Taleb",
      "link" : "https://stackoverflow.com/users/4388228/mohammed-housseyn-taleb"
    },
    "creation_date" : 1744040614,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140308428,
    "post_id" : 79560247,
    "body" : "is <code>OutboxRepository</code> annotated as @Repository ?",
    "score" : 1,
    "owner" : {
      "account_id" : 1658807,
      "reputation" : 32708,
      "user_id" : 1527544,
      "user_type" : "registered",
      "accept_rate" : 54,
      "profile_image" : "https://www.gravatar.com/avatar/6665878d41d42307eb53e9fae311a471?s=256&d=identicon&r=PG",
      "display_name" : "Antoniossss",
      "link" : "https://stackoverflow.com/users/1527544/antoniossss"
    },
    "creation_date" : 1744039450,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}