{
  "question" : {
    "question_id" : 79829714,
    "title" : "Error when running a Spring Boot image in Docker: open /workspace/BOOT-INF/classes/db: permission denied",
    "body" : "<p>I follow the book Cloud Native Spring in Action and I encountered this error. I used the Paketo Buildpacks to build the image using <code>./gradlew bootBuildImage</code>. Full source code: <a href=\"https://github.com/arkadisahakyan/catalog-service/\" rel=\"nofollow noreferrer\">https://github.com/arkadisahakyan/catalog-service/</a></p>\n<p>Full error message:</p>\n<pre><code>catalog-service  | unable to determine class count\ncatalog-service  | unable to walk /workspace\ncatalog-service  | open /workspace/BOOT-INF/classes/db: permission denied\ncatalog-service  | ERROR: failed to launch: exec.d: failed to execute exec.d file at path '/layers/paketo-buildpacks_bellsoft-liberica/helper/exec.d/memory-calculator': exit status 1\n</code></pre>\n<p>docker-compose.yml (runs the main Spring Boot application and the database image)</p>\n<pre><code>version: &quot;3.8&quot;\nservices:\n  catalog-service:\n    depends_on:\n      - polar-postgres\n    image: &quot;ghcr.io/arkadisahakyan/catalog-service&quot;\n    container_name: &quot;catalog-service&quot;\n    ports:\n      - 9001:9001\n    environment:\n      - BPL_JVM_THREAD_COUNT=50\n      - SPRING_DATASOURCE_URL=jdbc:postgresql://polar-postgres:5432/polardb_catalog\n      - SPRING_PROFILES_ACTIVE=testdata\n  polar-postgres:\n    image: &quot;postgres:14.4&quot;\n    container_name: &quot;polar-postgres&quot;\n    ports:\n      - 5432:5432\n    environment:\n      - POSTGRES_USER=user\n      - POSTGRES_PASSWORD=password\n      - POSTGRES_DB=polardb_catalog\n</code></pre>\n<p>build.gradle (all the same as in the book)</p>\n<pre><code>plugins {\n    id 'org.springframework.boot' version '2.7.18'\n    id 'io.spring.dependency-management' version '1.0.15.RELEASE'\n    id 'java'\n}\n\ngroup = 'com.polarbookshop'\nversion = '0.0.1-SNAPSHOT'\nsourceCompatibility = '17'\n\ndescription = 'Provides functionality for managing the books in the catalog.'\n\nconfigurations {\n    compileOnly {\n        extendsFrom annotationProcessor\n    }\n}\n\nrepositories {\n    mavenCentral()\n}\n\next {\n    set('springCloudVersion', &quot;2021.0.9&quot;)\n    set('testcontainersVersion', &quot;1.19.8&quot;)\n}\n\ndependencies {\n    implementation 'org.springframework.boot:spring-boot-starter-actuator'\n    implementation 'org.springframework.boot:spring-boot-starter-data-jdbc'\n    implementation 'org.springframework.boot:spring-boot-starter-web'\n    implementation 'org.springframework.boot:spring-boot-starter-validation'\n    implementation 'org.springframework.cloud:spring-cloud-starter-config'\n    implementation 'org.springframework.retry:spring-retry'\n    implementation 'org.flywaydb:flyway-core'\n\n    runtimeOnly 'org.postgresql:postgresql'\n    annotationProcessor &quot;org.springframework.boot:spring-boot-configuration-processor&quot;\n\n    testImplementation 'org.springframework.boot:spring-boot-starter-test'\n    testImplementation 'org.springframework.boot:spring-boot-starter-webflux'\n    testImplementation 'org.testcontainers:postgresql'\n}\n\ndependencyManagement {\n    imports {\n        mavenBom &quot;org.springframework.cloud:spring-cloud-dependencies:${springCloudVersion}&quot;\n        mavenBom &quot;org.testcontainers:testcontainers-bom:${testcontainersVersion}&quot;\n    }\n}\n\nbootRun {\n    systemProperty 'spring.profiles.active', 'testdata'\n}\n\nbootBuildImage {\n    builder = &quot;docker.io/paketobuildpacks/builder-jammy-base&quot;\n    imageName = &quot;${project.name}&quot;\n    environment = [&quot;BP_JVM_VERSION&quot;: &quot;17&quot;]\n\n    docker {\n        publishRegistry {\n            username = project.findProperty(&quot;registryUsername&quot;)\n            password = project.findProperty(&quot;registryToken&quot;)\n            url = project.findProperty(&quot;registryUrl&quot;)\n        }\n    }\n}\n\ntasks.named('test') {\n    useJUnitPlatform()\n}\n</code></pre>\n<p>I tried to run both the local and remote images but the error is the same. Remote package:</p>\n<pre><code>docker pull ghcr.io/arkadisahakyan/catalog-service:latest\n</code></pre>\n<p>What is the source of the problem and how to fix it?</p>\n",
    "tags" : [ "java", "spring-boot", "docker" ],
    "owner" : {
      "account_id" : 28697372,
      "reputation" : 29,
      "user_id" : 21975313,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/25cab1e56c14532f4d9757fe5d08cddf?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Arkadi",
      "link" : "https://stackoverflow.com/users/21975313/arkadi"
    },
    "is_answered" : true,
    "view_count" : 95,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1764088319,
    "creation_date" : 1764074250,
    "link" : "https://stackoverflow.com/questions/79829714/error-when-running-a-spring-boot-image-in-docker-open-workspace-boot-inf-class",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79829963,
    "question_id" : 79829714,
    "body" : "<p>Quick answer: There are no problems with the source code.</p>\n<p>I tested it using two different methods, and both appeared to be normal and without any problems.</p>\n<p>The first method: manually create a Docker image.</p>\n<p>The following are the steps to manually create a Docker image:</p>\n<h2>Build Spring Boot Application</h2>\n<pre class=\"lang-bash prettyprint-override\"><code>gradle clean build\n</code></pre>\n<h2>Build Docker image</h2>\n<pre class=\"lang-bash prettyprint-override\"><code>docker build -f Dockerfile -t catalog-service:0.0.1-SNAPSHOT .\n</code></pre>\n<h2>editing: docker-compose.yml</h2>\n<p>change image to <code>&quot;catalog-service:0.0.1-SNAPSHOT&quot;</code></p>\n<pre class=\"lang-yaml prettyprint-override\"><code>version: &quot;3.8&quot;\nservices:\n  catalog-service:\n    depends_on:\n      - polar-postgres\n    image: &quot;catalog-service:0.0.1-SNAPSHOT&quot;\n</code></pre>\n<h2>Run</h2>\n<pre class=\"lang-bash prettyprint-override\"><code>docker compose up\n</code></pre>\n<h2>Test</h2>\n<p>Browser open http://localhost:9001/books</p>\n<p>The second method: Use <code>./gradlew bootBuildImage</code></p>\n<h2>Build</h2>\n<pre class=\"lang-bash prettyprint-override\"><code>./gradlew bootBuildImage\n</code></pre>\n<h2>Find Docker Image</h2>\n<pre class=\"lang-bash prettyprint-override\"><code>docker image ls | grep catalog-service\n</code></pre>\n<p>get</p>\n<pre class=\"lang-bash prettyprint-override\"><code>catalog-service                                      latest                        793ae7db06a2   45 years ago    348MB\n</code></pre>\n<h2>editing: docker-compose.yml</h2>\n<p>change image to <code>&quot;catalog-service&quot;</code></p>\n<pre class=\"lang-yaml prettyprint-override\"><code>version: &quot;3.8&quot;\nservices:\n  catalog-service:\n    depends_on:\n      - polar-postgres\n    image: &quot;catalog-service&quot;\n</code></pre>\n<h2>Run</h2>\n<pre class=\"lang-bash prettyprint-override\"><code>docker compose up\n</code></pre>\n<h2>Test</h2>\n<p>Browser open http://localhost:9001/books</p>\n",
    "score" : 2,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 26698569,
      "reputation" : 4074,
      "user_id" : 20306007,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/98bbc403493aee3681b71dae7abef66e?s=256&d=identicon&r=PG",
      "display_name" : "life888888",
      "link" : "https://stackoverflow.com/users/20306007/life888888"
    },
    "creation_date" : 1764087635,
    "last_activity_date" : 1764088319,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140873223,
    "post_id" : 79829714,
    "body" : "the only problem i can think of is that when you set <code>WORKDIR workspace</code> the directory will be created at <code>&#47;workspace</code> which usually only has access by the user <code>root</code> but you are later running the app as the user <code>spring</code>. So depending on how you run your docker compose, if its run as root, or not. Or you run the <code>chown</code> command in the dockerfile changing the ownershop of the folder workspace to the user spring.",
    "score" : 0,
    "owner" : {
      "account_id" : 2064278,
      "reputation" : 15073,
      "user_id" : 1840146,
      "user_type" : "registered",
      "accept_rate" : 86,
      "profile_image" : "https://i.sstatic.net/JXdxm.png?s=256",
      "display_name" : "Toerktumlare",
      "link" : "https://stackoverflow.com/users/1840146/toerktumlare"
    },
    "creation_date" : 1764110114,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}