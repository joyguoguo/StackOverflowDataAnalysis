{
  "question" : {
    "question_id" : 79609378,
    "title" : "Java socket client receives outdated serialized object despite server sending updated version",
    "body" : "<p>I'm trying to create a little multiplayer poker game for my friends that uses base java functions like swing and socket, but i can't get the client side JFrames to update correctly. The game is intended to  update to show each players move when their action is selected, and to show all players in the game when new players join, but I can't get previous clients to update, only the most recent one. I'm using the most recent versions of IntelliJ and JDK and I'm testing server and client on the same machine.</p>\n<p>I debugged and tried to see if it was sending the wrong panel, but my server sends the same panel object to each client, and that panel is the updated one. When I print the object it says the panel has 2 players drawn onto it before it is sent, but when my client receives it, it says only one player is drawn onto it.</p>\n<p>Relavent Code:</p>\n<p>Update method on client</p>\n<pre><code>public void updateGamePanel(DrawPanel newPanel) {\n        System.out.println(newPanel.toString()+&quot; recived... Updating...&quot;);\n        Container contentPane = frame.getContentPane();\n        contentPane.removeAll();\n        contentPane.setLayout(new BorderLayout());\n\n        contentPane.add(newPanel, BorderLayout.CENTER);\n\n        contentPane.invalidate();\n        contentPane.validate();\n        contentPane.repaint();\n\n        frame.setSize(1000, 700);\n        frame.setVisible(true);\n    }\n</code></pre>\n<p>update method on Server:</p>\n<pre><code>public void updateAllClients() {\n        DrawPanel panel = new DrawPanel(table);\n\n        System.out.println(&quot;Updating all clients: &quot; + table.size() + &quot; players at table.&quot;);\n        Iterator&lt;PlayerHandler&gt; iter = playerThreads.iterator();\n        while (iter.hasNext()) {\n            PlayerHandler handler = iter.next();\n            try {\n                System.out.println(panel+&quot; SERVER SENT&quot;);\n                handler.updatePlayer(panel);\n            } catch (Exception e) {\n                iter.remove();  // remove broken connections\n                System.out.println(&quot;Removed disconnected player handler.&quot;);\n            }\n        }\n    }\n</code></pre>\n<p>update method on thread handler class</p>\n<pre><code>public void updatePlayer(DrawPanel panel) {\n        try {\n            if (output != null) {\n                output.writeObject(panel);\n                output.flush();\n                System.out.println(&quot;Sent updated &quot;+panel.toString()+&quot; to player.&quot;);\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n</code></pre>\n<p>Full Client side class:</p>\n<pre><code>package Poker.Server;\n\nimport Poker.Client.Player;\nimport Poker.Utils.DrawPanel;\n\nimport javax.swing.*;\nimport java.io.IOException;\nimport java.io.ObjectInputStream;\nimport java.io.ObjectOutputStream;\nimport java.io.PrintWriter;\nimport java.net.ServerSocket;\nimport java.net.Socket;\nimport java.util.ArrayList;\nimport java.util.Iterator;\n\npublic class PokerServer {\n    private ArrayList&lt;Player&gt; table;\n    public int minBet;\n    public static final PokerServer server = new PokerServer(new ArrayList&lt;&gt;(), 0);\n    public static final int MAX_PLAYERS=10;\n    private final ArrayList&lt;PlayerHandler&gt; playerThreads=new ArrayList&lt;&gt;();\n    private PokerServer(ArrayList&lt;Player&gt; table, int minBet) {\n        this.table = table;\n        this.minBet = minBet;\n    }\n\n    public JPanel getPanel() {\n        return new DrawPanel(table);\n    }\n\n    public static void main(String[] args) {\n        try (ServerSocket serverSocket = new ServerSocket(5000)) {\n            System.out.println(&quot;Poker Server is running on port 5000...&quot;);\n\n            while (true) {\n                Socket clientSocket = serverSocket.accept();\n                ObjectOutputStream out= new ObjectOutputStream(clientSocket.getOutputStream());\n                out.flush();\n                ObjectInputStream input=new ObjectInputStream(clientSocket.getInputStream());\n                out.writeObject(new String(&quot;Player Number #&quot;+server.table.size()));\n                if (server.playerThreads.size() &gt;= MAX_PLAYERS) {\n                    out.writeObject(new String(&quot;Too many players&quot;));\n                    clientSocket.close();\n                    continue;\n                }\n\n\n                PlayerHandler handler = new PlayerHandler(clientSocket,out,input);\n                server.playerThreads.add(handler);\n                new Thread(handler).start();\n\n                System.out.println(&quot;New player connected. Current: &quot; + server.playerThreads.size());\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n\n    public DrawPanel createFrame(){\n        return new DrawPanel(table);\n    }\n\n    public void addPlayer(Player play){\n        table.add(play);\n        updateAllClients();\n    }\n\n    public void removePlayer(Player play) {\n        table.remove(play);\n        updateAllClients();  // Notify all clients that a player has left\n    }\n\n    public void updateAllClients() {\n        DrawPanel panel = new DrawPanel(table);\n\n        System.out.println(&quot;Updating all clients: &quot; + table.size() + &quot; players at table.&quot;);\n        Iterator&lt;PlayerHandler&gt; iter = playerThreads.iterator();\n        while (iter.hasNext()) {\n            PlayerHandler handler = iter.next();\n            try {\n                System.out.println(panel+&quot; SERVER SENT&quot;);\n                handler.updatePlayer(panel);\n            } catch (Exception e) {\n                iter.remove();  // remove broken connections\n                System.out.println(&quot;Removed disconnected player handler.&quot;);\n            }\n        }\n    }\n\n}\n</code></pre>\n<p>Full Server code</p>\n<pre><code>package Poker.Server;\n\nimport Poker.Client.Player;\nimport Poker.Utils.DrawPanel;\n\nimport javax.swing.*;\nimport java.io.IOException;\nimport java.io.ObjectInputStream;\nimport java.io.ObjectOutputStream;\nimport java.io.PrintWriter;\nimport java.net.ServerSocket;\nimport java.net.Socket;\nimport java.util.ArrayList;\nimport java.util.Iterator;\n\npublic class PokerServer {\n    private ArrayList&lt;Player&gt; table;\n    public int minBet;\n    public static final PokerServer server = new PokerServer(new ArrayList&lt;&gt;(), 0);\n    public static final int MAX_PLAYERS=10;\n    private final ArrayList&lt;PlayerHandler&gt; playerThreads=new ArrayList&lt;&gt;();\n    private PokerServer(ArrayList&lt;Player&gt; table, int minBet) {\n        this.table = table;\n        this.minBet = minBet;\n    }\n\n    public JPanel getPanel() {\n        return new DrawPanel(table);\n    }\n\n    public static void main(String[] args) {\n        try (ServerSocket serverSocket = new ServerSocket(5000)) {\n            System.out.println(&quot;Poker Server is running on port 5000...&quot;);\n\n            while (true) {\n                Socket clientSocket = serverSocket.accept();\n                ObjectOutputStream out= new ObjectOutputStream(clientSocket.getOutputStream());\n                out.flush();\n                ObjectInputStream input=new ObjectInputStream(clientSocket.getInputStream());\n                out.writeObject(new String(&quot;Player Number #&quot;+server.table.size()));\n                if (server.playerThreads.size() &gt;= MAX_PLAYERS) {\n                    out.writeObject(new String(&quot;Too many players&quot;));\n                    clientSocket.close();\n                    continue;\n                }\n\n\n                PlayerHandler handler = new PlayerHandler(clientSocket,out,input);\n                server.playerThreads.add(handler);\n                new Thread(handler).start();\n\n                System.out.println(&quot;New player connected. Current: &quot; + server.playerThreads.size());\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n\n    public DrawPanel createFrame(){\n        return new DrawPanel(table);\n    }\n\n    public void addPlayer(Player play){\n        table.add(play);\n        updateAllClients();\n    }\n\n    public void removePlayer(Player play) {\n        table.remove(play);\n        updateAllClients();  // Notify all clients that a player has left\n    }\n\n    public void updateAllClients() {\n        DrawPanel panel = new DrawPanel(table);\n\n        System.out.println(&quot;Updating all clients: &quot; + table.size() + &quot; players at table.&quot;);\n        Iterator&lt;PlayerHandler&gt; iter = playerThreads.iterator();\n        while (iter.hasNext()) {\n            PlayerHandler handler = iter.next();\n            try {\n                System.out.println(panel+&quot; SERVER SENT&quot;);\n                handler.updatePlayer(panel);\n            } catch (Exception e) {\n                iter.remove();  // remove broken connections\n                System.out.println(&quot;Removed disconnected player handler.&quot;);\n            }\n        }\n    }\n\n}\n</code></pre>\n<p>Full player handler code:</p>\n<pre><code>package Poker.Server;\n\nimport Poker.Client.Player;\nimport Poker.Utils.DrawPanel;\n\nimport java.io.*;\nimport java.net.Socket;\n\nclass PlayerHandler implements Runnable {\n    private Socket socket;\n    private ObjectOutputStream output;\n    private ObjectInputStream input;\n    private Player player;\n\n    public PlayerHandler(Socket socket,ObjectOutputStream output, ObjectInputStream input) {\n        this.socket = socket;\n        this.input=input;\n        this.output=output;\n    }\n\n    @Override\n    public void run() {\n        try {\n            try {\n                player = (Player) input.readObject();\n                System.out.println(&quot;Received player: &quot; + player.getName());\n                PokerServer.server.addPlayer(player);\n                System.out.println(&quot;Player: &quot; + player);\n\n                // Initial DrawPanel after join\n//                updatePlayer(PokerServer.server.createFrame());\n\n                // Keep the thread alive, waiting for server-side updates.\n                while (!socket.isClosed()) {\n                    Object obj = input.readObject();  // Block until input received\n                    // You can implement client-side messages if needed, e.g., &quot;ping&quot; or &quot;action&quot;\n                    System.out.println(&quot;Received message from client: &quot; + obj);\n                }\n\n            } catch (ClassNotFoundException e) {\n                e.printStackTrace();\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        } finally {\n            try {\n                PokerServer.server.removePlayer(player); // Add this if you want disconnect logic\n                socket.close();\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n\n    // This method will send a DrawPanel object to the client\n    public void updatePlayer(DrawPanel panel) {\n        try {\n            if (output != null) {\n                output.writeObject(panel);\n                output.flush();\n                System.out.println(&quot;Sent updated &quot;+panel.toString()+&quot; to player.&quot;);\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n\n</code></pre>\n<p>Game Panel class:</p>\n<pre><code>package Poker.Utils;\n\nimport Poker.Client.Player;\n\nimport javax.imageio.ImageIO;\nimport javax.swing.*;\nimport java.awt.*;\nimport java.awt.image.BufferedImage;\nimport java.io.File;\nimport java.io.IOException;\nimport java.io.Serializable;\nimport java.util.ArrayList;\n\npublic class DrawPanel extends JPanel implements Serializable {\n    private final ArrayList&lt;Player&gt; table;\n\n    public static final Color crimson = new Color(220, 20, 60);\n    public static final Color deepSkyBlue = new Color(0, 191, 255);\n    public static final Color mediumSeaGreen = new Color(60, 179, 113);\n    public static final Color goldenrod = new Color(218, 165, 32);\n    public static final Color orchid = new Color(218, 112, 214);\n    public static final Color slateBlue = new Color(106, 90, 205);\n    public static final Color tomato = new Color(255, 99, 71);\n    public static final Color sandyBrown = new Color(244, 164, 96);\n    public static final Color darkKhaki = new Color(189, 183, 107);\n    public static final Color mediumPurple = new Color(147, 112, 219);\n    public static final Color[] colors = {crimson, deepSkyBlue, mediumSeaGreen, goldenrod, orchid, slateBlue, tomato, sandyBrown, darkKhaki, mediumPurple};\n\n    public static BufferedImage userIcon;\n\n    static {\n        try {\n            userIcon = ImageIO.read(new File(&quot;Assets/icon.png&quot;));\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n\n    public DrawPanel(ArrayList&lt;Player&gt; table) {\n        this.table = table;\n\n    }\n\n    @Override\n    protected void paintComponent(Graphics g) {\n        super.paintComponent(g);\n\n        int panelWidth = 1000;\n        int panelHeight = 600;\n\n        // Table setup\n        int centerX = panelWidth / 2;\n        int centerY = panelHeight / 2;\n        int tableWidth = 450;\n        int tableHeight = 300;\n        int semiCircleRadius = tableHeight / 2;\n\n        // Draw table: rectangle + semicircles\n        g.setColor(Color.GREEN);\n        g.fillRect(centerX - tableWidth / 2, centerY - tableHeight / 2, tableWidth, tableHeight);\n        g.fillArc(centerX - tableWidth / 2 - semiCircleRadius, centerY - semiCircleRadius, tableHeight, tableHeight, 90, 180);\n        g.fillArc(centerX + tableWidth / 2 - semiCircleRadius, centerY - semiCircleRadius, tableHeight, tableHeight, 270, 180);\n\n        // Seat array\n        int[][] seats = new int[10][2];\n        int seatRadius = 30;\n\n        // === Top 3 seats — moderate spread ===\n        int topY = centerY - tableHeight / 2 - seatRadius - 20;\n        int offsetX = tableWidth / 2;  // moderate spacing (less than before)\n\n        seats[0][0] = centerX - offsetX; // left seat\n        seats[0][1] = topY;\n\n        seats[1][0] = centerX;\n        seats[1][1] = topY;\n\n        seats[2][0] = centerX + offsetX; // right seat\n        seats[2][1] = topY;\n\n        // === Right 2 seats on semicircle — pushed away ===\n        int extraDistance = 50;\n        double rightCenterX = centerX + tableWidth / 2;\n        double rightCenterY = centerY;\n\n        for (int i = 0; i &lt; 2; i++) {\n            double angle = Math.toRadians(30 - i * 60);  // 45°, -45°\n            int x = (int) (rightCenterX + (semiCircleRadius + extraDistance) * Math.cos(angle));\n            int y = (int) (rightCenterY + (semiCircleRadius + extraDistance) * Math.sin(angle));\n            seats[4-i][0] = x;\n            seats[4-i][1] = y;\n        }\n\n        // === Bottom 3 seats — moderate spread ===\n        int bottomY = centerY + tableHeight / 2 + seatRadius + 45;\n\n        seats[7][0] = centerX - offsetX; // left seat\n        seats[7][1] = bottomY;\n\n        seats[6][0] = centerX;\n        seats[6][1] = bottomY;\n\n        seats[5][0] = centerX + offsetX; // right seat\n        seats[5][1] = bottomY;\n\n        // === Left 2 seats on semicircle — pushed away ===\n        double leftCenterX = centerX - tableWidth / 2;\n        double leftCenterY = centerY;\n\n        for (int i=0;i&lt;2;i++) {\n            double angle = Math.toRadians(150 + i * 60);\n            int x = (int) (leftCenterX + (semiCircleRadius + extraDistance) * Math.cos(angle));\n            int y = (int) (leftCenterY + (semiCircleRadius + extraDistance) * Math.sin(angle));\n            seats[8 + i][0] = x;\n            seats[8 + i][1] = y;\n        }\n\n\n\n        // === Draw all seats ===\n        for (int i = 0; i &lt; seats.length; i++) {\n            int seatX = seats[i][0];\n            int seatY = seats[i][1];\n            g.setColor(colors[i]);\n            if(i&lt;table.size()){\n                drawPlayer(g,table.get(i),seatX,seatY,colors[i]);\n            }\n            else{\n                g.fillOval(seatX - seatRadius, seatY - seatRadius, seatRadius * 2, seatRadius * 2);\n            }\n        }\n    }\n\n\n\n\n    private void drawPlayer(Graphics g, Player player, int x, int y, Color color) {\n        if (userIcon == null){\n            System.out.println(&quot;icon failed to load&quot;);\n            System.out.println(player.toString());\n            return;\n        }\n\n        Graphics2D g2d = (Graphics2D) g.create();\n\n        int iconWidth = 70;\n        int iconHeight = 60;\n\n        // Create a tinted version of the icon\n        BufferedImage tinted = new BufferedImage(userIcon.getWidth(), userIcon.getHeight(), BufferedImage.TYPE_INT_ARGB);\n        Graphics2D tg = tinted.createGraphics();\n\n        // Fill with target color\n        tg.setComposite(AlphaComposite.Src);\n        tg.setColor(color);\n        tg.fillRect(0, 0, userIcon.getWidth(), userIcon.getHeight());\n\n        // Apply the icon's alpha as a mask\n        tg.setComposite(AlphaComposite.DstIn);\n        tg.drawImage(userIcon, 0, 0, null);\n        tg.dispose();\n\n        // Draw the tinted icon, resized\n        g2d.drawImage(tinted, x - iconWidth / 2, y - iconHeight / 2, iconWidth, iconHeight, null);\n\n        // Draw the player's balance below the icon\n        g2d.setColor(color);\n        g2d.setFont(new Font(&quot;Arial&quot;, Font.BOLD, 14));\n        String balance = &quot;$&quot; + player.getBalance();\n        g2d.drawString(balance, x - g2d.getFontMetrics().stringWidth(balance) / 2, y + iconHeight / 2 + 15);\n        Boolean blind=player.getBlind();\n        if(blind!=null){\n            if(blind){\n                g2d.drawString(&quot;Big Blind&quot;,x-g2d.getFontMetrics().stringWidth(&quot;Big Blind&quot;)/2,y-iconHeight/2-25);\n            }else{\n                g2d.drawString(&quot;Small Blind&quot;,x-g2d.getFontMetrics().stringWidth(&quot;Small Blind&quot;)/2,y-iconHeight/2-25);\n\n            }\n        }\n        g2d.drawString(player.getName(), x - g2d.getFontMetrics().stringWidth(player.getName()) / 2, y - iconHeight / 2 - 5);\n\n        g2d.dispose();\n    }\n\n    @Override\n    public String toString(){\n        return &quot;DrawPanel: &quot;+table.size()+&quot; Players&quot;;\n    }\n\n}\n</code></pre>\n",
    "tags" : [ "java", "swing", "server", "client" ],
    "owner" : {
      "account_id" : 40151369,
      "reputation" : 11,
      "user_id" : 29635984,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/65206ec7dd424bfab189109ed3f1c033?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "brenden domsalla",
      "link" : "https://stackoverflow.com/users/29635984/brenden-domsalla"
    },
    "is_answered" : false,
    "view_count" : 42,
    "closed_date" : 1746621226,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1746560302,
    "creation_date" : 1746560302,
    "link" : "https://stackoverflow.com/questions/79609378/java-socket-client-receives-outdated-serialized-object-despite-server-sending-up",
    "closed_reason" : "Duplicate"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140405831,
    "post_id" : 79609378,
    "body" : "Ok so taking the idea to simply convert it to a json fixed all of my issues, and also allowed my code to work better over all. if anyone else comes to this thread looking for answers, I changed to a maven project and imported googles gson module to send and recieve everything all right.",
    "score" : 0,
    "owner" : {
      "account_id" : 40151369,
      "reputation" : 11,
      "user_id" : 29635984,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/65206ec7dd424bfab189109ed3f1c033?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "brenden domsalla",
      "link" : "https://stackoverflow.com/users/29635984/brenden-domsalla"
    },
    "creation_date" : 1746655086,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140401869,
    "post_id" : 79609378,
    "body" : "Your program has data races.  For example, the player threads on the server invoke <code>PokerServer.server.addPlayer()</code>, but this method is not thread-safe, and the player threads do not perform any external synchronization to make these invocations safely.  It looks like there are also data races involving code running on the event-dispatch thread.",
    "score" : 0,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1746564647,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140401768,
    "post_id" : 79609378,
    "body" : "You might not want to use <code>ObjectOutputStream</code> for serialization. Check other serialization like JSON, MessagePack, protobuf.",
    "score" : 1,
    "owner" : {
      "account_id" : 108033,
      "reputation" : 20089,
      "user_id" : 286934,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f16a184d26b72795ff243464d715cffe?s=256&d=identicon&r=PG",
      "display_name" : "Progman",
      "link" : "https://stackoverflow.com/users/286934/progman"
    },
    "creation_date" : 1746562114,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140401723,
    "post_id" : 79609378,
    "body" : "Why are you trying to serialize the view objects instead of the model objects? Also, there is a lot of code here, but I can only see <code>writeObject</code> with the panel, but <code>readObject</code> with the player? Where do you try to deserialize the panel?",
    "score" : 3,
    "owner" : {
      "account_id" : 318670,
      "reputation" : 16477,
      "user_id" : 636009,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/IIQJV.jpg?s=256",
      "display_name" : "David Conrad",
      "link" : "https://stackoverflow.com/users/636009/david-conrad"
    },
    "creation_date" : 1746561101,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}