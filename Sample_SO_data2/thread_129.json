{
  "question" : {
    "question_id" : 79838110,
    "title" : "How can I solve this problem of test difference?",
    "body" : "<p>As far as I understand, the difference between expected and actual one is <strong>NBSP</strong> (<a href=\"https://en.wikipedia.org/wiki/Non-breaking_space\" rel=\"nofollow noreferrer\">Non‐Breaking Space</a>).</p>\n<p>I don’t know how to remove this. It doesn’t get highlighted and cannot be found using CTRL+H (looking for \\u00A0).</p>\n<p><em>I've already tried:</em></p>\n<ul>\n<li>searching via CTRL+H to remove or replace it</li>\n<li>deleting the entire line and rewriting it manually.</li>\n</ul>\n<p><strong>here is the code of my test:</strong></p>\n<pre><code>void shouldReturnFullReport_whenGivenSeveralDrivers() {\n\n    Map&lt;String, RacerInfo&gt; racers = new LinkedHashMap&lt;&gt;();\n    racers.put(&quot;SVF&quot;, new RacerInfo(&quot;Sebastian Vettel&quot;, &quot;FERRARI&quot;));\n    racers.put(&quot;DRR&quot;, new RacerInfo(&quot;Daniel Ricciardo&quot;, &quot;RED BULL RACING TAG HEUER&quot;));\n    racers.put(&quot;VBM&quot;, new RacerInfo(&quot;Valtteri Bottas&quot;, &quot;MERCEDES&quot;));\n    racers.put(&quot;LHM&quot;, new RacerInfo(&quot;Lewis Hamilton&quot;, &quot;MERCEDES&quot;));\n\n    Map&lt;String, Duration&gt; lapTimes = new LinkedHashMap&lt;&gt;();\n    lapTimes.put(&quot;SVF&quot;, Duration.ofMinutes(1).plusSeconds(4).plusMillis(415));\n    lapTimes.put(&quot;DRR&quot;, Duration.ofMinutes(1).plusSeconds(12).plusMillis(13));\n    lapTimes.put(&quot;VBM&quot;, Duration.ofMinutes(1).plusSeconds(12).plusMillis(434));\n    lapTimes.put(&quot;LHM&quot;, Duration.ofMinutes(1).plusSeconds(12).plusMillis(460));\n\n    String expected = &quot;&quot;&quot;\n         1. Sebastian Vettel       | FERRARI                        | 1:04.415\n         2. Daniel Ricciardo       | RED BULL RACING TAG HEUER      | 1:12.013\n         3. Valtteri Bottas        | MERCEDES                       | 1:12.434\n         4. Lewis Hamilton         | MERCEDES                       | 1:12.460\n        &quot;&quot;&quot;;\n\n    assertEquals(expected, ResultFormatter.format(lapTimes, racers));\n}\n</code></pre>\n<p><a href=\"https://i.sstatic.net/Tg95nmJj.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/Tg95nmJj.png\" alt=\"here is the difference between expected and actual one\" /></a></p>\n",
    "tags" : [ "java", "regex", "unit-testing" ],
    "owner" : {
      "account_id" : 27523081,
      "reputation" : 33,
      "user_id" : 31391455,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/JfGXLng2.jpg?s=256",
      "display_name" : "holysh",
      "link" : "https://stackoverflow.com/users/31391455/holysh"
    },
    "is_answered" : true,
    "view_count" : 108,
    "answer_count" : 1,
    "score" : -2,
    "last_activity_date" : 1764952960,
    "creation_date" : 1764863480,
    "link" : "https://stackoverflow.com/questions/79838110/how-can-i-solve-this-problem-of-test-difference",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79838165,
    "question_id" : 79838110,
    "body" : "<p>The issue was not caused by non-breaking spaces (<code>\\u00A0</code>). I chose to normalize line endings with <code>replaceAll(&quot;\\\\r\\\\n&quot;, &quot;\\n&quot;)</code> instead of <code>\\\\s</code> because using <code>\\\\s</code> would remove spaces and tabs as far as i know, destroying the table formatting.</p>\n<pre><code>String result = ResultFormatter.format(times, racers);\n\n     String cleanExpected = expected.replaceAll(&quot;\\\\r\\\\n&quot;, &quot;\\n&quot;);\n     String cleanResult = result.replaceAll(&quot;\\\\r\\\\n&quot;, &quot;\\n&quot;);\n\n     assertEquals(cleanExpected, cleanResult);\n    }\n</code></pre>\n<p><a href=\"https://i.sstatic.net/i9krqZj8.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/i9krqZj8.png\" alt=\"enter image description here\" /></a></p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 27523081,
      "reputation" : 33,
      "user_id" : 31391455,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/JfGXLng2.jpg?s=256",
      "display_name" : "holysh",
      "link" : "https://stackoverflow.com/users/31391455/holysh"
    },
    "creation_date" : 1764866890,
    "last_activity_date" : 1764872055,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140891430,
    "post_id" : 79838110,
    "body" : "I assume it is only the equality of the data that concerns you. Therefore you should probably remove all formatting and punctuation before a comparison is made, e.g. <code>s = s.replaceAll(&quot;[\\\\p{Punct}\\\\p{Cntrl}]&quot;, &quot;&quot;)</code>;",
    "score" : 0,
    "owner" : {
      "account_id" : 22124137,
      "reputation" : 4244,
      "user_id" : 16376827,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/1ImPw.png?s=256",
      "display_name" : "g00se",
      "link" : "https://stackoverflow.com/users/16376827/g00se"
    },
    "creation_date" : 1765118913,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140888629,
    "post_id" : 79838110,
    "body" : "Using <code>assertEquals</code> is OK when you expect things to be equal but when delevoping code and it yields not-equal you need to investigate, not guess. You could do a character-by-character comparison in a loop, stopping at the first difference. Report the two non-equal characters and their index into the strings. You could show also show two or three characters of each string before and after the difference.",
    "score" : 0,
    "owner" : {
      "account_id" : 262183,
      "reputation" : 14149,
      "user_id" : 546871,
      "user_type" : "registered",
      "accept_rate" : 40,
      "profile_image" : "https://i.sstatic.net/p1diY.jpg?s=256",
      "display_name" : "AdrianHHH",
      "link" : "https://stackoverflow.com/users/546871/adrianhhh"
    },
    "creation_date" : 1764923962,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140888570,
    "post_id" : 79838110,
    "body" : "also be aware that formatting can optionally be accomplished by using tabs (<code>\\t</code>) in place of a certain (variable) number of spaces and therefore it is not <i>trivial</i> to compare the result with a fixed String",
    "score" : 1,
    "owner" : {
      "account_id" : 31180,
      "reputation" : 29752,
      "user_id" : 85421,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/kKvXH.gif?s=256",
      "display_name" : "user85421",
      "link" : "https://stackoverflow.com/users/85421/user85421"
    },
    "creation_date" : 1764919920,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140887686,
    "post_id" : 79838110,
    "body" : "or is it the <i>carriage return</i> (or similar) at the end of the line? (see <i>Actual</i> output in given screenshot) -- ((IMO the test itself is <i>bugged</i>))",
    "score" : 0,
    "owner" : {
      "account_id" : 31180,
      "reputation" : 29752,
      "user_id" : 85421,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/kKvXH.gif?s=256",
      "display_name" : "user85421",
      "link" : "https://stackoverflow.com/users/85421/user85421"
    },
    "creation_date" : 1764867281,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140887654,
    "post_id" : 79838110,
    "body" : "<i>As far as I understand, the difference between expected and actual one is NBSP (Non-Breaking Space).</i> What makes you think that?",
    "score" : 1,
    "owner" : {
      "account_id" : 22124137,
      "reputation" : 4244,
      "user_id" : 16376827,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/1ImPw.png?s=256",
      "display_name" : "g00se",
      "link" : "https://stackoverflow.com/users/16376827/g00se"
    },
    "creation_date" : 1764866178,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79838165" : [ {
      "comment_id" : 140889805,
      "post_id" : 79838165,
      "body" : "<i>Also what does \\s the whitespace class have to do with messing up formatting ?</i> I suspect you might not know what &#39;whitespace&#39; means.",
      "score" : 0,
      "owner" : {
        "account_id" : 22124137,
        "reputation" : 4244,
        "user_id" : 16376827,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/1ImPw.png?s=256",
        "display_name" : "g00se",
        "link" : "https://stackoverflow.com/users/16376827/g00se"
      },
      "creation_date" : 1764972875,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140889600,
      "post_id" : 79838165,
      "body" : "@g00se <code>&quot;\\r\\n&quot;</code> is converted to control codes. You should avoid embedding control codes in regex. Actually, it shouldn&#39;t be done IMO. Instead use shortcut control codes that regex understands. <code>\\r\\n</code> Since the ESC character must be escaped in Java strings, that becomes <code>&quot;\\\\r\\\\n&quot;</code> which gets presented to the regex parser as special escape sequence <code>\\r\\n</code>. It can also be presented as <code>\\x0d\\x0a</code> which in Java string form is <code>&quot;\\\\x0d\\\\x0a&quot;</code>",
      "score" : 0,
      "owner" : {
        "account_id" : 268704,
        "reputation" : 3643,
        "user_id" : 15577665,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/22b015407c4f216f37fb10bccb8debaf?s=256&d=identicon&r=PG",
        "display_name" : "sln",
        "link" : "https://stackoverflow.com/users/15577665/sln"
      },
      "creation_date" : 1764962214,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140889585,
      "post_id" : 79838165,
      "body" : "Also what does <code>\\s</code> the whitespace class have to do with messing up formatting ? You could make a temporary strings to debug equality problems. You should use my example and test the result of your formatting string to see if any CRLF&#39;s are in that as well.",
      "score" : 0,
      "owner" : {
        "account_id" : 268704,
        "reputation" : 3643,
        "user_id" : 15577665,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/22b015407c4f216f37fb10bccb8debaf?s=256&d=identicon&r=PG",
        "display_name" : "sln",
        "link" : "https://stackoverflow.com/users/15577665/sln"
      },
      "creation_date" : 1764961436,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140889574,
      "post_id" : 79838165,
      "body" : "AI Google: <code>In Java, when using a text block (a multi-line string literal introduced in Java 15 with triple quotes &quot;&quot;&quot;), the line endings are normalized by the compiler to a single Line Feed (\\n).  ...  even on Windows systems where \\r\\n is the typical platform-specific line ending.  This behavior ensures consistent line endings within text blocks regardless of the operating system where the source code was created or compiled, preventing platform-specific quirks.</code>  See <a href=\"https://stackoverflow.com/questions/1201927/is-javas-assertequals-method-reliable\">Is Java&#39;s assertEquals method reliable?</a>",
      "score" : 0,
      "owner" : {
        "account_id" : 268704,
        "reputation" : 3643,
        "user_id" : 15577665,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/22b015407c4f216f37fb10bccb8debaf?s=256&d=identicon&r=PG",
        "display_name" : "sln",
        "link" : "https://stackoverflow.com/users/15577665/sln"
      },
      "creation_date" : 1764960956,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140889570,
      "post_id" : 79838165,
      "body" : "There is no CRLF in your <code>expected</code> string. Proof -&gt; <a href=\"https://www.programiz.com/online-compiler/0Tv2gzBA5W4yx\" rel=\"nofollow noreferrer\">programiz.com/online-compiler/0Tv2gzBA5W4yx</a>  Your normalization is not a solution.",
      "score" : 0,
      "owner" : {
        "account_id" : 268704,
        "reputation" : 3643,
        "user_id" : 15577665,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/22b015407c4f216f37fb10bccb8debaf?s=256&d=identicon&r=PG",
        "display_name" : "sln",
        "link" : "https://stackoverflow.com/users/15577665/sln"
      },
      "creation_date" : 1764960888,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140887852,
      "post_id" : 79838165,
      "body" : "@user85421 i edited the answer, please take a look",
      "score" : 0,
      "owner" : {
        "account_id" : 27523081,
        "reputation" : 33,
        "user_id" : 31391455,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/JfGXLng2.jpg?s=256",
        "display_name" : "holysh",
        "link" : "https://stackoverflow.com/users/31391455/holysh"
      },
      "creation_date" : 1764872684,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140887758,
      "post_id" : 79838165,
      "body" : "That replace regex won&#39;t work. It should be <code>&quot;\\r\\n&quot;</code> but it might better be <code>s = s.replaceAll(&quot;\\\\s&quot;, &quot;&quot;)</code> anyway",
      "score" : 0,
      "owner" : {
        "account_id" : 22124137,
        "reputation" : 4244,
        "user_id" : 16376827,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/1ImPw.png?s=256",
        "display_name" : "g00se",
        "link" : "https://stackoverflow.com/users/16376827/g00se"
      },
      "creation_date" : 1764869689,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140887704,
      "post_id" : 79838165,
      "body" : "&quot;<i>converting all non-break spaces into normal spaces</i>&quot; - but based on posted screenshot, the problem is the <code>\\r</code>, which is also being replaced, and not (only) NBSP (<a href=\"https://i.sstatic.net/5dIBn1HO.png\" rel=\"nofollow noreferrer\">i.sstatic.net/5dIBn1HO.png</a>)",
      "score" : 2,
      "owner" : {
        "account_id" : 31180,
        "reputation" : 29752,
        "user_id" : 85421,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/kKvXH.gif?s=256",
        "display_name" : "user85421",
        "link" : "https://stackoverflow.com/users/85421/user85421"
      },
      "creation_date" : 1764868055,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}