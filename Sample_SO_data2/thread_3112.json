{
  "question" : {
    "question_id" : 79573157,
    "title" : "How to use RedisTemplate.execute(SessionCallback) without type issues?",
    "body" : "<p>Here's my basic example setup:</p>\n<pre class=\"lang-java prettyprint-override\"><code>private final RedisTemplate&lt;String, Object&gt; redisTemplate;\n\npublic void save(Object thing, Instant expiresAt) {\n    redisTemplate.execute(new SessionCallback&lt;Void&gt;() {\n        @Override\n        public @Nullable Void execute(@NonNull RedisOperations ops) throws DataAccessException {\n            ops.opsForValue(&quot;key&quot;, thing);\n            ops.expireAt(&quot;key&quot;, expiresAt);\n            return null;\n        }\n    });\n}\n</code></pre>\n<p>That version compiles, but has multiple warnings for</p>\n<blockquote>\n<p>Unchecked call to ... as a member of raw type ...</p>\n</blockquote>\n<p>These attempts all fail to compile:</p>\n<pre class=\"lang-java prettyprint-override\"><code>redisTemplate.execute((SessionCallback&lt;Void&gt;) ops -&gt; {\n    ops.opsForValue(&quot;key&quot;, thing);\n    ops.expireAt(&quot;key&quot;, expiresAt);\n    return null;\n});\n</code></pre>\n<blockquote>\n<p>Target method is generic</p>\n</blockquote>\n<pre class=\"lang-java prettyprint-override\"><code>redisTemplate.execute(new SessionCallback&lt;Void&gt;() {\n    @Override\n    public @Nullable Void execute(@NonNull RedisOperations&lt;String, Object&gt; ops) throws DataAccessException {\n        ops.opsForValue(&quot;key&quot;, thing);\n        ops.expireAt(&quot;key&quot;, expiresAt);\n        return null;\n    }\n});\n</code></pre>\n<blockquote>\n<p>Class 'Anonymous class derived from SessionCallback' must implement abstract method 'execute(RedisOperations&lt;K, V&gt;)' in 'SessionCallback'</p>\n</blockquote>\n<pre class=\"lang-java prettyprint-override\"><code>redisTemplate.execute(new SessionCallback&lt;Void&gt;() {\n    @Override\n    public &lt;K, V&gt; @Nullable Void execute(@NonNull RedisOperations&lt;K, V&gt; ops) throws DataAccessException {\n        ops.opsForValue(&quot;key&quot;, thing);\n        ops.expireAt(&quot;key&quot;, expiresAt);\n        return null;\n    }\n});\n</code></pre>\n<blockquote>\n<p>Required type 'T', provided 'String'<br />\nCannot resolve method 'expireAt(String, Instant)'</p>\n</blockquote>\n<p>And finally, compiling with warnings:</p>\n<pre class=\"lang-java prettyprint-override\"><code>redisTemplate.execute(new SessionCallback&lt;Void&gt;() {\n    @Override\n    public &lt;K, V&gt; @Nullable Void execute(@NonNull RedisOperations&lt;K, V&gt; ops) throws DataAccessException {\n        ops.opsForValue((K) &quot;key&quot;, (V) thing);\n        ops.expireAt((K) &quot;key&quot;, (V) expiresAt);\n        return null;\n    }\n});\n</code></pre>\n<blockquote>\n<p>Unchecked cast: 'java.lang.String' to 'K'</p>\n</blockquote>\n<p>Is it actually possible to use this API without type warnings or errors?</p>\n",
    "tags" : [ "java", "spring", "redis", "spring-data", "spring-data-redis" ],
    "owner" : {
      "account_id" : 219684,
      "reputation" : 39263,
      "user_id" : 476716,
      "user_type" : "registered",
      "accept_rate" : 77,
      "profile_image" : "https://www.gravatar.com/avatar/4e325890903afc8269eb2c1aa57587b3?s=256&d=identicon&r=PG",
      "display_name" : "OrangeDog",
      "link" : "https://stackoverflow.com/users/476716/orangedog"
    },
    "is_answered" : false,
    "view_count" : 147,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1744634136,
    "creation_date" : 1744634136,
    "link" : "https://stackoverflow.com/questions/79573157/how-to-use-redistemplate-executesessioncallback-without-type-issues",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140333106,
    "post_id" : 79573157,
    "body" : "Ah yes, <a href=\"https://github.com/spring-projects/spring-data-redis/issues/815\" rel=\"nofollow noreferrer\">github.com/spring-projects/spring-data-redis/issues/815</a> from 2013...",
    "score" : 0,
    "owner" : {
      "account_id" : 219684,
      "reputation" : 39263,
      "user_id" : 476716,
      "user_type" : "registered",
      "accept_rate" : 77,
      "profile_image" : "https://www.gravatar.com/avatar/4e325890903afc8269eb2c1aa57587b3?s=256&d=identicon&r=PG",
      "display_name" : "OrangeDog",
      "link" : "https://stackoverflow.com/users/476716/orangedog"
    },
    "creation_date" : 1744638929,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140333087,
    "post_id" : 79573157,
    "body" : "You don&#39;t. There are several issues registered for this in the Spring Data Redis repository.",
    "score" : 2,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1744638660,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}