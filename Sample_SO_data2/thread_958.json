{
  "question" : {
    "question_id" : 79750859,
    "title" : "Is there a way to have two spring boot jpa entities point to the same table?",
    "body" : "<p>I have some micro-services and some functionalities are shared across these micro-services, so with my team we agreed that we needed this functionality moved to a SDK.</p>\n<p>I've started the migration of a couple functionalities to the SDK, like for example creating a new payment and all that is related to this. When I try integrating this into a micro-service, I'm encountering the next error:\n<a href=\"https://i.sstatic.net/jtR5RMyF.png\" rel=\"nofollow noreferrer\">error log</a></p>\n<p>Basically, Hibernate tells me that is not possible to have two entities pointing to the same table.</p>\n<p>What I've done to solve this is simple, I made some configurations on my DatasourceReadConfiguration file and I have also made some changes to the entities, for example this is how the entity is in the micro-service:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Entity\n@Table( schema = SCHEMAS.admission,\n    uniqueConstraints = {\n    @UniqueConstraint(name = &quot;UKSL014&quot;, columnNames = {&quot;curp&quot;, &quot;idc&quot;})\n})\npublic class PersonProspect extends AbstractGeduxCampusModelEntity {}\n</code></pre>\n<p>And this is how I modified it in the SDK:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Entity\n@Table( schema = SCHEMAS.admission,\n    name = &quot;person_prospect&quot;,\n    uniqueConstraints = {\n    @UniqueConstraint(name = &quot;UKSL014&quot;, columnNames = {&quot;curp&quot;, &quot;idc&quot;})\n})\npublic class PersonProspectPSDK extends AbstractGeduxCampusModelEntity {}\n</code></pre>\n<p>I create the SDK using the command <code>mvn install</code>, and then I import it in the micro-service in my pom.xml like this:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.quiox.gedux&lt;/groupId&gt;\n    &lt;artifactId&gt;gedux-payment-sdk&lt;/artifactId&gt;\n    &lt;version&gt;0.0.2&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>I just want to know if there is a simple solution to the problem I'm having or if I have to restructure the whole SDK. I think the issue comes from the way we use Criteria API and metamodels by jpamodelgen instead of using native SQL in this particular SDK. This causes to have secondary classes like the one mentioned in the error both in the SDK and in the micro-services.</p>\n",
    "tags" : [ "java", "spring-boot", "hibernate", "jpa", "spring-data-jpa" ],
    "owner" : {
      "account_id" : 43717992,
      "reputation" : 13,
      "user_id" : 31382093,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9eed788b2bed7f3ba0fa459af1f5d75f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Ricardo Barba Hernandez",
      "link" : "https://stackoverflow.com/users/31382093/ricardo-barba-hernandez"
    },
    "is_answered" : true,
    "view_count" : 125,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1756564050,
    "creation_date" : 1756512700,
    "link" : "https://stackoverflow.com/questions/79750859/is-there-a-way-to-have-two-spring-boot-jpa-entities-point-to-the-same-table",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79751213,
    "question_id" : 79750859,
    "body" : "<p>But first -&gt; why just don't remove old Entity in microservice when You have it in SDK?</p>\n<p>If You want disable/enable sdk for concrete microservices, configure it per microservice with @EnableJpaRepositories, @ComponentScan, @EntityScan (just dont specify SDK package there).</p>\n<p>If You don't want remove entity from microservice, maybe pack this &quot;shared logic&quot; with &quot;shared fields&quot; into @Embeddable class and add it in microservice entity as @Embedded object =&gt; but if You can do this, i would recommend to reengineer this structure into f.e inheritence ORM (@MappedSuperclass, @Inheritance) or interface inheritance in plain Java.</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 27349436,
      "reputation" : 351,
      "user_id" : 20858835,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AEdFTp7fexVpP1zuJNuWsloFguLU89mNLZFNIsLxF8xw=k-s256",
      "display_name" : "ECHU",
      "link" : "https://stackoverflow.com/users/20858835/echu"
    },
    "creation_date" : 1756564050,
    "last_activity_date" : 1756564050,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140703691,
    "post_id" : 79750859,
    "body" : "It depends on what you want to achieve. You may want to look into @MappedSuperclass and @Inheritance(strategy = InheritanceType.TABLE_PER_CLASS)",
    "score" : 0,
    "owner" : {
      "account_id" : 6136413,
      "reputation" : 9587,
      "user_id" : 4785110,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/71b70abe72497023835a6dd8961b7c89?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "maraca",
      "link" : "https://stackoverflow.com/users/4785110/maraca"
    },
    "creation_date" : 1756563383,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140703524,
    "post_id" : 79750859,
    "body" : "Turn off DDL generation, and instead validate. I think you&#39;re getting an error because Hibernate would need to update the same table for two different entities.",
    "score" : 1,
    "owner" : {
      "account_id" : 1211967,
      "reputation" : 10014,
      "user_id" : 1180351,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/pKB8y.png?s=256",
      "display_name" : "Rob Spoor",
      "link" : "https://stackoverflow.com/users/1180351/rob-spoor"
    },
    "creation_date" : 1756556887,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140703103,
    "post_id" : 79750859,
    "body" : "Make a common layer like Service-&gt;Entity and point to it from different microservices.",
    "score" : 0,
    "owner" : {
      "account_id" : 126486,
      "reputation" : 4968,
      "user_id" : 323015,
      "user_type" : "registered",
      "accept_rate" : 43,
      "profile_image" : "https://i.sstatic.net/QPjCh.jpg?s=256",
      "display_name" : "subhashis",
      "link" : "https://stackoverflow.com/users/323015/subhashis"
    },
    "creation_date" : 1756528656,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140703008,
    "post_id" : 79750859,
    "body" : "When both the microservice and the SDK define JPA entities that map to the same table, Hibernate (especially 6.x) will refuse it by design. Even if the entities have different Java class names, mapping the same table twice in the same EntityManagerFactory is not supported (outside of specific inheritance/subselect patterns).",
    "score" : 0,
    "owner" : {
      "account_id" : 7358121,
      "reputation" : 5543,
      "user_id" : 5602214,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/FM5gL.jpg?s=256",
      "display_name" : "Prashant",
      "link" : "https://stackoverflow.com/users/5602214/prashant"
    },
    "creation_date" : 1756517458,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79751213" : [ {
      "comment_id" : 140705493,
      "post_id" : 79751213,
      "body" : "@RicardoBarbaHernandez In this case, it seems that the problem is not technical, but business in nature â€“ since the proposed solutions are rejected by the other team without argument, no one here is likely to be able to solve this type of problem.",
      "score" : 0,
      "owner" : {
        "account_id" : 27349436,
        "reputation" : 351,
        "user_id" : 20858835,
        "user_type" : "registered",
        "profile_image" : "https://lh3.googleusercontent.com/a/AEdFTp7fexVpP1zuJNuWsloFguLU89mNLZFNIsLxF8xw=k-s256",
        "display_name" : "ECHU",
        "link" : "https://stackoverflow.com/users/20858835/echu"
      },
      "creation_date" : 1756664657,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140704479,
      "post_id" : 79751213,
      "body" : "If I could decide by myself I would in fact remove all of the old entities from the micro-services, but the rest of my team want to do this progressively. But maybe some additional context that is needed is that the main error comes from the logic the team is using to create the SDK, we are migrating some entities to the SDK that I would not consider integral to the principal functionality. This is cause we use jpa model gen for Criteria API queries. I already recommended using DTOs for this but they refused.",
      "score" : 0,
      "owner" : {
        "account_id" : 43717992,
        "reputation" : 13,
        "user_id" : 31382093,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/9eed788b2bed7f3ba0fa459af1f5d75f?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Ricardo Barba Hernandez",
        "link" : "https://stackoverflow.com/users/31382093/ricardo-barba-hernandez"
      },
      "creation_date" : 1756607128,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}