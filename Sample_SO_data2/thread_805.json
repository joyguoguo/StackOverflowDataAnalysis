{
  "question" : {
    "question_id" : 79774357,
    "title" : "docx4j Anchor specified image location does not take effect?",
    "body" : "<p><a href=\"https://i.sstatic.net/zK8YIw5n.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/zK8YIw5n.png\" alt=\"enter image description here\" /></a></p>\n<pre><code>&lt;properties&gt;\n        &lt;java.version&gt;17&lt;/java.version&gt;\n    &lt;/properties&gt;\n&lt;!-- https://mvnrepository.com/artifact/org.docx4j/docx4j-JAXB-ReferenceImpl --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.docx4j&lt;/groupId&gt;\n            &lt;artifactId&gt;docx4j-JAXB-ReferenceImpl&lt;/artifactId&gt;\n            &lt;version&gt;11.4.11&lt;/version&gt;\n        &lt;/dependency&gt;\n</code></pre>\n<pre><code>import org.docx4j.dml.CTPoint2D;\nimport org.docx4j.dml.wordprocessingDrawing.Anchor;\nimport org.docx4j.dml.wordprocessingDrawing.Inline;\nimport org.docx4j.openpackaging.packages.WordprocessingMLPackage;\nimport org.docx4j.openpackaging.parts.WordprocessingML.BinaryPartAbstractImage;\nimport org.docx4j.openpackaging.parts.WordprocessingML.MainDocumentPart;\nimport org.docx4j.wml.*;\n\npublic void addSealWithAnchor(String inputDocx, String outputDocx, String imagePath) throws Exception {\n\n        File imageFile = new File(imagePath);\n        if (!imageFile.exists()) {\n            throw new FileNotFoundException(&quot;error: &quot; + imagePath);\n        }\n\n        WordprocessingMLPackage wordMLPackage = WordprocessingMLPackage.load(new File(inputDocx));\n        MainDocumentPart documentPart = wordMLPackage.getMainDocumentPart();\n        ObjectFactory factory = new ObjectFactory();\n\n        BinaryPartAbstractImage imagePart = BinaryPartAbstractImage.createImagePart(wordMLPackage, imageFile);\n\n        long cx = 5 * 360000;\n        long cy = 5 * 360000;\n\n        Inline inline = imagePart.createImageInline(&quot;seal&quot;, &quot;supplier seal&quot;, 1, 2, cx, cy, false);\n\n        Anchor anchor = new Anchor();\n        anchor.setRelativeHeight(0);\n        anchor.setBehindDoc(false);\n        anchor.setLocked(false);\n        anchor.setLayoutInCell(true);\n        anchor.setAllowOverlap(true);\n\n        CTPoint2D position = new CTPoint2D();\n        position.setX(9500000L);\n        position.setY(2800000L);\n        anchor.setSimplePos(position);\n\n        anchor.setExtent(inline.getExtent());\n        anchor.setDocPr(inline.getDocPr());\n        anchor.setGraphic(inline.getGraphic());\n\n        Drawing drawing = factory.createDrawing();\n        drawing.getAnchorOrInline().add(anchor);\n\n        R run = factory.createR();\n        run.getContent().add(drawing);\n\n        P paragraph = factory.createP();\n        paragraph.getContent().add(run);\n\n        documentPart.addObject(paragraph);\n\n        wordMLPackage.save(new File(outputDocx));\n        System.out.println(&quot;success: &quot; + outputDocx);\n    }\n</code></pre>\n<p>It seams <code>position.setX(9500000L);</code> doesn't work,</p>\n<p><code>documentPart.addObject(paragraph);</code> specified image location can't customize ,</p>\n<p>I need to insert an image into a specified location in the docx file to make it look like an electronic stamp.</p>\n<p>I try to get the Tbl class from docx4j and always get an error saying that it can't find the corresponding location.</p>\n<p>I also use bookmarks as placeholders, but it also says that it can't find the bookmark.</p>\n<p>In my case, the stamped image is usually in the lower right corner of the first page of the word document.\nI need your help,thanks</p>\n",
    "tags" : [ "java", "docx4j" ],
    "owner" : {
      "account_id" : 19955436,
      "reputation" : 35,
      "user_id" : 14624158,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/37803ad4721408afc254b60acd1acb91?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "becage",
      "link" : "https://stackoverflow.com/users/14624158/becage"
    },
    "is_answered" : false,
    "view_count" : 33,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1758957654,
    "creation_date" : 1758773812,
    "link" : "https://stackoverflow.com/questions/79774357/docx4j-anchor-specified-image-location-does-not-take-effect",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79776582,
    "question_id" : 79774357,
    "body" : "<p>Word generates something like:</p>\n<pre><code>                &lt;w:drawing&gt;\n                    &lt;wp:anchor xmlns:wp=&quot;http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing&quot; allowOverlap=&quot;true&quot; behindDoc=&quot;false&quot; distB=&quot;0&quot; distL=&quot;114300&quot; distR=&quot;114300&quot; distT=&quot;0&quot; layoutInCell=&quot;true&quot; locked=&quot;false&quot; relativeHeight=&quot;251659264&quot; simplePos=&quot;false&quot; wp14:anchorId=&quot;38EE224C&quot; wp14:editId=&quot;22A688FD&quot;&gt;\n                        &lt;wp:simplePos x=&quot;0&quot; y=&quot;0&quot;/&gt;\n                        &lt;wp:positionH relativeFrom=&quot;column&quot;&gt;\n                            &lt;wp:posOffset&gt;2468880&lt;/wp:posOffset&gt;\n                        &lt;/wp:positionH&gt;\n                        &lt;wp:positionV relativeFrom=&quot;page&quot;&gt;\n                            &lt;wp:posOffset&gt;5318760&lt;/wp:posOffset&gt;\n                        &lt;/wp:positionV&gt;\n                        &lt;wp:extent cx=&quot;2856865&quot; cy=&quot;1866265&quot;/&gt;\n                        &lt;wp:effectExtent b=&quot;635&quot; l=&quot;0&quot; r=&quot;635&quot; t=&quot;0&quot;/&gt;\n                        &lt;wp:wrapNone/&gt;\n                        &lt;wp:docPr id=&quot;149166829&quot; name=&quot;Picture 1&quot;/&gt;\n                        &lt;wp:cNvGraphicFramePr&gt;\n                            &lt;a:graphicFrameLocks xmlns:a=&quot;http://schemas.openxmlformats.org/drawingml/2006/main&quot; noChangeAspect=&quot;true&quot;/&gt;\n                        &lt;/wp:cNvGraphicFramePr&gt;\n                        &lt;a:graphic xmlns:a=&quot;http://schemas.openxmlformats.org/drawingml/2006/main&quot;&gt;\n                            &lt;a:graphicData uri=&quot;http://schemas.openxmlformats.org/drawingml/2006/picture&quot;&gt;\n                                &lt;pic:pic xmlns:pic=&quot;http://schemas.openxmlformats.org/drawingml/2006/picture&quot;&gt;\n                                    &lt;pic:nvPicPr&gt;\n                                        &lt;pic:cNvPr id=&quot;149166829&quot; name=&quot;&quot;/&gt;\n                                        &lt;pic:cNvPicPr/&gt;\n                                    &lt;/pic:nvPicPr&gt;\n                                    &lt;pic:blipFill&gt;\n                                        &lt;a:blip xmlns:r=&quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships&quot; r:embed=&quot;rId4&quot;&gt;\n                                            &lt;a:extLst&gt;\n                                                &lt;a:ext uri=&quot;{28A0092B-C50C-407E-A947-70E740481C1C}&quot;&gt;\n                                                    &lt;a14:useLocalDpi xmlns:a14=&quot;http://schemas.microsoft.com/office/drawing/2010/main&quot; val=&quot;false&quot;/&gt;\n                                                &lt;/a:ext&gt;\n                                            &lt;/a:extLst&gt;\n                                        &lt;/a:blip&gt;\n                                        &lt;a:stretch&gt;\n                                            &lt;a:fillRect/&gt;\n                                        &lt;/a:stretch&gt;\n                                    &lt;/pic:blipFill&gt;\n                                    &lt;pic:spPr&gt;\n                                        &lt;a:xfrm&gt;\n                                            &lt;a:off x=&quot;0&quot; y=&quot;0&quot;/&gt;\n                                            &lt;a:ext cx=&quot;2856865&quot; cy=&quot;1866265&quot;/&gt;\n                                        &lt;/a:xfrm&gt;\n                                        &lt;a:prstGeom prst=&quot;rect&quot;&gt;\n                                            &lt;a:avLst/&gt;\n                                        &lt;/a:prstGeom&gt;\n                                    &lt;/pic:spPr&gt;\n                                &lt;/pic:pic&gt;\n                            &lt;/a:graphicData&gt;\n                        &lt;/a:graphic&gt;\n                    &lt;/wp:anchor&gt;\n                &lt;/w:drawing&gt;\n            &lt;/w:r&gt;\n        &lt;/w:p&gt;\n</code></pre>\n<p>so you are correct to try to try to use wp:anchor.</p>\n<p>But you are missing a:blip/@r:embed.  This is critical; it specifies the image part relId.</p>\n<p>You can get the relId with imagePart.getSourceRelationships().get(0).getId()</p>\n<p>We should add in BinaryPartAbstractImage a method createImageAnchor.</p>\n<p>In the meantime, some sample code for the wp:anchor:</p>\n<pre><code>                // Create object for drawing (wrapped in JAXBElement) \n                Drawing drawing = wmlObjectFactory.createDrawing(); \n                JAXBElement&lt;org.docx4j.wml.Drawing&gt; drawingWrapped = wmlObjectFactory.createRDrawing(drawing); \n                r.getContent().add( drawingWrapped); \norg.docx4j.dml.wordprocessingDrawing.ObjectFactory dmlwordprocessingDrawingObjectFactory = new org.docx4j.dml.wordprocessingDrawing.ObjectFactory();\n                    // Create object for anchor\n                    Anchor anchor = dmlwordprocessingDrawingObjectFactory.createAnchor(); \n                    drawing.getAnchorOrInline().add( anchor); \norg.docx4j.dml.ObjectFactory dmlObjectFactory = new org.docx4j.dml.ObjectFactory();\n                        // Create object for simplePos\n                        CTPoint2D point2d = dmlObjectFactory.createCTPoint2D(); \n                        anchor.setSimplePos(point2d); \n                            point2d.setX( 0 );\n                            point2d.setY( 0 );\n                        // Create object for positionH\n                        CTPosH posh = dmlwordprocessingDrawingObjectFactory.createCTPosH(); \n                        anchor.setPositionH(posh); \n                            posh.setPosOffset( new Integer(2468880) );\n                            posh.setRelativeFrom(org.docx4j.dml.wordprocessingDrawing.STRelFromH.COLUMN);\n                        // Create object for positionV\n                        CTPosV posv = dmlwordprocessingDrawingObjectFactory.createCTPosV(); \n                        anchor.setPositionV(posv); \n                            posv.setPosOffset( new Integer(5318760) );\n                            posv.setRelativeFrom(org.docx4j.dml.wordprocessingDrawing.STRelFromV.PAGE);\n                        // Create object for extent\n                        CTPositiveSize2D positivesize2d = dmlObjectFactory.createCTPositiveSize2D(); \n                        anchor.setExtent(positivesize2d); \n                            positivesize2d.setCx( 2856865 );\n                            positivesize2d.setCy( 1866265 );\n                        // Create object for effectExtent\n                        CTEffectExtent effectextent = dmlwordprocessingDrawingObjectFactory.createCTEffectExtent(); \n                        anchor.setEffectExtent(effectextent); \n                            effectextent.setL( 0 );\n                            effectextent.setT( 0 );\n                            effectextent.setR( 635 );\n                            effectextent.setB( 635 );\n                        // Create object for wrapNone\n                        CTWrapNone wrapnone = dmlwordprocessingDrawingObjectFactory.createCTWrapNone(); \n                        anchor.setWrapNone(wrapnone); \n                        // Create object for docPr\n                        CTNonVisualDrawingProps nonvisualdrawingprops = dmlObjectFactory.createCTNonVisualDrawingProps(); \n                        anchor.setDocPr(nonvisualdrawingprops); \n                            nonvisualdrawingprops.setId( 149166829 );\n                            nonvisualdrawingprops.setName( &quot;Picture 1&quot;); \n                            nonvisualdrawingprops.setDescr( &quot;&quot;); \n                        // Create object for cNvGraphicFramePr\n                        CTNonVisualGraphicFrameProperties nonvisualgraphicframeproperties = dmlObjectFactory.createCTNonVisualGraphicFrameProperties(); \n                        anchor.setCNvGraphicFramePr(nonvisualgraphicframeproperties); \n                            // Create object for graphicFrameLocks\n                            CTGraphicalObjectFrameLocking graphicalobjectframelocking = dmlObjectFactory.createCTGraphicalObjectFrameLocking(); \n                            nonvisualgraphicframeproperties.setGraphicFrameLocks(graphicalobjectframelocking); \n                        // Create object for graphic\n                        Graphic graphic = dmlObjectFactory.createGraphic(); \n                        anchor.setGraphic(graphic); \n                            // Create object for graphicData\n                            GraphicData graphicdata = dmlObjectFactory.createGraphicData(); \n                            graphic.setGraphicData(graphicdata); \norg.docx4j.dml.picture.ObjectFactory dmlpictureObjectFactory = new org.docx4j.dml.picture.ObjectFactory();\n                                // Create object for pic (wrapped in JAXBElement) \n                                Pic pic = dmlpictureObjectFactory.createPic(); \n                                JAXBElement&lt;org.docx4j.dml.picture.Pic&gt; picWrapped = dmlpictureObjectFactory.createPic(pic); \n                                graphicdata.getAny().add( picWrapped); \n                                    // Create object for nvPicPr\n                                    CTPictureNonVisual picturenonvisual = dmlpictureObjectFactory.createCTPictureNonVisual(); \n                                    pic.setNvPicPr(picturenonvisual); \n                                        // Create object for cNvPr\n                                        CTNonVisualDrawingProps nonvisualdrawingprops2 = dmlObjectFactory.createCTNonVisualDrawingProps(); \n                                        picturenonvisual.setCNvPr(nonvisualdrawingprops2); \n                                            nonvisualdrawingprops2.setId( 149166829 );\n                                            nonvisualdrawingprops2.setName( &quot;&quot;); \n                                            nonvisualdrawingprops2.setDescr( &quot;&quot;); \n                                        // Create object for cNvPicPr\n                                        CTNonVisualPictureProperties nonvisualpictureproperties = dmlObjectFactory.createCTNonVisualPictureProperties(); \n                                        picturenonvisual.setCNvPicPr(nonvisualpictureproperties); \n                                    // Create object for blipFill\n                                    CTBlipFillProperties blipfillproperties = dmlObjectFactory.createCTBlipFillProperties(); \n                                    pic.setBlipFill(blipfillproperties); \n                                        // Create object for blip\n                                        CTBlip blip = dmlObjectFactory.createCTBlip(); \n                                        blipfillproperties.setBlip(blip); \n                                            // Create object for extLst\n                                            CTOfficeArtExtensionList officeartextensionlist = dmlObjectFactory.createCTOfficeArtExtensionList(); \n                                            blip.setExtLst(officeartextensionlist); \n                                                // Create object for ext\n                                                CTOfficeArtExtension officeartextension = dmlObjectFactory.createCTOfficeArtExtension(); \n                                                officeartextensionlist.getExt().add( officeartextension); \n                                                    officeartextension.setUri( &quot;{28A0092B-C50C-407E-A947-70E740481C1C}&quot;); \n                                            blip.setCstate(org.docx4j.dml.STBlipCompression.NONE);\n                                            blip.setEmbed( &quot;rId4&quot;); \n                                            blip.setLink( &quot;&quot;); \n                                        // Create object for stretch\n                                        CTStretchInfoProperties stretchinfoproperties = dmlObjectFactory.createCTStretchInfoProperties(); \n                                        blipfillproperties.setStretch(stretchinfoproperties); \n                                            // Create object for fillRect\n                                            CTRelativeRect relativerect = dmlObjectFactory.createCTRelativeRect(); \n                                            stretchinfoproperties.setFillRect(relativerect); \n                                                relativerect.setL( new Integer(0) );\n                                                relativerect.setT( new Integer(0) );\n                                                relativerect.setR( new Integer(0) );\n                                                relativerect.setB( new Integer(0) );\n                                    // Create object for spPr\n                                    CTShapeProperties shapeproperties = dmlObjectFactory.createCTShapeProperties(); \n                                    pic.setSpPr(shapeproperties); \n                                        // Create object for xfrm\n                                        CTTransform2D transform2d = dmlObjectFactory.createCTTransform2D(); \n                                        shapeproperties.setXfrm(transform2d); \n                                            // Create object for off\n                                            CTPoint2D point2d2 = dmlObjectFactory.createCTPoint2D(); \n                                            transform2d.setOff(point2d2); \n                                                point2d2.setX( 0 );\n                                                point2d2.setY( 0 );\n                                            // Create object for ext\n                                            CTPositiveSize2D positivesize2d2 = dmlObjectFactory.createCTPositiveSize2D(); \n                                            transform2d.setExt(positivesize2d2); \n                                                positivesize2d2.setCx( 2856865 );\n                                                positivesize2d2.setCy( 1866265 );\n                                            transform2d.setRot( new Integer(0) );\n                                        // Create object for prstGeom\n                                        CTPresetGeometry2D presetgeometry2d = dmlObjectFactory.createCTPresetGeometry2D(); \n                                        shapeproperties.setPrstGeom(presetgeometry2d); \n                                            // Create object for avLst\n                                            CTGeomGuideList geomguidelist = dmlObjectFactory.createCTGeomGuideList(); \n                                            presetgeometry2d.setAvLst(geomguidelist); \n                                            presetgeometry2d.setPrst(org.docx4j.dml.STShapeType.RECT);\n                                graphicdata.setUri( &quot;http://schemas.openxmlformats.org/drawingml/2006/picture&quot;); \n                        anchor.setDistT( new Long(0) );\n                        anchor.setDistB( new Long(0) );\n                        anchor.setDistL( new Long(114300) );\n                        anchor.setDistR( new Long(114300) );\n                        anchor.setRelativeHeight( 251659264 );\n                        anchor.setAnchorId( new byte[] {(byte)0x38, (byte)0xEE, (byte)0x22, (byte)0x4C} ); //38EE224C\n                        anchor.setEditId( new byte[] {(byte)0x22, (byte)0xA6, (byte)0x88, (byte)0xFD} ); //22A688FD\n\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 30580,
      "reputation" : 15934,
      "user_id" : 1031689,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/8b46683bbe93f7520ebfe3c1c3f454c1?s=256&d=identicon&r=PG",
      "display_name" : "JasonPlutext",
      "link" : "https://stackoverflow.com/users/1031689/jasonplutext"
    },
    "creation_date" : 1758957654,
    "last_activity_date" : 1758957654,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140763243,
    "post_id" : 79774357,
    "body" : "Your comment about Tbl class and bookmarks should be made into a separate question.",
    "score" : 0,
    "owner" : {
      "account_id" : 30580,
      "reputation" : 15934,
      "user_id" : 1031689,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/8b46683bbe93f7520ebfe3c1c3f454c1?s=256&d=identicon&r=PG",
      "display_name" : "JasonPlutext",
      "link" : "https://stackoverflow.com/users/1031689/jasonplutext"
    },
    "creation_date" : 1758957721,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}