{
  "question" : {
    "question_id" : 79624766,
    "title" : "Deserialize numbers strictly in Gson",
    "body" : "<p>I want to make Gson deserializing numbers strictly, for example when Gson receives <code>&quot;123&quot;</code> and needs to deserialize it to <code>Int</code>, it must throw an exception and not automatically convert the string to number.</p>\n<p><strong>The goal</strong>:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>val str1 = &quot;&quot;&quot;{&quot;key&quot;:&quot;123&quot;}&quot;&quot;&quot;\nGson().fromJson(str1, intMapType) // throws an Exception\n\nval str2 = &quot;&quot;&quot;{&quot;key&quot;:123}&quot;&quot;&quot;\nGson().fromJson(str2, intMapType) // returns valid Map&lt;String, Int&gt;\n</code></pre>\n<hr />\n<p><strong>I have already tried</strong> to register cursom type adapters for <code>Int</code> and <code>String</code>:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>    private class StrictIntDeserializer : JsonDeserializer&lt;Int&gt; {\n        override fun deserialize(json: JsonElement, typeOfT: Type, context: JsonDeserializationContext): Int {\n            if (!json.isJsonPrimitive || !json.asJsonPrimitive.isNumber) {\n                throw JsonParseException(&quot;Expected Int but got: $json&quot;)\n            }\n            return json.asInt\n        }\n    }\n\n    private class StrictStringDeserializer : JsonDeserializer&lt;String&gt; {\n        override fun deserialize(json: JsonElement, typeOfT: Type, context: JsonDeserializationContext): String {\n            if (!json.isJsonPrimitive || !json.asJsonPrimitive.isString) {\n                throw JsonParseException(&quot;Expected String but got: $json&quot;)\n            }\n            return json.asString\n        }\n    }\n\n\n    private val gson = GsonBuilder()\n        .registerTypeHierarchyAdapter(Int::class.java, StrictIntDeserializer())\n        .registerTypeHierarchyAdapter(String::class.java, StrictStringDeserializer())\n        .create()\n</code></pre>\n<p>But this does not work.</p>\n",
    "tags" : [ "java", "kotlin", "gson" ],
    "owner" : {
      "account_id" : 38388126,
      "reputation" : 61,
      "user_id" : 28748656,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ed55bdfa51ce11b47dcbdb3818be5504?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "likespro",
      "link" : "https://stackoverflow.com/users/28748656/likespro"
    },
    "is_answered" : true,
    "view_count" : 114,
    "answer_count" : 2,
    "score" : 3,
    "last_activity_date" : 1747395490,
    "creation_date" : 1747383605,
    "link" : "https://stackoverflow.com/questions/79624766/deserialize-numbers-strictly-in-gson",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79625089,
    "question_id" : 79624766,
    "body" : "<p>The problem was that <em>Gson</em> is a <strong>Java</strong> library and all the types it uses are Java primitives, not Kotlin (e.g. Kotlin's <code>Int</code> = Java's <code>java.lang.Integer</code>). So it was necessary to register adapters specifically for the Java equivalents of Kotlin classes:</p>\n<p><strong>Instead of</strong></p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>.registerTypeHierarchyAdapter(Int::class.java, StrictIntDeserializer())\n</code></pre>\n<p><strong>we need</strong></p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>.registerTypeHierarchyAdapter(java.lang.Integer::class.java, StrictIntDeserializer())\n</code></pre>\n<p>Otherwise Gson simply never accesses this adapter.</p>\n",
    "score" : 3,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 38388126,
      "reputation" : 61,
      "user_id" : 28748656,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ed55bdfa51ce11b47dcbdb3818be5504?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "likespro",
      "link" : "https://stackoverflow.com/users/28748656/likespro"
    },
    "creation_date" : 1747395490,
    "last_activity_date" : 1747395490,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79624962,
    "question_id" : 79624766,
    "body" : "<p>In Java:</p>\n<pre><code>Gson gson = new GsonBuilder().registerTypeHierarchyAdapter(Integer.class, new StrictStringDeserializer())\n.create();\n\n//below line will tell gson that all incoming object would me a map with key as string and value as Ineteger for any json - this one is important so gsonn will aply our custom JsonDeserializer to our Map class instead of using default one\n\n final Type type = new TypeToken&lt;Map&lt;String, Integer&gt;&gt;() {}.getType();\n\n String str1 =\n                   &quot;&quot;&quot;\n                   {&quot;key&quot;: 123}\n                   &quot;&quot;&quot;;\n        Map map = gson.fromJson(str1, type); \n\npublic class StrictStringDeserializer implements JsonDeserializer&lt;Integer&gt; {\n    @Override\n    public Integer deserialize(JsonElement jsonElement, Type type, JsonDeserializationContext jsonDeserializationContext) throws JsonParseException {\n       if (jsonElement.toString().startsWith(&quot;\\&quot;&quot;)) {\n           throw new JsonParseException(&quot;bad&quot;);\n       }\n        return jsonElement.getAsInt();\n    }\n}\n\n// Cheers! )\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 3689669,
      "reputation" : 94,
      "user_id" : 3072571,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/b3b66de4aa769fe99e396cf72b59fcc3?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "user3072571",
      "link" : "https://stackoverflow.com/users/3072571/user3072571"
    },
    "creation_date" : 1747390380,
    "last_activity_date" : 1747390380,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79625089" : [ {
      "comment_id" : 140441838,
      "post_id" : 79625089,
      "body" : "@user3072571 Yes, in Java it works so as you wrote, but I`m working with Kotlin code. I thought it does not impact on the solution whether to use Kotlin or Java. But it does. The accepted answer is working correctly in Kotlin version and solves &quot;The Goal&quot; in the question - which is written in Kotlin.",
      "score" : 0,
      "owner" : {
        "account_id" : 38388126,
        "reputation" : 61,
        "user_id" : 28748656,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/ed55bdfa51ce11b47dcbdb3818be5504?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "likespro",
        "link" : "https://stackoverflow.com/users/28748656/likespro"
      },
      "creation_date" : 1747729521,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140439248,
      "post_id" : 79625089,
      "body" : "It&#39;s kind strange. My answer completelly works and do what is asked.  When i tested &quot;accpeted&quot; answer - it did&#39;t work at least in java and &quot;123&quot; passed as 123 into the Map. So.... Issue with code is: !json.isJsonPrimitive || !json.asJsonPrimitive.isNumber - after you call aJsonPrimitive conversion is already happens, so you lost String and got int at this point",
      "score" : 0,
      "owner" : {
        "account_id" : 3689669,
        "reputation" : 94,
        "user_id" : 3072571,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/b3b66de4aa769fe99e396cf72b59fcc3?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "user3072571",
        "link" : "https://stackoverflow.com/users/3072571/user3072571"
      },
      "creation_date" : 1747659313,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}