{
  "question" : {
    "question_id" : 79588728,
    "title" : "Wildcard address with fully-qualified-queue-name",
    "body" : "<p>I am using Apache ActiveMQ Artemis 2.39.0 in an application that needs to process messages broadcast on a collection of topics with the same logic. Multiple instances of this application can be running, but only one instance of the application should do the processing. Other applications need to be able to subscribe to the topics so they can't just be queues.</p>\n<p>To accomplish this I have created an Apache Camel route which utilizes a wildcard address with a fully-qualified-queue-name. Since all instances should consume from this backing queue only one instance should actually process the message.</p>\n<p>The route source is specified in camel using the following URI:</p>\n<pre><code>jms:queue:application.event.#::application.process.event\n</code></pre>\n<p>The desired behavior is for the Camel route to consume any message on any topic that begins with <code>application.event</code>, but that is not happening. A message sent to <code>application.event.shutdown</code> is not received in the Camel route. Setting the source URI to instead be <code>jms:queue:application.event.shutdown</code> results in the message being received, so it's not a problem on the publishing side. Using a subscriber queue to subscribe to a single topic also seems to work <code>jms:queue:application.event.shutdown::application.process.event</code></p>\n<p>What could be going wrong here? Is there another way for me to guarantee that a message published to a collection of topics will only be processed by one instance of this application? Am I misconfiguring something?</p>\n<p>I have both <code>org:apache.activemq:activemq-client:6.16</code> and <code>org.apache.activemq:artemis-core-client:2.40.0</code> on my classpath.</p>\n",
    "tags" : [ "java", "apache-camel", "activemq-artemis" ],
    "owner" : {
      "account_id" : 21214520,
      "reputation" : 33,
      "user_id" : 15602394,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-CV96HxvAHtg/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucl5E7NoLiMbz6SDGMYdu_SMms87-g/s96-c/s256-rj/photo.jpg",
      "display_name" : "Apion",
      "link" : "https://stackoverflow.com/users/15602394/apion"
    },
    "is_answered" : true,
    "view_count" : 143,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1745857789,
    "creation_date" : 1745415106,
    "link" : "https://stackoverflow.com/questions/79588728/wildcard-address-with-fully-qualified-queue-name",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79588913,
    "question_id" : 79588728,
    "body" : "<p>I just set up a quick proof-of-concept and everything is working as expected. Here's what I did:</p>\n<ol>\n<li>Create and start a fresh instance of ActiveMQ Artemis 2.40.0:\n<pre><code>$ ./artemis create wildcardAddressPlusFQQN\nCreating ActiveMQ Artemis instance at: /path/to/apache-artemis-2.40.0/bin/wildcardAddressPlusFQQN\n...\n$ cd wildcardAddressPlusFQQN/bin/\n$ ./artemis run\n     _        _               _\n    / \\  ____| |_  ___ __  __(_) _____\n   / _ \\|  _ \\ __|/ _ \\  \\/  | |/  __/\n  / ___ \\ | \\/ |_/  __/ |\\/| | |\\___ \\\n /_/   \\_\\|   \\__\\____|_|  |_|_|/___ /\n Apache ActiveMQ Artemis 2.40.0\n\n\n2025-04-23 09:38:07,142 INFO  [org.apache.activemq.artemis.integration.bootstrap] AMQ101000: Starting ActiveMQ Artemis Server version 2.40.0\n2025-04-23 09:38:07,191 INFO  [org.apache.activemq.artemis.core.server] AMQ221000: Primary message broker is starting with configuration Broker Configuration (clustered=false,journalDirectory=data/journal,bindingsDirectory=data/bindings,largeMessagesDirectory=data/large-messages,pagingDirectory=data/paging)\n2025-04-23 09:38:07,208 INFO  [org.apache.activemq.artemis.core.server] AMQ221012: Using AIO Journal\n2025-04-23 09:38:07,236 INFO  [org.apache.activemq.artemis.core.server] AMQ221057: Global Max Size is being adjusted to 1/2 of the JVM max size (-Xmx). being defined as 1073741824\n2025-04-23 09:38:07,250 INFO  [org.apache.activemq.artemis.core.server] AMQ221043: Protocol module found: [artemis-server]. Adding protocol support for: CORE\n2025-04-23 09:38:07,250 INFO  [org.apache.activemq.artemis.core.server] AMQ221043: Protocol module found: [artemis-amqp-protocol]. Adding protocol support for: AMQP\n2025-04-23 09:38:07,250 INFO  [org.apache.activemq.artemis.core.server] AMQ221043: Protocol module found: [artemis-hornetq-protocol]. Adding protocol support for: HORNETQ\n2025-04-23 09:38:07,250 INFO  [org.apache.activemq.artemis.core.server] AMQ221043: Protocol module found: [artemis-mqtt-protocol]. Adding protocol support for: MQTT\n2025-04-23 09:38:07,251 INFO  [org.apache.activemq.artemis.core.server] AMQ221043: Protocol module found: [artemis-openwire-protocol]. Adding protocol support for: OPENWIRE\n2025-04-23 09:38:07,251 INFO  [org.apache.activemq.artemis.core.server] AMQ221043: Protocol module found: [artemis-stomp-protocol]. Adding protocol support for: STOMP\n2025-04-23 09:38:07,277 INFO  [org.apache.activemq.artemis.core.server] AMQ221034: Waiting indefinitely to obtain primary lock\n2025-04-23 09:38:07,277 INFO  [org.apache.activemq.artemis.core.server] AMQ221035: Primary Server Obtained primary lock\n2025-04-23 09:38:07,332 INFO  [org.apache.activemq.artemis.core.server] AMQ221080: Deploying address DLQ supporting [ANYCAST]\n2025-04-23 09:38:07,341 INFO  [org.apache.activemq.artemis.core.server] AMQ221003: Deploying ANYCAST queue DLQ on address DLQ\n2025-04-23 09:38:07,369 INFO  [org.apache.activemq.artemis.core.server] AMQ221080: Deploying address ExpiryQueue supporting [ANYCAST]\n2025-04-23 09:38:07,370 INFO  [org.apache.activemq.artemis.core.server] AMQ221003: Deploying ANYCAST queue ExpiryQueue on address ExpiryQueue\n2025-04-23 09:38:07,621 INFO  [org.apache.activemq.artemis.core.server] AMQ221020: Started EPOLL Acceptor at 0.0.0.0:61616 for protocols [CORE,MQTT,AMQP,STOMP,HORNETQ,OPENWIRE]\n2025-04-23 09:38:07,629 INFO  [org.apache.activemq.artemis.core.server] AMQ221020: Started EPOLL Acceptor at 0.0.0.0:5445 for protocols [HORNETQ,STOMP]\n2025-04-23 09:38:07,649 INFO  [org.apache.activemq.artemis.core.server] AMQ221020: Started EPOLL Acceptor at 0.0.0.0:5672 for protocols [AMQP]\n2025-04-23 09:38:07,652 INFO  [org.apache.activemq.artemis.core.server] AMQ221020: Started EPOLL Acceptor at 0.0.0.0:1883 for protocols [MQTT]\n2025-04-23 09:38:07,655 INFO  [org.apache.activemq.artemis.core.server] AMQ221020: Started EPOLL Acceptor at 0.0.0.0:61613 for protocols [STOMP]\n2025-04-23 09:38:07,661 INFO  [org.apache.activemq.artemis.core.server] AMQ221007: Server is now active\n2025-04-23 09:38:07,661 INFO  [org.apache.activemq.artemis.core.server] AMQ221001: Apache ActiveMQ Artemis Message Broker version 2.40.0 [0.0.0.0, nodeID=9242f73d-2050-11f0-bdca-f2f325b5d46a] \n2025-04-23 09:38:07,665 INFO  [org.apache.activemq.artemis] AMQ241003: Starting embedded web server\n2025-04-23 09:38:07,896 INFO  [io.hawt.HawtioContextListener] Initialising Hawtio services\n2025-04-23 09:38:07,900 INFO  [io.hawt.jmx.JmxTreeWatcher] Welcome to Hawtio 4.2.0\n2025-04-23 09:38:07,903 INFO  [io.hawt.web.auth.AuthenticationConfiguration] Authentication throttling is enabled\n2025-04-23 09:38:07,915 INFO  [io.hawt.web.auth.AuthenticationConfiguration] Starting Hawtio authentication filter, JAAS realm: &quot;activemq&quot; authorized role(s): &quot;amq&quot; role principal classes: &quot;org.apache.activemq.artemis.spi.core.security.jaas.RolePrincipal&quot;\n2025-04-23 09:38:07,915 INFO  [io.hawt.web.auth.AuthenticationConfiguration] Looking for OIDC configuration file in: /path/to/apache-artemis-2.40.0/bin/wildcardAddressPlusFQQN/etc/hawtio-oidc.properties\n2025-04-23 09:38:07,935 INFO  [io.hawt.web.auth.ClientRouteRedirectFilter] Hawtio ClientRouteRedirectFilter is using 1800 sec. HttpSession timeout\n2025-04-23 09:38:07,956 INFO  [org.apache.activemq.artemis] AMQ241001: HTTP Server started at http://localhost:8161\n2025-04-23 09:38:07,956 INFO  [org.apache.activemq.artemis] AMQ241002: Artemis Jolokia REST API available at http://localhost:8161/console/jolokia\n2025-04-23 09:38:07,956 INFO  [org.apache.activemq.artemis] AMQ241004: Artemis Console available at http://localhost:8161/console\n</code></pre>\n</li>\n<li>Create a consumer using a wildcard address and FQQN:\n<pre><code>$ ./artemis consumer --destination topic://application.event.#::application.process.event\nConnection brokerURL = tcp://localhost:61616\nConsumer:: filter = null\nConsumer ActiveMQTopic[application.event.#::application.process.event], thread=0 wait 3000ms until 1000 messages are consumed\n</code></pre>\n</li>\n<li>Send messages to a JMS topic that matches the wildcard:\n<pre><code>$ ./artemis producer --destination topic://application.event.shutdown\nConnection brokerURL = tcp://localhost:61616\nProducer ActiveMQTopic[application.event.shutdown], thread=0 Started to calculate elapsed time ...\n\nProducer ActiveMQTopic[application.event.shutdown], thread=0 Produced: 1000 messages\nProducer ActiveMQTopic[application.event.shutdown], thread=0 Elapsed time in second : 1 s\nProducer ActiveMQTopic[application.event.shutdown], thread=0 Elapsed time in milli second : 1999 milli seconds\n</code></pre>\n</li>\n<li>Confirm that the consumer received the messages:\n<pre><code>Received 1000\nConsumer ActiveMQTopic[application.event.#::application.process.event], thread=0 Consumed: 1000 messages\nConsumer ActiveMQTopic[application.event.#::application.process.event], thread=0 Elapsed time in second : 27 s\nConsumer ActiveMQTopic[application.event.#::application.process.event], thread=0 Elapsed time in milli second : 27925 milli seconds\nConsumer ActiveMQTopic[application.event.#::application.process.event], thread=0 Consumed: 1000 messages\nConsumer ActiveMQTopic[application.event.#::application.process.event], thread=0 Consumer thread finished\n</code></pre>\n</li>\n</ol>\n<p>It's worth noting that my consumer was using <code>topic</code>, i.e.:</p>\n<pre><code>topic://application.event.#::application.process.event\n</code></pre>\n<p>If I use <code>queue</code> it doesn't work, i.e.:</p>\n<pre><code>queue://application.event.#::application.process.event\n</code></pre>\n<p>Therefore, I believe you should use this in your Camel route:</p>\n<pre><code>jms:topic:application.event.#::application.process.event\n</code></pre>\n<p>I also confirmed that multiple consumers on <code>topic://application.event.#::application.process.event</code> share the messages.</p>\n<p>Lastly, these tests using the ActiveMQ Artemis Core JMS client library. You should be using this same library in your environment.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 11434008,
      "reputation" : 36292,
      "user_id" : 8381946,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-ORs8fPNVzDU/AAAAAAAAAAI/AAAAAAAADBs/F3IsdsProVY/s256-rj/photo.jpg",
      "display_name" : "Justin Bertram",
      "link" : "https://stackoverflow.com/users/8381946/justin-bertram"
    },
    "creation_date" : 1745420273,
    "last_activity_date" : 1745426736,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79589086,
    "question_id" : 79588728,
    "body" : "<p>I believe the problem I was having was due to having two ActiveMQ client libraries on the class path, and I was using the wrong one. I have both <code>activemq-client:6.1.6</code> and <code>artemis-core-client:2.40.0</code>. I wrote the following snippet in the process of debugging.</p>\n<pre><code>\nimport jakarta.jms.JMSException;\nimport jakarta.jms.Message;\nimport jakarta.jms.MessageListener;\nimport org.apache.activemq.ActiveMQConnectionFactory;\nimport org.apache.activemq.command.ActiveMQTopic;\n\npublic static void main(String[] args) throws JMSException {\n        var connectionFactory = new ActiveMQConnectionFactory(&quot;tcp://localhost:61616&quot;, &quot;admin&quot;, &quot;admin&quot;);\n        var connection = connectionFactory.createConnection();\n        var session = connection.createSession();\n        var consumer = session.createConsumer(new ActiveMQTopic(&quot;application.event.#&quot;));\n        consumer.setMessageListener(new MessageListener() {\n            @Override\n            public void onMessage(Message message) {\n                System.out.println(&quot;Here&quot;);\n            }\n        });\n        connection.start();\n        var producer = session.createProducer(new ActiveMQTopic(&quot;application.event.send&quot;));\n        producer.send(session.createTextMessage(&quot;Hello!&quot;));\n    }\n</code></pre>\n<p>I would expect this to print &quot;Here&quot; especially after what Justin posted, proving it worked. However it didn't. I needed to swap to the proper imports</p>\n<pre><code>import org.apache.activemq.artemis.jms.client.ActiveMQConnectionFactory;\nimport org.apache.activemq.artemis.jms.client.ActiveMQTopic;\n</code></pre>\n<p>With only that change, the code executed as expected. I suspect this is the problem in the &quot;real&quot; code as well, but haven't confirmed yet</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 21214520,
      "reputation" : 33,
      "user_id" : 15602394,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-CV96HxvAHtg/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucl5E7NoLiMbz6SDGMYdu_SMms87-g/s96-c/s256-rj/photo.jpg",
      "display_name" : "Apion",
      "link" : "https://stackoverflow.com/users/15602394/apion"
    },
    "creation_date" : 1745426083,
    "last_activity_date" : 1745426810,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140362325,
    "post_id" : 79588728,
    "body" : "I have both <code>org:apache.activemq:activemq-client:6.16</code> and <code>org.apache.activemq:artemis-core-client:2.40.0</code>. I think this may have been the problem, I will explain in a response below",
    "score" : 0,
    "owner" : {
      "account_id" : 21214520,
      "reputation" : 33,
      "user_id" : 15602394,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-CV96HxvAHtg/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucl5E7NoLiMbz6SDGMYdu_SMms87-g/s96-c/s256-rj/photo.jpg",
      "display_name" : "Apion",
      "link" : "https://stackoverflow.com/users/15602394/apion"
    },
    "creation_date" : 1745425565,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140361968,
    "post_id" : 79588728,
    "body" : "<code>org.apache.camel:camel-jms:4.5.0</code> is the Camel library. I&#39;m asking about the JMS client library you&#39;re using to connect from Camel to ActiveMQ Artemis. JMS is just an API so you must have a client implementation somewhere on your classpath.",
    "score" : 0,
    "owner" : {
      "account_id" : 11434008,
      "reputation" : 36292,
      "user_id" : 8381946,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-ORs8fPNVzDU/AAAAAAAAAAI/AAAAAAAADBs/F3IsdsProVY/s256-rj/photo.jpg",
      "display_name" : "Justin Bertram",
      "link" : "https://stackoverflow.com/users/8381946/justin-bertram"
    },
    "creation_date" : 1745420723,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140361960,
    "post_id" : 79588728,
    "body" : "Thanks for the clarification on the terminology!  Client lib from Camel is <code>org.apache.camel:camel-jms:4.5.0</code>  Artemis version is 2.39.0",
    "score" : 0,
    "owner" : {
      "account_id" : 21214520,
      "reputation" : 33,
      "user_id" : 15602394,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-CV96HxvAHtg/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucl5E7NoLiMbz6SDGMYdu_SMms87-g/s96-c/s256-rj/photo.jpg",
      "display_name" : "Apion",
      "link" : "https://stackoverflow.com/users/15602394/apion"
    },
    "creation_date" : 1745420655,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140361859,
    "post_id" : 79588728,
    "body" : "What client library are you using from Camel?",
    "score" : 0,
    "owner" : {
      "account_id" : 11434008,
      "reputation" : 36292,
      "user_id" : 8381946,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-ORs8fPNVzDU/AAAAAAAAAAI/AAAAAAAADBs/F3IsdsProVY/s256-rj/photo.jpg",
      "display_name" : "Justin Bertram",
      "link" : "https://stackoverflow.com/users/8381946/justin-bertram"
    },
    "creation_date" : 1745419011,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140361855,
    "post_id" : 79588728,
    "body" : "Just to clarify terminology...You mention &quot;virtual topic&quot; a few times in your question, but ActiveMQ Artemis only supports &quot;virtual topic&quot; functionality for OpenWire clients migrating from ActiveMQ Classic which doesn&#39;t appear to be your use-case. From what I can tell you&#39;re simply combing a <a href=\"https://activemq.apache.org/components/artemis/documentation/latest/wildcard-routing.html#routing-messages-with-wild-cards\" rel=\"nofollow noreferrer\">wildcard address</a> with a <a href=\"https://activemq.apache.org/components/artemis/documentation/latest/address-model.html#fully-qualified-queue-names\" rel=\"nofollow noreferrer\">fully-qualified-queue-name (i.e. FQQN)</a>.",
    "score" : 0,
    "owner" : {
      "account_id" : 11434008,
      "reputation" : 36292,
      "user_id" : 8381946,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-ORs8fPNVzDU/AAAAAAAAAAI/AAAAAAAADBs/F3IsdsProVY/s256-rj/photo.jpg",
      "display_name" : "Justin Bertram",
      "link" : "https://stackoverflow.com/users/8381946/justin-bertram"
    },
    "creation_date" : 1745418991,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79589086" : [ {
      "comment_id" : 140362372,
      "post_id" : 79589086,
      "body" : "Also, the problem isn&#39;t technically that you have two JMS client implementations on the classpath. It&#39;s that you&#39;re using the wrong one (i.e. OpenWire vs. Core).",
      "score" : 0,
      "owner" : {
        "account_id" : 11434008,
        "reputation" : 36292,
        "user_id" : 8381946,
        "user_type" : "registered",
        "profile_image" : "https://lh3.googleusercontent.com/-ORs8fPNVzDU/AAAAAAAAAAI/AAAAAAAADBs/F3IsdsProVY/s256-rj/photo.jpg",
        "display_name" : "Justin Bertram",
        "link" : "https://stackoverflow.com/users/8381946/justin-bertram"
      },
      "creation_date" : 1745426661,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140362369,
      "post_id" : 79589086,
      "body" : "Ideally you&#39;d just use the JMS API and a JNDI look-up rather than reference implementation-specific classes in your code. Then you could have multiple client implementations on the classpath and switch between them with a simple config file update.",
      "score" : 0,
      "owner" : {
        "account_id" : 11434008,
        "reputation" : 36292,
        "user_id" : 8381946,
        "user_type" : "registered",
        "profile_image" : "https://lh3.googleusercontent.com/-ORs8fPNVzDU/AAAAAAAAAAI/AAAAAAAADBs/F3IsdsProVY/s256-rj/photo.jpg",
        "display_name" : "Justin Bertram",
        "link" : "https://stackoverflow.com/users/8381946/justin-bertram"
      },
      "creation_date" : 1745426577,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}