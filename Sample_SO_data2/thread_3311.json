{
  "question" : {
    "question_id" : 79560033,
    "title" : "No default password encoder configured",
    "body" : "<pre><code>@Configuration\n@EnableWebSecurity\n@Slf4j\npublic class SecurityConfig {\n\n    @Bean\n    public PasswordEncoder passwordEncoder()\n    {\n        return PasswordEncoderFactories.createDelegatingPasswordEncoder();\n    }\n\n    @Bean\n    public AuthenticationManager authenticationManage(UserDetailsService userDetailsService, PasswordEncoder passwordEncoder) throws Exception {\n        DaoAuthenticationProvider provider = new DaoAuthenticationProvider();\n        provider.setUserDetailsService(userDetailsService);\n        provider.setPasswordEncoder(passwordEncoder);\n        return new ProviderManager(provider);\n    }\n\n    @Bean\n    public JwtAuthenticationFilter jwtAuthenticationFilter(AuthenticationService authenticationService)\n    {\n        return new JwtAuthenticationFilter(authenticationService);\n    }\n\n    @Bean\n    public UserDetailsService userDetailsService(PasswordEncoder passwordEncoder, UserRepository userRepository)\n    {\n        BlogUserDetailsService userDetailsService = new BlogUserDetailsService(userRepository);\n        String email = &quot;user@gmail.com&quot;;\n        String encodedPassword = passwordEncoder.encode(&quot;password&quot;);\n        userRepository.findByEmail(email).orElseGet(() -&gt; {\n            User newUser = User.builder()\n                    .name(&quot;user&quot;)\n                    .email(email)\n                    .password(encodedPassword)\n                    .build();\n            return userRepository.save(newUser);\n        });\n        return userDetailsService;\n    }\n    @Bean\n    public SecurityFilterChain securityFilterChain(HttpSecurity http, JwtAuthenticationFilter jwtAuthenticationFilter) throws Exception\n    {\n        http\n                .authorizeHttpRequests(auth -&gt; auth\n                        .requestMatchers(HttpMethod.POST, &quot;/api/v1/auth/login&quot;).permitAll()\n                        .requestMatchers(HttpMethod.GET, &quot;/api/v1/categories/**&quot;).permitAll()\n                        .requestMatchers(HttpMethod.GET, &quot;/api/v1/posts/**&quot;).permitAll()\n                        .requestMatchers(HttpMethod.GET, &quot;/api/v1/tags/**&quot;).permitAll()\n                        .anyRequest().authenticated())\n                .addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class)\n                .csrf(AbstractHttpConfigurer::disable)\n                .sessionManagement(session -&gt; session.sessionCreationPolicy(SessionCreationPolicy.STATELESS));\n        return http.build();\n    }\n\n}\n</code></pre>\n<p>In above security config class, I have created password Encoder bean and also a default user in userDetailsService bean with encoded password. But, when i try to login with the default user email and password from &quot;Postman&quot;. I get &quot;Bad Request Error(400)&quot;, with error message that says the following:</p>\n<pre>\"Given that there is no default password encoder configured, each password must have a password encoding prefix. Please either prefix this password with '{noop}' or set a default password encoder in `DelegatingPasswordEncoder`.\"</pre>\n<p>Why?</p>\n",
    "tags" : [ "java", "spring-boot", "rest", "spring-security" ],
    "owner" : {
      "account_id" : 21685823,
      "reputation" : 17,
      "user_id" : 16001314,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/caf60dd7479777ef9c6b82b0fa364bf1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Shin Thant Maung",
      "link" : "https://stackoverflow.com/users/16001314/shin-thant-maung"
    },
    "is_answered" : false,
    "view_count" : 751,
    "answer_count" : 2,
    "score" : -1,
    "last_activity_date" : 1747204980,
    "creation_date" : 1744033303,
    "link" : "https://stackoverflow.com/questions/79560033/no-default-password-encoder-configured",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79575329,
    "question_id" : 79560033,
    "body" : "<p>The problem you are getting is because you are not being explicit about the PasswordEncoder algorithm to use. The method <strong>PasswordEncoderFactories.createDelegatingPasswordEncoder()</strong> is a special type of PasswordEncoder in Spring that delegates encoding and decoding of passwords to multiple PasswordEncoder implementations. It works by prefixing the password with the encoding algorithm for the password, e.g., {bcrypt}, {sha-256}, {noop}, etc.</p>\n<p>This is the cause of the error you are getting, as I assume you are not prefixing the passwords in Postman. As indicated by the error, Spring Security requires you to provide a default PasswordEncoder 'algorithm' to be used as a fallback because the password has no prefix. For example, you could do this:</p>\n<pre><code>@Bean\npublic PasswordEncoder passwordEncoder() {\n    DelegatingPasswordEncoder delegatingPasswordEncoder = \n        (DelegatingPasswordEncoder) PasswordEncoderFactories.createDelegatingPasswordEncoder();\n\n    // Set a default encoder (e.g., bcrypt)\n    delegatingPasswordEncoder.setDefaultPasswordEncoderForMatches(new BCryptPasswordEncoder());\n    \n    return delegatingPasswordEncoder;\n}\n</code></pre>\n<p>As a side note, developers prefer being explicit about which PasswordEncoder they intend to use. As such, you are likely to see a bean like this</p>\n<pre><code>@Bean\npublic PasswordEncoder passwordEncoder() { \n    return new BCryptPasswordEncoder(); // case bcrypt\n    // for plaintext passwords\n    // return NoopPasswordEncoder.getInstance();\n}\n</code></pre>\n<p>It goes without saying that you should not use {noop} unless for texting and development purposes. {noop} just compares plaintext strings without hashing and you don't want this in the database.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 23682579,
      "reputation" : 36,
      "user_id" : 17707948,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AATXAJwMb-z9i9o6LKxloOBCl6MFBsrDNkcO7vvcOoPY=k-s256",
      "display_name" : "harun wagura",
      "link" : "https://stackoverflow.com/users/17707948/harun-wagura"
    },
    "creation_date" : 1744725067,
    "last_activity_date" : 1744725067,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79620856,
    "question_id" : 79560033,
    "body" : "<p>To resolve the issue:</p>\n<p><em>Given that there is no default password encoder configured, each password must have a password encoding prefix. Please either prefix this password with '{noop}' or set a default password encoder in `DelegatingPasswordEncoder`.</em></p>\n<p>Once you retrieve the encoded password from the database, you must specify the encoder ID (idForEncode). In this example, we concatenate the <em>{bcrypt}</em> encoder to the password:</p>\n<pre><code>    @Override\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n        Optional&lt;User&gt; optUser = userRepository.findByUsername(username);\n        if(!optUser.isPresent()) {\n            throw new UsernameNotFoundException(String.format(&quot;The user %s does not exist&quot;, username));\n        }\n        \n        User user = optUser.orElseThrow();\n        \n        List&lt;GrantedAuthority&gt; authorities = user.getUserRoles().stream().map(role -&gt; new SimpleGrantedAuthority(role.getRole().getName()))\n                .collect(Collectors.toList());\n        \n        return new org.springframework.security.core.userdetails.User(username, \n                &quot;{bcrypt}&quot;+user.getPassword(), \n                user.isStatus(), \n                true, \n                true, \n                true, \n                authorities);\n    }\n</code></pre>\n<p>For more information, please visit the following <a href=\"https://docs.spring.io/spring-security/reference/api/java/org/springframework/security/crypto/password/DelegatingPasswordEncoder.html\" rel=\"nofollow noreferrer\">link</a>.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 41967625,
      "reputation" : 1,
      "user_id" : 30532750,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/181d385377b53cd9ea5a1d35144f38dd?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Fernando Ram&#237;rez Cipriano",
      "link" : "https://stackoverflow.com/users/30532750/fernando-ram%c3%adrez-cipriano"
    },
    "creation_date" : 1747204980,
    "last_activity_date" : 1747204980,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140308981,
    "post_id" : 79560033,
    "body" : "Yes as the delegating password encoder is the default. It will decode based on the configured algorithm as specified in the pwd. like <code>{noop}password</code> (no encoder) or <code>{bcrypt}&lt;somehash&gt;</code> for <code>bcrypt</code> (also the default). If you have no password anyway and just want to set a default configure the <code>BCryptPasswordEncoder</code>.",
    "score" : 1,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1744048873,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140308629,
    "post_id" : 79560033,
    "body" : "if i don&#39;t include passwordEncoder bean, will spring security still encode passwords in database.",
    "score" : 0,
    "owner" : {
      "account_id" : 21685823,
      "reputation" : 17,
      "user_id" : 16001314,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/caf60dd7479777ef9c6b82b0fa364bf1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Shin Thant Maung",
      "link" : "https://stackoverflow.com/users/16001314/shin-thant-maung"
    },
    "creation_date" : 1744042562,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140308076,
    "post_id" : 79560033,
    "body" : "Remove the <code>passwordEncoded</code> bean, you also don&#39;t need the <code>authenticationManager</code> either (unless you need it to be injected somewhere).",
    "score" : 1,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1744033946,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}