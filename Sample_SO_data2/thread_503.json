{
  "question" : {
    "question_id" : 79803876,
    "title" : "Java socket connection to GCP Cloud PostgreSQL - Service account authentication",
    "body" : "<p>We are trying to connect to the GCP PostgreSQL DB from our Java application using socket connections and service account for authentication.</p>\n<pre class=\"lang-java prettyprint-override\"><code>String dbUser = &quot;user@abc.iam.gserviceaccount.com&quot;;\nString dbPass = &quot;&quot;;\nString dbName = &quot;test&quot;;\nString instanceConnectionName = &quot;my-project:europe-west1:my-instance&quot;;\nString serviceAccountPath = &quot;/path/ords-labs-esb-sql-user-sa-key.json&quot;;\n\nString jdbcUrl =\n    String.format(&quot;jdbc:postgresql://google/&quot;\n                  + &quot;%s?cloudSqlInstance=%s&amp;socketFactory=com.google.cloud.sql.&quot;\n                  + &quot;postgres.SocketFactory&amp;useSSL=false&quot;,\n        dbName, instanceConnectionName);\n\n// Set the environment variable for authentication\nSystem.setProperty(&quot;GOOGLE_APPLICATION_CREDENTIALS&quot;, serviceAccountPath);\n\ntry {\n    Class.forName(&quot;org.postgresql.Driver&quot;);\n\n    Connection conn = DriverManager.getConnection(jdbcUrl, dbUser, dbPass);\n\n    debugLog(&quot;Connected to PostgreSQL on GCP successfully!&quot;);\n    // Perform DB operations here\n} catch (Exception e) {\n    debugLog(e.toString());\n}\n</code></pre>\n<p>We are getting this error:</p>\n<blockquote>\n<p>org.postgresql.util.PSQLException: Something unusual has occurred to cause the driver to fail. Please report this exception.</p>\n</blockquote>\n<p>We are using the below jars:</p>\n<p><a href=\"https://i.sstatic.net/53NmzSJH.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/53NmzSJH.jpg\" alt=\"enter image description here\" /></a></p>\n<p>We are not sure what is causing this error. The same call works if I use basic authentication. We had set up a temporary username/password user account in GCP PostGreSQL which works via this code.</p>\n",
    "tags" : [ "java", "postgresql", "sockets", "google-cloud-platform", "google-iam" ],
    "owner" : {
      "account_id" : 29292230,
      "reputation" : 41,
      "user_id" : 22442419,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/12542edcf3fbc50046ae5c176453e0f8?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Ragav J",
      "link" : "https://stackoverflow.com/users/22442419/ragav-j"
    },
    "is_answered" : false,
    "view_count" : 58,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1761749568,
    "creation_date" : 1761746526,
    "link" : "https://stackoverflow.com/questions/79803876/java-socket-connection-to-gcp-cloud-postgresql-service-account-authentication",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140831422,
    "post_id" : 79803876,
    "body" : "Please copy or type the list of jar files as text into the question. Reserve the use of images for diagrams or demonstrating rendering bugs, things that are impossible to describe accurately via text. Code or sample data in images can&#39;t be copied and pasted in order to search about a problem or reproduce it. For more details read the Meta FAQ entry <a href=\"https://meta.stackoverflow.com/questions/285551/why-should-i-not-upload-images-of-code-data-errors/285557#285557\">Why not upload images of code/errors when asking a question?</a>",
    "score" : 1,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1762029497,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}