{
  "question" : {
    "question_id" : 79555102,
    "title" : "Java Apache POI How to edit large excel file?",
    "body" : "<p>So I have no issues reading a large excel file that has over 100,000 records by doing this:</p>\n<pre><code>IOUtils.setByteArrayMaxOverride(1000000000);\n</code></pre>\n<p>My code to read the excel file:</p>\n<pre><code>try (FileInputStream fis = new FileInputStream(file);\n                 XSSFWorkbook wb = new XSSFWorkbook(fis)) {\nSXSSFWorkbook workbook = new SXSSFWorkbook(wb);\n</code></pre>\n<p>Then set edit some cell values....\nThen finally write it to the file:</p>\n<pre><code>try (FileOutputStream fileOut = new FileOutputStream(excelFilePath)) {\n                            workbook.write(fileOut);\n                        }\n</code></pre>\n<p>My issue is I'm getting this exception:</p>\n<blockquote>\n<p>Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: GC overhead\nlimit exceeded</p>\n</blockquote>\n<p>I've read the documentation here by Apache about using SXSSFWorkbook:</p>\n<blockquote>\n<p><a href=\"https://poi.apache.org/components/spreadsheet/how-to.html#sxssf\" rel=\"nofollow noreferrer\">https://poi.apache.org/components/spreadsheet/how-to.html#sxssf</a></p>\n</blockquote>\n<p>However the issue with this documentation is about writing to a new file, my issue is I want to edit an existing file that's large (over 100,000) records. What do I need to do to achieve this?</p>\n",
    "tags" : [ "java", "excel", "apache-poi" ],
    "owner" : {
      "account_id" : 15864043,
      "reputation" : 31,
      "user_id" : 11446450,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e7772423425e8ed6511dc01f31950ccd?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "junior",
      "link" : "https://stackoverflow.com/users/11446450/junior"
    },
    "is_answered" : true,
    "view_count" : 117,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1743780584,
    "creation_date" : 1743763658,
    "link" : "https://stackoverflow.com/questions/79555102/java-apache-poi-how-to-edit-large-excel-file",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79555513,
    "question_id" : 79555102,
    "body" : "<p>You are reading the whole stream into memory when you call <code>new XSSFWorkbook(fis)</code></p>\n<p>See <a href=\"https://poi.apache.org/apidocs/dev/org/apache/poi/xssf/usermodel/XSSFWorkbook.html#XSSFWorkbook-java.io.InputStream-\" rel=\"nofollow noreferrer\">XSSFWorkbook javadoc</a></p>\n<blockquote>\n<p>Constructs a XSSFWorkbook object, by buffering the whole stream into memory and then opening an OPCPackage object for it</p>\n</blockquote>\n<p><code>SXSSFWorkbook</code> is write only and doesn't support streaming reading.</p>\n<p>Is it possible to create a new <code>SXSSFWorkbook</code> from database rows instead of reading from a spreadsheet?</p>\n<p>If you need to read a large spreadsheet you might have to use the <a href=\"https://poi.apache.org/components/spreadsheet/how-to.html#xssf_sax_api\" rel=\"nofollow noreferrer\">XSSF SAX API</a>. This approach will require you to understand the low level xml rather than working with the &quot;nicer&quot; POI model.</p>\n<p>The underlying xml for a sheet looks something like</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;worksheet&gt;\n  &lt;sheetData&gt;\n    &lt;row r=&quot;1&quot;&gt;\n      &lt;c r=&quot;A1&quot;&gt;&lt;v&gt;1&lt;/v&gt;&lt;/c&gt;\n      &lt;c r=&quot;B1&quot;&gt;&lt;v&gt;2&lt;/v&gt;&lt;/c&gt;\n    &lt;/row&gt;\n    &lt;row r=&quot;2&quot;&gt;\n      &lt;c r=&quot;A2&quot;&gt;&lt;v&gt;3&lt;/v&gt;&lt;/c&gt;\n      &lt;c r=&quot;B2&quot;&gt;&lt;v&gt;4&lt;/v&gt;&lt;/c&gt;\n    &lt;/row&gt;\n  &lt;/sheetData&gt;\n&lt;worksheet&gt;\n</code></pre>\n<p>Perhaps you can come up with a SAX Handler to stream over the xml and write to a <code>SXSSFWorkbook</code>?</p>\n<p>If you want to see the underlying xml for a .xlsx file</p>\n<ol>\n<li>Rename a spreadsheet from *.xlsx to *.zip</li>\n<li>Open the zip file (eg in winzip)</li>\n<li>Inspect the sheet xml file(s) within the zip (eg open xl/sheet1.xml using a text editor)</li>\n</ol>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1096470,
      "reputation" : 29424,
      "user_id" : 1089967,
      "user_type" : "registered",
      "accept_rate" : 59,
      "profile_image" : "https://www.gravatar.com/avatar/1f256b904ff621d678598d8fa49f86c5?s=256&d=identicon&r=PG",
      "display_name" : "lance-java",
      "link" : "https://stackoverflow.com/users/1089967/lance-java"
    },
    "creation_date" : 1743774993,
    "last_activity_date" : 1743777081,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140301773,
    "post_id" : 79555102,
    "body" : "&quot;to edit an existing file that&#39;s large (over 100,000) records&quot;: Why is this an Excel file then? Excel is a spreadsheet calculation application. Excel is not a good data transfer format. Better data transfer formats currently are XML, JSON, CSV, in that order.",
    "score" : 1,
    "owner" : {
      "account_id" : 4853829,
      "reputation" : 62539,
      "user_id" : 3915431,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/27fffe0285cffa43de087072abd25c95?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Axel Richter",
      "link" : "https://stackoverflow.com/users/3915431/axel-richter"
    },
    "creation_date" : 1743833179,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79555513" : [ {
      "comment_id" : 140306736,
      "post_id" : 79555513,
      "body" : "SAX is a streaming API which fires events as it traverses the xml and never holds the whole model in memory. SXSSFWorkbook is a Workbook implementation that holds only a small rowset in memory at once, the rest is stored on disk as a temp file. So if you read using SAX and write using SXSSFWorkbook you can solve the problem without going OOM",
      "score" : 0,
      "owner" : {
        "account_id" : 1096470,
        "reputation" : 29424,
        "user_id" : 1089967,
        "user_type" : "registered",
        "accept_rate" : 59,
        "profile_image" : "https://www.gravatar.com/avatar/1f256b904ff621d678598d8fa49f86c5?s=256&d=identicon&r=PG",
        "display_name" : "lance-java",
        "link" : "https://stackoverflow.com/users/1089967/lance-java"
      },
      "creation_date" : 1744011818,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140306430,
      "post_id" : 79555513,
      "body" : "@lance-java: &quot;just reading the file into a model in memory, mutating the in memory model then writing the mutated model &quot;: That&#39;s exactly what <code>XSSF</code> is doing and what consumes the amount of memory. How do you think your approach will consuming less memory than <code>XSSF</code> does?",
      "score" : 0,
      "owner" : {
        "account_id" : 4853829,
        "reputation" : 62539,
        "user_id" : 3915431,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/27fffe0285cffa43de087072abd25c95?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Axel Richter",
        "link" : "https://stackoverflow.com/users/3915431/axel-richter"
      },
      "creation_date" : 1744004970,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140302740,
      "post_id" : 79555513,
      "body" : "Not sure I agree with this, &quot;edit an excel&quot; file with POI is just reading the file into a model in memory, mutating the in memory model then writing the mutated model to the original path. You could just as easily write to a totally different file. It&#39;s just as valid to read from xml via sax, create a new model from scratch then write the model to the original path. Personally I&#39;d prefer to see the data be transmitted using json or xml rather than xlsx",
      "score" : 0,
      "owner" : {
        "account_id" : 1096470,
        "reputation" : 29424,
        "user_id" : 1089967,
        "user_type" : "registered",
        "accept_rate" : 59,
        "profile_image" : "https://www.gravatar.com/avatar/1f256b904ff621d678598d8fa49f86c5?s=256&d=identicon&r=PG",
        "display_name" : "lance-java",
        "link" : "https://stackoverflow.com/users/1089967/lance-java"
      },
      "creation_date" : 1743868400,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140301763,
      "post_id" : 79555513,
      "body" : "This answer does not answer the question above. When using Apache POI only <code>XSSF</code> is able to &quot;<b>edit</b> an Excel file&quot;. XSSF and SAX (Event API) and all the straming Readers out there are reading only and <code>SXSSF</code> is writing only. But <b>edit</b> would mean reading and writing the same time. The approach to read all data first into something else (whatever), then change the data as needed and then write the data to a new Excel is not goal-oriented as the &quot;readers&quot; are not even able to read all the possible data. What about charts, pictures, special cell formats, ...?",
      "score" : 0,
      "owner" : {
        "account_id" : 4853829,
        "reputation" : 62539,
        "user_id" : 3915431,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/27fffe0285cffa43de087072abd25c95?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Axel Richter",
        "link" : "https://stackoverflow.com/users/3915431/axel-richter"
      },
      "creation_date" : 1743832443,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140300761,
      "post_id" : 79555513,
      "body" : "If you can convert it, you can export it to a csv file, then the reading of that file becomes much easier.",
      "score" : 0,
      "owner" : {
        "account_id" : 1601399,
        "reputation" : 638,
        "user_id" : 1482356,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/d6160b6e40d230fa92c6da8072b2f7e5?s=256&d=identicon&r=PG",
        "display_name" : "Peter Adrian",
        "link" : "https://stackoverflow.com/users/1482356/peter-adrian"
      },
      "creation_date" : 1743793103,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140300189,
      "post_id" : 79555513,
      "body" : "Looking at my sample spreadsheet it seems that most of the data is in xl/sharedStrings.xml. I&#39;m not sure how the sheetN.xml files make reference to these",
      "score" : 0,
      "owner" : {
        "account_id" : 1096470,
        "reputation" : 29424,
        "user_id" : 1089967,
        "user_type" : "registered",
        "accept_rate" : 59,
        "profile_image" : "https://www.gravatar.com/avatar/1f256b904ff621d678598d8fa49f86c5?s=256&d=identicon&r=PG",
        "display_name" : "lance-java",
        "link" : "https://stackoverflow.com/users/1089967/lance-java"
      },
      "creation_date" : 1743782972,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140300144,
      "post_id" : 79555513,
      "body" : "Hi, so I converted the excel file to XML but I had some values in the sheet like &quot;Sony Camera&quot; and &quot;10051452&quot; which I do not see at all on the xml file. It&#39;s looking a lot like this: &lt;c r=&quot;A2&quot; s=&quot;3&quot; t=&quot;s&quot;&gt;&lt;v&gt;31&lt;/v&gt;&lt;/c&gt;&lt;c r=&quot;B2&quot; s=&quot;3&quot; t=&quot;s&quot;&gt;&lt;v&gt;32&lt;/v&gt;&lt;/c&gt;&lt;c r=&quot;C2&quot; s=&quot;3&quot; t=&quot;s&quot;&gt;&lt;v&gt;33&lt;/v&gt; I&#39;m familiar with reading XML files but the actual values. What data type is the stuff within the &lt;v&gt; brackets? How am I supposed to convert that to the values I see in my spreadsheet?",
      "score" : 0,
      "owner" : {
        "account_id" : 15864043,
        "reputation" : 31,
        "user_id" : 11446450,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/e7772423425e8ed6511dc01f31950ccd?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "junior",
        "link" : "https://stackoverflow.com/users/11446450/junior"
      },
      "creation_date" : 1743782291,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}