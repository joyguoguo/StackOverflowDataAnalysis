{
  "question" : {
    "question_id" : 79670685,
    "title" : "(Not a) Bug in spring framework forward",
    "body" : "<p>I believe I've uncovered a bug in spring framework with the <code>forward:</code> notation. This is happening with XML based spring applications.</p>\n<p>I found this while upgrading my existing spring framework application from Spring 3 to Spring 6. I have created a project to reproduce.</p>\n<p>Starting with build.gradle</p>\n<pre><code>plugins {\n    id 'java'\n    id 'war'  // Add war plugin for web application\n}\n\ngroup = 'com.avenuinsights'\nversion = '1.0-SNAPSHOT'\n\nrepositories {\n    mavenCentral()\n}\n\ndependencies {\n    def springVersion = '6.2.7'\n    implementation &quot;org.springframework:spring-webmvc:${springVersion}&quot;\n    implementation &quot;org.springframework:spring-context:${springVersion}&quot;\n    implementation group: 'jakarta.servlet', name: 'jakarta.servlet-api', version: '6.1.0'\n    implementation group: 'jakarta.servlet.jsp', name: 'jakarta.servlet.jsp-api', version: '3.1.1'\n    implementation group: 'jakarta.servlet.jsp.jstl', name: 'jakarta.servlet.jsp.jstl-api', version: '3.0.2'\n    implementation group: 'org.glassfish.web', name: 'jakarta.servlet.jsp.jstl', version: '3.0.1'\n    testImplementation platform('org.junit:junit-bom:5.10.0')\n    testImplementation 'org.junit.jupiter:junit-jupiter'\n}\n\ntest {\n    useJUnitPlatform()\n}\n</code></pre>\n<p>The web.xml</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;\n         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n         xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;\n         version=&quot;4.0&quot;&gt;\n\n    &lt;!-- Configure the Spring DispatcherServlet --&gt;\n    &lt;servlet&gt;\n        &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;\n        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;\n        &lt;init-param&gt;\n            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;\n            &lt;param-value&gt;/WEB-INF/spring-mvc.xml&lt;/param-value&gt;\n        &lt;/init-param&gt;\n        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;\n    &lt;/servlet&gt;\n\n    &lt;!-- Map all requests to the DispatcherServlet --&gt;\n    &lt;servlet-mapping&gt;\n        &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;\n        &lt;url-pattern&gt;/&lt;/url-pattern&gt;\n    &lt;/servlet-mapping&gt;\n\n&lt;/web-app&gt;\n</code></pre>\n<p>and the spring-mvc.xml</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;\n       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n       xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;\n       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans\n       http://www.springframework.org/schema/beans/spring-beans.xsd\n       http://www.springframework.org/schema/mvc\n       http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;&gt;\n\n    &lt;!-- Enable Spring MVC features --&gt;\n    &lt;mvc:annotation-driven /&gt;\n\n    &lt;!-- Configure controllers as beans --&gt;\n    &lt;bean id=&quot;firstController&quot; class=&quot;org.example.forwardxml.controller.FirstController&quot; /&gt;\n    &lt;bean id=&quot;secondController&quot; class=&quot;org.example.forwardxml.controller.SecondController&quot; /&gt;\n    &lt;bean id=&quot;thirdController&quot; class=&quot;org.example.forwardxml.controller.ThirdController&quot; /&gt;\n\n    &lt;bean class=&quot;org.springframework.web.servlet.handler.SimpleUrlHandlerMapping&quot;&gt;\n        &lt;property name=&quot;mappings&quot;&gt;\n            &lt;value&gt;\n                /first=firstController\n                /second=secondController\n                /third=thirdController\n            &lt;/value&gt;\n        &lt;/property&gt;\n    &lt;/bean&gt;\n\n    &lt;!-- Define the View Resolver --&gt;\n    &lt;bean class=&quot;org.example.forwardxml.resolver.TranslatingViewResolver&quot;/&gt;\n\n    &lt;bean id=&quot;urlViewResolver&quot; class=&quot;org.springframework.web.servlet.view.UrlBasedViewResolver&quot;&gt;\n        &lt;property name=&quot;viewClass&quot; value=&quot;org.springframework.web.servlet.view.InternalResourceView&quot;/&gt;\n    &lt;/bean&gt;\n\n&lt;/beans&gt;\n</code></pre>\n<p>FirstController.java</p>\n<pre><code>public class FirstController extends AbstractController {\n\n    @Override\n    protected ModelAndView handleRequestInternal(HttpServletRequest request, HttpServletResponse response) throws Exception {\n        System.out.println(&quot;FirstController: Processing request...&quot;);\n        // Forward to the second controller\n        return new ModelAndView(&quot;second.one&quot;);\n    }\n}\n</code></pre>\n<p>SecondController.java</p>\n<pre><code>public class SecondController extends AbstractController {\n\n    @Override\n    protected ModelAndView handleRequestInternal(HttpServletRequest request, HttpServletResponse response) throws Exception {\n        System.out.println(&quot;SecondController: Processing request...&quot;);\n        // Forward to the third controller\n        return new ModelAndView(&quot;third.one&quot;);\n    }\n}\n</code></pre>\n<p>and ThirdController.java</p>\n<pre><code>public class ThirdController extends AbstractController {\n\n    @Override\n    protected ModelAndView handleRequestInternal(HttpServletRequest request, HttpServletResponse response) throws Exception {\n        System.out.println(&quot;ThirdController: Processing request...&quot;);\n\n        // Create a model and view to display &quot;Hello, World!&quot;\n        ModelAndView modelAndView = new ModelAndView();\n        modelAndView.setViewName(&quot;hello.view&quot;);\n        modelAndView.addObject(&quot;message&quot;, &quot;Hello, World!&quot;);\n\n        return modelAndView;\n    }\n}\n</code></pre>\n<p>and finally the TranslatingViewResolver.java</p>\n<pre><code>public class TranslatingViewResolver extends AbstractCachingViewResolver {\n    public static final String HELLO = &quot;hello.view&quot;;\n    public static final String SECOND = &quot;second.one&quot;;\n    public static final String THIRD = &quot;third.one&quot;;\n\n    @Override\n    protected View loadView(String viewName, Locale locale) throws Exception {\n        if (SECOND.equals(viewName)) {\n            // Forward to the second controller\n            return new InternalResourceView(&quot;forward:/second&quot;);\n        } else if (THIRD.equals(viewName)) {\n            // Forward to the third controller\n            return new InternalResourceView(&quot;forward:/third&quot;);\n        } else if (HELLO.equals(viewName)) {\n            // Forward to the hello JSP\n            return new JstlView(&quot;/WEB-INF/views/hello.jsp&quot;);\n        }\n        return null;\n    }\n}\n</code></pre>\n<p>Now, I believe that what should happen is that I should go to</p>\n<p>localhost:8080/forwardxml/first</p>\n<p>And it should return the jsp saying &quot;Hello, World!&quot; What I'm getting is:</p>\n<p><a href=\"https://i.sstatic.net/Wii4C9rw.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/Wii4C9rw.png\" alt=\"enter image description here\" /></a></p>\n<p>If I've made a mistake, please let me know, but this looks like a bug according to the documentation. If you recreate and think this is an issue, please comment as well.</p>\n",
    "tags" : [ "java", "spring-mvc" ],
    "owner" : {
      "account_id" : 938881,
      "reputation" : 15320,
      "user_id" : 967330,
      "user_type" : "registered",
      "accept_rate" : 90,
      "profile_image" : "https://www.gravatar.com/avatar/b731ee0bd2400959e9d13737e42c6418?s=256&d=identicon&r=PG",
      "display_name" : "Thom",
      "link" : "https://stackoverflow.com/users/967330/thom"
    },
    "is_answered" : true,
    "view_count" : 125,
    "answer_count" : 1,
    "score" : -1,
    "last_activity_date" : 1750280444,
    "creation_date" : 1750251675,
    "link" : "https://stackoverflow.com/questions/79670685/not-a-bug-in-spring-framework-forward",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79670772,
    "question_id" : 79670685,
    "body" : "<p>The <a href=\"https://github.com/spring-projects/spring-framework/blob/main/spring-webmvc/src/main/java/org/springframework/web/servlet/view/UrlBasedViewResolver.java#L104\" rel=\"nofollow noreferrer\"><code>forward:</code> prefix</a> is a magic prefix for the <code>UrlBasedViewResolver</code> (and subclasses) which will then turn it into an <code>InternalResourceView</code> with <a href=\"https://github.com/spring-projects/spring-framework/blob/main/spring-webmvc/src/main/java/org/springframework/web/servlet/view/UrlBasedViewResolver.java#L469\" rel=\"nofollow noreferrer\">the prefix removed</a>. The default for the <code>InternalResourceView</code> is to forward anyway.</p>\n<p>There is no bug related to this in Spring MVC, the problem is in your <code>TranslatingViewResolver</code>. Instead of <code>new InternalResourceView(&quot;forward:/second&quot;)</code> you should do <code>new InternalResourceView(&quot;/second&quot;)</code>. As you include the <code>forward:</code> prefix in the name of the view, Spring will then try to resolve something that listens for <code>forward:/second</code> instead of `/second. It fails hence a 404.</p>\n<p>This also has nothing to do with XML config or a bug in Spring, the same would happen with Java config and annotation based controllers etc.</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1750255395,
    "last_activity_date" : 1750280444,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140524375,
    "post_id" : 79670685,
    "body" : "If it is a bug then you probably should report it to Spring. What is the question for <a href=\"https://stackoverflow.com\">Stack Overflow</a>?",
    "score" : 0,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1750263611,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140523884,
    "post_id" : 79670685,
    "body" : "@ElliottFrisch These are how our mappings have been running in production for over a decade and they were working. Modifying the view resolvers and using the forwards are what created the error. Do you see an error in the mappings?",
    "score" : 0,
    "owner" : {
      "account_id" : 938881,
      "reputation" : 15320,
      "user_id" : 967330,
      "user_type" : "registered",
      "accept_rate" : 90,
      "profile_image" : "https://www.gravatar.com/avatar/b731ee0bd2400959e9d13737e42c6418?s=256&d=identicon&r=PG",
      "display_name" : "Thom",
      "link" : "https://stackoverflow.com/users/967330/thom"
    },
    "creation_date" : 1750254646,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140523872,
    "post_id" : 79670685,
    "body" : "@M.Deinum,no as forwardxml.war. Why?",
    "score" : 0,
    "owner" : {
      "account_id" : 938881,
      "reputation" : 15320,
      "user_id" : 967330,
      "user_type" : "registered",
      "accept_rate" : 90,
      "profile_image" : "https://www.gravatar.com/avatar/b731ee0bd2400959e9d13737e42c6418?s=256&d=identicon&r=PG",
      "display_name" : "Thom",
      "link" : "https://stackoverflow.com/users/967330/thom"
    },
    "creation_date" : 1750254563,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140523810,
    "post_id" : 79670685,
    "body" : "Let me guess you deployed your application as <code>ROOT.war</code>?",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1750253565,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79670772" : [ {
      "comment_id" : 140525714,
      "post_id" : 79670772,
      "body" : "As stated before the <code>forward:</code> prefix was for detecting in <code>UrlBasedViewResolver</code> or subclasses if it needed a forward or not. This only worked and has only ever worked as a return as the view name from the controller. If you would have returned <code>new InternalResourceView(&quot;forward:&#47;second&quot;)</code> from the controller it would have had the same effect.",
      "score" : 0,
      "owner" : {
        "account_id" : 3192259,
        "reputation" : 126826,
        "user_id" : 2696260,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
        "display_name" : "M. Deinum",
        "link" : "https://stackoverflow.com/users/2696260/m-deinum"
      },
      "creation_date" : 1750314274,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140524029,
      "post_id" : 79670772,
      "body" : "@DaveNewton although some of it working previously might have been a result of the TIlesViewResolver as well.",
      "score" : 0,
      "owner" : {
        "account_id" : 938881,
        "reputation" : 15320,
        "user_id" : 967330,
        "user_type" : "registered",
        "accept_rate" : 90,
        "profile_image" : "https://www.gravatar.com/avatar/b731ee0bd2400959e9d13737e42c6418?s=256&d=identicon&r=PG",
        "display_name" : "Thom",
        "link" : "https://stackoverflow.com/users/967330/thom"
      },
      "creation_date" : 1750257657,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140524023,
      "post_id" : 79670772,
      "body" : "@DaveNewton also, this forward: nomenclature worked in previous versions of spring as I would expect, which heightened my opinion that it was a bug.",
      "score" : 0,
      "owner" : {
        "account_id" : 938881,
        "reputation" : 15320,
        "user_id" : 967330,
        "user_type" : "registered",
        "accept_rate" : 90,
        "profile_image" : "https://www.gravatar.com/avatar/b731ee0bd2400959e9d13737e42c6418?s=256&d=identicon&r=PG",
        "display_name" : "Thom",
        "link" : "https://stackoverflow.com/users/967330/thom"
      },
      "creation_date" : 1750257472,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140524021,
      "post_id" : 79670772,
      "body" : "@DaveNewton I spent several days with this and asking questions and stepped into the framework and saw Spring hand the forward: prefix to the servlet engine for resolution. Even in retrospect, I don&#39;t feel that I was hasty in calling it a bug, but perhaps it is best to not use that word until someone had a chance to review it. I guess I must admit that I used the term bug to draw a little extra attention and that it would have been cool to find a bug in spring framework.",
      "score" : 0,
      "owner" : {
        "account_id" : 938881,
        "reputation" : 15320,
        "user_id" : 967330,
        "user_type" : "registered",
        "accept_rate" : 90,
        "profile_image" : "https://www.gravatar.com/avatar/b731ee0bd2400959e9d13737e42c6418?s=256&d=identicon&r=PG",
        "display_name" : "Thom",
        "link" : "https://stackoverflow.com/users/967330/thom"
      },
      "creation_date" : 1750257430,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140524016,
      "post_id" : 79670772,
      "body" : "The <code>forward:</code> prefix still works but only as a return value from a controller (method). The <code>UrlBasedViewResolver</code> strips it (just as the <code>redirect:</code>) prefix to get the right internal URL. This has been the case since the introduction of the <code>forward:</code> prefix.",
      "score" : 0,
      "owner" : {
        "account_id" : 3192259,
        "reputation" : 126826,
        "user_id" : 2696260,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
        "display_name" : "M. Deinum",
        "link" : "https://stackoverflow.com/users/2696260/m-deinum"
      },
      "creation_date" : 1750257360,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140524011,
      "post_id" : 79670772,
      "body" : "@Thom I agree the tone wasn’t great. That said, as senior developers, we also know that it’s almost always our code, and even if we’re sure we’re right, we don’t say y it’sa bug in the framework without having stepped through the framework code. Here, some sanity checking during the resolution process would likely have shown the doubling, assuming the error message didn’t click. (I can see how it might not here.)",
      "score" : 0,
      "owner" : {
        "account_id" : 195854,
        "reputation" : 160525,
        "user_id" : 438992,
        "user_type" : "registered",
        "accept_rate" : 90,
        "profile_image" : "https://i.sstatic.net/QouOz.jpg?s=256",
        "display_name" : "Dave Newton",
        "link" : "https://stackoverflow.com/users/438992/dave-newton"
      },
      "creation_date" : 1750257158,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140523981,
      "post_id" : 79670772,
      "body" : "Secondly, I am aware of spring&#39;s track record because I was working on it 20 years ago when I wrote this code and the forward: prefix worked in this situation. It appears to now be unnecessary as it may have been then and your answer has helped me solve a problem I&#39;ve been working on for a couple of days. Again, much appreciate your wisdom.",
      "score" : 0,
      "owner" : {
        "account_id" : 938881,
        "reputation" : 15320,
        "user_id" : 967330,
        "user_type" : "registered",
        "accept_rate" : 90,
        "profile_image" : "https://www.gravatar.com/avatar/b731ee0bd2400959e9d13737e42c6418?s=256&d=identicon&r=PG",
        "display_name" : "Thom",
        "link" : "https://stackoverflow.com/users/967330/thom"
      },
      "creation_date" : 1750256518,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}