{
  "question" : {
    "question_id" : 79792384,
    "title" : "Cannot override writeObject (Serializable model) method in AnyLogic",
    "body" : "<p>I have a model based on AnyLogic and tried to serialize it, but receive an StackOverflow error. As I understand the main reason is a circular agent reference. I can't find it however.\nI tried to override AnyLogic <code>writeObject</code> method in\nmy function on the main agent to find the last serializing Agent.</p>\n<pre><code>try {\n        FileOutputStream fos = new FileOutputStream(&quot;t.tmp&quot;);\n        ObjectOutputStream out = new ObjectOutputStream(fos) {\n            @Override\n            protected void writeObjectOverride(Object obj) {\n                System.out.println(&quot;Serializing: &quot; + obj.getClass().getName() + &quot; - &quot; + obj);\n                super.writeObjectOverride(obj);\n            }\n        };\n        \n        out.writeObject(this);\n        out.close();\n        System.out.println(&quot;Serialization completed successfully&quot;);\n        \n    } catch (IOException e) {\n        System.err.println(&quot;Serialization error: &quot; + e.getMessage());\n        e.printStackTrace();\n    }\n</code></pre>\n<p>I run my model in debug mode with breakpoints on the overriding method, but nothing happened. Model starts and when I call this function it executes an Anylogic writeObjectOverride method (i don't see any messages in console and my breakpoins didn't work)\nWhats happened?</p>\n",
    "tags" : [ "java", "serialization", "anylogic" ],
    "owner" : {
      "account_id" : 24296573,
      "reputation" : 75,
      "user_id" : 25301746,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AATXAJybS9Pp-yJKNesjgpkiM8qrbwtJFjyVo0ZYfFgr=k-s256",
      "display_name" : "Yura",
      "link" : "https://stackoverflow.com/users/25301746/yura"
    },
    "is_answered" : true,
    "view_count" : 81,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1760635402,
    "creation_date" : 1760633258,
    "link" : "https://stackoverflow.com/questions/79792384/cannot-override-writeobject-serializable-model-method-in-anylogic",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79792404,
    "question_id" : 79792384,
    "body" : "<p>From the <a href=\"https://docs.oracle.com/en/java/javase/24/docs/api/java.base/java/io/ObjectOutputStream.html#writeObjectOverride(java.lang.Object)\" rel=\"noreferrer\">documentation of <code>writeObjectOverride</code></a></p>\n<blockquote>\n<p>This method is called by trusted subclasses of ObjectOutputStream <strong>that constructed ObjectOutputStream using the protected no-arg constructor</strong>.</p>\n</blockquote>\n<p>This does not fit your use case.</p>\n<p>Instead, you should override <a href=\"https://docs.oracle.com/en/java/javase/24/docs/api/java.base/java/io/ObjectOutputStream.html#replaceObject(java.lang.Object)\" rel=\"noreferrer\"><code>replaceObject(Object)</code></a>. But donâ€™t forget to invoke <a href=\"https://docs.oracle.com/en/java/javase/24/docs/api/java.base/java/io/ObjectOutputStream.html#enableReplaceObject(boolean)\" rel=\"noreferrer\"><code>enableReplaceObject(true)</code></a> in the constructor to enable this feature.</p>\n<pre class=\"lang-java prettyprint-override\"><code>try(FileOutputStream fos = new FileOutputStream(&quot;t.tmp&quot;);\n    ObjectOutputStream out = new ObjectOutputStream(fos) {\n        { enableReplaceObject(true); }\n        @Override\n        protected Object replaceObject(Object obj) throws IOException {\n            System.out.println(&quot;Serializing: &quot; + obj.getClass().getName() + &quot; - &quot; + obj);\n            return obj;\n        }\n      }) {\n\n    out.writeObject(this);\n    System.out.println(&quot;Serialization completed successfully&quot;);\n} catch (IOException e) {\n    System.err.println(&quot;Serialization error: &quot; + e.getMessage());\n    e.printStackTrace();\n}\n</code></pre>\n",
    "score" : 8,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 3211603,
      "reputation" : 300941,
      "user_id" : 2711488,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/t2hoD.jpg?s=256",
      "display_name" : "Holger",
      "link" : "https://stackoverflow.com/users/2711488/holger"
    },
    "creation_date" : 1760635402,
    "last_activity_date" : 1760635402,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79792404" : [ {
      "comment_id" : 140800530,
      "post_id" : 79792404,
      "body" : "Yes.  Now it works. Thanks",
      "score" : 0,
      "owner" : {
        "account_id" : 24296573,
        "reputation" : 75,
        "user_id" : 25301746,
        "user_type" : "registered",
        "profile_image" : "https://lh3.googleusercontent.com/a/AATXAJybS9Pp-yJKNesjgpkiM8qrbwtJFjyVo0ZYfFgr=k-s256",
        "display_name" : "Yura",
        "link" : "https://stackoverflow.com/users/25301746/yura"
      },
      "creation_date" : 1760643647,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}