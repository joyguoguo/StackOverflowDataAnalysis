{
  "question" : {
    "question_id" : 79812066,
    "title" : "Optional bean from creation to usage",
    "body" : "<p>In the <code>application.yml</code>, some properties can be given or not (according to the environment, the treatment at the end can be done or not). If not given, then the bean initialized with these properties in a configuration must not be initialized. I saw that it is not recommended to return null.</p>\n<p>In the code, for the service, I want to initalize it only if the bean has been created in the configuration.</p>\n<p>In the code, in a service where the previous service is used, I saw that I can use <code>Optional&lt;MyService&gt;</code> in the constructor or <code>@Autowired(required = false)</code> on the attribute and then I will do <code>if(myService != null)</code> to not do the code if service does not exist.</p>\n<p>An exemple of the code in the configuration with a comment where I do not know what to do:</p>\n<pre><code>@Configuration\npublic class MyConfiguration {\n    // Empty value by default if not given\n    @Value(&quot;${property.value:}&quot;)\n    private String myProperty;\n    \n    @Bean(&quot;myBean&quot;)\n    public MyBeanObject myBeanObject() {\n        if (StringUtils.isNotEmpty(this.myProperty)) {\n            return new MyBeanObject;\n        } else {\n            // How to do?\n        }\n    }\n}\n</code></pre>\n<p>An exemple of the first service with a comment where I do not know how to do:</p>\n<pre><code>// How to make this service optional and not created if bean does not exist?\n@Service(&quot;myFirstService&quot;)\npublic class MyFirstServiceImpl extends AbstractMyService {\n    @Autowired\n    public MyFirstServiceImpl(@Qualifier(&quot;myBean&quot;) MyBeanObject myBeanObject) {\n        super(myBeanObject);\n    }\n}\n</code></pre>\n<p>An exemple of the second service where I do the treatment only if the service exists (I do not know if it is correct):</p>\n<pre><code>@Service\npublic class MySecondServiceImpl {\n    private AbstractMyService myService;\n    \n    @Autowired\n    public MySecondServiceImpl(@Qualifier(&quot;myFirstService&quot;) Optional&lt;AbstractMyService&gt; myServiceOpt) {\n        if(myServiceOpt.isPresent()) {\n            this.myService = myServiceOpt.get();\n        }\n    }\n    \n    public void method() {\n        if(this.myService != null) {\n            // treatment\n        }\n   }\n}\n</code></pre>\n",
    "tags" : [ "java", "spring" ],
    "owner" : {
      "account_id" : 18936970,
      "reputation" : 341,
      "user_id" : 13817825,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/cbced2a5eafd2c2cec5f5dd41b288905?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "phildeg31",
      "link" : "https://stackoverflow.com/users/13817825/phildeg31"
    },
    "is_answered" : false,
    "view_count" : 91,
    "answer_count" : 1,
    "score" : 4,
    "last_activity_date" : 1762512568,
    "creation_date" : 1762503186,
    "link" : "https://stackoverflow.com/questions/79812066/optional-bean-from-creation-to-usage",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79812243,
    "question_id" : 79812066,
    "body" : "<p>Thanks to M. Deinum, this is the solution I did:</p>\n<ul>\n<li><p>I created an interface based on Conditional for an annotation permitting to check that multiple String properties are not empty (based on an excemple found in this site, I just adapted it to my case):</p>\n<pre><code>@Target({ ElementType.TYPE, ElementType.METHOD })\n@Retention(RetentionPolicy.RUNTIME)\n@Conditional(ConditionalOnPropertyNotEmpty.OnPropertyNotEmptyCondition.class)\npublic @interface ConditionalOnPropertyNotEmpty {\n    String[] value() default {};\n\n    class OnPropertyNotEmptyCondition implements Condition {\n\n        @Override\n        public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {\n            Map&lt;String, Object&gt; attrs = metadata.getAnnotationAttributes(ConditionalOnPropertyNotEmpty.class.getName());\n            if (attrs == null) {\n                return false;\n            }\n            String[] properties = (String[]) attrs.get(&quot;value&quot;);\n            List&lt;String&gt; propertyNames = Arrays.asList(properties);\n            for (String propertyName : propertyNames) {\n                String val = context.getEnvironment().getProperty(propertyName);\n                if (StringUtils.isEmpty(val)) {\n                    return false;\n                }\n            }\n            return true;\n        }\n    }\n}\n</code></pre>\n</li>\n<li><p>I use it to create my beans (or not) in the configuration:</p>\n<pre><code>@Configuration\npublic class MyConfiguration {\n    // Empty value by default if not given\n    @Value(&quot;${property1.value:}&quot;)\n    private String myFirstProperty;\n    @Value(&quot;${property2.value:}&quot;)\n    private String mySecondProperty;\n\n    @Bean(&quot;myBean&quot;)\n    @ConditionalOnPropertyNotEmpty({ &quot;property1.value&quot;, &quot;property2.value&quot; })\n    public MyBeanObject myBeanObject() {\n        return new MyBeanObject(this.myFirstProperty, this.mySecondProperty);\n    }\n\n    @Bean(&quot;myFirstService&quot;)\n    @ConditionalOnPropertyNotEmpty({ &quot;property1.value&quot;, &quot;property2.value&quot; })\n    public AbstractMyService myFirstServiceBean() {\n        return new MyFirstServiceImpl(@Qualifier(&quot;myBean&quot;) MyBeanObject myBeanObject);\n    }\n}\n</code></pre>\n</li>\n<li><p>In the second service, I do the treatment only if the bean of the first service exist</p>\n</li>\n</ul>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 18936970,
      "reputation" : 341,
      "user_id" : 13817825,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/cbced2a5eafd2c2cec5f5dd41b288905?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "phildeg31",
      "link" : "https://stackoverflow.com/users/13817825/phildeg31"
    },
    "creation_date" : 1762512568,
    "last_activity_date" : 1762512568,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140843124,
    "post_id" : 79812066,
    "body" : "Yes I agree but I cannot set it as the best answer because it is only a comment. This is why I explained what I did thanks to his answer.",
    "score" : 0,
    "owner" : {
      "account_id" : 18936970,
      "reputation" : 341,
      "user_id" : 13817825,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/cbced2a5eafd2c2cec5f5dd41b288905?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "phildeg31",
      "link" : "https://stackoverflow.com/users/13817825/phildeg31"
    },
    "creation_date" : 1762592922,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140841595,
    "post_id" : 79812066,
    "body" : "@M.Deinum Your first comment should be an answer IMO. Covers the available options pretty nice (my suggestions would have been the same).",
    "score" : 0,
    "owner" : {
      "account_id" : 23783500,
      "reputation" : 7109,
      "user_id" : 17795888,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Xay1V.jpg?s=256",
      "display_name" : "Chaosfire",
      "link" : "https://stackoverflow.com/users/17795888/chaosfire"
    },
    "creation_date" : 1762511372,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140841436,
    "post_id" : 79812066,
    "body" : "Well you would probably better of ditching the <code>@Service</code> on your first service make that an <code>@Bean</code> as well and make your configuration conditional on the property. Or as mentioned return a no-op implementatin of the <code>MyBeanObject</code>.",
    "score" : 1,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126777,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1762506173,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140841431,
    "post_id" : 79812066,
    "body" : "Ok so for myBeanObject you mean?",
    "score" : 0,
    "owner" : {
      "account_id" : 18936970,
      "reputation" : 341,
      "user_id" : 13817825,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/cbced2a5eafd2c2cec5f5dd41b288905?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "phildeg31",
      "link" : "https://stackoverflow.com/users/13817825/phildeg31"
    },
    "creation_date" : 1762506054,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140841424,
    "post_id" : 79812066,
    "body" : "If you are using an <code>application.yml</code> I&#39;m under the assumption you are using Spring Boot. If so don&#39;t do an if but make the bean conditional on a property <code>@ConditionalOnProperty</code>. Also when doing optional please use as intended and don&#39;t use it as a glorified <code>if</code>. Don&#39;t use <code>isPresent</code> with <code>get</code> just assign it to a field, and use somethingl ike <code>optional.ifPresent( svc -&gt; svc.doSomething())</code>. If you don&#39;t want to use a conditional or refrain from optional and if, is to to return an no-op implementation of the service.",
    "score" : 4,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126777,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1762505962,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79812243" : [ {
      "comment_id" : 140845988,
      "post_id" : 79812243,
      "body" : "use @EnableConfigurationProperties. it can controller bean created.  less than code.",
      "score" : 0,
      "owner" : {
        "account_id" : 31928324,
        "reputation" : 1,
        "user_id" : 24738709,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/51ahZIBH.jpg?s=256",
        "display_name" : "Williams",
        "link" : "https://stackoverflow.com/users/24738709/williams"
      },
      "creation_date" : 1762740329,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}