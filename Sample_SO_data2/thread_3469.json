{
  "question" : {
    "question_id" : 79549379,
    "title" : "Unable to read polymorphic types with Morphia with or without the default discriminator",
    "body" : "<p>So I have a simple structure:</p>\n<p><strong>Interceptor.java</strong></p>\n<pre><code>@Entity(discriminatorKey = &quot;type&quot;)\npublic abstract class Interceptor {\n\n    @Id\n    protected String id;\n    protected String type;\n\n    public Interceptor(String type) {\n        this.type = type;\n    }\n    \n    // getters and setters omitted..\n}\n</code></pre>\n<p>It's subclasses:</p>\n<p><strong>ScriptInterceptor.java</strong></p>\n<pre><code>@Entity(discriminator = &quot;script&quot;, discriminatorKey = &quot;type&quot;)\npublic class ScriptInterceptor extends Interceptor {\n\n    private String language;\n    private String source;\n\n    public ScriptInterceptor() {\n        super(&quot;script&quot;);\n    }\n    \n    // getters and setters omitted...\n}\n</code></pre>\n<p><strong>XsltInterceptor.java</strong></p>\n<pre><code>@Entity(discriminator = &quot;xslt&quot;, discriminatorKey = &quot;type&quot;)\npublic class XsltInterceptor extends Interceptor {\n\n    private String source;\n\n    public XsltInterceptor() {\n        super(&quot;xslt&quot;);\n    }\n    \n    // getters and setters omitted...\n}\n</code></pre>\n<p>The document is successfully inserted, but when reading it seems that Morphia is unable to deserialize it. The document looks like this:</p>\n<p><a href=\"https://i.sstatic.net/YDGwQbx7.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/YDGwQbx7.png\" alt=\"\" /></a></p>\n<p>The error I'm getting is:</p>\n<pre><code>Caused by: org.bson.codecs.configuration.CodecConfigurationException: Failed to decode 'Interceptor'. Decoding errored with: my.package.ScriptInterceptor\n............\nCaused by: dev.morphia.mapping.MappingException: my.package.ScriptInterceptor\n    at dev.morphia.mapping.DiscriminatorLookup.lookup(DiscriminatorLookup.java:69)\n    at dev.morphia.mapping.codec.pojo.EntityDecoder.getCodecFromDocument(EntityDecoder.java:105)\n    ... 84 more\nCaused by: java.lang.ClassNotFoundException: my.package.ScriptInterceptor\n    at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:641)\n    at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:188)\n    at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:526)\n</code></pre>\n<p>I already tried to use the default discriminator (_t) but I got the very same error.</p>\n<p>I'm really confused right now. Why is this happening?</p>\n<p>Server Version: 8.0.4\nDriver Version: 4.11.5\nMorphia Version: 2.4.15</p>\n<hr />\n<h1>EDIT</h1>\n<p>Looks like an issue with the MongoDB driver. Since current Morphia stable release (2.4.15) does not support the most recent versions of the driver (5.X), the problem most likely resides here.</p>\n<p>The very same code worked flawlessly with Morphia 3.0.0 (which brings the 5.X driver), but currently it is a SNAPSHOT version. Anyways, I might stick with that.</p>\n<p>If anyone has a fix for the 2.4.15, please, leave an answer and share with us.</p>\n",
    "tags" : [ "java", "mongodb", "morphia" ],
    "owner" : {
      "account_id" : 7778530,
      "reputation" : 3504,
      "user_id" : 9860374,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/UlSCz.png?s=256",
      "display_name" : "Matheus",
      "link" : "https://stackoverflow.com/users/9860374/matheus"
    },
    "is_answered" : true,
    "view_count" : 103,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1746917427,
    "creation_date" : 1743550532,
    "link" : "https://stackoverflow.com/questions/79549379/unable-to-read-polymorphic-types-with-morphia-with-or-without-the-default-discri",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79615998,
    "question_id" : 79549379,
    "body" : "<p>There's a Morphia 2.5 now that brings driver 5.0+ support, fwiw.  2.4.x and 2.5.x only differ in what drivers they support so the transition should be seamless for you.</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 1414206,
      "reputation" : 6276,
      "user_id" : 1340183,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/dd31e838b01c32ffe216b6d3163289f1?s=256&d=identicon&r=PG",
      "display_name" : "evanchooly",
      "link" : "https://stackoverflow.com/users/1340183/evanchooly"
    },
    "creation_date" : 1746917427,
    "last_activity_date" : 1746917427,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79615998" : [ {
      "comment_id" : 140418162,
      "post_id" : 79615998,
      "body" : "I&#39;ve been using 2.5 since it&#39;s release, but I forgot to update this question :p Many thanks for your work on Morphia btw, very useful.",
      "score" : 0,
      "owner" : {
        "account_id" : 7778530,
        "reputation" : 3504,
        "user_id" : 9860374,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/UlSCz.png?s=256",
        "display_name" : "Matheus",
        "link" : "https://stackoverflow.com/users/9860374/matheus"
      },
      "creation_date" : 1747058226,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}