{
  "question" : {
    "question_id" : 79771579,
    "title" : "Kotlin slow compile times",
    "body" : "<p>When we want to compile our project, it regularly takes somewhere between 5-8 minutes. This is an issue for our developers as we want to be able to quickly test our changes. More often than not, the &quot;Apply HotSwap&quot; feature from IntelliJ IDEA also does not work, as it crashes out saying it can't apply the hotswap for a plethora of reasons, none of which have been indicative of why it went wrong so far.</p>\n<p>We've already scoured the web trying to find solutions and have (attempted to) implement(ed) most of the highly upvoted solutions.</p>\n<p>The only thing we haven't yet done is split our product into modules, which would not be an ideal sole solution as we have quite a huge codebase. We'd consider this as a &quot;last resort&quot; for now.</p>\n<p>We've also thought of e.g. only running the jOOQ codegen if the model has changed in our database, and caching or even committing the generated files, but that won't cut down multiple minutes of the time spent.</p>\n<p>Our codebase is around 72% Kotlin, which, according to our Git repository, is around 1.6k files.</p>\n<p>What can we do to cut down our compile times?</p>\n<hr />\n<p>Notable frameworks: RePlay, jOOQ, flyway, openAPI</p>\n<p>Device: Lenovo laptop (OpenSUSE) with 32Gb RAM + 32Gb Swap allocated</p>\n<p>Java: Coretto 21\nGradle: 8.5\nKotlin: 2.2.20-RC2</p>\n<p>VM options in our run configuration:</p>\n<pre class=\"lang-none prettyprint-override\"><code>-Dlog4j_rootLogger=INFO,Console \n-XX:+ShowCodeDetailsInExceptionMessages \n-Djdk.attach.allowAttachSelf=true \n--add-exports=java.base/jdk.internal.access.foreign=ALL-UNNAMED \n--add-opens=java.base/java.nio=ALL-UNNAMED \n--add-opens=java.base/java.util=ALL-UNNAMED \n--add-opens=java.base/java.lang=ALL-UNNAMED\n</code></pre>\n<p>Gradle properties from <code>gradle.properties</code>:</p>\n<pre class=\"lang-none prettyprint-override\"><code>org.gradle.caching=true\norg.gradle.parallel=true\norg.gradle.jvmargs=-XX:+UseParallelGC -Xmx8g -Dkotlin.daemon.jvm.options=-Xmx6g \\\n  --add-exports jdk.compiler/com.sun.tools.javac.api=ALL-UNNAMED \\\n  --add-exports jdk.compiler/com.sun.tools.javac.file=ALL-UNNAMED \\\n  --add-exports jdk.compiler/com.sun.tools.javac.parser=ALL-UNNAMED \\\n  --add-exports jdk.compiler/com.sun.tools.javac.tree=ALL-UNNAMED \\\n  --add-exports jdk.compiler/com.sun.tools.javac.util=ALL-UNNAMED\n\nkotlin.compiler.execution.strategy=in-process\n</code></pre>\n<p>Kotlin free compiler args from <code>build.gradle.kts</code>:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>-Xjsr305=strict\n-Xbackend-threads=0\n-Xenable-incremental-compilation\n-Xlambdas=indy\n</code></pre>\n<p>Gradle profile report after editing a single line of source code:</p>\n<pre><code>compileKotlin           - 3m 32.672s\nnpm:build               - 2m 59.938s // Export our Kotlinx html as webpack\ndetekt                  - 1m 14.514s    \nflywayMigrate           - 41.606s   \njooqCodegen             - 35.940s   \nflywayLoadSchemaAndSeed - 22.542s   \nflywayClean             - 12.956s   \n</code></pre>\n",
    "tags" : [ "java", "kotlin", "gradle" ],
    "owner" : {
      "account_id" : 10720600,
      "reputation" : 113,
      "user_id" : 7889829,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/PnrpX.jpg?s=256",
      "display_name" : "GSerum_",
      "link" : "https://stackoverflow.com/users/7889829/gserum"
    },
    "is_answered" : false,
    "view_count" : 292,
    "answer_count" : 0,
    "score" : 8,
    "last_activity_date" : 1759410928,
    "creation_date" : 1758542309,
    "link" : "https://stackoverflow.com/questions/79771579/kotlin-slow-compile-times",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140787100,
    "post_id" : 79771579,
    "body" : "Did you try Kotlin 2.1.21 instead of 2.2.20 ? I am observing dramatic build time increases after upgrading Kotlin 2.1.21 -&gt; 2.2.20 \uD83D\uDE21",
    "score" : 0,
    "owner" : {
      "account_id" : 5080299,
      "reputation" : 3896,
      "user_id" : 4076606,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-teowPdLBZRY/AAAAAAAAAAI/AAAAAAAAACM/2RPSBkRaJA0/s256-rj/photo.jpg",
      "display_name" : "Mateusz Stefek",
      "link" : "https://stackoverflow.com/users/4076606/mateusz-stefek"
    },
    "creation_date" : 1760039335,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140770293,
    "post_id" : 79771579,
    "body" : "@WarrenP I think it&#39;s just sorted by length, which makes it look like its cumulative, but the compile step itself is 3.5 min, the entire compilation of all steps together can take up to 8-9min I&#39;ve noticed.",
    "score" : 1,
    "owner" : {
      "account_id" : 10720600,
      "reputation" : 113,
      "user_id" : 7889829,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/PnrpX.jpg?s=256",
      "display_name" : "GSerum_",
      "link" : "https://stackoverflow.com/users/7889829/gserum"
    },
    "creation_date" : 1759299546,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140769983,
    "post_id" : 79771579,
    "body" : "Seems like your actual kotlin build time is 30 seconds.  Then 3 minutes of npm, detekt, and other stuff.",
    "score" : 0,
    "owner" : {
      "account_id" : 30958,
      "reputation" : 69813,
      "user_id" : 84704,
      "user_type" : "registered",
      "accept_rate" : 91,
      "profile_image" : "https://i.sstatic.net/aEXJK.png?s=256",
      "display_name" : "Warren  P",
      "link" : "https://stackoverflow.com/users/84704/warren-p"
    },
    "creation_date" : 1759275099,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140767839,
    "post_id" : 79771579,
    "body" : "maven build has an argument to to use multiple thread -T 4  <a href=\"https://maven.apache.org/ref/4.0.0-beta-5/apidocs/org/apache/maven/api/cli/mvn/MavenOptions.html#threads()\" rel=\"nofollow noreferrer\">maven.apache.org/ref/4.0.0-beta-5/apidocs/org/apache/maven/a&zwnj;&#8203;pi/&hellip;</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 8335560,
      "reputation" : 189,
      "user_id" : 8963357,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/bGQu6.png?s=256",
      "display_name" : "albseb",
      "link" : "https://stackoverflow.com/users/8963357/albseb"
    },
    "creation_date" : 1759205574,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140761403,
    "post_id" : 79771579,
    "body" : "@LukasEder I can&#39;t find any flags, apart from <code>compileTestJava</code>, <code>compileTestKotlin</code>, <code>test</code> and <code>processTestResources</code>, which are all set to false",
    "score" : 0,
    "owner" : {
      "account_id" : 10720600,
      "reputation" : 113,
      "user_id" : 7889829,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/PnrpX.jpg?s=256",
      "display_name" : "GSerum_",
      "link" : "https://stackoverflow.com/users/7889829/gserum"
    },
    "creation_date" : 1758878059,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140761209,
    "post_id" : 79771579,
    "body" : "@GSerum_ I&#39;m mainly asking because there are a few flags that are known to contribute to compile time and I&#39;d like to check for them. Up to you if you want to share this information.",
    "score" : 0,
    "owner" : {
      "account_id" : 247217,
      "reputation" : 223472,
      "user_id" : 521799,
      "user_type" : "registered",
      "accept_rate" : 89,
      "profile_image" : "https://www.gravatar.com/avatar/eb96efa7a5664ba1c4ebf586abd4121f?s=256&d=identicon&r=PG",
      "display_name" : "Lukas Eder",
      "link" : "https://stackoverflow.com/users/521799/lukas-eder"
    },
    "creation_date" : 1758872307,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140761197,
    "post_id" : 79771579,
    "body" : "@LukasEder We have a very basic implementation of the jooq code generator, plus a custom extension of the <code>DefaultGeneratorStrategy</code> with some function overrides. Other than that it&#39;s the bare bones afaik.",
    "score" : 1,
    "owner" : {
      "account_id" : 10720600,
      "reputation" : 113,
      "user_id" : 7889829,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/PnrpX.jpg?s=256",
      "display_name" : "GSerum_",
      "link" : "https://stackoverflow.com/users/7889829/gserum"
    },
    "creation_date" : 1758872055,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140760095,
    "post_id" : 79771579,
    "body" : "Don&#39;t use version <code>2.2.20-RC2</code> when there is <code>2.2.20</code>. Also &quot;it crashes out saying it can&#39;t apply the hotswap for a plethora of reasons&quot; is not an error description.",
    "score" : 1,
    "owner" : {
      "account_id" : 263656,
      "reputation" : 79573,
      "user_id" : 549372,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/430cfd8b3056a0425f950cb1c6abd208?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Martin Zeitler",
      "link" : "https://stackoverflow.com/users/549372/martin-zeitler"
    },
    "creation_date" : 1758818769,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140759796,
    "post_id" : 79771579,
    "body" : "<i>&quot;We&#39;ve also thought of e.g. only running the jOOQ codegen if the model has changed in our database&quot;</i> You should definitely do that. The code generator and Gradle plugin support this out of the box. Regarding jOOQ generated code, can you post your code generation configuration here?",
    "score" : 1,
    "owner" : {
      "account_id" : 247217,
      "reputation" : 223472,
      "user_id" : 521799,
      "user_type" : "registered",
      "accept_rate" : 89,
      "profile_image" : "https://www.gravatar.com/avatar/eb96efa7a5664ba1c4ebf586abd4121f?s=256&d=identicon&r=PG",
      "display_name" : "Lukas Eder",
      "link" : "https://stackoverflow.com/users/521799/lukas-eder"
    },
    "creation_date" : 1758811405,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}