{
  "question" : {
    "question_id" : 79704910,
    "title" : "logback error:java.lang.IllegalStateException: Could not initialize Logback logging from classpath:logback-spring.xml",
    "body" : "<p>The following is my logback-spring.xml configuration file:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;configuration debug=&quot;false&quot;&gt;\n\n    &lt;springProperty scop=&quot;context&quot; name=&quot;spring.application.name&quot; source=&quot;spring.application.name&quot; defaultValue=&quot;dm-sql-server&quot;/&gt;\n    &lt;property name=&quot;FILE_NAME&quot; value=&quot;dm-sql-server&quot; /&gt;\n    &lt;property name=&quot;LOG_PATTERN&quot; value=&quot;%d{yyyy-MM-dd HH:mm:ss} [%thread] [%p]%n%m%n%n&quot; /&gt;\n    &lt;property name=&quot;ERROR_LOG_PATTERN&quot; value=&quot;%d{yyyy-MM-dd HH:mm:ss} [%thread] %c{10}.%M:%L-[%p]%n%m%n%n&quot; /&gt;\n\n    &lt;appender name=&quot;STDOUT&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;\n        &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt;\n            &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt;\n        &lt;/encoder&gt;\n    &lt;/appender&gt;\n\n    &lt;appender name=&quot;FILE&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;\n        &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;&gt;\n            &lt;FileNamePattern&gt;${LOG_HOME}/${FILE_NAME}-%d{yyyy-MM-dd}.%i.log&lt;/FileNamePattern&gt;\n            &lt;cleanHistoryOnStart&gt;true&lt;/cleanHistoryOnStart&gt;\n            &lt;springProfile name=&quot;prod&quot;&gt;\n                &lt;MaxHistory&gt;30&lt;/MaxHistory&gt;\n                &lt;maxFileSize&gt;20MB&lt;/maxFileSize&gt;\n                &lt;totalSizeCap&gt;10GB&lt;/totalSizeCap&gt;\n            &lt;/springProfile&gt;\n            &lt;springProfile name=&quot;!prod&quot;&gt;\n                &lt;MaxHistory&gt;3&lt;/MaxHistory&gt;\n                &lt;maxFileSize&gt;20MB&lt;/maxFileSize&gt;\n                &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt;\n            &lt;/springProfile&gt;\n        &lt;/rollingPolicy&gt;\n        &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt;\n            &lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt;\n        &lt;/encoder&gt;\n    &lt;/appender&gt;\n\n    &lt;appender name=&quot;ERROR&quot;  class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;\n        &lt;filter class=&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt;\n            &lt;!--设置日志级别,过滤掉info日志,只输入error日志--&gt;\n            &lt;level&gt;ERROR&lt;/level&gt;\n        &lt;/filter&gt;\n        &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;&gt;\n            &lt;FileNamePattern&gt;${LOG_HOME}/${FILE_NAME}-%d{yyyy-MM-dd}.%i.error.log&lt;/FileNamePattern&gt;\n            &lt;cleanHistoryOnStart&gt;true&lt;/cleanHistoryOnStart&gt;\n            &lt;springProfile name=&quot;prod&quot;&gt;\n                &lt;!--单个文件上限大小--&gt;\n                &lt;!--总日志文件大小上限--&gt;\n                &lt;totalSizeCap&gt;5GB&lt;/totalSizeCap&gt;\n            &lt;/springProfile&gt;\n            &lt;springProfile name=&quot;!prod&quot;&gt;\n                &lt;MaxHistory&gt;7&lt;/MaxHistory&gt;\n                &lt;maxFileSize&gt;20MB&lt;/maxFileSize&gt;\n                &lt;totalSizeCap&gt;3GB&lt;/totalSizeCap&gt;\n            &lt;/springProfile&gt;\n        &lt;/rollingPolicy&gt;\n        &lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt;\n            &lt;pattern&gt;${ERROR_LOG_PATTERN}&lt;/pattern&gt;\n        &lt;/encoder&gt;\n    &lt;/appender&gt;\n\n    &lt;springProfile name=&quot;prod&quot;&gt;\n        &lt;logger name=&quot;org.apache.ibatis&quot; level=&quot;WARN&quot; /&gt;\n        &lt;logger name=&quot;springfox.documentation.schema.property.CachingModelPropertiesProvider&quot; level=&quot;ERROR&quot; /&gt;\n        &lt;logger name=&quot;org.mybatis&quot; level=&quot;WARN&quot; /&gt;\n        &lt;logger name=&quot;com.dm&quot; level=&quot;WARN&quot; /&gt;\n        &lt;logger name=&quot;com.dm.dsa.DsaApplication&quot; level=&quot;INFO&quot; /&gt;\n        &lt;root level=&quot;WARN&quot;&gt;\n            &lt;appender-ref ref=&quot;FILE&quot; /&gt;\n            &lt;appender-ref ref=&quot;ERROR&quot; /&gt;\n        &lt;/root&gt;\n    &lt;/springProfile&gt;\n\n    &lt;springProfile name=&quot;!prod&quot;&gt;\n        &lt;logger name=&quot;org.apache.ibatis&quot; level=&quot;INFO&quot; /&gt;\n        &lt;logger name=&quot;springfox.documentation.schema.property.CachingModelPropertiesProvider&quot; level=&quot;ERROR&quot; /&gt;\n        &lt;logger name=&quot;org.mybatis&quot; level=&quot;INFO&quot; /&gt;\n        &lt;logger name=&quot;com.dm&quot; level=&quot;INFO&quot; /&gt;\n        &lt;logger name=&quot;com.dm.dsa.websocket.WebSocket&quot; level=&quot;INFO&quot; /&gt;\n        &lt;logger name=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot; level=&quot;DEBUG&quot; /&gt;\n        &lt;logger name=&quot;org.springframework.jdbc.support.JdbcTransactionManager&quot; level=&quot;DEBUG&quot; /&gt;\n        &lt;logger name=&quot;com.baomidou.dynamic.datasource.tx.LocalTxUtil&quot; level=&quot;DEBUG&quot; /&gt;\n        &lt;root level=&quot;INFO&quot;&gt;\n            &lt;appender-ref ref=&quot;STDOUT&quot; /&gt;\n            &lt;appender-ref ref=&quot;FILE&quot; /&gt;\n            &lt;appender-ref ref=&quot;ERROR&quot; /&gt;\n        &lt;/root&gt;\n    &lt;/springProfile&gt;\n\n&lt;/configuration&gt;\n</code></pre>\n<p>However, my project fails to start when the installation path or working directory contains special characters like @￥%......&amp; (e.g., C:\\Users\\me\\Desktop@￥%......&amp;\\my-app...).</p>\n<p>The error message is:</p>\n<pre class=\"lang-none prettyprint-override\"><code>Logging system failed to initialize using configuration from 'null'\n\njava.lang.IllegalStateException: Could not initialize Logback logging from classpath:logback-spring.xml\n    at org.springframework.boot.logging.logback.LogbackLoggingSystem.lambda$loadConfiguration$2(LogbackLoggingSystem.java:265)\n    at org.springframework.boot.logging.logback.LogbackLoggingSystem.withLoggingSuppressed(LogbackLoggingSystem.java:483)\n    at org.springframework.boot.logging.logback.LogbackLoggingSystem.loadConfiguration(LogbackLoggingSystem.java:255)\n    at org.springframework.boot.logging.AbstractLoggingSystem.initializeWithConventions(AbstractLoggingSystem.java:81)\n    at org.springframework.boot.logging.AbstractLoggingSystem.initialize(AbstractLoggingSystem.java:61)\n    at org.springframework.boot.logging.logback.LogbackLoggingSystem.initialize(LogbackLoggingSystem.java:197)\n    at org.springframework.boot.context.logging.LoggingApplicationListener.initializeSystem(LoggingApplicationListener.java:332)\n    at org.springframework.boot.context.logging.LoggingApplicationListener.initialize(LoggingApplicationListener.java:298)\n    at org.springframework.boot.context.logging.LoggingApplicationListener.onApplicationEnvironmentPreparedEvent(LoggingApplicationListener.java:246)\n    at org.springframework.boot.context.logging.LoggingApplicationListener.onApplicationEvent(LoggingApplicationListener.java:223)\n    at com.dm.dsa.config.app.SqlarkLoggingInitializeListener.onApplicationEvent(SqlarkLoggingInitializeListener.java:20)\n    at org.springframework.context.event.SimpleApplicationEventMulticaster.doInvokeListener(SimpleApplicationEventMulticaster.java:185)\n    at org.springframework.context.event.SimpleApplicationEventMulticaster.invokeListener(SimpleApplicationEventMulticaster.java:178)\n    at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:156)\n    at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:138)\n    at org.springframework.boot.context.event.EventPublishingRunListener.multicastInitialEvent(EventPublishingRunListener.java:136)\n    at org.springframework.boot.context.event.EventPublishingRunListener.environmentPrepared(EventPublishingRunListener.java:81)\n    at org.springframework.boot.SpringApplicationRunListeners.lambda$environmentPrepared$2(SpringApplicationRunListeners.java:64)\n    at java.base/java.lang.Iterable.forEach(Iterable.java:75)\n    at org.springframework.boot.SpringApplicationRunListeners.doWithListeners(SpringApplicationRunListeners.java:118)\n    at org.springframework.boot.SpringApplicationRunListeners.doWithListeners(SpringApplicationRunListeners.java:112)\n    at org.springframework.boot.SpringApplicationRunListeners.environmentPrepared(SpringApplicationRunListeners.java:63)\n    at org.springframework.boot.SpringApplication.prepareEnvironment(SpringApplication.java:353)\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:313)\n    at com.dm.dsa.DsaApplication.main(DsaApplication.java:122)\nCaused by: java.lang.NumberFormatException: For input string: &quot;.....&amp;/&quot;\n    at java.base/java.lang.NumberFormatException.forInputString(NumberFormatException.java:67)\n    at java.base/java.lang.Integer.parseInt(Integer.java:654)\n    at java.base/java.lang.Integer.parseInt(Integer.java:786)\n    at ch.qos.logback.core.pattern.FormatInfo.valueOf(FormatInfo.java:83)\n    at ch.qos.logback.core.pattern.parser.Parser.T(Parser.java:134)\n    at ch.qos.logback.core.pattern.parser.Parser.E(Parser.java:94)\n    at ch.qos.logback.core.pattern.parser.Parser.Eopt(Parser.java:113)\n    at ch.qos.logback.core.pattern.parser.Parser.E(Parser.java:98)\n    at ch.qos.logback.core.pattern.parser.Parser.parse(Parser.java:89)\n    at ch.qos.logback.core.rolling.helper.FileNamePattern.parse(FileNamePattern.java:71)\n    at ch.qos.logback.core.rolling.helper.FileNamePattern.&lt;init&gt;(FileNamePattern.java:56)\n    at ch.qos.logback.core.rolling.TimeBasedRollingPolicy.start(TimeBasedRollingPolicy.java:72)\n    at ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy.start(SizeAndTimeBasedRollingPolicy.java:43)\n    at ch.qos.logback.core.model.processor.ImplicitModelHandler.postHandleComplex(ImplicitModelHandler.java:207)\n    at ch.qos.logback.core.model.processor.ImplicitModelHandler.postHandle(ImplicitModelHandler.java:186)\n    at ch.qos.logback.core.model.processor.DefaultProcessor.secondPhaseTraverse(DefaultProcessor.java:257)\n    at ch.qos.logback.core.model.processor.DefaultProcessor.secondPhaseTraverse(DefaultProcessor.java:253)\n    at ch.qos.logback.core.model.processor.DefaultProcessor.secondPhaseTraverse(DefaultProcessor.java:253)\n    at ch.qos.logback.core.model.processor.DefaultProcessor.traversalLoop(DefaultProcessor.java:90)\n    at ch.qos.logback.core.model.processor.DefaultProcessor.process(DefaultProcessor.java:106)\n    at ch.qos.logback.core.joran.GenericXMLConfigurator.processModel(GenericXMLConfigurator.java:222)\n    at org.springframework.boot.logging.logback.SpringBootJoranConfigurator.processModel(SpringBootJoranConfigurator.java:136)\n    at ch.qos.logback.core.joran.GenericXMLConfigurator.doConfigure(GenericXMLConfigurator.java:178)\n    at ch.qos.logback.core.joran.GenericXMLConfigurator.doConfigure(GenericXMLConfigurator.java:123)\n    at ch.qos.logback.core.joran.GenericXMLConfigurator.doConfigure(GenericXMLConfigurator.java:66)\n    at org.springframework.boot.logging.logback.LogbackLoggingSystem.configureByResourceUrl(LogbackLoggingSystem.java:300)\n    at org.springframework.boot.logging.logback.LogbackLoggingSystem.lambda$loadConfiguration$2(LogbackLoggingSystem.java:262)\n    ... 24 more\n</code></pre>\n",
    "tags" : [ "java", "spring-boot", "logback" ],
    "owner" : {
      "account_id" : 32708601,
      "reputation" : 1,
      "user_id" : 25422951,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/421846bb569ab6f3329d13dc37043bf2?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "user25422951",
      "link" : "https://stackoverflow.com/users/25422951/user25422951"
    },
    "is_answered" : false,
    "view_count" : 190,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1753387111,
    "creation_date" : 1752759772,
    "link" : "https://stackoverflow.com/questions/79704910/logback-errorjava-lang-illegalstateexception-could-not-initialize-logback-logg",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79713902,
    "question_id" : 79704910,
    "body" : "<p>Logback is recursively expanding nested variables, see <a href=\"https://logback.qos.ch/manual/configuration.html#nestedSubst\" rel=\"nofollow noreferrer\">Chapter 3: Configuration – Nested variables</a>:</p>\n<blockquote>\n<p>Variable nesting is fully supported. Both the name, default-value and value definition of a variable can reference other variables.</p>\n</blockquote>\n<p>After all variables have been replaced, <a href=\"https://logback.qos.ch/manual/layouts.html#ClassicPatternLayout\" rel=\"nofollow noreferrer\">conversion words</a> are substituted.</p>\n<p>If you run your application with <code>LOG_HOME=C:\\Users\\me\\Desktop@￥%......&amp;\\my-app</code>, your FileNamePattern will first resolve to <code>C:\\Users\\me\\Desktop@￥%......&amp;\\my-app-file-name-%d{yyyy-MM-dd}.%i.log</code>. This pattern contains 3 conversion words:</p>\n<ul>\n<li><code>%......&amp;</code></li>\n<li><code>%d{yyyy-MM-dd}</code></li>\n<li><code>%i</code></li>\n</ul>\n<p>the first of which is invalid.</p>\n<p>I have not found anything in the documentation that would suggest that it's possible to disable this behavior.</p>\n<hr />\n<p>PS Configuring a Spring Boot 3.5.4 application with your logback-spring.xml gives me the following warnings, so you might want to check that too</p>\n<pre><code>|-WARN in org.springframework.boot.logging.logback.SpringProfileIfNestedWithinSecondPhaseElementSanityChecker@687ef2e0 - &lt;springProfile&gt; elements cannot be nested within an &lt;appender&gt;, &lt;logger&gt; or &lt;root&gt; element\n|-WARN in org.springframework.boot.logging.logback.SpringProfileIfNestedWithinSecondPhaseElementSanityChecker@687ef2e0 - Element &lt;appender&gt; at line 15 contains a nested &lt;springProfile&gt; element at line 19\n|-WARN in org.springframework.boot.logging.logback.SpringProfileIfNestedWithinSecondPhaseElementSanityChecker@687ef2e0 - Element &lt;appender&gt; at line 15 contains a nested &lt;springProfile&gt; element at line 24\n|-WARN in org.springframework.boot.logging.logback.SpringProfileIfNestedWithinSecondPhaseElementSanityChecker@687ef2e0 - Element &lt;appender&gt; at line 35 contains a nested &lt;springProfile&gt; element at line 43\n|-WARN in org.springframework.boot.logging.logback.SpringProfileIfNestedWithinSecondPhaseElementSanityChecker@687ef2e0 - Element &lt;appender&gt; at line 35 contains a nested &lt;springProfile&gt; element at line 48\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 39208,
      "reputation" : 269427,
      "user_id" : 112968,
      "user_type" : "registered",
      "accept_rate" : 68,
      "profile_image" : "https://i.sstatic.net/zHTaT.png?s=256",
      "display_name" : "knittl",
      "link" : "https://stackoverflow.com/users/112968/knittl"
    },
    "creation_date" : 1753387111,
    "last_activity_date" : 1753387111,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140613405,
    "post_id" : 79704910,
    "body" : "You can escape special characters, like <code>%</code>, from variable <code>LOG_HOME</code>",
    "score" : 0,
    "owner" : {
      "account_id" : 1601399,
      "reputation" : 638,
      "user_id" : 1482356,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d6160b6e40d230fa92c6da8072b2f7e5?s=256&d=identicon&r=PG",
      "display_name" : "Peter Adrian",
      "link" : "https://stackoverflow.com/users/1482356/peter-adrian"
    },
    "creation_date" : 1753307325,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140598640,
    "post_id" : 79704910,
    "body" : "Yes, thanks for the reminder! That was indeed a typo — I’ve corrected scop to scope. Thanks for the suggestion! However, this is a client-side application, and users may install it in directories that contain special characters (like @￥%......&amp;). So I need to make sure the application can handle such cases gracefully, instead of restricting the install path.",
    "score" : 0,
    "owner" : {
      "account_id" : 32708601,
      "reputation" : 1,
      "user_id" : 25422951,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/421846bb569ab6f3329d13dc37043bf2?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "user25422951",
      "link" : "https://stackoverflow.com/users/25422951/user25422951"
    },
    "creation_date" : 1752801797,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140597650,
    "post_id" : 79704910,
    "body" : "Don&#39;t use weird characters in your directory/file names. <code>%</code> might the culprit. &#187;Caused by: java.lang.NumberFormatException: For input string: &quot;.....&amp;/&quot;&#171;",
    "score" : 0,
    "owner" : {
      "account_id" : 39208,
      "reputation" : 269427,
      "user_id" : 112968,
      "user_type" : "registered",
      "accept_rate" : 68,
      "profile_image" : "https://i.sstatic.net/zHTaT.png?s=256",
      "display_name" : "knittl",
      "link" : "https://stackoverflow.com/users/112968/knittl"
    },
    "creation_date" : 1752769638,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140597339,
    "post_id" : 79704910,
    "body" : "I noticed in your logback-spring.xml you have &lt;springProperty scop=&quot;context&quot;. Did you mean <code>scope</code> instead of <code>scop</code>?",
    "score" : 1,
    "owner" : {
      "account_id" : 26698569,
      "reputation" : 4090,
      "user_id" : 20306007,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/98bbc403493aee3681b71dae7abef66e?s=256&d=identicon&r=PG",
      "display_name" : "life888888",
      "link" : "https://stackoverflow.com/users/20306007/life888888"
    },
    "creation_date" : 1752763927,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}