{
  "question" : {
    "question_id" : 79714606,
    "title" : "How to map a list of products in source JSON to a single product in target based on unique ID?",
    "body" : "<p>I am using MapStruct to map data from a source DTO representing a JSON structure that contains a list of products:</p>\n<pre><code>public class SourceDto {\n    List&lt;ProductDto&gt; products;\n}\n</code></pre>\n<p>I want to map it to a target DTO that contains only one product:</p>\n<pre><code>public class Target {\n    Product product;\n}\n</code></pre>\n<p>The mapping should select exactly one product from the source list based on a unique product ID and map that single product into the targetâ€™s product field.\n<a href=\"https://i.sstatic.net/FyWeS0eV.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/FyWeS0eV.png\" alt=\"enter image description here\" /></a></p>\n<p>I have written the code which does the desired mapping:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Mapper(componentModel = &quot;spring&quot; )\npublic interface MainMapper {\n\n    ProductMapper productMapper = Mappers.getMapper(ProductMapper.class);\n\n    @Mapping(source = &quot;.&quot;, target = &quot;product&quot;, qualifiedByName = &quot;mapProduct&quot;)\n    Target map(SourceDto dto);\n\n    @Named(&quot;mapProduct&quot;)\n    default Product mapProduct(SourceDto dto) {\n        ProductDto desiredProduct = filteredProduct(dto);\n        return productMapper.toProduct(desiredProduct);\n    }\n\n    private ProductDto filteredProduct(SourceDto dto) {\n        String desiredId = &quot;numberFromConfig&quot;;\n        List&lt;ProductDto&gt; products= dto.getProducts();\n        return products.stream()\n                .filter(product -&gt; product.getId().equals(desiredId))\n                .findAny()\n                .get();\n    }\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>@Mapper(componentModel = &quot;spring&quot; )\ninterface ProductMapper {\n    @Mapping(target = &quot;name&quot;, source = &quot;name&quot;)\n    Product toProduct(ProductDto dto);\n}\n</code></pre>\n<p>But I do not like the fact that I initialize the nested mapper in the class itself:</p>\n<pre class=\"lang-java prettyprint-override\"><code>ProductMapper productMapper = Mappers.getMapper(ProductMapper.class);\n</code></pre>\n<p>I also tried to use the</p>\n<pre class=\"lang-java prettyprint-override\"><code>Mapper(componentModel = &quot;spring&quot;, uses = {ProductMapper .class })\n</code></pre>\n<p>so that ProductMapper will be injected by spring. But like that I am not able to use it directly in the mapProduct method.\nIs there other elegant way to address this topic? In reality my mapping is much bigger and has much more nested mappers so I wish to avoid to initialize all of them inside the MainMapper class. Also I do not want to map all products in the source list and then choose only one in order to avoid unnecessary calculations.</p>\n",
    "tags" : [ "java", "mapping", "mapstruct" ],
    "owner" : {
      "account_id" : 306540,
      "reputation" : 3196,
      "user_id" : 2695990,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/EVYyd.jpg?s=256",
      "display_name" : "fascynacja",
      "link" : "https://stackoverflow.com/users/2695990/fascynacja"
    },
    "is_answered" : true,
    "view_count" : 88,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1762466748,
    "creation_date" : 1753440643,
    "link" : "https://stackoverflow.com/questions/79714606/how-to-map-a-list-of-products-in-source-json-to-a-single-product-in-target-based",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79811811,
    "question_id" : 79714606,
    "body" : "<p>Your problem boils down to the question: How can you inject a Mapper into the base definition that isn't being used in the implementation?</p>\n<p>The only way to achieve that is:</p>\n<ul>\n<li>Switch the base definition from an interface to an abstract class.</li>\n<li>Inject the desired Mapper using field injection.</li>\n</ul>\n<p>So in your case:</p>\n<pre><code>@Mapper(componentModel = MappingConstants.ComponentModel.SPRING)\npublic abstract class MainMapper {\n  @Autowired\n  private ProductMapper productMapper;\n\n[and so on...]\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 4094217,
      "reputation" : 3294,
      "user_id" : 3361467,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/iEFF40j8.jpg?s=256",
      "display_name" : "Ray",
      "link" : "https://stackoverflow.com/users/3361467/ray"
    },
    "creation_date" : 1762466748,
    "last_activity_date" : 1762466748,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140618037,
    "post_id" : 79714606,
    "body" : "To be honest it doesn&#39;t look like there is more elegant solution. I created simplified version of your question <a href=\"https://stackoverflow.com/questions/79714658/two-step-mapping\">stackoverflow.com/questions/79714658/two-step-mapping</a>, but don&#39;t think it will get an answer.",
    "score" : 1,
    "owner" : {
      "account_id" : 4497436,
      "reputation" : 20796,
      "user_id" : 3656904,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/8bdbd1f89f8907e8e8b15ab88c084c65?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "talex",
      "link" : "https://stackoverflow.com/users/3656904/talex"
    },
    "creation_date" : 1753447193,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140618031,
    "post_id" : 79714606,
    "body" : "@fascynacja I&#39;m not entirely sure it will work. The idea is to create method and make mapstruct to invoke existing method from it by specifying <code>qualifiedByName</code>. I never try it myself and I don&#39;t have proper test environment to try it now.",
    "score" : 0,
    "owner" : {
      "account_id" : 4497436,
      "reputation" : 20796,
      "user_id" : 3656904,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/8bdbd1f89f8907e8e8b15ab88c084c65?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "talex",
      "link" : "https://stackoverflow.com/users/3656904/talex"
    },
    "creation_date" : 1753447092,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140618029,
    "post_id" : 79714606,
    "body" : "@Manu AG. mapstruct based on the interface and the default method, creates later a real implementation and this implemetation can have injected components. I was thinking there might be some solution  using mapstruct annotations which will allow more elegant solution",
    "score" : 0,
    "owner" : {
      "account_id" : 306540,
      "reputation" : 3196,
      "user_id" : 2695990,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/EVYyd.jpg?s=256",
      "display_name" : "fascynacja",
      "link" : "https://stackoverflow.com/users/2695990/fascynacja"
    },
    "creation_date" : 1753447038,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140618017,
    "post_id" : 79714606,
    "body" : "@talex can you elaborate on this proxy method?",
    "score" : 0,
    "owner" : {
      "account_id" : 306540,
      "reputation" : 3196,
      "user_id" : 2695990,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/EVYyd.jpg?s=256",
      "display_name" : "fascynacja",
      "link" : "https://stackoverflow.com/users/2695990/fascynacja"
    },
    "creation_date" : 1753446821,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140617916,
    "post_id" : 79714606,
    "body" : "Another option is to create proxy method <code>@Mapping(source = &quot;dto&quot;, qualifiedByName = &quot;mapProduct&quot;) Target mapProductProxy(SourceDto dto);</code>",
    "score" : 0,
    "owner" : {
      "account_id" : 4497436,
      "reputation" : 20796,
      "user_id" : 3656904,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/8bdbd1f89f8907e8e8b15ab88c084c65?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "talex",
      "link" : "https://stackoverflow.com/users/3656904/talex"
    },
    "creation_date" : 1753444711,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140617868,
    "post_id" : 79714606,
    "body" : "You can inject <code>ProductMapper</code> if you use abstract class instead of interface.",
    "score" : 1,
    "owner" : {
      "account_id" : 4497436,
      "reputation" : 20796,
      "user_id" : 3656904,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/8bdbd1f89f8907e8e8b15ab88c084c65?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "talex",
      "link" : "https://stackoverflow.com/users/3656904/talex"
    },
    "creation_date" : 1753443300,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140617842,
    "post_id" : 79714606,
    "body" : "The problem is that mapProduct is a default method in your interface and default methods cannot have Spring dependencies injected. One option could be to move all your mapProduct and your private method to aonther spring component, and then using that component in your MainMapper interface.",
    "score" : 0,
    "owner" : {
      "account_id" : 5285920,
      "reputation" : 188,
      "user_id" : 4219956,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/34cf438d64df4a253c59f29344ad94dd?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Manu AG",
      "link" : "https://stackoverflow.com/users/4219956/manu-ag"
    },
    "creation_date" : 1753442813,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79811811" : [ {
      "comment_id" : 140842714,
      "post_id" : 79811811,
      "body" : "@fascynacja I know, I don&#39;t really like it either. Field injection is absolutely naughty these days. It&#39;s a known issue in the MapStruct team, but we haven&#39;t come up with a &quot;really nice&quot; solution yet.",
      "score" : 1,
      "owner" : {
        "account_id" : 4094217,
        "reputation" : 3294,
        "user_id" : 3361467,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/iEFF40j8.jpg?s=256",
        "display_name" : "Ray",
        "link" : "https://stackoverflow.com/users/3361467/ray"
      },
      "creation_date" : 1762553157,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140841263,
      "post_id" : 79811811,
      "body" : "@fascynacja the solution works indeed. Yet still If there would be possiblitiy to avoid field injection I would be mor happy!:)",
      "score" : 0,
      "owner" : {
        "account_id" : 306540,
        "reputation" : 3196,
        "user_id" : 2695990,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/EVYyd.jpg?s=256",
        "display_name" : "fascynacja",
        "link" : "https://stackoverflow.com/users/2695990/fascynacja"
      },
      "creation_date" : 1762498972,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140841241,
      "post_id" : 79811811,
      "body" : "I will try this solution, but in the meantime, do you know how to achieve it with the @Autowire on the productMapper field ? I try to keep all my classes inject by  constructor not by field, hence my question.",
      "score" : 0,
      "owner" : {
        "account_id" : 306540,
        "reputation" : 3196,
        "user_id" : 2695990,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/EVYyd.jpg?s=256",
        "display_name" : "fascynacja",
        "link" : "https://stackoverflow.com/users/2695990/fascynacja"
      },
      "creation_date" : 1762497936,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}