{
  "question" : {
    "question_id" : 79641514,
    "title" : "How to escape special characters (&lt;, &gt;, &quot;, &#39;) properly during JSON to XML conversion using Jackson&#39;s XmlMapper in Java?",
    "body" : "<p>I need to escape the following 5 special characters during JSON to XML conversion in Java using XmlMapper from the Jackson library:</p>\n<pre><code>&lt; should be escaped as &amp;lt;\n\n&gt; should be escaped as &amp;gt;\n\n&amp; should be escaped as &amp;amp;\n\n&quot; should be escaped as &amp;quot;\n\n' should be escaped as &amp;apos;\n</code></pre>\n<p>I observed that &lt; and &amp; are automatically escaped by XmlMapper, but the other characters (&gt;, &quot;, ') remain unescaped in the generated XML.</p>\n<p>For example, consider this JSON:</p>\n<pre><code>{\n    &quot;note&quot;: &quot;5 &lt; 10 &gt; 4&quot;\n}\n</code></pre>\n<p>The converted XML output is:</p>\n<pre><code>&lt;note&gt;5 &amp;lt; 10 &gt; 4&lt;/note&gt;\n</code></pre>\n<p>To handle this, I tried pre-escaping the special characters using StringEscapeUtils.escapeXml11() from Apache Commons text, which gives me this JSON:</p>\n<pre><code>    {\n    &quot;note&quot;: &quot;5 &amp;lt; 10 &amp;gt; 4&quot;\n}\n</code></pre>\n<p>But this results in double escaping when passed to XmlMapper, like so:</p>\n<pre><code>&lt;note&gt;5 &amp;amp;lt; 10 &amp;amp;gt; 4&lt;/note&gt;\n</code></pre>\n<p>So my question is:\nHow can I properly escape all 5 special characters during JSON to XML conversion without causing double escaping due to XmlMapper's default behavior?</p>\n<p>Any suggestions or best practices are appreciated.</p>\n",
    "tags" : [ "java", "json", "xml", "jackson", "xmlmapper" ],
    "owner" : {
      "account_id" : 24335692,
      "reputation" : 19,
      "user_id" : 18273792,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/448cbca9eaad09329b0862c3244eb611?s=256&d=identicon&r=PG",
      "display_name" : "Professor",
      "link" : "https://stackoverflow.com/users/18273792/professor"
    },
    "is_answered" : true,
    "view_count" : 277,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1748411162,
    "creation_date" : 1748407380,
    "link" : "https://stackoverflow.com/questions/79641514/how-to-escape-special-characters-properly-during-json-to-xml-conver",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79641565,
    "question_id" : 79641514,
    "body" : "<p>In short, Jackson handles XML escaping partially, and for anything beyond that you'll either need manual pre-processing or a custom serializer.</p>\n<p>This behavior is consistent with Jackson's use of the Woodstox XML generator,\nwhich follows standard XML escaping rules and doesn't treat <code>&gt;</code> or <code>'</code> as characters\nthat require escaping in element content.</p>\n<p>See details here: <a href=\"https://github.com/FasterXML/jackson-dataformat-xml/issues/61\" rel=\"nofollow noreferrer\">https://github.com/FasterXML/jackson-dataformat-xml/issues/61</a>.</p>\n<p>Jackson's XmlMapper doesn't fully escape all special XML characters. It handles <code>&lt;</code> and <code>&amp;</code> in element text, and <code>&quot;</code> in attribute values, but it does not escape <code>&gt;</code>, <code>'</code>, or <code>&quot;</code>\nin element content.</p>\n<p>So if you pre-escape all 5 characters (e.g. using <code>StringEscapeUtils.escapeXml11()</code>),\nJackson escapes them again, resulting in things like <code>&amp;amp;gt;</code>.</p>\n<p>You can use the following approach - manually escape only what Jackson does not escape, like this:</p>\n<pre><code>private String sanitizeForXml(String input) {\n    return input\n        .replace(&quot;&gt;&quot;, &quot;&amp;gt;&quot;)\n        .replace(&quot;\\&quot;&quot;, &quot;&amp;quot;&quot;)\n        .replace(&quot;'&quot;, &quot;&amp;apos;&quot;);\n}\n</code></pre>\n<p>This avoids double-escaping.</p>\n<p>Also, you can write a custom <code>XmlSerializer&lt;String&gt;</code> if you need full control.</p>\n",
    "score" : 3,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 38931631,
      "reputation" : 671,
      "user_id" : 29023248,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/WxoZEuKw.png?s=256",
      "display_name" : "Aleksey Bykov",
      "link" : "https://stackoverflow.com/users/29023248/aleksey-bykov"
    },
    "creation_date" : 1748411162,
    "last_activity_date" : 1748411162,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140468640,
    "post_id" : 79641514,
    "body" : "If your downstream code doesn&#39;t parse <code>&lt;note&gt;5 &amp;lt; 10 &gt; 4&lt;&#47;note&gt;</code> as well-formed, then you have a serious problem. Basically, it means you&#39;re not using XML, you&#39;re using some non-standard variant of XML.",
    "score" : 2,
    "owner" : {
      "account_id" : 529122,
      "reputation" : 164983,
      "user_id" : 415448,
      "user_type" : "registered",
      "accept_rate" : 33,
      "profile_image" : "https://i.sstatic.net/P2vVZ.png?s=256",
      "display_name" : "Michael Kay",
      "link" : "https://stackoverflow.com/users/415448/michael-kay"
    },
    "creation_date" : 1748506597,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140467192,
    "post_id" : 79641514,
    "body" : "Iâ€™m afraid your downstream is defective.  From <a href=\"https://www.w3.org/TR/1998/REC-xml-19980210#syntax\" rel=\"nofollow noreferrer\">the XML specification</a>: The right angle bracket (&gt;) may be represented using the string &quot;<code>&amp;gt;</code>&quot;, and must, for compatibility, be escaped using &quot;<code>&amp;gt;</code>&quot; or a character reference when it appears in the string &quot;<code>]]&gt;</code>&quot; in content, when that string is not marking the end of a CDATA section.",
    "score" : 2,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44991,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1748457885,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140465421,
    "post_id" : 79641514,
    "body" : "Hi @MichaelKay in my project our downstream is not processing the XML that is being generated, Its throwing XML is not well formed error with this default jackson escaping behaviour. There were some values with special characters inside XML tags.  Thats why we got this requirement and im confused and landed here.",
    "score" : 0,
    "owner" : {
      "account_id" : 24335692,
      "reputation" : 19,
      "user_id" : 18273792,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/448cbca9eaad09329b0862c3244eb611?s=256&d=identicon&r=PG",
      "display_name" : "Professor",
      "link" : "https://stackoverflow.com/users/18273792/professor"
    },
    "creation_date" : 1748425456,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140465243,
    "post_id" : 79641514,
    "body" : "Why do you need to escape all 5 special characters, given that any conformant XML parser will accept the XML that Jackson is generating? Escaping of <code>&gt;</code> is not necessary unless it is part of the sequence <code>]]&gt;</code>, and escaping of quotation marks (single or double) is needed only in attributes. If you have a downstream process that doesn&#39;t accept the XML that is being generated, then that process is non-conformant with the XML specification.",
    "score" : 2,
    "owner" : {
      "account_id" : 529122,
      "reputation" : 164983,
      "user_id" : 415448,
      "user_type" : "registered",
      "accept_rate" : 33,
      "profile_image" : "https://i.sstatic.net/P2vVZ.png?s=256",
      "display_name" : "Michael Kay",
      "link" : "https://stackoverflow.com/users/415448/michael-kay"
    },
    "creation_date" : 1748421991,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79641565" : [ {
      "comment_id" : 140465267,
      "post_id" : 79641565,
      "body" : "You&#39;re absolutely right - Jackson does everything required to generate well-formed and valid XML per the spec. My point was if extra escaping is needed (e.g. for visual consistency, interoperability with non-compliant parsers, or downstream display in HTML contexts), Jackson doesn&#39;t provide that OOTB - and that&#39;s where manual or custom serialization comes in. Thanks for clarifying the spec-compliance aspect - that&#39;s an important distinction.",
      "score" : 0,
      "owner" : {
        "account_id" : 38931631,
        "reputation" : 671,
        "user_id" : 29023248,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/WxoZEuKw.png?s=256",
        "display_name" : "Aleksey Bykov",
        "link" : "https://stackoverflow.com/users/29023248/aleksey-bykov"
      },
      "creation_date" : 1748422537,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140465237,
      "post_id" : 79641565,
      "body" : "This response isn&#39;t quite correct. Jackson is doing all the escaping that is necessary to produce well-formed XML that will be accepted by any XML parser. It isn&#39;t doing optional escaping that some users (including it seems the OP) would like to have done. but which is actually unnecessary.",
      "score" : 2,
      "owner" : {
        "account_id" : 529122,
        "reputation" : 164983,
        "user_id" : 415448,
        "user_type" : "registered",
        "accept_rate" : 33,
        "profile_image" : "https://i.sstatic.net/P2vVZ.png?s=256",
        "display_name" : "Michael Kay",
        "link" : "https://stackoverflow.com/users/415448/michael-kay"
      },
      "creation_date" : 1748421852,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}