{
  "question" : {
    "question_id" : 79591307,
    "title" : "Problem Starting Tomcat 9.0.104 inside Windows EC2 instance with Launch template",
    "body" : "<p>I am trying to upgrade my tomcat version from 9.0.21 to 9.0.104. The EC2 instance is created via a Powershell script launch template. When I start the instance I use chocolately to install Java and Tomcat. I then copy the war file from S3 into the webapps folder and try to start Tomcat. The service seems to start but the war file is never unpacked and local host returns a 404. I am able to RDP into the instance and restart Tomcat. This deploys the war file and I see the unpacked application in the webapps folder, the server then deploys the application. I have not changed my server.xml or web.xml from the defaults.\n<a href=\"https://i.sstatic.net/v8N7dEZo.png\" rel=\"nofollow noreferrer\">500 error</a></p>\n<pre><code> 24-Apr-2025 13:58:18.640 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server version name:   Apache Tomcat/9.0.104\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server built:          Apr 4 2025 12:32:55 UTC\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server version number: 9.0.104.0\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log OS Name:               Windows Server 2019\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log OS Version:            10.0\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Architecture:          amd64\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Java Home:             C:\\Program Files\\Eclipse Adoptium\\jdk-8.0.442.6-hotspot\\jre\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log JVM Version:           1.8.0_442-b06\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log JVM Vendor:            Temurin\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log CATALINA_BASE:         C:\\ProgramData\\Tomcat9\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log CATALINA_HOME:         C:\\ProgramData\\chocolatey\\lib\\tomcat\\tools\\apache-tomcat-9.0.104\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Dcatalina.home=C:\\ProgramData\\chocolatey\\lib\\Tomcat\\tools\\apache-tomcat-9.0.104\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Dcatalina.base=C:\\ProgramData\\Tomcat9\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Dignore.endorsed.dirs=C:\\ProgramData\\chocolatey\\lib\\Tomcat\\tools\\apache-tomcat-9.0.104\\endorsed\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Djava.io.tmpdir=C:\\ProgramData\\Tomcat9\\temp\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Djava.util.logging.config.file=C:\\ProgramData\\Tomcat9\\conf\\logging.properties\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Dsun.io.useCanonCaches=false\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: exit\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: abort\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Xms128m\n24-Apr-2025 13:58:18.656 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Command line argument: -Xmx256m\n24-Apr-2025 13:58:18.672 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent Loaded Apache Tomcat Native library [1.3.1] using APR version [1.7.4].\n24-Apr-2025 13:58:18.672 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent APR capabilities: IPv6 [true], sendfile [true], accept filters [false], random [true], UDS [true].\n24-Apr-2025 13:58:18.672 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent APR/OpenSSL configuration: useAprConnector [false], useOpenSSL [true]\n24-Apr-2025 13:58:18.687 INFO [main] org.apache.catalina.core.AprLifecycleListener.initializeSSL OpenSSL successfully initialized [OpenSSL 3.0.14 4 Jun 2024]\n24-Apr-2025 13:58:19.375 INFO [main] org.apache.coyote.AbstractProtocol.init Initializing ProtocolHandler [&quot;http-nio-8080&quot;]\n24-Apr-2025 13:58:19.531 INFO [main] org.apache.catalina.startup.Catalina.load Server initialization in [1919] milliseconds\n24-Apr-2025 13:58:19.641 INFO [main] org.apache.catalina.core.StandardService.startInternal Starting service [Catalina]\n24-Apr-2025 13:58:19.641 INFO [main] org.apache.catalina.core.StandardEngine.startInternal Starting Servlet engine: [Apache Tomcat/9.0.104]\n24-Apr-2025 13:58:19.641 SEVERE [main] org.apache.catalina.startup.HostConfig.beforeStart Unable to create directory for deployment: [C:\\ProgramData\\Tomcat9\\conf\\Catalina\\localhost]\n24-Apr-2025 13:58:19.969 INFO [main] org.apache.catalina.startup.HostConfig.deployWAR Deploying web application archive [C:\\ProgramData\\Tomcat9\\webapps\\sample_app.war]\n24-Apr-2025 13:58:20.172 SEVERE [main] org.apache.catalina.startup.ContextConfig.beforeStart Exception fixing docBase for context [/sample_app]\n    java.io.IOException: Unable to create the directory [C:\\ProgramData\\Tomcat9\\webapps\\sample_app]\n        at org.apache.catalina.startup.ExpandWar.expand(ExpandWar.java:111)\n        at org.apache.catalina.startup.ContextConfig.fixDocBase(ContextConfig.java:812)\n        at org.apache.catalina.startup.ContextConfig.beforeStart(ContextConfig.java:948)\n        at org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:292)\n        at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:109)\n        at org.apache.catalina.util.LifecycleBase.setStateInternal(LifecycleBase.java:389)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:163)\n        at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:599)\n        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:571)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:603)\n        at org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:1012)\n        at org.apache.catalina.startup.HostConfig$DeployWar.run(HostConfig.java:1860)\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266)\n        at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:76)\n        at java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:112)\n        at org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:817)\n        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:468)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1578)\n        at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:312)\n        at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:109)\n        at org.apache.catalina.util.LifecycleBase.setStateInternal(LifecycleBase.java:389)\n        at org.apache.catalina.util.LifecycleBase.setState(LifecycleBase.java:336)\n        at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:776)\n        at org.apache.catalina.core.StandardHost.startInternal(StandardHost.java:721)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)\n        at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1203)\n        at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1193)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266)\n        at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:76)\n        at java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:134)\n        at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:749)\n        at org.apache.catalina.core.StandardEngine.startInternal(StandardEngine.java:211)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)\n        at org.apache.catalina.core.StandardService.startInternal(StandardService.java:412)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)\n        at org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:874)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:739)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:498)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:345)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:476)\n24-Apr-2025 13:58:20.187 WARNING [main] org.apache.catalina.core.StandardContext.postWorkDirectory Failed to create work directory [C:\\ProgramData\\Tomcat9\\work\\Catalina\\localhost\\sample_app] for context [/sample_app]\n24-Apr-2025 13:58:25.752 SEVERE [main] org.apache.catalina.startup.HostConfig.deployWAR Error deploying web application archive [C:\\ProgramData\\Tomcat9\\webapps\\sample_app.war]\n    java.lang.IllegalStateException: Error starting child\n        at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:602)\n        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:571)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:603)\n        at org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:1012)\n        at org.apache.catalina.startup.HostConfig$DeployWar.run(HostConfig.java:1860)\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266)\n        at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:76)\n        at java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:112)\n        at org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:817)\n        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:468)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1578)\n        at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:312)\n        at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:109)\n        at org.apache.catalina.util.LifecycleBase.setStateInternal(LifecycleBase.java:389)\n        at org.apache.catalina.util.LifecycleBase.setState(LifecycleBase.java:336)\n        at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:776)\n        at org.apache.catalina.core.StandardHost.startInternal(StandardHost.java:721)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)\n        at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1203)\n        at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1193)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266)\n        at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:76)\n        at java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:134)\n        at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:749)\n        at org.apache.catalina.core.StandardEngine.startInternal(StandardEngine.java:211)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)\n        at org.apache.catalina.core.StandardService.startInternal(StandardService.java:412)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)\n        at org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:874)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:739)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:498)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:345)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:476)\n    Caused by: org.apache.catalina.LifecycleException: Failed to start component [StandardEngine[Catalina].StandardHost[localhost].StandardContext[/sample_app]]\n        at org.apache.catalina.util.LifecycleBase.handleSubClassException(LifecycleBase.java:406)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:179)\n        at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:599)\n        ... 37 more\n    Caused by: javax.xml.parsers.FactoryConfigurationError: Provider for class javax.xml.parsers.SAXParserFactory cannot be created\n        at javax.xml.parsers.FactoryFinder.findServiceProvider(FactoryFinder.java:311)\n        at javax.xml.parsers.FactoryFinder.find(FactoryFinder.java:267)\n        at javax.xml.parsers.SAXParserFactory.newInstance(SAXParserFactory.java:126)\n        at org.apache.tomcat.util.digester.Digester.getFactory(Digester.java:557)\n        at org.apache.tomcat.util.digester.Digester.getParser(Digester.java:709)\n        at org.apache.tomcat.util.descriptor.web.WebXmlParser.&lt;init&gt;(WebXmlParser.java:62)\n        at org.apache.catalina.startup.ContextConfig.webConfig(ContextConfig.java:1235)\n        at org.apache.catalina.startup.ContextConfig.configureStart(ContextConfig.java:972)\n        at org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:290)\n        at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:109)\n        at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:4407)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:164)\n        ... 38 more\n    Caused by: java.lang.RuntimeException: Provider for class javax.xml.parsers.SAXParserFactory cannot be created\n        at javax.xml.parsers.FactoryFinder.findServiceProvider(FactoryFinder.java:308)\n        ... 49 more\n    Caused by: java.util.ServiceConfigurationError: javax.xml.parsers.SAXParserFactory: Error reading configuration file\n        at java.util.ServiceLoader.fail(ServiceLoader.java:232)\n        at java.util.ServiceLoader.parse(ServiceLoader.java:309)\n        at java.util.ServiceLoader.access$200(ServiceLoader.java:185)\n        at java.util.ServiceLoader$LazyIterator.hasNextService(ServiceLoader.java:357)\n        at java.util.ServiceLoader$LazyIterator.hasNext(ServiceLoader.java:393)\n        at java.util.ServiceLoader$1.hasNext(ServiceLoader.java:474)\n        at javax.xml.parsers.FactoryFinder$1.run(FactoryFinder.java:293)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.xml.parsers.FactoryFinder.findServiceProvider(FactoryFinder.java:289)\n        ... 49 more\n    Caused by: java.nio.file.AccessDeniedException: C:\\ProgramData\\Tomcat9\\temp\\jar_cache2394488715692089381.tmp\n        at sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:83)\n        at sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:97)\n        at sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:102)\n        at sun.nio.fs.WindowsFileSystemProvider.newByteChannel(WindowsFileSystemProvider.java:230)\n        at java.nio.file.Files.newByteChannel(Files.java:361)\n        at java.nio.file.Files.createFile(Files.java:632)\n        at java.nio.file.TempFileHelper.create(TempFileHelper.java:138)\n        at java.nio.file.TempFileHelper.createTempFile(TempFileHelper.java:161)\n        at java.nio.file.Files.createTempFile(Files.java:897)\n        at sun.net.www.protocol.jar.URLJarFile$1.run(URLJarFile.java:218)\n        at sun.net.www.protocol.jar.URLJarFile$1.run(URLJarFile.java:216)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at sun.net.www.protocol.jar.URLJarFile.retrieve(URLJarFile.java:215)\n        at sun.net.www.protocol.jar.URLJarFile.getJarFile(URLJarFile.java:71)\n        at sun.net.www.protocol.jar.JarFileFactory.get(JarFileFactory.java:109)\n        at sun.net.www.protocol.jar.JarURLConnection.connect(JarURLConnection.java:122)\n        at sun.net.www.protocol.jar.JarURLConnection.getInputStream(JarURLConnection.java:152)\n        at java.net.URL.openStream(URL.java:1093)\n        at java.util.ServiceLoader.parse(ServiceLoader.java:304)\n        ... 56 more\n24-Apr-2025 13:58:25.752 INFO [main] org.apache.catalina.startup.HostConfig.deployWAR Deployment of web application archive [C:\\ProgramData\\Tomcat9\\webapps\\sample_app.war] has finished in [5,783] ms\n24-Apr-2025 13:58:25.752 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory [C:\\ProgramData\\Tomcat9\\webapps\\docs]\n24-Apr-2025 13:58:25.767 WARNING [main] org.apache.catalina.core.StandardContext.postWorkDirectory Failed to create work directory [C:\\ProgramData\\Tomcat9\\work\\Catalina\\localhost\\docs] for context [/docs]\n24-Apr-2025 13:58:26.065 SEVERE [main] org.apache.jasper.EmbeddedServletOptions.&lt;init&gt; The scratchDir you specified: [C:\\ProgramData\\Tomcat9\\work\\Catalina\\localhost\\docs] is unusable.\n24-Apr-2025 13:58:26.096 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [C:\\ProgramData\\Tomcat9\\webapps\\docs] has finished in [344] ms\n24-Apr-2025 13:58:26.096 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory [C:\\ProgramData\\Tomcat9\\webapps\\examples]\n24-Apr-2025 13:58:26.111 WARNING [main] org.apache.catalina.core.StandardContext.postWorkDirectory Failed to create work directory [C:\\ProgramData\\Tomcat9\\work\\Catalina\\localhost\\examples] for context [/examples]\n24-Apr-2025 13:58:26.987 SEVERE [main] org.apache.jasper.EmbeddedServletOptions.&lt;init&gt; The scratchDir you specified: [C:\\ProgramData\\Tomcat9\\work\\Catalina\\localhost\\examples] is unusable.\n24-Apr-2025 13:58:26.987 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [C:\\ProgramData\\Tomcat9\\webapps\\examples] has finished in [891] ms\n24-Apr-2025 13:58:26.987 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory [C:\\ProgramData\\Tomcat9\\webapps\\host-manager]\n24-Apr-2025 13:58:27.002 WARNING [main] org.apache.catalina.core.StandardContext.postWorkDirectory Failed to create work directory [C:\\ProgramData\\Tomcat9\\work\\Catalina\\localhost\\host-manager] for context [/host-manager]\n24-Apr-2025 13:58:27.065 SEVERE [main] org.apache.jasper.EmbeddedServletOptions.&lt;init&gt; The scratchDir you specified: [C:\\ProgramData\\Tomcat9\\work\\Catalina\\localhost\\host-manager] is unusable.\n24-Apr-2025 13:58:27.065 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [C:\\ProgramData\\Tomcat9\\webapps\\host-manager] has finished in [78] ms\n24-Apr-2025 13:58:27.065 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory [C:\\ProgramData\\Tomcat9\\webapps\\manager]\n24-Apr-2025 13:58:27.065 WARNING [main] org.apache.catalina.core.StandardContext.postWorkDirectory Failed to create work directory [C:\\ProgramData\\Tomcat9\\work\\Catalina\\localhost\\manager] for context [/manager]\n24-Apr-2025 13:58:27.174 SEVERE [main] org.apache.jasper.EmbeddedServletOptions.&lt;init&gt; The scratchDir you specified: [C:\\ProgramData\\Tomcat9\\work\\Catalina\\localhost\\manager] is unusable.\n24-Apr-2025 13:58:27.174 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [C:\\ProgramData\\Tomcat9\\webapps\\manager] has finished in [109] ms\n24-Apr-2025 13:58:27.174 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory [C:\\ProgramData\\Tomcat9\\webapps\\ROOT]\n24-Apr-2025 13:58:27.190 WARNING [main] org.apache.catalina.core.StandardContext.postWorkDirectory Failed to create work directory [C:\\ProgramData\\Tomcat9\\work\\Catalina\\localhost\\ROOT] for context []\n24-Apr-2025 13:58:27.331 SEVERE [main] org.apache.jasper.EmbeddedServletOptions.&lt;init&gt; The scratchDir you specified: [C:\\ProgramData\\Tomcat9\\work\\Catalina\\localhost\\ROOT] is unusable.\n24-Apr-2025 13:58:27.346 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [C:\\ProgramData\\Tomcat9\\webapps\\ROOT] has finished in [172] ms\n24-Apr-2025 13:58:27.346 INFO [main] org.apache.coyote.AbstractProtocol.start Starting ProtocolHandler [&quot;http-nio-8080&quot;]\n24-Apr-2025 13:58:27.393 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in [7866] milliseconds\n24-Apr-2025 14:00:22.866 SEVERE [http-nio-8080-exec-5] org.apache.jasper.JspCompilationContext.createOutputDir Unable to create output directory [C:\\ProgramData\\Tomcat9\\work\\Catalina\\localhost\\ROOT\\org\\apache\\jsp\\] required for JSP compilation\n</code></pre>\n<p>Here Is the relevant part of the powershell script</p>\n<pre><code>    #install java 8\nchoco install temurin8 -y\nif($env:JAVA_HOME -eq $null){\n    $folderName = Get-ChildItem -Path &quot;C:\\Program Files\\Eclipse Adoptium&quot; -Directory | select Name \n    $path = &quot;C:\\Program Files\\Eclipse Adoptium\\&quot; + $folderName.Name + &quot;\\&quot;\n    Write-Host &quot;Setting env variable JAVA_HOME&quot;\n    [Environment]::SetEnvironmentVariable(&quot;JAVA_HOME&quot;, $path, [EnvironmentVariableTarget]::Machine)\n}\n$timenow = Get-Date -Format &quot;MM/dd/yyyy HH:mm:ss&quot;; $message = &quot;Java 8 has installed at &quot; + $timenow ; Write-Output $message &gt;&gt; $Logfile\n\n#install Tomcat 9\nchoco install tomcat --version=9.0.104 -y\n$timenow = Get-Date -Format &quot;MM/dd/yyyy HH:mm:ss&quot;; $message = &quot;Tomcat 9 has installed at &quot; + $timenow ; Write-Output $message &gt;&gt; $Logfile\n\n#configuration Tomcat\n$Filename_index_jsp = &quot;C:\\ProgramData\\Tomcat9\\webapps\\ROOT\\index.jsp&quot;\nSet-Content $Filename_index_jsp '&lt;html lang=&quot;en&quot;&gt;\n    &lt;head&gt;\n        &lt;meta http-equiv=&quot;refresh&quot; content=&quot;0;url=/sample_app/&quot;/&gt;\n    &lt;/head&gt;\n&lt;/html&gt;'\n\n$Filename_context_xml = &quot;C:\\ProgramData\\Tomcat9\\conf\\context.xml&quot;\nSet-Content $Filename_context_xml '&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;!--\n  Licensed to the Apache Software Foundation (ASF) under one or more\n  contributor license agreements.  See the NOTICE file distributed with\n  this work for additional information regarding copyright ownership.\n  The ASF licenses this file to You under the Apache License, Version 2.0\n  (the &quot;License&quot;); you may not use this file except in compliance with\n  the License.  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n--&gt;\n&lt;!-- The contents of this file will be loaded for each web application --&gt;\n&lt;Context&gt;\n\n    &lt;!-- Default set of monitored resources. If one of these changes, the    --&gt;\n    &lt;!-- web application will be reloaded.                                   --&gt;\n    &lt;WatchedResource&gt;WEB-INF/web.xml&lt;/WatchedResource&gt;\n    &lt;WatchedResource&gt;WEB-INF/tomcat-web.xml&lt;/WatchedResource&gt;\n    &lt;WatchedResource&gt;$${catalina.base}/conf/web.xml&lt;/WatchedResource&gt;\n    &lt;CookieProcessor className=&quot;org.apache.tomcat.util.http.LegacyCookieProcessor&quot; /&gt;\n\n    &lt;!-- Uncomment this to disable session persistence across Tomcat restarts --&gt;\n    &lt;!--\n    &lt;Manager pathname=&quot;&quot; /&gt;\n    --&gt;\n&lt;/Context&gt;'\n\n$timenow = Get-Date -Format &quot;MM/dd/yyyy HH:mm:ss&quot;; $message = &quot;Tomcat 9 is running at &quot; + $timenow ; Write-Output $message &gt;&gt; $Logfile\n\n#get application from s3\nCopy-S3Object -BucketName &quot;${rendered_aws_s3_bucket_app}&quot; -Key &quot;${rendered_aws_ec2_app_artefact_name}&quot; -LocalFile &quot;/${rendered_aws_ec2_app_artefact_name}&quot;\n#Copy-S3Object -BucketName &quot;${rendered_aws_s3_bucket_app}&quot; -Key &quot;sample_app-1.0.zip&quot; -LocalFile &quot;/sample_app-1.0.zip&quot;\nExpand-Archive c:\\${rendered_aws_ec2_app_artefact_name} -DestinationPath c:\\sample_app-1.0\n#Expand-Archive c:\\sample_app-1.0.zip -DestinationPath c:\\sample_app-1.0\nmv C:\\sample_app-1.0\\opt C:\\\nmv C:\\sample_app-1.0\\sample_app.war C:\\ProgramData\\Tomcat9\\webapps\\\nStart-Service -Name Tomcat9\n</code></pre>\n",
    "tags" : [ "java", "tomcat", "amazon-ec2" ],
    "owner" : {
      "account_id" : 41598349,
      "reputation" : 1,
      "user_id" : 30364823,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3e5952cf36550c490c2052f686eaa57f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Josh Morris",
      "link" : "https://stackoverflow.com/users/30364823/josh-morris"
    },
    "is_answered" : false,
    "view_count" : 185,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1746196578,
    "creation_date" : 1745521664,
    "link" : "https://stackoverflow.com/questions/79591307/problem-starting-tomcat-9-0-104-inside-windows-ec2-instance-with-launch-template",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79603582,
    "question_id" : 79591307,
    "body" : "<p>I finally figured it out for anyone wondering it was related to this question <a href=\"https://stackoverflow.com/questions/59929708/tomcat-service-gets-installed-with-local-service-account\">Tomcat Service gets installed with &quot;Local Service&quot; account</a></p>\n<p>Long story short sometime after Tomcat 9.0.30 there was a change to Commons Daemon</p>\n<pre><code>Commons Daemon 1.2.0 onwards will default to running the service as the LocalService user rather than LocalSystem. That will break a default Tomcat install via the installer since LocalService won't have the necessary rights to the work dir for JSPs to work (and there may be a bunch of other issues too).\n</code></pre>\n<p>I was able to adjust my script to update the service before starting and everything is working again.</p>\n<pre><code>PowerShell\n\ncmd.exe /c &quot;tomcat9 //US//Tomcat9 --ServiceUser=LocalSystem&quot;\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 41598349,
      "reputation" : 1,
      "user_id" : 30364823,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3e5952cf36550c490c2052f686eaa57f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Josh Morris",
      "link" : "https://stackoverflow.com/users/30364823/josh-morris"
    },
    "creation_date" : 1746196578,
    "last_activity_date" : 1746196578,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140368219,
    "post_id" : 79591307,
    "body" : "Why don&#39;t you print the user in the shell script? It can be done with:  Write-Output &quot;Current user: $env:USERNAME&quot;",
    "score" : 0,
    "owner" : {
      "account_id" : 26746848,
      "reputation" : 453,
      "user_id" : 20346807,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/ALm5wu3JY7zmtBLIKO51iCoerZOU2SjkVZ97Khtr_zmC=k-s256",
      "display_name" : "Joan",
      "link" : "https://stackoverflow.com/users/20346807/joan"
    },
    "creation_date" : 1745568379,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140367562,
    "post_id" : 79591307,
    "body" : "Yes I agree I do think it is a permission issue, but as far as I know when you start and EC2 instance with a launch template it runs as root user. Tomcat is able to start and deploy fine with 9.0.21. I have not changed anything except the version so hoping someone can give me some ideas.",
    "score" : 0,
    "owner" : {
      "account_id" : 41598349,
      "reputation" : 1,
      "user_id" : 30364823,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3e5952cf36550c490c2052f686eaa57f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Josh Morris",
      "link" : "https://stackoverflow.com/users/30364823/josh-morris"
    },
    "creation_date" : 1745543187,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140367418,
    "post_id" : 79591307,
    "body" : "Read the root exception of the stacktrace, seems that there is permissions issue: <code>AccessDeniedException: C:\\ProgramData\\Tomcat9\\temp\\jar_cache2394488715692089381.tmp</code>",
    "score" : 0,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1745536123,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140366966,
    "post_id" : 79591307,
    "body" : "I&#39;m pretty sure the user is different. The script looks just fine.",
    "score" : 0,
    "owner" : {
      "account_id" : 26746848,
      "reputation" : 453,
      "user_id" : 20346807,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/ALm5wu3JY7zmtBLIKO51iCoerZOU2SjkVZ97Khtr_zmC=k-s256",
      "display_name" : "Joan",
      "link" : "https://stackoverflow.com/users/20346807/joan"
    },
    "creation_date" : 1745523795,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140366956,
    "post_id" : 79591307,
    "body" : "I added the relevant parts of the powershell script. When I log on to the EC2 instance it is with the administrator role. I think that the launch template would be using admin as well. This seems to be something new because the 9.0.21 version of tomcat still starts normally",
    "score" : 0,
    "owner" : {
      "account_id" : 41598349,
      "reputation" : 1,
      "user_id" : 30364823,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3e5952cf36550c490c2052f686eaa57f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Josh Morris",
      "link" : "https://stackoverflow.com/users/30364823/josh-morris"
    },
    "creation_date" : 1745523675,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140366930,
    "post_id" : 79591307,
    "body" : "Can you share the script that copies the war from S3 and starts the tomcat? Are you using the same user when you deploy it automatically and when you deploy it manually?",
    "score" : 0,
    "owner" : {
      "account_id" : 26746848,
      "reputation" : 453,
      "user_id" : 20346807,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/ALm5wu3JY7zmtBLIKO51iCoerZOU2SjkVZ97Khtr_zmC=k-s256",
      "display_name" : "Joan",
      "link" : "https://stackoverflow.com/users/20346807/joan"
    },
    "creation_date" : 1745522870,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}