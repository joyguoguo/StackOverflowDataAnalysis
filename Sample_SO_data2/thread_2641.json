{
  "question" : {
    "question_id" : 79609210,
    "title" : "Aws cross-account backup copy and restoration failing due to insufficient privileges",
    "body" : "<p>I am creating backups of my DynamoDB tables using AWS Backup in my source account A and storing the recovery point ARNs in a vault named X in source account A .</p>\n<p>I need to copy and restore the backup in another account named B. I am following the steps below, but my process is failing with the error:</p>\n<blockquote>\n<p>software.amazon.awssdk.services.backup.model.BackupException: Insufficient privileges to perform this action. (Service: Backup, Status Code: 403)</p>\n</blockquote>\n<p>Steps to recreate:</p>\n<ol>\n<li>Create backup and store the backup in vault X in account A.</li>\n<li>Give permission to target account B to perform action &quot;CopyFromBackupVault&quot; using    the vault access policy for vault X of source account.</li>\n</ol>\n<pre><code>         {\n      &quot;Version&quot;: &quot;2012-10-17&quot;,\n      &quot;Statement&quot;: [\n        {\n          &quot;Effect&quot;: &quot;Allow&quot;,\n          &quot;Principal&quot;: {\n            &quot;AWS&quot;: &quot;arn:aws:iam::account_B_id:root&quot;\n          },\n          &quot;Action&quot;: &quot;backup:CopyFromBackupVault&quot;,\n          &quot;Resource&quot;: &quot;*&quot;\n        }\n      ]\n</code></pre>\n<ol start=\"3\">\n<li>Give permission to source account A to perform action &quot;CopyIntoBackupVault&quot; using the vault access policy for vault Y of target account.</li>\n</ol>\n<pre><code>    {\n      &quot;Version&quot;: &quot;2012-10-17&quot;,\n      &quot;Statement&quot;: [\n        {\n          &quot;Effect&quot;: &quot;Allow&quot;,\n          &quot;Principal&quot;: {\n            &quot;AWS&quot;: [&quot;arn:aws:iam::account_A_id:root&quot;,\n                    &quot;arn:aws:iam::account_B_id:root&quot;]\n          },\n          &quot;Action&quot;: &quot;backup:CopyIntoBackupVault&quot;,\n          &quot;Resource&quot;: &quot;*&quot;\n        }\n      ]\n    }\n</code></pre>\n<ol start=\"4\">\n<li><p>After these steps from target account B, I am initiating the copy job but it is failing with error with error &gt; software.amazon.awssdk.services.backup.model.BackupException: Insufficient privileges to perform this action. (Service: Backup, Status Code: 403).</p>\n</li>\n<li><p>Restore backup (Not able to reach this step)</p>\n</li>\n</ol>\n<p>Please note, the role I am using has all the permissions required to perform backup actions. I reckon the issue lies in the vault access policies . Please help. Thank you!</p>\n<p>I have tried every step mentioned in the AWS documentation that I could find. I have checked with ChatGPT but nothing resolved my issue.</p>\n<p>I am expecting my backup to be copied and then restored without any issue.</p>\n",
    "tags" : [ "java", "amazon-web-services", "amazon-dynamodb", "backup", "aws-backup" ],
    "owner" : {
      "account_id" : 41820614,
      "reputation" : 13,
      "user_id" : 30464645,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5c59b437e9d576a78f0e08c75fac7261?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Shivansh Kaldaik",
      "link" : "https://stackoverflow.com/users/30464645/shivansh-kaldaik"
    },
    "is_answered" : true,
    "view_count" : 257,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1746729674,
    "creation_date" : 1746552825,
    "link" : "https://stackoverflow.com/questions/79609210/aws-cross-account-backup-copy-and-restoration-failing-due-to-insufficient-privil",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79610554,
    "question_id" : 79609210,
    "body" : "<p>Creating a cross-account copy of a recovery point from AWS Backup requires the correct access policies on both source and destination vault, correct IAM role with policies that allows to create a copy job and cross-account backup to be enabled within the <a href=\"https://docs.aws.amazon.com/aws-backup/latest/devguide/create-cross-account-backup.html#prereq-cab\" rel=\"nofollow noreferrer\">Organization's management account</a>.</p>\n<p>From the details provided in the comments, you seem to have everything except enabling cross-account backup within the AWS Organization. This can be done from the Management Account, within the AWS Backup console under <strong>My account</strong> and <strong>Settings</strong>.</p>\n<p>Lastly, two final points to check, the destination vault <a href=\"https://docs.aws.amazon.com/aws-backup/latest/devguide/create-cross-account-backup.html#designate-destination-accounts-cab\" rel=\"nofollow noreferrer\">cannot be the default vault</a> of the account and the copy job must be started from the source account.</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 8452211,
      "reputation" : 961,
      "user_id" : 6340707,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/sOLxK.jpg?s=256",
      "display_name" : "PeskyPotato",
      "link" : "https://stackoverflow.com/users/6340707/peskypotato"
    },
    "creation_date" : 1746621762,
    "last_activity_date" : 1746688841,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140402563,
    "post_id" : 79609210,
    "body" : "Okay , i will try this and the copy job should be initiated from the source account or target account . Based on the doc you sent with steps for cross account backup, I reckon it should be the source account which should initiate the copy job",
    "score" : 0,
    "owner" : {
      "account_id" : 41820614,
      "reputation" : 13,
      "user_id" : 30464645,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5c59b437e9d576a78f0e08c75fac7261?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Shivansh Kaldaik",
      "link" : "https://stackoverflow.com/users/30464645/shivansh-kaldaik"
    },
    "creation_date" : 1746594128,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140402017,
    "post_id" : 79609210,
    "body" : "I believe you need to call the Java API for this: <a href=\"https://docs.aws.amazon.com/cli/latest/reference/backup/update-global-settings.html\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/cli/latest/reference/backup/&hellip;</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 10749774,
      "reputation" : 20494,
      "user_id" : 7909676,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/50Vga.jpg?s=256",
      "display_name" : "Leeroy Hannigan",
      "link" : "https://stackoverflow.com/users/7909676/leeroy-hannigan"
    },
    "creation_date" : 1746568739,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140401941,
    "post_id" : 79609210,
    "body" : "I see , I got your point regarding enablement of target account backup vault to allow backup from source account. I am doing that using the vault policy for target account backup vault. Please see step 3 in the description. I believe CopyIntoBackupVault action is sufficient in this case. Isn&#39;t it??",
    "score" : 0,
    "owner" : {
      "account_id" : 41820614,
      "reputation" : 13,
      "user_id" : 30464645,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5c59b437e9d576a78f0e08c75fac7261?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Shivansh Kaldaik",
      "link" : "https://stackoverflow.com/users/30464645/shivansh-kaldaik"
    },
    "creation_date" : 1746566199,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140401877,
    "post_id" : 79609210,
    "body" : "Have a look at the steps here: <a href=\"https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/copy-amazon-dynamodb-tables-across-accounts-using-aws-backup.html\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/prescriptive-guidance/latest/patterns/&hellip;</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 10749774,
      "reputation" : 20494,
      "user_id" : 7909676,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/50Vga.jpg?s=256",
      "display_name" : "Leeroy Hannigan",
      "link" : "https://stackoverflow.com/users/7909676/leeroy-hannigan"
    },
    "creation_date" : 1746564959,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140401714,
    "post_id" : 79609210,
    "body" : "Leeroy one more thing I would like to mention I am doing all the steps using java code not via aws console or cli. This info might not be very relevant but still thought of sharing.",
    "score" : 0,
    "owner" : {
      "account_id" : 41820614,
      "reputation" : 13,
      "user_id" : 30464645,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5c59b437e9d576a78f0e08c75fac7261?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Shivansh Kaldaik",
      "link" : "https://stackoverflow.com/users/30464645/shivansh-kaldaik"
    },
    "creation_date" : 1746560880,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140401711,
    "post_id" : 79609210,
    "body" : "Sorry, i did not understand, what do you mean by enable vaults from other accounts??",
    "score" : 0,
    "owner" : {
      "account_id" : 41820614,
      "reputation" : 13,
      "user_id" : 30464645,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5c59b437e9d576a78f0e08c75fac7261?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Shivansh Kaldaik",
      "link" : "https://stackoverflow.com/users/30464645/shivansh-kaldaik"
    },
    "creation_date" : 1746560734,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140401693,
    "post_id" : 79609210,
    "body" : "And in the destination account, you enabled vaults from other accounts?",
    "score" : 0,
    "owner" : {
      "account_id" : 10749774,
      "reputation" : 20494,
      "user_id" : 7909676,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/50Vga.jpg?s=256",
      "display_name" : "Leeroy Hannigan",
      "link" : "https://stackoverflow.com/users/7909676/leeroy-hannigan"
    },
    "creation_date" : 1746560143,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140401610,
    "post_id" : 79609210,
    "body" : "Hello Leeroy  !  Yes , both are in same AWS Organization .",
    "score" : 0,
    "owner" : {
      "account_id" : 41820614,
      "reputation" : 13,
      "user_id" : 30464645,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5c59b437e9d576a78f0e08c75fac7261?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Shivansh Kaldaik",
      "link" : "https://stackoverflow.com/users/30464645/shivansh-kaldaik"
    },
    "creation_date" : 1746558077,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140401445,
    "post_id" : 79609210,
    "body" : "Are both accounts in the same AWS Organization?",
    "score" : 0,
    "owner" : {
      "account_id" : 10749774,
      "reputation" : 20494,
      "user_id" : 7909676,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/50Vga.jpg?s=256",
      "display_name" : "Leeroy Hannigan",
      "link" : "https://stackoverflow.com/users/7909676/leeroy-hannigan"
    },
    "creation_date" : 1746553967,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79610554" : [ {
      "comment_id" : 140406683,
      "post_id" : 79610554,
      "body" : "@ShivanshKaldaik Glad to see you have solved the problem, and thank you for letting me know about the source account restriction. I forgot to mention that in my comment, so I&#39;ve edit it with that detail for completeness.",
      "score" : 0,
      "owner" : {
        "account_id" : 8452211,
        "reputation" : 961,
        "user_id" : 6340707,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/sOLxK.jpg?s=256",
        "display_name" : "PeskyPotato",
        "link" : "https://stackoverflow.com/users/6340707/peskypotato"
      },
      "creation_date" : 1746689012,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140405454,
      "post_id" : 79610554,
      "body" : "Hello and thank you ! Yes there were two issues actually . 1.) I didn&#39;t enable cross account backup within AWS organization . I have done this now they way you described. 2.) I was initiating my copy job from target account but it should be initiated from source account.",
      "score" : 0,
      "owner" : {
        "account_id" : 41820614,
        "reputation" : 13,
        "user_id" : 30464645,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/5c59b437e9d576a78f0e08c75fac7261?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Shivansh Kaldaik",
        "link" : "https://stackoverflow.com/users/30464645/shivansh-kaldaik"
      },
      "creation_date" : 1746646230,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}