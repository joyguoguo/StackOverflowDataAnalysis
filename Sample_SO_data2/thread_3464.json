{
  "question" : {
    "question_id" : 79549949,
    "title" : "How to properly get output from shell cmd in Java?",
    "body" : "<p>I installed mysql in a docker container, and tried to run this Java code to get some variable value:</p>\n<pre><code>String[] cmd = new String[] {&quot;docker&quot;, &quot;exec&quot;, &quot;my&quot;, &quot;mysql&quot;, &quot;-p123456&quot;, &quot;-e&quot;, &quot;select @@report_host\\\\G&quot;};\nPair&lt;Integer, String&gt; result = this.execForExitCode(cmd);\nString[] lines = result.getRight().split(&quot;\\n&quot;);\nlog.info(&quot;getDbReportHost:&quot;);\nfor (String line : lines) {\n    log.info(line);\n}\n</code></pre>\n<pre><code>    private Pair&lt;Integer, String&gt; execForExitCode(String[] command) {\n        try {\n            Process process = new ProcessBuilder(command).inheritIO().start();\n            String rst = new String(process.getInputStream().readAllBytes(), StandardCharsets.UTF_8);\n            return Pair.of(process.waitFor(), rst);\n        } catch (Exception e) {\n            throw new RuntimeException(e);\n        }\n    }\n</code></pre>\n<p>But got nothing.</p>\n<p>Instead, if I run the command directly on the console:</p>\n<pre><code>docker exec -it my mysql -uroot -p123456 -e &quot;select @@report_host\\G&quot;\n</code></pre>\n<p>I get this output:</p>\n<pre><code>*************************** 1. row ***************************\n@@report_host: 10.15.100.95\n</code></pre>\n<p>And this is what I want.</p>\n<p>So what's wrong with my Java code?</p>\n",
    "tags" : [ "java", "mysql" ],
    "owner" : {
      "account_id" : 9287961,
      "reputation" : 193,
      "user_id" : 6897210,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5b4d6ce4868c2288919a9c52d7fca29f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Calvin_Z",
      "link" : "https://stackoverflow.com/users/6897210/calvin-z"
    },
    "is_answered" : false,
    "view_count" : 84,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1743580162,
    "creation_date" : 1743578812,
    "link" : "https://stackoverflow.com/questions/79549949/how-to-properly-get-output-from-shell-cmd-in-java",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79550000,
    "question_id" : 79549949,
    "body" : "<p>maybe  missing <code>-uroot</code>  and <code>\\G</code> is used interactive mode, so try this</p>\n<pre class=\"lang-java prettyprint-override\"><code>\nString[] cmd = new String[] {\n    &quot;docker&quot;, &quot;exec&quot;, &quot;my&quot;, &quot;mysql&quot;, &quot;-uroot&quot;, &quot;-p123456&quot;, &quot;-e&quot;, &quot;SELECT @@report_host;&quot;\n};\n\nPair&lt;Integer, String&gt; result = this.execForExitCode(cmd);\nlog.info(&quot;getDbReportHost: {}&quot;, result.getRight());\n\n\n\n\nprivate Pair&lt;Integer, String&gt; execForExitCode(String[] command) {\n    try {\n        ProcessBuilder pb = new ProcessBuilder(command);\n        pb.redirectErrorStream(true); // adovid thread  blocked\n        Process process = pb.start();\n\n        // read line by line advoid , thread  blocked\n        StringBuilder result = new StringBuilder();\n        try (BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream(), StandardCharsets.UTF_8))) {\n            String line;\n            while ((line = reader.readLine()) != null) {\n                result.append(line).append(&quot;\\n&quot;);\n            }\n        }\n\n        int exitCode = process.waitFor();\n        return Pair.of(exitCode, result.toString().trim()); \n    } catch (Exception e) {\n        throw new RuntimeException(e);\n    }\n}\n\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 27097454,
      "reputation" : 1395,
      "user_id" : 20644506,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/3U94H.jpg?s=256",
      "display_name" : "Peng",
      "link" : "https://stackoverflow.com/users/20644506/peng"
    },
    "creation_date" : 1743580162,
    "last_activity_date" : 1743580162,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140289847,
    "post_id" : 79549949,
    "body" : "It&#39;s important to consum all streams/chanels, for further details have a look on my blog post: <a href=\"https://thilosdevblog.wordpress.com/2022/09/18/how-to-properly-handle-the-output-of-the-processbuilder/\" rel=\"nofollow noreferrer\">thilosdevblog.wordpress.com/2022/09/18/&hellip;</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 5273740,
      "reputation" : 834,
      "user_id" : 4211252,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-87ivl3B4PjA/AAAAAAAAAAI/AAAAAAAAAGA/QtBp_y12AcE/s256-rj/photo.jpg",
      "display_name" : "Thilo Schwarz",
      "link" : "https://stackoverflow.com/users/4211252/thilo-schwarz"
    },
    "creation_date" : 1743588826,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140289343,
    "post_id" : 79549949,
    "body" : "@Abra You are right. <code>inheritIO()</code> redirects the output to my Java console.",
    "score" : 0,
    "owner" : {
      "account_id" : 9287961,
      "reputation" : 193,
      "user_id" : 6897210,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5b4d6ce4868c2288919a9c52d7fca29f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Calvin_Z",
      "link" : "https://stackoverflow.com/users/6897210/calvin-z"
    },
    "creation_date" : 1743581696,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140289295,
    "post_id" : 79549949,
    "body" : "You don&#39;t want <code>inheritIO()</code> if you want to capture the command output. Notice that the <a href=\"https://stackoverflow.com/questions/79549725/spring-rest-log4j2-xml-dynamic-log-level-based-on-response-code/79550024#79550024\">answer</a> does <b>not</b> use that.",
    "score" : 1,
    "owner" : {
      "account_id" : 2485939,
      "reputation" : 20969,
      "user_id" : 2164365,
      "user_type" : "registered",
      "accept_rate" : 40,
      "profile_image" : "https://i.sstatic.net/RKSgV.png?s=256",
      "display_name" : "Abra",
      "link" : "https://stackoverflow.com/users/2164365/abra"
    },
    "creation_date" : 1743580970,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140289272,
    "post_id" : 79549949,
    "body" : "Are you sure that this output comes at the output channel, not the error channel? You might want to try <code>getErrorStream()</code> instead of <code>getInputStream()</code> to see if this is the case.",
    "score" : 0,
    "owner" : {
      "account_id" : 25466,
      "reputation" : 37067,
      "user_id" : 65464,
      "user_type" : "registered",
      "accept_rate" : 93,
      "profile_image" : "https://www.gravatar.com/avatar/d1fc3a85db4ff7618a7639742f356b3b?s=256&d=identicon&r=PG",
      "display_name" : "Erich Kitzmueller",
      "link" : "https://stackoverflow.com/users/65464/erich-kitzmueller"
    },
    "creation_date" : 1743580600,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}