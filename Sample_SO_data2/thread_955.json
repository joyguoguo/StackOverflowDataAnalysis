{
  "question" : {
    "question_id" : 79760849,
    "title" : "javax.websocket Client provides false values in messages",
    "body" : "<p>I try to use javax.websocket Client to test a wss connection.\nTo establish the login, system accepts follow message:</p>\n<pre><code>{\n&quot;RequestType&quot;: &quot;Login&quot;,\n&quot;Language&quot;: &quot;en&quot;,\n&quot;Name&quot;: &quot;QA&quot;,\n&quot;Token&quot;:&quot;KA==&quot;\n}\n</code></pre>\n<p>I have tested it in the Postman and all works well.</p>\n<p>Now I try to do it using <code>javax.websocket Client</code>, I have simplefied the code and place it in one method to demonstrate the issue:</p>\n<pre class=\"lang-java prettyprint-override\"><code>    public static void main(String[] args) throws DeploymentException, IOException, InterruptedException {\n        WebSocketContainer container = ContainerProvider.getWebSocketContainer();\n        TradeWebSocketClient client = new TradeWebSocketClient();\n        ClientEndpointConfig config = ClientEndpointConfig.Builder.create().build();\n        container.connectToServer(client, config, URI.create(&quot;wss://name.domain.com:8899/&quot;));\n\n        // Send login message after connection\n        String loginMessage = String.format(&quot;&quot;&quot;\n                {\n                  &quot;RequestType&quot;: &quot;Login&quot;,\n                  &quot;Language&quot;: &quot;en&quot;,\n                  &quot;Name&quot;: &quot;QA&quot;,\n                  &quot;Token&quot;: &quot;dLI==&quot;\n                }\n                &quot;&quot;&quot;);\n\n        Session session = client.getSession();\n        session.getBasicRemote().sendText(loginMessage);\n        Thread.sleep(10000);\n        client.getReceivedMessages().forEach(System.out::println);\n    }\n</code></pre>\n<p>The TradeWebSocketClient main points:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@ClientEndpoint\npublic class TradeWebSocketClient extends Endpoint {\n\n    private final List&lt;String&gt; receivedMessages = new CopyOnWriteArrayList&lt;&gt;();\n    @Getter\n    private Session session;\n\n    @OnOpen\n    public void onOpen(Session session, EndpointConfig config) {\n        this.session = session;\n        session.addMessageHandler((MessageHandler.Whole&lt;Object&gt;) this::onMessageImpl);\n        System.out.println(&quot;✅ Connected to WebSocket&quot;);\n        System.out.println(&quot;Session: &quot; + session);\n    }\n\n    @OnMessage\n    public void onMessageImpl(Object message) { //I have changed String to Object because I was getting errors when `String` tried to accept the `boolean` value\n        System.out.println(&quot;\uD83D\uDCE8 Received: &quot; + message);\n        receivedMessages.add(String.valueOf(message));\n    }\n</code></pre>\n<p>So, logs are saying that session is successfully created, the message handler is added, but in the result I am receiving a boolean <code>false</code> value. There is a log:</p>\n<pre><code>✅ Connected to WebSocket\nSession: TyrusSession{uri=wss://name.domain.com:8899/, id='8dcda03-52af-47bf-63d5-bea247b58a81', endpointWrapper=TyrusEndpointWrapper{endpointClass=null, endpoint=org.example.TradeWebSocketClient@3df4b32a, contextPath='wss://name.domain.com:8899/', endpointPath=null, encoders=[CoderWrapper{coderClass=class org.glassfish.tyrus.core.coder.NoOpTextCoder, coder=org.glassfish.tyrus.core.coder.NoOpTextCoder@379ad06b, type=class java.lang.String}, CoderWrapper{coderClass=class org.glassfish.tyrus.core.coder.NoOpByteBufferCoder, coder=org.glassfish.tyrus.core.coder.NoOpByteBufferCoder@7afcc557, type=class java.nio.ByteBuffer}, CoderWrapper{coderClass=class org.glassfish.tyrus.core.coder.NoOpByteArrayCoder, coder=org.glassfish.tyrus.core.coder.NoOpByteArrayCoder@695f60da, type=class [B}, CoderWrapper{coderClass=class org.glassfish.tyrus.core.coder.ToStringEncoder, coder=org.glassfish.tyrus.core.coder.ToStringEncoder@71aae338, type=class java.lang.Object}], decoders=[CoderWrapper{coderClass=class org.glassfish.tyrus.core.coder.PrimitiveDecoders$BooleanDecoder, coder=org.glassfish.tyrus.core.coder.PrimitiveDecoders$BooleanDecoder@10d26cee, type=class java.lang.Boolean}, CoderWrapper{coderClass=class org.glassfish.tyrus.core.coder.PrimitiveDecoders$ByteDecoder, coder=org.glassfish.tyrus.core.coder.PrimitiveDecoders$ByteDecoder@c18d5de, type=class java.lang.Byte}, CoderWrapper{coderClass=class org.glassfish.tyrus.core.coder.PrimitiveDecoders$CharacterDecoder, coder=org.glassfish.tyrus.core.coder.PrimitiveDecoders$CharacterDecoder@1ed32d37, type=class java.lang.Character}, CoderWrapper{coderClass=class org.glassfish.tyrus.core.coder.PrimitiveDecoders$DoubleDecoder, coder=org.glassfish.tyrus.core.coder.PrimitiveDecoders$DoubleDecoder@38c6bef6, type=class java.lang.Double}, CoderWrapper{coderClass=class org.glassfish.tyrus.core.coder.PrimitiveDecoders$FloatDecoder, coder=org.glassfish.tyrus.core.coder.PrimitiveDecoders$FloatDecoder@3b70001c, type=class java.lang.Float}, CoderWrapper{coderClass=class org.glassfish.tyrus.core.coder.PrimitiveDecoders$IntegerDecoder, coder=org.glassfish.tyrus.core.coder.PrimitiveDecoders$IntegerDecoder@718c8489, type=class java.lang.Integer}, CoderWrapper{coderClass=class org.glassfish.tyrus.core.coder.PrimitiveDecoders$LongDecoder, coder=org.glassfish.tyrus.core.coder.PrimitiveDecoders$LongDecoder@76b1b51a, type=class java.lang.Long}, CoderWrapper{coderClass=class org.glassfish.tyrus.core.coder.PrimitiveDecoders$ShortDecoder, coder=org.glassfish.tyrus.core.coder.PrimitiveDecoders$ShortDecoder@7b0d8434, type=class java.lang.Short}, CoderWrapper{coderClass=class org.glassfish.tyrus.core.coder.NoOpTextCoder, coder=org.glassfish.tyrus.core.coder.NoOpTextCoder@40460ba9, type=class java.lang.String}, CoderWrapper{coderClass=class org.glassfish.tyrus.core.coder.NoOpByteBufferCoder, coder=org.glassfish.tyrus.core.coder.NoOpByteBufferCoder@557b77e4, type=class java.nio.ByteBuffer}, CoderWrapper{coderClass=class org.glassfish.tyrus.core.coder.NoOpByteArrayCoder, coder=org.glassfish.tyrus.core.coder.NoOpByteArrayCoder@2e990134, type=class [B}, CoderWrapper{coderClass=class org.glassfish.tyrus.core.coder.ReaderDecoder, coder=org.glassfish.tyrus.core.coder.ReaderDecoder@39221cf7, type=class java.io.Reader}, CoderWrapper{coderClass=class org.glassfish.tyrus.core.coder.InputStreamDecoder, coder=org.glassfish.tyrus.core.coder.InputStreamDecoder@49c94339, type=class java.io.InputStream}]}}\n\uD83D\uDCE8 Received: false\n\uD83D\uDCE8 Received: false\n\uD83D\uDCE8 Received: false\nfalse\nfalse\nfalse\n</code></pre>\n<p>Moreover, I checked if the connection is established correctly when I broke the token, and yes - I get a connection error, i.e. with a correct token the connection is established correctly, but I have no idea why the messages are incorrect.</p>\n",
    "tags" : [ "java", "websocket" ],
    "owner" : {
      "account_id" : 13429807,
      "reputation" : 2093,
      "user_id" : 9689945,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/3GiQHFhl.jpg?s=256",
      "display_name" : "hhrzc",
      "link" : "https://stackoverflow.com/users/9689945/hhrzc"
    },
    "is_answered" : true,
    "view_count" : 62,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1757591915,
    "creation_date" : 1757506439,
    "link" : "https://stackoverflow.com/questions/79760849/javax-websocket-client-provides-false-values-in-messages",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79761879,
    "question_id" : 79760849,
    "body" : "<p>An anonymous inner class is used to register the MessageHandler. This avoids strange type conversions.</p>\n<pre><code>import jakarta.websocket.ClientEndpoint;\nimport jakarta.websocket.Endpoint;\nimport jakarta.websocket.EndpointConfig;\nimport jakarta.websocket.MessageHandler;\nimport jakarta.websocket.OnMessage;\nimport jakarta.websocket.OnOpen;\nimport jakarta.websocket.Session;\nimport lombok.Getter;\n\nimport java.util.List;\nimport java.util.concurrent.CopyOnWriteArrayList;\n\n@ClientEndpoint\npublic class TradeWebSocketClient extends Endpoint {\n\n    @Getter\n    private final List&lt;String&gt; receivedMessages = new CopyOnWriteArrayList&lt;&gt;();\n    \n    @Getter\n    private Session session;\n\n    @OnOpen\n    public void onOpen(Session session, EndpointConfig config) {\n        this.session = session;\n        //session.addMessageHandler((MessageHandler.Whole&lt;Object&gt;) this::onMessageImpl);\n       \n        session.addMessageHandler(new MessageHandler.Whole&lt;String&gt;() {\n            @Override\n            public void onMessage(String message) {\n                System.out.println(&quot;\uD83D\uDCE8 Received: &quot; + message);\n                receivedMessages.add(String.valueOf(message));\n            }\n        });      \n        \n        System.out.println(&quot;✅ Connected to WebSocket&quot;);\n        System.out.println(&quot;Session: &quot; + session);\n    }\n\n/*\n    @OnMessage\n    public void onMessageImpl(String message) {\n        System.out.println(&quot;\uD83D\uDCE8 Received: &quot; + message);\n        receivedMessages.add(String.valueOf(message));\n    }\n*/    \n}\n</code></pre>\n<p>How to Debug?</p>\n<ol>\n<li>Set up a simulated test environment</li>\n</ol>\n<ul>\n<li>JDK 17</li>\n<li>Tomcat 10.1</li>\n</ul>\n<ol start=\"2\">\n<li>Create WSS Server (demo-wss-server)</li>\n</ol>\n<ul>\n<li>Provides a WSS chat server that responds to messages.</li>\n<li>Provides index.html as a WSS web client, which can display messages sent by the server to all clients.</li>\n<li>Logs all received messages</li>\n</ul>\n<ol start=\"3\">\n<li>Create WSS Client (demo-wss-client)</li>\n</ol>\n<ul>\n<li>A Java application to test connecting to the WSS chat server.</li>\n</ul>\n<p>Once the above verification works without issues:</p>\n<ol start=\"4\">\n<li>Create ST_trade-wss-client</li>\n</ol>\n<ul>\n<li>Test using the user’s own code to connect to demo-wss-server.</li>\n<li>Reproduces the user’s error.</li>\n<li>Check the server log to confirm the server receives the correct content.</li>\n<li>Check the open <code>index.html</code> to confirm the server’s response is correct.</li>\n</ul>\n<ol start=\"5\">\n<li>Compare the MessageHandler implementation</li>\n</ol>\n<ul>\n<li>Compare demo-wss-client’s MessageHandler with TradeWebSocketClient’s MessageHandler.</li>\n<li>Use the demo-wss-client MessageHandler implementation code.</li>\n</ul>\n<ol start=\"6\">\n<li>Test</li>\n</ol>\n<ul>\n<li>The issue of returning a Boolean object no longer occurs.</li>\n</ul>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 26698569,
      "reputation" : 4090,
      "user_id" : 20306007,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/98bbc403493aee3681b71dae7abef66e?s=256&d=identicon&r=PG",
      "display_name" : "life888888",
      "link" : "https://stackoverflow.com/users/20306007/life888888"
    },
    "creation_date" : 1757590965,
    "last_activity_date" : 1757591915,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79761879" : [ {
      "comment_id" : 140729600,
      "post_id" : 79761879,
      "body" : "Amazing. Your first statement turned out to be accurate! I only removed the lambda expression usage and all works well! New experience from you - now I&#39;ll know the danger of using such approach, thank you!",
      "score" : 0,
      "owner" : {
        "account_id" : 13429807,
        "reputation" : 2093,
        "user_id" : 9689945,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/3GiQHFhl.jpg?s=256",
        "display_name" : "hhrzc",
        "link" : "https://stackoverflow.com/users/9689945/hhrzc"
      },
      "creation_date" : 1757604361,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}