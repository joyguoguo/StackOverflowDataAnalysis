{
  "question" : {
    "question_id" : 79594365,
    "title" : "How to use groupby collectors while modifying the values",
    "body" : "<p>I'm preparing for a test and in preparation I was looking at <a href=\"https://stackoverflow.com/questions/60953297/find-the-max-value-of-the-same-length-nails-after-hammered/79594280#79594280\">this question</a>, which I want to rewrite in the stream / collector way.\nThe assignment is a wooden plank with nails hammered in. The nails are equal length and in order of depth hammered in the plank. The question is with a given argument of N nails to hit down (sticking further out) return the max size of the subset of equally sunken nails.</p>\n<pre><code> 1 1 2 3 3 4 4 4 4 4 5 5 10\n --------------------------\n</code></pre>\n<p>With N is 3, I can hammer nails with height 5 and 10 down so I have <strong>8</strong> nails with length 4 sticking out the wood. With N=8 I can hammer all nails down after 3 and end up with <strong>10</strong>.</p>\n<p>Most of the answers are not using the collectors, which I think is a valid solution. And I used the groupby collector to return a map with the nail length, and the number of nails with that lengt. In example above:</p>\n<pre><code>1  2\n2  1\n3  2\n4  5\n5  2\n10 1\n</code></pre>\n<p>With the following code I can do the grouping:</p>\n<pre><code>Map&lt;Integer, Long&gt; grouped = nails.stream().collect(Collectors.groupingBy(Function.identity()\n            , Collectors.counting()));\n</code></pre>\n<p>And then going over the map via streamed entry set I can apply the &quot;hammer&quot; logic:</p>\n<pre><code>return grouped.entrySet().stream().map(e -&gt; e.getValue().intValue()\n            + Math.min(toHit\n               , size - (nails.indexOf(e.getKey()) + e.getValue().intValue())))\n            .max(Integer::compare).get();\n</code></pre>\n<p>with <code>toHit</code> the number of nails to hit (N), and size the total amount of nails in the plank.</p>\n<p>I'm now looking for a way to apply the &quot;hammer&quot; logic in the groupby statement. But I get a bit lost in the <code>Collectors</code> lambda method. How can I add a number to the counted values? And how can I access the identity value used for the key?</p>\n",
    "tags" : [ "java", "java-stream" ],
    "owner" : {
      "account_id" : 108612,
      "reputation" : 10138,
      "user_id" : 288190,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/34b029e4b2ce362e4fc54a2456c5636c?s=256&d=identicon&r=PG",
      "display_name" : "dr jerry",
      "link" : "https://stackoverflow.com/users/288190/dr-jerry"
    },
    "is_answered" : true,
    "view_count" : 115,
    "answer_count" : 1,
    "score" : 2,
    "last_activity_date" : 1745759610,
    "creation_date" : 1745698303,
    "link" : "https://stackoverflow.com/questions/79594365/how-to-use-groupby-collectors-while-modifying-the-values",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79595061,
    "question_id" : 79594365,
    "body" : "<p>You can use <code>Collectors.collectingAndThen</code>, but then you need to keep a list of the grouped values so you can access the nail index later</p>\n<pre class=\"lang-java prettyprint-override\"><code>int maxSubset = Collections.max(\n        nails.stream().collect(Collectors.groupingBy(\n           Function.identity(), \n           Collectors.collectingAndThen(\n              Collectors.toList(), \n              list -&gt; list.size() + Math.min(toHit\n               , size - (nails.indexOf(list.get(0)) + list.size()))))\n        ).values()\n      );\n</code></pre>\n",
    "score" : 3,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 1595031,
      "reputation" : 1880,
      "user_id" : 1477418,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Cerxn.jpg?s=256",
      "display_name" : "Islam Elbanna",
      "link" : "https://stackoverflow.com/users/1477418/islam-elbanna"
    },
    "creation_date" : 1745759610,
    "last_activity_date" : 1745759610,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}