{
  "question" : {
    "question_id" : 79584912,
    "title" : "Java implementation that matches Excel&#39;s YIELD() function results",
    "body" : "<p>How can I implement a function in Java that performs the exact same calculation as Excel's YIELD function ( <a href=\"https://support.microsoft.com/en-us/office/yield-function-f5f5ca43-c4bd-434f-8bd2-ed3c9727a4fe\" rel=\"nofollow noreferrer\">the docs</a>). I looked at the specification of the YIELD function and tried to implement it myself, but I get different results when using the following inputs:</p>\n<p><strong>Settlement: 21/04/2025</strong></p>\n<p><strong>Maturity: 08/12/2027</strong></p>\n<p><strong>Rate: 0.06875</strong></p>\n<p><strong>Price: 94.28</strong></p>\n<p><strong>Redemption: 100</strong></p>\n<p><strong>Frequency: 1</strong></p>\n<p>Gives <strong>9.499084%</strong>  but I expected <strong>9.723637 %</strong></p>\n<p>Here is <strong>MY</strong> code:</p>\n<pre><code>import java.math.BigDecimal;\nimport java.math.MathContext;\nimport java.math.RoundingMode;\nimport java.time.LocalDate;\nimport java.time.temporal.ChronoUnit;\n\npublic static BigDecimal rendementTitre(\n            LocalDate settlementDate,\n            LocalDate maturityDate,\n            BigDecimal taux,\n            BigDecimal prix,\n            BigDecimal valeurNominale,\n            int frequence,\n            MathContext mc,\n            BigDecimal tol,\n            int maxIter\n    ) {\n        long daysBetween = ChronoUnit.DAYS.between(settlementDate, maturityDate);\n        BigDecimal years = new BigDecimal(daysBetween).divide(BigDecimal.valueOf(365), mc);\n        int n = years.multiply(BigDecimal.valueOf(frequence)).setScale(0, RoundingMode.HALF_UP).intValue();\n        BigDecimal coupon = valeurNominale.multiply(taux).divide(BigDecimal.valueOf(frequence), mc);\n\n        // Initial guess\n        BigDecimal y = taux;\n\n        for (int iter = 0; iter &lt; maxIter; iter++) {\n            BigDecimal f = bondPrice(y, n, coupon, valeurNominale, frequence, mc).subtract(prix, mc);\n            BigDecimal fPrime = bondPriceDerivative(y, n, coupon, valeurNominale, frequence, mc);\n\n            if (fPrime.abs().compareTo(new BigDecimal(&quot;1E-10&quot;)) &lt; 0) break;\n\n            BigDecimal yNew = y.subtract(f.divide(fPrime, mc), mc);\n\n            if (y.subtract(yNew).abs().compareTo(tol) &lt; 0) {\n                System.out.println(&quot;Rendement : &quot; + yNew + &quot; YY%&quot;);\n                return yNew.multiply(BigDecimal.valueOf(100)).setScale(6, RoundingMode.HALF_UP); // % avec 6 décimales\n            }\n\n            y = yNew;\n        }\n\n        throw new RuntimeException(&quot;La convergence n'a pas été atteinte&quot;);\n    }\n\n    private static BigDecimal bondPrice(BigDecimal y, int n, BigDecimal C, BigDecimal V, int f, MathContext mc) {\n        BigDecimal total = BigDecimal.ZERO;\n        BigDecimal onePlusRate = BigDecimal.ONE.add(y.divide(BigDecimal.valueOf(f), mc));\n\n        for (int i = 1; i &lt;= n; i++) {\n            BigDecimal denom = onePlusRate.pow(i, mc);\n            total = total.add(C.divide(denom, mc), mc);\n        }\n\n        BigDecimal lastDenom = onePlusRate.pow(n, mc);\n        total = total.add(V.divide(lastDenom, mc), mc);\n        return total;\n    }\n\n    private static BigDecimal bondPriceDerivative(BigDecimal y, int n, BigDecimal C, BigDecimal V, int f, MathContext mc) {\n        BigDecimal total = BigDecimal.ZERO;\n        BigDecimal onePlusRate = BigDecimal.ONE.add(y.divide(BigDecimal.valueOf(f), mc));\n\n        for (int i = 1; i &lt;= n; i++) {\n            BigDecimal denom = onePlusRate.pow(i + 1, mc);\n            BigDecimal term = BigDecimal.valueOf(-i).multiply(C).divide(BigDecimal.valueOf(f), mc).divide(denom, mc);\n            total = total.add(term, mc);\n        }\n\n        BigDecimal lastTerm = BigDecimal.valueOf(-n).multiply(V).divide(BigDecimal.valueOf(f), mc)\n                .divide(onePlusRate.pow(n + 1, mc), mc);\n        total = total.add(lastTerm, mc);\n\n        return total;\n    }\n\npublic static void main(String[] args) {\n        LocalDate settlement = LocalDate.now();\n        LocalDate maturity = LocalDate.of(2027, 12, 8);\n\n        BigDecimal taux = new BigDecimal(&quot;0.06875&quot;);\n        BigDecimal prix = new BigDecimal(&quot;94.28&quot;);\n        BigDecimal valeurNominale = new BigDecimal(&quot;100&quot;);\n\n        MathContext mc = new MathContext(20, RoundingMode.HALF_UP);\n        BigDecimal tol = new BigDecimal(&quot;1E-8&quot;);\n\n        BigDecimal rendement = rendementTitre(\n                settlement,\n                maturity,\n                taux,\n                prix,\n                valeurNominale,\n                2,  // Semestriel\n                mc,\n                tol,\n                100\n        );\n\n        System.out.println(&quot;Rendement : &quot; + rendement + &quot; %&quot;);\n}\n}\n</code></pre>\n<p>with this exemple the consol print 9.499084 %<br />\nbut the Excel show 9.723637%</p>\n",
    "tags" : [ "java", "excel", "finance" ],
    "owner" : {
      "account_id" : 25654509,
      "reputation" : 9,
      "user_id" : 19421186,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3f8046eb7f344531ae5b01cd05770b8b?s=256&d=identicon&r=PG",
      "display_name" : "Cheikh Ibra YADE",
      "link" : "https://stackoverflow.com/users/19421186/cheikh-ibra-yade"
    },
    "is_answered" : false,
    "view_count" : 116,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1745256247,
    "creation_date" : 1745250590,
    "link" : "https://stackoverflow.com/questions/79584912/java-implementation-that-matches-excels-yield-function-results",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140362920,
    "post_id" : 79584912,
    "body" : "Well that would explain it - using august 12th 2027 for maturity date in excel and dec 8th 2027 in code ( <code>LocalDate.of(2027, 12, 8); </code> -  <code>LocalDate.of(year,month,dayOfMonth)</code> is the signature.",
    "score" : 0,
    "owner" : {
      "account_id" : 3212023,
      "reputation" : 1614,
      "user_id" : 17856705,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/OoOsD.png?s=256",
      "display_name" : "Computable",
      "link" : "https://stackoverflow.com/users/17856705/computable"
    },
    "creation_date" : 1745437701,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140362543,
    "post_id" : 79584912,
    "body" : "@Computable I saw your comment. Just to confirm, I didn’t mix up the dates — I did use August 12th (12/08), not the other way around.",
    "score" : 0,
    "owner" : {
      "account_id" : 25654509,
      "reputation" : 9,
      "user_id" : 19421186,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3f8046eb7f344531ae5b01cd05770b8b?s=256&d=identicon&r=PG",
      "display_name" : "Cheikh Ibra YADE",
      "link" : "https://stackoverflow.com/users/19421186/cheikh-ibra-yade"
    },
    "creation_date" : 1745430386,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140355699,
    "post_id" : 79584912,
    "body" : "When I use excel and use a date equivalent to &quot;aug 12th 2027&quot; I get your observed excel result to 4 significant digits and when using equivalent to &quot;dec 8th 2027&quot;  I get a lower value closer to your results.  I&#39;m simply suggesting double-check your date processing particularly in excel to be sure you are comparing the same.",
    "score" : 2,
    "owner" : {
      "account_id" : 3212023,
      "reputation" : 1614,
      "user_id" : 17856705,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/OoOsD.png?s=256",
      "display_name" : "Computable",
      "link" : "https://stackoverflow.com/users/17856705/computable"
    },
    "creation_date" : 1745267399,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140355503,
    "post_id" : 79584912,
    "body" : "@BasilBourque  I don&#39;t find in Apache Poi  the Excel financial functions like YIELD, YieldToMaturity is different with Excel Yield also",
    "score" : 0,
    "owner" : {
      "account_id" : 25654509,
      "reputation" : 9,
      "user_id" : 19421186,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3f8046eb7f344531ae5b01cd05770b8b?s=256&d=identicon&r=PG",
      "display_name" : "Cheikh Ibra YADE",
      "link" : "https://stackoverflow.com/users/19421186/cheikh-ibra-yade"
    },
    "creation_date" : 1745263323,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140355218,
    "post_id" : 79584912,
    "body" : "Does <a href=\"https://github.com/JavaMoney/javamoney-lib/blob/master/calc/src/main/java/org/javamoney/calc/securities/YieldToMaturity.java\" rel=\"nofollow noreferrer\"><code>YieldToMaturity</code></a> do it? From <a href=\"http://www.javamoney.org/\" rel=\"nofollow noreferrer\"><i>JavaMoney</i></a> project.",
    "score" : 0,
    "owner" : {
      "account_id" : 322981,
      "reputation" : 347089,
      "user_id" : 642706,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://i.sstatic.net/ZWEI3.jpg?s=256",
      "display_name" : "Basil Bourque",
      "link" : "https://stackoverflow.com/users/642706/basil-bourque"
    },
    "creation_date" : 1745257062,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140355196,
    "post_id" : 79584912,
    "body" : "Have you looked through <a href=\"https://poi.apache.org/apidocs/index.html\" rel=\"nofollow noreferrer\">Apache Poi</a>? It offers some functions.",
    "score" : 0,
    "owner" : {
      "account_id" : 322981,
      "reputation" : 347089,
      "user_id" : 642706,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://i.sstatic.net/ZWEI3.jpg?s=256",
      "display_name" : "Basil Bourque",
      "link" : "https://stackoverflow.com/users/642706/basil-bourque"
    },
    "creation_date" : 1745256814,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}