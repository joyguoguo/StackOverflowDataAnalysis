{
  "question" : {
    "question_id" : 79639045,
    "title" : "Hadoop-common 3.4.1 Unsupported class file major version 65 error",
    "body" : "<p>I have a gradle project and was using hadoop-common 3.3.6 but want to update to 3.4.1. When i did, i got the error below:</p>\n<pre><code>&gt; Task :sparkRuntimeJar FAILED\nex\njava.lang.IllegalArgumentException: Unsupported class file major version 65\n        at org.objectweb.asm.ClassReader.&lt;init&gt;(ClassReader.java:199)\n        at org.objectweb.asm.ClassReader.&lt;init&gt;(ClassReader.java:180)\n        at org.objectweb.asm.ClassReader.&lt;init&gt;(ClassReader.java:166)\n        at org.objectweb.asm.ClassReader.&lt;init&gt;(ClassReader.java:287)\n        at java.base/jdk.internal.reflect.DirectConstructorHandleAccessor.newInstance(DirectConstructorHandleAccessor.java:62)\n        at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:502)\n        at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:486)\n        at org.codehaus.groovy.reflection.CachedConstructor.invoke(CachedConstructor.java:72)\n        at org.codehaus.groovy.runtime.callsite.ConstructorSite$ConstructorSiteNoUnwrapNoCoerce.callConstructor(ConstructorSite.java:105)\n        at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callConstructor(AbstractCallSite.java:277)\n        at com.github.jengelman.gradle.plugins.shadow.tasks.ShadowCopyAction$StreamAction.remapClass(ShadowCopyAction.groovy:339)\n</code></pre>\n<p>I was initially using java 17 but i changed my sourceCompatibility and targetCompatibility to 21 I am also running java 21 in my shell with sdkman and I have gradle 8.14</p>\n<pre><code>openjdk 21.0.7 2025-04-15 LTS\nOpenJDK Runtime Environment Microsoft-11369939 (build 21.0.7+6-LTS)\nOpenJDK 64-Bit Server VM Microsoft-11369939 (build 21.0.7+6-LTS, mixed mode, sharing)\n</code></pre>\n<p>But i still get the same error as below,  I am still new to gradle so I may be missing something obvious. Any guidance would be greatly appreciated!</p>\n<p>this is my build.gradle file</p>\n<pre><code>import com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar\n\n\nplugins {\n  id 'java'\n  id 'distribution'\n  id 'maven-publish'\n  id 'com.github.johnrengelman.shadow' version '8.1.1'\n  id 'com.jfrog.artifactory' version &quot;4.33.1&quot;\n  id &quot;com.hcl.security.appscan&quot; version &quot;1.0.4&quot;\n  id 'com.github.spotbugs' version '5.1.2'\n  id &quot;nebula.lint&quot; version &quot;17.8.0&quot;\n}\n\nsourceCompatibility = 21.0      \ntargetCompatibility = 21.0\n\nversion = project.hasProperty('buildNumber') ?\n  baseVersion + '.' + buildNumber : baseVersion + '.dev'\ngroup = 'analytics.core'\n\nallprojects {\n  apply {\n    plugin 'java'\n    plugin 'com.github.johnrengelman.shadow'\n    plugin 'jacoco'\n    plugin 'maven-publish'\n    plugin 'com.github.spotbugs'\n    gradleLint.rules = ['unused-dependency'] // Set to 'all-dependency' to lint everything\n  }\n\n  repositories {\n    if (!project.hasProperty('buildNumber')) {\n      // If we have a build number (CI build), we disable this as the artifactory\n      // plugin will configure the correct repos\n      maven {\n        name 'release'\n        url 'repo here'\n        credentials {\n          username = &quot;username&quot;\n          password = &quot;password&quot;\n        }\n      }\n    }\n\n    println 'Configured repositories:'\n    project.repositories.each { println it.hasProperty('url') ? it.url : '--local--' }\n  }\n  configurations {\n    // Prevent duplicate java.utils import at compileTime. Imported as runtime dependency only\n    implementation.exclude group: 'com.boundary', module: 'high-scale-lib'\n    api.exclude group: 'com.boundary', module: 'high-scale-lib' \n  }\n  /*\n   * NOTE: These dependencies are top-level.\n   *       Do not set subproject dependencies here.\n   */\n  dependencies {\n    implementation group: 'org.apache.kerby', name: 'kerb-admin', version: '2.0.3'\n    implementation group: 'com.google.protobuf', name: 'protobuf-java', version: '4.28.2'\n    implementation group: 'org.apache.logging.log4j', name: 'log4j-core', version: '2.20.0'\n    implementation group: 'com.google.guava', name: 'guava', version: '32.0.1-jre'\n    //CVE-2023-36479\n    implementation group: 'org.eclipse.jetty', name: 'jetty-webapp', version: '9.4.57.v20241219'\n    //CVE-2023-52428\n    implementation group: 'com.nimbusds', name: 'nimbus-jose-jwt', version: '9.37.3'\n\n    implementation('org.apache.zookeeper:zookeeper:3.9.2') {\n        exclude group: 'org.slf4j', module: 'slf4j-log4j12'\n        exclude group: 'log4j', module: 'log4j' // CVE and Ciso mandate\n        exclude group: 'ch.qos.logback', module: 'logback-classic'\n        exclude group: 'ch.qos.logback', module: 'logback-core'\n    }\n\n    // CVEs\n    implementation (group: 'org.apache.avro', name: 'avro', version: '1.11.4'){\n      exclude group: 'org.apache.commons', module: 'commons-compress'\n    }\n    implementation group: 'org.apache.commons', name: 'commons-compress', version: '1.26.2'\n    implementation group: 'org.apache.commons', name: 'commons-configuration2', version: '2.10.1'\n    implementation (group: 'org.apache.hadoop', name: 'hadoop-common', version: '3.4.1'){\n      exclude group: 'org.apache.zookeeper', module: 'zookeeper'\n      exclude group: 'org.apache.commons', module: 'commons-compress'\n    }\n    implementation group: 'dnsjava', name: 'dnsjava', version: '3.6.3'\n    implementation group: 'org.bouncycastle', name: 'bcprov-jdk15on', version: '1.70'\n\n    implementation group: 'io.netty', name: 'netty-codec', version: '4.1.119.Final'\n    implementation group: 'io.netty', name: 'netty-handler', version: '4.1.119.Final'\n\n    implementation group: 'org.apache.httpcomponents', name: 'httpclient', version: '4.5.14'\n    implementation group: 'org.yaml', name: 'snakeyaml', version: '2.0'\n\n    //\n    //CVE-2022-40152\n    implementation group: 'com.fasterxml.woodstox', name: 'woodstox-core', version: '6.4.0'\n    //CVE-2022-2048\n    implementation group: 'org.eclipse.jetty', name: 'jetty-io', version: '9.4.57.v20241219'\n    implementation group: 'org.eclipse.jetty', name: 'jetty-server', version: '9.4.57.v20241219'\n    //CVE-2022-40149\n    implementation group: 'org.codehaus.jettison', name: 'jettison', version: '1.5.4'\n    //CVE-2023-5685\n    implementation group: 'org.jboss.xnio', name: 'xnio-api', version: '3.8.16.Final'\n\n\n    testImplementation group: 'junit', name: 'junit', version: '4.13.2'\n    testImplementation group: 'com.google.truth', name: 'truth', version: '1.0'\n    testImplementation group: 'com.fasterxml.jackson.core', name: 'jackson-core', version: jacksonCompatibilityVersion\n    testImplementation group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version: jacksonDatabindVersion\n    testImplementation group: 'com.fasterxml.jackson.dataformat', name: 'jackson-dataformat-yaml', version: jacksonCompatibilityVersion\n    \n    runtimeOnly group: 'com.boundary', name: 'high-scale-lib', version: '1.0.6'\n  }\n}\n\nsubprojects {\n  apply plugin: 'java'\n\n sourceCompatibility = 21.0\n targetCompatibility = 21.0\n\njacoco {\n  toolVersion = &quot;0.8.12&quot;\n}\n\n  tasks.named(&quot;spotbugsMain&quot;).configure { dependsOn(&quot;:spark-addons:jar&quot;) }\n  tasks.named(&quot;compileTestJava&quot;).configure { dependsOn(&quot;:spark-addons:jar&quot;) }\n\n  // Disable the test report for the individual test task\n  tasks.withType(com.github.spotbugs.snom.SpotBugsTask){\n    ignoreFailures = true\n    reports {\n      xml.enabled true\n      html.enabled true\n    }\n  }\n\ntest {\n  jvmArgs '--add-exports=java.base/sun.nio.ch=ALL-UNNAMED'\n  jvmArgs '--add-opens=java.base/java.nio=ALL-UNNAMED'\n  jvmArgs '--add-opens=java.base/java.lang=ALL-UNNAMED'\n  jvmArgs '--add-opens=java.base/java.lang.invoke=ALL-UNNAMED'\n  jvmArgs '--add-opens=java.base/java.util=ALL-UNNAMED'\n  ignoreFailures = true\n  reports {\n        junitXml.required = true\n        html.required = true\n  }\n}\n\n  task copyReport(type: Copy) {\n    from &quot;build/test-results&quot;\n    into &quot;$rootDir/build/test-results&quot;\n  }\n  test.finalizedBy(copyReport)\n}\n\nconfigurations {\n  implementation.exclude group: 'com.google.code.findbugs', module: 'jsr305'\n  implementation.exclude group: 'com.google.code.findbugs', module: 'annotations'\n  implementation.exclude group: 'com.github.spotbugs', module: 'spotbugs-annotations'\n  implementation.exclude group: 'org.slf4j', module: 'slf4j-log4j12'\n  implementation.exclude group: 'log4j', module: 'log4j'\n }\n\ndependencies { implementation subprojects }\n\ntask sparkAPIJar(type: Jar) {\n  archiveClassifier = 'spark-api'\n  from project(&quot;:spark-api&quot;).sourceSets.main.output\n  from project(&quot;:api&quot;).sourceSets.main.output\n\n  exclude('META-INF/maven/log4j/**')\n}\n\ntask sparkRuntimeJar(type: ShadowJar) {\n  archiveClassifier = 'spark'\n  from project(&quot;:spark&quot;).sourceSets.main.java\n  duplicatesStrategy = DuplicatesStrategy.EXCLUDE\n  configurations = [ project.configurations.runtimeClasspath ]\n\n  relocate 'com.google.common', 'eashade.com.google.common'\n  relocate 'org.roaringbitmap', 'eashade.org.roaringbitmap'\n  relocate 'okhttp3', 'eashade.okhttp3'\n  relocate 'okio', 'eashade.okio'\n\n\n  zip64 true\n\n  manifest.inheritFrom project.tasks.jar.manifest\n  exclude ('META-INF/maven/net.minidev/json-smart/**')\n  exclude('META-INF/INDEX.LIST', 'META-INF/*.SF', 'META-INF/*.DSA', 'META-INF/*.RSA', 'META-INF/maven/log4j','META-INF/maven/net.minidev/json-smart')\n  exclude '**/libnetty_resolver_dns_native_macos_x86_64.jnilib'\n  exclude '**/libnetty_resolver_dns_native_macos_aarch_64.jnilib'\n\n  exclude('META-INF/maven/log4j/**')\n}\n\ntask resolverJar(type: Jar) {\n  archiveClassifier = 'resolver'\n  from project(&quot;:resolver&quot;).sourceSets.main.output\n  from project(&quot;:api&quot;).sourceSets.main.output\n}\n\ntask aiPlatformJar(type: Jar) {\n  archiveClassifier = 'aiplatform'\n  from project(&quot;:aiplatform&quot;).sourceSets.main.output\n}\n\nbuild.finalizedBy sparkAPIJar, sparkRuntimeJar, resolverJar, aiPlatformJar\njar.finalizedBy sparkAPIJar, sparkRuntimeJar, resolverJar, aiPlatformJar\n\ntask testReport(type: TestReport) {\n  destinationDir = file(&quot;$buildDir/reports/tests/test&quot;)\n  // Include the results from the test task in all subprojects\n  reportOn subprojects*.test\n}\n\ntask spotBugsReport(type: TestReport) {\n  destinationDir = file(&quot;$buildDir/reports/spotbugs&quot;)\n  // Include the results from the spotbugs task in all subprojects\n  reportOn subprojects*.spotbugsTest\n  reportOn subprojects*.spotbugsMain\n}\n\ntest.finalizedBy(testReport)\ntest.finalizedBy(spotBugsReport)\n\ntest {\n  ignoreFailures = true\n  reports {\n    junitXml.required = true\n    html.required = true\n  }\n}\n\ndistributions {\n  main {\n    baseName = baseName\n  }\n}\n\npublishing {\n  publications {\n    mavenJava(MavenPublication) {\n      artifact sparkAPIJar\n      artifact sparkRuntimeJar\n      artifact resolverJar\n    }\n  }\n}\n\nartifactory {\n  publish {\n    defaults {\n      publications('mavenJava')\n      publishArtifacts = true\n    }\n  }\n}\n\n</code></pre>\n<p>thanks</p>\n",
    "tags" : [ "java", "gradle", "hadoop" ],
    "owner" : {
      "account_id" : 20543025,
      "reputation" : 15,
      "user_id" : 15077538,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0fe7a3572046cb3b56264f3f4d10d6b6?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Tarek Eid",
      "link" : "https://stackoverflow.com/users/15077538/tarek-eid"
    },
    "is_answered" : false,
    "view_count" : 148,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1748267296,
    "creation_date" : 1748267296,
    "link" : "https://stackoverflow.com/questions/79639045/hadoop-common-3-4-1-unsupported-class-file-major-version-65-error",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140598485,
    "post_id" : 79639045,
    "body" : "Edit your question with the stacktrace... Hadoop doesn&#39;t support Java over 11",
    "score" : 0,
    "owner" : {
      "account_id" : 2671330,
      "reputation" : 193048,
      "user_id" : 2308683,
      "user_type" : "registered",
      "accept_rate" : 90,
      "profile_image" : "https://www.gravatar.com/avatar/fb8f5877d244f223b4b6d29e0afb3a4e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "OneCricketeer",
      "link" : "https://stackoverflow.com/users/2308683/onecricketeer"
    },
    "creation_date" : 1752792889,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140465071,
    "post_id" : 79639045,
    "body" : "Thanks, i ended up finding a workaround by removing hadoop-common 3.4.1 and instead using hadoop-client-api 3.4.1 and hadoop-client-runtime 3.4.1 but now i get this error: java.lang.NumberFormatException: For input string: &quot;30s&quot;",
    "score" : 0,
    "owner" : {
      "account_id" : 20543025,
      "reputation" : 15,
      "user_id" : 15077538,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0fe7a3572046cb3b56264f3f4d10d6b6?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Tarek Eid",
      "link" : "https://stackoverflow.com/users/15077538/tarek-eid"
    },
    "creation_date" : 1748419259,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140460178,
    "post_id" : 79639045,
    "body" : "Looks like the version of <code>objectweb</code> being used by groovy doesn&#39;t support Java 21. It probably needs to be updated",
    "score" : 0,
    "owner" : {
      "account_id" : 3159259,
      "reputation" : 111562,
      "user_id" : 2670892,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/4iPV5.png?s=256",
      "display_name" : "greg-449",
      "link" : "https://stackoverflow.com/users/2670892/greg-449"
    },
    "creation_date" : 1748275864,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140460037,
    "post_id" : 79639045,
    "body" : "Check if Gradle is actually using JDK 17. Execute with debug logs to get more information and look for the JDK version in use. Example: <code>.&#47;gradlew --debug SOMETASK...</code>.",
    "score" : 0,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1748271962,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}