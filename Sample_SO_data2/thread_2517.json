{
  "question" : {
    "question_id" : 79617940,
    "title" : "Setting log level programmatically works on one computer, not on another",
    "body" : "<p>My goal is to programmatically set the log4j2 log level. It's working in my IDE, but once the program is built into a JAR and deployed on another machine the procedure has no effect. What can be the problem?</p>\n<p>This is the code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>LoggerContext ctx = (LoggerContext)LogManager.getContext(false);\nConfiguration config = ctx.getConfiguration();\nLoggerConfig rootLoggerConfig = config.getLoggerConfig(LogManager.ROOT_LOGGER_NAME);\nLevel level = Level.ERROR;\nrootLoggerConfig.setLevel(level);\n\n// show all available loggers and set them to the new level:\nMap&lt;String, LoggerConfig&gt; loggers = config.getLoggers();\nSystem.out.println(&quot;\\nConfigured loggers:&quot;);\nfor (Map.Entry&lt;String, LoggerConfig&gt; entry : loggers.entrySet())\n{\n  System.out.println(&quot;Logger: &quot; + entry.getKey() + &quot; Level: &quot; + entry.getValue().getLevel());\n  LoggerConfig loggerConfig = config.getLoggerConfig(entry.getKey());\n  loggerConfig.setLevel(level);\n}\n\nSystem.out.println(&quot;\\nLog4j2 configuration file location: &quot; +\n    ((org.apache.logging.log4j.core.LoggerContext)LogManager.getContext(false))\n        .getConfiguration().getConfigurationSource().getLocation());\n\nctx.updateLoggers();\n_log.fatal(&quot;LogLevel changed to &quot; + newLogLevel);\n_log.fatal(&quot;Current logger is &quot; + _log.getName() + &quot; with level &quot; + _log.getLevel());\n_log.info(&quot;You shouldn't see this&quot;);\n</code></pre>\n<p>The output on my IDE machine is like this:</p>\n<pre class=\"lang-none prettyprint-override\"><code>Configured loggers:\nLogger:  Level: ERROR\nLogger: com.newhighs Level: INFO\n\nLog4j2 configuration file location: /home/mark/tremendous/Bison/trunk/target/classes/log4j2.properties\n2025-05-12 15:07:35.815 FATAL [main] Bison - LogLevel changed to ERROR\n2025-05-12 15:07:35.816 FATAL [main] Bison - Current logger is com.newhighs.bison.Bison with level ERROR\n</code></pre>\n<p>While on the other it is like this:</p>\n<pre class=\"lang-none prettyprint-override\"><code>Configured loggers:\nLogger:  Level: ERROR\nLogger: com.newhighs Level: INFO\n\nLog4j2 configuration file location: jar:file:/home/mark/bison/jar/bison-1.0.8794-SNAPSHOT-jar-with-dependencies.jar!/log4j2.properties\n2025-05-12 15:08:32.844 FATAL Bison - LogLevel changed to ERROR\n2025-05-12 15:08:32.844 FATAL Bison - Current logger is com.newhighs.bison.Bison with level INFO\n2025-05-12 15:08:32.844 INFO  Bison - You shouldn't see this\n</code></pre>\n<p>The log4j2.properties files are identical, it's just that one is on the regular filesystem, the other in the JAR. Why is the log level still INFO on the second machine?</p>\n<p>(For completeness, here's the contents of log4j2.properties)</p>\n<pre class=\"lang-ini prettyprint-override\"><code># Log4j2.properties of Bison\nstatus = warn\n\nappender.console.type = Console\nappender.console.name = LogToConsole\nappender.console.layout.type = PatternLayout\nappender.console.layout.pattern = %d{yyyy-MM-dd HH:mm:ss.SSS} %-5p [%t] %c{1} - %msg%n\n\n# Rotate log file\nappender.rolling.type = RollingFile\nappender.rolling.name = LogToRollingFile\nappender.rolling.fileName = logs/bison.log\nappender.rolling.filePattern = logs/$${date:yyyy-MM}/app-%d{MM-dd-yyyy}-%i.log.gz\nappender.rolling.layout.type = PatternLayout\nappender.rolling.layout.pattern = %d %p %C{1.} [%t] %m%n\nappender.rolling.policies.type = Policies\nappender.rolling.policies.time.type = TimeBasedTriggeringPolicy\nappender.rolling.policies.size.type = SizeBasedTriggeringPolicy\nappender.rolling.policies.size.size=10MB\nappender.rolling.strategy.type = DefaultRolloverStrategy\nappender.rolling.strategy.max = 10\n\n# Log to console and rolling file\nlogger.app.name = com.newhighs\n# put this on debug for debug level\nlogger.app.level = INFO\nlogger.app.additivity = false\nlogger.app.appenderRef.rolling.ref = LogToRollingFile\nlogger.app.appenderRef.console.ref = LogToConsole\n\nrootLogger.level = INFO\nrootLogger.appenderRef.stdout.ref = LogToConsole\n</code></pre>\n<p>And also for completeness: I checked using the JAR on the IDE machine. Same result as on the other machine. For some reason it doesn't work as expected when running from the JAR.</p>\n",
    "tags" : [ "java", "log4j2" ],
    "owner" : {
      "account_id" : 4385645,
      "reputation" : 48,
      "user_id" : 3575916,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/emrZ5.png?s=256",
      "display_name" : "Mark",
      "link" : "https://stackoverflow.com/users/3575916/mark"
    },
    "is_answered" : true,
    "view_count" : 86,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1748330359,
    "creation_date" : 1747056550,
    "link" : "https://stackoverflow.com/questions/79617940/setting-log-level-programmatically-works-on-one-computer-not-on-another",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79620910,
    "question_id" : 79617940,
    "body" : "<p>I removed the log4j2.properties file from resources, and instead made sure the working directory contained the file. Then it worked. Apparently it makes a difference whether the log4j2.properties file is loaded from resources or regular file?!</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 4385645,
      "reputation" : 48,
      "user_id" : 3575916,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/emrZ5.png?s=256",
      "display_name" : "Mark",
      "link" : "https://stackoverflow.com/users/3575916/mark"
    },
    "creation_date" : 1747206915,
    "last_activity_date" : 1747206915,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79639980,
    "question_id" : 79617940,
    "body" : "<p><strong>TL;DR</strong>: <em>Don't use the Maven Assembly Plugin to create fat JARs. Instead, use the <a href=\"https://docs.spring.io/spring-boot/docs/current/maven-plugin/reference/htmlsingle/\" rel=\"nofollow noreferrer\">Spring Boot Maven Plugin</a> or similar tooling that does not modify the original dependency JARs.</em></p>\n<p>The issue you're encountering stems from <strong>how you're packaging your application</strong>.</p>\n<p>Your JAR file name ending with <code>jar-with-dependencies</code> suggests you're using the <a href=\"https://maven.apache.org/plugins/maven-assembly-plugin/index.html\" rel=\"nofollow noreferrer\">Maven Assembly Plugin</a> to create a fat JAR. Unfortunately, this breaks the expected behavior of certain libraries—<strong>notably Log4j 2</strong>.</p>\n<p>See this related question for more background:\n➡️ <a href=\"https://stackoverflow.com/q/79511756/11748454\">Log4j implementation not found in fat jar</a></p>\n<h3>What’s going wrong?</h3>\n<p>Log4j 2 uses a <strong>multi-release JARs</strong> to support caller detection and other advanced features on Java 9+. When you use the Maven Assembly Plugin to build a fat JAR, it flattens the JAR structure and <strong>disables the multi-release capability</strong>. As a result:</p>\n<ul>\n<li><strong>Caller information can't be determined correctly</strong>, breaking Log4j2's context and logger resolution.</li>\n<li>If you enable status messages with <code>-Dlog4j2.statusLoggerLevel=WARN</code>, you'll see:</li>\n</ul>\n<pre><code>WARN Runtime environment or build system does not support multi-release JARs. This will impact location-based features.\n</code></pre>\n<h3>Why does caller information matter?</h3>\n<p>Log4j2 supports <strong>multiple logger contexts</strong>, and the default mechanism to select the correct context (<a href=\"https://logging.apache.org/log4j/2.x/javadoc/log4j-core/org/apache/logging/log4j/core/selector/ClassLoaderContextSelector.html\" rel=\"nofollow noreferrer\"><code>ClassLoaderContextSelector</code></a>) depends on the <strong>caller class</strong>—as documented in <a href=\"https://logging.apache.org/log4j/2.x/manual/systemproperties.html#log4j2.contextSelector\" rel=\"nofollow noreferrer\"><code>log4j2.contextSelector</code></a>.</p>\n<p>If caller detection fails (e.g. due to JAR repackaging that breaks multi-release JARs), Log4j2 <strong>cannot determine the correct context</strong>, and method calls like:</p>\n<pre class=\"lang-java prettyprint-override\"><code>LogManager.getLogger();\nLogManager.getLogger(&quot;com.example.Main&quot;);\nLogManager.getContext(false);\n</code></pre>\n<p>will fail to find a classloader and will use <strong>the &quot;Default&quot; context</strong>. This is the one you configured programmatically.</p>\n<p>In contrast, these calls <em>explicitly</em> use the logger context for the given class or classloader:</p>\n<pre class=\"lang-java prettyprint-override\"><code>LogManager.getLogger(Main.class);\nLogManager.getContext(Main.class.getClassLoader(), false);\n</code></pre>\n<p>If you're using one of these forms (which is likely), your logger ends up using a <strong>different logger context</strong> than the one you configured. This leads to symptoms like your configuration seemingly being ignored.</p>\n<h3>Recommended Solution</h3>\n<p>Use a JAR-packaging tool that <strong>does not flatten dependencies</strong>—e.g., the <a href=\"https://docs.spring.io/spring-boot/docs/current/maven-plugin/reference/htmlsingle/\" rel=\"nofollow noreferrer\">Spring Boot Maven Plugin</a>:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;plugin&gt;\n  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n  &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n  &lt;version&gt;3.5.0&lt;/version&gt;\n  &lt;executions&gt;\n    &lt;execution&gt;\n      &lt;goals&gt;\n        &lt;goal&gt;repackage&lt;/goal&gt;\n      &lt;/goals&gt;\n    &lt;/execution&gt;\n  &lt;/executions&gt;\n&lt;/plugin&gt;\n</code></pre>\n<p>\uD83D\uDCDA See also: <a href=\"https://logging.apache.org/log4j/2.x/faq.html#single-jar\" rel=\"nofollow noreferrer\">How do I create a single-JAR application containing Log4j Core?</a></p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 16269349,
      "reputation" : 16729,
      "user_id" : 11748454,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qyBNp.jpg?s=256",
      "display_name" : "Piotr P. Karwasz",
      "link" : "https://stackoverflow.com/users/11748454/piotr-p-karwasz"
    },
    "creation_date" : 1748330359,
    "last_activity_date" : 1748330359,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79620910" : [ {
      "comment_id" : 140426324,
      "post_id" : 79620910,
      "body" : "@Mark No Abra is right. Those are the rules of StackOverflow and you have to obey them.",
      "score" : 0,
      "owner" : {
        "account_id" : 18999437,
        "reputation" : 798,
        "user_id" : 13867124,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/3f75c892f3b54042e7400ee33cd8af96?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "AztecCodes",
        "link" : "https://stackoverflow.com/users/13867124/azteccodes"
      },
      "creation_date" : 1747250035,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140425721,
      "post_id" : 79620910,
      "body" : "@Abra: don&#39;t be pedantic.",
      "score" : 1,
      "owner" : {
        "account_id" : 4385645,
        "reputation" : 48,
        "user_id" : 3575916,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/emrZ5.png?s=256",
        "display_name" : "Mark",
        "link" : "https://stackoverflow.com/users/3575916/mark"
      },
      "creation_date" : 1747237818,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140423922,
      "post_id" : 79620910,
      "body" : "Don&#39;t ask another question in an answer. I suggest that you <a href=\"https://stackoverflow.com/posts/79620910/edit\">edit</a> your question and state that you found a solution and detail what it was and then say that you don&#39;t understand why your solution worked and would like someone to explain why it worked.",
      "score" : 0,
      "owner" : {
        "account_id" : 2485939,
        "reputation" : 20969,
        "user_id" : 2164365,
        "user_type" : "registered",
        "accept_rate" : 40,
        "profile_image" : "https://i.sstatic.net/RKSgV.png?s=256",
        "display_name" : "Abra",
        "link" : "https://stackoverflow.com/users/2164365/abra"
      },
      "creation_date" : 1747207456,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}