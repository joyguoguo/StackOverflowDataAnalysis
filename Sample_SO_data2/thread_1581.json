{
  "question" : {
    "question_id" : 79696718,
    "title" : "Deleting files based on input to avoid accessing parent folders",
    "body" : "<p>I am doing a REST API in Java (although this question may apply to other languages) where I create several local files and directories, and they can be deleted based on input. I manage my files in a certain directory, then append the request subpath.</p>\n<p>So, if user sends a request DELETE /data { path: &quot;user23/mobile&quot; }, then I would delete files under &quot;/opt/my-app/user-data/user23/mobile/&quot;. However, It is easy to see that if the input was something like &quot;..&quot; I would start deleting files from other users, or even system files.</p>\n<p>Is there a way to securize the path construction, and make sure the given String does not have access previous folders?</p>\n<p>Thanks in advance.</p>\n",
    "tags" : [ "java", "security", "path", "user-input", "path-traversal" ],
    "owner" : {
      "account_id" : 11690304,
      "reputation" : 21,
      "user_id" : 8558811,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2e59d89ca717cacd6b96db41c7d8c17e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "coriuser",
      "link" : "https://stackoverflow.com/users/8558811/coriuser"
    },
    "is_answered" : false,
    "view_count" : 94,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1752202683,
    "creation_date" : 1752135073,
    "link" : "https://stackoverflow.com/questions/79696718/deleting-files-based-on-input-to-avoid-accessing-parent-folders",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79697778,
    "question_id" : 79696718,
    "body" : "<p>You</p>\n<p>Try following these steps and see if it fixes the problem.</p>\n<ol>\n<li><p><strong>Always normalize paths</strong> using <code>Path.normalize()</code></p>\n</li>\n<li><p><strong>Validate the resolved path</strong> stays within your base directory</p>\n</li>\n<li><p><strong>Use allowlists</strong> for characters rather than blocklists</p>\n</li>\n<li><p><strong>Consider using UUIDs</strong> or database IDs instead of user-provided paths</p>\n</li>\n<li><p><strong>Log security violations</strong> for monitoring</p>\n</li>\n<li><p><strong>Never trust user input</strong> - always validate server-side</p>\n</li>\n</ol>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 13772044,
      "reputation" : 328,
      "user_id" : 9939232,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-flWE81A6HFc/AAAAAAAAAAI/AAAAAAAAAAA/F8_qZEvFdbM/s256-rj/photo.jpg",
      "display_name" : "Hoang Vinh",
      "link" : "https://stackoverflow.com/users/9939232/hoang-vinh"
    },
    "creation_date" : 1752202683,
    "last_activity_date" : 1752202683,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140580020,
    "post_id" : 79696718,
    "body" : "@Robert The NIO equivalent is actually <a href=\"https://docs.oracle.com/en/java/javase/24/docs/api/java.base/java/nio/file/Path.html#toRealPath(java.nio.file.LinkOption...)\" rel=\"nofollow noreferrer\">toRealPath</a>.",
    "score" : 0,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44991,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1752155977,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140579950,
    "post_id" : 79696718,
    "body" : "@C3roe The <code>getCanonicalPath()</code> path is only useful for the old File API. For detecting path-traversal attacks in new nio file API you should use <code>normalize()</code> see e.g. <a href=\"https://www.heise.de/en/background/Secure-Coding-Best-practices-for-using-Java-NIO-against-path-traversal-9996787.html\" rel=\"nofollow noreferrer\">heise.de/en/background/&hellip;</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 50585,
      "reputation" : 43469,
      "user_id" : 150978,
      "user_type" : "registered",
      "accept_rate" : 78,
      "profile_image" : "https://www.gravatar.com/avatar/feadc214792e2581c3c750140e3eb2c7?s=256&d=identicon&r=PG",
      "display_name" : "Robert",
      "link" : "https://stackoverflow.com/users/150978/robert"
    },
    "creation_date" : 1752154711,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140579273,
    "post_id" : 79696718,
    "body" : "Thanks for the comments, I will take all into account.",
    "score" : 0,
    "owner" : {
      "account_id" : 11690304,
      "reputation" : 21,
      "user_id" : 8558811,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2e59d89ca717cacd6b96db41c7d8c17e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "coriuser",
      "link" : "https://stackoverflow.com/users/8558811/coriuser"
    },
    "creation_date" : 1752139665,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140579148,
    "post_id" : 79696718,
    "body" : "The user running the application should be restricted to only the necessary permissions for the required folders. Additionally, user inputs should be properly sanitized to prevent path traversal vulnerabilities.",
    "score" : 1,
    "owner" : {
      "account_id" : 551394,
      "reputation" : 8803,
      "user_id" : 916225,
      "user_type" : "registered",
      "accept_rate" : 69,
      "profile_image" : "https://www.gravatar.com/avatar/ba66e25b90b0c202ef0770f81391be97?s=256&d=identicon&r=PG",
      "display_name" : "seenukarthi",
      "link" : "https://stackoverflow.com/users/916225/seenukarthi"
    },
    "creation_date" : 1752137143,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140579091,
    "post_id" : 79696718,
    "body" : "Get the canonical path, and check if it starts with your &quot;base path&quot; that you don&#39;t want the user to be able to go above. <a href=\"https://www.geeksforgeeks.org/java/file-getcanonicalpath-method-in-java-with-examples/\" rel=\"nofollow noreferrer\">geeksforgeeks.org/java/&hellip;</a>",
    "score" : 4,
    "owner" : {
      "account_id" : 1530592,
      "reputation" : 97801,
      "user_id" : 1427878,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f6bd890954a792dbee22792c2402f13a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "C3roe",
      "link" : "https://stackoverflow.com/users/1427878/c3roe"
    },
    "creation_date" : 1752135536,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}