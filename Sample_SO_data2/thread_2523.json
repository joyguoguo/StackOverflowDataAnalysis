{
  "question" : {
    "question_id" : 79617517,
    "title" : "Manually creating a View in SQLite throws PersistenceException in Springboot",
    "body" : "<p>In my Spring Boot application, every time I manually create a View in my sqlite DB with the ff. query</p>\n<pre class=\"lang-sql prettyprint-override\"><code>CREATE VIEW leaderboards AS\nSELECT \n    RANK() OVER (ORDER BY SUM(g.score) DESC) AS rank,\n    u.display_name, \n    COALESCE(SUM(g.score), 0) AS score\nFROM USER u\nLEFT JOIN GUESS g ON g.usr_id = u.id\nGROUP BY g.usr_id, u.display_name\n</code></pre>\n<p>I get the following error: <code>Caused by: jakarta.persistence.PersistenceException: [PersistenceUnit: default] Unable to build Hibernate SessionFactory; nested exception is java.util.NoSuchElementException</code></p>\n<p>When I delete the view and re-ran the program it works fine.</p>\n<p>This is my <code>application.properties</code> which contains config for my Hibernate/JPA</p>\n<pre><code>spring.datasource.url=jdbc:sqlite:./raceguessr.sqlite\nspring.datasource.driver-class-name=org.sqlite.JDBC\nspring.jpa.database-platform=org.hibernate.community.dialect.SQLiteDialect\nspring.jpa.hibernate.ddl-auto=update\nspring.jpa.properties.hibernate.hbm2ddl.auto=update\nspring.jpa.show-sql=true\n</code></pre>\n<p>This is also my stack trace for the application when it won't start:</p>\n<pre class=\"lang-none prettyprint-override\"><code>2025-05-12T16:52:38.531+08:00  INFO 23836 --- [           main] tip.Main                                 : Starting Main using Java 22.0.2 with PID 23836 (D:\\REDACTED\\backend\\build\\classes\\java\\main started by REDACTED in D:\\REDACTED\\backend)\n2025-05-12T16:52:38.534+08:00  INFO 23836 --- [           main] tip.Main                                 : No active profile set, falling back to 1 default profile: &quot;default&quot;\n2025-05-12T16:52:39.747+08:00  INFO 23836 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.\n2025-05-12T16:52:39.884+08:00  INFO 23836 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 124 ms. Found 7 JPA repository interfaces.\n2025-05-12T16:52:40.867+08:00  INFO 23836 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)\n2025-05-12T16:52:40.888+08:00  INFO 23836 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]\n2025-05-12T16:52:40.888+08:00  INFO 23836 --- [           main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.20]\n2025-05-12T16:52:41.004+08:00  INFO 23836 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext\n2025-05-12T16:52:41.007+08:00  INFO 23836 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 2376 ms\n2025-05-12T16:52:41.252+08:00  INFO 23836 --- [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]\n2025-05-12T16:52:41.361+08:00  INFO 23836 --- [           main] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.4.4.Final\n2025-05-12T16:52:41.424+08:00  INFO 23836 --- [           main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled\n2025-05-12T16:52:41.856+08:00  INFO 23836 --- [           main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer\n2025-05-12T16:52:43.942+08:00  INFO 23836 --- [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)\n2025-05-12T16:52:43.994+08:00 ERROR 23836 --- [           main] j.LocalContainerEntityManagerFactoryBean : Failed to initialize JPA EntityManagerFactory: [PersistenceUnit: default] Unable to build Hibernate SessionFactory; nested exception is java.util.NoSuchElementException\n2025-05-12T16:52:43.995+08:00  WARN 23836 --- [           main] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: [PersistenceUnit: default] Unable to build Hibernate SessionFactory; nested exception is java.util.NoSuchElementException\n2025-05-12T16:52:43.999+08:00  INFO 23836 --- [           main] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]\n2025-05-12T16:52:44.026+08:00  INFO 23836 --- [           main] .s.b.a.l.ConditionEvaluationReportLogger : \n\nError starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.\n2025-05-12T16:52:44.054+08:00 ERROR 23836 --- [           main] o.s.boot.SpringApplication               : Application run failed\n\norg.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: [PersistenceUnit: default] Unable to build Hibernate SessionFactory; nested exception is java.util.NoSuchElementException\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1234) ~[spring-context-6.1.6.jar:6.1.6]\n    at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:952) ~[spring-context-6.1.6.jar:6.1.6]\n    at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624) ~[spring-context-6.1.6.jar:6.1.6]\n    at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146) ~[spring-boot-3.2.5.jar:3.2.5]\n    at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754) ~[spring-boot-3.2.5.jar:3.2.5]\n    at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456) ~[spring-boot-3.2.5.jar:3.2.5]\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:334) ~[spring-boot-3.2.5.jar:3.2.5]\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354) ~[spring-boot-3.2.5.jar:3.2.5]\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343) ~[spring-boot-3.2.5.jar:3.2.5]\n    at tip.Main.main(Main.java:11) ~[main/:na]\nCaused by: jakarta.persistence.PersistenceException: [PersistenceUnit: default] Unable to build Hibernate SessionFactory; nested exception is java.util.NoSuchElementException\n    at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.buildNativeEntityManagerFactory(AbstractEntityManagerFactoryBean.java:421) ~[spring-orm-6.1.6.jar:6.1.6]\n    at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.afterPropertiesSet(AbstractEntityManagerFactoryBean.java:396) ~[spring-orm-6.1.6.jar:6.1.6]\n    at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.afterPropertiesSet(LocalContainerEntityManagerFactoryBean.java:366) ~[spring-orm-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1833) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782) ~[spring-beans-6.1.6.jar:6.1.6]\n    ... 16 common frames omitted\nCaused by: java.util.NoSuchElementException: null\n    at java.base/java.util.StringTokenizer.nextToken(StringTokenizer.java:349) ~[na:na]\n    at org.hibernate.tool.schema.extract.internal.AbstractInformationExtractorImpl.addExtractedColumnInformation(AbstractInformationExtractorImpl.java:684) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.tool.schema.extract.internal.AbstractInformationExtractorImpl.lambda$populateTablesWithColumns$4(AbstractInformationExtractorImpl.java:663) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.tool.schema.extract.internal.InformationExtractorJdbcDatabaseMetaDataImpl.processColumnsResultSet(InformationExtractorJdbcDatabaseMetaDataImpl.java:85) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.tool.schema.extract.internal.AbstractInformationExtractorImpl.populateTablesWithColumns(AbstractInformationExtractorImpl.java:649) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.tool.schema.extract.internal.AbstractInformationExtractorImpl.lambda$getTables$3(AbstractInformationExtractorImpl.java:577) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.tool.schema.extract.internal.InformationExtractorJdbcDatabaseMetaDataImpl.processTableResultSet(InformationExtractorJdbcDatabaseMetaDataImpl.java:69) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.tool.schema.extract.internal.AbstractInformationExtractorImpl.getTables(AbstractInformationExtractorImpl.java:570) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.tool.schema.extract.internal.DatabaseInformationImpl.getTablesInformation(DatabaseInformationImpl.java:122) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.tool.schema.internal.GroupedSchemaMigratorImpl.performTablesMigration(GroupedSchemaMigratorImpl.java:72) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.tool.schema.internal.AbstractSchemaMigrator.performMigration(AbstractSchemaMigrator.java:232) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.tool.schema.internal.AbstractSchemaMigrator.doMigration(AbstractSchemaMigrator.java:117) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.tool.schema.spi.SchemaManagementToolCoordinator.performDatabaseAction(SchemaManagementToolCoordinator.java:286) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.tool.schema.spi.SchemaManagementToolCoordinator.lambda$process$5(SchemaManagementToolCoordinator.java:145) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at java.base/java.util.HashMap.forEach(HashMap.java:1429) ~[na:na]\n    at org.hibernate.tool.schema.spi.SchemaManagementToolCoordinator.process(SchemaManagementToolCoordinator.java:142) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.boot.internal.SessionFactoryObserverForSchemaExport.sessionFactoryCreated(SessionFactoryObserverForSchemaExport.java:37) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.internal.SessionFactoryObserverChain.sessionFactoryCreated(SessionFactoryObserverChain.java:35) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.internal.SessionFactoryImpl.&lt;init&gt;(SessionFactoryImpl.java:315) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.boot.internal.SessionFactoryBuilderImpl.build(SessionFactoryBuilderImpl.java:450) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:1507) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.springframework.orm.jpa.vendor.SpringHibernateJpaPersistenceProvider.createContainerEntityManagerFactory(SpringHibernateJpaPersistenceProvider.java:75) ~[spring-orm-6.1.6.jar:6.1.6]\n    at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.createNativeEntityManagerFactory(LocalContainerEntityManagerFactoryBean.java:390) ~[spring-orm-6.1.6.jar:6.1.6]\n    at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.buildNativeEntityManagerFactory(AbstractEntityManagerFactoryBean.java:409) ~[spring-orm-6.1.6.jar:6.1.6]\n    ... 20 common frames omitted\n</code></pre>\n<p>All I wanted is to query the View with JPA.</p>\n",
    "tags" : [ "java", "spring-boot", "hibernate", "sqlite", "jpa" ],
    "owner" : {
      "account_id" : 22462233,
      "reputation" : 15,
      "user_id" : 16663934,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/92d5db4c1149607237042ac579dc163a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Iooosef",
      "link" : "https://stackoverflow.com/users/16663934/iooosef"
    },
    "is_answered" : false,
    "view_count" : 37,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1747040486,
    "creation_date" : 1747040486,
    "link" : "https://stackoverflow.com/questions/79617517/manually-creating-a-view-in-sqlite-throws-persistenceexception-in-springboot",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140417275,
    "post_id" : 79617517,
    "body" : "I ran the query on <a href=\"https://sqlitebrowser.org/\" rel=\"nofollow noreferrer\">DB Browser for SQLite</a>. I don&#39;t really know why I&#39;m using update as schema management, that&#39;s what I used from various tutorials I watched to generate tables from my entities.",
    "score" : 0,
    "owner" : {
      "account_id" : 22462233,
      "reputation" : 15,
      "user_id" : 16663934,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/92d5db4c1149607237042ac579dc163a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Iooosef",
      "link" : "https://stackoverflow.com/users/16663934/iooosef"
    },
    "creation_date" : 1747040980,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140417261,
    "post_id" : 79617517,
    "body" : "You are creating this view how? Is this in a <code>schema.sql</code>, some Spring managed persistence? Why are you doing <code>update</code> as the schema management in Hibernate (don&#39;t use hibernate to manage your schema but things like Flyway or Liquibase instead).",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1747040677,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}