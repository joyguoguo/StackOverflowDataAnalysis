{
  "question" : {
    "question_id" : 79768652,
    "title" : "How to use a custom MessagingMessageListenerAdapter",
    "body" : "<p>Is there any way to provide my own implementation of MessagingMessageListenerAdapter for spring kafka?</p>\n<p>My use case is a bit complicated. I receive many message types on one topic and I'm using class level listener with multiple handler methods.</p>\n<p>It all works OK for non batch processing. However for batch, I need some custom logic that required modification around &quot;invoke&quot; method in the ListenerAdapter.</p>\n<p>I have a proof of concept where I shadowed the original BatchMessagingMessageListenerAdapter, but since this is kinda hacky, I'm wondering if there is any way to provide a custom implementation in a nicer way.</p>\n",
    "tags" : [ "java", "spring", "spring-boot", "apache-kafka", "spring-kafka" ],
    "owner" : {
      "account_id" : 6508159,
      "reputation" : 344,
      "user_id" : 5036387,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/6nI9W.jpg?s=256",
      "display_name" : "Kristoff",
      "link" : "https://stackoverflow.com/users/5036387/kristoff"
    },
    "is_answered" : true,
    "view_count" : 124,
    "closed_date" : 1758267197,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1758271862,
    "creation_date" : 1758209622,
    "link" : "https://stackoverflow.com/questions/79768652/how-to-use-a-custom-messagingmessagelisteneradapter",
    "closed_reason" : "Needs details or clarity"
  },
  "answers" : [ {
    "answer_id" : 79768866,
    "question_id" : 79768652,
    "body" : "<p>The <code>MethodKafkaListenerEndpoint</code> has this method for possible override:</p>\n<pre><code>/**\n * Create an empty {@link MessagingMessageListenerAdapter} instance.\n * @param messageConverter the converter (may be null).\n * @return the {@link MessagingMessageListenerAdapter} instance.\n */\nprotected MessagingMessageListenerAdapter&lt;K, V&gt; createMessageListenerInstance(\n        @Nullable MessageConverter messageConverter) {\n</code></pre>\n<p>The <code>MultiMethodKafkaListenerEndpoint</code> is used for class-level <code>@KafkaListener</code>.</p>\n<p>The <code>KafkaListenerAnnotationBeanPostProcessor</code> creates instances of those.\nHowever, for a method-level <code>@KafkaListener</code> we do have it like this:</p>\n<pre><code>protected void processKafkaListener(KafkaListener kafkaListener, Method method, Object bean,\n        String beanName) {\n</code></pre>\n<p>which you can override, but not for class-level:</p>\n<pre><code>private void processMainAndRetryListeners(KafkaListener kafkaListener, Object bean, String beanName,\n        MethodKafkaListenerEndpoint&lt;K, V&gt; endpoint, @Nullable Method methodToUse, @Nullable Class&lt;?&gt; clazz) {\n</code></pre>\n<p>So, you may raise a GH issue and we will make this method as <code>protected</code> as well.\nBut meanwhile you should opt-in for method-level and do you stuff from the mentioned <code>processKafkaListener</code> override.</p>\n<p>See more info in docs: <a href=\"https://docs.spring.io/spring-kafka/reference/kafka/receiving-messages/listener-annotation.html\" rel=\"nofollow noreferrer\">https://docs.spring.io/spring-kafka/reference/kafka/receiving-messages/listener-annotation.html</a></p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 3273937,
      "reputation" : 122596,
      "user_id" : 2756547,
      "user_type" : "registered",
      "accept_rate" : 75,
      "profile_image" : "https://www.gravatar.com/avatar/2158ce6e7c048277890eb64458864c1c?s=256&d=identicon&r=PG",
      "display_name" : "Artem Bilan",
      "link" : "https://stackoverflow.com/users/2756547/artem-bilan"
    },
    "creation_date" : 1758224725,
    "last_activity_date" : 1758224725,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140747105,
    "post_id" : 79768652,
    "body" : "Well I wrote about it in the question &quot;I have a proof of concept where I shadowed the original class&quot;. I really doubt that class shadowing is ever a proper way ;)",
    "score" : 0,
    "owner" : {
      "account_id" : 6508159,
      "reputation" : 344,
      "user_id" : 5036387,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/6nI9W.jpg?s=256",
      "display_name" : "Kristoff",
      "link" : "https://stackoverflow.com/users/5036387/kristoff"
    },
    "creation_date" : 1758282443,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140747009,
    "post_id" : 79768652,
    "body" : "Show your hacky solution. Maybe it already is the proper way to do it. Without showing the code, we can&#39;t tell you.",
    "score" : 1,
    "owner" : {
      "account_id" : 39208,
      "reputation" : 269427,
      "user_id" : 112968,
      "user_type" : "registered",
      "accept_rate" : 68,
      "profile_image" : "https://i.sstatic.net/zHTaT.png?s=256",
      "display_name" : "knittl",
      "link" : "https://stackoverflow.com/users/112968/knittl"
    },
    "creation_date" : 1758279257,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140746988,
    "post_id" : 79768652,
    "body" : "Well I have a Hacky solution and I&#39;m asking about proper way - general. And it looks like, that particular type that I&#39;m asking about can&#39;t be injected",
    "score" : 0,
    "owner" : {
      "account_id" : 6508159,
      "reputation" : 344,
      "user_id" : 5036387,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/6nI9W.jpg?s=256",
      "display_name" : "Kristoff",
      "link" : "https://stackoverflow.com/users/5036387/kristoff"
    },
    "creation_date" : 1758278593,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140746950,
    "post_id" : 79768652,
    "body" : "It seems like you already have a solution. You are not showing any code. Spring generally allows you to replace any of its beans from AutoConfiguration, so why wouldn&#39;t it be possible?",
    "score" : 0,
    "owner" : {
      "account_id" : 39208,
      "reputation" : 269427,
      "user_id" : 112968,
      "user_type" : "registered",
      "accept_rate" : 68,
      "profile_image" : "https://i.sstatic.net/zHTaT.png?s=256",
      "display_name" : "knittl",
      "link" : "https://stackoverflow.com/users/112968/knittl"
    },
    "creation_date" : 1758277390,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140746914,
    "post_id" : 79768652,
    "body" : "I dont understand why this question was closed as &quot;needs details or clarity&quot;. I&#39;m asking is there a way to inject custom implementation of MessagingMessageListenerAdapter.",
    "score" : 0,
    "owner" : {
      "account_id" : 6508159,
      "reputation" : 344,
      "user_id" : 5036387,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/6nI9W.jpg?s=256",
      "display_name" : "Kristoff",
      "link" : "https://stackoverflow.com/users/5036387/kristoff"
    },
    "creation_date" : 1758276690,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79768866" : [ {
      "comment_id" : 140747395,
      "post_id" : 79768866,
      "body" : "@Kristoff Well, that is also possible. I thought about from perspective to make it working for you right now with existing API. But if you suggest some Framework improvements, then it is OK and, please, raise respective GH issue.",
      "score" : 1,
      "owner" : {
        "account_id" : 3273937,
        "reputation" : 122596,
        "user_id" : 2756547,
        "user_type" : "registered",
        "accept_rate" : 75,
        "profile_image" : "https://www.gravatar.com/avatar/2158ce6e7c048277890eb64458864c1c?s=256&d=identicon&r=PG",
        "display_name" : "Artem Bilan",
        "link" : "https://stackoverflow.com/users/2756547/artem-bilan"
      },
      "creation_date" : 1758289931,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140746976,
      "post_id" : 79768866,
      "body" : "Thx Artem, I think that what would be helpful is that createMessageListenerInstance in the MethodListenerEndpoint would call a injectable factory instead calling new BatchMessagingMessageListenerAdapter. Then I could just set my factory and have my implementation there.",
      "score" : 0,
      "owner" : {
        "account_id" : 6508159,
        "reputation" : 344,
        "user_id" : 5036387,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/6nI9W.jpg?s=256",
        "display_name" : "Kristoff",
        "link" : "https://stackoverflow.com/users/5036387/kristoff"
      },
      "creation_date" : 1758278203,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}