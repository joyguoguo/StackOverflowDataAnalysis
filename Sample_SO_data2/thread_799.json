{
  "question" : {
    "question_id" : 79774713,
    "title" : "Converting an OpenCV mat to a JavaFX image not working when using ByteBuffer and PixelFormat",
    "body" : "<p>I have posted a <a href=\"http://stackoverflow.com/questions/79771565/bufferedimage-vs-matofbyte-for-converting-an-opencv-matrix-to-a-javafx-image\">question</a> on which of two approaches is more efficient for converting an OpenCV <a href=\"https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html\" rel=\"nofollow noreferrer\">mat</a> object to a JavaFXML <a href=\"https://openjfx.io/javadoc/25/javafx.graphics/javafx/scene/image/Image.html\" rel=\"nofollow noreferrer\">Image</a> so it can be displayed later in the application.</p>\n<p>Most of the comments suggested to use <a href=\"https://openjfx.io/javadoc/25/javafx.graphics/javafx/scene/image/PixelBuffer.html\" rel=\"nofollow noreferrer\">PixelBuffer</a> to construct a <a href=\"https://openjfx.io/javadoc/25/javafx.graphics/javafx/scene/image/WritableImage.html#%3Cinit%3E(javafx.scene.image.PixelBuffer)\" rel=\"nofollow noreferrer\">WritableImage</a>.</p>\n<p>For this purpose I have chosen @James_D proposition which is:</p>\n<blockquote>\n<p>Mat -&gt; MatOfByte -&gt; byte[] -&gt; ByteBuffer -&gt; PixelBuffer -&gt; WritableImage</p>\n</blockquote>\n<p>This what the code looks like:</p>\n<pre><code>import java.awt.image.BufferedImage;\nimport java.awt.image.DataBufferByte;\nimport java.awt.image.WritableRaster;\nimport java.nio.ByteBuffer;\n\nimport javafx.concurrent.Task;\nimport javafx.embed.swing.SwingFXUtils;\nimport javafx.scene.image.Image;\nimport javafx.scene.image.PixelBuffer;\nimport javafx.scene.image.PixelFormat;\nimport javafx.scene.image.WritableImage;\nimport org.opencv.core.CvType;\nimport org.opencv.core.Mat;\n\npublic class MatToFXImage extends Task&lt;Image&gt; {\n    private final Mat mat;\n\n    public MatToFXImage(Mat mat) {\n        if (mat == null)\n            throw new IllegalArgumentException(&quot;Mat object can't be null&quot;);\n\n        this.mat = mat;\n    }\n\n    private int determineImageType(int matType) {\n        if (matType == CvType.CV_8UC1)\n            return BufferedImage.TYPE_BYTE_GRAY;\n        else if (matType == CvType.CV_8UC3)\n            return BufferedImage.TYPE_3BYTE_BGR;\n        else\n            throw new IllegalArgumentException(&quot;Unsupported Mat type: &quot; + matType);\n    }\n\n    @Override\n    protected Image call() {\n        // MatOfByte byteMat = new MatOfByte();\n        // Imgcodecs.imencode(&quot;.bmp&quot;, mat, byteMat);\n        // return new Image(new ByteArrayInputStream(byteMat.toArray()));\n\n        int size = (int) (mat.total() * mat.channels());\n        byte[] byteArray = new byte[size];\n\n        mat.get(0, 0, byteArray);\n\n        ByteBuffer buffer = ByteBuffer.wrap(byteArray);\n        PixelFormat&lt;ByteBuffer&gt; pixelFormat = PixelFormat.getByteBgraPreInstance();\n        PixelBuffer&lt;ByteBuffer&gt; pixelBuffer = new PixelBuffer&lt;&gt;(mat.width(), mat.height(), buffer, pixelFormat);\n\n        return new WritableImage(pixelBuffer);\n\n        // int type;\n\n        // type = determineImageType(mat.type());\n\n        // BufferedImage image = new BufferedImage(mat.width(), mat.height(), type);\n        // WritableRaster raster = image.getRaster();\n        // DataBufferByte dataBuffer = (DataBufferByte) raster.getDataBuffer();\n\n        // // byte[] data = dataBuffer.getData();\n\n        // mat.get(0, 0, dataBuffer.getData());\n        // return SwingFXUtils.toFXImage(image, null);\n    }\n}\n</code></pre>\n<p>I would like to know why it is not working as supposed to do</p>\n",
    "tags" : [ "java", "image", "opencv", "javafx" ],
    "owner" : {
      "account_id" : 12506291,
      "reputation" : 821,
      "user_id" : 9103039,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/TqlDK.jpg?s=256",
      "display_name" : "Starnec",
      "link" : "https://stackoverflow.com/users/9103039/starnec"
    },
    "is_answered" : true,
    "view_count" : 197,
    "closed_date" : 1759153640,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1760503168,
    "creation_date" : 1758797708,
    "link" : "https://stackoverflow.com/questions/79774713/converting-an-opencv-mat-to-a-javafx-image-not-working-when-using-bytebuffer-and",
    "closed_reason" : "Needs details or clarity"
  },
  "answers" : [ {
    "answer_id" : 79775390,
    "question_id" : 79774713,
    "body" : "<h4>Problem</h4>\n<p><a href=\"https://stackoverflow.com/questions/79774713/converting-an-opencv-mat-to-a-javafx-image-not-working-when-using-bytebuffer-and/79775390#comment140759602_79774713\">You mention</a> your test <code>Mat</code>s have 3 channels. The JavaFX <a href=\"https://openjfx.io/javadoc/25/javafx.graphics/javafx/scene/image/PixelBuffer.html\" rel=\"nofollow noreferrer\"><code>PixelBuffer</code></a> class expects one of the two following <a href=\"https://openjfx.io/javadoc/25/javafx.graphics/javafx/scene/image/PixelFormat.html\" rel=\"nofollow noreferrer\">pixel formats</a>:</p>\n<ul>\n<li><p><a href=\"https://openjfx.io/javadoc/25/javafx.graphics/javafx/scene/image/PixelFormat.html#getByteBgraPreInstance()\" rel=\"nofollow noreferrer\">BGRA premultiplied</a> (when the pixels are in a <a href=\"https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/nio/ByteBuffer.html\" rel=\"nofollow noreferrer\"><code>ByteBuffer</code></a>)</p>\n</li>\n<li><p><a href=\"https://openjfx.io/javadoc/25/javafx.graphics/javafx/scene/image/PixelFormat.html#getIntArgbPreInstance()\" rel=\"nofollow noreferrer\">ARGB premultiplied</a> (when the pixels are in an <a href=\"https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/nio/IntBuffer.html\" rel=\"nofollow noreferrer\"><code>IntBuffer</code></a>)<sup><strong>1</strong></sup></p>\n</li>\n</ul>\n<p>Both those formats have 4 channels. The <code>PixelBuffer</code> thinks your buffer is too small because it only has 3 channels. Presumably your data is missing the alpha channel.</p>\n<h4>PixelBuffer</h4>\n<p>The primary benefit of <code>PixelBuffer</code> is the ability to use <a href=\"https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/nio/ByteBuffer.html#direct-vs-non-direct-buffers-heading\" rel=\"nofollow noreferrer\">direct</a> NIO <a href=\"https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/nio/Buffer.html\" rel=\"nofollow noreferrer\"><code>Buffer</code></a>s<sup><strong>2</strong></sup>. Direct buffers hold their data in native memory (i.e., off the Java heap). You can put such buffers in a <code>PixelBuffer</code> without copying the data from native memory into Java memory. A <a href=\"https://openjfx.io/javadoc/25/javafx.graphics/javafx/scene/image/WritableImage.html\" rel=\"nofollow noreferrer\"><code>WritableImage</code></a> can then be used to display the image from that data. This is the most efficient solution if your image data is in native memory and should stay there<sup><strong>3</strong></sup>. But it does require you to be able to get a direct buffer to the native memory to be fully effective.</p>\n<p>If you <em>are not</em> using Java 22+ then there's no public Java API to get a direct <code>ByteBuffer</code> for a specific address. You'd either have to already have the direct <code>ByteBuffer</code>, make use of internal JDK APIs (if there are any), or use <a href=\"https://docs.oracle.com/en/java/javase/25/docs/specs/jni/functions.html#newdirectbytebuffer\" rel=\"nofollow noreferrer\">NewDirectByteBuffer</a> from the <em>Java Native Interface</em> API (which requires writing your own native code). There may be a third-party library that can help with this (e.g., maybe JNA, not sure).</p>\n<p>If you <em>are</em> using Java 22+ and you know the memory address of the data then you can get a direct <code>ByteBuffer</code> to the data via a <a href=\"https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/foreign/MemorySegment.html\" rel=\"nofollow noreferrer\"><code>MemorySegment</code></a><sup><strong>4</strong></sup>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>// import java.lang.foreign.MemorySegment;\n// import javafx.scene.image.Image;\n// import javafx.scene.image.PixelBuffer;\n// import javafx.scene.image.PixelFormat;\n// import javafx.scene.image.WritableImage;\n\npublic Image fromAddress(long address, int width, int height) {\n  int length = width * height * 4; // may want to guard against overflow\n  var segment = MemorySegment.ofAddress(address).reinterpret(length);\n\n  var buffer = segment.asByteBuffer();\n  var format = PixelFormat.getByteBgraPreInstance();\n  var pixels = new PixelBuffer&lt;&gt;(width, height, buffer, format);\n\n  return new WritableImage(pixels);\n}\n</code></pre>\n<p>Unfortunately, if you can't get a direct <code>ByteBuffer</code> to the data then you'll have to copy the data into a Java <code>byte[]</code> somehow. You can then wrap the <code>byte[]</code> in a <code>ByteBuffer</code> and still use <code>PixelBuffer</code>. This will at least limit the number of copies to one. And this is what you seem to be currently trying to do, it's just you have the wrong number of channels.</p>\n<h4>PixelWriter</h4>\n<p>However, <code>PixelBuffer</code> rather limits the pixel formats you can use. If you want to use any of the pixel formats provided by the JavaFX API, then you can use the <a href=\"https://openjfx.io/javadoc/25/javafx.graphics/javafx/scene/image/PixelWriter.html\" rel=\"nofollow noreferrer\"><code>PixelWriter</code></a> of a <code>WritableImage</code>.</p>\n<pre class=\"lang-java prettyprint-override\"><code>// import java.nio.Buffer;\n// import javafx.scene.image.Image;\n// import javafx.scene.image.PixelFormat;\n// import javafx.scene.image.WritableImage;\n\npublic &lt;T extends Buffer&gt; Image fromBuffer(\n    T buffer, int width, int height, PixelFormat&lt;T&gt; format) {\n  var image = new WritableImage(width, height);\n\n  // This assumes the pixel format has 4 channels when computing the\n  // value for 'scanlineStride'. Use a different value, or even try\n  // to dynamically compute the value, as appropriate.\n  int scanlineStride =\n      switch (buffer) {\n        case ByteBuffer _ -&gt; width * 4;\n        case IntBuffer _ -&gt; width;\n        default -&gt; throw new IllegalArgumentException(&quot;unsupported buffer type&quot;);\n      };\n\n  var writer = image.getPixelWriter();\n  writer.setPixels(0, 0, width, height, format, buffer, scanlineStride);\n\n  return image;\n}\n</code></pre>\n<p>Be aware that the <code>setPixels</code> methods copy the data from the buffer. Therefore if you copied the data from native memory to Java memory already, then this approach will result in copying the data <em>twice</em>. But if you can get a <em>direct</em> <code>ByteBuffer</code> to the data then this approach will only copy the data once while also giving you more freedom regarding the pixel format.</p>\n<h4>General Solution</h4>\n<p>So, you have two general solutions within the JavaFX API:</p>\n<ol>\n<li><p>Modify your pixel data to have 4 channels, whether in Java or via OpenCV, then continue using <code>PixelBuffer</code>. Make sure the pixel format is premultiplied BGRA (assuming byte buffer).</p>\n</li>\n<li><p>Switch from <code>PixelBuffer</code> to <code>PixelWriter</code> with an appropriate 3-channel <code>PixelFormat</code>.</p>\n</li>\n</ol>\n<p>In all approaches mentioned in this answer, the pixel data <em>must</em> be the raw uncompressed pixel data. The format used to read the data is determined by the <code>PixelFormat</code>.</p>\n<hr />\n<p><sup><strong>1.</strong> Note you can use <a href=\"https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/nio/ByteBuffer.html#asIntBuffer()\" rel=\"nofollow noreferrer\"><code>ByteBuffer#asIntBuffer()</code></a> to decorate a <code>ByteBuffer</code> with an <code>IntBuffer</code>. This would let you use the ARGB premultiplied format even with a direct <code>ByteBuffer</code>, assuming the underlying bytes are in that format. Make sure you configure the correct <a href=\"https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/nio/ByteBuffer.html#order(java.nio.ByteOrder)\" rel=\"nofollow noreferrer\">byte order</a>.</sup></p>\n<p><sup><strong>2.</strong> While <code>PixelBuffer</code> <em>uses</em> NIO <code>Buffer</code>s, it is not itself an NIO buffer.</sup></p>\n<p><sup><strong>3.</strong> As noted, a <code>PixelBuffer</code> that's using a <code>ByteBuffer</code> requires the pixel data bytes to be in BGRA format. That's a 4-channel format. If your data is currently in a 3-channel format, such as BGR, then note converting to BGRA will likely result in the image's memory footprint increasing by approximately 33%.</sup></p>\n<p><sup><strong>4.</strong> The <code>MemorySegment</code> interface is part of the <em>Foreign Function &amp; Memory API</em> added to the standard library in Java 22.</sup></p>\n",
    "score" : 4,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 8532578,
      "reputation" : 49904,
      "user_id" : 6395627,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Slaw",
      "link" : "https://stackoverflow.com/users/6395627/slaw"
    },
    "creation_date" : 1758846077,
    "last_activity_date" : 1760503168,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140764047,
    "post_id" : 79774713,
    "body" : "new question: <a href=\"https://stackoverflow.com/questions/79776934/fatal-error-and-unusual-result-when-converting-opencv-mat-into-a-javafx-image\" title=\"fatal error and unusual result when converting opencv mat into a javafx image\">stackoverflow.com/questions/79776934/&hellip;</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 3072614,
      "reputation" : 16444,
      "user_id" : 2602877,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c76ea7b35660e77624550130276c61d3?s=256&d=identicon&r=PG",
      "display_name" : "Christoph Rackwitz",
      "link" : "https://stackoverflow.com/users/2602877/christoph-rackwitz"
    },
    "creation_date" : 1758999654,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140760371,
    "post_id" : 79774713,
    "body" : "@ChristophRackwitz To provide more info on the JavaFX API being used: A JavaFX <code>PixelBuffer</code> expects the underlying <code>java.nio.Buffer</code> to be the &quot;raw&quot; uncompressed pixel data in premultiplied BGRA (for a buffer of bytes) or premultiplied ARGB (for a buffer of 32-bit integers) format. A <code>java.nio.Buffer</code> is basically a fixed-capacity array/vector. The OP seems to be trying to get the <i>uncompressed pixels</i> from OpenCV to display them in a JavaFX image UI component.",
    "score" : 1,
    "owner" : {
      "account_id" : 8532578,
      "reputation" : 49904,
      "user_id" : 6395627,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Slaw",
      "link" : "https://stackoverflow.com/users/6395627/slaw"
    },
    "creation_date" : 1758829043,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140760362,
    "post_id" : 79774713,
    "body" : "@ChristophRackwitz, Yes, that vector of compressed data will be wrapped inside a Buffer of Bytes, which will be used later",
    "score" : 0,
    "owner" : {
      "account_id" : 12506291,
      "reputation" : 821,
      "user_id" : 9103039,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/TqlDK.jpg?s=256",
      "display_name" : "Starnec",
      "link" : "https://stackoverflow.com/users/9103039/starnec"
    },
    "creation_date" : 1758828821,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140760358,
    "post_id" : 79774713,
    "body" : "@James_D, Thank you so much. I will definitely check them later. However, I would like to point out a strange behavior that just occurred now. After multiplying the calculated <code>size</code> value by an integer greater than one, the image is displayed. Still, <b>it becomes repetitive on the X-axis, with horizontal stripes passing through it</b>!! I will try to make a minimal reproducible example, showing and explaining in detail this part of the app",
    "score" : 0,
    "owner" : {
      "account_id" : 12506291,
      "reputation" : 821,
      "user_id" : 9103039,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/TqlDK.jpg?s=256",
      "display_name" : "Starnec",
      "link" : "https://stackoverflow.com/users/9103039/starnec"
    },
    "creation_date" : 1758828705,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140760320,
    "post_id" : 79774713,
    "body" : "the &quot;byte mat&quot; is just a vector of bytes (containing compressed data), i.e. a Mat of such a shape. is that what you&#39;re trying to bring into the java world? or are you <i>actually</i> trying to bring a bitmap from OpenCV into the java world?",
    "score" : 0,
    "owner" : {
      "account_id" : 3072614,
      "reputation" : 16444,
      "user_id" : 2602877,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c76ea7b35660e77624550130276c61d3?s=256&d=identicon&r=PG",
      "display_name" : "Christoph Rackwitz",
      "link" : "https://stackoverflow.com/users/2602877/christoph-rackwitz"
    },
    "creation_date" : 1758827443,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140760310,
    "post_id" : 79774713,
    "body" : "If you can arrange for the <code>Mat</code> to be in a format that supports an alpha channel, that would be ideal. Otherwise you may need to code some manual conversion. There are some nice examples of various kinds of integration of JavaFX with other graphics libraries using <code>PixelBuffer</code>s <a href=\"https://github.com/mipastgt/JFXToolsAndDemos/tree/master\" rel=\"nofollow noreferrer\">here</a>. Those are probably worth your while to study.",
    "score" : 1,
    "owner" : {
      "account_id" : 2518243,
      "reputation" : 210916,
      "user_id" : 2189127,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
      "display_name" : "James_D",
      "link" : "https://stackoverflow.com/users/2189127/james-d"
    },
    "creation_date" : 1758826873,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140760080,
    "post_id" : 79774713,
    "body" : "<b>Update</b> After changing to <code>getByteRgbInstance()</code>, the error message became <code>java.lang.IllegalArgumentException: Unsupported PixelFormat: BYTE_RGB</code>. I also read the documentation ,and I could not find how to resolve it yet",
    "score" : 0,
    "owner" : {
      "account_id" : 12506291,
      "reputation" : 821,
      "user_id" : 9103039,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/TqlDK.jpg?s=256",
      "display_name" : "Starnec",
      "link" : "https://stackoverflow.com/users/9103039/starnec"
    },
    "creation_date" : 1758817942,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140759878,
    "post_id" : 79774713,
    "body" : "It looks like that pixel format is <a href=\"https://openjfx.io/javadoc/25/javafx.graphics/javafx/scene/image/PixelBuffer.html#%3Cinit%3E(int,int,T,javafx.scene.image.PixelFormat)\" rel=\"nofollow noreferrer\">not supported by the pixel buffer constructor</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 2518243,
      "reputation" : 210916,
      "user_id" : 2189127,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
      "display_name" : "James_D",
      "link" : "https://stackoverflow.com/users/2189127/james-d"
    },
    "creation_date" : 1758813299,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140759807,
    "post_id" : 79774713,
    "body" : "Create and post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>.",
    "score" : 2,
    "owner" : {
      "account_id" : 2518243,
      "reputation" : 210916,
      "user_id" : 2189127,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
      "display_name" : "James_D",
      "link" : "https://stackoverflow.com/users/2189127/james-d"
    },
    "creation_date" : 1758811672,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140759602,
    "post_id" : 79774713,
    "body" : "There are <b>3 channels</b> in the Mat object (at least the ones that I have tested). I have changed to <code>getByteRgbInstance()</code>, but the issue is still the same",
    "score" : 0,
    "owner" : {
      "account_id" : 12506291,
      "reputation" : 821,
      "user_id" : 9103039,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/TqlDK.jpg?s=256",
      "display_name" : "Starnec",
      "link" : "https://stackoverflow.com/users/9103039/starnec"
    },
    "creation_date" : 1758807840,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140759402,
    "post_id" : 79774713,
    "body" : "Presumably if you&#39;re using <code>PixelFormat.getByteBgraPreInstance()</code> you need 4 bytes per pixel (one each for blue, green, red, and alpha). What is <code>mat.channels()</code> returning?",
    "score" : 0,
    "owner" : {
      "account_id" : 2518243,
      "reputation" : 210916,
      "user_id" : 2189127,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
      "display_name" : "James_D",
      "link" : "https://stackoverflow.com/users/2189127/james-d"
    },
    "creation_date" : 1758804184,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140759372,
    "post_id" : 79774713,
    "body" : "Your suspicion was correct. I wrapped the call method in a <code>try...catch</code> block to catch any exceptions thrown and print their stack traces. The thrown error is <code>java.lang.IllegalArgumentException: Insufficient memory allocated for ByteBuffer.</code> and the line causing it is <code>PixelBuffer&lt;ByteBuffer&gt; pixelBuffer = new PixelBuffer&lt;&gt;(mat.width(), mat.height(), buffer, pixelFormat);</code> I attempted to multiply the width and height arguments by <code>mat.channels()</code>, but the allocated bytes are still insufficient.",
    "score" : 0,
    "owner" : {
      "account_id" : 12506291,
      "reputation" : 821,
      "user_id" : 9103039,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/TqlDK.jpg?s=256",
      "display_name" : "Starnec",
      "link" : "https://stackoverflow.com/users/9103039/starnec"
    },
    "creation_date" : 1758803639,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140759283,
    "post_id" : 79774713,
    "body" : "I suspect what&#39;s really happening is that the <code>call()</code> method is throwing an exception, and you&#39;re not seeing it because it&#39;s thrown asynchronously (i.e. in the thread that&#39;s running the task) and being handled internally (and silently) by the usual <code>Task</code> machinery. Have you tried something like <code>Task&lt;Image&gt; task = new MatToFxImage();</code> and then <code>task.exceptionProperty().subscribe(Throwable::printStackTrac&zwnj;&#8203;e);</code> (or otherwise explicitly handling an exception to get its stack trace) before submitting the task to an executor?",
    "score" : 2,
    "owner" : {
      "account_id" : 2518243,
      "reputation" : 210916,
      "user_id" : 2189127,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
      "display_name" : "James_D",
      "link" : "https://stackoverflow.com/users/2189127/james-d"
    },
    "creation_date" : 1758801929,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140759268,
    "post_id" : 79774713,
    "body" : "So it just hangs somewhere? Are you sure that&#39;s what&#39;s happening? If so, can you identify the line in <code>call()</code> at which it&#39;s hanging? Can you create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> that uses the class you posted here that demonstrates the issue?",
    "score" : 3,
    "owner" : {
      "account_id" : 2518243,
      "reputation" : 210916,
      "user_id" : 2189127,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
      "display_name" : "James_D",
      "link" : "https://stackoverflow.com/users/2189127/james-d"
    },
    "creation_date" : 1758801696,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140759140,
    "post_id" : 79774713,
    "body" : "I am not getting any error messages; otherwise, I would have included them. What is expected is an image converted from the Mat object. The task starts but never finishes, and the Image is never returned.",
    "score" : 0,
    "owner" : {
      "account_id" : 12506291,
      "reputation" : 821,
      "user_id" : 9103039,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/TqlDK.jpg?s=256",
      "display_name" : "Starnec",
      "link" : "https://stackoverflow.com/users/9103039/starnec"
    },
    "creation_date" : 1758798778,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140759120,
    "post_id" : 79774713,
    "body" : "Can you expand on <i>it is not working as supposed to do</i> ? What do you expect to get and what are you actually getting? Since your problem concerns JavaFX, you may need to post some images that illustrate what you are getting versus what you want to get. And if you are getting an error, then post the <a href=\"https://stackoverflow.com/questions/3988788/what-is-a-stack-trace-and-how-can-i-use-it-to-debug-my-application-errors\">stack trace</a>.",
    "score" : 3,
    "owner" : {
      "account_id" : 2485939,
      "reputation" : 20969,
      "user_id" : 2164365,
      "user_type" : "registered",
      "accept_rate" : 40,
      "profile_image" : "https://i.sstatic.net/RKSgV.png?s=256",
      "display_name" : "Abra",
      "link" : "https://stackoverflow.com/users/2164365/abra"
    },
    "creation_date" : 1758798069,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79775390" : [ {
      "comment_id" : 140762836,
      "post_id" : 79775390,
      "body" : "And regarding the address of zero, see the <a href=\"https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/foreign/MemorySegment.html#segment-characteristics\" rel=\"nofollow noreferrer\">documentation</a>: &quot;<i>A heap segment obtained from one of the <code>ofArray</code> factory methods has an address of zero</i>.&quot;",
      "score" : 1,
      "owner" : {
        "account_id" : 8532578,
        "reputation" : 49904,
        "user_id" : 6395627,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Slaw",
        "link" : "https://stackoverflow.com/users/6395627/slaw"
      },
      "creation_date" : 1758921963,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140762829,
      "post_id" : 79775390,
      "body" : "@Starnec I don&#39;t know OpenCV that well, so I didn&#39;t give full examples. But if you have a <code>byte[]</code> then the <code>MemorySegment</code> approach is the wrong approach. You&#39;ve already copied the data into Java memory and so <code>MemorySegment</code> won&#39;t provide any benefit. The first parameter is an address in my code snippet because that gives you direct access to the native memory, without copying. Now again, I don&#39;t know OpenCV that well, but perhaps what you&#39;re looking for is <a href=\"https://docs.opencv.org/4.x/javadoc/org/opencv/core/Mat.html#dataAddr()\" rel=\"nofollow noreferrer\"><code>Mat#dataAddr()</code></a>.",
      "score" : 1,
      "owner" : {
        "account_id" : 8532578,
        "reputation" : 49904,
        "user_id" : 6395627,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Slaw",
        "link" : "https://stackoverflow.com/users/6395627/slaw"
      },
      "creation_date" : 1758921700,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140762812,
      "post_id" : 79775390,
      "body" : "@SedJ601 Was a mistake on my part; James_D fixed it. The <code>java.lang.foreign</code> API became a stable feature in Java 22.",
      "score" : 1,
      "owner" : {
        "account_id" : 8532578,
        "reputation" : 49904,
        "user_id" : 6395627,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Slaw",
        "link" : "https://stackoverflow.com/users/6395627/slaw"
      },
      "creation_date" : 1758921123,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140762134,
      "post_id" : 79775390,
      "body" : "In <code>fromAddress</code>, I changed the first parameter to be a byte array and added the 2 lines at the beginning        MemorySegment arraySegment = MemorySegment.ofArray(address);        long arrayAddress = arraySegment.address();      However the <code>arraySegment.address()</code> allways return 0",
      "score" : 0,
      "owner" : {
        "account_id" : 12506291,
        "reputation" : 821,
        "user_id" : 9103039,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/TqlDK.jpg?s=256",
        "display_name" : "Starnec",
        "link" : "https://stackoverflow.com/users/9103039/starnec"
      },
      "creation_date" : 1758899755,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140762089,
      "post_id" : 79775390,
      "body" : "@Starnec I believe it is <a href=\"https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/foreign/MemorySegment.html#ofAddress(long)\" rel=\"nofollow noreferrer\"><code>MemorySegment.ofAddress(...)</code></a>. (I will provide an edit to the answer.)",
      "score" : 3,
      "owner" : {
        "account_id" : 2518243,
        "reputation" : 210916,
        "user_id" : 2189127,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
        "display_name" : "James_D",
        "link" : "https://stackoverflow.com/users/2189127/james-d"
      },
      "creation_date" : 1758898489,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140762082,
      "post_id" : 79775390,
      "body" : "@Starnec Looks to be early access. <a href=\"https://download.java.net/java/early_access/loom/docs/api/java.base/java/lang/foreign/MemorySegment.html#ofAddress(long)\" rel=\"nofollow noreferrer\">download.java.net/java/early_access/loom/docs/api/java.base/&zwnj;&#8203;&hellip;</a>",
      "score" : 1,
      "owner" : {
        "account_id" : 2819940,
        "reputation" : 14002,
        "user_id" : 2423906,
        "user_type" : "registered",
        "accept_rate" : 100,
        "profile_image" : "https://i.sstatic.net/rkpYv.jpg?s=256",
        "display_name" : "SedJ601",
        "link" : "https://stackoverflow.com/users/2423906/sedj601"
      },
      "creation_date" : 1758898356,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140762049,
      "post_id" : 79775390,
      "body" : "Thank you for the answer, however, I could not find any information about the static method <code>fromAddress</code> in the <a href=\"http://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/foreign/MemorySegment.html\" rel=\"nofollow noreferrer\">Java doc</a>",
      "score" : 0,
      "owner" : {
        "account_id" : 12506291,
        "reputation" : 821,
        "user_id" : 9103039,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/TqlDK.jpg?s=256",
        "display_name" : "Starnec",
        "link" : "https://stackoverflow.com/users/9103039/starnec"
      },
      "creation_date" : 1758897597,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}