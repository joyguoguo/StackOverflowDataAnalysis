{
  "question" : {
    "question_id" : 79685435,
    "title" : "ForkJoinPool Using AppClassLoader + ClassNotFoundException",
    "body" : "<p>When using a Kafka producer via a third party library in a Spring Boot application packaged as a fat JAR, Kafka's StringSerializer (and other Kafka classes) are not found in async threads spun off by the producer. The exception thrown is java.lang.ClassNotFoundException: org.apache.kafka.common.serialization.StringSerializer.</p>\n<p>On investigation, I found the the main application thread sees TomcatEmbeddedLoader + LaunchedClassLoader, which can load the dependencies from BOOT-INF/lib, but async threads from the ForkJoinPool use the AppClassLoader.</p>\n<p>Is there any way to force the ForkJoinPool to use the correct class loader or how can this be resolved?</p>\n",
    "tags" : [ "java", "spring-boot", "apache-kafka" ],
    "owner" : {
      "account_id" : 15900189,
      "reputation" : 1,
      "user_id" : 30934434,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-8HIn6FF91eg/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfdPX3GaAWAXkG9gRgBsvXtI2aE7w/mo/s256-rj/photo.jpg",
      "display_name" : "Mason",
      "link" : "https://stackoverflow.com/users/30934434/mason"
    },
    "is_answered" : false,
    "view_count" : 67,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1752170765,
    "creation_date" : 1751334913,
    "link" : "https://stackoverflow.com/questions/79685435/forkjoinpool-using-appclassloader-classnotfoundexception",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79685921,
    "question_id" : 79685435,
    "body" : "<p>Yes, there is a way. Described <a href=\"https://stackoverflow.com/questions/49113207/completablefuture-forkjoinpool-set-class-loader\">here</a>.</p>\n<p>But...what utilizes ForkJoinPool?<br />\nForkJoinPool is designed to split task into smaller tasks  and reduce the results of computations in the end (e.g. collections parallel stream)<br />\nSo If it's not suitable for your case, it would be advisable to use another executorservice.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 20850387,
      "reputation" : 108,
      "user_id" : 15315053,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/1db5386ca04a80b976c5a77df9bcbe01?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Yan",
      "link" : "https://stackoverflow.com/users/15315053/yan"
    },
    "creation_date" : 1751366431,
    "last_activity_date" : 1751366431,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140555102,
    "post_id" : 79685435,
    "body" : "Please, provide a minimal reproducible example of your code, what do you expect, and what is the actual behavior. See <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">stackoverflow.com/help/minimal-reproducible-example</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 40864244,
      "reputation" : 632,
      "user_id" : 30001713,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f59ea01a76709335047f0cee269d788e?s=256&d=identicon&r=PG",
      "display_name" : "biggujo",
      "link" : "https://stackoverflow.com/users/30001713/biggujo"
    },
    "creation_date" : 1751358888,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}