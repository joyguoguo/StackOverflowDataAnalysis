{
  "question" : {
    "question_id" : 79659484,
    "title" : "XSD validation of XBRL files shows structural errors on otherwise valid XBRL files",
    "body" : "<p>How can I fix my XSD validation to avoid errors in XBRL documents that seem to be false errors (or at least errors that don't break the XBRL functionality), pointing out structural issues with XBRL files that pass Schematron just fine.</p>\n<p>My goal is to validate XBRL documents with XSD to catch issues like non-ascii characters, fields that are too long etc - errors that are not coming out via Schematron. We already validate our XBRL files with Schematron to catch business rule errors, so this part is fine.</p>\n<p>I have an XBRL file: <a href=\"https://github.com/robertmarkbram/XbrlValidationWithXsdUsesXercesApplication/blob/main/src/main/resources/xbrl/xbrl_001_valid.xml\" rel=\"nofollow noreferrer\">xbrl_001_valid.xml</a> that is valid XBRL - it passes Schematron, <a href=\"https://arelle.org/arelle\" rel=\"nofollow noreferrer\">Arelle</a> confirms it is a good doc.</p>\n<p>When I run this file through my XSD validator, <a href=\"https://github.com/robertmarkbram/XbrlValidationWithXsdUsesXercesApplication/blob/main/src/main/java/com/example/XBRL_validation_with_xsd_uses_xerces/XbrlValidationWithXsdUsesXercesApplication.java\" rel=\"nofollow noreferrer\">XbrlValidationWithXsdUsesXercesApplication.java</a>, it outputs this error:</p>\n<pre><code>2025-06-09T22:48:53.658+03:00 ERROR 374 --- [XBRL-validation-with-xsd_uses-xerces] [           main] rlValidationWithXsdUsesXercesApplication : Error: org.xml.sax.SAXParseException; systemId: file:/Users/rob.bram/work/test/XBRL-validation-with-xsd_uses-xerces/src/main/resources/xbrl/xbrl_001_valid.xml; lineNumber: 46; columnNumber: 51; cvc-complex-type.2.4.a: Invalid content was found starting with element '{&quot;http://sbr.gov.au/comnmdle/comnmdle.financialinstitutionaccount1.02.00.module&quot;:FinancialInstitutionAccount}'. One of '{&quot;http://www.xbrl.org/2003/linkbase&quot;:schemaRef, &quot;http://www.xbrl.org/2003/linkbase&quot;:linkbaseRef, &quot;http://www.xbrl.org/2003/linkbase&quot;:roleRef, &quot;http://www.xbrl.org/2003/linkbase&quot;:arcroleRef, &quot;http://www.xbrl.org/2003/instance&quot;:item, &quot;http://www.xbrl.org/2003/instance&quot;:tuple, &quot;http://www.xbrl.org/2003/instance&quot;:context, &quot;http://www.xbrl.org/2003/instance&quot;:unit, &quot;http://www.xbrl.org/2003/linkbase&quot;:footnoteLink}' is expected.\n</code></pre>\n<p>I have written code that runs with a local copy of all the XSDs involved - it is in GitHub: <a href=\"https://github.com/robertmarkbram/XbrlValidationWithXsdUsesXercesApplication/tree/main\" rel=\"nofollow noreferrer\">XbrlValidationWithXsdUsesXercesApplication</a>.</p>\n<p>My validator code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@SpringBootApplication\npublic class XbrlValidationWithXsdUsesXercesApplication implements CommandLineRunner {\n\n    private static Logger log = LoggerFactory.getLogger(XbrlValidationWithXsdUsesXercesApplication.class);\n\n    public static void main(String[] args) {\n        SpringApplication.run(XbrlValidationWithXsdUsesXercesApplication.class, args);\n    }\n\n    @Override\n    public void run(final String... args) throws Exception {\n        // Compute path to the XBRL payload to be validated.\n        validateFile(Path.of(&quot;src/main/resources/xbrl/xbrl_001_valid.xml&quot;));\n        validateFile(Path.of(&quot;src/main/resources/xbrl/xbrl_002_invalid-against-Schematron.xml&quot;));\n        validateFile(Path.of(&quot;src/main/resources/xbrl/xbrl_003_invalid-against-XSD.xml&quot;));\n    }\n\n    private static void validateFile(final Path xbrlPath) throws SAXException, IOException {\n        log.info(&quot;========== {} ==========&quot;, xbrlPath);\n\n        // Create the schema factory.\n        final SchemaFactory schemaFactory = SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);\n\n        // Tell the schema factory to use a catalog and resource resolver to use local XSD files.\n        final String[] catalogs = {&quot;src/main/resources/xsd/catalog.xml&quot;};\n        final XMLCatalogResolver resolver = new XMLCatalogResolver(catalogs) {\n            @Override\n            public LSInput resolveResource(\n                final String type,\n                final String namespaceURI,\n                final String publicId,\n                final String systemId,\n                final String baseURI\n            ) {\n                final LSInput lsInput = super.resolveResource(type, namespaceURI, publicId, systemId, baseURI);\n                final String resolvedSystemId = (lsInput != null) ? lsInput.getSystemId() : &quot;null&quot;;\n                log.debug(&quot;Attempted to resolve '{}' to '{}'.&quot;, systemId, resolvedSystemId);\n                return lsInput;\n            }\n        };\n        schemaFactory.setResourceResolver(resolver);\n\n        // Create the validator using the XSD.\n        final String entryPointXsd = &quot;src/main/resources/xsd/sbr.gov.au/taxonomy/sbr_au_reports/sprstrm/sprcnt/sprcnt_0001/sprcnt.0001.conttrans.request.02.02.report.xsd&quot;;\n        final Schema schema = schemaFactory.newSchema(new File(entryPointXsd));\n        javax.xml.validation.Validator validator = schema.newValidator();\n\n        // Add an error handler.\n        final XsdErrorHandler errorHandler = new XsdErrorHandler(xbrlPath);\n        validator.setErrorHandler(errorHandler);\n\n        // Validate and output errors.\n        final Source xmlStreamSource = new StreamSource(xbrlPath.toFile());\n        validator.validate(xmlStreamSource);\n        if (errorHandler.getErrors().isEmpty()) {\n            log.info(&quot;'{}' is valid against '{}'.&quot;, xbrlPath, entryPointXsd);\n        }\n        for (SAXParseException error : errorHandler.getErrors()) {\n            log.error(&quot;Error: {}&quot;, error.toString());\n        }\n    }\n\n    public static final class XsdErrorHandler implements ErrorHandler {\n        // Removed for brevity.\n    }\n}\n</code></pre>\n<p>The project includes all the XSDs linked to by the XBRL instance's <code>link:schemaRef</code>:</p>\n<pre><code>   &lt;link:schemaRef xlink:href=&quot;http://sbr.gov.au/taxonomy/sbr_au_reports/sprstrm/sprcnt/sprcnt_0001/sprcnt.0001.conttrans.request.02.02.report.xsd&quot; xlink:type=&quot;simple&quot;/&gt;\n</code></pre>\n<ul>\n<li>All the required <code>sbr.gov.au</code> XSDs are cached.</li>\n<li>So are the base <code>www.xbrl.org</code> XSDs.</li>\n<li>I use a <code>catalog.xml</code> that is referencing all of these files OK. I grabbed the files from the Arelle local cache.</li>\n<li>I could potentially edit the XSD files, but worry about maintainability and versioning.</li>\n<li>We receive the XBRL files from our clients, so these are not under our control.</li>\n</ul>\n<p>I should add that IntelliJ mirrors the XSD error too.</p>\n<p><a href=\"https://i.sstatic.net/oTvX18CA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/oTvX18CA.png\" alt=\"XSD error shown in IntelliJ\" /></a></p>\n<p>The most puzzling aspect of this is that when I completely remove the <code>XMLCatalogResolver</code> from this code, the file <code>xbrl_001_valid.xml</code> validates successfully.</p>\n<pre class=\"lang-java prettyprint-override\"><code>final XMLCatalogResolver resolver = new XMLCatalogResolver(catalogs) {\n    @Override\n    public LSInput resolveResource(\n        final String type,\n        final String namespaceURI,\n        final String publicId,\n        final String systemId,\n        final String baseURI\n    ) {\n        final LSInput lsInput = super.resolveResource(type, namespaceURI, publicId, systemId, baseURI);\n        final String resolvedSystemId = (lsInput != null) ? lsInput.getSystemId() : &quot;null&quot;;\n        log.debug(&quot;Attempted to resolve '{}' to '{}'.&quot;, systemId, resolvedSystemId);\n        return lsInput;\n    }\n};\nschemaFactory.setResourceResolver(resolver);\n</code></pre>\n<p>Without the above code, I get:</p>\n<pre><code>2025-06-09T23:30:32.683+03:00  INFO 4615 --- [XBRL-validation-with-xsd_uses-xerces] [           main] rlValidationWithXsdUsesXercesApplication : 'src/main/resources/xbrl/xbrl_001_valid.xml' is valid against 'src/main/resources/xsd/sbr.gov.au/taxonomy/sbr_au_reports/sprstrm/sprcnt/sprcnt_0001/sprcnt.0001.conttrans.request.02.02.report.xsd'.\n</code></pre>\n<p>But that also means it is downloading the files from the internet every time - which is something I must avoid.</p>\n",
    "tags" : [ "java", "xml", "xsd-validation", "xbrl", "arelle" ],
    "owner" : {
      "account_id" : 94158,
      "reputation" : 10059,
      "user_id" : 257233,
      "user_type" : "registered",
      "accept_rate" : 88,
      "profile_image" : "https://www.gravatar.com/avatar/eee4f99bf88fb3d8f577e40f236caf12?s=256&d=identicon&r=PG",
      "display_name" : "Robert Mark Bram",
      "link" : "https://stackoverflow.com/users/257233/robert-mark-bram"
    },
    "is_answered" : true,
    "view_count" : 75,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1749538339,
    "creation_date" : 1749500138,
    "link" : "https://stackoverflow.com/questions/79659484/xsd-validation-of-xbrl-files-shows-structural-errors-on-otherwise-valid-xbrl-fil",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79659897,
    "question_id" : 79659484,
    "body" : "<p><code>FinancialInstitutionAccount</code> is probably containing a fact and in the substitution group of <code>item</code>.</p>\n<p>Thus, the reason for the validation error is that the taxonomy schema (the one defining <code>FinancialInstitutionAccount</code>) is not in scope.</p>\n<p>On the positive side, the error is a confirmation that the validation engine sees the main XBRL instance schema.</p>\n<p>If it works when downloading the schemas from the Internet, it is likely to be an issue with the mapping to the local copy of the schema files.</p>\n<p>Unfortunately, I am not familiar with the details of Xerces and I was not able to reproduce the code locally also in the <a href=\"https://stackoverflow.com/questions/79573162/error-validating-xbrl-using-catalog-xml-to-ensure-only-local-xsd-files-are-used/79575326#79575326\">other thread</a> related to the schema mapping.</p>\n<p>Perhaps it would help locating the exact schema file defining <code>FinancialInstitutionAccount</code> and checking that it also exists as a local copy?</p>\n",
    "score" : 2,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 106772,
      "reputation" : 7429,
      "user_id" : 284285,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/8lZ5E.jpg?s=256",
      "display_name" : "Ghislain Fourny",
      "link" : "https://stackoverflow.com/users/284285/ghislain-fourny"
    },
    "creation_date" : 1749536958,
    "last_activity_date" : 1749538339,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}