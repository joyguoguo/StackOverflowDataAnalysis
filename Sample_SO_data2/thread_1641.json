{
  "question" : {
    "question_id" : 79691525,
    "title" : "How to ensure I don&#39;t inadvertently depend on code only available in a more recent version of Java?",
    "body" : "<p>I am creating a set of libraries for in-house use, and I have a reactor pom setup to build all these libraries.</p>\n<p>I want to be able to build them all at once, with one command.</p>\n<p>However, the contexts where the libraries will be used have different base Java runtimes.</p>\n<p>Because I want to build them all at once I need to have the Java version I run this build as the most recent Java version I'm targeting.</p>\n<p>However, while I know that I can set the compiler target in each of my projects to match the java version where that project will be used how can I guarantee that I won't inadvertently use a method or class in that project that is only available in the more recent version of Java I'm using to build these libraries?</p>\n",
    "tags" : [ "java", "maven", "backwards-compatibility" ],
    "owner" : {
      "account_id" : 40662,
      "reputation" : 21364,
      "user_id" : 117839,
      "user_type" : "registered",
      "accept_rate" : 74,
      "profile_image" : "https://www.gravatar.com/avatar/826b0d5f2ae42a48261b1bfe780596d6?s=256&d=identicon&r=PG",
      "display_name" : "Michael Wiles",
      "link" : "https://stackoverflow.com/users/117839/michael-wiles"
    },
    "is_answered" : true,
    "view_count" : 1114,
    "answer_count" : 1,
    "score" : 14,
    "last_activity_date" : 1754301069,
    "creation_date" : 1751781455,
    "link" : "https://stackoverflow.com/questions/79691525/how-to-ensure-i-dont-inadvertently-depend-on-code-only-available-in-a-more-rece",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79691639,
    "question_id" : 79691525,
    "body" : "<p><code>javac</code> 9 introduced a <code>--release</code> flag that will, to quote the documentation, &quot;Compile for the specified Java SE release&quot;.</p>\n<p>The <a href=\"https://maven.apache.org/plugins/maven-compiler-plugin/\" rel=\"noreferrer\"><code>maven-compiler-plugin</code></a> also supports this feature, and allows you to use the <code>&lt;release&gt;</code> tag in its configuration to pass a value down to the Java compiler.</p>\n<p>For example, you could configure your compiler plugin to compile for Java 9:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;plugin&gt;\n  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n  &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n  &lt;version&gt;3.13.0&lt;/version&gt;\n  &lt;configuration&gt;\n    &lt;encoding&gt;UTF8&lt;/encoding&gt;\n    &lt;release&gt;9&lt;/release&gt;\n  &lt;/configuration&gt;\n&lt;/plugin&gt;\n</code></pre>\n<p>Alternatively, you can configure this behavior by setting the built-in <code>maven.compiler.release</code> property:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;properties&gt;\n  &lt;maven.compiler.release&gt;9&lt;/maven.compiler.release&gt;\n&lt;/properties&gt;\n</code></pre>\n<p>Now let's see what it does.\nConsider, for example, that you have a piece of code that uses <code>List</code>'s <a href=\"https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/List.html#addFirst(java.lang.Object)\" rel=\"noreferrer\"><code>addFirst</code></a> method, <a href=\"https://openjdk.org/jeps/431\" rel=\"noreferrer\">introduced in Java 21</a>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>List&lt;Integer&gt; myList = new ArrayList&lt;&gt;();\nmyList.addFirst(1);\n</code></pre>\n<p>When compiling it with this configuration, it will explicitly be compiled to be compatible with Java 9's API, and the compilation will fail:</p>\n<pre class=\"lang-none prettyprint-override\"><code>[INFO] --- compiler:3.13.0:compile (default-compile) @ samplejava ---\n[INFO] Recompiling the module because of changed source code.\n[INFO] Compiling 1 source file with javac [debug release 9] to target/classes\n[INFO] -------------------------------------------------------------\n[ERROR] COMPILATION ERROR : \n[INFO] -------------------------------------------------------------\n[ERROR] /Users/mureinik/src/samplejava/src/main/java/org/example/Main.java:[9,15] cannot find symbol\n  symbol:   method addFirst(int)\n  location: variable myList of type java.util.List&lt;java.lang.Integer&gt;\n[INFO] 1 error\n</code></pre>\n<p>This is despite using a modern Java version that most certainly has that method in its JDK:</p>\n<pre class=\"lang-bash prettyprint-override\"><code>âžœ  samplejava mvn --version\nApache Maven 3.9.9 (8e8579a9e76f7d015ee5ec7bfcdc97d260186937)\nMaven home: /opt/homebrew/Cellar/maven/3.9.9/libexec\nJava version: 23.0.2, vendor: Homebrew, runtime: /opt/homebrew/Cellar/openjdk/23.0.2/libexec/openjdk.jdk/Contents/Home\nDefault locale: en_IL, platform encoding: UTF-8\nOS name: &quot;mac os x&quot;, version: &quot;15.5&quot;, arch: &quot;aarch64&quot;, family: &quot;mac&quot;\n</code></pre>\n<p><strong>EDIT:</strong><br />\nFor completion's sake - the <code>--release</code> flag supports Java versions 8 and above. If you need to support an older Java version, you can use the <a href=\"https://www.mojohaus.org/animal-sniffer/animal-sniffer-maven-plugin\" rel=\"noreferrer\">Animal Sniffer Maven Plugin</a>.</p>\n",
    "score" : 16,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 2818342,
      "reputation" : 316066,
      "user_id" : 2422776,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2353050223ebecb113741c29458de4b2?s=256&d=identicon&r=PG",
      "display_name" : "Mureinik",
      "link" : "https://stackoverflow.com/users/2422776/mureinik"
    },
    "creation_date" : 1751794944,
    "last_activity_date" : 1751818634,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140570875,
    "post_id" : 79691525,
    "body" : "and <a href=\"https://stackoverflow.com/questions/16723533/how-do-you-specify-the-java-compiler-version-in-a-pom-xml-file\" title=\"how do you specify the java compiler version in a pom xml file\">stackoverflow.com/questions/16723533/&hellip;</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 10759610,
      "reputation" : 13342,
      "user_id" : 7916438,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/8541ff62182bcfd172e116a4e0d2fa58?s=256&d=identicon&r=PG",
      "display_name" : "tevemadar",
      "link" : "https://stackoverflow.com/users/7916438/tevemadar"
    },
    "creation_date" : 1751897582,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140567856,
    "post_id" : 79691525,
    "body" : "Based on what I&#39;ve seen ... the answer is to use the Maven enforcer plugin.  See <a href=\"https://stackoverflow.com/questions/62465338\">stackoverflow.com/questions/62465338</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 47283,
      "reputation" : 723470,
      "user_id" : 139985,
      "user_type" : "registered",
      "accept_rate" : 69,
      "profile_image" : "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=256&d=identicon&r=PG",
      "display_name" : "Stephen C",
      "link" : "https://stackoverflow.com/users/139985/stephen-c"
    },
    "creation_date" : 1751782404,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79691639" : [ {
      "comment_id" : 140576405,
      "post_id" : 79691639,
      "body" : "@Neil in that case, this mechanism should have worked (i.e., prevent you from using <code>Dialog.show()</code> in a codebase that should be compatible with JDK 1.0 (other than the fact that the <code>--release</code> flag doesn&#39;t support JDK 1.0 or 1.1, of course :-))",
      "score" : 1,
      "owner" : {
        "account_id" : 2818342,
        "reputation" : 316066,
        "user_id" : 2422776,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/2353050223ebecb113741c29458de4b2?s=256&d=identicon&r=PG",
        "display_name" : "Mureinik",
        "link" : "https://stackoverflow.com/users/2422776/mureinik"
      },
      "creation_date" : 1752057447,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140576387,
      "post_id" : 79691639,
      "body" : "Java 1 wouldn&#39;t load a class file that referred to <code>Dialog.show()</code>, since that didn&#39;t exist. It worked fine with <code>Window.show()</code>, and you could use the same class file in Java 1.1 because that would automatically invoke the new <code>Dialog.show()</code> override.",
      "score" : 0,
      "owner" : {
        "account_id" : 61276,
        "reputation" : 55517,
        "user_id" : 182705,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/441ab3bb45522c8049d12f3aed6789ef?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Neil",
        "link" : "https://stackoverflow.com/users/182705/neil"
      },
      "creation_date" : 1752057069,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140576280,
      "post_id" : 79691639,
      "body" : "@Neil I&#39;m not sure I&#39;m following. In JDK 1.0, <code>Dialog</code> extends <code>Window</code>, so it should inherit the public <code>show</code> method from it (see <a href=\"https://javaalmanac.io/jdk/1.0/api/java.awt.Dialog.html\" rel=\"nofollow noreferrer\">javaalmanac.io/jdk/1.0/api/java.awt.Dialog.html</a>). Can you elaborate what the issue was?",
      "score" : 0,
      "owner" : {
        "account_id" : 2818342,
        "reputation" : 316066,
        "user_id" : 2422776,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/2353050223ebecb113741c29458de4b2?s=256&d=identicon&r=PG",
        "display_name" : "Mureinik",
        "link" : "https://stackoverflow.com/users/2422776/mureinik"
      },
      "creation_date" : 1752054397,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140576070,
      "post_id" : 79691639,
      "body" : "Many years ago, I was cross-compiling from JDK 1.1 to Java 1, and ran into an issue where <code>Dialog.show()</code> wouldn&#39;t run in Java 1 because it wasn&#39;t an override of <code>Window.show()</code> back then. Obviously this specific example doesn&#39;t apply here, but do you know whether in general the <code>--release</code> flag also checks for this type of issue?",
      "score" : 0,
      "owner" : {
        "account_id" : 61276,
        "reputation" : 55517,
        "user_id" : 182705,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/441ab3bb45522c8049d12f3aed6789ef?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Neil",
        "link" : "https://stackoverflow.com/users/182705/neil"
      },
      "creation_date" : 1752049412,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}