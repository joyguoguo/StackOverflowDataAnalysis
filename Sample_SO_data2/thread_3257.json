{
  "question" : {
    "question_id" : 79563808,
    "title" : "When developing with Minecraft Forge 1.20.1, the external implementation dependencies are not being recognized with Java17 Gradle8",
    "body" : "<p>I want to add an ES6 JavaScript executor to my mod. I've tried <strong>​GraalVM</strong> and currently ​<a href=\"https://central.sonatype.com/artifact/org.mozilla/rhino/1.7.14/overview\" rel=\"nofollow noreferrer\">org.mozilla:rhino</a>, which work fine in an external main() entry point, but in-game, they always throw a ​java.lang.ClassNotFoundException. I attempted to use ​<a href=\"https://github.com/GradleUp/shadow\" rel=\"nofollow noreferrer\">Shadow</a> to relocate the package names, but it doesn’t seem to have any effect—maybe I misconfigured Shadow?</p>\n<p>I tried consulting AI and searching Google, and followed various suggested Gradle script configurations, but all attempts failed (Some of the tutorials I found use outdated versions, which might be causing conflicts or missing critical fixes.). So now I've cleaned up the uncertain parts in my build.gradle</p>\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\" data-babel-preset-react=\"false\" data-babel-preset-ts=\"false\">\n<div class=\"snippet-code\">\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>plugins {\n    id 'eclipse'\n    id 'idea'\n    id 'maven-publish'\n    id 'net.minecraftforge.gradle' version '[6.0,6.2)'\n    id 'org.parchmentmc.librarian.forgegradle' version '1.+'\n    id 'org.spongepowered.mixin' version '0.7.+'  // Mixin 插件\n    id 'com.github.johnrengelman.shadow' version '8.1.1'\n}\n\nmixin {\n    add sourceSets.main, \"acheli-refmap.json\"\n    config \"mixins.archers_helicopter.json\"\n}\n\n//Version number generation\n// 使用安全操作符和默认值处理未定义的属性\ndef suffix = project.findProperty('suffix') ?: \"\"\ndef type = project.findProperty('type') ?: \"\"\ndef platform = project.findProperty('platform') ?: \"\"\ndef modVersion = project.findProperty('mod_version') ?: \"0.0.0\" // 必须定义默认版本\n\n// 构建版本号逻辑\ndef suf = \"\"\ndef typ = \"\"\ndef plat = \"\"\nif (suffix != \"\") {\n    suf = \"-${suffix}\"\n}\nif (type != \"\") {\n    typ = \"-${type}\"\n}\n\nif (platform != \"\") {\n    plat = \"${platform}\"\n}\n\nversion = \"${plat}-${modVersion}-${new Date().format('MMdd.HHmm')}${suf}${typ}\"\ngroup = mod_group_id\n\nbase {\n    archivesName = mod_id\n}\n\n// Mojang ships Java 17 to end users in 1.18+, so your mod should target Java 17.\njava.toolchain.languageVersion = JavaLanguageVersion.of(17)\n\nprintln \"Java: ${System.getProperty 'java.version'}, JVM: ${System.getProperty 'java.vm.version'} (${System.getProperty 'java.vendor'}), Arch: ${System.getProperty 'os.arch'}\"\nminecraft {\n    // The mappings can be changed at any time and must be in the following format.\n    // Channel:   Version:\n    // official   MCVersion             Official field/method names from Mojang mapping files\n    // parchment  YYYY.MM.DD-MCVersion  Open community-sourced parameter names and javadocs layered on top of official\n    //\n    // You must be aware of the Mojang license when using the 'official' or 'parchment' mappings.\n    // See more information here: https://github.com/MinecraftForge/MCPConfig/blob/master/Mojang.md\n    //\n    // Parchment is an unofficial project maintained by ParchmentMC, separate from MinecraftForge\n    // Additional setup is needed to use their mappings: https://parchmentmc.org/docs/getting-started\n    //\n    // Use non-default mappings at your own risk. They may not always work.\n    // Simply re-run your setup task after changing the mappings to update your workspace.\n    mappings channel: mapping_channel, version: mapping_version\n    // When true, this property will have all Eclipse/IntelliJ IDEA run configurations run the \"prepareX\" task for the given run configuration before launching the game.\n    // In most cases, it is not necessary to enable.\n    // enableEclipsePrepareRuns = true\n    // enableIdeaPrepareRuns = true\n\n    // This property allows configuring Gradle's ProcessResources task(s) to run on IDE output locations before launching the game.\n    // It is REQUIRED to be set to true for this template to function.\n    // See https://docs.gradle.org/current/dsl/org.gradle.language.jvm.tasks.ProcessResources.html\n    copyIdeResources = true\n\n    // When true, this property will add the folder name of all declared run configurations to generated IDE run configurations.\n    // The folder name can be set on a run configuration using the \"folderName\" property.\n    // By default, the folder name of a run configuration is the name of the Gradle project containing it.\n    // generateRunFolders = true\n\n    // This property enables access transformers for use in development.\n    // They will be applied to the Minecraft artifact.\n    // The access transformer file can be anywhere in the project.\n    // However, it must be at \"META-INF/accesstransformer.cfg\" in the final mod jar to be loaded by Forge.\n    // This default location is a best practice to automatically put the file in the right place in the final jar.\n    // See https://docs.minecraftforge.net/en/latest/advanced/accesstransformers/ for more information.\n    // accessTransformer = file('src/main/resources/META-INF/accesstransformer.cfg')\n\n    // Default run configurations.\n    // These can be tweaked, removed, or duplicated as needed.\n    runs {\n        // applies to all the run configs below\n        configureEach {\n            workingDirectory project.file('run')\n\n            // Recommended logging data for a userdev environment\n            // The markers can be added/remove as needed separated by commas.\n            // \"SCAN\": For mods scan.\n            // \"REGISTRIES\": For firing of registry events.\n            // \"REGISTRYDUMP\": For getting the contents of all registries.\n            property 'forge.logging.markers', 'REGISTRIES'\n\n            // Recommended logging level for the console\n            // You can set various levels here.\n            // Please read: https://stackoverflow.com/questions/2031163/when-to-use-the-different-log-levels\n            property 'forge.logging.console.level', 'debug'\n\n            mods {\n                \"${mod_id}\" {\n                    source sourceSets.main\n                }\n            }\n        }\n\n        client {\n            // Comma-separated list of namespaces to load gametests from. Empty = all namespaces.\n            property 'forge.enabledGameTestNamespaces', mod_id\n        }\n\n        server {\n            property 'forge.enabledGameTestNamespaces', mod_id\n            args '--nogui'\n        }\n\n        // This run config launches GameTestServer and runs all registered gametests, then exits.\n        // By default, the server will crash when no gametests are provided.\n        // The gametest system is also enabled by default for other run configs under the /test command.\n        gameTestServer {\n            property 'forge.enabledGameTestNamespaces', mod_id\n        }\n\n        data {\n            // example of overriding the workingDirectory set in configureEach above\n            workingDirectory project.file('run-data')\n\n            // Specify the modid for data generation, where to output the resulting resource, and where to look for existing resources.\n            args '--mod', mod_id, '--all', '--output', file('src/generated/resources/'), '--existing', file('src/main/resources/')\n        }\n    }\n}\n\n// Include resources generated by data generators.\nsourceSets.main.resources { srcDir 'src/generated/resources' }\n\nrepositories {\n    // Put repositories for dependencies here\n    // ForgeGradle automatically adds the Forge maven and Maven Central for you\n\n    // If you have mod jar dependencies in ./libs, you can declare them as a repository like so.\n    // See https://docs.gradle.org/current/userguide/declaring_repositories.html#sub:flat_dir_resolver\n    // flatDir {\n    //     dir 'libs'\n    // }\n    maven {url='https://maven.aliyun.com/repository/public/'}\n    maven {url='https://maven.aliyun.com/repository/gradle-plugin/'}\n    maven {url='https://maven.aliyun.com/repository/forge/'}\n    maven {url = \"https://maven.theillusivec4.top/\"}\n    maven {url = 'https://dl.cloudsmith.io/public/geckolib3/geckolib/maven/'}\n    maven {\n        name = \"Jared's maven\"\n        url = \"https://maven.blamejared.com/\"\n    }\n    maven {\n        url \"https://maven.shedaniel.me/\"\n    }\n    maven {\n        url \"https://cursemaven.com\"\n        content {\n            includeGroup \"curse.maven\"\n        }\n    }\n\n}\n\ndependencies {\n    // Specify the version of Minecraft to use.\n    // Any artifact can be supplied so long as it has a \"userdev\" classifier artifact and is a compatible patcher artifact.\n    // The \"userdev\" classifier will be requested and setup by ForgeGradle.\n    // If the group id is \"net.minecraft\" and the artifact id is one of [\"client\", \"server\", \"joined\"],\n    // then special handling is done to allow a setup of a vanilla dependency without the use of an external repository.\n    minecraft \"net.minecraftforge:forge:${minecraft_version}-${forge_version}\"\n    // 确保包含 Mixin 注解处理器\n    annotationProcessor 'org.spongepowered:mixin:0.8.5:processor'\n    implementation fg.deobf('software.bernie.geckolib:geckolib-forge-1.20.1:4.7.1')\n    implementation 'org.mozilla:rhino:1.7.14'\n    // Example mod dependency with JEI - using fg.deobf() ensures the dependency is remapped to your development mappings\n    // The JEI API is declared for compile time use, while the full JEI artifact is used at runtime\n    // compileOnly fg.deobf(\"mezz.jei:jei-${mc_version}-common-api:${jei_version}\")\n    // compileOnly fg.deobf(\"mezz.jei:jei-${mc_version}-forge-api:${jei_version}\")\n    // runtimeOnly fg.deobf(\"mezz.jei:jei-${mc_version}-forge:${jei_version}\")\n\n    // Example mod dependency using a mod jar from ./libs with a flat dir repository\n    // This maps to ./libs/coolmod-${mc_version}-${coolmod_version}.jar\n    // The group id is ignored when searching -- in this case, it is \"blank\"\n    // implementation fg.deobf(\"blank:coolmod-${mc_version}:${coolmod_version}\")\n\n    // For more info:\n    // http://www.gradle.org/docs/current/userguide/artifact_dependencies_tutorial.html\n    // http://www.gradle.org/docs/current/userguide/dependency_management.html\n}\n\ntasks.named('shadowJar', com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar) {\n    configurations = [project.configurations.runtimeClasspath]\n    relocate 'org.mozilla.javascript', 'shaded.org.mozilla.javascript'\n}\n\n// This block of code expands all declared replace properties in the specified resource targets.\n// A missing property will result in an error. Properties are expanded using ${} Groovy notation.\n// When \"copyIdeResources\" is enabled, this will also run before the game launches in IDE environments.\n// See https://docs.gradle.org/current/dsl/org.gradle.language.jvm.tasks.ProcessResources.html\ntasks.named('processResources', ProcessResources).configure {\n    var replaceProperties = [\n            minecraft_version: minecraft_version, minecraft_version_range: minecraft_version_range,\n            forge_version: forge_version, forge_version_range: forge_version_range,\n            loader_version_range: loader_version_range,\n            mod_id: mod_id, mod_name: mod_name, mod_license: mod_license, mod_version: mod_version,\n            mod_authors: mod_authors, mod_description: mod_description,\n    ]\n    inputs.properties replaceProperties\n\n    filesMatching(['META-INF/mods.toml', 'pack.mcmeta']) {\n        expand replaceProperties + [project: project]\n    }\n}\n\n// Example for how to get properties into the manifest for reading at runtime.\ntasks.named('jar', Jar).configure {\n    manifest {\n        attributes([\n                'Specification-Title'     : mod_id,\n                'Specification-Vendor'    : mod_authors,\n                'Specification-Version'   : '1', // We are version 1 of ourselves\n                'Implementation-Title'    : project.name,\n                'Implementation-Version'  : project.jar.archiveVersion,\n                'Implementation-Vendor'   : mod_authors,\n                'Implementation-Timestamp': new Date().format(\"yyyy-MM-dd'T'HH:mm:ssZ\")\n        ])\n    }\n\n    // This is the preferred method to reobfuscate your jar file\n    finalizedBy 'reobfJar'\n}\n\n// However if you are in a multi-project build, dev time needs unobfed jar files, so you can delay the obfuscation until publishing by doing:\n// tasks.named('publish').configure {\n//     dependsOn 'reobfJar'\n// }\n\n// Example configuration to allow publishing using the maven-publish plugin\n\n\ntasks.withType(JavaCompile).configureEach {\n    options.encoding = 'UTF-8' // Use the UTF-8 charset for Java compilation\n}\ntasks.withType(JavaCompile).configureEach {\n    options.compilerArgs += [\"-parameters\"]\n}</code></pre>\n</div>\n</div>\n</p>\n",
    "tags" : [ "java", "gradle", "minecraft-forge" ],
    "owner" : {
      "account_id" : 27979676,
      "reputation" : 13,
      "user_id" : 21367654,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AGNmyxYAWE2knCeQX_q7Neh4lGQy7K8F6ZX8n2J17m-w=k-s256",
      "display_name" : "Archer Lee",
      "link" : "https://stackoverflow.com/users/21367654/archer-lee"
    },
    "is_answered" : true,
    "view_count" : 459,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1749516263,
    "creation_date" : 1744186300,
    "link" : "https://stackoverflow.com/questions/79563808/when-developing-with-minecraft-forge-1-20-1-the-external-implementation-depende",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79659664,
    "question_id" : 79563808,
    "body" : "<p>I had this problem when trying to use luaJ and Jython within my minecraft mod. I found the answer in another thread and hope this solves your problem too.</p>\n<p><a href=\"https://stackoverflow.com/a/79173826\">https://stackoverflow.com/a/79173826</a></p>\n<h3>To summarise</h3>\n<p>Instead of this:</p>\n<pre><code>dependencies {\n     ... \n\n    implementation 'black.ninia:jep:4.2.2' // Your dependency instead\n}\n</code></pre>\n<p>Do this:</p>\n<pre><code>dependencies {\n    ...\n\n    minecraftLibrary fg.deobf(&quot;black.ninia:jep:4.2.2&quot;) // Your dependency instead\n}\n</code></pre>\n<p>A brief explanation can also be found on the forge docs. <a href=\"https://docs.minecraftforge.net/en/fg-5.x/dependencies/\" rel=\"nofollow noreferrer\">https://docs.minecraftforge.net/en/fg-5.x/dependencies/</a></p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 21883879,
      "reputation" : 36,
      "user_id" : 16171761,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/m3DOo.jpg?s=256",
      "display_name" : "RedEgs",
      "link" : "https://stackoverflow.com/users/16171761/redegs"
    },
    "creation_date" : 1749516263,
    "last_activity_date" : 1749516263,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}