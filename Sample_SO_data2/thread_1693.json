{
  "question" : {
    "question_id" : 79687377,
    "title" : "Install4j - generated executable after installing my app fails because of missing class",
    "body" : "<p>I am trying to create an installer for my Java 17 / Spring Boot 2.7.17 / Maven application.</p>\n<p>I have managed to make it work for some time, the installer worked as expected and my app was being launched as a Windows Service, just the way I wanted it.</p>\n<p>But for a reason I can't begin to understand, I can still install my app but the executable launches with an error about a missing Log4j class.\nI have tried executing the jar itself and it works, it is just the generated executable that seems to expect a class it can't find.\nHere is the stack trace I get:</p>\n<pre class=\"lang-java prettyprint-override\"><code>java.lang.reflect.InvocationTargetException\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.base/java.lang.reflect.Method.invoke(Method.java:569)\n        at org.springframework.boot.loader.MainMethodRunner.run(MainMethodRunner.java:49)\n        at org.springframework.boot.loader.Launcher.launch(Launcher.java:108)\n        at org.springframework.boot.loader.Launcher.launch(Launcher.java:58)\n        at org.springframework.boot.loader.JarLauncher.main(JarLauncher.java:65)\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.base/java.lang.reflect.Method.invoke(Method.java:569)\n        at com.exe4j.runtime.LauncherEngine.launch(LauncherEngine.java:84)\n        at com.exe4j.runtime.WinLauncher.main(WinLauncher.java:81)\n        at com.install4j.runtime.launcher.WinLauncher.main(WinLauncher.java:31)\nCaused by: java.lang.NoClassDefFoundError: org/apache/logging/log4j/util/Supplier\n        at org.apache.logging.log4j.core.config.plugins.util.PluginRegistry.decodeCacheFiles(PluginRegistry.java:193)\n        at org.apache.logging.log4j.core.config.plugins.util.PluginRegistry.loadFromMainClassLoader(PluginRegistry.java:119)\n        at org.apache.logging.log4j.core.config.plugins.util.PluginManager.collectPlugins(PluginManager.java:132)\n        at org.apache.logging.log4j.core.lookup.Interpolator.&lt;init&gt;(Interpolator.java:74)\n        at org.apache.logging.log4j.core.lookup.Interpolator.&lt;init&gt;(Interpolator.java:100)\n        at org.apache.logging.log4j.core.config.AbstractConfiguration.&lt;init&gt;(AbstractConfiguration.java:133)\n        at org.apache.logging.log4j.core.config.NullConfiguration.&lt;init&gt;(NullConfiguration.java:32)\n        at org.apache.logging.log4j.core.LoggerContext.&lt;clinit&gt;(LoggerContext.java:74)\n        at org.apache.logging.log4j.core.selector.ClassLoaderContextSelector.createContext(ClassLoaderContextSelector.java:254)\n        at org.apache.logging.log4j.core.selector.ClassLoaderContextSelector.locateContext(ClassLoaderContextSelector.java:218)\n        at org.apache.logging.log4j.core.selector.ClassLoaderContextSelector.getContext(ClassLoaderContextSelector.java:136)\n        at org.apache.logging.log4j.core.selector.ClassLoaderContextSelector.getContext(ClassLoaderContextSelector.java:123)\n        at org.apache.logging.log4j.core.selector.ClassLoaderContextSelector.getContext(ClassLoaderContextSelector.java:117)\n        at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:150)\n        at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:47)\n        at org.apache.logging.log4j.LogManager.getContext(LogManager.java:196)\n        at org.apache.commons.logging.LogAdapter$Log4jLog.&lt;clinit&gt;(LogAdapter.java:155)\n        at org.apache.commons.logging.LogAdapter$Log4jAdapter.createLog(LogAdapter.java:122)\n        at org.apache.commons.logging.LogAdapter.createLog(LogAdapter.java:89)\n        at org.apache.commons.logging.LogFactoryService.getInstance(LogFactoryService.java:46)\n        at org.apache.commons.logging.LogFactoryService.getInstance(LogFactoryService.java:41)\n        at org.apache.commons.logging.LogFactory.getLog(LogFactory.java:655)\n        at org.springframework.boot.SpringApplication.&lt;clinit&gt;(SpringApplication.java:179)\n        at ch.my_app.client.Application.main(Unknown Source)\n        ... 15 more\nCaused by: java.lang.ClassNotFoundException: org.apache.logging.log4j.util.Supplier\n        at java.base/java.net.URLClassLoader.findClass(URLClassLoader.java:445)\n        at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:592)\n        at org.springframework.boot.loader.LaunchedURLClassLoader.loadClass(LaunchedURLClassLoader.java:151)\n        at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:525)\n        ... 39 more\n</code></pre>\n<p>To get this stack trace I have executed <code>./my_app.exe /run</code> from a powershell once my app is installed.</p>\n<p>I have tried adding this dependency in my project (even if both the jar and my IntelliJ run config run fine without it).</p>\n<p>Why is Install4J expecting this class all of a sudden and how can I fix the problem ?</p>\n<p>Thanks in advance for your help.</p>\n<p>--- EDIT ---\nHere is a link to download my install4j and the dependency tree, maybe it will help.\n<a href=\"https://www.swisstransfer.com/d/b34bb0bc-1657-4473-bfe2-420876ac446f\" rel=\"nofollow noreferrer\">https://www.swisstransfer.com/d/b34bb0bc-1657-4473-bfe2-420876ac446f</a></p>\n",
    "tags" : [ "java", "spring-boot", "log4j", "windows-services", "install4j" ],
    "owner" : {
      "account_id" : 42837145,
      "reputation" : 1,
      "user_id" : 30947789,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9811edea209b0eb8f76d0e61652645c5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Michel",
      "link" : "https://stackoverflow.com/users/30947789/michel"
    },
    "is_answered" : false,
    "view_count" : 80,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1751524284,
    "creation_date" : 1751457456,
    "link" : "https://stackoverflow.com/questions/79687377/install4j-generated-executable-after-installing-my-app-fails-because-of-missin",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140560884,
    "post_id" : 79687377,
    "body" : "I have added a link so that you can download the .install4j and my dependency tree, maybe it will help ? Thanks a lot for all your help in any case !",
    "score" : 0,
    "owner" : {
      "account_id" : 42837145,
      "reputation" : 1,
      "user_id" : 30947789,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9811edea209b0eb8f76d0e61652645c5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Michel",
      "link" : "https://stackoverflow.com/users/30947789/michel"
    },
    "creation_date" : 1751524334,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140560761,
    "post_id" : 79687377,
    "body" : "Both <code>o.a.l.l.LogManager</code> and <code>o.a.l.l.util.Supplier</code> are part of <code>log4j-api</code>. Since the first is present and the second absent, Install4J must perform some minimisation/pruning of the JAR.",
    "score" : 0,
    "owner" : {
      "account_id" : 16269349,
      "reputation" : 16729,
      "user_id" : 11748454,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qyBNp.jpg?s=256",
      "display_name" : "Piotr P. Karwasz",
      "link" : "https://stackoverflow.com/users/11748454/piotr-p-karwasz"
    },
    "creation_date" : 1751520387,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140559413,
    "post_id" : 79687377,
    "body" : "We can not know since we don&#39;t know how your project is built and packaged. Share the directory structure, build files and install4j configurations. I can make an educated guess that log4j2 is not packaged by install4j somehow.",
    "score" : 0,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1751476258,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140558775,
    "post_id" : 79687377,
    "body" : "Please trim your code to make it easier to find your problem. Follow these guidelines to create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>.",
    "score" : 0,
    "owner" : {
      "account_id" : -1,
      "reputation" : 1,
      "user_id" : -1,
      "user_type" : "moderator",
      "profile_image" : "https://www.gravatar.com/avatar/a007be5a61f6aa8f3e85ae2fc18dd66e?s=256&d=identicon&r=PG",
      "display_name" : "Community",
      "link" : "https://stackoverflow.com/users/-1/community"
    },
    "creation_date" : 1751464921,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140558689,
    "post_id" : 79687377,
    "body" : "Thanks for your answer. But how can my jar work and not the exe ? How can I package it properly if libs are missing ? Is is in my pom.xml or is it in install4J ? Maybe I need to add the jars related to log4j via Install4J as well as my application jar ? I am having trouble providing a reproducible example because I have no clue where the problem is.",
    "score" : 0,
    "owner" : {
      "account_id" : 42837145,
      "reputation" : 1,
      "user_id" : 30947789,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9811edea209b0eb8f76d0e61652645c5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Michel",
      "link" : "https://stackoverflow.com/users/30947789/michel"
    },
    "creation_date" : 1751463584,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140558654,
    "post_id" : 79687377,
    "body" : "It is not install4j expecting log4j. It is your applications that is using it. Probably it is not packaged as it should. Provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> if you expect people to be able to assist. Reading <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a> would be helpful to improve the question.",
    "score" : 0,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1751462972,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}