{
  "question" : {
    "question_id" : 79701240,
    "title" : "@DisabledIf with jUnit depending on a string value in application.yml",
    "body" : "<p>I need to disable some unit tests depending on a string variable defined in my <code>src/app/test/resources/application.yml</code>.</p>\n<pre><code>ENVIRONMENT: local\n</code></pre>\n<p>I'm using Spring's <a href=\"https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/test/context/junit/jupiter/DisabledIf.html\" rel=\"nofollow noreferrer\"><code>@DisabledIf</code></a> which takes a single <code>expression</code>. But I can't make it work when an expression is a string evaluation that I'm trying to fit into SpEL.</p>\n<pre><code>@Test\n@DisabledIf(expression=&quot;${ENVIRONMENT == 'local'}&quot;) \npublic void test1() throws Exception {\n    //..\n}\n</code></pre>\n<p>Also tried, not working (unit test still activates even with <code>ENVIRONMENT: local</code>):</p>\n<pre><code>@DisabledIf(&quot;#{ '${ENVIRONMENT}' == 'local' }&quot;) // String comparison\n</code></pre>\n<p>Their examples are</p>\n<pre><code>@DisabledIf(&quot;#{systemProperties['os.name'].toLowerCase().contains('mac')}&quot;)\n@DisabledIf(&quot;${smoke.tests.disabled}&quot;) &lt;- A boolean application.yml property\n@DisabledIf(&quot;true&quot;)\n</code></pre>\n<p>I need a Spring environment property from <code>application.yml</code> but with  string evaluation, what would work here?</p>\n<p>BTW the following doesn't work either with my <code>application.yml</code> variable, using <a href=\"https://docs.junit.org/5.2.0/api/org/junit/jupiter/api/condition/DisabledIfSystemProperty.html\" rel=\"nofollow noreferrer\">JUnit's Jupiter</a>:</p>\n<pre><code>@DisabledIfSystemProperty(named=&quot;ENVIRONMENT&quot;, matches=&quot;local&quot;)\n</code></pre>\n",
    "tags" : [ "java", "spring", "spring-boot", "junit" ],
    "owner" : {
      "account_id" : 987434,
      "reputation" : 12664,
      "user_id" : 1005607,
      "user_type" : "registered",
      "accept_rate" : 64,
      "profile_image" : "https://www.gravatar.com/avatar/784311347e657bc34c93a6b7cb7d3faf?s=256&d=identicon&r=PG",
      "display_name" : "gene b.",
      "link" : "https://stackoverflow.com/users/1005607/gene-b"
    },
    "is_answered" : true,
    "view_count" : 136,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1752652245,
    "creation_date" : 1752517077,
    "link" : "https://stackoverflow.com/questions/79701240/disabledif-with-junit-depending-on-a-string-value-in-application-yml",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79701304,
    "question_id" : 79701240,
    "body" : "<p>You just need to tell Spring to load the context so it can read from <code>application.yml</code> using the <code>loadContext</code> attribute of <code>DisabledIf</code> annotation:</p>\n<pre><code>@DisabledIf(value = &quot;#{'${ENVIRONMENT}' == 'local'}&quot;, loadContext = true) // loadContext = true added\n@Test\nvoid test() {\n\n}\n</code></pre>\n<p>From the javadoc of the <code>loadContext</code> attribute in the <code>DisabledIf</code> annotation:</p>\n<blockquote>\n<p>Whether the ApplicationContext associated with the current test should be eagerly loaded in order to evaluate the expression.\nDefaults to false so that test application contexts are not eagerly loaded unnecessarily. If an expression is based solely on system properties or environment variables or does not interact with beans in the test's application context, there is no need to load the context prematurely since doing so would be a waste of time if the test ends up being disabled.</p>\n</blockquote>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 18586978,
      "reputation" : 3850,
      "user_id" : 15000097,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/yFl4M.jpg?s=256",
      "display_name" : "Georgii Lvov",
      "link" : "https://stackoverflow.com/users/15000097/georgii-lvov"
    },
    "creation_date" : 1752522631,
    "last_activity_date" : 1752522631,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79701307,
    "question_id" : 79701240,
    "body" : "<p>I got it, this is the right syntax:</p>\n<pre><code>@DisabledIf(&quot;#{ '${ENVIRONMENT}' == 'local' }&quot;, loadContext = true)\n</code></pre>\n<p>First of all, the correct SpEL expression for comparing strings is with the <code>#{ '..' == '..'}</code> with the <code>#</code> sign, and single quotes around both parts.</p>\n<p>But my main problem was that I didn't have <code>loadContext = true</code>. Apparently it wasn't loading my <code>application.yml</code> variables because of that. I wasn't &quot;eagerly&quot; loading the application context with <code>loadContext=true</code>, but it should still have loaded it by default, yet for some reason that wasn't happening, and this extra piece is required.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 987434,
      "reputation" : 12664,
      "user_id" : 1005607,
      "user_type" : "registered",
      "accept_rate" : 64,
      "profile_image" : "https://www.gravatar.com/avatar/784311347e657bc34c93a6b7cb7d3faf?s=256&d=identicon&r=PG",
      "display_name" : "gene b.",
      "link" : "https://stackoverflow.com/users/1005607/gene-b"
    },
    "creation_date" : 1752522800,
    "last_activity_date" : 1752522800,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140589174,
    "post_id" : 79701240,
    "body" : "Actually I got it work. Yes, <code>#{...}</code> is the right SpEL syntax so first of all, it has to be <code>@DisabledIf(&quot;#{ &#39;${ENVIRONMENT}&#39; == &#39;local&#39; }&quot;)</code>. But second, even that wasn&#39;t working because I didn&#39;t have <code>loadContext = true</code> as the 2nd annotation param.",
    "score" : 0,
    "owner" : {
      "account_id" : 987434,
      "reputation" : 12664,
      "user_id" : 1005607,
      "user_type" : "registered",
      "accept_rate" : 64,
      "profile_image" : "https://www.gravatar.com/avatar/784311347e657bc34c93a6b7cb7d3faf?s=256&d=identicon&r=PG",
      "display_name" : "gene b.",
      "link" : "https://stackoverflow.com/users/1005607/gene-b"
    },
    "creation_date" : 1752522688,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140589143,
    "post_id" : 79701240,
    "body" : "I see a couple of issues <code>${...}</code> isn&#39;t SpEL but a value expression, SpEL starts with <code>#{...}</code>. Next in SpEL <code>environment</code> is special bean that can be looked up, so using that as a variable name won&#39;t work. I wonder why you aren&#39;t just simply using profiles and disable/enable the tests on a profile (that is what the <code>ENVIRONMENT</code> feels like).  Putting things in <code>applicaiton.yaml</code> doesn&#39;t make is a system property (that are the ones you pass with -D). SOmething like <code>#{@environment.getProperty(&#39;your-prop&#39;) eq &#39;your-value&#39;}</code> should work. But I would suggest to just use profiles.",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1752521980,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}