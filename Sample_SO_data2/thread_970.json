{
  "question" : {
    "question_id" : 79749927,
    "title" : "Why does a PKCS12 truststore generated with OpenSSL (-nokeys) not work in Java, but keytool-generated one does?",
    "body" : "<p>I am trying to configure SSL in my Java (Thrift) client. (mTLS)\nI need a truststore that contains my CA certificate, so that the client can trust the server certificate.</p>\n<p>First I'm try to use openssl generate p12 file</p>\n<blockquote>\n<p>openssl pkcs12 -export -in &quot;ca.crt&quot; -out &quot;truststore.p12&quot; -nokeys</p>\n</blockquote>\n<p>But when connecting, I get:\njavax.net.ssl.SSLHandshakeException: No trusted certificate found</p>\n<p>When i try use keytool</p>\n<blockquote>\n<p>keytool -import -file ca.crt -alias ca -keystore truststore.p12</p>\n</blockquote>\n<p>The connect is working</p>\n<p>Server Code:</p>\n<pre class=\"lang-cpp prettyprint-override\"><code>auto ssl_factory = std::make_shared&lt;apache::thrift::transport::TSSLSocketFactory&gt;(\n        apache::thrift::transport::SSLProtocol::TLSv1_2);\nssl_factory-&gt;loadCertificate(cert.crt);\nssl_factory-&gt;loadPrivateKey(cert.key);\nssl_factory-&gt;loadTrustedCertificates(ca.crt);\nssl_factory-&gt;authenticate(true);\nssl_factory-&gt;server(true);\nserver_socket = new apache::thrift::transport::TSSLServerSocket(bind_address, port, ssl_factory);\n</code></pre>\n<p>Client Code:</p>\n<pre><code>TSSLTransportFactory.TSSLTransportParameters sslParam =\n        new TSSLTransportFactory.TSSLTransportParameters(&quot;TLSv1.2&quot;, null, false);\nsslParam.setKeyStore(cert.p12, password, &quot;SunX509&quot;, &quot;PKCS12&quot;);\nsslParam.setTrustStore(truststore.p12, password, &quot;SunX509&quot;, &quot;PKCS12&quot;);\nclientSocket = TSSLTransportFactory.getClientSocket(key.hostname, key.port, timeoutMs, sslParam);\n</code></pre>\n<p>Why is there a difference between the OpenSSL-generated PKCS12 (with only CA cert, -nokeys) and the keytool-generated PKCS12?</p>\n<p>Why does Java not accept the OpenSSL version as a valid truststore?</p>\n<p>It is working correctly now, so the code and the other certificates are not the problem.<br />\nI just want to understand the difference between a <code>truststore.p12</code> generated with <strong>keytool</strong> and one generated with <strong>OpenSSL</strong>.<br />\nDid keytool apply some special handling that OpenSSL did not?</p>\n",
    "tags" : [ "java", "openssl", "keytool", "pkcs#12", "mtls" ],
    "owner" : {
      "account_id" : 28979347,
      "reputation" : 21,
      "user_id" : 22197587,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/OnSi8.jpg?s=256",
      "display_name" : "koarz",
      "link" : "https://stackoverflow.com/users/22197587/koarz"
    },
    "is_answered" : false,
    "view_count" : 68,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1756451238,
    "creation_date" : 1756451238,
    "link" : "https://stackoverflow.com/questions/79749927/why-does-a-pkcs12-truststore-generated-with-openssl-nokeys-not-work-in-java",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140814753,
    "post_id" : 79749927,
    "body" : "I&#39;ll add a note here—I already know what&#39;s going on, but I haven&#39;t updated the question yet. Keytool adds an Entry to the Truststore: <code>keytool -list -v -keystore truststore.p12 -storetype PKCS12 -storepass 123456 | grep “Entry type”</code> <code>Entry type: trustedCertEntry</code> When generating directly with OpenSSL, this entry is absent, causing the error.should use keytool to generate the Truststore:` keytool -importcert   -trustcacerts   -alias myca   -file ca.crt   -keystore truststore.p12   -storetype PKCS12   -noprompt`",
    "score" : 0,
    "owner" : {
      "account_id" : 28979347,
      "reputation" : 21,
      "user_id" : 22197587,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/OnSi8.jpg?s=256",
      "display_name" : "koarz",
      "link" : "https://stackoverflow.com/users/22197587/koarz"
    },
    "creation_date" : 1761299763,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140740110,
    "post_id" : 79749927,
    "body" : "Yes, keytool adds a special &quot;marker&quot; to the certificates. OpenSSL 3.2 (or higher) supports this by adding &quot;-jdktrust anyExtendedKeyUsage&quot; to the export command.",
    "score" : 0,
    "owner" : {
      "account_id" : 3161353,
      "reputation" : 4164,
      "user_id" : 2672392,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/4dbd3cffc30b48a78804e85d7651ba3c?s=256&d=identicon&r=PG",
      "display_name" : "Omikron",
      "link" : "https://stackoverflow.com/users/2672392/omikron"
    },
    "creation_date" : 1758037740,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140705844,
    "post_id" : 79749927,
    "body" : "@dan1st Sure, and the <code>keytool</code> produced one. Nobody said otherwise. But <code>SSL.com</code> says that <code>openssl pkcs12</code> can&#39;t produce one, and it didn&#39;t: it produced an empty truststore. Is this really the correct <code>openssl</code> command?",
    "score" : 0,
    "owner" : {
      "account_id" : 71739,
      "reputation" : 311872,
      "user_id" : 207421,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=256&d=identicon&r=PG",
      "display_name" : "user207421",
      "link" : "https://stackoverflow.com/users/207421/user207421"
    },
    "creation_date" : 1756687037,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140705707,
    "post_id" : 79749927,
    "body" : "@user207421 AFAIK p12 supports truststores containing public keys without corresponding private keys which is what the OP wants.",
    "score" : 0,
    "owner" : {
      "account_id" : 15064163,
      "reputation" : 17085,
      "user_id" : 10871900,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/720202b6e19abc330dcd92e6a1254562?s=256&d=identicon&r=PG",
      "display_name" : "dan1st",
      "link" : "https://stackoverflow.com/users/10871900/dan1st"
    },
    "creation_date" : 1756676524,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140703215,
    "post_id" : 79749927,
    "body" : "The tutorial at SSL.com says you can&#39;t export .crt to .p12 without including the private key, It works but evidently nothing is actually done. But you have your <code>keytool</code> command.",
    "score" : 0,
    "owner" : {
      "account_id" : 71739,
      "reputation" : 311872,
      "user_id" : 207421,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=256&d=identicon&r=PG",
      "display_name" : "user207421",
      "link" : "https://stackoverflow.com/users/207421/user207421"
    },
    "creation_date" : 1756541530,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140700990,
    "post_id" : 79749927,
    "body" : "ok, still thanks for your answer",
    "score" : 1,
    "owner" : {
      "account_id" : 28979347,
      "reputation" : 21,
      "user_id" : 22197587,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/OnSi8.jpg?s=256",
      "display_name" : "koarz",
      "link" : "https://stackoverflow.com/users/22197587/koarz"
    },
    "creation_date" : 1756457245,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140700834,
    "post_id" : 79749927,
    "body" : "Ignore that, I was wrong. I still think there&#39;s something wrong with that <code>openssl</code> command, but I&#39;m rusty enough not to know what it is.",
    "score" : 0,
    "owner" : {
      "account_id" : 71739,
      "reputation" : 311872,
      "user_id" : 207421,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=256&d=identicon&r=PG",
      "display_name" : "user207421",
      "link" : "https://stackoverflow.com/users/207421/user207421"
    },
    "creation_date" : 1756453531,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140700800,
    "post_id" : 79749927,
    "body" : "sorry, maybe i&#39;m not understand, please forgive me without <code>-nokeys</code> the command can&#39;t execute <code>$ openssl pkcs12 -export -in &quot;ca.crt&quot; -out &quot;truststore.p12&quot; unable to load private key 140304383473472:error:0909006C:PEM routines:get_name:no start line:crypto&#47;pem&#47;pem_lib.c:745:Expecting: ANY PRIVATE KEY</code>",
    "score" : 0,
    "owner" : {
      "account_id" : 28979347,
      "reputation" : 21,
      "user_id" : 22197587,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/OnSi8.jpg?s=256",
      "display_name" : "koarz",
      "link" : "https://stackoverflow.com/users/22197587/koarz"
    },
    "creation_date" : 1756452747,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140700796,
    "post_id" : 79749927,
    "body" : "What does <code>keytool -list -keystore truststore.p12</code> print? When I follow your steps it prints <code>your keystore contains 0 entries</code>.",
    "score" : 1,
    "owner" : {
      "account_id" : 71739,
      "reputation" : 311872,
      "user_id" : 207421,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=256&d=identicon&r=PG",
      "display_name" : "user207421",
      "link" : "https://stackoverflow.com/users/207421/user207421"
    },
    "creation_date" : 1756452597,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}