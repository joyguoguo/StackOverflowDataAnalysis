{
  "question" : {
    "question_id" : 79774727,
    "title" : "How to write a custom meta annotation to check for authority when using Spring Security?",
    "body" : "<p>I have an enum with permission values:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public enum Permission {\n    DASHBOARD_OPEN(&quot;dashboard:open&quot;);\n\n    private final String key;\n\n    Permission(String key) {\n        this.key = key;\n    }\n\n    @Override\n    public String toString() {\n        return key;\n    }\n}\n</code></pre>\n<p>that I want to use in a meta-annotation:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Target({ElementType.METHOD, ElementType.TYPE})\n@Retention(RetentionPolicy.RUNTIME)\n@PreAuthorize(&quot;hasAuthority('{value}')&quot;)\npublic @interface HasPermission {\n    Permission value();\n}\n</code></pre>\n<p>like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@HasPermission(DASHBOARD_OPEN)\n@RequestMapping({&quot;/dashboard&quot;,})\npublic String dashboard() {\n    return &quot;dashboard&quot;;\n}\n</code></pre>\n<p>It doesn't work, I get 403 errors no matter how I'm trying to configure this. <code>{value}</code> doesn't work, <code>{value.key}</code> doesn't work and I also tried all the permutations that are possible. I checked and my user has the appropriate authority. If I don't use this meta-annotation then my page is accessible though:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@PreAuthorize(&quot;hasAuthority('dashboard:open')&quot;) // &lt;-- works\n@RequestMapping({&quot;/dashboard&quot;,})\npublic String dashboard() {\n    return &quot;dashboard&quot;;\n}\n</code></pre>\n<p>What am I doing wrong? How can I make the <code>enum</code> solution work (as opposed to just passing <code>String</code>s)?</p>\n<p>Note that I copied the example from the Spring Security documentation and I'm wondering why it doesn't work at all:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Target({ ElementType.METHOD, ElementType.TYPE })\n@Retention(RetentionPolicy.RUNTIME)\n@PreAuthorize(&quot;hasRole('{value}')&quot;)\npublic @interface HasRole {\n    String value();\n}\n</code></pre>\n",
    "tags" : [ "java", "spring", "spring-security", "authorization" ],
    "owner" : {
      "account_id" : 225067,
      "reputation" : 30772,
      "user_id" : 485337,
      "user_type" : "registered",
      "accept_rate" : 91,
      "profile_image" : "https://i.sstatic.net/VAz9B.jpg?s=256",
      "display_name" : "Adam Arold",
      "link" : "https://stackoverflow.com/users/485337/adam-arold"
    },
    "is_answered" : false,
    "view_count" : 45,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1758798436,
    "creation_date" : 1758798436,
    "link" : "https://stackoverflow.com/questions/79774727/how-to-write-a-custom-meta-annotation-to-check-for-authority-when-using-spring-s",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140782783,
    "post_id" : 79774727,
    "body" : "you are not doing anything wrong, my guess is that templating in annotations like you want does not work, that it will interpret <code>&#39;{value}&#39;</code> as a string literal",
    "score" : 0,
    "owner" : {
      "account_id" : 2064278,
      "reputation" : 15107,
      "user_id" : 1840146,
      "user_type" : "registered",
      "accept_rate" : 86,
      "profile_image" : "https://i.sstatic.net/JXdxm.png?s=256",
      "display_name" : "Toerktumlare",
      "link" : "https://stackoverflow.com/users/1840146/toerktumlare"
    },
    "creation_date" : 1759874211,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140759641,
    "post_id" : 79774727,
    "body" : "And next to copy/pasting the annotation, you did also include the configuration changes needed for this?",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1758808592,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}