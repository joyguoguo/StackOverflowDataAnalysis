{
  "question" : {
    "question_id" : 79829352,
    "title" : "java.lang.ClassNotFoundException: okio.Buffer when using OkHttp inside Eclipse plugin (OSGi)",
    "body" : "<p>I am developing an <strong>Eclipse plugin</strong> (OSGi environment) and trying to use <strong>OkHttp 4.11.0</strong> to send HTTP requests. However, I get the following runtime error:</p>\n<blockquote>\n<p>java.lang.ClassNotFoundException: okio.Buffer cannot be found by eclipseai.plugin_1.0.0</p>\n</blockquote>\n<p><strong>Minimal Reproducible Example (MRE)</strong></p>\n<pre><code>package eclipseai.test;\n\nimport okhttp3.OkHttpClient;\nimport okhttp3.Request;\nimport okhttp3.Response;\nimport java.io.IOException;\n\npublic class OkHttpTest {\n\n    public static void main(String[] args) throws IOException {\n        OkHttpClient client = new OkHttpClient(); // ClassNotFoundException occurs here\n        Request request = new Request.Builder()\n                .url(&quot;https://www.google.com&quot;)\n                .build();\n\n        Response response = client.newCall(request).execute();\n        System.out.println(response.body().string());\n    }\n}\n</code></pre>\n<p><strong>How to reproduce inside an Eclipse plugin (OSGi)</strong></p>\n<ol>\n<li><p>Create a new Eclipse plugin project (e.g., <code>eclipseai.plugin</code>).</p>\n</li>\n<li><p>Add these JARs to a <code>library/</code> folder in the plugin:</p>\n<ul>\n<li><p><code>okhttp-4.11.0.jar</code></p>\n</li>\n<li><p><code>okio-3.4.0.jar</code></p>\n</li>\n<li><p><code>kotlin-stdlib-2.2.21.jar</code></p>\n</li>\n</ul>\n</li>\n<li><p>Add them to <strong>MANIFEST.MF</strong> <code>Bundle-ClassPath</code>:</p>\n<pre class=\"lang-none prettyprint-override\"><code>Bundle-ClassPath: .,\n library/okhttp-4.11.0.jar,\n library/okio-3.4.0.jar,\n library/kotlin-stdlib-2.2.21.jar\n</code></pre>\n</li>\n<li><p>Add them to <strong>build.properties</strong> <code>bin.includes</code>:</p>\n<pre class=\"lang-none prettyprint-override\"><code>bin.includes = plugin.xml, META-INF/, .,\n               library/okhttp-4.11.0.jar,\n               library/okio-3.4.0.jar,\n               library/kotlin-stdlib-2.2.21.jar\n</code></pre>\n</li>\n<li><p>Run the plugin â†’ <strong>ClassNotFoundException</strong> occurs on <code>okio.Buffer</code>.</p>\n</li>\n</ol>\n<hr />\n<p>How can I correctly include OkHttp and Okio in an Eclipse plugin so that <code>okio.Buffer</code> is properly loaded without causing <code>ClassNotFoundException</code>?</p>\n",
    "tags" : [ "java", "eclipse", "eclipse-plugin", "okhttp", "osgi-bundle" ],
    "owner" : {
      "account_id" : 44790492,
      "reputation" : 1,
      "user_id" : 31937198,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/4af97202229854b28b20c9d15eda3dc3?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "kiruba T",
      "link" : "https://stackoverflow.com/users/31937198/kiruba-t"
    },
    "is_answered" : false,
    "view_count" : 124,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1765773566,
    "creation_date" : 1764051975,
    "link" : "https://stackoverflow.com/questions/79829352/java-lang-classnotfoundexception-okio-buffer-when-using-okhttp-inside-eclipse-p",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79829694,
    "question_id" : 79829352,
    "body" : "<p>Replace <a href=\"https://mvnrepository.com/artifact/com.squareup.okio/okio/3.4.0\" rel=\"nofollow noreferrer\">okio-3.4.0.jar</a> with <a href=\"https://mvnrepository.com/artifact/com.squareup.okio/okio-jvm/3.4.0\" rel=\"nofollow noreferrer\">okio-jvm-3.4.0.jar</a></p>\n<p>The okio-3.4.0.jar is a metadata file needed only for <a href=\"https://kotlinlang.org/docs/multiplatform/kmp-overview.html\" rel=\"nofollow noreferrer\">Kotlin Multilplatform (KMP)</a> (not applicable in context of Eclipse plug-ins)</p>\n<p><a href=\"https://github.com/basilevs/kotlin_example\" rel=\"nofollow noreferrer\">A fixed project</a></p>\n<p>A working command line that PDE executes:</p>\n<pre><code>/Library/Java/JavaVirtualMachines/jdk-17.0.4.1.jdk/Contents/Home/bin/java\n-XstartOnFirstThread\n-Dfile.encoding=UTF-8\n-Dstdout.encoding=UTF-8\n-Dstderr.encoding=UTF-8\n-classpath ${workspace_loc:/com.example.kotlin}/okio-jvm-3.4.0.jar:${workspace_loc:com.example.kotlin}/kotlin-reflect-2.2.21.jar:${workspace_loc:com.example.kotlin}/kotlin-stdlib-2.2.21.jar:${workspace_loc:com.example.kotlin}/okhttp-4.11.0.jar:${workspace_loc}/.metadata/.plugins/org.eclipse.pde.core/.bundle_pool/plugins/org.osgi.annotation.versioning_1.1.2.202109301733.jar:${workspace_loc}/.metadata/.plugins/org.eclipse.pde.core/.bundle_pool/plugins/org.osgi.annotation.bundle_2.0.0.202202082230.jar:${workspace_loc}/.metadata/.plugins/org.eclipse.pde.core/.bundle_pool/plugins/org.osgi.service.component.annotations_1.5.1.202212101352.jar:${workspace_loc}/.metadata/.plugins/org.eclipse.pde.core/.bundle_pool/plugins/org.osgi.service.metatype.annotations_1.4.1.202109301733.jar:${workspace_loc}/.metadata/.plugins/org.eclipse.pde.core/.bundle_pool/plugins/org.eclipse.swt_3.125.0.v20240227-1638.jar:${workspace_loc}/.metadata/.plugins/org.eclipse.pde.core/.bundle_pool/plugins/org.eclipse.swt.cocoa.macosx.aarch64_3.125.0.v20240227-1638.jar:${workspace_loc}/.metadata/.plugins/org.eclipse.pde.core/.bundle_pool/plugins/org.eclipse.jface_3.33.0.v20240214-1640.jar:${workspace_loc}/.metadata/.plugins/org.eclipse.pde.core/.bundle_pool/plugins/org.eclipse.core.commands_3.12.0.v20240214-1640.jar:${workspace_loc}/com.example.kotlin/bin\n-XX:+ShowCodeDetailsInExceptionMessages com.example.kotlin.OkHttpTest\n</code></pre>\n<p><sub>I do not work with Kotlin, so I had to rely on ChatGPT for analysis. The result is manually verified.</sub></p>\n",
    "score" : -1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 43022,
      "reputation" : 24624,
      "user_id" : 125562,
      "user_type" : "registered",
      "accept_rate" : 64,
      "profile_image" : "https://i.sstatic.net/SdIqA.png?s=256",
      "display_name" : "Basilevs",
      "link" : "https://stackoverflow.com/users/125562/basilevs"
    },
    "creation_date" : 1764073032,
    "last_activity_date" : 1764097823,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140872880,
    "post_id" : 79829352,
    "body" : "@dan1st the default target platfrom is &quot;Runtime&#39; taken from currently running PDE.",
    "score" : 0,
    "owner" : {
      "account_id" : 43022,
      "reputation" : 24624,
      "user_id" : 125562,
      "user_type" : "registered",
      "accept_rate" : 64,
      "profile_image" : "https://i.sstatic.net/SdIqA.png?s=256",
      "display_name" : "Basilevs",
      "link" : "https://stackoverflow.com/users/125562/basilevs"
    },
    "creation_date" : 1764097041,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140872843,
    "post_id" : 79829352,
    "body" : "I honestly want to know it with the setup of the OP, I don&#39;t know their target platform.",
    "score" : 0,
    "owner" : {
      "account_id" : 15064163,
      "reputation" : 17111,
      "user_id" : 10871900,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/720202b6e19abc330dcd92e6a1254562?s=256&d=identicon&r=PG",
      "display_name" : "dan1st",
      "link" : "https://stackoverflow.com/users/10871900/dan1st"
    },
    "creation_date" : 1764095887,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140872836,
    "post_id" : 79829352,
    "body" : "<a href=\"https://meta.stackexchange.com/q/412869\">Moving comments to chat isn&#39;t (always) working, and no error message is visible</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 43022,
      "reputation" : 24624,
      "user_id" : 125562,
      "user_type" : "registered",
      "accept_rate" : 64,
      "profile_image" : "https://i.sstatic.net/SdIqA.png?s=256",
      "display_name" : "Basilevs",
      "link" : "https://stackoverflow.com/users/125562/basilevs"
    },
    "creation_date" : 1764095587,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140872825,
    "post_id" : 79829352,
    "body" : "<a href=\"https://stackoverflow.com/q/69985777\">Okhttp3 jar missing okio?</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 43022,
      "reputation" : 24624,
      "user_id" : 125562,
      "user_type" : "registered",
      "accept_rate" : 64,
      "profile_image" : "https://i.sstatic.net/SdIqA.png?s=256",
      "display_name" : "Basilevs",
      "link" : "https://stackoverflow.com/users/125562/basilevs"
    },
    "creation_date" : 1764095370,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140872815,
    "post_id" : 79829352,
    "body" : "I&#39;ve tested <code>Import-Package</code>. Compiler fails with &quot;Neither an available bundle nor the associated JRE export package &#39;okio&#39;&quot;",
    "score" : 0,
    "owner" : {
      "account_id" : 43022,
      "reputation" : 24624,
      "user_id" : 125562,
      "user_type" : "registered",
      "accept_rate" : 64,
      "profile_image" : "https://i.sstatic.net/SdIqA.png?s=256",
      "display_name" : "Basilevs",
      "link" : "https://stackoverflow.com/users/125562/basilevs"
    },
    "creation_date" : 1764094962,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140872798,
    "post_id" : 79829352,
    "body" : "<code>Require-Bundle</code> would fail, because <code>okio</code> is not a bundle in the default Target Platform. Not sure about <code>Require-Package</code>, but I believe  it would be ignored as a self-dependency.",
    "score" : 0,
    "owner" : {
      "account_id" : 43022,
      "reputation" : 24624,
      "user_id" : 125562,
      "user_type" : "registered",
      "accept_rate" : 64,
      "profile_image" : "https://i.sstatic.net/SdIqA.png?s=256",
      "display_name" : "Basilevs",
      "link" : "https://stackoverflow.com/users/125562/basilevs"
    },
    "creation_date" : 1764094406,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140872772,
    "post_id" : 79829352,
    "body" : "@Basilevs I want to know what happens when using <code>Require-Bundle</code> with the bundle name of okio (or <code>Require-Package: okio</code> (optionally with a <code>;version=&quot;[3.4.0,4.0.0)&quot;</code> specification or similar)",
    "score" : 0,
    "owner" : {
      "account_id" : 15064163,
      "reputation" : 17111,
      "user_id" : 10871900,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/720202b6e19abc330dcd92e6a1254562?s=256&d=identicon&r=PG",
      "display_name" : "dan1st",
      "link" : "https://stackoverflow.com/users/10871900/dan1st"
    },
    "creation_date" : 1764093526,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140872756,
    "post_id" : 79829352,
    "body" : "@dan1st which dependencies would ypu specify? The example only depends on JARs that are already on classpath, no cross-bumdle dependencies are needed or would  change anything.",
    "score" : 0,
    "owner" : {
      "account_id" : 43022,
      "reputation" : 24624,
      "user_id" : 125562,
      "user_type" : "registered",
      "accept_rate" : 64,
      "profile_image" : "https://i.sstatic.net/SdIqA.png?s=256",
      "display_name" : "Basilevs",
      "link" : "https://stackoverflow.com/users/125562/basilevs"
    },
    "creation_date" : 1764092997,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140872745,
    "post_id" : 79829352,
    "body" : "I wanted to know whether something happens when specifying these/whether there is a different error.",
    "score" : 0,
    "owner" : {
      "account_id" : 15064163,
      "reputation" : 17111,
      "user_id" : 10871900,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/720202b6e19abc330dcd92e6a1254562?s=256&d=identicon&r=PG",
      "display_name" : "dan1st",
      "link" : "https://stackoverflow.com/users/10871900/dan1st"
    },
    "creation_date" : 1764092622,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140872741,
    "post_id" : 79829352,
    "body" : "@dan1st there are no required bundles or package imports. Plugin does not need to import anything to reproduce the problem",
    "score" : 0,
    "owner" : {
      "account_id" : 43022,
      "reputation" : 24624,
      "user_id" : 125562,
      "user_type" : "registered",
      "accept_rate" : 64,
      "profile_image" : "https://i.sstatic.net/SdIqA.png?s=256",
      "display_name" : "Basilevs",
      "link" : "https://stackoverflow.com/users/125562/basilevs"
    },
    "creation_date" : 1764092508,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140872484,
    "post_id" : 79829352,
    "body" : "Can you show the full stack trace and may also try using <code>Require-Bundle: </code>/<code>Require-Package</code> in your <code>MANIFEST.MF</code>?",
    "score" : 0,
    "owner" : {
      "account_id" : 15064163,
      "reputation" : 17111,
      "user_id" : 10871900,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/720202b6e19abc330dcd92e6a1254562?s=256&d=identicon&r=PG",
      "display_name" : "dan1st",
      "link" : "https://stackoverflow.com/users/10871900/dan1st"
    },
    "creation_date" : 1764085090,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140872122,
    "post_id" : 79829352,
    "body" : "@greg-449 while setup is indeed not run, classpath is properly injected by PDE, so you can run non-OSGI classes of an Eclipse plug-in from <code>main</code> method.",
    "score" : 0,
    "owner" : {
      "account_id" : 43022,
      "reputation" : 24624,
      "user_id" : 125562,
      "user_type" : "registered",
      "accept_rate" : 64,
      "profile_image" : "https://i.sstatic.net/SdIqA.png?s=256",
      "display_name" : "Basilevs",
      "link" : "https://stackoverflow.com/users/125562/basilevs"
    },
    "creation_date" : 1764074507,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140872077,
    "post_id" : 79829352,
    "body" : "You can&#39;t run Eclipse plugin code from a normal Java <code>main</code> - none of the OSGi setup will be done and the classpaths will not be set up.",
    "score" : 0,
    "owner" : {
      "account_id" : 3159259,
      "reputation" : 111562,
      "user_id" : 2670892,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/4iPV5.png?s=256",
      "display_name" : "greg-449",
      "link" : "https://stackoverflow.com/users/2670892/greg-449"
    },
    "creation_date" : 1764072740,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140871646,
    "post_id" : 79829352,
    "body" : "You have a main method. How do you run it? As a <i>Java Application</i> (which will ignore your <code>Bundle-ClassPath</code>) or as a <i>Java Application</i> or an <i>OSGi Framework</i>? Please show your command line (in the launch configuration there is a button <i>Show Command Line</i>).",
    "score" : 1,
    "owner" : {
      "account_id" : 8692823,
      "reputation" : 35045,
      "user_id" : 6505250,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/FgNJn.jpg?s=256",
      "display_name" : "howlger",
      "link" : "https://stackoverflow.com/users/6505250/howlger"
    },
    "creation_date" : 1764057578,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79829694" : [ {
      "comment_id" : 140872113,
      "post_id" : 79829694,
      "body" : "@greg-449 PDE injects the classpath even when main method is run. Other classes (for example Kotlin*) are resolved fine. The problem only happens specifically for <code>okio.Buffer</code>. My method does not help (I can still reproduce original problem.",
      "score" : 0,
      "owner" : {
        "account_id" : 43022,
        "reputation" : 24624,
        "user_id" : 125562,
        "user_type" : "registered",
        "accept_rate" : 64,
        "profile_image" : "https://i.sstatic.net/SdIqA.png?s=256",
        "display_name" : "Basilevs",
        "link" : "https://stackoverflow.com/users/125562/basilevs"
      },
      "creation_date" : 1764074316,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140872087,
      "post_id" : 79829694,
      "body" : "If the code is being run from a &quot;main&quot; method this isn&#39;t going to help",
      "score" : 0,
      "owner" : {
        "account_id" : 3159259,
        "reputation" : 111562,
        "user_id" : 2670892,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/4iPV5.png?s=256",
        "display_name" : "greg-449",
        "link" : "https://stackoverflow.com/users/2670892/greg-449"
      },
      "creation_date" : 1764073088,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}