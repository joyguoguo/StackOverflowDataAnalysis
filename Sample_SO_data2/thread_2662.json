{
  "question" : {
    "question_id" : 79608011,
    "title" : "How/where to use @Valid in Spring Functional Endpoints",
    "body" : "<p>I'm trying to move from traditional Spring MVC controllers to a functional routing approach using RouterFunctions (not reactive)</p>\n<p>However, I cannot figure out how/where to apply bean validation.</p>\n<p>In my traditional controller, validation is straightforward using the ``@Valid` annotation from Jakarta:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@RestController\npublic class PersonController {\n    @PostMapping(&quot;/validateAndCreatePerson&quot;)\n    String validateAndCreatePerson(@RequestBody @Valid Person person) {\n    // Validation happens automatically, no need for extra custom Validator here.\n    }\n}\n</code></pre>\n<p>My Person class has the appropriate validation annotations:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class Person {\n    @NotNull\n    @Size(min = 4, max = 15)\n    private String location;\n\n    @NotBlank\n    private String name;\n}\n</code></pre>\n<p>However, in my functional approach with <code>RouterFunction</code>, I don't see how/where to apply the same validation:</p>\n<pre class=\"lang-java prettyprint-override\"><code>    @Service\n    public class PersonHandler {\n        public ServerResponse createPerson(ServerRequest request) {\n            Person person = request.body(Person.class);\n            // How do I apply validation here?\n            return ok().build(...);\n        }\n    }\n</code></pre>\n<p>And my functional router:</p>\n<pre class=\"lang-java prettyprint-override\"><code>    @Service\n    public class RouterFunctionService {\n        @Bean\n        public RouterFunction&lt;ServerResponse&gt; question(PersonHandler handler) {\n            return route()\n                .POST(&quot;/person&quot;, handler::createPerson)\n                .build();\n        }\n    }\n</code></pre>\n<p>How can I apply the equivalent of @Valid annotation in this functional approach?</p>\n<p>Without having to rewrite a custom validator, like suggested in this official documentation:\n<a href=\"https://docs.spring.io/spring-framework/reference/web/webmvc-functional.html#webmvc-fn-handler-validation\" rel=\"nofollow noreferrer\">https://docs.spring.io/spring-framework/reference/web/webmvc-functional.html#webmvc-fn-handler-validation</a></p>\n<p>Any guidance would be appreciated!</p>\n",
    "tags" : [ "java", "spring-boot", "jakarta-validation", "functional-endpoints" ],
    "owner" : {
      "account_id" : 41806134,
      "reputation" : 36,
      "user_id" : 30457318,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ab3268ce446c682659f551fb4c187905?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "user30457318",
      "link" : "https://stackoverflow.com/users/30457318/user30457318"
    },
    "is_answered" : true,
    "view_count" : 166,
    "answer_count" : 2,
    "score" : 1,
    "last_activity_date" : 1746509948,
    "creation_date" : 1746508399,
    "link" : "https://stackoverflow.com/questions/79608011/how-where-to-use-valid-in-spring-functional-endpoints",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79608024,
    "question_id" : 79608011,
    "body" : "<p>you can try this:</p>\n<pre><code>// create ValidatorFactory instance\nValidatorFactory factory = Validation.buildDefaultValidatorFactory();\nValidator validator = factory.getValidator();\n// exec valid\nSet&lt;ConstraintViolation&lt;Person&gt;&gt; violations = validator.validate(person);\n// print valid result\nif (!violations.isEmpty()) {\n    for (ConstraintViolation&lt;ProjectExportVO&gt; violation : violations) {\n        // \n    }\n}\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 23476575,
      "reputation" : 21,
      "user_id" : 17529286,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AATXAJyvrN16zq0YYKa-5ANuWyDbY3lzpYTGI-XE7uGz=k-s256",
      "display_name" : "HFwas",
      "link" : "https://stackoverflow.com/users/17529286/hfwas"
    },
    "creation_date" : 1746509460,
    "last_activity_date" : 1746509460,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79608035,
    "question_id" : 79608011,
    "body" : "<p>In Spring MVC, when you use <code>@RestController</code>, the controller arguments are handled by <code>HandlerMethodArgumentResolver</code>, which automatically applies <code>@Valid</code> and throws exceptions if validation fails.</p>\n<p>But when you use Spring functional routing (<code>RouterFunction</code>), that automatic validation &quot;magic&quot; isn't available, so you have to do the validation manually.</p>\n<p><a href=\"https://docs.spring.io/spring-framework/reference/web/webmvc-functional.html#webmvc-fn-handler-validation\" rel=\"nofollow noreferrer\">See Functional Endpoints - Validation:</a></p>\n<blockquote>\n<p>A functional endpoint can use Springâ€™s validation facilities to apply validation to the request body</p>\n</blockquote>\n<p>You can try to inject a <code>Validator</code> bean and perform validation manually, something like this:</p>\n<pre><code>@Service\npublic class PersonHandler {\n\n    private final Validator validator;\n\n    public PersonHandler(Validator validator) {\n        this.validator = validator;\n    }\n\n    public ServerResponse createPerson(ServerRequest request) {\n        Person person = request.body(Person.class);\n\n        // Manually validate\n        Errors errors = new BeanPropertyBindingResult(person, &quot;person&quot;);\n        validator.validate(person, errors);\n\n        if (errors.hasErrors()) {\n            // Build a response with error details\n            return ServerResponse.badRequest().body(errors.getAllErrors());\n        }\n\n        return ServerResponse.ok().body(&quot;Person created&quot;);\n    }\n}\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 38931631,
      "reputation" : 671,
      "user_id" : 29023248,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/WxoZEuKw.png?s=256",
      "display_name" : "Aleksey Bykov",
      "link" : "https://stackoverflow.com/users/29023248/aleksey-bykov"
    },
    "creation_date" : 1746509948,
    "last_activity_date" : 1746509948,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140401455,
    "post_id" : 79608011,
    "body" : "<a href=\"https://docs.spring.io/spring-framework/reference/core/validation/beanvalidation.html#validation-beanvalidation-spring-method\" rel=\"nofollow noreferrer\">docs.spring.io/spring-framework/reference/core/validation/&hellip;</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 4181375,
      "reputation" : 6263,
      "user_id" : 3426309,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/v58O6.jpg?s=256",
      "display_name" : "Andrey B. Panfilov",
      "link" : "https://stackoverflow.com/users/3426309/andrey-b-panfilov"
    },
    "creation_date" : 1746554201,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79608035" : [ {
      "comment_id" : 140399831,
      "post_id" : 79608035,
      "body" : "In the annotation-based style, Spring uses reflection, while in the functional style the developer has full control over the request handling.",
      "score" : 0,
      "owner" : {
        "account_id" : 38931631,
        "reputation" : 671,
        "user_id" : 29023248,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/WxoZEuKw.png?s=256",
        "display_name" : "Aleksey Bykov",
        "link" : "https://stackoverflow.com/users/29023248/aleksey-bykov"
      },
      "creation_date" : 1746527556,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140399777,
      "post_id" : 79608035,
      "body" : "Well, at least as far as I know - no. This is an architectural feature of the functional style. You could try looking into <a href=\"https://github.com/spring-projects-experimental/spring-fu\" rel=\"nofollow noreferrer\">SpringFu</a>, but I&#39;m not sure that it will really help.",
      "score" : 0,
      "owner" : {
        "account_id" : 38931631,
        "reputation" : 671,
        "user_id" : 29023248,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/WxoZEuKw.png?s=256",
        "display_name" : "Aleksey Bykov",
        "link" : "https://stackoverflow.com/users/29023248/aleksey-bykov"
      },
      "creation_date" : 1746526543,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140399710,
      "post_id" : 79608035,
      "body" : "So it seems there are really no way to get the benefits of @Valid in this functional router? :(",
      "score" : 0,
      "owner" : {
        "account_id" : 41806134,
        "reputation" : 36,
        "user_id" : 30457318,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/ab3268ce446c682659f551fb4c187905?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "user30457318",
        "link" : "https://stackoverflow.com/users/30457318/user30457318"
      },
      "creation_date" : 1746525463,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}