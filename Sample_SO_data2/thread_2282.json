{
  "question" : {
    "question_id" : 79635559,
    "title" : "Java Swing frame looks different in BufferedImage vs OS",
    "body" : "<p>I have a swing frame that I am constructing and painting to a <code>BufferedImage</code>. However I can't seem to get the layout to match what I see in the OS.</p>\n<p>This is what shows in the OS i.e. the &quot;real thing&quot;:</p>\n<p><a href=\"https://i.sstatic.net/Jb91Vx2C.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/Jb91Vx2C.png\" alt=\"OS\" /></a></p>\n<p>But this is what gets painted to the image:</p>\n<p><a href=\"https://i.sstatic.net/oTBi30YA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/oTBi30YA.png\" alt=\"Image\" /></a></p>\n<p>The layouts are different. The text at the bottom does not have the correct vertical space. The frame is using a <code>GridBagLayout</code>. This seems to be related to the layout, but it doesn't appear to matter <em>which</em> layout I use, rather its more about timing. I can't figure out how to force swing to layout the frame the same, or to <em>wait</em> until it's laid out before painting to the image.</p>\n<p>Below is the code Im using to render and paint. Im guessing I need to introduce some other call or listener before I paint to the image?</p>\n<pre><code>     SplashScreen frame = new SplashScreen(); // extends JFrame\n        frame.setDistributionStatement(&quot;&lt;html&gt;Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.&lt;html&gt;&quot;);\n        frame.setReleaseInformation(&quot;&lt;html&gt;Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt.&lt;/html&gt;&quot;);\n        frame.setProductName(&quot;Title&quot;)\n\n        BufferedImage image = new BufferedImage(frame.getWidth(),frame.getHeight(), BufferedImage.TYPE_INT_ARGB)\n        Graphics2D g2d = image.createGraphics();\n\n        frame.pack() // Not sure if this helps\n        frame.validate() // Not sure if this helps\n        frame.setVisible(true) // Frame must be visible to paint\n        frame.invalidate() // Not sure if this helps\n\n        frame.paintAll(g2d) // Paints to image\n</code></pre>\n<p>Edit:</p>\n<p>FWIW, while I work on a simpler example, adding a <code>Thread.sleep(750)</code> before drawing the image seems to fix it. So that makes me lean further toward it being a timing/threading issue. I will come back with a more concise example though.</p>\n",
    "tags" : [ "java", "swing" ],
    "owner" : {
      "account_id" : 2184749,
      "reputation" : 766,
      "user_id" : 1933399,
      "user_type" : "registered",
      "accept_rate" : 29,
      "profile_image" : "https://i.sstatic.net/GdzEk.png?s=256",
      "display_name" : "The Shoe Shiner",
      "link" : "https://stackoverflow.com/users/1933399/the-shoe-shiner"
    },
    "is_answered" : false,
    "view_count" : 81,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1748014115,
    "creation_date" : 1748005362,
    "link" : "https://stackoverflow.com/questions/79635559/java-swing-frame-looks-different-in-bufferedimage-vs-os",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140490106,
    "post_id" : 79635559,
    "body" : "@VGR Well, it does, because that&#39;s what&#39;s producing the image. However, <code>printAll</code> does appear to be the more correct route, though I can&#39;t find specific information as to why. But neither of them handle the layouts correctly. In the end the only workaround was to abandon the complex layouts and size / place my components manually. Obviously this is only feasible because it&#39;s a fairly simple panel.",
    "score" : 0,
    "owner" : {
      "account_id" : 2184749,
      "reputation" : 766,
      "user_id" : 1933399,
      "user_type" : "registered",
      "accept_rate" : 29,
      "profile_image" : "https://i.sstatic.net/GdzEk.png?s=256",
      "display_name" : "The Shoe Shiner",
      "link" : "https://stackoverflow.com/users/1933399/the-shoe-shiner"
    },
    "creation_date" : 1749125286,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140453995,
    "post_id" : 79635559,
    "body" : "<code>frame.paintAll(g2d) &#47;&#47; Paints to image</code> … No, it probably doesn’t.  Swing painting is complex and can’t be applied to just any Graphics.  Instead, try <a href=\"https://docs.oracle.com/en/java/javase/24/docs/api/java.desktop/java/awt/Component.html#printAll(java.awt.Graphics)\" rel=\"nofollow noreferrer\">printAll</a> or <a href=\"https://docs.oracle.com/en/java/javase/24/docs/api/java.desktop/javax/swing/SwingUtilities.html#paintComponent(java.awt.Graphics,java.awt.Component,java.awt.Container,int,int,int,int)\" rel=\"nofollow noreferrer\">SwingUtilities.paintComponent</a> (create a separate off-screen Frame as the container argument).",
    "score" : 1,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44991,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1748031565,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140453530,
    "post_id" : 79635559,
    "body" : "Hello The Shoe Shiner, I would add to what you have been told, put <b>setVisible</b> as the last line.",
    "score" : 0,
    "owner" : {
      "account_id" : 10843443,
      "reputation" : 924,
      "user_id" : 20882864,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/CCQCy.jpg?s=256",
      "display_name" : "Marce Puente",
      "link" : "https://stackoverflow.com/users/20882864/marce-puente"
    },
    "creation_date" : 1748019708,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140452952,
    "post_id" : 79635559,
    "body" : "You really need to provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>",
    "score" : 4,
    "owner" : {
      "account_id" : 22124137,
      "reputation" : 4244,
      "user_id" : 16376827,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/1ImPw.png?s=256",
      "display_name" : "g00se",
      "link" : "https://stackoverflow.com/users/16376827/g00se"
    },
    "creation_date" : 1748009001,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140452941,
    "post_id" : 79635559,
    "body" : "Try doing things in logical order.  1) Create the splash screen.  2) Make the splash screen visible.  3) Now, create the buffered image.  4) Paint the splash screen on the buffered image.  5) Dispose of the <code>Graphics2D</code> pointer.",
    "score" : 0,
    "owner" : {
      "account_id" : 114128,
      "reputation" : 51685,
      "user_id" : 300257,
      "user_type" : "registered",
      "accept_rate" : 89,
      "profile_image" : "https://i.sstatic.net/gWeJr.jpg?s=256",
      "display_name" : "Gilbert Le Blanc",
      "link" : "https://stackoverflow.com/users/300257/gilbert-le-blanc"
    },
    "creation_date" : 1748008797,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}