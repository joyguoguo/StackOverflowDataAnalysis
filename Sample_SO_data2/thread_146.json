{
  "question" : {
    "question_id" : 79825518,
    "title" : "Reading and Writing CustomStructType with Eclipse Milo OPC-UA",
    "body" : "<p>I am new to <code>OPC-UA</code> and trying to use Eclipse Milo to read and write Objects but I am getting the following Error:</p>\n<pre class=\"lang-console prettyprint-override\"><code>org.eclipse.milo.opcua.stack.core.UaSerializationException: no codec registered for encodingId=ns=4;i=29\nat org.eclipse.milo.opcua.stack.core.encoding.binary.OpcUaDefaultBinaryEncoding.decode(OpcUaDefaultBinaryEncoding.java:89)\nat org.eclipse.milo.opcua.stack.core.types.builtin.ExtensionObject.lambda$decode$0(ExtensionObject.java:116)\nat org.eclipse.milo.opcua.stack.core.util.Lazy.get(Lazy.java:39)\nat org.eclipse.milo.opcua.stack.core.types.builtin.ExtensionObject.decode(ExtensionObject.java:116)\nat org.eclipse.milo.opcua.stack.core.types.builtin.ExtensionObject.decode(ExtensionObject.java:75)\n</code></pre>\n<p>I've followed the Milo Example to read and write objects to the tee. All I need, is to read some objects with <code>OPC-UA</code> to modify and then write them again.</p>\n<p>Here is my implementation:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public static class Codec extends GenericDataTypeCodec&lt;LoadColli&gt; {\n    @Override\n    public Class&lt;LoadColli&gt; getType() {\n        return LoadColli.class;\n    }\n\n    @Override\n    public LoadColli decodeType(EncodingContext context, UaDecoder decoder) throws UaSerializationException {\n        String id = decoder.decodeString(&quot;ID&quot;);\n        boolean finished = decoder.decodeBoolean(&quot;Finished&quot;);\n        boolean inProgress = decoder.decodeBoolean(&quot;InProgress&quot;);\n        return new LoadColli(finished, inProgress, id);\n    }\n\n    public void encodeType(EncodingContext context, UaEncoder encoder, LoadColli value)\n            throws UaSerializationException {\n        encoder.encodeString(&quot;ID&quot;, value.id);\n        encoder.encodeBoolean(&quot;Finished&quot;, value.isFinished());\n        encoder.encodeBoolean(&quot;InProgress&quot;, value.isInProgress());\n    }\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>private void registerCustomCodec(OpcUaClient client) {\n    NodeId dataTypeId = LoadColli.TYPE_ID\n            .toNodeId(client.getNamespaceTable())\n            .orElseThrow(() -&gt; new IllegalStateException(&quot;namespace not found&quot;));\n    NamespaceTable ns = client.getNamespaceTable();\n    NodeId binaryEncodingId = LoadColli.BINARY_ENCODING_ID\n            .toNodeId(client.getNamespaceTable())\n            .orElseThrow(() -&gt; new IllegalStateException(&quot;namespace not found&quot;));\n\n    // Register codec with the client's DataTypeManager instance.\n    // We need to register it by both its encodingId and its dataTypeId because it\n    // may be\n    // looked up by either depending on the context.\n\n    client\n        .getStaticDataTypeManager()\n        .registerType(dataTypeId, new LoadColli.Codec(), binaryEncodingId, null, null);\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>try {\n    NodeId nodeLoadColliId = NodeId.parse(&quot;ns=4;i=30&quot;);\n    UaVariableNode node = client.getAddressSpace().getVariableNode(nodeLoadColliId);\n    DataValue value = node.readValue();\n    Variant variant = value.value();\n    ExtensionObject xo = (ExtensionObject) variant.value();\n    LoadColli decoded = (LoadColli) xo.decode(client.getStaticEncodingContext());\n\n    ExtensionObject modifiedXo = ExtensionObject\n            .encode(client.getStaticEncodingContext(), loadColli);\n    Variant loadColliVariant = new Variant(modifiedXo);\n    NodeReaderWriter.writeNodeValue(client, NodeId.parse(&quot;ns=4;i=30&quot;),\n            loadColliVariant);\n} catch (UaException e) {\n    log.error(&quot; opc error when writing {}&quot;, e);\n}\n</code></pre>\n<p>Can someone help me to have clean implementation for reading and writing objects with different parameters using <code>OPC-UA</code>? I don't want to read and write every parameter individually.</p>\n",
    "tags" : [ "java", "opc-ua", "opc", "milo" ],
    "owner" : {
      "account_id" : 15934612,
      "reputation" : 11,
      "user_id" : 11498091,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0b52cea2bb644cd1bd4a2dabccd56a6e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Mabsito",
      "link" : "https://stackoverflow.com/users/11498091/mabsito"
    },
    "is_answered" : false,
    "view_count" : 82,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1764313745,
    "creation_date" : 1763641684,
    "link" : "https://stackoverflow.com/questions/79825518/reading-and-writing-customstructtype-with-eclipse-milo-opc-ua",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79831938,
    "question_id" : 79825518,
    "body" : "<p>Assuming that you are using <strong>Milo 1.0</strong> and you want to write values programmatically to your <strong>server</strong> (for client code, see below), you can look at <code>CustomStructType.java</code> in <code>server-examples</code>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>/*\n * Copyright (c) 2025 the Eclipse Milo Authors\n *\n * This program and the accompanying materials are made\n * available under the terms of the Eclipse Public License 2.0\n * which is available at https://www.eclipse.org/legal/epl-2.0/\n *\n * SPDX-License-Identifier: EPL-2.0\n */\n\npackage org.eclipse.milo.examples.server.types;\n\nimport static org.eclipse.milo.opcua.stack.core.types.builtin.unsigned.Unsigned.uint;\n\nimport com.google.common.base.MoreObjects;\nimport com.google.common.base.Objects;\nimport org.eclipse.milo.examples.server.ExampleNamespace;\nimport org.eclipse.milo.opcua.stack.core.UaSerializationException;\nimport org.eclipse.milo.opcua.stack.core.encoding.EncodingContext;\nimport org.eclipse.milo.opcua.stack.core.encoding.GenericDataTypeCodec;\nimport org.eclipse.milo.opcua.stack.core.encoding.UaDecoder;\nimport org.eclipse.milo.opcua.stack.core.encoding.UaEncoder;\nimport org.eclipse.milo.opcua.stack.core.types.UaStructuredType;\nimport org.eclipse.milo.opcua.stack.core.types.builtin.ExpandedNodeId;\nimport org.eclipse.milo.opcua.stack.core.types.builtin.unsigned.UInteger;\n\npublic class CustomStructType implements UaStructuredType {\n\n  public static final ExpandedNodeId TYPE_ID =\n      ExpandedNodeId.parse(\n          String.format(\n              &quot;nsu=%s;s=%s&quot;, ExampleNamespace.NAMESPACE_URI, &quot;DataType.CustomStructType&quot;));\n\n  public static final ExpandedNodeId BINARY_ENCODING_ID =\n      ExpandedNodeId.parse(\n          String.format(\n              &quot;nsu=%s;s=%s&quot;,\n              ExampleNamespace.NAMESPACE_URI, &quot;DataType.CustomStructType.BinaryEncoding&quot;));\n\n  private final String foo;\n  private final UInteger bar;\n  private final boolean baz;\n\n  private final CustomEnumType customEnumType;\n\n  public CustomStructType() {\n    this(null, uint(0), false, CustomEnumType.Field0);\n  }\n\n  public CustomStructType(String foo, UInteger bar, boolean baz, CustomEnumType customEnumType) {\n    this.foo = foo;\n    this.bar = bar;\n    this.baz = baz;\n    this.customEnumType = customEnumType;\n  }\n\n  public String getFoo() {\n    return foo;\n  }\n\n  public UInteger getBar() {\n    return bar;\n  }\n\n  public boolean isBaz() {\n    return baz;\n  }\n\n  public CustomEnumType getCustomEnumType() {\n    return customEnumType;\n  }\n\n  @Override\n  public ExpandedNodeId getTypeId() {\n    return TYPE_ID;\n  }\n\n  @Override\n  public ExpandedNodeId getBinaryEncodingId() {\n    return BINARY_ENCODING_ID;\n  }\n\n  @Override\n  public ExpandedNodeId getXmlEncodingId() {\n    // XML encoding not supported\n    return ExpandedNodeId.NULL_VALUE;\n  }\n\n  @Override\n  public ExpandedNodeId getJsonEncodingId() {\n    return ExpandedNodeId.NULL_VALUE;\n  }\n\n  @Override\n  public boolean equals(Object o) {\n    if (this == o) return true;\n    if (o == null || getClass() != o.getClass()) return false;\n    CustomStructType that = (CustomStructType) o;\n    return baz == that.baz\n        &amp;&amp; Objects.equal(foo, that.foo)\n        &amp;&amp; Objects.equal(bar, that.bar)\n        &amp;&amp; customEnumType == that.customEnumType;\n  }\n\n  @Override\n  public int hashCode() {\n    return Objects.hashCode(foo, bar, baz, customEnumType);\n  }\n\n  @Override\n  public String toString() {\n    return MoreObjects.toStringHelper(this)\n        .add(&quot;foo&quot;, foo)\n        .add(&quot;bar&quot;, bar)\n        .add(&quot;baz&quot;, baz)\n        .add(&quot;customEnumType&quot;, customEnumType)\n        .toString();\n  }\n\n  public static class Codec extends GenericDataTypeCodec&lt;CustomStructType&gt; {\n    @Override\n    public Class&lt;CustomStructType&gt; getType() {\n      return CustomStructType.class;\n    }\n\n    @Override\n    public CustomStructType decodeType(EncodingContext context, UaDecoder decoder)\n        throws UaSerializationException {\n\n      String foo = decoder.decodeString(&quot;Foo&quot;);\n      UInteger bar = decoder.decodeUInt32(&quot;Bar&quot;);\n      boolean baz = decoder.decodeBoolean(&quot;Baz&quot;);\n      CustomEnumType customEnumType = CustomEnumType.from(decoder.decodeEnum(&quot;CustomEnumType&quot;));\n\n      return new CustomStructType(foo, bar, baz, customEnumType);\n    }\n\n    @Override\n    public void encodeType(EncodingContext context, UaEncoder encoder, CustomStructType value)\n        throws UaSerializationException {\n\n      encoder.encodeString(&quot;Foo&quot;, value.foo);\n      encoder.encodeUInt32(&quot;Bar&quot;, value.bar);\n      encoder.encodeBoolean(&quot;Baz&quot;, value.baz);\n      encoder.encodeEnum(&quot;CustomEnumType&quot;, value.customEnumType);\n    }\n  }\n}\n</code></pre>\n<p>For its usage, look at <code>ExampleNamespace.java</code>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>  private void addCustomStructTypeVariable(UaFolderNode rootFolder) throws Exception {\n    NodeId dataTypeId = CustomStructType.TYPE_ID.toNodeIdOrThrow(getServer().getNamespaceTable());\n\n    UaVariableNode customStructTypeVariable =\n        UaVariableNode.build(\n            getNodeContext(),\n            b -&gt;\n                b.setNodeId(newNodeId(&quot;HelloWorld/CustomStructTypeVariable&quot;))\n                    .setAccessLevel(AccessLevel.READ_WRITE)\n                    .setUserAccessLevel(AccessLevel.READ_WRITE)\n                    .setBrowseName(newQualifiedName(&quot;CustomStructTypeVariable&quot;))\n                    .setDisplayName(LocalizedText.english(&quot;CustomStructTypeVariable&quot;))\n                    .setDataType(dataTypeId)\n                    .setTypeDefinition(NodeIds.BaseDataVariableType)\n                    .build());\n\n    CustomStructType value = new CustomStructType(&quot;foo&quot;, uint(42), true, CustomEnumType.Field0);\n\n    ExtensionObject xo = ExtensionObject.encode(getServer().getStaticEncodingContext(), value);\n\n    customStructTypeVariable.setValue(new DataValue(new Variant(xo)));\n\n    getNodeManager().addNode(customStructTypeVariable);\n\n    customStructTypeVariable.addReference(\n        new Reference(\n            customStructTypeVariable.getNodeId(),\n            NodeIds.Organizes,\n            rootFolder.getNodeId().expanded(),\n            false));\n  }\n\n</code></pre>\n<p>I recommend to start <code>main()</code> of <code>ExampleServer.java</code> and connect UaExpert to it:\n<a href=\"https://i.sstatic.net/4ao2hEFL.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/4ao2hEFL.png\" alt=\"enter image description here\" /></a></p>\n<p>If you want to program a <strong>client</strong> to read and write values of a <code>CustomStructType</code>, you can look at <code>ReadWriteCustomDataTypeNodeExample.java</code> in <code>client-examples</code>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>/*\n * Copyright (c) 2025 the Eclipse Milo Authors\n *\n * This program and the accompanying materials are made\n * available under the terms of the Eclipse Public License 2.0\n * which is available at https://www.eclipse.org/legal/epl-2.0/\n *\n * SPDX-License-Identifier: EPL-2.0\n */\n\npackage org.eclipse.milo.examples.client;\n\nimport static org.eclipse.milo.opcua.stack.core.types.builtin.unsigned.Unsigned.uint;\n\nimport java.util.concurrent.CompletableFuture;\nimport org.eclipse.milo.examples.server.types.CustomEnumType;\nimport org.eclipse.milo.examples.server.types.CustomStructType;\nimport org.eclipse.milo.opcua.sdk.client.OpcUaClient;\nimport org.eclipse.milo.opcua.sdk.client.nodes.UaVariableNode;\nimport org.eclipse.milo.opcua.stack.core.types.builtin.DataValue;\nimport org.eclipse.milo.opcua.stack.core.types.builtin.ExtensionObject;\nimport org.eclipse.milo.opcua.stack.core.types.builtin.NodeId;\nimport org.eclipse.milo.opcua.stack.core.types.builtin.Variant;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\npublic class ReadWriteCustomDataTypeNodeExample implements ClientExample {\n\n  public static void main(String[] args) throws Exception {\n    ReadWriteCustomDataTypeNodeExample example = new ReadWriteCustomDataTypeNodeExample();\n\n    new ClientExampleRunner(example).run();\n  }\n\n  private final Logger logger = LoggerFactory.getLogger(getClass());\n\n  @Override\n  public void run(OpcUaClient client, CompletableFuture&lt;OpcUaClient&gt; future) throws Exception {\n    client.connect();\n\n    registerCustomCodec(client);\n\n    // synchronous read request via VariableNode\n    UaVariableNode node =\n        client\n            .getAddressSpace()\n            .getVariableNode(new NodeId(2, &quot;HelloWorld/CustomStructTypeVariable&quot;));\n\n    logger.info(&quot;DataType={}&quot;, node.getDataType());\n\n    // Read the current value\n    DataValue value = node.readValue();\n    logger.info(&quot;Value={}&quot;, value);\n\n    Variant variant = value.value();\n    ExtensionObject xo = (ExtensionObject) variant.value();\n    assert xo != null;\n\n    CustomStructType decoded = (CustomStructType) xo.decode(client.getStaticEncodingContext());\n    logger.info(&quot;Decoded={}&quot;, decoded);\n\n    // Write a modified value\n    CustomStructType modified =\n        new CustomStructType(\n            decoded.getFoo() + &quot;bar&quot;,\n            uint(decoded.getBar().intValue() + 1),\n            !decoded.isBaz(),\n            CustomEnumType.Field1);\n    ExtensionObject modifiedXo =\n        ExtensionObject.encode(client.getStaticEncodingContext(), modified);\n\n    node.writeValue(new DataValue(new Variant(modifiedXo)));\n\n    // Read the modified value back\n    value = node.readValue();\n    logger.info(&quot;Value={}&quot;, value);\n\n    variant = value.value();\n    xo = (ExtensionObject) variant.value();\n    assert xo != null;\n\n    decoded = (CustomStructType) xo.decode(client.getStaticEncodingContext());\n    logger.info(&quot;Decoded={}&quot;, decoded);\n\n    future.complete(client);\n  }\n\n  private void registerCustomCodec(OpcUaClient client) {\n    NodeId dataTypeId =\n        CustomStructType.TYPE_ID\n            .toNodeId(client.getNamespaceTable())\n            .orElseThrow(() -&gt; new IllegalStateException(&quot;namespace not found&quot;));\n\n    NodeId binaryEncodingId =\n        CustomStructType.BINARY_ENCODING_ID\n            .toNodeId(client.getNamespaceTable())\n            .orElseThrow(() -&gt; new IllegalStateException(&quot;namespace not found&quot;));\n\n    // Register codec with the client's DataTypeManager instance.\n    // We need to register it by both its encodingId and its dataTypeId because it may be\n    // looked up by either depending on the context.\n    client\n        .getStaticDataTypeManager()\n        .registerType(dataTypeId, new CustomStructType.Codec(), binaryEncodingId, null, null);\n  }\n}\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 8585731,
      "reputation" : 105,
      "user_id" : 6431940,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/8c41993985afceb1e0ef607a0ce1e169?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Tobus",
      "link" : "https://stackoverflow.com/users/6431940/tobus"
    },
    "creation_date" : 1764262172,
    "last_activity_date" : 1764313745,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140872006,
    "post_id" : 79825518,
    "body" : "Unfortunately I am not familiar with this library, not even how to do it with Java. I only know that the OPC UA protocol supports multiple read requests per service and thus assume that the library should provide this functionality somehow. For structured data type values the client can only read what the server explicitly exposes as a structured data type value.",
    "score" : 0,
    "owner" : {
      "account_id" : 32912519,
      "reputation" : 693,
      "user_id" : 25561613,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0fa475f4e5f0390a69aaf260880db3de?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Thibe",
      "link" : "https://stackoverflow.com/users/25561613/thibe"
    },
    "creation_date" : 1764070118,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140871987,
    "post_id" : 79825518,
    "body" : "Thank you very much @Thibe for your response. I m trying to understand how OPC UA works! How are structured Values presented in Java? I m using object or class instances to allow reading a structured value. How is it possible to read multiple variables in one service call? Do you have any exemple or a link to a documentation or example? Of course with Milo because I need open Source tool.",
    "score" : 0,
    "owner" : {
      "account_id" : 15934612,
      "reputation" : 11,
      "user_id" : 11498091,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0b52cea2bb644cd1bd4a2dabccd56a6e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Mabsito",
      "link" : "https://stackoverflow.com/users/11498091/mabsito"
    },
    "creation_date" : 1764069220,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140869951,
    "post_id" : 79825518,
    "body" : "OPC UA does not support to read entire objects. Only Variables can be read, but it is possible to read multiple variables in one service call. I am not familiar with Milo OPC-UA but your attempt looks like you try to setup a definition to read a structured value (which requires encoding and so on), but that is completely different than reading the contents of an object. Note: A reason for the confusion could be that structured values can be exposed also as multiple variables, but this is still different than an object.",
    "score" : 0,
    "owner" : {
      "account_id" : 32912519,
      "reputation" : 693,
      "user_id" : 25561613,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0fa475f4e5f0390a69aaf260880db3de?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Thibe",
      "link" : "https://stackoverflow.com/users/25561613/thibe"
    },
    "creation_date" : 1763979232,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}