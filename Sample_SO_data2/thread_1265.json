{
  "question" : {
    "question_id" : 79728793,
    "title" : "Different GrantedAuthority returning the same for getAuthority()",
    "body" : "<p>I have a spring application, where users can have various authorities and where some of those authorities can be scoped.</p>\n<p>For example, the <code>READ_ALLOWED</code> authority is scoped by company domain. So I have</p>\n<pre><code>class Auth implements GrantedAuthority {\n  String role;\n  String domain;\n  \n  String getAuthority() {\n    return role + &quot;_&quot; + scope;\n  }\n}\n</code></pre>\n<p>When someone calls an endpoint, I have a <code>@PreAuthorize</code> that checks calls a custom method that checks the parameters of the request and that the user has the <code>GrantedAuthority</code> with the <code>READ_ALLOWED</code> role and scope corresponding to the parameter.</p>\n<p>It works well, but I also have some generic endpoints that are allowed to everyone having a <code>READ_ALLOWED</code> authority, regardless of scope. In that case, I have a <code>@PreAuthorize(&quot;hasAuthority('READ_ALLOWED')&quot;)</code>, but in order for it to work I must give all the users who have a scoped <code>READ_ALLOWED</code> authority another one, unscoped, that returns <code>READ_ALLOWED</code> for its <code>getAuthority()</code>.</p>\n<p>So I was thinking about making all my scoped authorities like that :</p>\n<pre><code>class Auth implements GrantedAuthority {\n  String role;\n  String domain;\n  \n  String getAuthority() {\n    return role;\n  }\n}\n</code></pre>\n<p>This way, any authority with <code>role == READ_ALLOWED</code> will be granted access by <code>hasAuthority('READ_ALLOWED')</code>, and my custom method that checks the domain will continue to check the domain on top, and that would allow me to not use functionally duplicate authorities.</p>\n<p>As long as I have good <code>equals</code> and <code>hashCode</code> implementations, I don't see any glaring issues, but I'm not sure if Spring won't cause issues in having different authorities returning the same for <code>getAuthority()</code>.</p>\n",
    "tags" : [ "java", "spring", "authorization" ],
    "owner" : {
      "account_id" : 16478911,
      "reputation" : 413,
      "user_id" : 11906121,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c6320114c699f06d4038d99c1a9273f6?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "elcye",
      "link" : "https://stackoverflow.com/users/11906121/elcye"
    },
    "is_answered" : false,
    "view_count" : 70,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1754936803,
    "creation_date" : 1754579689,
    "link" : "https://stackoverflow.com/questions/79728793/different-grantedauthority-returning-the-same-for-getauthority",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79731943,
    "question_id" : 79728793,
    "body" : "<p>Spring security only cares about the string returned from <code>GrantedAuthority.getAuthority()</code> when evaluating <code>@PreAuthorize(&quot;hasAuthority('READ_ALLOWED')&quot;)</code> so you are free to do as you please here.</p>\n<p>You only need to implement <code>GrantedAuthority.hashCode()</code> and <code>GrantedAuthority.equals(...)</code> if you plan on storing these in <code>java.util.Set</code> or <code>java.util.Map</code> yourself.</p>\n<p>Personally I wouldn't extend <code>GrantedAuthority</code> like this, I would instead base security solely on <code>GrantedAuthority.getAuthority()</code>. Note there's hooks in spring-security where you can map authorities provided in the request to custom permissions in your application. Eg:</p>\n<div class=\"s-table-container\"><table class=\"s-table\">\n<thead>\n<tr>\n<th>Authority in request</th>\n<th>Authorities mapped by custom logic</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ADMIN</td>\n<td>foo.read, foo.write, bar.read, bar.write</td>\n</tr>\n<tr>\n<td>READER</td>\n<td>foo.read, bar.read</td>\n</tr>\n<tr>\n<td>FOO_ADMIN</td>\n<td>foo.read, foo.write</td>\n</tr>\n<tr>\n<td>BAR_ADMIN</td>\n<td>bar.read, bar.write</td>\n</tr>\n</tbody>\n</table></div>\n<p>Then you can do</p>\n<pre class=\"lang-java prettyprint-override\"><code>@PreAuthorize(&quot;hasAuthority('foo.read')&quot;)\n@GetMapping(&quot;/foo/{id}&quot;)\npublic Foo getFoo(@PathParam(&quot;id&quot;) Long fooId) { ... }\n\n@PreAuthorize(&quot;hasAuthority('foo.write')&quot;)\n@PostMapping(&quot;/foo&quot;)\npublic SaveResult saveFoo(@RequestBody Foo foo) { ... }\n\n@PreAuthorize(&quot;hasAuthority('bar.read')&quot;)\n@GetMapping(&quot;/bar/{id}&quot;)\npublic Bar getBar(@PathParam(&quot;id&quot;) Long barId) { ... }\n\n@PreAuthorize(&quot;hasAuthority('bar.write')&quot;)\n@PostMapping(&quot;/bar&quot;)\npublic SaveResult saveBar(@RequestBody Bar bar) { ... }\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1096470,
      "reputation" : 29424,
      "user_id" : 1089967,
      "user_type" : "registered",
      "accept_rate" : 59,
      "profile_image" : "https://www.gravatar.com/avatar/1f256b904ff621d678598d8fa49f86c5?s=256&d=identicon&r=PG",
      "display_name" : "lance-java",
      "link" : "https://stackoverflow.com/users/1089967/lance-java"
    },
    "creation_date" : 1754908039,
    "last_activity_date" : 1754936803,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140651783,
    "post_id" : 79728793,
    "body" : "The problem is simply wanting to avoid duplication, because with the current implementation, I have to explicitly duplicate the authority when the user is authenticated. What I mean by good equals and hashCode implementations is having them rely on role+domain, not on getAuthority(), to avoid issues in a Set.",
    "score" : 0,
    "owner" : {
      "account_id" : 16478911,
      "reputation" : 413,
      "user_id" : 11906121,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c6320114c699f06d4038d99c1a9273f6?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "elcye",
      "link" : "https://stackoverflow.com/users/11906121/elcye"
    },
    "creation_date" : 1754657796,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140650434,
    "post_id" : 79728793,
    "body" : "In my opinion using a <code>GrantedAuthoritiesMapper</code> do duplicate the authorities is more straight forward. Nobody expects weird stuff with equals/hashCode, so most likely somebody will break it in the future. What is you actual problem with that aproach?",
    "score" : 0,
    "owner" : {
      "account_id" : 1370752,
      "reputation" : 5678,
      "user_id" : 1306024,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/8a59083f4f77bd2d733cd6fccf4f97bc?s=256&d=identicon&r=PG",
      "display_name" : "k5_",
      "link" : "https://stackoverflow.com/users/1306024/k5"
    },
    "creation_date" : 1754604021,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}