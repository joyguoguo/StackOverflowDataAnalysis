{
  "question" : {
    "question_id" : 79802853,
    "title" : "How to set Cache-Control to protected paths in a Spring Boot application?",
    "body" : "<p>I want to set <code>Cache-Control: private</code> header in a Spring Boot application but I was not able to find a way to set it for all of my protected paths.</p>\n<p>I have the following class:</p>\n<pre class=\"lang-java prettyprint-override\"><code>import org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.core.annotation.Order;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;\nimport org.springframework.security.web.SecurityFilterChain;\n\nimport java.util.List;\n\n@Configuration\n@EnableWebSecurity\npublic class ResourceServerConfig {\n\n    private final List&lt;String&gt; protectedPaths = List.of(\n            &quot;/my-profile&quot;,\n            &quot;/my-notes&quot;,\n            &quot;/etc&quot;\n    );\n\n    @Bean\n    @Order(2)\n    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n        http\n                .securityMatchers(customizer -&gt; customizer.requestMatchers(protectedPaths.toArray(new String[0])))\n                .csrf(AbstractHttpConfigurer::disable)\n                .authorizeHttpRequests(requests -&gt; requests.anyRequest().authenticated())\n                .oauth2ResourceServer(server -&gt; server.jwt(\n                        customizer -&gt; customizer.jwtAuthenticationConverter(new UserAuthenticationTokenConverter())\n                ));\n        return http.build();\n    }\n\n}\n</code></pre>\n<p>I tried to set <code>CacheControl cacheControl = CacheControl.noCache().cachePrivate();</code> into <code>http.headers().cacheControl();</code> but <code>headers()</code> requires some strange objects. Also may be it will be not work there. May be I need to set the headers inside <code>authorizeHttpRequests()</code> but I was not able to find something there either.</p>\n<p>How can I set the Cache-Control headers into protectedPaths?</p>\n",
    "tags" : [ "java", "spring-boot", "cache-control" ],
    "owner" : {
      "account_id" : 83131,
      "reputation" : 9085,
      "user_id" : 233286,
      "user_type" : "registered",
      "accept_rate" : 73,
      "profile_image" : "https://i.sstatic.net/0ivuN.jpg?s=256",
      "display_name" : "ilhan",
      "link" : "https://stackoverflow.com/users/233286/ilhan"
    },
    "is_answered" : true,
    "view_count" : 84,
    "answer_count" : 2,
    "score" : 1,
    "last_activity_date" : 1761711175,
    "creation_date" : 1761657450,
    "link" : "https://stackoverflow.com/questions/79802853/how-to-set-cache-control-to-protected-paths-in-a-spring-boot-application",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79802899,
    "question_id" : 79802853,
    "body" : "<p>I think you used the wrong syntax. This is how you add headers in securityFilterChain. You can also filter the specific ones by implementing HeaderWriter iirc.</p>\n<pre><code>.headers(headers -&gt; headers\n        .cacheControl(cache -&gt; cache.disable())\n        .addHeaderWriter(new StaticHeadersWriter(&quot;Cache-Control&quot;, &quot;private&quot;))\n)\n</code></pre>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 44346534,
      "reputation" : 176,
      "user_id" : 31706372,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c17ef303e9ed8982a8aba03b7474bbda?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "NirajDota",
      "link" : "https://stackoverflow.com/users/31706372/nirajdota"
    },
    "creation_date" : 1761660165,
    "last_activity_date" : 1761660165,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79803430,
    "question_id" : 79802853,
    "body" : "<p>Use Spring Securityâ€™s headers with a custom HeaderWriter on the chain that already targets your protected paths. Disable the default cache-control writer and add your own:</p>\n<pre><code>@Bean\n@Order(2)\npublic SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n    http.securityMatchers(m -&gt; m.requestMatchers(protectedPaths.toArray(String[]::new)))\n       .csrf(AbstractHttpConfigurer::disable)\n       .headers(h -&gt; {\n           h.cacheControl(c -&gt; c.disable()); // turn off Spring Security's default no-store\n           h.addHeaderWriter(new StaticHeadersWriter(&quot;Cache-Control&quot;, &quot;private&quot;));\n       })\n       .authorizeHttpRequests(a -&gt; a.anyRequest().authenticated())\n       .oauth2ResourceServer(s -&gt; s.jwt(c -&gt; c.jwtAuthenticationConverter(new UserAuthenticationTokenConverter())));\n    return http.build();\n}\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1807468,
      "reputation" : 287,
      "user_id" : 1644280,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f18fe15e4ebd5283482de3fc4a939058?s=256&d=identicon&r=PG",
      "display_name" : "Lavi Kumar",
      "link" : "https://stackoverflow.com/users/1644280/lavi-kumar"
    },
    "creation_date" : 1761711175,
    "last_activity_date" : 1761711175,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140822689,
    "post_id" : 79802853,
    "body" : "Perhaps you will want to use <a href=\"https://docs.spring.io/spring-security/reference/api/java/org/springframework/security/config/annotation/web/configurers/HeadersConfigurer.html#addHeaderWriter(org.springframework.security.web.header.HeaderWriter)\" rel=\"nofollow noreferrer\">addHeaderWriter</a> with a custom <code>HeaderWriter</code> implementation that sets <code>Cache-Control</code> to <code>private</code> unconditionally through <a href=\"https://javadoc.io/doc/jakarta.servlet/jakarta.servlet-api/latest/jakarta.servlet/jakarta/servlet/http/HttpServletResponse.html#setHeader(java.lang.String,java.lang.String)\" rel=\"nofollow noreferrer\">HttpServletResponse#setHeader</a>.",
    "score" : 1,
    "owner" : {
      "account_id" : 14914414,
      "reputation" : 1150,
      "user_id" : 10808904,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Ts8fIsJj.png?s=256",
      "display_name" : "Xavier Pedraza",
      "link" : "https://stackoverflow.com/users/10808904/xavier-pedraza"
    },
    "creation_date" : 1761658466,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140822680,
    "post_id" : 79802853,
    "body" : "Looking at the <a href=\"https://docs.spring.io/spring-security/reference/api/java/org/springframework/security/config/annotation/web/builders/HttpSecurity.html#headers(org.springframework.security.config.Customizer)\" rel=\"nofollow noreferrer\">example provided in the javadoc</a> and following it <a href=\"https://docs.spring.io/spring-security/reference/api/java/org/springframework/security/config/annotation/web/configurers/HeadersConfigurer.CacheControlConfig.html\" rel=\"nofollow noreferrer\">here</a>, it seems like sanctioned configuration options for the cache control header are quite limited- you can essentially only disable it.",
    "score" : 1,
    "owner" : {
      "account_id" : 14914414,
      "reputation" : 1150,
      "user_id" : 10808904,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Ts8fIsJj.png?s=256",
      "display_name" : "Xavier Pedraza",
      "link" : "https://stackoverflow.com/users/10808904/xavier-pedraza"
    },
    "creation_date" : 1761658328,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}