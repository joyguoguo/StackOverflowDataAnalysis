{
  "question" : {
    "question_id" : 79579227,
    "title" : "Cross Origin error when correct domain is listed in the origin list",
    "body" : "<p>This is the error I am currently facing.</p>\n<blockquote>\n<p>Access to fetch at 'https://sample.company.com/api' from origin\n'https://www.company.com' has been blocked by CORS policy: No\n'Access-Control-Allow-Origin' header is present on the requested\nresource. If an opaque response serves your needs, set the request's\nmode to 'no-cors' to fetch the resource with CORS disabled.</p>\n</blockquote>\n<p>The endpoint <code>https://sample.company.com/api</code> is a POST coming from the same project holding following CORs setup.\n<br>We calling this endpoint from front end and that's when we facing the CORs error.</p>\n<p>This is my cors setup in Spring Boot 3.</p>\n<pre><code>@Configuration\n@EnableWebMvc\n@ComponentScan(basePackages = {&quot;com.company.pack&quot;})\n@PropertySource(&quot;classpath:/app-${spring.profiles.active}.properties&quot;)\npublic class Config implements WebMvcConfigurer {\n\n  @Value(&quot;${allowed-origins:*}&quot;)\n  // this has https://www.company.com,https://company.com,https://sample.company.com\n  // printed via a PostConstruct just to confirm and prints correctly.\n  String allowedOriginsPattern;\n\n  @Override\n  public void addCorsMappings(CorsRegistry registry) {\n    String[] origins = allowedOriginsPattern.split(&quot;,&quot;);\n\n    registry.addMapping(&quot;/**&quot;)\n            .allowedOriginPatterns(origins)\n            .allowedMethods(&quot;GET&quot;, &quot;OPTIONS&quot;, &quot;POST&quot;)\n            .allowedHeaders(\n                    &quot;content-type&quot;,\n                    ..... other custom headers\n            )\n            .allowCredentials(true);\n  }\n}\n</code></pre>\n<p>Also tried with</p>\n<pre><code>.allowedOrigins(origins)\n</code></pre>\n<p>Same outcome.</p>\n<p>What am I missing?</p>\n",
    "tags" : [ "java", "spring-boot", "cors", "java-21", "spring-boot-3" ],
    "owner" : {
      "account_id" : 13006738,
      "reputation" : 1836,
      "user_id" : 9401029,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/s256-rj/photo.jpg",
      "display_name" : "karvai",
      "link" : "https://stackoverflow.com/users/9401029/karvai"
    },
    "is_answered" : false,
    "view_count" : 89,
    "answer_count" : 2,
    "score" : 2,
    "last_activity_date" : 1744938962,
    "creation_date" : 1744892436,
    "link" : "https://stackoverflow.com/questions/79579227/cross-origin-error-when-correct-domain-is-listed-in-the-origin-list",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79579989,
    "question_id" : 79579227,
    "body" : "<p>try following, somewhat more modern approach:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Bean\npublic WebMvcConfigurer corsConfigurer() {\n  return new WebMvcConfigurer() {\n    @Override\n    public void addCorsMappings(CorsRegistry registry) {\n      registry.addMapping(&quot;/**&quot;)\n        .allowedOrigins(&quot;https://www.company.com&quot;)\n        .allowedMethods(&quot;GET&quot;, &quot;POST&quot;)\n        .allowedHeaders(&quot;*&quot;)\n        .allowCredentials(true);\n    }\n  };\n}\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 16657879,
      "reputation" : 4350,
      "user_id" : 12038714,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AAuE7mAgRe8u2G_kzJJ-KZ2yZwAD1E4kxs9eRlqnY45BUw=k-s256",
      "display_name" : "asgarov1",
      "link" : "https://stackoverflow.com/users/12038714/asgarov1"
    },
    "creation_date" : 1744919661,
    "last_activity_date" : 1744919661,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79580293,
    "question_id" : 79579227,
    "body" : "<pre><code>public class Config implements WebMvcConfigurer\n</code></pre>\n<p>WebMvcConfigurer is <a href=\"https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/config/annotation/WebMvcConfigurer.html\" rel=\"nofollow noreferrer\">not deprecated</a>.</p>\n<p>I produced the usable code following your question:</p>\n<pre class=\"lang-java prettyprint-override\"><code>\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.servlet.config.annotation.CorsRegistry;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\n\n@Configuration\npublic class Config implements WebMvcConfigurer {\n\n    @Value(&quot;${allowed-origins:*}&quot;)\n    String allowedOriginsPattern;\n        // contains &quot;http://localhost:8080,http://127.0.0.1:8080,http://[::1]:8080&quot;\n\n    @Override\n    public void addCorsMappings(CorsRegistry registry) {\n       String[] origins = allowedOriginsPattern.split(&quot;,&quot;);\n\n       registry.addMapping(&quot;/**&quot;)\n           .allowedOriginPatterns(origins)\n           .allowedMethods(&quot;GET&quot;, &quot;OPTIONS&quot;, &quot;POST&quot;)\n           .allowCredentials(true);\n    }\n}\n\n\n</code></pre>\n<p>In the <a href=\"https://github.com/Hdvlp/SpringBootCors/blob/main/src/main/resources/application.yml\" rel=\"nofollow noreferrer\">application.yml</a>, I added:</p>\n<pre class=\"lang-yaml prettyprint-override\"><code>server:\n  servlet:\n    context-path: /\n\nallowed-origins: &quot;http://localhost:8080,http://127.0.0.1:8080,http://[::1]:8080&quot;\n</code></pre>\n<p>An incorrect <code>context-path</code> could be a reason for a CORS problem.</p>\n<p>The <a href=\"https://github.com/Hdvlp/SpringBootCors\" rel=\"nofollow noreferrer\">example repository was here</a>.</p>\n<p>To try, after starting Spring Boot, please visit in your browser:</p>\n<pre><code>http://localhost:8080\nhttp://127.0.0.1:8080\nhttp://[::1]:8080\n</code></pre>\n<p>Example output in the browser:</p>\n<pre><code>CORS\nGET http://127.0.0.1:8080/api\nGET request page\nPOST http://127.0.0.1:8080/api\nPOST request page\nGET http://localhost:8080/api\nGET request page\nPOST http://localhost:8080/api\nPOST request page\nGET http://[::1]:8080/api\nGET request page\nPOST http://[::1]:8080/api\nPOST request page\n</code></pre>\n<p>In the example, the JavaScript I used:</p>\n<pre class=\"lang-javascript prettyprint-override\"><code>&lt;script&gt;\n                async function getter(uri, elementId){\n                    const responseGet = fetch(uri, { &quot;method&quot;: &quot;GET&quot; })\n                            .then(response =&gt; {\n                                if (!response.ok) {\n                                    return response.text()\n                                        .catch(() =&gt; {\n                                            throw new Error(response.status);\n                                        })\n                                        .then(({message}) =&gt; {\n                                            console.log(message);\n                                            throw new Error(message || response.status);\n                                        });\n                                }\n                            return response.text();\n                            });\n\n                            \n                        const responseGetText = await Promise.resolve(responseGet);\n                        \n\n                        const elementGet = document.getElementById(elementId);\n                        elementGet.innerHTML = elementGet.innerHTML + &quot;&lt;div&gt;&quot; + responseGetText + &quot;&lt;/div&gt;&quot;\n\n                }\n                \n                async function poster(uri, elementId, body){\n                    const responsePost = fetch(uri, { &quot;method&quot;: &quot;POST&quot;, body: body })\n                        .then(response =&gt; {\n                            if (!response.ok) {\n                                return response.text()\n                                    .catch(() =&gt; {\n                                        throw new Error(response.status);\n                                    })\n                                    .then(({message}) =&gt; {\n                                        console.log(message);\n                                        throw new Error(message || response.status);\n                                    });\n                            }\n                        return response.text();\n                        });\n\n                        \n                    const responsePostText = await Promise.resolve(responsePost);\n                    \n\n                    const elementPost = document.getElementById(elementId);\n                    elementPost.innerHTML = elementPost.innerHTML + &quot;&lt;div&gt;&quot; + responsePostText + &quot;&lt;/div&gt;&quot;\n                }\n\n                async function main(){\n                    \n\n                   await getter(&quot;http://127.0.0.1:8080/api&quot;, &quot;getipv4&quot;);\n                   await poster(&quot;http://127.0.0.1:8080/api&quot;, &quot;postipv4&quot;, JSON.stringify({&quot;user&quot;: &quot;user&quot;}));\n\n                   \n                   await getter(&quot;http://localhost:8080/api&quot;, &quot;getlocalhost&quot;);\n                   await poster(&quot;http://localhost:8080/api&quot;, &quot;postlocalhost&quot;, JSON.stringify({&quot;user&quot;: &quot;user&quot;}));\n\n                   \n                   await getter(&quot;http://[::1]:8080/api&quot;, &quot;getipv6&quot;);\n                   await poster(&quot;http://[::1]:8080/api&quot;, &quot;postipv6&quot;, JSON.stringify({&quot;user&quot;: &quot;user&quot;}));\n\n\n                }\n                main();\n                &lt;/script&gt;\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 41072977,
      "reputation" : 96,
      "user_id" : 30106291,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/LRapA3Kd.jpg?s=256",
      "display_name" : "Hdvlp",
      "link" : "https://stackoverflow.com/users/30106291/hdvlp"
    },
    "creation_date" : 1744938621,
    "last_activity_date" : 1744938962,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140346112,
    "post_id" : 79579227,
    "body" : "did you check and verify the request your client is sending? how does it look like in particular for the Origin header?",
    "score" : 0,
    "owner" : {
      "account_id" : 11555562,
      "reputation" : 569,
      "user_id" : 8466853,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/cd7f72b426ce3c46739900b8ba014e26?s=256&d=identicon&r=PG",
      "display_name" : "Arno",
      "link" : "https://stackoverflow.com/users/8466853/arno"
    },
    "creation_date" : 1744920709,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}