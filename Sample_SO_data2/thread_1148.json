{
  "question" : {
    "question_id" : 79742193,
    "title" : "Spring Webflux, authenticationSuccessHandler not invoked in oAuth2 login flow",
    "body" : "<p>I am still a beginner in Webflux. I want to get the user logged in using google and once the user is authenticated, I want to create my custom JWT (which has some role info specific to my app) and return in the response header. I am doing this in a class <code>class JwtAuthenticationSuccessHandler implements ServerAuthenticationSuccessHandler</code></p>\n<p>I also want to intercept any incoming request and check if the jwt is valid or not for that I have customised AuthenticationWebFilter which I am registering as below;</p>\n<p><code>.addFilterAt(authenticationWebFilter, SecurityWebFiltersOrder.AUTHENTICATION)</code></p>\n<p>My security config looks like below:</p>\n<pre><code> return http\n                .securityContextRepository(NoOpServerSecurityContextRepository.getInstance()) // \uD83D\uDE80 disables WebSession\n                .authorizeExchange(exchanges -&gt; exchanges                      \n                        .pathMatchers(&quot;**/vendor/**&quot;).hasRole(Role.VENDOR.name())\n                        .pathMatchers(&quot;**/customer/**&quot;).hasRole(Role.CUSTOMER.name())\n                        .anyExchange().authenticated()\n                )\n                .addFilterAt(authenticationWebFilter, SecurityWebFiltersOrder.AUTHENTICATION)\n//.addFilterAfter(jwtHeaderFilter, SecurityWebFiltersOrder.AUTHENTICATION) // commented as no error but no output\n                .httpBasic(ServerHttpSecurity.HttpBasicSpec::disable)\n                .formLogin(ServerHttpSecurity.FormLoginSpec::disable)\n                .csrf(ServerHttpSecurity.CsrfSpec::disable)\n                .oauth2Login(oauth2 -&gt; oauth2\n                        .authenticationSuccessHandler(jwtAuthenticationSuccessHandler))\n                .build();\n</code></pre>\n<p>jwtAuthenticationSuccessHandler never gets invoked and if I try to achieve same using filter class jwtHeaderFilter AFTER SecurityWebFiltersOrder.AUTHENTICATION) then filter gets invoked,but jwt token in response header is missing, however no error in log.</p>\n<p>Note: When I test login flow, I get the user info in browser response body but no jwt token in header.</p>\n<p>I am stuck here and searched a lot but could not find any example code for Webflux + OAuth2 + Jwt.</p>\n",
    "tags" : [ "java", "google-oauth", "spring-webflux" ],
    "owner" : {
      "account_id" : 15630656,
      "reputation" : 13,
      "user_id" : 11387135,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d19c1cb635a9d7452b191754873fadd3?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Seema",
      "link" : "https://stackoverflow.com/users/11387135/seema"
    },
    "is_answered" : false,
    "view_count" : 104,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1759185763,
    "creation_date" : 1755774409,
    "link" : "https://stackoverflow.com/questions/79742193/spring-webflux-authenticationsuccesshandler-not-invoked-in-oauth2-login-flow",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140684214,
    "post_id" : 79742193,
    "body" : "What is the standard way? my requirement is that backend has some protected APIs to different roles for users who should be loggin to my app with gmail. so to protect my API only to the allowd user , I am inssuing my own jwt once authenticated with oauth login.  Please guide me what should be the correct design for this use case?",
    "score" : 0,
    "owner" : {
      "account_id" : 15630656,
      "reputation" : 13,
      "user_id" : 11387135,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d19c1cb635a9d7452b191754873fadd3?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Seema",
      "link" : "https://stackoverflow.com/users/11387135/seema"
    },
    "creation_date" : 1755854077,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140683037,
    "post_id" : 79742193,
    "body" : "Additionally, 1) <code>oauth2Login</code> is stateful and requires sessions (with protection against CSRF), 2) Since virtual threads are out, there is no performance improvement to expect from Webflux. All you get are headaches at debug time.",
    "score" : 0,
    "owner" : {
      "account_id" : 308139,
      "reputation" : 13879,
      "user_id" : 619830,
      "user_type" : "registered",
      "accept_rate" : 75,
      "profile_image" : "https://www.gravatar.com/avatar/f4d00b0a82e9307b1d68b29867fee4e5?s=256&d=identicon&r=PG",
      "display_name" : "ch4mp",
      "link" : "https://stackoverflow.com/users/619830/ch4mp"
    },
    "creation_date" : 1755803275,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140682779,
    "post_id" : 79742193,
    "body" : "why you dont find any example code is because what you want to do is non standard and vulnerable to a lot of security issues. So the question is, why do you want to build a homemade non secure login flow?",
    "score" : 0,
    "owner" : {
      "account_id" : 2064278,
      "reputation" : 15107,
      "user_id" : 1840146,
      "user_type" : "registered",
      "accept_rate" : 86,
      "profile_image" : "https://i.sstatic.net/JXdxm.png?s=256",
      "display_name" : "Toerktumlare",
      "link" : "https://stackoverflow.com/users/1840146/toerktumlare"
    },
    "creation_date" : 1755795869,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}