{
  "question" : {
    "question_id" : 79807937,
    "title" : "Opentelemetry with opentracing sending traces to jaeger",
    "body" : "<p>There are many services that are migrating one by one to Java 21 and Spring Boot 3.5.</p>\n<p>This means not all services will be migrated to newer versions at the same time.</p>\n<p>Opentracing has been abandoned for years\n<a href=\"https://github.com/opentracing-contrib/java-spring-jaeger\" rel=\"nofollow noreferrer\">https://github.com/opentracing-contrib/java-spring-jaeger</a>. As a result, it's not compatible with Java 21 and Spring Boot 3.5. It's recommended to migrate to Micrometer and Opentelemetry.</p>\n<p>Let's consider that the <code>-api</code> application is on Opentracing with the following configuration:</p>\n<pre><code>opentracing:\n  spring:\n    web:\n      ignoreAutoConfiguredSkipPatterns: true\n  jaeger:\n    service-name: ${spring.application.name}\n    enabled: true\n    enable-b3-propagation: true\n    probabilistic-sampler:\n      sampling-rate: 0.1  # 10% sampling\n    http-sender:\n      url: http://${JAEGER_HOST}:14268/api/traces\n</code></pre>\n<p>The <code>-api</code> forwards requests to <code>-srv</code> application which is updated to Micrometer and Opentelemetry with the following configuration:</p>\n<pre><code>management:\n  tracing:\n    enabled: true\n    propagation:\n      type: b3_multi\n    sampling:\n      probability: 0.1\n  otlp:\n    tracing:\n      endpoint: http://${JAEGER_HOST}:4317\n      transport: grpc\n\notel:\n  propagators: [b3multi]\n  resource:\n    attributes:\n      service:\n        name: ${spring.application.name}\n  traces:\n    sampler: custom\n</code></pre>\n<p>Main issues:</p>\n<ul>\n<li>Spans related to security are in the trace: <code>security filterchain before</code>, <code>authenticate bearertoken</code>, <code>authorize request</code>, <code>secured request</code>, <code>security filterchain after</code>. I don't see any benefit of having them. Might be removed?</li>\n<li>No DB spans in traces. With Opentracing one might see the whole trace through services till Query to DB. There is no such span in Opentelemetry approach. Something might be misconfigured, but it's still a concern.</li>\n<li><code>X-B3-Sampled: 1</code> not forcing any traces. You may see the traces only setting <code>management.tracing.sampling.probability: 1.0</code>. However, I want to keep it <code>0.1</code> and force tracing with the header value mentioned above. There are some configurations trying to fix it <code>com.example.tracing.modern.configuration.TracingConfig</code>.</li>\n<li>With Opentracing when there is an error I saw the warning icon next to span. Now it's not displayed. Config trying to fix it <code>com.example.tracing.modern.configuration.JaegerErrorTagFilter</code>. Unfortunately, behaviour is not as expected (I would like to have icons throughout the chain).</li>\n</ul>\n<p>I'm new to tracing and might misconfigured something or even having more configurations than it's necessary.</p>\n<p>I've prepared a &quot;<em>working</em>&quot; example to reproduce:</p>\n<p><a href=\"https://github.com/OlegZavrazhin/jaeger-tracing-opentelemetry-opentracing\" rel=\"nofollow noreferrer\">https://github.com/OlegZavrazhin/jaeger-tracing-opentelemetry-opentracing</a></p>\n<p>How to start:</p>\n<p><code>docker-compose up --build</code></p>\n<p>Test requests, just run:</p>\n<p><code>test-endpoints.sh</code> it would print traces which you may check on the jaeger UI <a href=\"http://localhost:16686/search\" rel=\"nofollow noreferrer\">http://localhost:16686/search</a></p>\n<p>Ask me if you need to clarify anything.</p>\n<p>P.S. I googled and read various docs, tried several approaches with no success. I would appreciate any samples or manuals.</p>\n",
    "tags" : [ "java", "spring-boot", "open-telemetry", "jaeger", "opentracing" ],
    "owner" : {
      "account_id" : 6327303,
      "reputation" : 414,
      "user_id" : 4960012,
      "user_type" : "registered",
      "accept_rate" : 42,
      "profile_image" : "https://www.gravatar.com/avatar/dca76e780d9397c0886a7f8003f6eeca?s=256&d=identicon&r=PG",
      "display_name" : "Jarvis",
      "link" : "https://stackoverflow.com/users/4960012/jarvis"
    },
    "is_answered" : false,
    "view_count" : 88,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1762178410,
    "creation_date" : 1762178410,
    "link" : "https://stackoverflow.com/questions/79807937/opentelemetry-with-opentracing-sending-traces-to-jaeger",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140833841,
    "post_id" : 79807937,
    "body" : "You should probably go through the <a href=\"https://opentelemetry.io/docs/zero-code/java/spring-boot-starter/getting-started/\" rel=\"nofollow noreferrer\">Spring Boot starter</a>  to see how things work first, before trying to migrate older code.",
    "score" : 1,
    "owner" : {
      "account_id" : 45520,
      "reputation" : 134344,
      "user_id" : 134204,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vwnA5.jpg?s=256",
      "display_name" : "Panagiotis Kanavos",
      "link" : "https://stackoverflow.com/users/134204/panagiotis-kanavos"
    },
    "creation_date" : 1762182879,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140833838,
    "post_id" : 79807937,
    "body" : "You&#39;re asking a <i>lot</i> of very different questions at once, and referencing an old spec like OpenTracing doesn&#39;t help <i>at all</i>. Most people never used it. Eg <code>No DB spans in traces</code> only means you haven&#39;t added the proper instrumentation. JDBC instrumentation is already available and even <a href=\"https://opentelemetry.io/docs/zero-code/java/agent/getting-started/#supported-libraries-frameworks-application-services-and-jvms\" rel=\"nofollow noreferrer\">part of the instrumentations added during auto-instrumentation</a>.",
    "score" : 1,
    "owner" : {
      "account_id" : 45520,
      "reputation" : 134344,
      "user_id" : 134204,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vwnA5.jpg?s=256",
      "display_name" : "Panagiotis Kanavos",
      "link" : "https://stackoverflow.com/users/134204/panagiotis-kanavos"
    },
    "creation_date" : 1762182860,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}