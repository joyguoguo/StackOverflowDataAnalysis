{
  "question" : {
    "question_id" : 79662520,
    "title" : "Print a big table on a PDF using ITextPdf7",
    "body" : "<p>I have an issue using ITextPdf-7.2.6.\nI would like to print a big table on a PDF but I always have those two issues.\nI have an infinite loop if I recreate the renderer or a NullPointerException if I try to continue with the previous renderer.\nHow should I procced to achieve it ?</p>\n<pre><code>public class App \n{\n  public static void main(String[] args) {\n    try {\n        PdfWriter writer = new PdfWriter(&quot;test.pdf&quot;);\n        PdfDocument pdf = new PdfDocument(writer);\n        pdf.addNewPage();\n        Document document = new Document(pdf);\n        Table table = new Table(UnitValue.createPercentArray(new float[]{1, 1}));\n        table.setWidth(UnitValue.createPercentValue(100));\n        PdfFont font = PdfFontFactory.createFont(StandardFonts.HELVETICA, PdfEncodings.WINANSI, EmbeddingStrategy.FORCE_NOT_EMBEDDED);\n        for(int i=0; i&lt;10; i=i+2) {\n          table.addCell(new Cell().add(new Paragraph(&quot;Lorem Ipsum&quot;).setFont(font)));\n          table.addCell(new Cell().add(new Paragraph(&quot;Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.&quot;).setFont(font)));\n        }\n        integrateTableToPDF2(table, new Rectangle(PageSize.A4), pdf);\n        document.close();\n        System.out.println(&quot;OK&quot;);\n    } catch(Exception e) {\n      e.printStackTrace();\n    }\n  }\n  \n  private static void integrateTableToPDF(Table table, Rectangle pagesize, PdfDocument doc) throws IOException {\n        float marginLeft = 60;\n        float marginRight = 20;\n        float marginBottom = 50;\n        float usableWidth = pagesize.getWidth() - marginLeft - marginRight;\n        float usableHeight = pagesize.getHeight() - marginBottom;\n        Rectangle drawArea = new Rectangle(marginLeft, marginBottom, usableWidth, usableHeight);\n        PdfPage page = doc.getLastPage();\n        PdfCanvas pdfCanvas = new PdfCanvas(page);\n        Canvas canvas = new Canvas(pdfCanvas, drawArea);\n        TableRenderer renderer = (TableRenderer) table.createRendererSubTree();\n        renderer.setParent(canvas.getRenderer());\n        LayoutResult result = renderer.layout(new LayoutContext(new LayoutArea(doc.getNumberOfPages()-1, drawArea)));\n        renderer.draw(new DrawContext(doc, pdfCanvas));\n        while (result.getStatus() != LayoutResult.FULL) {\n            TableRenderer overflowRenderer = (TableRenderer) result.getOverflowRenderer();\n            PdfPage newPage = doc.addNewPage();\n            PdfCanvas newCanvas = new PdfCanvas(newPage);\n            Rectangle nextDrawArea = new Rectangle(marginLeft, marginBottom, usableWidth, pagesize.getHeight() - marginBottom);\n            LayoutArea newArea = new LayoutArea(doc.getNumberOfPages()-1, nextDrawArea);\n            Canvas nextCanvasModel = new Canvas(newCanvas, nextDrawArea);\n            overflowRenderer.setParent(nextCanvasModel.getRenderer());\n            result = overflowRenderer.layout(new LayoutContext(newArea));\n            overflowRenderer.draw(new DrawContext(doc, newCanvas));\n            nextCanvasModel.flush();\n            nextCanvasModel.close();\n        }\n        canvas.flush();\n        canvas.close();\n    }\n  \n  private static void integrateTableToPDF2(Table table, Rectangle pagesize, PdfDocument doc) throws IOException {\n        float marginLeft = 60;\n        float marginRight = 20;\n        float marginBottom = 50;\n        float usableWidth = pagesize.getWidth() - marginLeft - marginRight;\n        float usableHeight = pagesize.getHeight() - marginBottom;\n        Rectangle drawArea = new Rectangle(marginLeft, marginBottom, usableWidth, usableHeight);\n        PdfPage page = doc.getLastPage();\n        PdfCanvas pdfCanvas = new PdfCanvas(page);\n        Canvas canvas = new Canvas(pdfCanvas, drawArea);\n        TableRenderer renderer = (TableRenderer) table.createRendererSubTree();\n        renderer.setParent(canvas.getRenderer());\n        LayoutResult result = renderer.layout(new LayoutContext(new LayoutArea(doc.getNumberOfPages()-1, drawArea)));\n        renderer.draw(new DrawContext(doc, pdfCanvas));\n        while (result.getStatus() != LayoutResult.FULL) {\n            PdfPage newPage = doc.addNewPage();\n            PdfCanvas newCanvas = new PdfCanvas(newPage);\n            Rectangle nextDrawArea = new Rectangle(marginLeft, marginBottom, usableWidth, pagesize.getHeight() - marginBottom);\n            LayoutArea newArea = new LayoutArea(doc.getNumberOfPages()-1, nextDrawArea);\n            Canvas nextCanvasModel = new Canvas(newCanvas, nextDrawArea);\n            renderer = (TableRenderer) table.createRendererSubTree();           \n            renderer.setParent(nextCanvasModel.getRenderer());\n            result = renderer.layout(new LayoutContext(newArea));\n            renderer.draw(new DrawContext(doc, newCanvas));\n            nextCanvasModel.flush();\n            nextCanvasModel.close();\n            if(doc.getNumberOfPages()==20)\n              throw new IOException(&quot;Infinite loop !&quot;);\n        }\n        canvas.flush();\n        canvas.close();\n    }\n}\n</code></pre>\n<p>Please update the main changing integrateTableToPDF to integrateTableToPDF2 to test the two options.</p>\n<p>Output using integrateTableToPDF :</p>\n<pre><code>java.lang.NullPointerException\n    at com.itextpdf.layout.renderer.AbstractRenderer.isFirstOnRootArea(AbstractRenderer.java:2380)\n    at com.itextpdf.layout.renderer.TableRenderer.layout(TableRenderer.java:294)\n    at com.itextpdftest.App.integrateTableToPDF(App.java:71)\n    at com.itextpdftest.App.main(App.java:41)\n</code></pre>\n<p>Ouput using integrateTableToPDF2 :</p>\n<pre><code>com.itextpdf.io.exceptions.IOException: Infinite loop !\n    at com.itextpdftest.App.integrateTableToPDF2(App.java:107)\n    at com.itextpdftest.App.main(App.java:41)\n</code></pre>\n",
    "tags" : [ "java", "pdf", "nullpointerexception", "itext", "ioexception" ],
    "owner" : {
      "account_id" : 16718664,
      "reputation" : 140,
      "user_id" : 12084130,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/dc60574b61e4b7b815f8b1bab5b5b09a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "pacataque",
      "link" : "https://stackoverflow.com/users/12084130/pacataque"
    },
    "is_answered" : false,
    "view_count" : 79,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1750248167,
    "creation_date" : 1749668538,
    "link" : "https://stackoverflow.com/questions/79662520/print-a-big-table-on-a-pdf-using-itextpdf7",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79670596,
    "question_id" : 79662520,
    "body" : "<p>In your first approach, you trigger what seems to be a bug in iText that can cause the <code>currentArea</code> field within a <code>RootRenderer</code> to be null. During one of the layout steps, this field is checked without checking for <code>null</code>, leading to the <code>NullPointerException</code> you noticed.</p>\n<pre class=\"lang-java prettyprint-override\"><code>                isFirstOnRootArea = ((RootRenderer) parent).currentArea.isEmptyArea();\n</code></pre>\n<p>I believe this could be fixed inside the library by altering the line of code in the library to</p>\n<pre class=\"lang-java prettyprint-override\"><code>                isFirstOnRootArea = ((RootRenderer) parent).getCurrentArea().isEmptyArea();\n</code></pre>\n<p>so that the field is recalculated on demand. However, I don't know the performance implications, so I'll leave that decision up to the iText devs.</p>\n<p>I don't know enough about the rendering pipeline for iText to know why this field is left <code>null</code> when the bug is triggered, but you can work around it by calling <code>getCurrentArea()</code> on the <code>RootRenderer</code> you're using before calling <code>layout</code> on the overflow renderer, which will initialise the value. This will update the <code>currentArea</code> field and make the render succeed.</p>\n<p>This method will create a PDF file with the overflow as you would expect:</p>\n<pre class=\"lang-java prettyprint-override\"><code>private static void integrateTableToPDF(Table table, Rectangle pagesize, PdfDocument doc) throws IOException {\n    float marginLeft = 60;\n    float marginRight = 20;\n    float marginBottom = 50;\n    float usableWidth = pagesize.getWidth() - marginLeft - marginRight;\n    float usableHeight = pagesize.getHeight() - marginBottom;\n    Rectangle drawArea = new Rectangle(marginLeft, marginBottom, usableWidth, usableHeight);\n    PdfPage page = doc.getLastPage();\n    PdfCanvas pdfCanvas = new PdfCanvas(page);\n    Canvas canvas = new Canvas(pdfCanvas, drawArea);\n    TableRenderer renderer = (TableRenderer) table.createRendererSubTree();\n    renderer.setParent(canvas.getRenderer());\n    LayoutResult result = renderer.layout(new LayoutContext(new LayoutArea(doc.getNumberOfPages() - 1, drawArea)));\n    renderer.draw(new DrawContext(doc, pdfCanvas));\n    while (result.getStatus() != LayoutResult.FULL) {\n       \n       TableRenderer overflowRenderer = (TableRenderer) result.getOverflowRenderer();\n       PdfPage newPage = doc.addNewPage();\n       PdfCanvas newCanvas = new PdfCanvas(newPage);\n       Rectangle nextDrawArea = new Rectangle(marginLeft, marginBottom, usableWidth, pagesize.getHeight() - marginBottom);\n       LayoutArea newArea = new LayoutArea(doc.getNumberOfPages() - 1, nextDrawArea);\n       Canvas nextCanvasModel = new Canvas(newCanvas, nextDrawArea);\n       \n       // Null pointer exception workaround is here. This getter will update the internal state of the root renderer\n       nextCanvasModel.getRenderer().getCurrentArea();\n       \n       overflowRenderer.setParent(nextCanvasModel.getRenderer());\n       result = overflowRenderer.layout(new LayoutContext(newArea));\n       overflowRenderer.draw(new DrawContext(doc, newCanvas));\n       nextCanvasModel.flush();\n       nextCanvasModel.close();\n    }\n    canvas.flush();\n    canvas.close();\n}\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 42585555,
      "reputation" : 1,
      "user_id" : 30824496,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/1a9945d7bde9c94285e98dc62977d2e1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jeroen",
      "link" : "https://stackoverflow.com/users/30824496/jeroen"
    },
    "creation_date" : 1750248167,
    "last_activity_date" : 1750248167,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140510583,
    "post_id" : 79662520,
    "body" : "Hi,  We recently introduced a big improvement on table speed for large tables you can read about it here: <a href=\"https://kb.itextpdf.com/itext/how-i-made-pdf-table-rendering-faster\" rel=\"nofollow noreferrer\">kb.itextpdf.com/itext/how-i-made-pdf-table-rendering-faster</a>  So honestly the best answer here is to migrate to itext 9.2 or above then it will first of all speed up, and second of all I suspect you wont need this kind of low level code.  If you can describe the desired result I might even find some time to create a sample for you.",
    "score" : 2,
    "owner" : {
      "account_id" : 13873126,
      "reputation" : 388,
      "user_id" : 10015628,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0e4b1aa9aece02e32d2ba2408a92bfb5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Guust",
      "link" : "https://stackoverflow.com/users/10015628/guust"
    },
    "creation_date" : 1749800074,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}