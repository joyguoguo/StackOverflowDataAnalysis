{
  "question" : {
    "question_id" : 79768139,
    "title" : "What relationship should be used",
    "body" : "<p>I have a table (<code>product</code>) as follows which holds product related data</p>\n<pre><code>@Entity\n@Table(name = &quot;product&quot;)\npublic class ProductEntity {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    @Column(name = &quot;id&quot;)\n    private int id;\n\n    @Column(name = &quot;name&quot;)\n    private String name;\n\n    @Column(name = &quot;version&quot;)\n    private String version;\n\n// getters and setter\n}\n</code></pre>\n<p>Among some of the products, there are some products which are derived from another product and there is requirement to store this mapping in a table (<code>sub_product_mapping</code>)</p>\n<pre><code>@Entity\n@Table(name = &quot;sub_product_mapping&quot;)\npublic class SubProductMappingEntity {\n\n    @EmbeddedId\n    private SubProductMappingKeyEntity subProductMappingKeyEntity;\n\n    @MapsId(&quot;majorProductId&quot;)\n    @ManyToOne\n    @JoinColumn(name = &quot;major_product_id&quot;, referencedColumnName = &quot;id&quot;, nullable = false)\n    private ProductEntity majorProduct;\n\n    @MapsId(&quot;subProductId&quot;)\n    @ManyToOne\n    @JoinColumn(name = &quot;sub_product_id&quot;, referencedColumnName = &quot;id&quot;, nullable = false)\n    private ProductEntity subProduct;\n\n// getters and setter\n\n</code></pre>\n<p>and the key entity is as follows</p>\n<pre><code>@Embeddable\npublic class SubProductMappingKeyEntity implements Serializable {\n\n    private static final long serialVersionUID = 1L;\n\n    @Column(name = &quot;major_product_id&quot;, nullable = false)\n    private int majorProductId;\n    @Column(name = &quot;sub_product_id&quot;, nullable = false)\n    private int subProductId;\n\n// getters and setters\n</code></pre>\n<p>For a minor product there can only be one major product. But for a major product there can be multiple minor products. Since both the <code>majorProduct</code> and <code>subProduct</code> are instances of <code>ProductEntity</code>, what should be the relationship that should be used? Is it valid to have the relationships as follows?</p>\n<pre><code> @MapsId(&quot;majorProductId&quot;)\n    @ManyToOne\n    @JoinColumn(name = &quot;major_product_id&quot;, referencedColumnName = &quot;id&quot;, nullable = false)\n    private ProductEntity majorProduct;\n\n    @MapsId(&quot;subProductId&quot;)\n    @OneToOne\n    @JoinColumn(name = &quot;sub_product_id&quot;, referencedColumnName = &quot;id&quot;, nullable = false)\n    private ProductEntity subProduct;\n</code></pre>\n<p>(note: I am using <code>Hibernate</code> as the JPA implementation)</p>\n",
    "tags" : [ "java", "hibernate", "jpa", "entity", "relationship" ],
    "owner" : {
      "account_id" : 6609714,
      "reputation" : 4493,
      "user_id" : 5105305,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://lh4.googleusercontent.com/-i8lMihc1yYc/AAAAAAAAAAI/AAAAAAAAAJE/ooPD4M12q8I/s256-rj/photo.jpg",
      "display_name" : "Kasun Siyambalapitiya",
      "link" : "https://stackoverflow.com/users/5105305/kasun-siyambalapitiya"
    },
    "is_answered" : false,
    "view_count" : 67,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1758203876,
    "creation_date" : 1758182392,
    "link" : "https://stackoverflow.com/questions/79768139/what-relationship-should-be-used",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79768545,
    "question_id" : 79768139,
    "body" : "<blockquote>\n<p>For a minor product there can only be one major product. But for a major product there can be multiple minor products. Since both the <code>majorProduct</code> and <code>subProduct</code> are instances of <code>ProductEntity</code>, what should be the relationship that should be used?</p>\n</blockquote>\n<p>That the two relationships are with the same entity type has no direct bearing on the cardinalities needed or allowed for those relationships.  Each relationship is mapped independently of the others.</p>\n<blockquote>\n<p>Is it valid to have the relationships [defined on <code>SubProductMappingKeyEntity</code>] as follows?</p>\n<p>[one <code>ManyToOne</code> and one <code>OneToOne</code>, both with <code>ProductEntity</code> on the other end]</p>\n</blockquote>\n<p>Yes, it is valid.  However, if subproduct mappings don't have any of their own (mapped) properties, as shown in the question, then modeling them as their own entity is needlessly complicated.  I would just map the relationship as a self-referential one directly on <code>ProductEntity</code>:</p>\n<pre><code>@Entity\n@Table(name = &quot;product&quot;)\npublic class ProductEntity {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    @Column(name = &quot;id&quot;)\n    private int id;\n\n    @Column(name = &quot;name&quot;)\n    private String name;\n\n    @Column(name = &quot;version&quot;)\n    private String version;\n\n    @ManyToOne(optional = true)\n    ProductEntity majorProduct;\n    // ...\n}\n</code></pre>\n<p>And you can make that bidirectional if you like, by also adding</p>\n<pre><code>    @OneToMany(mappedBy = &quot;majorProduct&quot;)\n    List&lt;ProductEntity&gt; subProducts;\n    // ...\n</code></pre>\n<p>You can back that with a relationship table such as you propose in the question, without creating an entity class for the relationship.  You can also back it simply with a foreign key on the <code>product</code> table, referencing <code>product</code> itself.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1758203876,
    "last_activity_date" : 1758203876,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140745008,
    "post_id" : 79768139,
    "body" : "Even if you insist on having a separate relationship table, is there a genuine need to model it as an entity in its own right?  (Not every table associated with a persistence unit has to have a corresponding entity class.)",
    "score" : 0,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1758202769,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140744996,
    "post_id" : 79768139,
    "body" : "There&#39;s nothing wrong with your design, as long as you need this mapping table. As mentioned, it could also be simple self-reference, as usually in classical parent-children scenario.",
    "score" : 0,
    "owner" : {
      "account_id" : 9606741,
      "reputation" : 41303,
      "user_id" : 7132550,
      "user_type" : "registered",
      "accept_rate" : 75,
      "profile_image" : "https://graph.facebook.com/1063981417044495/picture?type=large",
      "display_name" : "Michał Turczyn",
      "link" : "https://stackoverflow.com/users/7132550/micha%c5%82-turczyn"
    },
    "creation_date" : 1758202524,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140744614,
    "post_id" : 79768139,
    "body" : "By the way, recommend not having the “Entity” suffix on all your class names (unless you really want to, of course).   just calling your class “Product” (rather than “ProductEntity”) Is fine as standard practice.",
    "score" : 0,
    "owner" : {
      "account_id" : 732315,
      "reputation" : 5044,
      "user_id" : 681444,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/7f2cf06b7978a31e570129c395998c5f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "racraman",
      "link" : "https://stackoverflow.com/users/681444/racraman"
    },
    "creation_date" : 1758192998,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140744575,
    "post_id" : 79768139,
    "body" : "Since as you say “a minor product there can only be one major product”, is there any reason this wouldn’t be a simple self-referential hierarchy ( no need for another table) ?   Take a look at <a href=\"https://stackoverflow.com/a/29975953/681444\">stackoverflow.com/a/29975953/681444</a>",
    "score" : 2,
    "owner" : {
      "account_id" : 732315,
      "reputation" : 5044,
      "user_id" : 681444,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/7f2cf06b7978a31e570129c395998c5f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "racraman",
      "link" : "https://stackoverflow.com/users/681444/racraman"
    },
    "creation_date" : 1758191383,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}