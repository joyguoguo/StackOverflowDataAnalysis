{
  "question" : {
    "question_id" : 79643207,
    "title" : "Nested generic wildcards in Java",
    "body" : "<p>I have a generic interface that has a generic method that uses an upper bound based on the interface's type parameter.</p>\n<pre class=\"lang-java prettyprint-override\"><code>interface X&lt;T&gt; {\n    &lt;S extends T&gt; void foo(Iterable&lt;S&gt; t);\n}\n</code></pre>\n<p>The upper bound allows any subclass of T to be a type parameter for the method. For example:</p>\n<pre class=\"lang-java prettyprint-override\"><code>X&lt;CharSequence&gt; x = ...;\nList&lt;String&gt; stringList = ...;\nList&lt;CharSequence&gt; charSequenceList = ..;\n\nx.foo(stringList); //OK\nx.foo(charSequenceList); //OK\n</code></pre>\n<p>Hoewever, if I define x's type parameter to <code>? extends CharSequence</code>, the above method calls now result in a compile error:</p>\n<pre class=\"lang-java prettyprint-override\"><code>X&lt;? extends CharSequence&gt; x = ...;\nList&lt;String&gt; stringList = ...;\nList&lt;CharSequence&gt; charSequenceList = ...;\n\nx.foo(stringList); // Compile error\nx.foo(charSequenceList); // Compile error\n</code></pre>\n<p>How can I make it compile without changing the definition of <code>X</code>?</p>\n<p>Driver code for testing:</p>\n<pre class=\"lang-java prettyprint-override\"><code>interface X&lt;T&gt; {\n    &lt;S extends T&gt; void foo(Iterable&lt;S&gt; t);\n}\n\nclass Driver {\n    public static void main(String[] args) {\n        X&lt;CharSequence&gt; x1 = null;\n        List&lt;String&gt; stringList = null;\n        List&lt;CharSequence&gt; charSequenceList = null;\n        x1.foo(stringList); //OK\n        x1.foo(charSequenceList); //OK\n\n        X&lt;? extends CharSequence&gt; x2 = null;\n        x2.foo(stringList); // Compile error\n        x2.foo(charSequenceList); // Compile error\n    }\n}\n</code></pre>\n",
    "tags" : [ "java", "generics" ],
    "owner" : {
      "account_id" : 910147,
      "reputation" : 11,
      "user_id" : 944184,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/4fc561c5aa1ae93917e271f1ed9079ff?s=256&d=identicon&r=PG",
      "display_name" : "user944184",
      "link" : "https://stackoverflow.com/users/944184/user944184"
    },
    "is_answered" : true,
    "view_count" : 92,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1748488282,
    "creation_date" : 1748485265,
    "link" : "https://stackoverflow.com/questions/79643207/nested-generic-wildcards-in-java",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79643228,
    "question_id" : 79643207,
    "body" : "<p>You can't make this compile. When you parameterize a type with <code>? extends T</code> (where <code>T</code> can be any reference type), then you are are saying that parameterized type is a <em>producer</em> of <code>T</code>. It can no longer <em>consume</em> <code>T</code>. In other words, any method which has <code>T</code> as the type of a parameter or part of the parameterization of a parameter's type can no longer be called.</p>\n<p>Why? Well, this line of code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>X&lt;? extends CharSequence&gt; x2 = null;\n</code></pre>\n<p>Is saying the <code>X</code> referenced by <code>x2</code> can be any subtype of <code>X&lt;? extends CharSequence&gt;</code>. For instance, the following is legal.</p>\n<pre class=\"lang-java prettyprint-override\"><code>X&lt;StringBuilder&gt; sbx = i -&gt; i.forEach(s -&gt; s.append(&quot;Hi&quot;));\nX&lt;? extends CharSequence&gt; csx = sbx;\n</code></pre>\n<p>From the point of view of <code>csx</code> you no longer know exactly which subtype of <code>CharSequence</code> the instance expects. Thus, doing something like <code>csx.foo(List.of(&quot;Bye&quot;))</code> is forbidden because there's no guarantee it's type safe. In fact, that example would, if allowed to compile, lead to an error at run-time because <code>String</code> does not have an <code>append</code> method.</p>\n<p>Your error is no different than what you'd see with:</p>\n<pre class=\"lang-java prettyprint-override\"><code>List&lt;? extends CharSequence&gt; list = new ArrayList&lt;&gt;();\nlist.add(&quot;Hi&quot;); // error\n</code></pre>\n",
    "score" : 6,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 8532578,
      "reputation" : 49904,
      "user_id" : 6395627,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Slaw",
      "link" : "https://stackoverflow.com/users/6395627/slaw"
    },
    "creation_date" : 1748487786,
    "last_activity_date" : 1748488282,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140468325,
    "post_id" : 79643207,
    "body" : "I think the specific (common) misunderstanding is that <code>? extends T</code> means &quot;any subtype of T`, whereas in fact it means &quot;a specific <i>but unknown</i> subtype of T&quot;.",
    "score" : 3,
    "owner" : {
      "account_id" : 162699,
      "reputation" : 141055,
      "user_id" : 3788176,
      "user_type" : "registered",
      "accept_rate" : 54,
      "profile_image" : "https://www.gravatar.com/avatar/44c841338e1646af9a977f1fa0e23948?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Andy Turner",
      "link" : "https://stackoverflow.com/users/3788176/andy-turner"
    },
    "creation_date" : 1748499329,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140468070,
    "post_id" : 79643207,
    "body" : "See also: <a href=\"https://xyproblem.info/\" rel=\"nofollow noreferrer\">xyproblem.info</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 1691630,
      "reputation" : 51067,
      "user_id" : 1553851,
      "user_type" : "registered",
      "accept_rate" : 73,
      "profile_image" : "https://www.gravatar.com/avatar/ad333c218c8f2fb917cf506919fc95f4?s=256&d=identicon&r=PG",
      "display_name" : "shmosel",
      "link" : "https://stackoverflow.com/users/1553851/shmosel"
    },
    "creation_date" : 1748487141,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140468066,
    "post_id" : 79643207,
    "body" : "The last three lines of your testing code say that you want <code>T</code> to be an arbitrary subtype of <code>CharSequence</code>, but then you try to pass a <code>List&lt;String&gt;</code> as a parameter of type <code>Iterable&lt;S&gt;</code>.  But <code>S</code> has to be a subtype of <code>T</code>, and there&#39;s no guarantee that <code>String</code> would be a subtype of an arbitrary subtype of <code>CharSequence</code>.  So this is a mistake, and that&#39;s what the compiler is protecting you from.  It makes no sense to have <code>T</code> as an arbitrary subtype of <code>CharSequence</code> in this context, so I&#39;m really wondering what you&#39;re trying to do.",
    "score" : 1,
    "owner" : {
      "account_id" : 1085259,
      "reputation" : 80183,
      "user_id" : 1081110,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Fp4Pm.jpg?s=256",
      "display_name" : "Dawood ibn Kareem",
      "link" : "https://stackoverflow.com/users/1081110/dawood-ibn-kareem"
    },
    "creation_date" : 1748487108,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140468065,
    "post_id" : 79643207,
    "body" : "Why should it compile? What if <code>x2</code> references a <code>X&lt;StringBuilder&gt;</code>?",
    "score" : 2,
    "owner" : {
      "account_id" : 1691630,
      "reputation" : 51067,
      "user_id" : 1553851,
      "user_type" : "registered",
      "accept_rate" : 73,
      "profile_image" : "https://www.gravatar.com/avatar/ad333c218c8f2fb917cf506919fc95f4?s=256&d=identicon&r=PG",
      "display_name" : "shmosel",
      "link" : "https://stackoverflow.com/users/1553851/shmosel"
    },
    "creation_date" : 1748487078,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}