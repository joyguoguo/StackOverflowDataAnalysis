{
  "question" : {
    "question_id" : 79803703,
    "title" : "Maven project build error : package net.bytebuddy.agent.builder is not visible, package net.bytebuddy.description.type is not visible",
    "body" : "<p>I created new maven project in Eclipse IDE. While build it produced some errors. Below I listed the errors, <code>pom.xml</code> , <code>MANIFEST.MF</code> and <code>Agent.java</code>. What should I do to solve the errors?</p>\n<h1><strong>Errors</strong></h1>\n<pre class=\"lang-none prettyprint-override\"><code>[ERROR] /C:/Users/xxxx/eclipse-workspace-2025/mvn/src/main/java/pkt/mvn/Agent.java:[3,27] package net.bytebuddy.agent.builder is not visible\n  (package net.bytebuddy.agent.builder is declared in the unnamed module, but module java.base does not read it)\n[ERROR] /C:/Users/xxxx/eclipse-workspace-2025/mvn/src/main/java/pkt/mvn/Agent.java:[4,33] package net.bytebuddy.description.type is not visible\n  (package net.bytebuddy.description.type is declared in the unnamed module, but module java.base does not read it)\n[ERROR] /C:/Users/xxxx/eclipse-workspace-2025/mvn/src/main/java/pkt/mvn/Agent.java:[5,21] package net.bytebuddy.dynamic is not visible\n  (package net.bytebuddy.dynamic is declared in the unnamed module, but module java.base does not read it)\n[ERROR] /C:/Users/xxxx/eclipse-workspace-2025/mvn/src/main/java/pkt/mvn/Agent.java:[6,21] package net.bytebuddy.implementation is not visible\n  (package net.bytebuddy.implementation is declared in the unnamed module, but module java.base does not read it)\n[ERROR] /C:/Users/xxxx/eclipse-workspace-2025/mvn/src/main/java/pkt/mvn/Agent.java:[7,21] package net.bytebuddy.matcher is not visible\n</code></pre>\n<h1><strong>pom.xml</strong></h1>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;\n    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n\n    &lt;groupId&gt;pkt&lt;/groupId&gt;\n    &lt;artifactId&gt;mvn&lt;/artifactId&gt;\n    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n    &lt;packaging&gt;jar&lt;/packaging&gt;\n\n    &lt;name&gt;mvn&lt;/name&gt;\n    &lt;url&gt;http://maven.apache.org&lt;/url&gt;\n\n    &lt;properties&gt;\n        &lt;maven.compiler.source&gt;22&lt;/maven.compiler.source&gt;\n        &lt;maven.compiler.target&gt;22&lt;/maven.compiler.target&gt;\n        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;\n        &lt;bytebuddy.version&gt;1.14.8&lt;/bytebuddy.version&gt;\n    &lt;/properties&gt;\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;junit&lt;/groupId&gt;\n            &lt;artifactId&gt;junit&lt;/artifactId&gt;\n            &lt;version&gt;3.8.1&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;net.bytebuddy&lt;/groupId&gt;\n            &lt;artifactId&gt;byte-buddy&lt;/artifactId&gt;\n            &lt;version&gt;${bytebuddy.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;net.bytebuddy&lt;/groupId&gt;\n            &lt;artifactId&gt;byte-buddy-agent&lt;/artifactId&gt;\n            &lt;version&gt;${bytebuddy.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-core&lt;/artifactId&gt;\n            &lt;version&gt;6.0.4&lt;/version&gt;\n        &lt;/dependency&gt;\n\n    &lt;/dependencies&gt;\n    &lt;repositories&gt;\n        &lt;repository&gt;\n            &lt;id&gt;my-repo2&lt;/id&gt;\n            &lt;name&gt;your custom repo&lt;/name&gt;\n            &lt;url&gt;http://jarsm2.dyndns.dk&lt;/url&gt;\n        &lt;/repository&gt;\n    &lt;/repositories&gt;\n\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;\n                &lt;version&gt;3.3.0&lt;/version&gt;\n                &lt;configuration&gt;\n                    &lt;archive&gt;\n                        &lt;manifestEntries&gt;\n                            &lt;addClasspath&gt;true&lt;/addClasspath&gt;\n                            &lt;addDefaultImplementationEntries&gt;true&lt;/addDefaultImplementationEntries&gt;\n                            &lt;addDefaultSpecificationEntries&gt;true&lt;/addDefaultSpecificationEntries&gt;\n                            &lt;Premain-Class&gt;pkt.mvn.Agent&lt;/Premain-Class&gt;\n                            &lt;Can-Redefine-Classes&gt;false&lt;/Can-Redefine-Classes&gt;\n                            &lt;Can-Retransform-Classes&gt;true&lt;/Can-Retransform-Classes&gt;\n                            &lt;mainClass&gt;pkt.mvn.App&lt;/mainClass&gt;\n                        &lt;/manifestEntries&gt;\n                    &lt;/archive&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n                &lt;version&gt;3.12.1&lt;/version&gt;\n                &lt;configuration&gt;\n                    &lt;compilerArgs&gt;\n                        &lt;arg&gt;--add-exports&lt;/arg&gt;\n                        &lt;arg&gt;java.base/sun.security.util=ALL-UNNAMED&lt;/arg&gt;\n                        &lt;arg&gt;--add-exports&lt;/arg&gt;\n                        &lt;arg&gt;java.base/sun.security.jca=ALL-UNNAMED&lt;/arg&gt;\n                        &lt;arg&gt;--add-exports&lt;/arg&gt;\n                        &lt;arg&gt;java.base/jdk.internal.misc=ALL-UNNAMED&lt;/arg&gt;\n                        &lt;arg&gt;--add-exports&lt;/arg&gt;\n                        &lt;arg&gt;\n                            java.base/sun.security.internal.interfaces=ALL-UNNAMED&lt;/arg&gt;\n                        &lt;arg&gt;--add-exports&lt;/arg&gt;\n                        &lt;arg&gt;\n                            java.base/sun.security.provider.certpath=ALL-UNNAMED&lt;/arg&gt;\n                        &lt;arg&gt;--add-exports&lt;/arg&gt;\n                        &lt;arg&gt;java.base/sun.security.internal.spec=ALL-UNNAMED&lt;/arg&gt;\n                        &lt;arg&gt;--add-exports&lt;/arg&gt;\n                        &lt;arg&gt;java.base/sun.security.validator=ALL-UNNAMED&lt;/arg&gt;\n                        &lt;arg&gt;--add-exports&lt;/arg&gt;\n                        &lt;arg&gt;java.base/sun.security.action=ALL-UNNAMED&lt;/arg&gt;\n                        &lt;arg&gt;--add-exports&lt;/arg&gt;\n                        &lt;arg&gt;java.base/sun.security.x509=ALL-UNNAMED&lt;/arg&gt;\n                        &lt;arg&gt;--patch-module=java.base=${basedir}/src/main/java&lt;/arg&gt;\n                    &lt;/compilerArgs&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n&lt;/project&gt;*\n</code></pre>\n<h1><strong>MANIFEST.MF</strong></h1>\n<pre class=\"lang-none prettyprint-override\"><code>Premain-Class: pkt.mvn.Agent\nAgent-Class: pkt.mvn.Agent\nCan-Redefine-Classes: true\nCan-Retransform-Classes: true\nMain-Class:Â pkt.mvn.App\n</code></pre>\n<h1><strong>Agent.java</strong></h1>\n<pre><code>package pkt.mvn;\n\nimport net.bytebuddy.agent.builder.AgentBuilder;\nimport net.bytebuddy.description.type.TypeDescription;\nimport net.bytebuddy.dynamic.DynamicType;\nimport net.bytebuddy.implementation.MethodDelegation;\nimport net.bytebuddy.matcher.ElementMatchers;\nimport net.bytebuddy.utility.JavaModule;\n\nimport java.io.*;\nimport java.lang.instrument.Instrumentation;\nimport java.nio.file.Files;\nimport java.util.jar.JarEntry;\nimport java.util.jar.JarOutputStream;\nimport java.util.zip.CRC32;\nimport java.util.zip.ZipEntry;\nimport pkt.mvn.*;\n\n/**\n * Java agent that injects OurECParameters into the bootstrap class loader and\n * redefines sun.security.util.ECParameters to delegate logic to\n * OurECParameters.\n */\n\npublic class Agent {\n    public static void premain(String agentArgs, Instrumentation inst) throws ClassNotFoundException {\n        try {\n            System.out.println(&quot;[agent] premain starting&quot;);\n\n            // Create a temporary jar that contains our helper class (OurECParameters)\n            Class cls = Class.forName(&quot;pkt.mvn.ECParameters&quot;); \n            File tmpJar = createBootstrapJarContaining(cls);\n            System.out.println(&quot;[agent] created bootstrap jar at: &quot; + tmpJar);\n\n            // Make the jar available to bootstrap class loader so core classes can\n            // reference OurECParameters\n            inst.appendToBootstrapClassLoaderSearch(new java.util.jar.JarFile(tmpJar));\n            System.out.println(&quot;[agent] appended to bootstrap class loader search&quot;);\n\n            // Use Byte Buddy to retransform/redefine the JDK internal class\n            new AgentBuilder.Default().with(AgentBuilder.RedefinitionStrategy.REDEFINITION)\n                    .type(ElementMatchers.nameEndsWith(&quot;sun.security.util.ECParameters&quot;)\n                            .or(ElementMatchers.named(&quot;sun.security.util.ECParameters&quot;)))\n                    .transform((builder, typeDescription, classLoader, module, protectionDomain) -&gt; {\n                        System.out.println(&quot;[agent] transforming: &quot; + typeDescription.getName());\n                        //--return builder.method(ElementMatchers.not(ElementMatchers.isPrivate()))\n                        //--        .intercept(MethodDelegation.to(Class.forName(&quot;pkt.ECParameters.class&quot;, true, null)));\n                        return builder.method(ElementMatchers.any()).intercept(MethodDelegation.to(cls)) ;\n                    }).installOn(inst);\n\n            // Optionally retransform already loaded class if it is already loaded:\n            for (Class&lt;?&gt; c : inst.getAllLoadedClasses()) {\n                if (&quot;sun.security.util.ECParameters&quot;.equals(c.getName()) &amp;&amp; inst.isModifiableClass(c)) {\n                    try {\n                        System.out.println(&quot;[agent] retransfoming already-loaded ECParameters&quot;);\n                        inst.retransformClasses(c);\n                    } catch (Throwable t) {\n                        System.out.println(&quot;[agent] retransformation failed: &quot; + t);\n                    }\n                }\n            }\n        } catch (Exception e) {\n            System.out.println(e.toString());\n            e.printStackTrace();\n        }\n\n        System.out.println(&quot;[agent] premain finished&quot;);\n    }\n\n    /**\n     * Create a temporary JAR containing the given class (and related nested\n     * classes). We read the class bytes from the agent's own classloader resources\n     * and write into temp jar.\n     */\n    private static File createBootstrapJarContaining(Class&lt;?&gt; cls) throws IOException {\n        String resourcePath = cls.getName().replace('.', '/') + &quot;.class&quot;;\n        InputStream classStream = cls.getClassLoader().getResourceAsStream(resourcePath);\n        if (classStream == null) {\n            throw new IllegalStateException(&quot;Cannot find class resource: &quot; + resourcePath);\n        }\n\n        File tmpJar = Files.createTempFile(&quot;agent-bootstrap-&quot;, &quot;.jar&quot;).toFile();\n        tmpJar.deleteOnExit();\n\n        try (JarOutputStream jos = new JarOutputStream(new FileOutputStream(tmpJar))) {\n            JarEntry entry = new JarEntry(resourcePath);\n            jos.putNextEntry(entry);\n            byte[] buffer = new byte[8192];\n            int r;\n            while ((r = classStream.read(buffer)) != -1) {\n                jos.write(buffer, 0, r);\n            }\n            jos.closeEntry();\n        }\n        return tmpJar;\n    }\n}\n</code></pre>\n",
    "tags" : [ "java", "eclipse", "maven", "byte-buddy" ],
    "owner" : {
      "account_id" : 31235712,
      "reputation" : 11,
      "user_id" : 24040072,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3bd7e8cf6ab3d2428520f797a5c11019?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Cemil Bozlagan",
      "link" : "https://stackoverflow.com/users/24040072/cemil-bozlagan"
    },
    "is_answered" : false,
    "view_count" : 82,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1761765665,
    "creation_date" : 1761736001,
    "link" : "https://stackoverflow.com/questions/79803703/maven-project-build-error-package-net-bytebuddy-agent-builder-is-not-visible",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140829152,
    "post_id" : 79803703,
    "body" : "Maybe try removing the other arg lines as well, I can&#39;t imagine those are still needed when you&#39;re already on Java 22. Those are workarounds to get old libraries working on Java 17 and up. If you still have trouble it might be that super-ancient version of JUnit.",
    "score" : 0,
    "owner" : {
      "account_id" : 187094,
      "reputation" : 5301,
      "user_id" : 424903,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/8oHZF.png?s=256",
      "display_name" : "Gimby",
      "link" : "https://stackoverflow.com/users/424903/gimby"
    },
    "creation_date" : 1761912461,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140827462,
    "post_id" : 79803703,
    "body" : "I deleted &quot;&lt;arg&gt;--patch-module=java.base=${basedir}/src/main/java&lt;/arg&zwnj;&#8203;&gt;&quot;  line from pom.xml. Problem was solved.",
    "score" : 0,
    "owner" : {
      "account_id" : 31235712,
      "reputation" : 11,
      "user_id" : 24040072,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3bd7e8cf6ab3d2428520f797a5c11019?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Cemil Bozlagan",
      "link" : "https://stackoverflow.com/users/24040072/cemil-bozlagan"
    },
    "creation_date" : 1761837659,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140825818,
    "post_id" : 79803703,
    "body" : "I cancelled net buddy from Temporary jar, but same errors continues to occur.",
    "score" : 0,
    "owner" : {
      "account_id" : 31235712,
      "reputation" : 11,
      "user_id" : 24040072,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3bd7e8cf6ab3d2428520f797a5c11019?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Cemil Bozlagan",
      "link" : "https://stackoverflow.com/users/24040072/cemil-bozlagan"
    },
    "creation_date" : 1761771274,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140825811,
    "post_id" : 79803703,
    "body" : "Temporary jar include byte buddy for -BindingPriority- purpose. There is 3 methods with same name. I must give -BindingPriority- to determine which metod will overwrite to original method.",
    "score" : 0,
    "owner" : {
      "account_id" : 31235712,
      "reputation" : 11,
      "user_id" : 24040072,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3bd7e8cf6ab3d2428520f797a5c11019?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Cemil Bozlagan",
      "link" : "https://stackoverflow.com/users/24040072/cemil-bozlagan"
    },
    "creation_date" : 1761771037,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140825788,
    "post_id" : 79803703,
    "body" : "There is no module-info.java file.",
    "score" : 0,
    "owner" : {
      "account_id" : 31235712,
      "reputation" : 11,
      "user_id" : 24040072,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3bd7e8cf6ab3d2428520f797a5c11019?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Cemil Bozlagan",
      "link" : "https://stackoverflow.com/users/24040072/cemil-bozlagan"
    },
    "creation_date" : 1761770449,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140825698,
    "post_id" : 79803703,
    "body" : "This is likely related to class loaders. Does the tempoary jar include Byte Buddy? Then the library will be on the boot and the system loader. In this case package-private types in a package cannot be seen from packages with the same name but of a different class loader. They can neither be loaded twice in the same hirarchy. You should therefore avoid having Byte Buddy on two loaders.",
    "score" : 0,
    "owner" : {
      "account_id" : 1284143,
      "reputation" : 44402,
      "user_id" : 1237575,
      "user_type" : "registered",
      "accept_rate" : 96,
      "profile_image" : "https://www.gravatar.com/avatar/bc96521f79789d75fa63cfa5c2758765?s=256&d=identicon&r=PG",
      "display_name" : "Rafael Winterhalter",
      "link" : "https://stackoverflow.com/users/1237575/rafael-winterhalter"
    },
    "creation_date" : 1761767690,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140825639,
    "post_id" : 79803703,
    "body" : "Do you have a module-info.java file in your project (in src/main/java)? If so, can you show it?",
    "score" : 0,
    "owner" : {
      "account_id" : 15064163,
      "reputation" : 17111,
      "user_id" : 10871900,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/720202b6e19abc330dcd92e6a1254562?s=256&d=identicon&r=PG",
      "display_name" : "dan1st",
      "link" : "https://stackoverflow.com/users/10871900/dan1st"
    },
    "creation_date" : 1761765641,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}