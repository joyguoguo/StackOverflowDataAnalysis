{
  "question" : {
    "question_id" : 79787770,
    "title" : "Adding new ReactActivity to run another js bundle",
    "body" : "<p>I'm trying to make my React Native Android app to have another Activity, beside MainActivity, be able to run another js bundle. I managed to achieve that with this implementation:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>import android.app.Activity\nimport android.os.Bundle\nimport com.facebook.react.ReactHost\nimport com.facebook.react.ReactRootView\nimport com.facebook.react.defaults.DefaultReactHost.getDefaultReactHost\n\nclass MiniAppActivity : Activity() {\n    val TAG = &quot;MiniAppActivity&quot;\n    private lateinit var reactRootView: ReactRootView\n    private lateinit var reactHost: ReactHost\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        val miniHost = MiniReactNativeHost(application)\n        reactHost = getDefaultReactHost(applicationContext, miniHost)\n        reactRootView = ReactRootView(this)\n        reactRootView.startReactApplication(\n            miniHost.reactInstanceManager,\n            &quot;MiniApp&quot;, // name from AppRegistry.registerComponent()\n            null\n        )\n        setContentView(reactRootView)\n    }\n\n    override fun onPause() {\n        super.onPause()\n        reactHost.onHostPause(this)\n    }\n\n    override fun onResume() {\n        super.onResume()\n        reactHost.onHostResume(this)\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        reactHost.onHostDestroy(this)\n    }\n}\n</code></pre>\n<p>with class <code>MiniReactNativeHost</code>:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>import android.app.Application\nimport com.facebook.react.PackageList\nimport com.facebook.react.ReactPackage\nimport com.facebook.react.defaults.DefaultReactNativeHost\nimport com.myapp.config.ConfigReaderPackage\nimport com.myapp.intent_launcher.IntentLauncherPackage\n\nclass MiniReactNativeHost(app: Application) : DefaultReactNativeHost(app) {\n\n    override fun getUseDeveloperSupport(): Boolean = BuildConfig.DEBUG\n\n    override fun getJSMainModuleName(): String = &quot;index.mini&quot; // if dev mode\n\n    override fun getBundleAssetName(): String = &quot;index.mini.bundle&quot; // mini bundle name\n\n    override fun getPackages(): List&lt;ReactPackage&gt; =\n        PackageList(this).packages.apply {\n            add(ConfigReaderPackage())\n            add(IntentLauncherPackage())\n        }\n\n    override fun getJSBundleFile(): String {\n        return &quot;assets://index.mini.bundle&quot;\n    }\n\n    override val isNewArchEnabled: Boolean = BuildConfig.IS_NEW_ARCHITECTURE_ENABLED\n    override val isHermesEnabled: Boolean = BuildConfig.IS_HERMES_ENABLED\n}\n</code></pre>\n<p>The above code runs but only on old architecture. On new architecture, the new bundle is loaded but the app throw a runtime error:</p>\n<pre class=\"lang-none prettyprint-override\"><code>FATAL EXCEPTION: mqt_native_modules\nProcess: com.myapp.local, PID: 15645\njava.lang.RuntimeException: Could not invoke UIManager.createView\n    at com.facebook.react.bridge.JavaMethodWrapper.invoke(JavaMethodWrapper.java:381)\n    at com.facebook.react.bridge.JavaModuleWrapper.invoke(JavaModuleWrapper.java:146)\n    at com.facebook.jni.NativeRunnable.run(Native Method)\n    at android.os.Handler.handleCallback(Handler.java:942)\n    at android.os.Handler.dispatchMessage(Handler.java:99)\n    at com.facebook.react.bridge.queue.MessageQueueThreadHandler.dispatchMessage(MessageQueueThreadHandler.kt:20)\n    at android.os.Looper.loopOnce(Looper.java:211)\n    at android.os.Looper.loop(Looper.java:300)\n    at com.facebook.react.bridge.queue.MessageQueueThreadImpl$Companion.startNewBackgroundThread$lambda$1(MessageQueueThreadImpl.kt:175)\n    at com.facebook.react.bridge.queue.MessageQueueThreadImpl$Companion.$r8$lambda$ldnZnqelhYFctGaUKkOKYj5rxo4(Unknown Source:0)\n    at com.facebook.react.bridge.queue.MessageQueueThreadImpl$Companion$$ExternalSyntheticLambda0.run(D8$$SyntheticClass:0)\n    at java.lang.Thread.run(Thread.java:1012)\nCaused by: java.lang.reflect.InvocationTargetException\n    at java.lang.reflect.Method.invoke(Native Method)\n    at com.facebook.react.bridge.JavaMethodWrapper.invoke(JavaMethodWrapper.java:372)\n    at com.facebook.react.bridge.JavaModuleWrapper.invoke(JavaModuleWrapper.java:146) \n    at com.facebook.jni.NativeRunnable.run(Native Method) \n    at android.os.Handler.handleCallback(Handler.java:942) \n    at android.os.Handler.dispatchMessage(Handler.java:99) \n    at com.facebook.react.bridge.queue.MessageQueueThreadHandler.dispatchMessage(MessageQueueThreadHandler.kt:20) \n    at android.os.Looper.loopOnce(Looper.java:211) \n    at android.os.Looper.loop(Looper.java:300) \n    at com.facebook.react.bridge.queue.MessageQueueThreadImpl$Companion.startNewBackgroundThread$lambda$1(MessageQueueThreadImpl.kt:175) \n    at com.facebook.react.bridge.queue.MessageQueueThreadImpl$Companion.$r8$lambda$ldnZnqelhYFctGaUKkOKYj5rxo4(Unknown Source:0) \n    at com.facebook.react.bridge.queue.MessageQueueThreadImpl$Companion$$ExternalSyntheticLambda0.run(D8$$SyntheticClass:0) \n    at java.lang.Thread.run(Thread.java:1012) \nCaused by: java.lang.AssertionError: Root node with tag 31 doesn't exist\n    at com.facebook.infer.annotation.Assertions.assertNotNull(Assertions.java:19)\n    at com.facebook.react.uimanager.UIImplementation.createView(UIImplementation.java:251)\n    at com.facebook.react.uimanager.UIManagerModule.createView(UIManagerModule.java:438)\n    at java.lang.reflect.Method.invoke(Native Method) \n    at com.facebook.react.bridge.JavaMethodWrapper.invoke(JavaMethodWrapper.java:372) \n    at com.facebook.react.bridge.JavaModuleWrapper.invoke(JavaModuleWrapper.java:146) \n    at com.facebook.jni.NativeRunnable.run(Native Method) \n    at android.os.Handler.handleCallback(Handler.java:942) \n    at android.os.Handler.dispatchMessage(Handler.java:99) \n    at com.facebook.react.bridge.queue.MessageQueueThreadHandler.dispatchMessage(MessageQueueThreadHandler.kt:20) \n    at android.os.Looper.loopOnce(Looper.java:211) \n    at android.os.Looper.loop(Looper.java:300) \n    at com.facebook.react.bridge.queue.MessageQueueThreadImpl$Companion.startNewBackgroundThread$lambda$1(MessageQueueThreadImpl.kt:175) \n    at com.facebook.react.bridge.queue.MessageQueueThreadImpl$Companion.$r8$lambda$ldnZnqelhYFctGaUKkOKYj5rxo4(Unknown Source:0) \n    at com.facebook.react.bridge.queue.MessageQueueThreadImpl$Companion$$ExternalSyntheticLambda0.run(D8$$SyntheticClass:0) \n    at java.lang.Thread.run(Thread.java:1012) \n</code></pre>\n<p>Therefore, I switch to ReactActivity, just like MainActivity:</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>import com.facebook.react.ReactActivity\nimport com.facebook.react.ReactHost\nimport com.facebook.react.defaults.DefaultReactHost\n\nclass NewMiniAppActivity : ReactActivity() {\n    private val TAG = &quot;MiniAppActivity&quot;\n\n    override fun getMainComponentName(): String = &quot;MiniApp&quot; // must match AppRegistry.registerComponent()\n\n    override fun getReactHost(): ReactHost {\n        val app = application as MainApplication\n        return DefaultReactHost.getDefaultReactHost(applicationContext, app.miniReactNativeHost)\n    }\n}\n</code></pre>\n<p>This implementation throws another runtime error:</p>\n<pre class=\"lang-none prettyprint-override\"><code>FATAL EXCEPTION: mqt_v_native\nProcess: com.myapp.local, PID: 17008\ncom.facebook.react.common.JavascriptException: Invariant Violation: &quot;MiniApp&quot; has not been registered. This can happen if:\n* Metro (the local dev server) is run from the wrong folder. Check if Metro is running, stop it and restart it in the current project.\n* A module failed to load due to an error and `AppRegistry.registerComponent` wasn't called., js engine: hermes, stack:\ninvariant@1:49453\nrunApplication@1:336716\n\n    at com.facebook.react.modules.core.ExceptionsManagerModule.reportException(ExceptionsManagerModule.kt:52)\n    at com.facebook.jni.NativeRunnable.run(Native Method)\n    at android.os.Handler.handleCallback(Handler.java:942)\n    at android.os.Handler.dispatchMessage(Handler.java:99)\n    at com.facebook.react.bridge.queue.MessageQueueThreadHandler.dispatchMessage(MessageQueueThreadHandler.kt:20)\n    at android.os.Looper.loopOnce(Looper.java:211)\n    at android.os.Looper.loop(Looper.java:300)\n    at com.facebook.react.bridge.queue.MessageQueueThreadImpl$Companion.startNewBackgroundThread$lambda$1(MessageQueueThreadImpl.kt:175)\n    at com.facebook.react.bridge.queue.MessageQueueThreadImpl$Companion.$r8$lambda$ldnZnqelhYFctGaUKkOKYj5rxo4(Unknown Source:0)\n    at com.facebook.react.bridge.queue.MessageQueueThreadImpl$Companion$$ExternalSyntheticLambda0.run(D8$$SyntheticClass:0)\n    at java.lang.Thread.run(Thread.java:1012)\n</code></pre>\n<p>I tried many ways but the result is still the same. However, if I change the component name from &quot;MiniApp&quot; to the name of the main app, the new activity stop throwing crashes since the default bundle is used. This make me think the overridden method <code>getReactHost</code> in the subclass of <code>ReactActivity</code> did not take affect.</p>\n<p>I check the class <code>ReactActivity</code> and see this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public abstract class ReactActivity extends AppCompatActivity implements DefaultHardwareBackBtnHandler, PermissionAwareActivity {\n    private final ReactActivityDelegate mDelegate = this.createReactActivityDelegate();\n\n    protected ReactActivity() {\n    }\n\n    @Nullable\n    protected String getMainComponentName() {\n        return null;\n    }\n\n    protected ReactActivityDelegate createReactActivityDelegate() {\n        return new ReactActivityDelegate(this, this.getMainComponentName());\n    }\n</code></pre>\n<p>ChatGPT suggests that the <code>ReactActivityDelegate</code> is created at super class initiation, making whatever I override at my subclass not work.</p>\n<p>Has anyone tried doing such thing before? Please share if you know something!</p>\n<p>PS: It looks like <code>ReactActivity</code> is required in new arch. I ran into an error saying such thing when using Activity or AppCompatActivity, but I forgot to capture the stacktrace.</p>\n",
    "tags" : [ "java", "android", "react-native", "kotlin", "react-android" ],
    "owner" : {
      "account_id" : 24201645,
      "reputation" : 75,
      "user_id" : 18159393,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AATXAJziJ1qb1D-SHv0-VLk_85tsnnyzjWGUcLIDJaa1=k-s256",
      "display_name" : "Ho&#224;i Vũ L&#234;",
      "link" : "https://stackoverflow.com/users/18159393/ho%c3%a0i-v%c5%a9-l%c3%aa"
    },
    "is_answered" : false,
    "view_count" : 73,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1760171988,
    "creation_date" : 1760147573,
    "link" : "https://stackoverflow.com/questions/79787770/adding-new-reactactivity-to-run-another-js-bundle",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}