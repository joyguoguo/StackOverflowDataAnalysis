{
  "question" : {
    "question_id" : 79553328,
    "title" : "Error initializing database using Quarkus",
    "body" : "<p>Here's the error stack trace:</p>\n<pre><code>Caused by: java.lang.IllegalStateException: No current Vertx context found\n    at io.quarkus.hibernate.reactive.panache.common.runtime.SessionOperations.vertxContext(SessionOperations.java:191)\n    at io.quarkus.hibernate.reactive.panache.common.runtime.SessionOperations.getSession(SessionOperations.java:141)\n    at io.quarkus.hibernate.reactive.panache.common.runtime.AbstractJpaOperations.getSession(AbstractJpaOperations.java:368)\n    at io.quarkus.hibernate.reactive.panache.common.runtime.AbstractJpaOperations.count(AbstractJpaOperations.java:215)\n</code></pre>\n<p>The UserGroup class extends PanacheEntityBase, and that's when this issue occurred. I'm not sure how to resolve it. Can anyone offer some advice or solutions?</p>\n<pre><code>@ApplicationScoped\npublic class LifecycleBean {\n\n    @Startup\n    public Uni&lt;Void&gt; initialize() {\n        return initDefaultUserGroup();\n    }\n\n\n    private Uni&lt;Void&gt; initDefaultUserGroup() {\n        Log.info(&quot;------------- init DefaultUserGroup -------------&quot;);\n        Uni&lt;Long&gt; count = UserGroup.count(&quot;select count(id) from UserGroup where userGroupType = 'ADMIN'&quot;);\n        count.onItem().transformToUni(e-&gt;{\n            if (e == 0) {\n                UserGroup userGroup = new UserGroup();\n                userGroup.userGroupType = UserGroup.UserGroupType.ADMIN;\n                return UserGroup.persist(userGroup).replaceWithVoid();\n            } else if (e &gt; 1) {\n                throw new RuntimeException(&quot;admin group count is greater than 1 !&quot;);\n            }\n            return null;\n        }).subscribe();\n        return null;\n    }\n\n}\n</code></pre>\n<p>I tried a few things but couldn't work it out, I had never used reactive before</p>\n",
    "tags" : [ "java", "quarkus", "vert.x", "reactive", "quarkus-panache" ],
    "owner" : {
      "account_id" : 26875342,
      "reputation" : 1,
      "user_id" : 20456676,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/922d8804acecec4631e00f9fbfe44f05?s=256&d=identicon&r=PG",
      "display_name" : "lsd",
      "link" : "https://stackoverflow.com/users/20456676/lsd"
    },
    "is_answered" : false,
    "view_count" : 90,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1743773016,
    "creation_date" : 1743693009,
    "link" : "https://stackoverflow.com/questions/79553328/error-initializing-database-using-quarkus",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79555442,
    "question_id" : 79553328,
    "body" : "<pre><code>@ApplicationScoped\npublic class StartupInitializer {\n\n    @Inject\n    Mutiny.SessionFactory sessionFactory;\n\n    void onStart(@Observes StartupEvent ev) {\n        sessionFactory.withTransaction(session -&gt;\n                UserGroup.count()\n                        .chain(count -&gt; {\n                            if (count == 0) {\n                                UserGroup defaultGroup = new UserGroup();\n                                defaultGroup.groupName = &quot;Default Group&quot;;\n  \n\n                                return session.persist(defaultGroup)\n                                        .replaceWith(defaultGroup);\n                            }\n                            return Uni.createFrom().nullItem();\n                        })\n        ).subscribe().with(\n                result -&gt; System.out.println(&quot;Initialization completed&quot;),\n                Throwable::printStackTrace\n        );\n    }\n}\n</code></pre>\n<p>After unsuccessful attempts through multiple channels, the technical challenge was ultimately resolved by consulting DeepSeek's AI assistant. Gratitude is extended to both the platform and all contributors involved.\uD83E\uDD70\uD83E\uDD70\uD83E\uDD70\uD83E\uDD70</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 26875342,
      "reputation" : 1,
      "user_id" : 20456676,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/922d8804acecec4631e00f9fbfe44f05?s=256&d=identicon&r=PG",
      "display_name" : "lsd",
      "link" : "https://stackoverflow.com/users/20456676/lsd"
    },
    "creation_date" : 1743773016,
    "last_activity_date" : 1743773016,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140295557,
    "post_id" : 79553328,
    "body" : "database session and/or transaction is missing in the current thread. You must make sure, your operations are wrapped into transaction. I don&#39;t know how it&#39;s done in Quarkus, but pretty sure you have to annotate your method with <code>@Transactional</code>",
    "score" : 0,
    "owner" : {
      "account_id" : 1857554,
      "reputation" : 20801,
      "user_id" : 1682820,
      "user_type" : "registered",
      "accept_rate" : 70,
      "profile_image" : "https://i.sstatic.net/z9bzH.png?s=256",
      "display_name" : "injecteer",
      "link" : "https://stackoverflow.com/users/1682820/injecteer"
    },
    "creation_date" : 1743693815,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}