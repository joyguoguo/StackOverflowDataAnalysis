{
  "question" : {
    "question_id" : 79568683,
    "title" : "Keycloak Token generation from RealmResourceProvider",
    "body" : "<p>Im trying to generate a token in the keycloak spi with realmResourceProvider.Any ideas on how to do it? Simply,how to generate a token in the spi.</p>\n<pre><code>        JsonWebToken token = new JsonWebToken(); // Use base class\n        token.id(UUID.randomUUID().toString()); // JTI (unique token ID)\n        token.type(TokenUtil.TOKEN_TYPE_JWT_ACCESS_TOKEN); // Explicitly set type\n        token.issuer(Urls.realmIssuer(session.getContext().getUri().getBaseUri(), realm.getName())); // ISS (Realm issuer URL)\n        token.subject(user.getId()); // SUB (User ID)\n        token.audience(Urls.realmIssuer(session.getContext().getUri().getBaseUri(), realm.getName())); // AUD (Often same as issuer)\n        token.iat(issuedAtTime); // IAT\n        token.exp(expirationTime); // EXP\n        token.nbf(issuedAtTime); // NBF (optional, usually same as iat)\n\n\n        KeyWrapper keyWrapper = session.keys().getActiveKey(realm, KeyUse.SIG, realm.getDefaultSignatureAlgorithm());\n        if (keyWrapper == null) {\n            throw new InternalServerErrorException(&quot;No active signing key found for realm &quot; + realm.getName());\n        }\n        String algorithm = keyWrapper.getAlgorithmOrDefault();\n        String kid = keyWrapper.getKid();\n\n        \n        SignatureProvider signatureProvider = session.getProvider(SignatureProvider.class, algorithm);\n        if (signatureProvider == null) {\n            throw new InternalServerErrorException(&quot;Signature provider not found for algorithm: &quot; + algorithm);\n        }\n        SignatureSignerContext signer = signatureProvider.signer(keyWrapper);\n\n       \n        String encodedToken = new JWSBuilder()\n                .kid(kid)\n                .type(&quot;JWT&quot;) // JWS header type\n                .jsonContent(token) // Set the claims using the JsonWebToken object\n                .sign(signer); // Sign using the provider and key\n\n        return encodedToken;\n</code></pre>\n",
    "tags" : [ "java", "jwt", "keycloak", "access-token", "keycloak-spi" ],
    "owner" : {
      "account_id" : 27475924,
      "reputation" : 1,
      "user_id" : 20963914,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AEdFTp5xdsbvddTj5ZEhF0agtSkpvpTD7QuseHYS3sc-=k-s256",
      "display_name" : "NANDAKUMAR A",
      "link" : "https://stackoverflow.com/users/20963914/nandakumar-a"
    },
    "is_answered" : false,
    "view_count" : 32,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1744369634,
    "creation_date" : 1744369605,
    "link" : "https://stackoverflow.com/questions/79568683/keycloak-token-generation-from-realmresourceprovider",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}