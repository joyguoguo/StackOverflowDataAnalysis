{
  "question" : {
    "question_id" : 79829457,
    "title" : "Constructor-based dependency injection fails when requesting bean via beanFactory.getBean(Command.class, dto) in Spring Boot",
    "body" : "<p>I'm migrating from field injection (<code>@Autowired</code>) to constructor-based injection in a Spring Boot application (Java 21), but I'm running into a <code>BeanCreationException</code> when Spring tries to instantiate my command object.</p>\n<hr />\n<p>The only dependency that Spring should autowire is the <code>Service</code>.</p>\n<p>The DTO is <em>not</em> a Spring bean and must be provided manually by the controller, which is why I retrieve the command with:</p>\n<pre><code>beanFactory.getBean(Command.class, inputDto);\n</code></pre>\n<p>With field injection everything works, because Spring injects only the <code>Service</code> through the <code>@Autowired</code> annotation and I set the DTO afterward.</p>\n<p>When I switch to constructor injection (marking dependencies as <code>final</code>), Spring can no longer find a matching constructor, since it tries to autowire both parameters (including the DTO, which is not a bean) and this results in a <code>BeanCreationException</code>.</p>\n<pre><code>org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'exampleCommand' defined in file [...\\example-project\\target\\diraliases\\OPENSHIFT\\classes\\com\\examplepackage\\command\\ExampleCommand.class]: Could not resolve matching constructor on bean class [com.examplepackage.command.ExampleCommand] (hint: specify index/type/name arguments for simple parameters to avoid type ambiguities. You should also check the consistency of arguments when mixing indexed and named arguments, especially in case of bean definition inheritance)\n    at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:291)\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1395)\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1232)\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:569)\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529)\n    at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:357)\n    at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:227)\n    at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveNamedBean(DefaultListableBeanFactory.java:1613)\n    at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveNamedBean(DefaultListableBeanFactory.java:1571)\n    at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveBean(DefaultListableBeanFactory.java:564)\n    at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:393)\n    at com.examplepackage.controller.ExampleController.exampleApi(ExampleController.java:26)\n    [...]\n\n</code></pre>\n<p>It seems like Spring cannot decide which constructor to use, or is unable to resolve the parameters (the DTO parameter is dynamic, the service is a Spring bean).</p>\n<p>Below are the code snippets:</p>\n<p><strong>Controller:</strong></p>\n<pre><code>@RequiredArgsConstructor\n@RestController\n@RequestMapping(value = &quot;/api&quot;, produces = {MediaType.APPLICATION_JSON_VALUE, &quot;application/hal+json&quot;})\npublic class ExampleController {\n\n    private final BeanFactory beanFactory;\n\n    @PostMapping(path = &quot;/exampleApi&quot;)\n    public ResponseEntity&lt;String&gt; exampleApi(@RequestBody String stringDTO) throws Exception {\n\n        ExampleCommand command = beanFactory.getBean(ExampleCommand.class, new ExampleDto(stringDTO));\n        String resource = command.execute();\n\n        return ok(resource);\n    }\n}\n</code></pre>\n<p><strong>Command:</strong></p>\n<pre><code>@Component\n@Scope(BeanDefinition.SCOPE_PROTOTYPE)\npublic class ExampleCommand {\n    private final ExampleDto exampleDto;\n    private final ExampleService exampleService;\n\n    public ExampleCommand(ExampleDto exampleDto, ExampleService exampleService) {\n        this.exampleDto = exampleDto;\n        this.exampleService = exampleService;\n    }\n\n    public String execute() {return exampleService.exampleMethod(exampleDto);}\n}\n</code></pre>\n<p><strong>Service:</strong></p>\n<pre><code>@Service\npublic class ExampleService {\n    public String exampleMethod(ExampleDto exampleDto) {\n        return String.join(exampleDto.value(), &quot;-joined&quot;);\n    }\n}\n</code></pre>\n<p><strong>DTO:</strong></p>\n<pre><code>public record ExampleDto(String value) {}\n</code></pre>\n<h3><strong>What I expect</strong></h3>\n<p>Spring should use the constructor that takes the service bean + the DTO passed in <code>getBean(...)</code>, without requiring <code>@Autowired</code> on <code>ExampleService</code>.</p>\n<h3><strong>What actually happens</strong></h3>\n<p>Spring fails to resolve the constructor and throws the exception above.</p>\n<h3><strong>Question</strong></h3>\n<p>What am I doing wrong? How can I properly structure my constructor so that Spring can inject the service bean and accept the DTO (which is not a Bean) as a runtime parameter when using <code>beanFactory.getBean(Command.class, dto)</code>?<br />\nDo I need <code>@Autowired</code> on a specific constructor, or should I use another pattern?</p>\n",
    "tags" : [ "java", "spring", "dependency-injection", "autowired" ],
    "owner" : {
      "account_id" : 10473648,
      "reputation" : 1,
      "user_id" : 7720836,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c53d29fe41c6768da0fd04e4cdf4ac42?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Andrea",
      "link" : "https://stackoverflow.com/users/7720836/andrea"
    },
    "is_answered" : false,
    "view_count" : 67,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1764151408,
    "creation_date" : 1764060477,
    "link" : "https://stackoverflow.com/questions/79829457/constructor-based-dependency-injection-fails-when-requesting-bean-via-beanfactor",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140873894,
    "post_id" : 79829457,
    "body" : "@M.Deinum I have updated the question. In the meantime, thank you for your advice!",
    "score" : 0,
    "owner" : {
      "account_id" : 10473648,
      "reputation" : 1,
      "user_id" : 7720836,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c53d29fe41c6768da0fd04e4cdf4ac42?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Andrea",
      "link" : "https://stackoverflow.com/users/7720836/andrea"
    },
    "creation_date" : 1764151792,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140872378,
    "post_id" : 79829457,
    "body" : "That being said the only solution that I can see working is create an <code>@Configuration</code> with an <code>@Bean</code> method that only takes your DTO and the rest is either injected into the configuration class or done by a lookup.",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126777,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1764082010,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140872364,
    "post_id" : 79829457,
    "body" : "Can you clarify that in your question as that isn&#39;t what I initially assumed (that was both fields as <code>@Autowired</code> instead of just 1).",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126777,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1764081372,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140872347,
    "post_id" : 79829457,
    "body" : "@M.Deinum Exactly, this is the problem. The only way I can get it to work is to put <code>@Autowired</code> above the service, leave the DTO as <code>public final</code> and create the constructor only for the DTO.  The question is this: how can I transform my class using &quot;constructor injection&quot; (by removing <code>@Autowired</code> from the Service(s))?",
    "score" : 0,
    "owner" : {
      "account_id" : 10473648,
      "reputation" : 1,
      "user_id" : 7720836,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c53d29fe41c6768da0fd04e4cdf4ac42?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Andrea",
      "link" : "https://stackoverflow.com/users/7720836/andrea"
    },
    "creation_date" : 1764080986,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140871883,
    "post_id" : 79829457,
    "body" : "When I switch your sample to field injection it doesn&#39;t work either. I can only get it to work with constructor injection if you provide all dependencies (so including the service) or make the service field injection and the provided constructor only takes the <code>ExampleDto</code>.",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126777,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1764065615,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140871856,
    "post_id" : 79829457,
    "body" : "You can use <code>getBean</code> with manually provided dependencies for Spring to inject. Hence the <code>getBean(Class, Object... args)</code> method on the <code>BeanFactory</code>/<code>ApplicationContext</code>.",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126777,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1764064748,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140871849,
    "post_id" : 79829457,
    "body" : "how do you expect it to find a Bean of ExampleDTO? That doesn&#39;t seem to be a Spring component/service/.... that is why &#39;new ExampleDTO(...)&#39; does work",
    "score" : 0,
    "owner" : {
      "account_id" : 3116234,
      "reputation" : 9469,
      "user_id" : 2636929,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/85fa83a02c04af43fcd224821ca9b750?s=256&d=identicon&r=PG",
      "display_name" : "Stultuske",
      "link" : "https://stackoverflow.com/users/2636929/stultuske"
    },
    "creation_date" : 1764064449,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140871823,
    "post_id" : 79829457,
    "body" : "@M.Deinum Thank you, I have added the complete stack trace.",
    "score" : 0,
    "owner" : {
      "account_id" : 10473648,
      "reputation" : 1,
      "user_id" : 7720836,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c53d29fe41c6768da0fd04e4cdf4ac42?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Andrea",
      "link" : "https://stackoverflow.com/users/7720836/andrea"
    },
    "creation_date" : 1764063638,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140871747,
    "post_id" : 79829457,
    "body" : "Please include the full stacktrace / error. You cleaned it up removing valuable information needed for answering the question.",
    "score" : 1,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126777,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1764061377,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}