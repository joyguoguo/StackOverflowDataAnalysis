{
  "question" : {
    "question_id" : 79831506,
    "title" : "How to fail at startup in Spring Boot 4 if the base-url property is not set?",
    "body" : "<p>With Spring Boot 3, I created a <code>@ConfigurationProperties</code> record with <code>@NotBlank</code> validation to manually set the base URL on the <code>RestClient</code> that is passed to the <code>HttpServiceProxyFactory</code> For example:</p>\n<pre><code>@Validated\n@ConfigurationProperties(prefix = &quot;myapp&quot;)\npublic record MyAppProperties(@NotBlank String myRemoteApiBaseUrl){}\n</code></pre>\n<p>With the <a href=\"https://docs.spring.io/spring-framework/reference/7.0/integration/rest-clients.html#rest-http-service-client\" rel=\"nofollow noreferrer\">Spring Boot 4 HTTP Service Client</a>, there is no need anymore to manually create the <code>RestClient</code> and <code>HttpServiceProxyFactory</code>. The recommended way is to set the base url via:</p>\n<pre class=\"lang-yaml prettyprint-override\"><code>spring:\n  http:\n    serviceclient:\n      my-remote-api:\n        base-url: 'https://www.my-remote-api'\n</code></pre>\n<p>However, if the <code>base-url</code> is not set, the application will not be able to make the remote call, and an <code>IllegalArgumentException</code> is thrown when a call is actually tried. I would like to have the application already fail at startup when the <code>base-url</code> was forgotten to be configured.</p>\n",
    "tags" : [ "java", "spring", "spring-boot" ],
    "owner" : {
      "account_id" : 17750,
      "reputation" : 27240,
      "user_id" : 40064,
      "user_type" : "registered",
      "accept_rate" : 69,
      "profile_image" : "https://www.gravatar.com/avatar/6f118f710d3077f91c0c0d722f7be0a3?s=256&d=identicon&r=PG",
      "display_name" : "Wim Deblauwe",
      "link" : "https://stackoverflow.com/users/40064/wim-deblauwe"
    },
    "is_answered" : true,
    "view_count" : 134,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1764258529,
    "creation_date" : 1764232632,
    "link" : "https://stackoverflow.com/questions/79831506/how-to-fail-at-startup-in-spring-boot-4-if-the-base-url-property-is-not-set",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79831592,
    "question_id" : 79831506,
    "body" : "<p>Looking at the code of the <a href=\"https://docs.spring.io/spring-boot/api/java/org/springframework/boot/restclient/autoconfigure/service/HttpServiceClientAutoConfiguration.html\" rel=\"nofollow noreferrer\"><code>HttpServiceClientAutoConfiguration</code></a> there is the <a href=\"https://docs.spring.io/spring-boot/api/java/org/springframework/boot/http/client/autoconfigure/service/HttpServiceClientProperties.html\" rel=\"nofollow noreferrer\"><code>HttpServiceClientProperties</code></a> which contains all the client configurations. You could create an <code>@Configuration</code> class which obtains the <code>HttpServiceClientProperties</code> and iterates over all the keys/values in the properties to check the presence of the <code>base-url</code>.</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Configuration\npublic class HttpServiceClientValidatingConfig implements InitializingBean {\n\n  private final HttpServiceClientProperties props;\n\n  HttpServiceClientValidatingConfig(HttpServiceClientProperties props) {\n    this.props = props;\n  }\n\n  public void afterPropertiesSet() {\n    var missing = new ArrayList&lt;String&gt;();\n    for (var prop : props.entrySet() ) {\n      var name = prop.getKey();\n      var clientProps = prop.getValue();\n      if (StringUtils.isEmpty(clientProps.getBaseUrl()) {\n        missing.add(&quot;spring.http.service-client.&quot; + name + &quot;.base-url&quot;);\n      }\n    }\n\n    if (!missing.isEmpty()) {\n      throw new IllegalStateException(&quot;Required properties not set! (&quot; + missing + &quot;)&quot;);\n    }\n  }\n}\n</code></pre>\n<p>Something along those lines.</p>\n<p>Based on my comment, you could probably write something like this as wel.</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Configuration\n@Validated\n@HttpServiceClientValidatingConfig.ValidateRequiredProperties\npublic class HttpServiceClientValidatingConfig {\n\n  private final HttpServiceClientProperties props;\n\n  HttpServiceClientValidatingConfig(HttpServiceClientProperties props) {\n    this.props = props;\n  }\n\n  HttpServiceClientProperties getProps() {\n    return props;\n  }\n\n  @Target({ElementType.TYPE})\n  @Retention(RetentionPolicy.RUNTIME)\n  @Constraint(validatedBy = ValidateRequiredPropertiesValidator.class)\n  @Documented\n  public static @interface ValidateRequiredProperties {\n    String message() default &quot;{jakarta.validation.constraints.NotBlank.message}&quot;;\n    Class&lt;?&gt;[] groups() default {};\n    Class&lt;? extends Payload&gt;[] payload() default {};\n  }\n\n  public static class ValidateRequiredPropertiesValidator\n      implements ConstraintValidator&lt;ValidateRequiredProperties, HttpServiceClientValidatingConfig&gt; {\n\n    private String message;\n\n    @Override\n    public void initialize(ValidateRequiredProperties ca) {\n      this.message = ca.message();\n    }\n\n    @Override\n    public boolean isValid(HttpServiceClientValidatingConfig httpServiceClientValidatingConfig, ConstraintValidatorContext ctx) {\n      var props = httpServiceClientValidatingConfig.getProps();\n      var valid = true;\n      for (var prop : props.entrySet()) {\n        var name = prop.getKey();\n        var value = prop.getValue();\n        var url = value.getBaseUrl();\n        if (ObjectUtils.isEmpty(url)) {\n          valid = false;\n          ctx.buildConstraintViolationWithTemplate(this.message)\n              .addPropertyNode(&quot;spring.http.service-client.&quot; + name + &quot;.base-url&quot;)\n              .addConstraintViolation().disableDefaultConstraintViolation();\n        }\n      }\n      return valid;\n    }\n  }\n}\n</code></pre>\n<p>This would integrate with the regular validation cycle and handling.</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126777,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1764237681,
    "last_activity_date" : 1764258529,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140876108,
    "post_id" : 79831506,
    "body" : "I wonder what the trigger for the actually failure is. If it is due to a ConditionalOnProperty for RestClient then you can make it fail by creating a bean that runs on startup and injecting the RestClient into it. That way you don&#39;t have to manually check for properties, you can let Spring care about it. If the property is changed in the future, your code won&#39;t care.",
    "score" : 0,
    "owner" : {
      "account_id" : 187094,
      "reputation" : 5301,
      "user_id" : 424903,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/8oHZF.png?s=256",
      "display_name" : "Gimby",
      "link" : "https://stackoverflow.com/users/424903/gimby"
    },
    "creation_date" : 1764246749,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140875864,
    "post_id" : 79831506,
    "body" : "Maybe something like an <code>EnvironmentPostProcessor</code> could help? Iterate over all properties and check if they match the pattern <code>spring.http.serviceclient.*.base-url</code> or are within <code>spring.http.serviceclient.*</code> and are missing a base-url. Throw an exception if it is empty/missing/invalid?",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126777,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1764236937,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79831592" : [ {
      "comment_id" : 140876306,
      "post_id" : 79831592,
      "body" : "@WimDeblauwe You can ofcourse change the message <b>or</b> the exception that is being thrown. Another option could be to write a dedicated class level validator which does the validation. This should give you better error messages and probably taps into the <code>FailureAnalyzer</code> feature as well.",
      "score" : 0,
      "owner" : {
        "account_id" : 3192259,
        "reputation" : 126777,
        "user_id" : 2696260,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
        "display_name" : "M. Deinum",
        "link" : "https://stackoverflow.com/users/2696260/m-deinum"
      },
      "creation_date" : 1764256139,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140876235,
      "post_id" : 79831592,
      "body" : "That works fine and has the added advantage that it will work for all defined properties automatically. The solution of Javad Mahdioun is also nice (And it gives a nicer error message), but you have to do it for every client separately.",
      "score" : 1,
      "owner" : {
        "account_id" : 17750,
        "reputation" : 27240,
        "user_id" : 40064,
        "user_type" : "registered",
        "accept_rate" : 69,
        "profile_image" : "https://www.gravatar.com/avatar/6f118f710d3077f91c0c0d722f7be0a3?s=256&d=identicon&r=PG",
        "display_name" : "Wim Deblauwe",
        "link" : "https://stackoverflow.com/users/40064/wim-deblauwe"
      },
      "creation_date" : 1764252443,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}