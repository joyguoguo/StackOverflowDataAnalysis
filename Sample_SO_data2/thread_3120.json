{
  "question" : {
    "question_id" : 79572763,
    "title" : "Rescheduling a task within the handler with db-scheduler java",
    "body" : "<pre><code>class TaskData {\n    int id;\n    String status;\n}\n\nclass TaskDbScheduler() {\n     private final SchedulerClient schedulerClient;\n    private final OneTimeTask&lt;TaskData&gt; oenTimeTask;\n    public TaskInstance&lt;TaskData&gt; schedule(TaskData taskData) {\n        Instant nextExecutionTime = taskData.getNextAttempt();\n        TaskInstance&lt;TaskData&gt; instance =\n                oenTimeTask.instance(taskData.getId()(), taskData);\n        boolean scheduled = schedulerClient.scheduleIfNotExists(instance, nextExecutionTime);\n        return instance;\n    }\n}\n\nclass TaskHandler{\n    TaskDbScheduler scheduler; // causes circular dependency\n\n    void handle(TaskInstance&lt;TaskData&gt; taskInstance, ExecutionContext executionContext) {\n        var read = xyzservice.run(taskInstance.getData());\n\n        if(read == fail) {\n            // reschedule it after two seconds, with taskdata.toBuilder().status(&quot;delayed&quot;).build();\n        \n        }\n    }\n}\n</code></pre>\n<p>I am using <a href=\"https://github.com/kagkarlsson/db-scheduler\" rel=\"nofollow noreferrer\">db-scheduler</a> 15.3.0.</p>\n<p>I am trying to reschedule a task within the handler on some conditions but it always end up in a circular dependency error. Using SchedulerClient directly in the handler also does not provide the functionality to alter taskdata. Is there a way to reschdule a task this way?</p>\n",
    "tags" : [ "java", "database", "scheduler" ],
    "owner" : {
      "account_id" : 1215703,
      "reputation" : 1187,
      "user_id" : 1183348,
      "user_type" : "registered",
      "accept_rate" : 47,
      "profile_image" : "https://www.gravatar.com/avatar/6d1825740544384f1055739e09707689?s=256&d=identicon&r=PG",
      "display_name" : "Thunfische",
      "link" : "https://stackoverflow.com/users/1183348/thunfische"
    },
    "is_answered" : false,
    "view_count" : 114,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1763981489,
    "creation_date" : 1744621991,
    "link" : "https://stackoverflow.com/questions/79572763/rescheduling-a-task-within-the-handler-with-db-scheduler-java",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79828535,
    "question_id" : 79572763,
    "body" : "<p>You can't do that with OneTimeTasks, you'll have to use a CustomTask and return a CompletionHandler from your execute method that defines if and when the Task should be rescheduled.</p>\n<p>Something like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>    public CompletionHandler&lt;TaskData&gt; execute(TaskInstance&lt;TaskData&gt; taskInstance, ExecutionContext executionContext) {\n        var read = xyzservice.run(taskInstance.getData());\n\n        if(read == fail) {\n            return return new CompletionHandler.OnCompleteReschedule&lt;&gt;(FixedDelay.of(Duration.ofSeconds(2)), taskdata.toBuilder().status(&quot;delayed&quot;).build());\n        \n        }\n        return new CompletionHandler.OnCompleteRemove&lt;&gt;();\n    }\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 348076,
      "reputation" : 5585,
      "user_id" : 682559,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://i.sstatic.net/6A6mQ.jpg?s=256",
      "display_name" : "Nicktar",
      "link" : "https://stackoverflow.com/users/682559/nicktar"
    },
    "creation_date" : 1763981489,
    "last_activity_date" : 1763981489,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140332642,
    "post_id" : 79572763,
    "body" : "<i>circular dependency error</i> sounds like something that your IDE would report since, as far as I am aware, it is <b>not</b> a compiler error nor a runtime error. What IDE are you using? Can you <a href=\"https://stackoverflow.com/posts/79572763/edit\">edit</a> your question and write which [Java] classes have this circular dependency? In the code in your question, I see that class <code>TaskHandler</code> references class <code>TaskDbScheduler</code>, however I don&#39;t see whether class <code>TaskDbScheduler</code> references class <code>TaskHandler</code>. Did I miss something?",
    "score" : 0,
    "owner" : {
      "account_id" : 2485939,
      "reputation" : 20969,
      "user_id" : 2164365,
      "user_type" : "registered",
      "accept_rate" : 40,
      "profile_image" : "https://i.sstatic.net/RKSgV.png?s=256",
      "display_name" : "Abra",
      "link" : "https://stackoverflow.com/users/2164365/abra"
    },
    "creation_date" : 1744631131,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}