{
  "question" : {
    "question_id" : 79667302,
    "title" : "Inserting records to two related tables at the same time with Hibernate",
    "body" : "<p>I was unable to insert data into two related tables at the same time. For example I wanted to insert 5 records into the <code>pictures</code> table and 1 record to the <code>listings</code> table at the same time.</p>\n<p>I have the sub-entity:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Entity\n@Getter\n@Setter\n@Table(name = &quot;pictures&quot;)\npublic class PictureEntity {\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Integer id;\n\n    @Column(columnDefinition = &quot;VARCHAR(1000)&quot;, nullable = false)\n    private String url;\n\n    @ManyToOne(targetEntity = ListingEntity.class)\n    @JoinColumn(name = &quot;listing_id&quot;, updatable = false, insertable = false, nullable = false)\n    private ListingEntity listing;\n}\n</code></pre>\n<p>The main entity:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Entity\n@Getter\n@Setter\n@Table(name = &quot;listings&quot;)\npublic class ListingEntity {\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Integer id;\n\n    @Column(name = &quot;update_date_time&quot;, nullable = true)\n    @Temporal(TemporalType.TIMESTAMP)\n    private Instant updateDateTime;\n\n    @OneToMany(mappedBy = &quot;listing&quot;, cascade = CascadeType.REMOVE)\n    private List&lt;PictureEntity&gt; pictures;\n}\n</code></pre>\n<p>When I try this</p>\n<pre class=\"lang-java prettyprint-override\"><code>pictures.forEach(picture -&gt; {\n    PictureEntity pictureEntity = new PictureEntity();\n    pictureEntity.setUrl(picture);\n    pictureEntities.add(pictureEntity);\n});\nlistingEntity.setPictures(pictureEntities);\n</code></pre>\n<p>and then <code>listingRepository.save(listingEntity);</code> no data is saved into the <code>pictures</code> table.</p>\n<p>If I change <code>insertable</code> into <code>true</code> then I get the following error:</p>\n<blockquote>\n<p>Column 'listing_id' is duplicated in mapping for entity 'com.example.listings.entity.PictureEntity' (use '@Column(insertable=false, updatable=false)' when mapping multiple properties to the same column</p>\n</blockquote>\n<p>What I am doing wrong?</p>\n",
    "tags" : [ "java", "spring-boot", "hibernate", "insert" ],
    "owner" : {
      "account_id" : 83131,
      "reputation" : 9085,
      "user_id" : 233286,
      "user_type" : "registered",
      "accept_rate" : 73,
      "profile_image" : "https://i.sstatic.net/0ivuN.jpg?s=256",
      "display_name" : "ilhan",
      "link" : "https://stackoverflow.com/users/233286/ilhan"
    },
    "is_answered" : true,
    "view_count" : 84,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1750079103,
    "creation_date" : 1750063915,
    "link" : "https://stackoverflow.com/questions/79667302/inserting-records-to-two-related-tables-at-the-same-time-with-hibernate",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79667494,
    "question_id" : 79667302,
    "body" : "<p>The Listing has Cascadetype.REMOVE. This means only that if you delete your listing, all associated pictures get deleted too. For your use case you need CascadeType.PERSIST or .ALL.</p>\n<pre><code>    @OneToMany(mappedBy = &quot;listing&quot;, cascade = CascadeType.ALL)\n    private List&lt;PictureEntity&gt; pictures;\n</code></pre>\n<p>If you still have problems you should also check your DB if your foreign keys and references are defined correctly and with correct names.</p>\n<p>Here is a simple but good introduction into the cascade types and how they interact with hibernate lifecycle:</p>\n<p><a href=\"https://medium.com/@himani.prasad016/jpa-hibernate-cascade-types-0490be19cc1f\" rel=\"nofollow noreferrer\">https://medium.com/@himani.prasad016/jpa-hibernate-cascade-types-0490be19cc1f</a></p>\n",
    "score" : 2,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 12526564,
      "reputation" : 49,
      "user_id" : 9116156,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/64cad12a8866f3f1828d27095de568fc?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Retros_x",
      "link" : "https://stackoverflow.com/users/9116156/retros-x"
    },
    "creation_date" : 1750072188,
    "last_activity_date" : 1750072188,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140516967,
    "post_id" : 79667302,
    "body" : "@talex. in case if the record is deleted from the table I want the database automatically remove related records.",
    "score" : 0,
    "owner" : {
      "account_id" : 83131,
      "reputation" : 9085,
      "user_id" : 233286,
      "user_type" : "registered",
      "accept_rate" : 73,
      "profile_image" : "https://i.sstatic.net/0ivuN.jpg?s=256",
      "display_name" : "ilhan",
      "link" : "https://stackoverflow.com/users/233286/ilhan"
    },
    "creation_date" : 1750072065,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140516804,
    "post_id" : 79667302,
    "body" : "<code>cascade = CascadeType.REMOVE</code>? It looks like you want more then that.",
    "score" : 0,
    "owner" : {
      "account_id" : 4497436,
      "reputation" : 20796,
      "user_id" : 3656904,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/8bdbd1f89f8907e8e8b15ab88c084c65?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "talex",
      "link" : "https://stackoverflow.com/users/3656904/talex"
    },
    "creation_date" : 1750068853,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79667494" : [ {
      "comment_id" : 140519968,
      "post_id" : 79667494,
      "body" : "Additional explanation: Updateable and Inserteable control if the column is included in SQL UPDATE or INSERT statemens generated by the persistence provider (<a href=\"https://www.objectdb.com/api/java/jpa/JoinColumn\" rel=\"nofollow noreferrer\">objectdb.com/api/java/jpa/JoinColumn</a> ). The persistence provider is Hibernate in your case. So if they are set to false, you prohibit Hibernate from inserting data here. This leads to a NULL value, which causes the error if you set nullable=false.",
      "score" : 0,
      "owner" : {
        "account_id" : 12526564,
        "reputation" : 49,
        "user_id" : 9116156,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/64cad12a8866f3f1828d27095de568fc?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Retros_x",
        "link" : "https://stackoverflow.com/users/9116156/retros-x"
      },
      "creation_date" : 1750155490,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140519918,
      "post_id" : 79667494,
      "body" : "No it definitely should work. Try out deleting all the parameters and use just <code>@JoinColumn(name = &quot;listing_id&quot;)</code>",
      "score" : 0,
      "owner" : {
        "account_id" : 12526564,
        "reputation" : 49,
        "user_id" : 9116156,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/64cad12a8866f3f1828d27095de568fc?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Retros_x",
        "link" : "https://stackoverflow.com/users/9116156/retros-x"
      },
      "creation_date" : 1750154424,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140517392,
      "post_id" : 79667494,
      "body" : "Now it inserts if there is no <code>nullable = false</code> in the <code>PictureEntity.java</code> where <code>private ListingEntity listing</code> is located however <code>listing_id</code> is set as <code>NULL</code>. If I put <code>nullable = false</code> then I get <code>Cannot insert the value NULL into column &#39;listing_id&#39;, table &#39;example_database.dbo.pictures&#39;; column does not allow nulls. INSERT fails.</code> May be there is no way to insert at the same time. I was assuming that Hibernate handles the insert in smart way.",
      "score" : 0,
      "owner" : {
        "account_id" : 83131,
        "reputation" : 9085,
        "user_id" : 233286,
        "user_type" : "registered",
        "accept_rate" : 73,
        "profile_image" : "https://i.sstatic.net/0ivuN.jpg?s=256",
        "display_name" : "ilhan",
        "link" : "https://stackoverflow.com/users/233286/ilhan"
      },
      "creation_date" : 1750079970,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140517306,
      "post_id" : 79667494,
      "body" : "You are right. I am updating my question.",
      "score" : 0,
      "owner" : {
        "account_id" : 83131,
        "reputation" : 9085,
        "user_id" : 233286,
        "user_type" : "registered",
        "accept_rate" : 73,
        "profile_image" : "https://i.sstatic.net/0ivuN.jpg?s=256",
        "display_name" : "ilhan",
        "link" : "https://stackoverflow.com/users/233286/ilhan"
      },
      "creation_date" : 1750078736,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140517191,
      "post_id" : 79667494,
      "body" : "It might not be directly related to your problem, but worth a try: I think there is no need to declare the foreign key in the entity. So you should delete <code>@Column(name = &quot;listing_id&quot;, nullable = false)     private Integer listingId;</code>",
      "score" : 1,
      "owner" : {
        "account_id" : 12526564,
        "reputation" : 49,
        "user_id" : 9116156,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/64cad12a8866f3f1828d27095de568fc?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Retros_x",
        "link" : "https://stackoverflow.com/users/9116156/retros-x"
      },
      "creation_date" : 1750076823,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140517056,
      "post_id" : 79667494,
      "body" : "May be there is a bug in Hibernate. I have changed it to <code>CascadeType.ALL</code> but Hibernate automatically created the foreign key in the <code>pictures</code> table as <code>NO_ACTION</code> for both &quot;on delete&quot; and &quot;on update&quot;. <code>CascadeType.PERSIST</code> gives the same result.",
      "score" : 0,
      "owner" : {
        "account_id" : 83131,
        "reputation" : 9085,
        "user_id" : 233286,
        "user_type" : "registered",
        "accept_rate" : 73,
        "profile_image" : "https://i.sstatic.net/0ivuN.jpg?s=256",
        "display_name" : "ilhan",
        "link" : "https://stackoverflow.com/users/233286/ilhan"
      },
      "creation_date" : 1750074354,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}