{
  "question" : {
    "question_id" : 79820340,
    "title" : "Twilio Voice React Native — App Crashes When Initiating Outgoing Call (`getMainActivityClass()` Returns Null)",
    "body" : "<p>After resolving a startup crash, I’m now facing a new crash when attempting to initiate an outgoing call using <code>@twilio/voice-react-native-sdk</code>.</p>\n<p>When I call:</p>\n<pre><code>Voice.connect(...)\n</code></pre>\n<p>the app crashes with the following exception:</p>\n<pre><code>java.lang.NullPointerException\n    at java.util.Objects.requireNonNull (Objects.java:233)\n    at com.twiliovoicereactnative.VoiceApplicationProxy.getMainActivityClass (VoiceApplicationProxy.java:122)\n    at com.twiliovoicereactnative.NotificationUtility.createOutgoingCallNotificationWithLowImportance (NotificationUtility.java:231)\n    at com.twiliovoicereactnative.VoiceService.raiseOutgoingCallNotification (VoiceService.java:316)\n</code></pre>\n<p>It appears that <code>getMainActivityClass()</code> returns null during outgoing call notification creation.</p>\n<hr />\n<p><strong>Dependencies</strong></p>\n<ul>\n<li><p>React Native: 0.79.x (Expo Prebuild)</p>\n</li>\n<li><p>Expo SDK: ~53.0.22</p>\n</li>\n<li><p>Twilio Voice SDK (Android):</p>\n<ul>\n<li><p><code>com.twilio:voice-android:6.3.0</code></p>\n</li>\n<li><p>also tested with <code>6.2.1</code></p>\n</li>\n</ul>\n</li>\n<li><p><code>@twilio/voice-react-native-sdk</code>: ^1.7.0</p>\n</li>\n<li><p>Device: iQOO Neo 10</p>\n</li>\n<li><p>Android Version: 15</p>\n</li>\n<li><p>Architecture: New Architecture Enabled (Fabric + TurboModules)</p>\n</li>\n</ul>\n<hr />\n<p>\uD83D\uDCC4 Relevant Android Code</p>\n<p><em><code>MainActivity.kt</code></em></p>\n<pre><code>class MainActivity : ReactActivity() {\nprivate val activityProxy = VoiceActivityProxy(\n\n    this\n\n) { permission: String -\\&gt;\n\n    when (permission) {\n\n        Manifest.permission.RECORD_AUDIO -\\&gt; {\n\n            Toast.makeText(\n\n                this@MainActivity,\n\n                &quot;Microphone permissions needed. Please allow in your application settings.&quot;,\n\n                Toast.LENGTH_LONG\n\n            ).show()\n\n        }\n\n        Manifest.permission.BLUETOOTH_CONNECT -\\&gt; {\n\n            if (Build.VERSION.SDK_INT \\&gt;= Build.VERSION_CODES.S) {\n\n                Toast.makeText(\n\n                    this@MainActivity,\n\n                    &quot;Bluetooth permissions needed. Please allow in your application settings.&quot;,\n\n                    Toast.LENGTH_LONG\n\n                ).show()\n\n            }\n\n        }\n\n        Manifest.permission.POST_NOTIFICATIONS -\\&gt; {\n\n            if (Build.VERSION.SDK_INT \\&gt; Build.VERSION_CODES.S_V2) {\n\n                Toast.makeText(\n\n                    this@MainActivity,\n\n                    &quot;Notification permissions needed. Please allow in your application settings.&quot;,\n\n                    Toast.LENGTH_LONG\n\n                ).show()\n\n            }\n\n        }\n\n    }\n\n}\n\noverride fun onCreate(savedInstanceState: Bundle?) {\n\n    setTheme(R.style.AppTheme)\n\n    super.onCreate(null)\n\n}\n\noverride fun getMainComponentName(): String = &quot;main&quot;\n\noverride fun createReactActivityDelegate(): ReactActivityDelegate {\n\n    return ReactActivityDelegateWrapper(\n\n        this,\n\n        BuildConfig.IS_NEW_ARCHITECTURE_ENABLED,\n\n        object : DefaultReactActivityDelegate(\n\n            this,\n\n            mainComponentName,\n\n            fabricEnabled\n\n        ) {}\n\n    )\n\n}\n\noverride fun invokeDefaultOnBackPressed() {\n\n    if (Build.VERSION.SDK_INT \\&lt;= Build.VERSION_CODES.R) {\n\n        if (!moveTaskToBack(false)) {\n\n            super.invokeDefaultOnBackPressed()\n\n        }\n\n        return\n\n    }\n\n    super.invokeDefaultOnBackPressed()\n\n}}\n</code></pre>\n<p><em><code>MainReactNativeHost.kt</code></em></p>\n<pre><code>class MainReactNativeHost(application: Application) : DefaultReactNativeHost(application) {\nprivate val voiceReactNativeHost = object : VoiceApplicationProxy.VoiceReactNativeHost(application) {\n\n    override fun getUseDeveloperSupport(): Boolean = this@MainReactNativeHost.getUseDeveloperSupport()\n\n    override fun getPackages(): List\\&lt;ReactPackage\\&gt; = this@MainReactNativeHost.getPackages()\n\n    override fun getJSMainModuleName(): String = this@MainReactNativeHost.getJSMainModuleName()\n\n}\n\noverride fun getUseDeveloperSupport(): Boolean {\n\n    return BuildConfig.DEBUG\n\n}\n\noverride fun getPackages(): List\\&lt;ReactPackage\\&gt; {\n\n    val packages = PackageList(this).packages\n\n    return packages\n\n}\n\noverride fun getJSMainModuleName(): String {\n\n    return &quot;index&quot;\n\n}\n\nfun getVoiceReactNativeHost(): VoiceApplicationProxy.VoiceReactNativeHost {\n\n    return voiceReactNativeHost\n\n}}\n</code></pre>\n<p><em><code>MainApplication.kt</code></em></p>\n<pre><code>class MainApplication : Application(), ReactApplication {\nprivate val innerReactNativeHost = object : DefaultReactNativeHost(this) {\n\n    override fun getPackages() = PackageList(this).packages\n\n    override fun getJSMainModuleName() = &quot;.expo/.virtual-metro-entry&quot;\n\n    override fun getUseDeveloperSupport() = BuildConfig.DEBUG\n\n    override val isNewArchEnabled = BuildConfig.IS_NEW_ARCHITECTURE_ENABLED\n\n    override val isHermesEnabled = BuildConfig.IS_HERMES_ENABLED\n\n}\n\noverride val reactNativeHost: ReactNativeHost =\n\n    ReactNativeHostWrapper(this, innerReactNativeHost)\n\nprivate val voiceApplicationProxy: VoiceApplicationProxy by lazy {\n\n    VoiceApplicationProxy(this)\n\n}\n\noverride val reactHost: ReactHost\n\n    get() = DefaultReactHost.getDefaultReactHost(this.applicationContext, innerReactNativeHost)\n\noverride fun onCreate() {\n\n    super.onCreate()\n\n    SoLoader.init(this, OpenSourceMergedSoMapping)\n\n    if (BuildConfig.IS_NEW_ARCHITECTURE_ENABLED) load()\n\n    voiceApplicationProxy.onCreate()\n\n    ApplicationLifecycleDispatcher.onApplicationCreate(this)\n\n}\n\noverride fun onConfigurationChanged(newConfig: Configuration) {\n\n    super.onConfigurationChanged(newConfig)\n\n    ApplicationLifecycleDispatcher.onConfigurationChanged(this, newConfig)\n\n}}\n</code></pre>\n<p><em><code>AndroidManifest.xml</code></em></p>\n<pre><code>&lt;application\n  android:name=&quot;.MainApplication&quot;\n  android:theme=&quot;@style/AppTheme&quot;\n  android:supportsRtl=&quot;true&quot;&gt;\n\n    &lt;activity\n      android:name=&quot;.MainActivity&quot;\n      android:launchMode=&quot;singleTask&quot;\n      android:exported=&quot;true&quot;\n      android:theme=&quot;@style/Theme.App.SplashScreen&quot;&gt;\n\n      &lt;intent-filter&gt;\n        &lt;action android:name=&quot;android.intent.action.VIEW&quot; /&gt;\n        &lt;category android:name=&quot;android.intent.category.BROWSABLE&quot; /&gt;\n        &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;\n        &lt;data android:scheme=&quot;com.ciptex.clientsdk&quot;/&gt;\n        &lt;action android:name=&quot;android.intent.action.MAIN&quot;/&gt;\n        &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot;/&gt;\n      &lt;/intent-filter&gt;\n    &lt;/activity&gt;\n\n&lt;/application&gt;\n</code></pre>\n<hr />\n<p>❓ Question</p>\n<p>Is my Android configuration missing something that the Twilio Voice React Native SDK requires?</p>\n<p>Or is there a known issue where <code>getMainActivityClass()</code> returns null when running in Expo Prebuild with the New Architecture enabled?</p>\n<p>Any guidance, missing configuration, or fixes would be greatly appreciated!</p>\n",
    "tags" : [ "java", "android", "react-native", "kotlin", "twilio" ],
    "owner" : {
      "account_id" : 31571681,
      "reputation" : 39,
      "user_id" : 31848771,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/21e8020fe8fedc8941d9d2b78b83991a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Bharath Kumar",
      "link" : "https://stackoverflow.com/users/31848771/bharath-kumar"
    },
    "is_answered" : true,
    "view_count" : 76,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1763529581,
    "creation_date" : 1763144743,
    "link" : "https://stackoverflow.com/questions/79820340/twilio-voice-react-native-app-crashes-when-initiating-outgoing-call-getmaina",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79824087,
    "question_id" : 79820340,
    "body" : "<p>Just sharing a quick update — the app is now running smoothly after updating the AndroidManifest.xml with the required permissions and intent filters.</p>\n<p>Huge thanks to everyone who helped troubleshoot and provided suggestions! \uD83D\uDE4C</p>\n<p>Here what i did :</p>\n<pre><code>&lt;activity\nandroid:name=&quot;.MainActivity&quot;\nandroid:configChanges=&quot;keyboard|keyboardHidden|orientation|screenSize|screenLayout|uiMode&quot;\nandroid:launchMode=&quot;singleTask&quot;\nandroid:windowSoftInputMode=&quot;adjustResize&quot;\nandroid:theme=&quot;@style/Theme.App.SplashScreen&quot;\nandroid:exported=&quot;true&quot;\nandroid:screenOrientation=&quot;portrait&quot;&gt;\n\n\n&lt;!-- Deep Link Intent Filter --&gt;\n&lt;intent-filter&gt;\n    &lt;action android:name=&quot;android.intent.action.VIEW&quot;/&gt;\n    &lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;\n    &lt;category android:name=&quot;android.intent.category.BROWSABLE&quot;/&gt;\n    &lt;data android:scheme=&quot;com.ciptex.clientsdk&quot;/&gt;\n&lt;/intent-filter&gt;\n\n\n&lt;!-- Proper Launcher Intent Filter --&gt;\n&lt;intent-filter&gt;\n    &lt;action android:name=&quot;android.intent.action.MAIN&quot;/&gt;\n    &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot;/&gt;\n&lt;/intent-filter&gt;\n</code></pre>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 31571681,
      "reputation" : 39,
      "user_id" : 31848771,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/21e8020fe8fedc8941d9d2b78b83991a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Bharath Kumar",
      "link" : "https://stackoverflow.com/users/31848771/bharath-kumar"
    },
    "creation_date" : 1763529581,
    "last_activity_date" : 1763529581,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140859991,
    "post_id" : 79820340,
    "body" : "This question seems to have been generated or &quot;improved&quot; with help of ChatGPT or another AI. Please be aware that using LLMs or other AIs to generate content is <a href=\"https://meta.stackoverflow.com/questions/421831/policy-generative-ai-e-g-chatgpt-is-banned\">not allowed</a>.",
    "score" : 1,
    "owner" : {
      "account_id" : 213468,
      "reputation" : 110280,
      "user_id" : 466862,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d873f397779db38cd510d9ee5416fd43?s=256&d=identicon&r=PG",
      "display_name" : "Mark Rotteveel",
      "link" : "https://stackoverflow.com/users/466862/mark-rotteveel"
    },
    "creation_date" : 1763460113,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140854809,
    "post_id" : 79820340,
    "body" : "Yes — the Twilio Voice React Native SDK (i.e., @twilio/voice-react-native-sdk) is compatible with the new architecture of React Native (Fabric + TurboModules / “New Architecture”) from version 1.6.0 onward",
    "score" : 1,
    "owner" : {
      "account_id" : 31571681,
      "reputation" : 39,
      "user_id" : 31848771,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/21e8020fe8fedc8941d9d2b78b83991a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Bharath Kumar",
      "link" : "https://stackoverflow.com/users/31848771/bharath-kumar"
    },
    "creation_date" : 1763145177,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140854802,
    "post_id" : 79820340,
    "body" : "Is the Twilio RN plugin new architecture compliant?",
    "score" : 0,
    "owner" : {
      "account_id" : 14722107,
      "reputation" : 6861,
      "user_id" : 10632369,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/541566093e9d34a3858f5446d06a7a6e?s=256&d=identicon&r=PG",
      "display_name" : "tomerpacific",
      "link" : "https://stackoverflow.com/users/10632369/tomerpacific"
    },
    "creation_date" : 1763144895,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}