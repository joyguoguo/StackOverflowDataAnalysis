{
  "question" : {
    "question_id" : 79596035,
    "title" : "inject a running java-swing-application: Agent JAR loaded but agent failed to initialize",
    "body" : "<p>I want to inject a running java-swing-application on my computer to automate input.</p>\n<p>I have created this AttachAgent:</p>\n<pre><code>import com.sun.tools.attach.VirtualMachine;\n\npublic class AttachAgent {\n    public static void main(String[] args) throws Exception {\n        // Replace with real PID of the running Swing app\n        String pid = &quot;16740&quot;;\n\n        // Replace with the full path to your built SwingAgent JAR\n        String agentPath = &quot;C:\\\\Temp\\\\SwingHacker.jar&quot;;\n\n\n        VirtualMachine vm = VirtualMachine.attach(pid);\n        vm.loadAgent(agentPath);\n        vm.detach();\n\n        System.out.println(&quot;Agent attached!&quot;);\n    }\n}\n</code></pre>\n<p>This is the content of my <code>SwingHacker.jar</code>:</p>\n<pre><code>SwingHacker.jar\n├─ META-INF\n│  ├─ MANIFEST.MF\n├─ SwingAgent.class\n</code></pre>\n<p>This is MANIFEST.MF:</p>\n<pre><code>Manifest-Version: 1.0\nAgent-Class: SwingAgent\nCan-Redefine-Classes: true\nPermissions: all-permissions\n</code></pre>\n<p>And this is <code>SwingAgent</code>:</p>\n<pre><code>import java.awt.Component;\nimport java.awt.Container;\nimport java.awt.Window;\nimport java.lang.instrument.Instrumentation;\nimport javax.swing.JButton;\n\npublic class SwingAgent {\n    public static void agentmain(String agentArgs, Instrumentation inst) {\n        System.out.println(&quot;Agent attached!&quot;);\n\n        try {\n            Thread.sleep(2000L);\n        } catch (Exception var6) {\n        }\n\n        for(Window window : Window.getWindows()) {\n            clickButtonByText(window, &quot;Login&quot;);\n        }\n\n    }\n\n    private static boolean clickButtonByText(Component comp, String text) {\n        if (comp instanceof JButton &amp;&amp; text.equals(((JButton)comp).getText())) {\n            System.out.println(&quot;Clicking button: &quot; + text);\n            ((JButton)comp).doClick();\n            return true;\n        } else {\n            if (comp instanceof Container) {\n                for(Component child : ((Container)comp).getComponents()) {\n                    if (clickButtonByText(child, text)) {\n                        return true;\n                    }\n                }\n            }\n\n            return false;\n        }\n    }\n}\n</code></pre>\n<p>When I run this I get this error:</p>\n<pre><code>Exception in thread &quot;main&quot; com.sun.tools.attach.AgentInitializationException: Agent JAR loaded but agent failed to initialize\n    at jdk.attach/sun.tools.attach.HotSpotVirtualMachine.loadAgent(HotSpotVirtualMachine.java:169)\n    at jdk.attach/com.sun.tools.attach.VirtualMachine.loadAgent(VirtualMachine.java:538)\n    at AttachAgent.main(AttachAgent.java:13)\n</code></pre>\n<p>What is wrong or how to fix it?</p>\n<p><strong>EDIT:</strong></p>\n<p>I have already tried to simplify the SwingAgent, but get the same error (also the <code>.txt</code> File is NOT created)</p>\n<pre><code>import java.io.FileWriter;\nimport java.io.PrintWriter;\n\npublic class SwingAgent {\n    public static void agentmain(String agentArgs, java.lang.instrument.Instrumentation inst) {\n        try (PrintWriter out = new PrintWriter(new FileWriter(&quot;C:\\\\Temp\\\\swinghacker_log.txt&quot;, true))) {\n            out.println(&quot;HELLO FROM AGENT!&quot;);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre>\n",
    "tags" : [ "java", "jvm" ],
    "owner" : {
      "account_id" : 10141941,
      "reputation" : 153,
      "user_id" : 7491383,
      "user_type" : "registered",
      "profile_image" : "https://graph.facebook.com/10202668186302038/picture?type=large",
      "display_name" : "Lukas F&#252;rst",
      "link" : "https://stackoverflow.com/users/7491383/lukas-f%c3%bcrst"
    },
    "is_answered" : false,
    "view_count" : 56,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1745855698,
    "creation_date" : 1745828297,
    "link" : "https://stackoverflow.com/questions/79596035/inject-a-running-java-swing-application-agent-jar-loaded-but-agent-failed-to-in",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140377278,
    "post_id" : 79596035,
    "body" : "Did you check the console/log file of the instrumented application for reported exceptions? Note that once loading an agent failed, repeated attempts will always fail with the same error unless a) you restart the instrumented application as well or b) use a different jar file/path so that the JVM considers the new version to be a different agent.",
    "score" : 1,
    "owner" : {
      "account_id" : 3211603,
      "reputation" : 301001,
      "user_id" : 2711488,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/t2hoD.jpg?s=256",
      "display_name" : "Holger",
      "link" : "https://stackoverflow.com/users/2711488/holger"
    },
    "creation_date" : 1745858275,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140377140,
    "post_id" : 79596035,
    "body" : "@Holger: I simplified the code with same error (pls see updated question)",
    "score" : 0,
    "owner" : {
      "account_id" : 10141941,
      "reputation" : 153,
      "user_id" : 7491383,
      "user_type" : "registered",
      "profile_image" : "https://graph.facebook.com/10202668186302038/picture?type=large",
      "display_name" : "Lukas F&#252;rst",
      "link" : "https://stackoverflow.com/users/7491383/lukas-f%c3%bcrst"
    },
    "creation_date" : 1745855730,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140376883,
    "post_id" : 79596035,
    "body" : "I’m not sure if the <code>agentmain</code> method has to complete before entering the <code>main</code> method. Did you try to use a Swing Timer instead of <code>Thread.sleep(2000L);</code>?",
    "score" : 1,
    "owner" : {
      "account_id" : 3211603,
      "reputation" : 301001,
      "user_id" : 2711488,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/t2hoD.jpg?s=256",
      "display_name" : "Holger",
      "link" : "https://stackoverflow.com/users/2711488/holger"
    },
    "creation_date" : 1745851514,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140375902,
    "post_id" : 79596035,
    "body" : "@Abra: I know, but this is only for testing purposes of starting, when giving the wrong PID, i will get a error, that no application is found with this PID.  For testing, I do it manually and write here the PID, if it matches, I come to error Agent JAR loaded but agent failed to initialize",
    "score" : 0,
    "owner" : {
      "account_id" : 10141941,
      "reputation" : 153,
      "user_id" : 7491383,
      "user_type" : "registered",
      "profile_image" : "https://graph.facebook.com/10202668186302038/picture?type=large",
      "display_name" : "Lukas F&#252;rst",
      "link" : "https://stackoverflow.com/users/7491383/lukas-f%c3%bcrst"
    },
    "creation_date" : 1745833253,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140375793,
    "post_id" : 79596035,
    "body" : "Pardon me if this is a silly question, but in the code of class <code>AttachAgent</code>, the PID is hard-coded and the comment states: <i>Replace with real PID of the running Swing app</i> so are you sure that the real PID is the hard-coded value, i.e. 16740 ?",
    "score" : 0,
    "owner" : {
      "account_id" : 2485939,
      "reputation" : 20969,
      "user_id" : 2164365,
      "user_type" : "registered",
      "accept_rate" : 40,
      "profile_image" : "https://i.sstatic.net/RKSgV.png?s=256",
      "display_name" : "Abra",
      "link" : "https://stackoverflow.com/users/2164365/abra"
    },
    "creation_date" : 1745830913,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}