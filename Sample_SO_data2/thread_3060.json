{
  "question" : {
    "question_id" : 79577469,
    "title" : "Mocking an embedded Jetty server request with test body content",
    "body" : "<p>I'm using the delightful Jetty <code>org.eclipse.jetty:jetty-server:12.0.18</code> for an embedded HTTP server (not using Java EE servlets). Jetty passes an <code>org.eclipse.jetty.server.Request</code> to a custom handler, and I want to test a handler by passing a mock request to it—in particular a request that sends test data in the request content body.</p>\n<p>Jetty requests pass content using <code>Content.Chunk</code>, as a <code>Request</code> interface extends <code>Content.Source</code>. <code>Request.read()</code>, for example, would send back another chunk. You can see the pattern for reading from a <code>Content.Source</code> such as a <code>Request</code> at the <a href=\"https://jetty.org/docs/jetty/12/programming-guide/arch/io.html#content-source\" rel=\"nofollow noreferrer\"><code>Content.Source</code> documentation</a>.</p>\n<p><code>Content.Source</code> provides convenient factory methods for reading from a source, e.g. <code>Content.Source.asInputStream(request)</code>. And <code>Content.Source</code> has convenient factory methods for creating a <code>Content.Source</code> from e.g. a <code>ByteBuffer</code>, but that creates just a <code>Content.Source</code>, not a <code>Request</code>.</p>\n<p>Does Jetty provide some convenient way to create a <code>Request</code> that passes back some preconfigured data for testing a handler? Or is there some easy way to mock <code>Request</code> e.g. using Mockito, using e.g. bytes or an existing stream, without going down to the low level of mocking <code>Request.read()</code> and providing test data in <code>Chunk</code> instances?</p>\n<p>Specifically I would like to create a unit test of a strategy method that extracts body content from the <code>Request</code>, not necessarily create an integration test of an entire handler. Thus I'd like to mock just the request body content.</p>\n",
    "tags" : [ "java", "mocking", "jetty" ],
    "owner" : {
      "account_id" : 184786,
      "reputation" : 22254,
      "user_id" : 421049,
      "user_type" : "registered",
      "accept_rate" : 50,
      "profile_image" : "https://www.gravatar.com/avatar/4b9b843fe8e233b2f70e0f2a8e7db4e8?s=256&d=identicon&r=PG",
      "display_name" : "Garret Wilson",
      "link" : "https://stackoverflow.com/users/421049/garret-wilson"
    },
    "is_answered" : false,
    "view_count" : 114,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1746159571,
    "creation_date" : 1744815119,
    "link" : "https://stackoverflow.com/questions/79577469/mocking-an-embedded-jetty-server-request-with-test-body-content",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79602797,
    "question_id" : 79577469,
    "body" : "<p>Use the <code>LocalConnector</code> and <code>HttpTester</code>.</p>\n<p>Example:</p>\n<pre class=\"lang-java prettyprint-override\"><code>import org.eclipse.jetty.http.HttpHeader;\nimport org.eclipse.jetty.http.HttpTester;\nimport org.eclipse.jetty.server.Handler;\nimport org.eclipse.jetty.server.LocalConnector;\nimport org.eclipse.jetty.server.Request;\nimport org.eclipse.jetty.server.Response;\nimport org.eclipse.jetty.server.Server;\n\n\nServer server = new Server();\n// Setup the LocalConnector\nLocalConnector localConnector = new LocalConnector(server);\nserver.addConnector(localConnector);\n\n// Configure your server, install handlers, etc...\nserver.setHandler(handlers);\n\n// Start your server.\nserver.start();\n\n// Then in your code to test things, do this\n// to generate any arbitrary request.\nString simpleRequest = &quot;&quot;&quot;\n    GET / http/1.1\n    Host: local\n    Connection: close\n    Content-Type: text/plain\n    Content-Length: 2\n    \n    hi&quot;&quot;&quot;;\nHttpTester.Response response = HttpTester.parseResponse(\n        localConnector.getResponse(simpleRequest));\nSystem.out.println(&quot;Response: &quot; + response);\nSystem.out.println(response.getContent());\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 406289,
      "reputation" : 49715,
      "user_id" : 775715,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://i.sstatic.net/hNTz1.jpg?s=256",
      "display_name" : "Joakim Erdfelt",
      "link" : "https://stackoverflow.com/users/775715/joakim-erdfelt"
    },
    "creation_date" : 1746159571,
    "last_activity_date" : 1746159571,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140351435,
    "post_id" : 79577469,
    "body" : "Thanks for the suggestion. I updated the question to clarify that I&#39;d like to mock as little as possible—specifically just the body content of the request. <code>LocalConnector</code> seems overkill for that.",
    "score" : 0,
    "owner" : {
      "account_id" : 184786,
      "reputation" : 22254,
      "user_id" : 421049,
      "user_type" : "registered",
      "accept_rate" : 50,
      "profile_image" : "https://www.gravatar.com/avatar/4b9b843fe8e233b2f70e0f2a8e7db4e8?s=256&d=identicon&r=PG",
      "display_name" : "Garret Wilson",
      "link" : "https://stackoverflow.com/users/421049/garret-wilson"
    },
    "creation_date" : 1745108045,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140341538,
    "post_id" : 79577469,
    "body" : "To test your Jetty handler with request body content, use <code>LocalConnector</code> to simulate in-memory HTTP requests.",
    "score" : 0,
    "owner" : {
      "account_id" : 7645025,
      "reputation" : 440,
      "user_id" : 5795975,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-6KwPUS4RnyA/AAAAAAAAAAI/AAAAAAAAC8w/auZqreI45x0/s256-rj/photo.jpg",
      "display_name" : "Vijay",
      "link" : "https://stackoverflow.com/users/5795975/vijay"
    },
    "creation_date" : 1744819804,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}