{
  "question" : {
    "question_id" : 79772929,
    "title" : "How can I distinguish notify from timeout wait(int)",
    "body" : "<p>I have working code in Java using <code>wait(int delay)</code> and, from a different Thread, <code>notify()</code>.</p>\n<p>It all works fine, once I got the <code>synchronized</code> right, but I cannot see how to distinguish if the waiting thread woke up because of timeout or <code>notify</code>.</p>\n<p>I see workarounds, like using a <code>Consumer</code> that modifies some object that is accessible by the waiting thread, but, that's, well, a <em>workaround</em>.</p>\n<p>Is there an <em>intended</em> way to do it? Like, if the <code>wait(delay)</code> would have some return value (which it doesn't).</p>\n",
    "tags" : [ "java", "multithreading" ],
    "owner" : {
      "account_id" : 5175809,
      "reputation" : 1196,
      "user_id" : 4142984,
      "user_type" : "registered",
      "accept_rate" : 83,
      "profile_image" : "https://www.gravatar.com/avatar/a6305f943ab99c2928fdc8c2acfae9cd?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Gyro Gearloose",
      "link" : "https://stackoverflow.com/users/4142984/gyro-gearloose"
    },
    "is_answered" : true,
    "view_count" : 101,
    "answer_count" : 2,
    "score" : 1,
    "last_activity_date" : 1758719084,
    "creation_date" : 1758650024,
    "link" : "https://stackoverflow.com/questions/79772929/how-can-i-distinguish-notify-from-timeout-waitint",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79773038,
    "question_id" : 79772929,
    "body" : "<blockquote>\n<p>I cannot see how to distinguish if the waiting Thread woke up because of timeout or <code>notify</code>.</p>\n</blockquote>\n<p>No, you can't, because there is no provision for that.</p>\n<p>And that's not necessarily even well defined.  Suppose, for example, that the timeout expires but the object is also <code>notify()</code>ed before the waiting thread returns from <code>wait()</code>.  Or the other way around.  Or other combinations involving thread interruption or (otherwise-)spurious wakeup.  In which such cases is a timeout the cause of the wakeup and in which is it not?  Even if there were an API that nominally indicated a cause for the wakeup, it would not be safe to assume that a timeout indicated that the object had not been notified, nor that a notification indicated that the timeout had not expired.</p>\n<p>When you <code>wait()</code>, it is always for a particular purpose, even if that's just to cease action for a certain amount of time.  Usually it's to wait for some other thread to do something that the current thread needs to happen before proceeding.  Whatever that purpose is, it needs to be testable.</p>\n<p>The conventional idiom for usage of <code>wait</code> / <code>notify</code> is then to</p>\n<ol>\n<li>acquire the object's monitor, then</li>\n<li>test whether to <code>wait</code> at all, and if so</li>\n<li><code>wait()</code>, and after returning,</li>\n<li><strong>test whether to <code>wait()</code> again</strong>, going back to (3) if so</li>\n</ol>\n<p>and eventually</p>\n<ol start=\"5\">\n<li>release the monitor</li>\n</ol>\n<p>Often the tests in (2) and (4) are the same, but if you are using a timeout then you might want to include in the test at (4) (or in both) a consideration of how much time has actually elapsed.  You would need to track that explicitly.  For example,</p>\n<pre><code>class Player {\n\n    private final static long TURN_TIMEOUT_MILLIS = 5000;\n\n    // ...\n\n    void awaitTurn() throws InterruptedException {\n        synchronized (this) {\n            Instant startInstant = Instant.now();\n            long elapsedMillis = 0;\n\n            while (!isMyTurn() &amp;&amp; elapsedMillis &lt; TURN_TIMEOUT_MILLIS) {\n                wait(TURN_TIMEOUT_MILLIS - elapsedMillis);\n                elapsedMillis = startInstant.until(Instant.now(), ChronoUnit.MILLIS);\n            }\n\n            if (!isMyTurn()) {\n                // handle timeout ...\n            }\n        }\n\n        // ...\n    }\n}\n</code></pre>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190712,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1758658495,
    "last_activity_date" : 1758659019,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79773727,
    "question_id" : 79772929,
    "body" : "<p>I totally agree with the other answer, but here's a short-and-sweet version:</p>\n<p><em>After</em> <code>wait(...)</code> returns, a thread is supposed to be able to know, <em>by looking at program variables and/or objects,</em> whether or not the event for which it was waiting  has happened. If it cannot tell whether or not the event happened, then you aren't using <code>wait</code> and <code>notify</code> in the way they were intended to be used. Here's a tutorial that explains how they were meant to be used: <a href=\"https://docs.oracle.com/javase/tutorial/essential/concurrency/guardmeth.html\" rel=\"nofollow noreferrer\">https://docs.oracle.com/javase/tutorial/essential/concurrency/guardmeth.html</a></p>\n",
    "score" : 2,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 14247365,
      "reputation" : 453,
      "user_id" : 10291999,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/1yd1F.png?s=256",
      "display_name" : "Ohm&#39;s Lawman",
      "link" : "https://stackoverflow.com/users/10291999/ohms-lawman"
    },
    "creation_date" : 1758717981,
    "last_activity_date" : 1758719084,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140755526,
    "post_id" : 79772929,
    "body" : "&quot;Nice code&quot; should use higher-level abstractions, e.g. <code>Lock</code> and <code>Condition</code>, avoiding the use of <code>wait</code> and <code>notify</code>.  (And such code should note, as in the <code>Condition</code> doc: &quot;When waiting upon a Condition, a &#39;spurious wakeup&#39; is permitted to occur, in general, as a concession to the underlying platform semantics. This has little practical impact on most application programs as a Condition should always be waited upon in a loop, testing the state predicate that is being waited for.&quot;)",
    "score" : 1,
    "owner" : {
      "account_id" : 465573,
      "reputation" : 200423,
      "user_id" : 869736,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/ae7bb06b9a23a4dd7eea69e853d47d12?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Louis Wasserman",
      "link" : "https://stackoverflow.com/users/869736/louis-wasserman"
    },
    "creation_date" : 1758659459,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140755394,
    "post_id" : 79772929,
    "body" : "@user85421 Of course, I catch InterruptedException, but it doesn&#39;t occur. My first but false guess was that either <code>notify</code> of <code>wait</code> would produce this kind of Exception, but, thinking twice, it is good design that they don&#39;t.",
    "score" : 0,
    "owner" : {
      "account_id" : 5175809,
      "reputation" : 1196,
      "user_id" : 4142984,
      "user_type" : "registered",
      "accept_rate" : 83,
      "profile_image" : "https://www.gravatar.com/avatar/a6305f943ab99c2928fdc8c2acfae9cd?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Gyro Gearloose",
      "link" : "https://stackoverflow.com/users/4142984/gyro-gearloose"
    },
    "creation_date" : 1758653396,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140755371,
    "post_id" : 79772929,
    "body" : "&quot;<i>Nice code</i>&quot; should not have bugs...  -- I am sure not recommending to use <code>interrupt()</code>! -- my point is more about &#39;<i>how to catch &quot;Thread T is awakened spuriously&quot;</i>&#39; and be aware of it (maybe the documentation I linked to can be of some [minimal] help)",
    "score" : 2,
    "owner" : {
      "account_id" : 31180,
      "reputation" : 29752,
      "user_id" : 85421,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/kKvXH.gif?s=256",
      "display_name" : "user85421",
      "link" : "https://stackoverflow.com/users/85421/user85421"
    },
    "creation_date" : 1758652531,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140755364,
    "post_id" : 79772929,
    "body" : "@user85421 Yea, I&#39;ve seen that, but <code>interrupt()</code> looks somehow brutal, needing to throw and catch an exception. <i>Nice</i> code should be able to do without. Btw, how to catch &quot;Thread T is awakened spuriously&quot;?",
    "score" : 0,
    "owner" : {
      "account_id" : 5175809,
      "reputation" : 1196,
      "user_id" : 4142984,
      "user_type" : "registered",
      "accept_rate" : 83,
      "profile_image" : "https://www.gravatar.com/avatar/a6305f943ab99c2928fdc8c2acfae9cd?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Gyro Gearloose",
      "link" : "https://stackoverflow.com/users/4142984/gyro-gearloose"
    },
    "creation_date" : 1758652425,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140755358,
    "post_id" : 79772929,
    "body" : "btw, as <a href=\"https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/Object.html#wait(long,int)\" rel=\"nofollow noreferrer\">documented</a> there are two additional reasons for a thread waking up: - &quot;<i>Some other thread interrupts thread T</i>&quot; (<code>InterruptedException</code>); and &quot;<i>Thread T is awakened spuriously</i>&quot;",
    "score" : 2,
    "owner" : {
      "account_id" : 31180,
      "reputation" : 29752,
      "user_id" : 85421,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/kKvXH.gif?s=256",
      "display_name" : "user85421",
      "link" : "https://stackoverflow.com/users/85421/user85421"
    },
    "creation_date" : 1758652273,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140755339,
    "post_id" : 79772929,
    "body" : "@JannikS. That was another <i>workaround</i> I had in mind: comparing the elapsed time with the scheduled delay. Guessing this would be even more error prone due to race conditions, I implemented the<code>Consumer</code> way. Both not really satisfying.",
    "score" : 0,
    "owner" : {
      "account_id" : 5175809,
      "reputation" : 1196,
      "user_id" : 4142984,
      "user_type" : "registered",
      "accept_rate" : 83,
      "profile_image" : "https://www.gravatar.com/avatar/a6305f943ab99c2928fdc8c2acfae9cd?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Gyro Gearloose",
      "link" : "https://stackoverflow.com/users/4142984/gyro-gearloose"
    },
    "creation_date" : 1758651862,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140755334,
    "post_id" : 79772929,
    "body" : "Not aware if there is an intended way to do it, however, assuming <code>delay</code> is high enough, capturing the elapsed time via calls to <code>System.currentTimeMilis()</code> and/or <code>System.nanoTime()</code> to get an estimated guess.",
    "score" : 0,
    "owner" : {
      "account_id" : 30223964,
      "reputation" : 252,
      "user_id" : 23162960,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2451acfac254a6fc75757ecf89d75f9a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jannik S.",
      "link" : "https://stackoverflow.com/users/23162960/jannik-s"
    },
    "creation_date" : 1758651634,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79773727" : [ {
      "comment_id" : 140758183,
      "post_id" : 79773727,
      "body" : "@GyroGearloose That is the intended way to solve it. To use wait you need to have a condition variable.",
      "score" : 1,
      "owner" : {
        "account_id" : 75804,
        "reputation" : 96727,
        "user_id" : 217324,
        "user_type" : "registered",
        "accept_rate" : 96,
        "profile_image" : "https://www.gravatar.com/avatar/dc91a8e29fedbd6a6d7e03a8394009ab?s=256&d=identicon&r=PG",
        "display_name" : "Nathan Hughes",
        "link" : "https://stackoverflow.com/users/217324/nathan-hughes"
      },
      "creation_date" : 1758756434,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140757147,
      "post_id" : 79773727,
      "body" : "Well, just another workaround. But it&#39; comforting to see there is no <i>intended</i> way to solve it.",
      "score" : 0,
      "owner" : {
        "account_id" : 5175809,
        "reputation" : 1196,
        "user_id" : 4142984,
        "user_type" : "registered",
        "accept_rate" : 83,
        "profile_image" : "https://www.gravatar.com/avatar/a6305f943ab99c2928fdc8c2acfae9cd?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Gyro Gearloose",
        "link" : "https://stackoverflow.com/users/4142984/gyro-gearloose"
      },
      "creation_date" : 1758723517,
      "content_license" : "CC BY-SA 4.0"
    } ],
    "79773038" : [ {
      "comment_id" : 140755580,
      "post_id" : 79773038,
      "body" : "@Basilevs Absolutely right, and in Java, a variation of the same also applies to implementations of the higher-level <a href=\"https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/util/concurrent/locks/Condition.html\" rel=\"nofollow noreferrer\"><code>java.util.concurrent.locks.Condition</code></a> interface, Java&#39;s other condition variable API.  For <code>Object.wait()</code>, this idiom is described, with example code, in <a href=\"https://docs.oracle.com/en/java/javase/25/docs/api//java.base/java/lang/Object.html#wait(long,int)\" rel=\"nofollow noreferrer\">the API docs for <code>Object.wait(long, int)</code></a>.",
      "score" : 0,
      "owner" : {
        "account_id" : 2792262,
        "reputation" : 190712,
        "user_id" : 2402272,
        "user_type" : "registered",
        "accept_rate" : 85,
        "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
        "display_name" : "John Bollinger",
        "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
      },
      "creation_date" : 1758661546,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140755538,
      "post_id" : 79773038,
      "body" : "I wanted to mention that this is Java implementation of Condition Variable pattern, but can&#39;t find any good language-agnostic articles \uD83D\uDE41",
      "score" : 1,
      "owner" : {
        "account_id" : 43022,
        "reputation" : 24627,
        "user_id" : 125562,
        "user_type" : "registered",
        "accept_rate" : 64,
        "profile_image" : "https://i.sstatic.net/SdIqA.png?s=256",
        "display_name" : "Basilevs",
        "link" : "https://stackoverflow.com/users/125562/basilevs"
      },
      "creation_date" : 1758659918,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}