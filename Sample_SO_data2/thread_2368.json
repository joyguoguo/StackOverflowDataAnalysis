{
  "question" : {
    "question_id" : 79628413,
    "title" : "the correct table name is not substituted. Invalid object name",
    "body" : "<p>I have a start on spring boot version 2.1.6.RELEASE version java 11. I substitute table names from application.yml</p>\n<p>In the statreer the class responsible for this is:</p>\n<pre><code>public class CustomPhysicalNamingStrategy extends PhysicalNamingStrategyStandardImpl implements PhysicalNamingStrategy {\n\n    private static Map&lt;String, String&gt; tableNames;\n\n    public CustomPhysicalNamingStrategy(TableNamesProperties tableNamesProperties) {\n        tableNames = new HashMap&lt;&gt;();\n        tableNames.put(&quot;SpecialContingentDisease&quot;, tableNamesProperties.getSpecialContingentDisease());\n        tableNames.put(&quot;SpecialContingentLpu&quot;, tableNamesProperties.getSpecialContingentLpu());\n        tableNames.put(&quot;MkbGroup&quot;, tableNamesProperties.getMkbGroup());\n        tableNames.put(&quot;MkbToGroup&quot;, tableNamesProperties.getMkbToGroup());\n        tableNames.put(&quot;TehAtrValue&quot;, tableNamesProperties.getTehAtrValue());\n        tableNames.put(&quot;OmsTehAtr&quot;, tableNamesProperties.getTehAtr());\n\n    }\n\n    @Override\n    public Identifier toPhysicalTableName(Identifier name, JdbcEnvironment context) {\n        String tableName = name.getText();\n        String mappedTableName = tableNames.get(tableName);\n        System.out.println(&quot;Mapping table: &quot; + tableName + &quot; -&gt; &quot; + mappedTableName);\n        if (mappedTableName == null) {\n            return super.toPhysicalTableName(name, context);\n        }\n        return Identifier.toIdentifier(mappedTableName);\n    }\n\n    @Override\n    public Identifier toPhysicalColumnName(Identifier name, JdbcEnvironment context) {\n        return name;\n    }\n}\n</code></pre>\n<p>I use this starter in different microservices and some of them are different because they have several data sources where it is 1 everything works correctly. Here is the service config:</p>\n<pre><code>  datasource:\n    url: jdbc:sqlserver://${MED_INFO_DB_IEMK_ADDRESS:111.111.1.11:11111}\n    username: ${MED_INFO_DB_IEMK_USERNAME:user}\n    password: ${MED_INFO_DB_IEMK_PASSWORD:pass}\n    driver-class-name: com.microsoft.sqlserver.jdbc.SQLServerDriver\n\n  jpa:\n    open-in-view: false\n\ntable:\n  names:\n    disease: ${DISEASE_DIRECTORY_PATH:cod.dbo.oms_mkb}\n\n</code></pre>\n<p>And where there are several data sources, I use the given configuration</p>\n<pre><code>  datasource:\n    jdbc-url: jdbc:sqlserver://${MED_INFO_DB_MIP_ADDRESS:111.111.1.111:11111}\n    username: ${MED_INFO_DB_MIP_USERNAME:1111}\n    password: ${MED_INFO_DB_MIP_PASSWORD:1111}\n    driver-class-name: com.microsoft.sqlserver.jdbc.SQLServerDriver\n  iemk-datasource:\n    jdbc-url: jdbc:sqlserver://${MED_INFO_DB_IEMK_ADDRESS:111.111.1.111:11111}\n    username: ${MED_INFO_DB_IEMK_USERNAME:1111}\n    password: ${MED_INFO_DB_IEMK_PASSWORD:1111}\n    driver-class-name: com.microsoft.sqlserver.jdbc.SQLServerDriver\n\n  jpa:\n    open-in-view: false\n    database-platform: org.hibernate.dialect.SQLServerDialect\n    hibernate:\n      naming:\n        physical-strategy: tech.reliab.special.contingent.config.CustomPhysicalNamingStrategy\n\ntable:\n  names:\n    disease: ${DISEASE_DIRECTORY_PATH:cod.dbo.oms_mkb}\n\n</code></pre>\n<pre><code>@Configuration\n@Profile(&quot;!test&quot;)\n@EnableJpaRepositories(\n        basePackages = {\n                &quot;ru.tn.telemedicine.register.business.dao&quot;,\n                &quot;tech.reliab.special.contingent.repository&quot;\n        },\n        entityManagerFactoryRef = &quot;iemkEntityManager&quot;,\n        transactionManagerRef = &quot;iemkTransactionManager&quot;\n)\npublic class IemkDataSourceConfig {\n\n    @Bean\n    @ConfigurationProperties(prefix = &quot;spring.iemk-datasource&quot;)\n    public DataSource iemkDataSource() {\n        return DataSourceBuilder.create().build();\n    }\n\n    @Bean\n    @Primary\n    public LocalContainerEntityManagerFactoryBean iemkEntityManager() {\n        LocalContainerEntityManagerFactoryBean em = new LocalContainerEntityManagerFactoryBean();\n        em.setDataSource(iemkDataSource());\n        em.setPackagesToScan(\n                &quot;ru.tn.telemedicine.register.business.dao&quot;,\n                &quot;ru.tn.telemedicine.register.business.domain&quot;,\n                &quot;tech.reliab.special.contingent.domain&quot;,\n                &quot;tech.reliab.special.contingent.repository&quot;\n        );\n        em.setPersistenceUnitName(&quot;iemk&quot;);\n        HibernateJpaVendorAdapter vendorAdapter = new HibernateJpaVendorAdapter();\n        em.setJpaVendorAdapter(vendorAdapter);\n        HashMap&lt;String, Object&gt; properties = new HashMap&lt;&gt;();\n        properties.put(&quot;hibernate.hbm2ddl.auto&quot;, &quot;none&quot;);\n        properties.put(&quot;hibernate.dialect&quot;, &quot;org.hibernate.dialect.SQLServerDialect&quot;);\n        properties.put(&quot;hibernate.show_sql&quot;, &quot;true&quot;);\n        properties.put(&quot;hibernate.format_sql&quot;, &quot;true&quot;);\n        em.setJpaPropertyMap(properties);\n        return em;\n    }\n\n    @Bean\n    @Primary\n    public PlatformTransactionManager iemkTransactionManager() {\n        System.out.println(&quot;Creating iemkTransactionManager&quot;);\n        JpaTransactionManager transactionManager = new JpaTransactionManager();\n        transactionManager.setEntityManagerFactory(iemkEntityManager().getObject());\n        return transactionManager;\n    }\n} \n</code></pre>\n<p>When you launch the application, you can see it in the logs:</p>\n<blockquote>\n<p>TableNamesProperties: specialContingentDisease = cod.dbo.oms_mkb</p>\n</blockquote>\n<p>Which means everything should be fine, but after the request I get an error:</p>\n<blockquote>\n<p>2025-05-19 11:31:46.233 ERROR 26152 --- [nio-8057-exec-1] o.h.engine.jdbc.spi.SqlExceptionHelper   : Invalid object name 'SpecialContingentDisease'.</p>\n</blockquote>\n<p>Here is the entity class:</p>\n<pre class=\"lang-java prettyprint-override\"><code>\n@Entity\n@AllArgsConstructor\n@NoArgsConstructor\n@Getter\n@FieldDefaults(level = AccessLevel.PRIVATE)\npublic class SpecialContingentDisease {\n    @Id\n    Integer mkbid;\n    String ds;\n    String name;\n    @Column(name = &quot;DATE_E&quot;)\n    LocalDateTime dateE;\n}\n</code></pre>\n",
    "tags" : [ "java", "sql-server", "spring", "spring-boot", "hibernate" ],
    "owner" : {
      "account_id" : 27080621,
      "reputation" : 1,
      "user_id" : 20629819,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/ALm5wu3sMjSo_eylAFMGQ5fzR2Gh2Us3tCXKfWFOilj0OA=k-s256",
      "display_name" : "Utka",
      "link" : "https://stackoverflow.com/users/20629819/utka"
    },
    "is_answered" : false,
    "view_count" : 73,
    "answer_count" : 1,
    "score" : -3,
    "last_activity_date" : 1747747209,
    "creation_date" : 1747645240,
    "link" : "https://stackoverflow.com/questions/79628413/the-correct-table-name-is-not-substituted-invalid-object-name",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79630531,
    "question_id" : 79628413,
    "body" : "<p>I added the physical_naming_strategy property, and it was necessary to create CustomPhysicalNamingStrategy in the same method</p>\n<pre><code>@Bean\npublic LocalContainerEntityManagerFactoryBean iemkEntityManager(TableNamesProperties tableNamesProperties) {\n    LocalContainerEntityManagerFactoryBean em = new LocalContainerEntityManagerFactoryBean();\n    em.setDataSource(iemkDataSource());\n    em.setPackagesToScan(\n            &quot;ru.tn.telemedicine.register.business.dao&quot;,\n            &quot;ru.tn.telemedicine.register.business.domain&quot;,\n            &quot;tech.reliab.special.contingent.domain&quot;,\n            &quot;tech.reliab.special.contingent.repository&quot;\n    );\n    em.setPersistenceUnitName(&quot;iemk&quot;);\n    HibernateJpaVendorAdapter vendorAdapter = new HibernateJpaVendorAdapter();\n    em.setJpaVendorAdapter(vendorAdapter);\n    HashMap&lt;String, Object&gt; properties = new HashMap&lt;&gt;();\n    properties.put(&quot;hibernate.hbm2ddl.auto&quot;, &quot;none&quot;);\n    properties.put(&quot;hibernate.dialect&quot;, &quot;org.hibernate.dialect.SQLServerDialect&quot;);\n    properties.put(&quot;hibernate.show_sql&quot;, &quot;false&quot;);\n    properties.put(&quot;hibernate.format_sql&quot;, &quot;false&quot;);\n    properties.put(&quot;hibernate.physical_naming_strategy&quot;, new CustomPhysicalNamingStrategy(tableNamesProperties));\n    em.setJpaPropertyMap(properties);\n    return em;\n}\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 27080621,
      "reputation" : 1,
      "user_id" : 20629819,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/ALm5wu3sMjSo_eylAFMGQ5fzR2Gh2Us3tCXKfWFOilj0OA=k-s256",
      "display_name" : "Utka",
      "link" : "https://stackoverflow.com/users/20629819/utka"
    },
    "creation_date" : 1747747209,
    "last_activity_date" : 1747747209,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140438674,
    "post_id" : 79628413,
    "body" : "@ThomA Yes, I removed the extra code. Thanks for the note.",
    "score" : 0,
    "owner" : {
      "account_id" : 27080621,
      "reputation" : 1,
      "user_id" : 20629819,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/ALm5wu3sMjSo_eylAFMGQ5fzR2Gh2Us3tCXKfWFOilj0OA=k-s256",
      "display_name" : "Utka",
      "link" : "https://stackoverflow.com/users/20629819/utka"
    },
    "creation_date" : 1747647655,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140438667,
    "post_id" : 79628413,
    "body" : "@siggemannen there was <a href=\"https://stackoverflow.com/revisions/79628413/2\">a lot more</a> when I posted the comment.",
    "score" : 0,
    "owner" : {
      "account_id" : 2312068,
      "reputation" : 97710,
      "user_id" : 2029983,
      "user_type" : "moderator",
      "profile_image" : "https://www.gravatar.com/avatar/0118fb43d1ce086d768e295339cf0ff4?s=256&d=identicon&r=PG",
      "display_name" : "Thom A",
      "link" : "https://stackoverflow.com/users/2029983/thom-a"
    },
    "creation_date" : 1747647549,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140438629,
    "post_id" : 79628413,
    "body" : "@ThomA i dunno, for spring this is surprisingly little code :)",
    "score" : 0,
    "owner" : {
      "account_id" : 17972905,
      "reputation" : 10131,
      "user_id" : 13061224,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/GyOMS.jpg?s=256",
      "display_name" : "siggemannen",
      "link" : "https://stackoverflow.com/users/13061224/siggemannen"
    },
    "creation_date" : 1747646752,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140438564,
    "post_id" : 79628413,
    "body" : "Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>, with emphasis on the <b>minimal</b>; There is <i>far</i> too code here; we don&#39;t need it all to replicate the problem you&#39;re experiencing.",
    "score" : 0,
    "owner" : {
      "account_id" : 2312068,
      "reputation" : 97710,
      "user_id" : 2029983,
      "user_type" : "moderator",
      "profile_image" : "https://www.gravatar.com/avatar/0118fb43d1ce086d768e295339cf0ff4?s=256&d=identicon&r=PG",
      "display_name" : "Thom A",
      "link" : "https://stackoverflow.com/users/2029983/thom-a"
    },
    "creation_date" : 1747645513,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}