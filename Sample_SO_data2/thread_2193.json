{
  "question" : {
    "question_id" : 79642047,
    "title" : "intent ACTION_OPEN_DOCUMENT_TREE not working on real device",
    "body" : "<p>In my application I'm starting an intent using the <strong>ACTION_OPEN_DOCUMENT_TREE</strong> action to let the user pick a folder for file storage.\nThe code isn't much different from Google's own advice at: <a href=\"https://developer.android.com/training/data-storage/shared/documents-files#grant-access-directory\" rel=\"nofollow noreferrer\">https://developer.android.com/training/data-storage/shared/documents-files#grant-access-directory</a></p>\n<p>e.g.</p>\n<pre><code>    private void openDirChooser()\n    {\n        Intent intent = new Intent(Intent.ACTION_OPEN_DOCUMENT_TREE);\n        startActivityForResult(intent);\n    }\n</code></pre>\n<p>Now while this works fine on an Android 15 emulator and a handful of pre 15 real devices, thus viewing folders in the primary storage, creating a folder and ultimately being able to use the 'USE THIS FOLDER' button:</p>\n<p><a href=\"https://i.sstatic.net/TUU06GJj.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/TUU06GJj.jpg\" alt=\"\" /></a></p>\n<p><a href=\"https://i.sstatic.net/oJSdzQnA.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/oJSdzQnA.jpg\" alt=\"\" /></a></p>\n<p>it shows up an empty root folder and even a freshly created test folder just shows a disabled button on a Lenovo Tab M11 Android 15 device:</p>\n<p><a href=\"https://i.sstatic.net/KxC90hGy.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/KxC90hGy.jpg\" alt=\"\" /></a></p>\n<p><a href=\"https://i.sstatic.net/IxykMpJW.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/IxykMpJW.jpg\" alt=\"\" /></a></p>\n<p>While viewing the logcat the only relevant bit seems this:</p>\n<pre><code>W/ExternalStorage: Error in checking file equality check.\n    java.nio.file.NoSuchFileException: /storage/emulated\n        at sun.nio.fs.UnixFileSystemProvider.isSameFile(UnixFileSystemProvider.java:344)\n        at java.nio.file.Files.isSameFile(Files.java:1504)\n        at com.android.externalstorage.ExternalStorageProvider.isRestrictedPath(ExternalStorageProvider.java:352)\n        at com.android.externalstorage.ExternalStorageProvider.shouldHideDocument(ExternalStorageProvider.java:313)\n        at com.android.internal.content.FileSystemProvider.queryChildDocuments(FileSystemProvider.java:414)\n        at com.android.internal.content.FileSystemProvider.queryChildDocuments(FileSystemProvider.java:385)\n        at android.provider.DocumentsProvider.queryChildDocuments(DocumentsProvider.java:618)\n        at android.provider.DocumentsProvider.query(DocumentsProvider.java:935)\n        at android.content.ContentProvider$Transport.query(ContentProvider.java:303)\n        at android.content.ContentProviderNative.onTransact(ContentProviderNative.java:107)\n        at android.os.Binder.execTransactInternal(Binder.java:1510)\n        at android.os.Binder.execTransact(Binder.java:1454)\n2025-05-28 11:50:38.942 14736-14747/? W/FileSystemProvider: Queried directory &quot;primary:&quot; is hidden\n</code></pre>\n<p>and the same message once more for the just created <strong>Test</strong> folder:</p>\n<pre><code>2025-05-28 12:05:49.994 16356-16371/? W/FileSystemProvider: Queried directory &quot;primary:Test&quot; is hidden\n</code></pre>\n<p>What could possibly be wrong?</p>\n",
    "tags" : [ "java", "android", "scoped-storage" ],
    "owner" : {
      "account_id" : 8692001,
      "reputation" : 13003,
      "user_id" : 6504633,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/8da50644a6ff87102823353ad2736762?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "obscure",
      "link" : "https://stackoverflow.com/users/6504633/obscure"
    },
    "is_answered" : true,
    "view_count" : 210,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1748431386,
    "creation_date" : 1748429326,
    "link" : "https://stackoverflow.com/questions/79642047/intent-action-open-document-tree-not-working-on-real-device",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79642098,
    "question_id" : 79642047,
    "body" : "<blockquote>\n<p>So you think it's really a bug with the primary storage caused by Lenovo itself?</p>\n</blockquote>\n<p>That would be my guess, if your code is accurate. It is possible that it is an Android bug that only surfaces in some conditions, where the Lenovo triggers those conditions. If this is a Google Play device, there <em>definitely</em> is a bug in compatibility testing, as there is no way this device should have shipped in this form. \uD83D\uDE1E</p>\n<p>If your code is literally what you show in this SO question, it is not a bug in your code. Note though that your code uses deprecated stuff, notably directly calling <code>startActivityForResult()</code>. Look into <code>ActivityResultContracts.OpenDocumentTree</code>.</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 39846,
      "reputation" : 1011235,
      "user_id" : 115145,
      "user_type" : "registered",
      "accept_rate" : 84,
      "profile_image" : "https://i.sstatic.net/wDnd8.png?s=256",
      "display_name" : "CommonsWare",
      "link" : "https://stackoverflow.com/users/115145/commonsware"
    },
    "creation_date" : 1748431386,
    "last_activity_date" : 1748431386,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140465698,
    "post_id" : 79642047,
    "body" : "I just inserted a SD card into that device and interestingly I&#39;m able to create/use folders flawlessly. So you think it&#39;s really a bug with the primary storage caused by Lenovo itself?",
    "score" : 0,
    "owner" : {
      "account_id" : 8692001,
      "reputation" : 13003,
      "user_id" : 6504633,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/8da50644a6ff87102823353ad2736762?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "obscure",
      "link" : "https://stackoverflow.com/users/6504633/obscure"
    },
    "creation_date" : 1748430983,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140465618,
    "post_id" : 79642047,
    "body" : "It would appear that Lenovo screwed up, and either that device is not part of the Google Play ecosystem or they somehow got it past Play compatibility testing despite the bug.",
    "score" : 0,
    "owner" : {
      "account_id" : 39846,
      "reputation" : 1011235,
      "user_id" : 115145,
      "user_type" : "registered",
      "accept_rate" : 84,
      "profile_image" : "https://i.sstatic.net/wDnd8.png?s=256",
      "display_name" : "CommonsWare",
      "link" : "https://stackoverflow.com/users/115145/commonsware"
    },
    "creation_date" : 1748429447,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79642098" : [ {
      "comment_id" : 140467853,
      "post_id" : 79642098,
      "body" : "Please add the link to the post at lenovo, for reference.",
      "score" : 0,
      "owner" : {
        "account_id" : 209006,
        "reputation" : 47,
        "user_id" : 459816,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/aFb6S.jpg?s=256",
        "display_name" : "cheesus",
        "link" : "https://stackoverflow.com/users/459816/cheesus"
      },
      "creation_date" : 1748475386,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140466189,
      "post_id" : 79642098,
      "body" : "I&#39;d say anytime is a good time for a single-malt whiskey @CommonsWare. ;) Well I&#39;ll try to post this on the lenovo forum and see what happens. At least you could soothe my worries that there is something missing like some mysterious new permission I&#39;m not aware of yet. As I said it seems to happen with any application trying to read the primary storage of that particular device. Thanks again!",
      "score" : 0,
      "owner" : {
        "account_id" : 8692001,
        "reputation" : 13003,
        "user_id" : 6504633,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/8da50644a6ff87102823353ad2736762?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "obscure",
        "link" : "https://stackoverflow.com/users/6504633/obscure"
      },
      "creation_date" : 1748439286,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140466110,
      "post_id" : 79642098,
      "body" : "@obscure: &quot;Not sure what to do now though&quot; -- I do not know what time of day it is there. Have you considered a good single-malt whiskey? \uD83D\uDE01 &quot;file a bug with Lenovo?&quot; -- if you can actually do that, sure, but I suspect that there is no good avenue for that. If this is a Google Play ecosystem device, you could file a bug with Google to get them to test this better as part of the Compatibility Test Suite or other testing they do. &quot;I also just discovered a good read&quot; -- IIRC I do not have demo code for that particular contract, but otherwise, if it helps, great! Thanks for the kind words!",
      "score" : 0,
      "owner" : {
        "account_id" : 39846,
        "reputation" : 1011235,
        "user_id" : 115145,
        "user_type" : "registered",
        "accept_rate" : 84,
        "profile_image" : "https://i.sstatic.net/wDnd8.png?s=256",
        "display_name" : "CommonsWare",
        "link" : "https://stackoverflow.com/users/115145/commonsware"
      },
      "creation_date" : 1748438050,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140465879,
      "post_id" : 79642098,
      "body" : "Thanks Mark! I just tested some applications from Google Play, from which I know it&#39;s requesting a folder using ACTION_OPEN_DOCUMENT_TREE and it shows the same behaviour. Not sure what to do now though - file a bug with Lenovo? By the way, I also just discovered a good read: <a href=\"https://commonsware.com/Jetpack/pages/chap-content-001.html\" rel=\"nofollow noreferrer\">https://commonsware.com/Jetpack/pages/chap-content-001.html</a> while looking for <code>ActivityResultContracts.OpenDocumentTree</code> ;)",
      "score" : 0,
      "owner" : {
        "account_id" : 8692001,
        "reputation" : 13003,
        "user_id" : 6504633,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/8da50644a6ff87102823353ad2736762?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "obscure",
        "link" : "https://stackoverflow.com/users/6504633/obscure"
      },
      "creation_date" : 1748433992,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}