{
  "question" : {
    "question_id" : 79572891,
    "title" : "SceneView with CameraX , model loaded but not shown on UI",
    "body" : "<p>The models are loaded but not shown if I use it with Camera X and detections resulted by Tensorflow.</p>\n<p>I am adding the child to the scene view on detect listener method  in bindCameraUseCases(), any suggestion how to solve this.</p>\n<p>I tried to add the model in on create method in the activity itself and hide the preview, I can see the 3D objects loaded.\nIf I add the model on create method and do not hide the preview, I can see first the model and then preview  with detections without the models\nif I add the model on detect method on real time camera I don't see any models loaded, but in logging I can see that the model is loaded</p>\n<pre><code>\n  &lt;androidx.camera.view.PreviewView\n        android:id=&quot;@+id/view_finder&quot;\n        android:layout_width=&quot;0dp&quot;\n        android:layout_height=&quot;0dp&quot;\n        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;\n        app:layout_constraintDimensionRatio=&quot;3:4&quot;\n        app:layout_constraintEnd_toEndOf=&quot;parent&quot;\n        app:layout_constraintHorizontal_bias=&quot;0.5&quot;\n        app:layout_constraintStart_toStartOf=&quot;parent&quot;\n        app:layout_constraintTop_toTopOf=&quot;parent&quot;\n        app:layout_constraintVertical_bias=&quot;0.5&quot;\n        app:scaleType=&quot;fillStart&quot;\n        android:translationZ=&quot;0dp&quot;\n        android:alpha=&quot;0.5&quot;\n\n\n      /&gt;\n    &lt;io.github.sceneview.SceneView\n        android:id=&quot;@+id/sceneView&quot;\n        android:layout_width=&quot;0dp&quot;\n        android:layout_height=&quot;0dp&quot;\n        android:translationZ=&quot;5dp&quot;\n        app:layout_constraintTop_toTopOf=&quot;parent&quot;\n        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;\n        app:layout_constraintStart_toStartOf=&quot;parent&quot;\n        app:layout_constraintEnd_toEndOf=&quot;parent&quot;\n        app:layout_constraintDimensionRatio=&quot;3:4&quot; /&gt;\n\n    &lt;de.mb.mobileid.common.dependencyinjection.screens.securitydetection.OverlayView\n        android:id=&quot;@+id/overlay&quot;\n        android:layout_width=&quot;0dp&quot;\n        android:layout_height=&quot;0dp&quot;\n        android:translationZ=&quot;15dp&quot;\n        android:background=&quot;@android:color/transparent&quot;\n        android:alpha=&quot;1.0&quot;\n        app:layout_constraintTop_toTopOf=&quot;parent&quot;\n        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;\n        app:layout_constraintStart_toStartOf=&quot;parent&quot;\n        app:layout_constraintEnd_toEndOf=&quot;parent&quot;\n        app:layout_constraintDimensionRatio=&quot;3:4&quot;\n        /&gt;\n</code></pre>\n<pre><code>\nobject ARModelViewer {\n    var preloadedModelNode: ModelNode? = null\n    @JvmStatic\n    fun preloadModel(sceneView: SceneView, activity: ComponentActivity) {\n        Log.d(&quot;ARModelViewer&quot;, &quot;preloadModel() called&quot;)\n        activity.lifecycleScope.launch {\n            try {\n                val hdrFile = &quot;environments/studio_small_09_2k.hdr&quot;\n\n                sceneView.environmentLoader.loadHDREnvironment(hdrFile).apply {\n                    sceneView.indirectLight = this?.indirectLight\n                    sceneView.skybox = this?.skybox\n                }\n                Log.d(&quot;ARModelViewer&quot;, &quot;Setting camera position&quot;)\n                sceneView.cameraNode.position = Position(z = 4.0f)\n\n                val modelFile = &quot;arrow.glb&quot;\n                Log.d(&quot;ARModelViewer&quot;, &quot;Loading model file: $modelFile&quot;)\n                val modelInstance = sceneView.modelLoader.createModelInstance(modelFile)\n\n                Log.d(&quot;ARModelViewer&quot;, &quot;Creating model node&quot;)\n                preloadedModelNode =\n                    ModelNode(\n                        modelInstance = modelInstance,\n                        scaleToUnits = 2.0f,\n                    )\n                preloadedModelNode!!.scale = Scale(0.5f)\n\n                Log.d(&quot;ARModelViewer&quot;, &quot;Model node created and scaled&quot;)\n                // sceneView.addChildNode(preloadedModelNode!!)\n            } catch (e: Exception) {\n                Log.e(&quot;ARModelViewer&quot;, &quot;Error in preloadModel: ${e.message}&quot;, e)\n            }\n        }\n    }\n\n    @JvmStatic\n    fun addChildModel(sceneView: SceneView) {\n        Log.d(&quot;ARModelViewer&quot;, &quot;addChildModel() called&quot;)\n        if (preloadedModelNode != null) {\n            sceneView.addChildNode(preloadedModelNode!!)\n            Log.d(&quot;ARModelViewer&quot;, &quot;Model node added to scene&quot;)\n        } else {\n            Log.w(&quot;ARModelViewer&quot;, &quot;preloadedModelNode is null. Did you call preloadModel() first?&quot;)\n        }\n    }\n</code></pre>\n<pre><code>   public void bindCameraUseCases() {\n        // real-time frame updates, frame-by-frame TensorFlow detection\n        if (cameraProvider == null) {\n            throw new IllegalStateException(&quot;Camera initialization failed.&quot;);\n        }\n\n        int rotation = binding.viewFinder.getDisplay().getRotation();\n\n        CameraSelector cameraSelector =\n                new CameraSelector.Builder()\n                        .requireLensFacing(CameraSelector.LENS_FACING_BACK)\n                        .build();\n        // Preview Use Case\n        // Opens the camera\n        // Streams frames directly to the UI (typically a PreviewView)\n        // Does not give you access to the image data\n        preview =\n                new Preview.Builder()\n                        .setTargetAspectRatio(AspectRatio.RATIO_4_3)\n                        .setTargetRotation(rotation)\n                        .build();\n\n        imageAnalyzer =\n                new ImageAnalysis.Builder()\n                        .setTargetAspectRatio(AspectRatio.RATIO_4_3)\n                        .setBackpressureStrategy(ImageAnalysis.STRATEGY_KEEP_ONLY_LATEST)\n                        .setTargetRotation(rotation)\n                        .setOutputImageFormat(ImageAnalysis.OUTPUT_IMAGE_FORMAT_RGBA_8888)\n                        .build();\n\n        // ImageAnalysis Use Case\n        // Gets image frames from the camera\n        // Lets you read and manipulate pixel data (ImageProxy)\n        // Analyze each frame and send it as a rotated/mirrored Bitmap\n        imageAnalyzer.setAnalyzer(\n                cameraExecutor,\n                imageProxy -&gt; {\n                    Bitmap bitmapBuffer =\n                            Bitmap.createBitmap(\n                                    imageProxy.getWidth(),\n                                    imageProxy.getHeight(),\n                                    Bitmap.Config.ARGB_8888);\n                    imageProxy.getPlanes()[0].getBuffer().rewind();\n                    bitmapBuffer.copyPixelsFromBuffer(imageProxy.getPlanes()[0].getBuffer());\n                    imageProxy.close();\n                    Matrix matrix = new Matrix();\n                    //// Rotate and optionally mirror the bitmap\n                    matrix.postRotate((float) imageProxy.getImageInfo().getRotationDegrees());\n\n                    if (isFrontCamera) {\n                        matrix.postScale(-1f, 1f, imageProxy.getWidth(), imageProxy.getHeight());\n                    }\n                    // Apply transformation\n                    Bitmap rotatedBitmap =\n                            Bitmap.createBitmap(\n                                    bitmapBuffer,\n                                    0,\n                                    0,\n                                    bitmapBuffer.getWidth(),\n                                    bitmapBuffer.getHeight(),\n                                    matrix,\n                                    true);\n\n                    // Dispatch to all listeners for TensorFlow Lite inference\n                    if (rotatedBitmap != null) {\n                        for (Listener listener : getListeners()) {\n                            listener.detect(rotatedBitmap);\n                        }\n                    }\n                });\n\n        cameraProvider.unbindAll();\n        // Bind preview and image analysis to lifecycle\n        try {\n            camera =\n                    cameraProvider.bindToLifecycle(\n                            activity, cameraSelector, preview, imageAnalyzer);\n\n            preview.setSurfaceProvider(binding.viewFinder.getSurfaceProvider());\n        } catch (Exception exc) {\n            Log.e(&quot;OverlayView&quot;, &quot;Use case binding failed&quot;, exc);\n        }\n    }\n</code></pre>\n<p><strong>WHAT I TRIES</strong></p>\n<ul>\n<li>Camera now is black after setting the\napp:implementationMode=&quot;compatible&quot; in previewView, but now I can see\nthe detections and 3d Object</li>\n</ul>\n<p><a href=\"https://i.sstatic.net/CUBvnpvr.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/CUBvnpvr.jpg\" alt=\"enter image description here\" /></a></p>\n<ul>\n<li>i changed the alpha attribute to 0.5 i can see the camera with\ntransparent 3d Object which i dont need to not ruin the AR effect</li>\n</ul>\n",
    "tags" : [ "java", "android", "kotlin", "sceneview" ],
    "owner" : {
      "account_id" : 12046182,
      "reputation" : 386,
      "user_id" : 8811098,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/b7b6f834e9f1f91345482ebcddeb37cb?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Nadin Martini",
      "link" : "https://stackoverflow.com/users/8811098/nadin-martini"
    },
    "is_answered" : false,
    "view_count" : 53,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1744646355,
    "creation_date" : 1744625627,
    "link" : "https://stackoverflow.com/questions/79572891/sceneview-with-camerax-model-loaded-but-not-shown-on-ui",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}