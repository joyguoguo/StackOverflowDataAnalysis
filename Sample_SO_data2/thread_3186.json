{
  "question" : {
    "question_id" : 79568550,
    "title" : "SpringBoot @Cacheable with @Bean usage",
    "body" : "<p>I stumbled upon a code where @Cacheable annotation is used with @Bean and the class was annotated with @Configuration</p>\n<p>for example</p>\n<pre><code>@Configuration\npublic class CacheManager {\n\n  @Cacheable(&quot;urls&quot;)\n  @Bean\n  public Map&lt;String,String&gt; loadUrl(){\n   // hashmap population logic\n   return urlMap;\n  }\n\n\n}\n</code></pre>\n<p>Does this load all the caches at configuration phase ?\nOr the @Cacheable annotation will be ignored</p>\n<p>Chatgpt says</p>\n<p>This won't work — @Cacheable will be ignored. That's because Spring creates the bean during the configuration phase, and at that point caching proxies are not yet applied.</p>\n",
    "tags" : [ "java", "spring", "spring-boot", "caching", "configuration" ],
    "owner" : {
      "account_id" : 6283465,
      "reputation" : 103,
      "user_id" : 4883626,
      "user_type" : "registered",
      "accept_rate" : 83,
      "profile_image" : "https://graph.facebook.com/834121306654235/picture?type=large",
      "display_name" : "Ravindu Kottahachchi",
      "link" : "https://stackoverflow.com/users/4883626/ravindu-kottahachchi"
    },
    "is_answered" : true,
    "view_count" : 97,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1744373005,
    "creation_date" : 1744365493,
    "link" : "https://stackoverflow.com/questions/79568550/springboot-cacheable-with-bean-usage",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79568735,
    "question_id" : 79568550,
    "body" : "<p>It will not work.<br />\nYou have the default bean scope - <code>singleton</code>. It means that the bean creates once.</p>\n<p>So <code>loadUrl</code> will be executed on the application's startup.<br />\nLater, when you call <code>loadUrl</code> again, <code>loadUrl</code> will not be executed — <code>loadUrl</code> will return the initial value instead.<br />\nEven after the expiration timeout that you set in <code>cacheManager</code>, when you call <code>loadUrl</code> again, <code>loadUrl</code> will not be executed.</p>\n<p>You can test this:</p>\n<ul>\n<li>Add <code>System.out.println(&quot;loadUrl is executed&quot;)</code> to the <code>loadUrl</code> method.</li>\n<li>Set an expiration timeout.</li>\n<li>Start the application and see the print statement.</li>\n<li>Trigger a call to <code>loadUrl</code> (e.g., from a service) after the expiration timeout and see that the message is not printed again.</li>\n</ul>\n<p>If you want make <code>@Cacheable</code> to work as expected, then change the scope to prototype - <code>@Scope(&quot;prototype&quot;)</code>.</p>\n<p>But I would say, that it is strange approach.<br />\nUsually the <code>@Cacheable</code> annotation is placed on <code>public</code> methods of services or components.</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 10320634,
      "reputation" : 3398,
      "user_id" : 7613649,
      "user_type" : "registered",
      "accept_rate" : 25,
      "profile_image" : "https://www.gravatar.com/avatar/c95137fce225c304ac42743da3816d6c?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Geba",
      "link" : "https://stackoverflow.com/users/7613649/geba"
    },
    "creation_date" : 1744370868,
    "last_activity_date" : 1744373005,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140323994,
    "post_id" : 79568550,
    "body" : "The <code>@Cacheable</code> won&#39;t do a thing here. Also a bean of type <code>Map&lt;String, String&gt;</code> is a bit weird as well. It would work if your <code>CacheManager</code> (weird thing to be an <code>@Configuration</code> btw) would be a regular <code>@Component</code> or <code>@Service</code> and classes that needed the url map would call the <code>loadUrl</code> method.",
    "score" : 1,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126826,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1744365678,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}