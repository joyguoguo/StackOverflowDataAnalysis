{
  "question" : {
    "question_id" : 79623834,
    "title" : "Spring repository: find by id on related table",
    "body" : "<p>I have two models (written in Kotlin):</p>\n<pre><code>@Entity\n@Table(name = &quot;a&quot;)\nclass AModel(\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    var id: Long? = null,\n)\n</code></pre>\n<p>and a second one with a one to one relation to this previos one</p>\n<pre><code>@Entity\n@Table(name = &quot;b&quot;)\nclass BModel(\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    var id: Long? = null,\n\n    @field:OneToOne\n    @JoinColumn(name = &quot;original_a_id&quot;)\n    var originalA: AModel? = null,\n)\n</code></pre>\n<p>Then in BRepository I have a method to fetch a instance of B by the id of the related model A.</p>\n<p><code>fun findByOriginalAId(originalAId: Long): BModel?</code></p>\n<p>That until recently it worked correctly, but I'm trying to upgrade my app to Spring 3.4 and latest version of Hibernate and suddenly this is a problem.\nThis method on the repository no longer finds the model.\nThe only change I implemented was to change the type of the id fields to Long? and default to null, and deleage to hibernate the actual value generation, which I read I need to do.</p>\n<p>I found a workaround for the repository method to annotate it with</p>\n<p><code>@Query(&quot;SELECT b FROM BModel b WHERE b.originalA.id = :originalAId&quot;)</code></p>\n<p>But why do I suddenly need to do this? Is there a way to obtain the same result without the cumbersome annotation?</p>\n",
    "tags" : [ "java", "spring", "kotlin", "hibernate" ],
    "owner" : {
      "account_id" : 3103021,
      "reputation" : 1402,
      "user_id" : 3663124,
      "user_type" : "registered",
      "accept_rate" : 56,
      "profile_image" : "https://www.gravatar.com/avatar/2c576242a4d62aa0fac0ba0178105384?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "fedest",
      "link" : "https://stackoverflow.com/users/3663124/fedest"
    },
    "is_answered" : true,
    "view_count" : 95,
    "answer_count" : 2,
    "score" : 2,
    "last_activity_date" : 1747389658,
    "creation_date" : 1747326588,
    "link" : "https://stackoverflow.com/questions/79623834/spring-repository-find-by-id-on-related-table",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79624038,
    "question_id" : 79623834,
    "body" : "<p>I think I understand why it's not working.</p>\n<p>When using sprint 3.3.6 with hibernate 6.5 the mehod in question executes this SQL</p>\n<pre><code>select spm1_0.id,spm1_0.created_at,spm1_0.network_transaction_reference,spm1_0.original_donation_id,spm1_0.original_donation_ip,spm1_0.person_id,spm1_0.retry_attempts,spm1_0.scheduled_payment_type,spm1_0.status,spm1_0.status_detail,spm1_0.updated_at,spm1_0.uuid from scheduled_payments spm1_0 where spm1_0.original_donation_id=?\n</code></pre>\n<p>Now, with the upgraded dependencies and the change from Long to Long? it makes this query</p>\n<pre><code>select spm1_0.id,spm1_0.created_at,spm1_0.network_transaction_reference,spm1_0.original_donation_id,spm1_0.original_donation_ip,spm1_0.person_id,spm1_0.retry_attempts,spm1_0.scheduled_payment_type,spm1_0.status,spm1_0.status_detail,spm1_0.updated_at,spm1_0.uuid from scheduled_payments spm1_0 left join donations od1_0 on od1_0.id=spm1_0.original_donation_id where od1_0.id=?\n</code></pre>\n<p>It's now making a join for some reason.</p>\n<p>With the query annotation I mentioned it executes the same SQL as it did before.</p>\n<p>I'm not sure if the dependency upgrade of the change from Long to Long? caused this, will update if at one point I find that out.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 3103021,
      "reputation" : 1402,
      "user_id" : 3663124,
      "user_type" : "registered",
      "accept_rate" : 56,
      "profile_image" : "https://www.gravatar.com/avatar/2c576242a4d62aa0fac0ba0178105384?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "fedest",
      "link" : "https://stackoverflow.com/users/3663124/fedest"
    },
    "creation_date" : 1747335459,
    "last_activity_date" : 1747335459,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79624942,
    "question_id" : 79623834,
    "body" : "<p>As I was upgrading the version, I found that a left join was added</p>\n<p>when changing from <code>org.hibernate.orm:hibernate-core:6.4.10.Final</code>  to <code>org.hibernate.orm:hibernate-core:6.5.0.CR1</code></p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 27846305,
      "reputation" : 26,
      "user_id" : 21261682,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AEdFTp4AY2DhmhQde83hbd8VGRHZ0xN0XFRB8YiywGn1Gw=k-s256",
      "display_name" : "hyun",
      "link" : "https://stackoverflow.com/users/21261682/hyun"
    },
    "creation_date" : 1747389658,
    "last_activity_date" : 1747389658,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140430007,
    "post_id" : 79623834,
    "body" : "The result is the same",
    "score" : 0,
    "owner" : {
      "account_id" : 3103021,
      "reputation" : 1402,
      "user_id" : 3663124,
      "user_type" : "registered",
      "accept_rate" : 56,
      "profile_image" : "https://www.gravatar.com/avatar/2c576242a4d62aa0fac0ba0178105384?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "fedest",
      "link" : "https://stackoverflow.com/users/3663124/fedest"
    },
    "creation_date" : 1747335100,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140429777,
    "post_id" : 79623834,
    "body" : "Try renaming the method to <code>fun findByOriginalA_Id(originalAId: Long): BModel?</code> if it works I will add an answer to you",
    "score" : 0,
    "owner" : {
      "account_id" : 209503,
      "reputation" : 23867,
      "user_id" : 460557,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/b4565f97815833390c9c880e9e8522e4?s=256&d=identicon&r=PG",
      "display_name" : "Jorge Campos",
      "link" : "https://stackoverflow.com/users/460557/jorge-campos"
    },
    "creation_date" : 1747330244,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79624942" : [ {
      "comment_id" : 140433744,
      "post_id" : 79624942,
      "body" : "Yeah, same here.",
      "score" : 0,
      "owner" : {
        "account_id" : 3103021,
        "reputation" : 1402,
        "user_id" : 3663124,
        "user_type" : "registered",
        "accept_rate" : 56,
        "profile_image" : "https://www.gravatar.com/avatar/2c576242a4d62aa0fac0ba0178105384?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "fedest",
        "link" : "https://stackoverflow.com/users/3663124/fedest"
      },
      "creation_date" : 1747425653,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}