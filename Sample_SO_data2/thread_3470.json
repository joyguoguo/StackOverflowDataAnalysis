{
  "question" : {
    "question_id" : 79549351,
    "title" : "JAXB ClassNotFoundException even though the dependencies are available",
    "body" : "<p>I am using Hibernate in my Java application and I just can not seem to get rid of this ClassNotFoundException with JAXB. I have literally tried everything but I can not seem to get it fixed.</p>\n<p>I am using Java 21.</p>\n<p>Here is the error I get:</p>\n<pre><code>    Caused by: jakarta.xml.bind.JAXBException: Implementation of Jakarta XML Binding-API has not been found on module path or classpath.\n    at jakarta.xml.bind.ContextFinder.newInstance(ContextFinder.java:252) ~[?:?]\n    at jakarta.xml.bind.ContextFinder.newInstance(ContextFinder.java:240) ~[?:?]\n    at jakarta.xml.bind.ContextFinder.find(ContextFinder.java:381) ~[?:?]\n    at jakarta.xml.bind.JAXBContext.newInstance(JAXBContext.java:605) ~[?:?]\n    at jakarta.xml.bind.JAXBContext.newInstance(JAXBContext.java:546) ~[?:?]\n    at org.hibernate.boot.cfgxml.internal.JaxbCfgProcessor.unmarshal(JaxbCfgProcessor.java:121) ~[?:?]\n    ... 25 more\nCaused by: java.lang.ClassNotFoundException: org.glassfish.jaxb.runtime.v2.ContextFactory\n    at java.base/java.net.URLClassLoader.findClass(URLClassLoader.java:445) ~[?:?]\n    at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:593) ~[?:?]\n    at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:526) ~[?:?]\n    at jakarta.xml.bind.ServiceLoaderUtil.nullSafeLoadClass(ServiceLoaderUtil.java:113) ~[?:?]\n    at jakarta.xml.bind.ServiceLoaderUtil.safeLoadClass(ServiceLoaderUtil.java:146) ~[?:?]\n    at jakarta.xml.bind.ContextFinder.newInstance(ContextFinder.java:250) ~[?:?]\n    at jakarta.xml.bind.ContextFinder.newInstance(ContextFinder.java:240) ~[?:?]\n    at jakarta.xml.bind.ContextFinder.find(ContextFinder.java:381) ~[?:?]\n    at jakarta.xml.bind.JAXBContext.newInstance(JAXBContext.java:605) ~[?:?]\n    at jakarta.xml.bind.JAXBContext.newInstance(JAXBContext.java:546) ~[?:?]\n    at org.hibernate.boot.cfgxml.internal.JaxbCfgProcessor.unmarshal(JaxbCfgProcessor.java:121) ~[?:?]\n    ... 25 more\n</code></pre>\n<p>And here is my full POM file:</p>\n<pre><code>    &lt;groupId&gt;org.test.project&lt;/groupId&gt;\n    &lt;artifactId&gt;project-core&lt;/artifactId&gt;\n    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n\n    &lt;name&gt;project-core&lt;/name&gt;\n    &lt;description&gt;test project&lt;/description&gt;\n\n    &lt;repositories&gt;\n        &lt;repository&gt;\n            &lt;id&gt;spigot-repo&lt;/id&gt;\n            &lt;url&gt;https://hub.spigotmc.org/nexus/content/repositories/snapshots/&lt;/url&gt;\n        &lt;/repository&gt;\n        &lt;repository&gt;\n            &lt;id&gt;minecraft-repo&lt;/id&gt;\n            &lt;url&gt;https://libraries.minecraft.net/&lt;/url&gt;\n        &lt;/repository&gt;\n    &lt;/repositories&gt;\n\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.spigotmc&lt;/groupId&gt;\n            &lt;artifactId&gt;spigot-api&lt;/artifactId&gt;\n            &lt;version&gt;1.21.4-R0.1-SNAPSHOT&lt;/version&gt;\n            &lt;scope&gt;provided&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;!-- https://mvnrepository.com/artifact/org.hibernate.orm/hibernate-core --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.hibernate.orm&lt;/groupId&gt;\n            &lt;artifactId&gt;hibernate-core&lt;/artifactId&gt;\n            &lt;version&gt;6.6.12.Final&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;!-- https://mvnrepository.com/artifact/com.mysql/mysql-connector-j --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.mysql&lt;/groupId&gt;\n            &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;\n            &lt;version&gt;9.2.0&lt;/version&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n\n    &lt;build&gt;\n        &lt;defaultGoal&gt;clean install&lt;/defaultGoal&gt;\n        &lt;resources&gt;\n            &lt;resource&gt;\n                &lt;directory&gt;${project.basedir}/src/main/resources&lt;/directory&gt;\n                &lt;filtering&gt;true&lt;/filtering&gt;\n            &lt;/resource&gt;\n        &lt;/resources&gt;\n        &lt;plugins&gt;\n            &lt;!-- Maven Compiler Plugin --&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n                &lt;version&gt;3.8.1&lt;/version&gt;\n                &lt;configuration&gt;\n                    &lt;source&gt;21&lt;/source&gt;\n                    &lt;target&gt;21&lt;/target&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n\n            &lt;!-- Maven Shade Plugin --&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;\n                &lt;version&gt;3.2.4&lt;/version&gt;\n                &lt;executions&gt;\n                    &lt;execution&gt;\n                        &lt;phase&gt;package&lt;/phase&gt;\n                        &lt;goals&gt;\n                            &lt;goal&gt;shade&lt;/goal&gt;\n                        &lt;/goals&gt;\n                        &lt;configuration&gt;\n                            &lt;transformers&gt;\n                                &lt;transformer implementation=&quot;org.apache.maven.plugins.shade.resource.ServicesResourceTransformer&quot;/&gt;\n                            &lt;/transformers&gt;\n                        &lt;/configuration&gt;\n                    &lt;/execution&gt;\n                &lt;/executions&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n\n&lt;/project&gt;\n</code></pre>\n<p>Please note, I removed the JAXB dependencies in this POM file but I have already tried adding the JAXB API and runtime implementation and it remained to give me this error. Like I said before, I decompiled my JAR file and org.glassfish.jaxb.runtime.v2.ContextFactory is compiled fine as it is part of the Hibernate dependency.</p>\n<p>These are the dependencies I tried adding before:</p>\n<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;jakarta.xml.bind&lt;/groupId&gt;\n    &lt;artifactId&gt;jakarta.xml.bind-api&lt;/artifactId&gt;\n    &lt;version&gt;4.0.0&lt;/version&gt; \n&lt;/dependency&gt;\n&lt;!-- JAXB Reference Implementation --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.glassfish.jaxb&lt;/groupId&gt;\n    &lt;artifactId&gt;jaxb-runtime&lt;/artifactId&gt;\n    &lt;version&gt;4.0.0&lt;/version&gt; \n    &lt;scope&gt;runtime&lt;/scope&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>I also tried multiple versions of these dependencies. And tried the sun dependencies which also did not work.</p>\n<p>I have tried to include classpaths in the MANIFEST.mf file - this did not fix the problem. And I tried using Eclipse's Moxy dependency instead of JAXB (and included jaxb.properties), this did not fix the problem either.</p>\n<p>Furthermore, I tried to add the jaxb dependencies and excluded them from the Hibernate dependency to ensure they were not conflicting, this did not fix the problem either.</p>\n<p>I tried running it on multiple Java versions and as you can guess that was not successful either.</p>\n<p>I have tried every possible thing to get rid of the java.lang.ClassNotFoundException: org.glassfish.jaxb.runtime.v2.ContextFactory and get Hibernate to work, but I just can not seem to get it fixed. What more can I try? Help is very appreciated!</p>\n",
    "tags" : [ "java", "hibernate", "maven" ],
    "owner" : {
      "account_id" : 41131912,
      "reputation" : 23,
      "user_id" : 30136027,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5676295d04ad7fc360a7a5a22628aebd?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Quinten",
      "link" : "https://stackoverflow.com/users/30136027/quinten"
    },
    "is_answered" : true,
    "view_count" : 586,
    "answer_count" : 1,
    "score" : 2,
    "last_activity_date" : 1743599960,
    "creation_date" : 1743548656,
    "link" : "https://stackoverflow.com/questions/79549351/jaxb-classnotfoundexception-even-though-the-dependencies-are-available",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79549363,
    "question_id" : 79549351,
    "body" : "<p>Try to add the correct JAXB Dependencies dependencies like this (no scope!):</p>\n<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;jakarta.xml.bind&lt;/groupId&gt;\n    &lt;artifactId&gt;jakarta.xml.bind-api&lt;/artifactId&gt;\n    &lt;version&gt;4.0.0&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.glassfish.jaxb&lt;/groupId&gt;\n    &lt;artifactId&gt;jaxb-runtime&lt;/artifactId&gt;\n    &lt;version&gt;4.0.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>It is important that you add them to <code>pom.xml</code> exactly like this without <code>&lt;scope&gt;runtime&lt;/scope&gt;</code> since you are using the Shade plugin to package everything.</p>\n<p><strong>Edit:</strong></p>\n<p>Ensure there are no conflicting JAXB APIs or outdated javax.xml.bind versions. You can do this with:</p>\n<pre><code>mvn dependency:tree\n</code></pre>\n<h3>Solution:</h3>\n<p>Spigot/Bukkit loads plugins with a separate classloader, while JAXB uses the context classloader. This might be the issue if nothing else helped. Put this in your plugins <code>onEnable()</code> before anything from Hibernate runs: <code>Thread.currentThread().setContextClassLoader(MyPlugin.class.getClassLoader());</code></p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 18999437,
      "reputation" : 798,
      "user_id" : 13867124,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3f75c892f3b54042e7400ee33cd8af96?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "AztecCodes",
      "link" : "https://stackoverflow.com/users/13867124/azteccodes"
    },
    "creation_date" : 1743549338,
    "last_activity_date" : 1743599960,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140290054,
    "post_id" : 79549351,
    "body" : "Spigot/Bukkit loads plugins with a separate classloader, while JAXB uses the context classloader. This might be the issue if nothing else helped. Put this in your plugins <code>onEnable()</code> before anything from Hibernate runs: <code>Thread.currentThread().setContextClassLoader(MyPlugin.class.&zwnj;&#8203;getClassLoader()); </code>  Please tell me if this helped, if the options in my answer didn&#39;t help.",
    "score" : 0,
    "owner" : {
      "account_id" : 18999437,
      "reputation" : 798,
      "user_id" : 13867124,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3f75c892f3b54042e7400ee33cd8af96?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "AztecCodes",
      "link" : "https://stackoverflow.com/users/13867124/azteccodes"
    },
    "creation_date" : 1743591486,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79549363" : [ {
      "comment_id" : 140290611,
      "post_id" : 79549363,
      "body" : "@Quinten Glad to hear! You are welcome!",
      "score" : 0,
      "owner" : {
        "account_id" : 18999437,
        "reputation" : 798,
        "user_id" : 13867124,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/3f75c892f3b54042e7400ee33cd8af96?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "AztecCodes",
        "link" : "https://stackoverflow.com/users/13867124/azteccodes"
      },
      "creation_date" : 1743599876,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140290332,
      "post_id" : 79549363,
      "body" : "Adding <code>Thread.currentThread().setContextClassLoader(MyPlugin.class.&zwnj;&#8203;getClassLoader());</code> in my onEnable() solved the issue! Thank you so much for the help!",
      "score" : 2,
      "owner" : {
        "account_id" : 41131912,
        "reputation" : 23,
        "user_id" : 30136027,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/5676295d04ad7fc360a7a5a22628aebd?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Quinten",
        "link" : "https://stackoverflow.com/users/30136027/quinten"
      },
      "creation_date" : 1743595860,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140290098,
      "post_id" : 79549363,
      "body" : "@Quinten I formulated it wrong. I wanted to say that you should double check if this is really included.  However can you add the full output of the <code>jar -tf your-jar-file.jar</code> to your answer? This might help.",
      "score" : 0,
      "owner" : {
        "account_id" : 18999437,
        "reputation" : 798,
        "user_id" : 13867124,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/3f75c892f3b54042e7400ee33cd8af96?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "AztecCodes",
        "link" : "https://stackoverflow.com/users/13867124/azteccodes"
      },
      "creation_date" : 1743592133,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140290075,
      "post_id" : 79549363,
      "body" : "What did you mean by including the service files? As you said, I am already using the transformer that you mentioned, so I don&#39;t see what&#39;s different from my implementation.  Also, I checked mvn dependency:tree and there are no conflicting JAXB APIs. I really don&#39;t understand whats wrong. I can call JAXBContextFactory in my main code and it&#39;s working fine, it just seems the Hibernate dependency can&#39;t seem to access it for some reason..",
      "score" : 0,
      "owner" : {
        "account_id" : 41131912,
        "reputation" : 23,
        "user_id" : 30136027,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/5676295d04ad7fc360a7a5a22628aebd?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Quinten",
        "link" : "https://stackoverflow.com/users/30136027/quinten"
      },
      "creation_date" : 1743591769,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140290003,
      "post_id" : 79549363,
      "body" : "@Quinten If this doesn&#39;t work create a new Maven project, add Hibernate and the correct JAXB dependencies and manually test <code>JAXBContext.newInstance(...)</code> to find out what the issue is.",
      "score" : 0,
      "owner" : {
        "account_id" : 18999437,
        "reputation" : 798,
        "user_id" : 13867124,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/3f75c892f3b54042e7400ee33cd8af96?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "AztecCodes",
        "link" : "https://stackoverflow.com/users/13867124/azteccodes"
      },
      "creation_date" : 1743590704,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140289971,
      "post_id" : 79549363,
      "body" : "@Quinten Try to include the service files in the Shaded Jar. I will edit my answer with the code.",
      "score" : 0,
      "owner" : {
        "account_id" : 18999437,
        "reputation" : 798,
        "user_id" : 13867124,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/3f75c892f3b54042e7400ee33cd8af96?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "AztecCodes",
        "link" : "https://stackoverflow.com/users/13867124/azteccodes"
      },
      "creation_date" : 1743590440,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140289668,
      "post_id" : 79549363,
      "body" : "Unfortunately this did not solve it. I am still getting the ClassNotFoundException.",
      "score" : 0,
      "owner" : {
        "account_id" : 41131912,
        "reputation" : 23,
        "user_id" : 30136027,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/5676295d04ad7fc360a7a5a22628aebd?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Quinten",
        "link" : "https://stackoverflow.com/users/30136027/quinten"
      },
      "creation_date" : 1743586198,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}