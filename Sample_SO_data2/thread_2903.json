{
  "question" : {
    "question_id" : 79589058,
    "title" : "Migrating from Spring message broker to RabbitMQ",
    "body" : "<p>I'm trying to migrate from using the Spring <a href=\"https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/messaging/simp/config/MessageBrokerRegistry.html\" rel=\"nofollow noreferrer\"><code>MessageBrokerRegistry</code></a> <a href=\"https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/messaging/simp/config/SimpleBrokerRegistration.html\" rel=\"nofollow noreferrer\"><code>SimpleBrokerRegistration</code></a> to the <a href=\"https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/messaging/simp/config/StompBrokerRelayRegistration.html\" rel=\"nofollow noreferrer\"><code>StompBrokerRelayRegistration</code></a> connected to RabbitMQ.</p>\n<p>My project consists of one client and one server. The server has a <code>@MessageMapping(&quot;/matches/{matchId}/moves&quot;)</code> where the <code>matchId</code> is a randomly generated Java UUID. After handling an incoming request from the client, the server publishes a status update to <code>/topic/{matchId}/moves</code> to which the client subscribes to. The original Spring message broker looks like:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public void configureMessageBroker(MessageBrokerRegistry config) {\n    config.enableSimpleBroker(&quot;/topic/&quot;); \n}\n</code></pre>\n<p>I am publishing like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>private final SimpMessagingTemplate msgTemplage;\npublic void broadcastMove(UUID matchId, MoveResponseDTO moveResponseDTO) {\n    msgTemplate.convertAndSend(&quot;/topic/&quot; + matchId + &quot;/moves&quot;, moveResponseDTO);\n}\n</code></pre>\n<p>This works without issues.</p>\n<p>I want to migrate to using RabbitMQ as a message broker. I've set up RabbitMQ as a Docker container and verified that 1) it works and 2) it listens for STOMP on port 61613.</p>\n<p><a href=\"https://i.sstatic.net/xBLCzGiI.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/xBLCzGiI.png\" alt=\"RabbitMQ Port configuration\" /></a></p>\n<p>I then modified my MessageBroker method to:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public void configureMessageBroker(MessageBrokerRegistry config) {\n    //config.enableSimpleBroker(&quot;/topic/&quot;);\n    \n    config.enableStompBrokerRelay(&quot;/topic/&quot;)\n        .setRelayHost(&quot;localhost&quot;)\n        .setRelayPort(61613)\n        .setClientLogin(&quot;guest&quot;)\n        .setClientPasscode(&quot;guest&quot;);\n        \n    //config.setApplicationDestinationPrefixes(&quot;/matches&quot;);\n}\n</code></pre>\n<p>When trying this I get a <code>ERROR 27720...payload='/be31be41-a373-4aae-81e6-2d29302f9d5d/moves' is not a valid topic destination</code>.</p>\n<p>I've tried using different arguments for the <code>BrokerRelay()</code> and <code>setApplicationDestinationPrefixes()</code> without success. I have also asked chatGPT who suggests a client error. But this seems strange since the client didn't change.</p>\n<p>What am I missing?</p>\n",
    "tags" : [ "java", "spring", "rabbitmq", "stomp" ],
    "owner" : {
      "account_id" : 11462935,
      "reputation" : 1,
      "user_id" : 8402026,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-PME7U6VI5ZQ/AAAAAAAAAAI/AAAAAAAAAJM/LAlwGycwbgs/s256-rj/photo.jpg",
      "display_name" : "Hugo Friberg",
      "link" : "https://stackoverflow.com/users/8402026/hugo-friberg"
    },
    "is_answered" : false,
    "view_count" : 50,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1745442819,
    "creation_date" : 1745425059,
    "link" : "https://stackoverflow.com/questions/79589058/migrating-from-spring-message-broker-to-rabbitmq",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79589280,
    "question_id" : 79589058,
    "body" : "<p>RabbitMQ is really particular with how you specify your paths. My new path changed from <code>/topic/{matchId}/moves</code> -&gt; <code>/exchange/amq.topic/match.{matchId}.moves</code>. Here I am specifying Rabbit to use the <code>amq.topic</code> exchange and to route it to <code>match/{matchId}/moves</code>.</p>\n<p>After adjusting this on both the client and server the issue was resolved.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 11462935,
      "reputation" : 1,
      "user_id" : 8402026,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-PME7U6VI5ZQ/AAAAAAAAAAI/AAAAAAAAAJM/LAlwGycwbgs/s256-rj/photo.jpg",
      "display_name" : "Hugo Friberg",
      "link" : "https://stackoverflow.com/users/8402026/hugo-friberg"
    },
    "creation_date" : 1745433107,
    "last_activity_date" : 1745436535,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79589280" : [ {
      "comment_id" : 140362866,
      "post_id" : 79589280,
      "body" : "If this is the correct answer please mark it as such to help other users who have this same question in the future.",
      "score" : 0,
      "owner" : {
        "account_id" : 11434008,
        "reputation" : 36292,
        "user_id" : 8381946,
        "user_type" : "registered",
        "profile_image" : "https://lh3.googleusercontent.com/-ORs8fPNVzDU/AAAAAAAAAAI/AAAAAAAADBs/F3IsdsProVY/s256-rj/photo.jpg",
        "display_name" : "Justin Bertram",
        "link" : "https://stackoverflow.com/users/8381946/justin-bertram"
      },
      "creation_date" : 1745436601,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}