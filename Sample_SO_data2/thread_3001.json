{
  "question" : {
    "question_id" : 79581684,
    "title" : "How to retrieve only the visible (inside of border) text of PDField?",
    "body" : "<p>I'm working on a Java project using Apache PDFBox 3.0.3. I want to display a string in a PDField of an AcroForm. The field allows multi-line text and about 9 lines of text can fit in it.</p>\n<p>The problem is that the length of the given string can be even longer than that. In that case, I want to add an empty copy of the same page to the document and continue to fill the new PDField with the part of the given string that did not fit into the first field.</p>\n<p>Adding new pages is already working, but not the second part, because I cannot manage to let the program know, where the text in the first field ended.</p>\n<p>My idea is to check which part of the string is visible in the PDField and to cut this part out of the given string. Then I would put the part of the string which is left into the next PDField an so on.</p>\n<p>The problem is that the first PDField does actually contain all of the text as a value, but only the first 9 lines are visible (the rest is outside of the field's borders).</p>\n<p>When I execute the following line, I get the whole text of the field (also the text which is outside of the field's borders and therefore invisible), which is worthless because I want to get <em>only</em> the visible part:</p>\n<pre class=\"lang-java prettyprint-override\"><code>acroForm.getField(&quot;fieldname&quot;).getValueAsString();\n</code></pre>\n<p>How can I retrieve only the visible part of the text in a PDField?</p>\n<p>Setting limits for the number of characters is not an option, because it ignores line breaks etc.</p>\n",
    "tags" : [ "java", "pdf", "pdfbox", "acrofields" ],
    "owner" : {
      "account_id" : 29060554,
      "reputation" : 19,
      "user_id" : 22261336,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c47937c02449181b5b6eb9b5c8ecafa5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "felixschoene",
      "link" : "https://stackoverflow.com/users/22261336/felixschoene"
    },
    "is_answered" : true,
    "view_count" : 115,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1745149203,
    "creation_date" : 1745008131,
    "link" : "https://stackoverflow.com/questions/79581684/how-to-retrieve-only-the-visible-inside-of-border-text-of-pdfield",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79583313,
    "question_id" : 79581684,
    "body" : "<p>I finally found a solution for retrieving only the visible part of a PDField.</p>\n<pre><code>//Flatten the AcroForm first to remove the PDField but keep the text.\nacroForm.flatten()\n//Get the page of the document where the text is located.\nPDPage page = document.getPage(0);\n//Create a PDFTextStripperByArea.\nPDFTextStripperByArea stripper = new PDFTextStripperByArea();\n//Create a Rectangle2D. All the text which is located within the rectangle will be\n//included in the stripper. So put the rectangle excactly above the visible part of\n//the text. The params for the coordinates are (x, y, width, height). You likely need\n//to experiment a bit to find the right values.\nRectangle2D rectangle2D = new Rectangle2D.Float(50, 525, 500, 140);\n//Add the rectangle as a region for the stripper.\nstripper.addRegion(&quot;region&quot;, rectangle2D);\n//Extract the region.\nstripper.extractRegions(page);\n//Get the text.\nString text = stripper.getTextForRegion(&quot;region&quot;);\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 29060554,
      "reputation" : 19,
      "user_id" : 22261336,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c47937c02449181b5b6eb9b5c8ecafa5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "felixschoene",
      "link" : "https://stackoverflow.com/users/22261336/felixschoene"
    },
    "creation_date" : 1745149079,
    "last_activity_date" : 1745149203,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140349754,
    "post_id" : 79581684,
    "body" : "Nothing out of the box... you should look at the source code of <code>AppearanceGeneratorHelper.java</code>, and focus on <code>calculateFontSize()</code>.",
    "score" : 0,
    "owner" : {
      "account_id" : 255529,
      "reputation" : 19235,
      "user_id" : 535646,
      "user_type" : "registered",
      "accept_rate" : 40,
      "profile_image" : "https://i.sstatic.net/yGyps.jpg?s=256",
      "display_name" : "Tilman Hausherr",
      "link" : "https://stackoverflow.com/users/535646/tilman-hausherr"
    },
    "creation_date" : 1745040109,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79583313" : [ {
      "comment_id" : 140352145,
      "post_id" : 79583313,
      "body" : "Cool, I didn&#39;t think of that one. Note that the coordinates are java coordinates, not PDF coordinates.",
      "score" : 1,
      "owner" : {
        "account_id" : 255529,
        "reputation" : 19235,
        "user_id" : 535646,
        "user_type" : "registered",
        "accept_rate" : 40,
        "profile_image" : "https://i.sstatic.net/yGyps.jpg?s=256",
        "display_name" : "Tilman Hausherr",
        "link" : "https://stackoverflow.com/users/535646/tilman-hausherr"
      },
      "creation_date" : 1745149401,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}