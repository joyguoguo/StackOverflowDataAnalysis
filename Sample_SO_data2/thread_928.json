{
  "question" : {
    "question_id" : 79762691,
    "title" : "Java Batch ItemProcessor lifecycle missing?",
    "body" : "<p>An <a href=\"https://docs.oracle.com/javaee/7/api/javax/batch/api/chunk/ItemProcessor.html\" rel=\"nofollow noreferrer\">ItemProcessor</a>, as defined by Java Batch contains only one method: <code>processItem(Object item)</code></p>\n<p>What I am missing are lifecycle events like <code>open()</code> and <code>close()</code> - similar to the methods on ItemReader or ItemWriter. I mimicked <code>open()</code> where <code>processItem(item)</code> will detect it is called for the first time and trigger a call to my open method.</p>\n<p>But as close() is still missing I notice more complex ItemProcessors that need to cleanup after use have no chance of doing so. I tried to add the interface <a href=\"https://docs.oracle.com/javaee/7/api/javax/batch/api/chunk/listener/ChunkListener.html\" rel=\"nofollow noreferrer\">ChunkListener</a> to benefit from the <code>afterChunk()</code> method, but at least in JBeret and BatchEE implementations that method is not called on a chunk's processor. It is the same for StepListener. Registering the ItemProcessor as Listener will just create another instance of the same class and cleanup will fail again.</p>\n<p>Also I tried to use the <code>finalize()</code> method, but that seems not sufficient/reliable either.</p>\n<p>If ItemProcessor is not intended to cleanup after use, how would I have to design the application such that complex decisions (which may require to connect to other systems like database) can be taken?</p>\n",
    "tags" : [ "java", "jsr352", "java-batch" ],
    "owner" : {
      "account_id" : 5289146,
      "reputation" : 9940,
      "user_id" : 4222206,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/416696430ab23f397a5dbeda73e72896?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "queeg",
      "link" : "https://stackoverflow.com/users/4222206/queeg"
    },
    "is_answered" : true,
    "view_count" : 87,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1759615982,
    "creation_date" : 1757666082,
    "link" : "https://stackoverflow.com/questions/79762691/java-batch-itemprocessor-lifecycle-missing",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79782682,
    "question_id" : 79762691,
    "body" : "<p>Jakarta Batch treats all batch artifacts as managed beans. CDI allows them to use events like</p>\n<pre><code>    @PostConstruct\n    public void postConstruct() {\n        ...\n    }\n\n    @PreDestroy\n    public void preDestroy() {\n        ...\n    }\n</code></pre>\n<p>With them the necessary cleanup can be performed after use and before garbage collection kicks in.</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 5289146,
      "reputation" : 9940,
      "user_id" : 4222206,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/416696430ab23f397a5dbeda73e72896?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "queeg",
      "link" : "https://stackoverflow.com/users/4222206/queeg"
    },
    "creation_date" : 1759611936,
    "last_activity_date" : 1759615982,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140734626,
    "post_id" : 79762691,
    "body" : "I investigated on JBeret custom scopes and am checking more on CDI now. Seems in combination with @PreDestroy I am getting a cleanup.",
    "score" : 0,
    "owner" : {
      "account_id" : 5289146,
      "reputation" : 9940,
      "user_id" : 4222206,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/416696430ab23f397a5dbeda73e72896?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "queeg",
      "link" : "https://stackoverflow.com/users/4222206/queeg"
    },
    "creation_date" : 1757838129,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140732763,
    "post_id" : 79762691,
    "body" : "I&#39;d think the PartitionedScoped bean would work then since the chunk is local to a given partition.",
    "score" : 0,
    "owner" : {
      "account_id" : 1623729,
      "reputation" : 5370,
      "user_id" : 1499766,
      "user_type" : "registered",
      "accept_rate" : 86,
      "profile_image" : "https://www.gravatar.com/avatar/930600717d161c99c999d1a703fe8690?s=256&d=identicon&r=PG",
      "display_name" : "Scott Kurz",
      "link" : "https://stackoverflow.com/users/1499766/scott-kurz"
    },
    "creation_date" : 1757715742,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140732542,
    "post_id" : 79762691,
    "body" : "A StepScoped bean. Indeed something to consider. Although I need to be careful - my batch is running multithreaded partitions.",
    "score" : 0,
    "owner" : {
      "account_id" : 5289146,
      "reputation" : 9940,
      "user_id" : 4222206,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/416696430ab23f397a5dbeda73e72896?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "queeg",
      "link" : "https://stackoverflow.com/users/4222206/queeg"
    },
    "creation_date" : 1757706294,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140731821,
    "post_id" : 79762691,
    "body" : "One thing to consider would be using JBeret&#39;s StepScoped <a href=\"https://jberet.gitbooks.io/jberet-user-guide/content/custom_cdi_scopes/\" rel=\"nofollow noreferrer\">jberet.gitbooks.io/jberet-user-guide/content/custom_cdi_scop&zwnj;&#8203;es</a> and refactoring the more complex stuff (requiring cleanup) into a bean that you could then inject to and invoke from each of the ItemProcessor and ChunkListener events.    Technically you can do this kind of thing with StepContext without CDI, but with only the two transient/persistent UserData objects it can get a bit messy if you&#39;d rather work with &gt;1 object.",
    "score" : 1,
    "owner" : {
      "account_id" : 1623729,
      "reputation" : 5370,
      "user_id" : 1499766,
      "user_type" : "registered",
      "accept_rate" : 86,
      "profile_image" : "https://www.gravatar.com/avatar/930600717d161c99c999d1a703fe8690?s=256&d=identicon&r=PG",
      "display_name" : "Scott Kurz",
      "link" : "https://stackoverflow.com/users/1499766/scott-kurz"
    },
    "creation_date" : 1757686296,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}