{
  "question" : {
    "question_id" : 79813002,
    "title" : "Sometimes wrong output in Java queue simulation",
    "body" : "<p><strong>Problem summary:</strong><br />\nEach person in line has <code>tickets[i]</code> tickets to buy. Every second</p>\n<ul>\n<li><p>The person at the front buys <strong>one ticket</strong>.</p>\n</li>\n<li><p>If they still need more tickets, they move to the <em>end of the queue</em>.</p>\n</li>\n</ul>\n<p>We need to find how many seconds it takes for the person at index <code>k</code> to finish buying their tickets.</p>\n<p>My code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public int timeRequiredToBuy(int[] tickets, int k) {\n    Queue&lt;Integer&gt; queue = new LinkedList&lt;&gt;();\n    for (int i = 0; i &lt; tickets.length; i++) {\n        queue.add(i);\n    }\n\n    int time = 0;\n    while (!queue.isEmpty()) {\n        int person = queue.poll();\n        if (!queue.isEmpty()) {\n            tickets[queue.peek()]--;\n        } else {\n            tickets[person]--;\n        }\n        time++;\n        if (tickets[person] &gt; 0) {\n            queue.add(person);\n        }\n        if (person == k &amp;&amp; tickets[person] == 0) {\n            break;\n        }\n    }\n\n    return time;\n}\n</code></pre>\n<pre><code>tickets =\n[83,86,38,31,59,25,89,71,54,71,84]\nk =1\nOutput\n688\nExpected\n687\n</code></pre>\n<p>Why does this logic result in a value that is higher than the expected one? How would I correctly track the tickets for each person without accidentally decrementing the wrong one?</p>\n",
    "tags" : [ "java", "data-structures", "queue" ],
    "owner" : {
      "account_id" : 44595710,
      "reputation" : 11,
      "user_id" : 31835018,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/0gIbdRCY.jpg?s=256",
      "display_name" : "Hercules",
      "link" : "https://stackoverflow.com/users/31835018/hercules"
    },
    "is_answered" : true,
    "view_count" : 109,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1762589222,
    "creation_date" : 1762584175,
    "link" : "https://stackoverflow.com/questions/79813002/sometimes-wrong-output-in-java-queue-simulation",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79813008,
    "question_id" : 79813002,
    "body" : "<p>The problem is in this part:</p>\n<pre><code>        if (!queue.isEmpty()) {\n            tickets[queue.peek()]--;\n        } else {\n            tickets[person]--;\n        }\n</code></pre>\n<p>There is no reason to make this distinction. Each iteration of the loop should <em>only</em> touch the number of tickets of the <code>person</code> that was taken from the queue, not of the next entry in the queue -- that will be dealt with in the next iteration.</p>\n<p>So eliminate that distinction, and just do:</p>\n<pre><code>        tickets[person]--;\n</code></pre>\n<p>Note that although this will work, the goal of the challenge is probably to look for a more efficient algorithm.</p>\n<p>Hint for a more efficient approach:</p>\n<blockquote class=\"spoiler\">\n<p> How many times will the person at index i buy a ticket, (a) when i &lt; k, (b) when i = k, and (c) when i &gt; k?</p>\n</blockquote>\n<p>Efficient solution:</p>\n<blockquote class=\"spoiler\">\n<p><code>class Solution {\n     public int timeRequiredToBuy(int[] tickets, int k) {\n         int numTickets = tickets[k];\n         int time = 0;\n         for (int i = 0; i &lt; tickets.length; i++) {\n             time += i != k ? Math.min(tickets[i], numTickets)\n                            : numTickets--; // Decrement once we arrive at k\n         }\n         return time;\n     }\n }</code></p>\n</blockquote>\n",
    "score" : 2,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 7142980,
      "reputation" : 357210,
      "user_id" : 5459839,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/lUUgh.png?s=256",
      "display_name" : "trincot",
      "link" : "https://stackoverflow.com/users/5459839/trincot"
    },
    "creation_date" : 1762584901,
    "last_activity_date" : 1762586265,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140843094,
    "post_id" : 79813002,
    "body" : "@user85421 It should be clear without it. And it attracts crap answers (&quot;here a code dump that gets a perfect score&quot;).",
    "score" : 3,
    "owner" : {
      "account_id" : 418284,
      "reputation" : 6654,
      "user_id" : 794749,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/pfE2l.jpg?s=256",
      "display_name" : "gre_gor",
      "link" : "https://stackoverflow.com/users/794749/gre-gor"
    },
    "creation_date" : 1762590596,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140843091,
    "post_id" : 79813002,
    "body" : "@gre_gor - why did you remove the link to the original problem??",
    "score" : 1,
    "owner" : {
      "account_id" : 31180,
      "reputation" : 29752,
      "user_id" : 85421,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/kKvXH.gif?s=256",
      "display_name" : "user85421",
      "link" : "https://stackoverflow.com/users/85421/user85421"
    },
    "creation_date" : 1762590447,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}