{
  "question" : {
    "question_id" : 79557867,
    "title" : "Informix db connection pool issue",
    "body" : "<p>I am using an Informix database and connection pool, and it's not releasing ideal connections.</p>\n<pre><code>AtomikosDataSourceBean ds = new AtomikosDataSourceBean(); \nds.setUniqueResourceName(&quot;XADS-&quot;+nodeId+&quot;-&quot;+currentTimeInMillis()); \nds.setXaDataSourceClassName(&quot;com.informix.jdbcx.IfxXADataSource&quot;); \nProperties p = new Properties();\np.setProperty ( &quot;user&quot; , &quot;informix&quot; ); \np.setProperty ( &quot;password&quot; , &quot;informix&quot; ); \np.setProperty ( &quot;serverName&quot; , &quot;ifxtest&quot; ); \np.setProperty ( &quot;databaseName&quot; , &quot;java&quot; ); \np.setProperty ( &quot;portNumber&quot; , &quot;1526&quot; ); \np.setProperty ( &quot;ifxIFXHOST&quot; , &quot;localhost-ifx&quot; ); \np.setProperty ( &quot;ifxIFX_LOCK_MODE_WAIT&quot; , &quot;5&quot; ); \np.setProperty ( &quot;ifxIFX_XASPEC&quot; , &quot;Y&quot; ); \nds.setXaProperties ( p );\nds.setTextQuery(&quot;Select 1 from ....&quot;;// some property table.\nds.setMaxIdelTime(60*1000);\nds.setMinPoolSize(5);\nds.setMaxPoolSize(150);\nreturn ds;\n</code></pre>\n<p>I am getting below warning too many times in log</p>\n<blockquote>\n<p>com.atomikos.jdbc.AtomikosSQLException, level=WARN, message=Connection pool exhausted- try increasing 'maxPoolSize' and/or 'borrowConnectionTimeout' on the DatasourceBean,</p>\n</blockquote>\n<p>The above warning message is seen so many times when the application is running, but it never throws an exception. I am running purge at midnight.  At that time, none of the users exist in the system and ideally, all connections should be released by that time, but it's not finding the connections and it is causing my purge task to fail and throwing an exception message along with the above warning messages.</p>\n<p>I tried logging statistics, but I am using a 3-version driver — it doesn't have that statistics API.</p>\n",
    "tags" : [ "java", "hibernate", "jdbc", "informix" ],
    "owner" : {
      "account_id" : 3378688,
      "reputation" : 85,
      "user_id" : 2836275,
      "user_type" : "registered",
      "profile_image" : "https://graph.facebook.com/100001981555845/picture?type=large",
      "display_name" : "Surya",
      "link" : "https://stackoverflow.com/users/2836275/surya"
    },
    "is_answered" : true,
    "view_count" : 196,
    "answer_count" : 1,
    "score" : 2,
    "last_activity_date" : 1744086362,
    "creation_date" : 1743921267,
    "link" : "https://stackoverflow.com/questions/79557867/informix-db-connection-pool-issue",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79560616,
    "question_id" : 79557867,
    "body" : "<p>I think you should try the following suggestions:</p>\n<ul>\n<li><p>The most obvious reason that might cause this issue is not properly closing the clients. Therefore, please verify if Connections are released in Atomikos(1), check Connection Pool Settings(2) and enable, for a test, the Connection Scrubbing in Atomikos(3) for automatic cleanup.</p>\n<p>(1) This is a simple example of how connections should be released in Atomikos:</p>\n<pre><code>try {\n    UserTransaction utx = new UserTransactionImp();\n    utx.begin();\n\n    Connection conn = dataSource.getConnection();\n    // Execute database operations\n\n    utx.commit();  // Ensure transactions are committed!\n    conn.close();  // Always close the connection\n} catch (Exception e) {\n    utx.rollback();\n}\n</code></pre>\n<p>(2) Ensure inactive connections are closed (e.g., after 60 seconds).</p>\n<p>(3) Example of how to set the Connection Scrubbing in Atomikos:</p>\n<pre><code>ds.setCheckInterval(60);  // Cleans up unused connections every 60 seconds\nds.setMaxIdleTime(300000); // Closes idle connections after 5 minutes\n</code></pre>\n</li>\n</ul>\n<p>I also found out about this question on Stack Overflow that is experimenting a similar issue: <a href=\"https://stackoverflow.com/questions/18245188/atomikos-connections-shutdown-and-autoreconnect-doesnt-work\">atomikos connections shutdown and autoReconnect doesn&#39;t work</a>. The user there has a problem with shutting down the connections.</p>\n<ul>\n<li>I also think that the connections should release where they are used, like the comment on your post said. I can not be sure how to help you on that if this is the real problem, but I searched a bit and found this: <a href=\"https://www.atomikos.com/Documentation/ExternalConnectionPool\" rel=\"nofollow noreferrer\">https://www.atomikos.com/Documentation/ExternalConnectionPool</a>. I haven't read much of it, but it seems like it also explains when and how connections are released back to the pool.</li>\n</ul>\n",
    "score" : 3,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 38890247,
      "reputation" : 156,
      "user_id" : 29003408,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/LhjH9Wyd.jpg?s=256",
      "display_name" : "Andrei Greblă",
      "link" : "https://stackoverflow.com/users/29003408/andrei-grebl%c4%83"
    },
    "creation_date" : 1744053054,
    "last_activity_date" : 1744053448,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140305402,
    "post_id" : 79557867,
    "body" : "Your application should release the connections where they are used. Check that in your code.",
    "score" : 0,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1743965609,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}