{
  "question" : {
    "question_id" : 79631123,
    "title" : "Spring/Hibernate native query, MySQL parameters not bound",
    "body" : "<p>I have the following query method for a native query in a Spring Boot application</p>\n<pre><code>@Query(value = &quot;&quot;&quot;\n            SELECT a.*, ST_Distance_Sphere(a.coordinate, ST_GeomFromText('POINT(:lat :lng)', 4326)) AS distance \n            FROM airport a \n            ORDER BY distance ASC \n            LIMIT 1\n            &quot;&quot;&quot;, nativeQuery = true)\nAirport findNearestAiportToPosition(Double latitude, Double longitude);\n</code></pre>\n<p>The query executed against the MySQL instance as extracted from the general log is:</p>\n<pre><code>2025-05-20T20:04:55.362342Z    30 Query \nSELECT a.*, ST_Distance_Sphere(a.coordinate, ST_GeomFromText('POINT(:lat :lng)', 4326)) AS distance\nFROM airport a\nORDER BY distance ASC\nLIMIT 1\n</code></pre>\n<p>As can be seen the parameters <code>:lat</code> and <code>:lng</code> have not been replaced with the method parameters.  Conversely other queries using the same pattern work fine, for instance:</p>\n<pre><code>@Query(value = &quot;SELECT p.sid FROM property p where p.sid &gt; ?1 order by p.sid limit 1 offset ?2&quot;, nativeQuery = true)\nString getNextMaxSid(String minSid, int offset);\n</code></pre>\n<p>Runs without issue.  The fact that named parameters are used above is not relevant as I changed that just to see if that solved the problem, it did not.</p>\n<p>Does anyone know why the arguments are not being bound?  Is it because they are quoted?  Is there any work around / solution to this?</p>\n<p>The stacktrace for this error is:</p>\n<pre><code>org.hibernate.exception.DataException: JDBC exception executing SQL [SELECT a.*, ST_Distance_Sphere(a.coordinate, ST_GeomFromText('POINT(:lat :lng)', 4326)) AS distance\nFROM airport a\nORDER BY distance ASC\nLIMIT 1\n] [Data truncation: Invalid GIS data provided to function st_geomfromtext.] [n/a]\n    at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:55) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:58) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:108) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:94) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.executeQuery(DeferredResultSetAccess.java:265) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.getResultSet(DeferredResultSetAccess.java:167) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.sql.results.jdbc.internal.AbstractResultSetAccess.getMetaData(AbstractResultSetAccess.java:36) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.sql.results.jdbc.internal.AbstractResultSetAccess.getColumnCount(AbstractResultSetAccess.java:52) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.query.results.ResultSetMappingImpl.resolve(ResultSetMappingImpl.java:193) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.resolveJdbcValuesSource(JdbcSelectExecutorStandardImpl.java:325) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.doExecuteQuery(JdbcSelectExecutorStandardImpl.java:115) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.executeQuery(JdbcSelectExecutorStandardImpl.java:83) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:76) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:65) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.query.sql.internal.NativeSelectQueryPlanImpl.performList(NativeSelectQueryPlanImpl.java:138) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.query.sql.internal.NativeQueryImpl.doList(NativeQueryImpl.java:621) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:427) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at org.hibernate.query.spi.AbstractSelectionQuery.getSingleResult(AbstractSelectionQuery.java:564) ~[hibernate-core-6.4.4.Final.jar:6.4.4.Final]\n    at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]\n    at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]\n    at org.springframework.orm.jpa.SharedEntityManagerCreator$DeferredQueryInvocationHandler.invoke(SharedEntityManagerCreator.java:415) ~[spring-orm-6.1.5.jar:6.1.5]\n    at jdk.proxy2/jdk.proxy2.$Proxy193.getSingleResult(Unknown Source) ~[na:na]\n    at org.springframework.data.jpa.repository.query.JpaQueryExecution$SingleEntityExecution.doExecute(JpaQueryExecution.java:223) ~[spring-data-jpa-3.2.4.jar:3.2.4]\n    at org.springframework.data.jpa.repository.query.JpaQueryExecution.execute(JpaQueryExecution.java:92) ~[spring-data-jpa-3.2.4.jar:3.2.4]\n    at org.springframework.data.jpa.repository.query.AbstractJpaQuery.doExecute(AbstractJpaQuery.java:149) ~[spring-data-jpa-3.2.4.jar:3.2.4]\n    at org.springframework.data.jpa.repository.query.AbstractJpaQuery.execute(AbstractJpaQuery.java:137) ~[spring-data-jpa-3.2.4.jar:3.2.4]\n    at org.springframework.data.repository.core.support.RepositoryMethodInvoker.doInvoke(RepositoryMethodInvoker.java:170) ~[spring-data-commons-3.2.4.jar:3.2.4]\n    at org.springframework.data.repository.core.support.RepositoryMethodInvoker.invoke(RepositoryMethodInvoker.java:158) ~[spring-data-commons-3.2.4.jar:3.2.4]\n    at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.doInvoke(QueryExecutorMethodInterceptor.java:164) ~[spring-data-commons-3.2.4.jar:3.2.4]\n    at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.invoke(QueryExecutorMethodInterceptor.java:143) ~[spring-data-commons-3.2.4.jar:3.2.4]\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.1.5.jar:6.1.5]\n    at org.springframework.data.projection.DefaultMethodInvokingMethodInterceptor.invoke(DefaultMethodInvokingMethodInterceptor.java:70) ~[spring-data-commons-3.2.4.jar:3.2.4]\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.1.5.jar:6.1.5]\n    at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123) ~[spring-tx-6.1.5.jar:6.1.5]\n    at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:392) ~[spring-tx-6.1.5.jar:6.1.5]\n    at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.1.5.jar:6.1.5]\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.1.5.jar:6.1.5]\n    at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137) ~[spring-tx-6.1.5.jar:6.1.5]\n    ... 23 common frames omitted\n</code></pre>\n<p>POM is:</p>\n<pre><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n  xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n\n  &lt;groupId&gt;omitted&lt;/groupId&gt;\n  &lt;artifactId&gt;omitted&lt;/artifactId&gt;\n  &lt;version&gt;1.0.0&lt;/version&gt;\n  &lt;packaging&gt;jar&lt;/packaging&gt;\n\n    &lt;parent&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n        &lt;version&gt;3.2.4&lt;/version&gt;\n    &lt;/parent&gt;\n    &lt;properties&gt;\n        &lt;java.version&gt;21&lt;/java.version&gt;\n    &lt;/properties&gt;\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.fasterxml.jackson.datatype&lt;/groupId&gt;\n            &lt;artifactId&gt;jackson-datatype-jsr310&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;junit&lt;/groupId&gt;\n            &lt;artifactId&gt;junit&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;mysql&lt;/groupId&gt;\n            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.retry&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-retry&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.commonmark&lt;/groupId&gt;\n            &lt;artifactId&gt;commonmark&lt;/artifactId&gt;\n            &lt;version&gt;0.22.0&lt;/version&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n&lt;/project&gt;\n</code></pre>\n<p>I expect the parameters to be bound and the SQL in the general log to show for instance:</p>\n<pre><code>2025-05-20T20:04:55.362342Z    30 Query SELECT a.*, ST_Distance_Sphere(a.coordinate, ST_GeomFromText('POINT(45.0 45.0)', 4326)) AS distance \nFROM airport a \nORDER BY distance ASC \nLIMIT 1 \n</code></pre>\n",
    "tags" : [ "java", "mysql", "spring", "hibernate", "spring-data" ],
    "owner" : {
      "account_id" : 42098058,
      "reputation" : 1,
      "user_id" : 30592796,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/7eeb4102ac70763567f19e7679f8aecb?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Bob",
      "link" : "https://stackoverflow.com/users/30592796/bob"
    },
    "is_answered" : false,
    "view_count" : 94,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1747859432,
    "creation_date" : 1747772991,
    "link" : "https://stackoverflow.com/questions/79631123/spring-hibernate-native-query-mysql-parameters-not-bound",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79631369,
    "question_id" : 79631123,
    "body" : "<p>It is because POINT is a function and you have it in single quotes which makes the Hiberntate think it is a text and text wont be processed for params.</p>\n<p>use as below if you want to convert the output of point as a string</p>\n<pre><code>select ST_GeomFromText(CONCAT ('POINT(',:lat,',',:long,')')::text);\n</code></pre>\n<pre><code>@Query(value = &quot;&quot;&quot;\n            SELECT a.*, ST_Distance_Sphere(a.coordinate, ST_GeomFromText(CONCAT ('POINT(',:lat,',',:long,')')::text;), 4326)) AS distance \n            FROM airport a \n            ORDER BY distance ASC \n            LIMIT 1\n            &quot;&quot;&quot;, nativeQuery = true)\nAirport findNearestAiportToPosition(Double latitude, Double longitude);\n</code></pre>\n",
    "score" : -1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 13874157,
      "reputation" : 615,
      "user_id" : 10016327,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5e412e575addc9fb9fd167a0c0949cb6?s=256&d=identicon&r=PG",
      "display_name" : "satyesht",
      "link" : "https://stackoverflow.com/users/10016327/satyesht"
    },
    "creation_date" : 1747790334,
    "last_activity_date" : 1747859432,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140445106,
    "post_id" : 79631123,
    "body" : "@Shadow Yes, this works so the method is `\t@Query(value = &quot;&quot;&quot; \t\t\tSELECT a.*, ST_Distance_Sphere(a.coordinate, ST_GeomFromText(:point, 4326)) AS distance  \t\t\tFROM airport a  \t\t\tORDER BY distance ASC  \t\t\tLIMIT 1 \t\t\t&quot;&quot;&quot;, nativeQuery = true) \tAirport findNearestAiportToPosition(@Param(&quot;point&quot;) String point); ` It is not ideal but works, thanks for your help",
    "score" : 0,
    "owner" : {
      "account_id" : 42098058,
      "reputation" : 1,
      "user_id" : 30592796,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/7eeb4102ac70763567f19e7679f8aecb?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Bob",
      "link" : "https://stackoverflow.com/users/30592796/bob"
    },
    "creation_date" : 1747819171,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140444166,
    "post_id" : 79631123,
    "body" : "I think the problem is that the parameter of <code>ST_GeomFromText()</code> function is <code>&#39;POINT(:lat :lng)&#39;</code> , which is a string. :lat and :lng are part of a mysql string literal , not a named parameter. You can try to have a single string parameter and pass the point(...,...) as string to it and see if that works",
    "score" : 0,
    "owner" : {
      "account_id" : 7035840,
      "reputation" : 34519,
      "user_id" : 5389997,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/50ce1e08eea42756ffa9415a9e8df140?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Shadow",
      "link" : "https://stackoverflow.com/users/5389997/shadow"
    },
    "creation_date" : 1747775210,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79631369" : [ {
      "comment_id" : 140447584,
      "post_id" : 79631369,
      "body" : "That&#39;s way overcomplicated",
      "score" : 0,
      "owner" : {
        "account_id" : 7035840,
        "reputation" : 34519,
        "user_id" : 5389997,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/50ce1e08eea42756ffa9415a9e8df140?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Shadow",
        "link" : "https://stackoverflow.com/users/5389997/shadow"
      },
      "creation_date" : 1747865295,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140447342,
      "post_id" : 79631369,
      "body" : "in that case we can use   select ST_GeomFromText(CONCAT (&#39;POINT(&#39;,:lat,&#39;,&#39;,:long,&#39;)&#39;)::text);",
      "score" : 0,
      "owner" : {
        "account_id" : 13874157,
        "reputation" : 615,
        "user_id" : 10016327,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/5e412e575addc9fb9fd167a0c0949cb6?s=256&d=identicon&r=PG",
        "display_name" : "satyesht",
        "link" : "https://stackoverflow.com/users/10016327/satyesht"
      },
      "creation_date" : 1747859462,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140444803,
      "post_id" : 79631369,
      "body" : "ST_GeomFromText function takes string as parameter - as its name suggests. See <a href=\"https://dev.mysql.com/doc/refman/8.4/en/gis-wkt-functions.html\" rel=\"nofollow noreferrer\">dev.mysql.com/doc/refman/8.4/en/gis-wkt-functions.html</a> for details.",
      "score" : 1,
      "owner" : {
        "account_id" : 7035840,
        "reputation" : 34519,
        "user_id" : 5389997,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/50ce1e08eea42756ffa9415a9e8df140?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Shadow",
        "link" : "https://stackoverflow.com/users/5389997/shadow"
      },
      "creation_date" : 1747813302,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}