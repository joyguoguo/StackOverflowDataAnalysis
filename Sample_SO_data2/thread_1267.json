{
  "question" : {
    "question_id" : 79728771,
    "title" : "Kafka is not consuming/Receiving the messages from my KafkaProducer",
    "body" : "<p>I have a SpringBoot application that connects to a Kafka broker and produces messages to a configured Kafka topic. I have first of all a SenderComponent which schedules tasks based on a cron expression.</p>\n<p>Businesswise this Component has scheduled jobs stored in a repository and it schedules tasks based on the stored cron expressions.</p>\n<pre><code>package com.sporting.scheduler.sender.application;\n\nimport com.sporting.scheduler.registry.domain.OutgoingRouting;\nimport com.sporting.scheduler.registry.domain.ScheduledJobRepository;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.boot.CommandLineRunner;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.scheduling.TaskScheduler;\nimport org.springframework.scheduling.annotation.EnableScheduling;\nimport org.springframework.scheduling.annotation.Scheduled;\nimport org.springframework.scheduling.support.CronTrigger;\nimport org.springframework.stereotype.Component;\n\nimport java.util.HashSet;\nimport java.util.Set;\n\n@Component\n@RequiredArgsConstructor\n@EnableScheduling\n@Slf4j\npublic class SenderComponent {\n\n    static final String SENDER_PREFIX = &quot;[SENDER] - &quot;;\n    private final Set&lt;String&gt; scheduledRoutings = new HashSet&lt;&gt;();\n\n    @Value(&quot;${sporting.kafka.url}&quot;)\n    private String url;\n\n    @Value(&quot;${sporting.kafka.sender-topic}&quot;)\n    private String topicName;\n\n    private final ScheduledJobRepository repository;\n\n    private final TaskScheduler scheduler;\n\n    private final SenderKafkaProducer senderKafkaProducer;\n\n    @Bean\n    public CommandLineRunner start() {\n        return args -&gt; log.info(&quot;{}The scheduler sender started, listening for scheduled tasks to trigger.&quot;, SENDER_PREFIX);\n    }\n\n    @Scheduled(fixedRate = 1000 * 60, initialDelay = 1000) // Every minute, wait a second to boot\n    public void senderTriggers() {\n            Set&lt;OutgoingRouting&gt; routings = repository.fetchOutgoingRoutings();\n            if (routings.isEmpty()) {\n                log.info(&quot;{}No outgoing routings found in the job registry.&quot;, SENDER_PREFIX);\n                return;\n            }\n            routings.forEach(this::scheduleTask);\n    }\n\n    private void scheduleTask(OutgoingRouting outgoingRouting) {\n        if (!scheduledRoutings.contains(outgoingRouting.getCode())) {\n            scheduler.schedule(() -&gt; senderKafkaProducer.send(topicName, outgoingRouting.getCode()), new CronTrigger(outgoingRouting.getCronExpression()));\n            scheduledRoutings.add(outgoingRouting.getCode());\n        }\n    }\n}\n</code></pre>\n<p>This is the code that I've written to the SenderKafkaProducer</p>\n<pre><code>package com.sporting.scheduler.sender.application;\n\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.apache.kafka.clients.producer.ProducerConfig;\nimport org.apache.kafka.common.serialization.IntegerSerializer;\nimport org.apache.kafka.common.serialization.StringSerializer;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.kafka.core.DefaultKafkaProducerFactory;\nimport org.springframework.kafka.core.KafkaTemplate;\nimport org.springframework.kafka.core.ProducerFactory;\nimport org.springframework.stereotype.Component;\n\nimport java.util.HashMap;\nimport java.util.Map;\n\n@Component\n@RequiredArgsConstructor\n@Slf4j\npublic class SenderKafkaProducer {\n\n    @Bean\n    public ProducerFactory&lt;Integer, String&gt; producerFactory() {\n        return new DefaultKafkaProducerFactory&lt;&gt;(producerConfigs());\n    }\n\n    @Bean\n    public Map&lt;String, Object&gt; producerConfigs() {\n        Map&lt;String, Object&gt; props = new HashMap&lt;&gt;();\n        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, &quot;localhost:9092&quot;);\n        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, IntegerSerializer.class);\n        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class);\n        props.put(ProducerConfig.ACKS_CONFIG, &quot;all&quot;);\n        props.put(ProducerConfig.ENABLE_METRICS_PUSH_CONFIG, &quot;false&quot;);\n        return props;\n    }\n\n    @Bean\n    public KafkaTemplate&lt;Integer, String&gt; kafkaTemplate() {\n        return new KafkaTemplate&lt;&gt;(producerFactory());\n    }\n\n    public void send(String topic, String message) {\n        kafkaTemplate().send(topic, message);\n        log.info(&quot;Sent message [{}] to topic [{}]&quot;, message, topic);\n\n    }\n}\n</code></pre>\n<p>What I see happening is that I receive following log lines</p>\n<pre><code>2025-08-07T16:52:00.015+02:00  INFO 32399 --- [Sender] [   scheduling-1] c.t.s.d.a.SenderKafkaProducer        : Sent message [BINGO_MAN] to topic [SCH-list]\n</code></pre>\n<p>So I'm assuming that the Kafka broker received my message well. In the meanwhile I'm running a kafka consumer on that broker, but it's not receiving any message at all.</p>\n<p>I did a test by using kcat <code>kcat -b localhost:9092 -t SCH-list -L</code> in my terminal to verify if the broker is up and running and it works. It gives me the following output</p>\n<pre><code>Metadata for SCH-list (from broker 1: localhost:9092/1):\n 1 brokers:\n  broker 1 at localhost:9092 (controller)\n 1 topics:\n  topic &quot;SCH-list&quot; with 1 partitions:\n    partition 0, leader 1, replicas: 1, isrs: 1\n</code></pre>\n<p>But my message BINGO_MAN isn't received. I have the idea that my SpringBoot application is connecting correctly to the Kafka broker, but something goes wrong with the producer.\nCan anyone point me out what I'm doing wrong and also give tips how I can verify in my code if the message got received well by my Kafka broker?\nThanks in advance.</p>\n",
    "tags" : [ "java", "spring", "spring-boot", "apache-kafka" ],
    "owner" : {
      "account_id" : 43173967,
      "reputation" : 65,
      "user_id" : 31117717,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/a123aaf8b1876577a68af8ea8355cc3f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "jonasaud",
      "link" : "https://stackoverflow.com/users/31117717/jonasaud"
    },
    "is_answered" : true,
    "view_count" : 122,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1754667813,
    "creation_date" : 1754578742,
    "link" : "https://stackoverflow.com/questions/79728771/kafka-is-not-consuming-receiving-the-messages-from-my-kafkaproducer",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79729978,
    "question_id" : 79728771,
    "body" : "<p>Like suggested on the comment, you are instantiating your <code>KafkaTemplate</code> within the same <code>Component</code> class for your producer. So your producer is not using Spring managed bean, rather, instantiating a new KafkaTemplate every time it runs which might not be properly using Spring proxies for Kafka.</p>\n<p>So try it with something like:</p>\n<pre><code>@Configuration\npublic class MyKafkaConfiguration {\n    @Bean\n    public ProducerFactory&lt;Integer, String&gt; producerFactory() {\n        return new DefaultKafkaProducerFactory&lt;&gt;(producerConfigs());\n    }\n\n    @Bean\n    public Map&lt;String, Object&gt; producerConfigs() {\n        Map&lt;String, Object&gt; props = new HashMap&lt;&gt;();\n        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, &quot;localhost:9092&quot;);\n        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, IntegerSerializer.class);\n        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class);\n        props.put(ProducerConfig.ACKS_CONFIG, &quot;all&quot;);\n        props.put(ProducerConfig.ENABLE_METRICS_PUSH_CONFIG, &quot;false&quot;);\n        return props;\n    }\n\n    @Bean\n    public KafkaTemplate&lt;Integer, String&gt; kafkaTemplate() {\n        return new KafkaTemplate&lt;&gt;(producerFactory());\n    }\n\n}\n</code></pre>\n<p>Then in your <code>SenderComponent</code> just autowire the <code>KafkaTemplate</code> bean</p>\n<pre><code>@Component\n@RequiredArgsConstructor\n@EnableScheduling\n@Slf4j\npublic class SenderComponent {\n    private final KafkaTemplate&lt;Integer, String&gt; kafkaTemplate;\n    ....\n}\n</code></pre>\n<p>Also move the</p>\n<pre><code>@Bean\npublic CommandLineRunner start() {\n    return args -&gt; log.info(&quot;{}The scheduler sender started, listening for scheduled tasks to trigger.&quot;, SENDER_PREFIX);\n}\n</code></pre>\n<p>To a configuration class as well.</p>\n<p>Side note: in your <code>SenderComponent</code> <code>url</code> is not being used</p>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 209503,
      "reputation" : 23867,
      "user_id" : 460557,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/b4565f97815833390c9c880e9e8522e4?s=256&d=identicon&r=PG",
      "display_name" : "Jorge Campos",
      "link" : "https://stackoverflow.com/users/460557/jorge-campos"
    },
    "creation_date" : 1754667813,
    "last_activity_date" : 1754667813,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140651534,
    "post_id" : 79728771,
    "body" : "@JorgeCampos your sugesstion worked. You can post an answer.",
    "score" : 0,
    "owner" : {
      "account_id" : 43173967,
      "reputation" : 65,
      "user_id" : 31117717,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/a123aaf8b1876577a68af8ea8355cc3f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "jonasaud",
      "link" : "https://stackoverflow.com/users/31117717/jonasaud"
    },
    "creation_date" : 1754650756,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140650569,
    "post_id" : 79728771,
    "body" : "&quot;So I&#39;m assuming that the Kafka broker received my message well&quot; - why are you assuming that? You never checked how CompletableFuture the .send() returns is doing.",
    "score" : 0,
    "owner" : {
      "account_id" : 7692774,
      "reputation" : 1282,
      "user_id" : 5828464,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/de54db63fab1e3c3d00d0dbef1a0a0f1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Yuri G",
      "link" : "https://stackoverflow.com/users/5828464/yuri-g"
    },
    "creation_date" : 1754609108,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140649481,
    "post_id" : 79728771,
    "body" : "Here is an example: <a href=\"https://www.baeldung.com/spring-kafka\" rel=\"nofollow noreferrer\">baeldung.com/spring-kafka</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 209503,
      "reputation" : 23867,
      "user_id" : 460557,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/b4565f97815833390c9c880e9e8522e4?s=256&d=identicon&r=PG",
      "display_name" : "Jorge Campos",
      "link" : "https://stackoverflow.com/users/460557/jorge-campos"
    },
    "creation_date" : 1754579927,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140649475,
    "post_id" : 79728771,
    "body" : "Try moving your @Bean annotated methods to a separate configuration class, annotated with <code>@Configuration</code> not in the same @Component class that is supposed to send the message. I believe that is the problem because the way you are doing it here is not using spring managed bean rather instantiating a new KafkaTemplate every time. Try it out and let me know, I will add an answer if it works",
    "score" : 2,
    "owner" : {
      "account_id" : 209503,
      "reputation" : 23867,
      "user_id" : 460557,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/b4565f97815833390c9c880e9e8522e4?s=256&d=identicon&r=PG",
      "display_name" : "Jorge Campos",
      "link" : "https://stackoverflow.com/users/460557/jorge-campos"
    },
    "creation_date" : 1754579820,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}