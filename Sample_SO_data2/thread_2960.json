{
  "question" : {
    "question_id" : 79585395,
    "title" : "Kafka consumer always tries 127.0.0.1:9092",
    "body" : "<p>I have this image of kafka running in a container:</p>\n<pre><code> service-kafka:\n    container_name: pepito-kafka-server\n    hostname: pepito\n    image: apache/kafka:3.7.1\n    networks: \n      - pepito-network\n    ports:\n        - 8484:9092\n    extra_hosts:\n      - &quot;docker.internal:127.0.0.1&quot;\n    healthcheck:\n      test: /opt/kafka/bin/kafka-cluster.sh cluster-id --bootstrap-server pepito:9092 || exit 1\n      interval: 1s\n      timeout: 60s\n      retries: 60\n</code></pre>\n<p>as you can see I have a custom port for kafka,</p>\n<p>now from my springboot app I'm trying to use it like this:</p>\n<pre><code>@Configuration\npublic class KafkaTopicConfig {\n\n    @Value(value = &quot;${spring.kafka.bootstrap-servers}&quot;)\n    private String bootstrapAddress;\n\n    @Bean\n    KafkaAdmin kafkaAdmin() {\n        Map&lt;String, Object&gt; configs = new HashMap&lt;&gt;();\n        configs.put(AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapAddress);\n        return new KafkaAdmin(configs);\n    }\n}\n</code></pre>\n<p>and,</p>\n<pre><code>@Configuration\npublic class KafkaProducerConfig {\n\n    @Value(value = &quot;${spring.kafka.bootstrap-servers}&quot;)\n    private String bootstrapAddress;\n\n    @Bean\n    ProducerFactory&lt;String, String&gt; producerFactory() {\n        Map&lt;String, Object&gt; configProps = new HashMap&lt;&gt;();\n        configProps.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapAddress);\n        configProps.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);\n        configProps.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class);\n        return new DefaultKafkaProducerFactory&lt;&gt;(configProps);\n    }\n\n    @Bean\n    KafkaTemplate&lt;String, String&gt; kafkaTemplate() {\n        return new KafkaTemplate&lt;&gt;(producerFactory());\n    }\n}\n</code></pre>\n<p>and,</p>\n<pre><code>@EnableKafka\n@Configuration\npublic class KafkaConsumerConfig {\n\n    @Value(value = &quot;${pepito.group-id}&quot;)\n    private String groupId;\n\n    @Value(value = &quot;${spring.kafka.bootstrap-servers}&quot;)\n    private String bootstrapAddress;\n\n    @Bean\n    ConsumerFactory&lt;String, String&gt; consumerFactory() {\n        Map&lt;String, Object&gt; props = new HashMap&lt;&gt;();\n        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapAddress);\n        props.put(ConsumerConfig.GROUP_ID_CONFIG, groupId);\n        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);\n        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);\n        return new DefaultKafkaConsumerFactory&lt;&gt;(props);\n    }\n\n    @Bean\n    ConcurrentKafkaListenerContainerFactory&lt;String, String&gt; kafkaListenerContainerFactory() {\n\n        ConcurrentKafkaListenerContainerFactory&lt;String, String&gt; factory = new ConcurrentKafkaListenerContainerFactory&lt;&gt;();\n        factory.setConsumerFactory(consumerFactory());\n        return factory;\n    }\n\n    @KafkaListener(topics = &quot;${spring.application.name}&quot;, groupId = &quot;${pepito.group-id}&quot;)\n    public void listenGroupFoo(String message) {\n        System.out.println(&quot;Received Message in group &quot; + groupId + &quot;: &quot; + message);\n    }\n\n}\n</code></pre>\n<p>I have a producer and a consumer, because the idea for this app is to send as well as receive and process messages,</p>\n<p>now, I'm getting these errors:</p>\n<pre><code>[36morg.apache.kafka.clients.Metadata       [0;39m [2m:[0;39m [Consumer clientId=consumer-pepito.app-1, groupId=pepito.app] Cluster ID: 5L6g3nShT-eMCtK--X85sw\n[36mo.a.k.c.c.internals.ConsumerCoordinator [0;39m [2m:[0;39m [Consumer clientId=consumer-pepito.app-1, groupId=pepito.app] Discovered group coordinator localhost:9092 (id: 2147483546 rack: null)\n[36mo.a.k.c.c.internals.ConsumerCoordinator [0;39m [2m:[0;39m [Consumer clientId=consumer-pepito.app-1, groupId=pepito.app] (Re-)joining group\n[36morg.apache.kafka.clients.NetworkClient  [0;39m [2m:[0;39m [Consumer clientId=consumer-pepito.app-1, groupId=pepito.app] Node 2147453646 disconnected.\n[2m2025-04-21T15:43:36.068-06:00[0;39m [33m WARN[0;39m [35m4088[0;39m [2m--- [pepito-app] [ntainer#0-0-C-1] [0;39m[36morg.apache.kafka.clients.NetworkClient  [0;39m [2m:[0;39m [Consumer clientId=consumer-pepito.app-1, groupId=pepito.app] Connection to node 2147483636 (localhost/127.0.0.1:9092) could not be established. Node may not be available.\n[36mo.a.k.c.c.internals.ConsumerCoordinator [0;39m [2m:[0;39m [Consumer clientId=consumer-pepito.app-1, groupId=pepito.app] Group coordinator localhost:9092 (id: 2147483646 rack: null) is unavailable or invalid due to cause: null. isDisconnected: true. Rediscovery will be attempted.\n[36mo.a.k.c.c.internals.ConsumerCoordinator [0;39m [2m:[0;39m [Consumer clientId=consumer-pepito.app-1, groupId=pepito.app] Request joining group due to: rebalance failed due to 'null' (DisconnectException)\n[36morg.apache.kafka.clients.NetworkClient  [0;39m [2m:[0;39m [Consumer clientId=consumer-pepito.app-1, groupId=pepito.app] Node 1 disconnected.\n[2m2025-04-21T15:43:36.087-06:00[0;39m [33m WARN[0;39m [35m4088[0;39m [2m--- [pepito-app] [ntainer#0-0-C-1] [0;39m[36morg.apache.kafka.clients.NetworkClient  [0;39m [2m:[0;39m [Consumer clientId=consumer-pepito.app-1, groupId=pepito.app] Connection to node 1 (localhost/127.0.0.1:9092) could not be established. Node may not be available.\n[36morg.apache.kafka.clients.NetworkClient  [0;39m [2m:[0;39m [Consumer clientId=consumer-pepito.app-1, groupId=pepito.app] Node 1 disconnected.\n[2m2025-04-21T15:43:36.199-06:00[0;39m [33m WARN[0;39m [35m4088[0;39m [2m--- [pepito-app] [ntainer#0-0-C-1] [0;39m[36morg.apache.kafka.clients.NetworkClient  [0;39m [2m:[0;39m [Consumer clientId=consumer-pepito.app-1, groupId=pepito.app] Connection to node 1 (localhost/127.0.0.1:9092) could not be established. Node may not be available.\n[36morg.apache.kafka.clients.NetworkClient  [0;39m [2m:[0;39m [Consumer clientId=consumer-pepito.app-1, groupId=pepito.app] Node 1 disconnected.\n[2m2025-04-21T15:43:36.302-06:00[0;39m [33m WARN[0;39m [35m4088[0;39m [2m--- [pepito-app] [ntainer#0-0-C-1] [0;39m[36morg.apache.kafka.clients.NetworkClient  [0;39m [2m:[0;39m [Consumer clientId=consumer-pepito.app-1, groupId=pepito.app] Connection to node 1 (localhost/127.0.0.1:9092) could not be established. Node may not be available.\n[36morg.apache.kafka.clients.NetworkClient  [0;39m [2m:[0;39m [Consumer clientId=consumer-pepito.app-1, groupId=pepito.app] Node 1 disconnected.\n[2m2025-04-21T15:43:36.548-06:00[0;39m [33m WARN[0;39m [35m4088[0;39m [2m--- [pepito-app] [ntainer#0-0-C-1] [0;39m[36morg.apache.kafka.clients.NetworkClient  [0;39m [2m:[0;39m [Consumer clientId=consumer-pepito.app-1, groupId=pepito.app] Connection to node 1 (localhost/127.0.0.1:9092) could not be established. Node may not be available.\n[36morg.apache.kafka.clients.NetworkClient  [0;39m [2m:[0;39m [Consumer clientId=consumer-pepito.app-1, groupId=pepito.app] Node 1 disconnected.\n[2m2025-04-21T15:43:36.998-06:00[0;39m [33m WARN[0;39m [35m4088[0;39m [2m--- [pepito-app] [ntainer#0-0-C-1] [0;39m[36morg.apache.kafka.clients.NetworkClient  [0;39m [2m:[0;39m [Consumer clientId=consumer-pepito.app-1, groupId=pepito.app] Connection to node 1 (localhost/127.0.0.1:9092) could not be established. Node may not be available.\n[36morg.apache.kafka.clients.NetworkClient  [0;39m [2m:[0;39m [Consumer clientId=consumer-pepito.app-1, groupId=pepito.app] Node 1 disconnected.\n[2m2025-04-21T15:43:37.800-06:00[0;39m [33m WARN[0;39m [35m4088[0;39m [2m--- [pepito-app] [ntainer#0-0-C-1] [0;39m[36morg.apache.kafka.clients.NetworkClient  [0;39m [2m:[0;39m [Consumer clientId=consumer-pepito.app-1, groupId=pepito.app] Connection to node 1 (localhost/127.0.0.1:9092) could not be established. Node may not be available.\n</code></pre>\n<p>It's trying to connect to 127.0.0.1:9092 the default host/port for springboot,</p>\n<pre><code>Connection to node 1 (localhost/127.0.0.1:9092) could not be established. Node may not be available.\n</code></pre>\n<p>and I have in my application.properties</p>\n<pre><code>spring:\n  kafka:\n    bootstrap-servers: &quot;pepito:8484&quot; # in my hosts pepito is pointing to where docker is running\n</code></pre>\n<p>where else in my configuration do I have to indicate to connect ONLY to pepito:8484, and no other ip/port? also, I did not change a thing in my container image of kafka, do I need to set something there? any help is welcomed,</p>\n",
    "tags" : [ "java", "spring-boot", "docker", "apache-kafka" ],
    "owner" : {
      "account_id" : 16223118,
      "reputation" : 143,
      "user_id" : 11714220,
      "user_type" : "registered",
      "profile_image" : "https://lh5.googleusercontent.com/-mhbD83YE024/AAAAAAAAAAI/AAAAAAAAAAc/Qy5DIqFJaZk/s256-rj/photo.jpg",
      "display_name" : "Alfredo Morales",
      "link" : "https://stackoverflow.com/users/11714220/alfredo-morales"
    },
    "is_answered" : true,
    "view_count" : 103,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1745339779,
    "creation_date" : 1745272634,
    "link" : "https://stackoverflow.com/questions/79585395/kafka-consumer-always-tries-127-0-0-19092",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79586050,
    "question_id" : 79585395,
    "body" : "<p>So basically, your Spring Boot app is like, <em>&quot;Hey Kafka, I'm knocking on <strong>pepito:8484</strong>, letâ€™s chat!&quot;</em></p>\n<p>Kafka opens the door and goes, <em>&quot;Cool, nice to meet you! But if you wanna keep talking, hit me up at <strong>localhost:9092</strong> from now on.&quot;</em></p>\n<p>And your poor app is like, <em>&quot;Uh... okay, I guess...&quot;</em><br />\nThen it tries to call <strong>localhost:9092</strong>, but obviously, there's no one home....connection errors.</p>\n<p>In your <code>service-kafka</code> container, add the env variable <code>ADVERTISED_LISTENERS</code> as:</p>\n<pre class=\"lang-yaml prettyprint-override\"><code>service-kafka:\n  container_name: pepito-kafka-server\n  hostname: pepito\n  image: apache/kafka:3.7.1\n  networks: \n    - pepito-network\n  ports:\n    - 8484:9092\n  environment:\n    KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092\n    KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://pepito:8484 #here\n  extra_hosts:\n    - &quot;docker.internal:127.0.0.1&quot;\n  healthcheck:\n    test: /opt/kafka/bin/kafka-cluster.sh cluster-id --bootstrap-server pepito:9092 || exit 1\n    interval: 1s\n    timeout: 60s\n    retries: 60\n</code></pre>\n<p>This time, kafka will tell the app &quot;<em>its okay, now we can talk</em>&quot;.</p>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 2465829,
      "reputation" : 13627,
      "user_id" : 2148953,
      "user_type" : "registered",
      "accept_rate" : 96,
      "profile_image" : "https://i.sstatic.net/DVHoP84E.jpg?s=256",
      "display_name" : "aran",
      "link" : "https://stackoverflow.com/users/2148953/aran"
    },
    "creation_date" : 1745312399,
    "last_activity_date" : 1745339779,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140357025,
    "post_id" : 79585395,
    "body" : "Is your <code>spring-kafka</code> app in the same network <code>- pepito-network</code> ?",
    "score" : 0,
    "owner" : {
      "account_id" : 24440940,
      "reputation" : 5259,
      "user_id" : 18364656,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/70eb650df3e935255b17e62942f30620?s=256&d=identicon&r=PG",
      "display_name" : "Andrei Lisa",
      "link" : "https://stackoverflow.com/users/18364656/andrei-lisa"
    },
    "creation_date" : 1745312003,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}