{
  "question" : {
    "question_id" : 79615673,
    "title" : "Spring Data JPA, use GROUP BY to return a list of rows grouped by a column",
    "body" : "<pre><code>@Entity\npublic class Employee {\n  @Id\n  @GeneratedValue\n  private long id;\n  private String name;\n  private String dept;\n  private long salary;\n    .............\n}\n</code></pre>\n<p>I am trying to get the result of the following query using Spring Data JPA:</p>\n<pre><code>SELECT e.dept, e\nFROM Employee e\nGROUP BY e.dept\nHAVING e.dept IN ('IT', 'Admin')\n</code></pre>\n<p>We cannot have a map response using default Spring Data JPA implementations and hence the above query cannot be directly used in the repository layer.</p>\n<p>How can I get that result using a criteria with a paginated response?</p>\n<p>The data size is expected to be large and grouping the data in Java using stream might not be an option.</p>\n<p>The query that i gave itself is not directly possible in sql I guess . I want to know if there is any way to achieve the same result.</p>\n",
    "tags" : [ "java", "spring-boot", "hibernate", "spring-data-jpa", "rdbms" ],
    "owner" : {
      "account_id" : 10717399,
      "reputation" : 6288,
      "user_id" : 7887516,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/88708ea36b127193e7ecabc6da66816f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Ananthapadmanabhan",
      "link" : "https://stackoverflow.com/users/7887516/ananthapadmanabhan"
    },
    "is_answered" : true,
    "view_count" : 144,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1746952465,
    "creation_date" : 1746892984,
    "link" : "https://stackoverflow.com/questions/79615673/spring-data-jpa-use-group-by-to-return-a-list-of-rows-grouped-by-a-column",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79616298,
    "question_id" : 79615673,
    "body" : "<pre><code>SELECT e.dept, e\nFROM Employee e\nGROUP BY e.dept\nHAVING e.dept IN ('IT', 'Admin')\n</code></pre>\n<p>is <strong>not valid SQL or JPQL</strong>. In SQL, when using <code>GROUP BY e.dept</code>, you cannot select the full entity <code>e</code> because it contains multiple columns (like <code>id</code>, <code>name</code>, <code>salary</code>) that are not grouped or aggregated.</p>\n<p>You can achieve grouped results with pagination by:</p>\n<ul>\n<li><p>Selecting aggregated data (like <code>dept</code> and <code>COUNT(*)</code>)</p>\n</li>\n<li><p>Using <strong>Spring Data JPA interface-based projections</strong> for clean mapping</p>\n</li>\n<li><p>Applying <code>Pageable</code> for paginated response</p>\n</li>\n</ul>\n<p>Here’s how you can do it:</p>\n<pre><code>public interface EmployeeRepository extends JpaRepository&lt;Employee, Long&gt; {\n\n     @Query(&quot;SELECT e.dept AS dept, COUNT(e) AS employeeCount &quot; +\n             &quot;FROM Employee e &quot; +\n             &quot;GROUP BY e.dept &quot; +\n             &quot;HAVING e.dept IN :depts&quot;)\n     Page&lt;DeptEmployeeCount&gt; countEmployeesByDept(@Param(&quot;depts&quot;) List&lt;String&gt; depts, Pageable pageable);\n\n}\n</code></pre>\n<pre><code>public  interface DeptEmployeeCount {\n    String getDept();\n    Long getEmployeeCount();\n}\n</code></pre>\n<ol>\n<li><p>You cannot group by <code>dept</code> and select the full entity <code>e</code> directly. That’s invalid SQL.</p>\n</li>\n<li><p>Instead, select <strong>aggregated fields</strong> (like <code>e.dept</code> and <code>COUNT(e)</code>).</p>\n</li>\n<li><p>Spring Data JPA supports <strong>interface-based projections</strong> (<code>DeptEmployeeCount</code>) to map partial query results cleanly.</p>\n</li>\n<li><p>Pagination works by returning <code>Page&lt;DeptEmployeeCount&gt;</code>, which includes pagination metadata (<code>totalPages</code>, <code>totalElements</code>, etc.).</p>\n</li>\n</ol>\n<p>I got proper response as you can see in below screen shot:</p>\n<p><a href=\"https://i.sstatic.net/xtw62eiI.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/xtw62eiI.png\" alt=\"enter image description here\" /></a></p>\n<p>generated hibernate query</p>\n<p><a href=\"https://i.sstatic.net/0vmkodCY.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/0vmkodCY.png\" alt=\"enter image description here\" /></a></p>\n<p>References:</p>\n<p>- <a href=\"https://docs.spring.io/spring-data/jpa/reference/repositories/projections.html\" rel=\"nofollow noreferrer\">https://docs.spring.io/spring-data/jpa/reference/repositories/projections.html</a><br />\n- <a href=\"https://www.baeldung.com/jpa-queries-custom-result-with-aggregation-functions\" rel=\"nofollow noreferrer\">https://www.baeldung.com/jpa-queries-custom-result-with-aggregation-functions</a></p>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 16264424,
      "reputation" : 299,
      "user_id" : 11744933,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c2a6b186c0cae5c1e679bfb495889428?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Syed",
      "link" : "https://stackoverflow.com/users/11744933/syed"
    },
    "creation_date" : 1746952465,
    "last_activity_date" : 1746952465,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79615679,
    "question_id" : 79615673,
    "body" : "<p>To achieve <code>GROUP BY</code> with pagination in Spring Data JPA, you need to use the <strong>Criteria API</strong> within a custom repository implementation. You'll construct a query with <code>groupBy()</code> and <code>having()</code> to filter by department, and then apply pagination using <code>setFirstResult()</code> and <code>setMaxResults()</code>. A separate count query is needed for the total number of groups for pagination metadata. The result will be a <code>Page&lt;Employee&gt;</code>, where each <code>Employee</code> represents one department group</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 41898230,
      "reputation" : 1,
      "user_id" : 30500937,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c2b22a191a2a10aec0b02e5465417482?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Ryan",
      "link" : "https://stackoverflow.com/users/30500937/ryan"
    },
    "creation_date" : 1746893453,
    "last_activity_date" : 1746893453,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}