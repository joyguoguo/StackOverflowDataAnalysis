{
  "question" : {
    "question_id" : 79599900,
    "title" : "JSch SSH Authentication Failure with Private Key (Auth fail error)",
    "body" : "<pre><code>JSch Log [level 1]: Connecting to 10.***.150 port 22\nJSch Log [level 1]: Connection established\nJSch Log [level 1]: Remote version string: SSH-2.0-OpenSSH_8.7\nJSch Log [level 1]: Local version string: SSH-2.0-JSCH-0.1.54\nJSch Log [level 1]: CheckCiphers: aes256-ctr,aes192-ctr,aes128-ctr,aes256-cbc,aes192-cbc,aes128-cbc,3des-ctr,arcfour,arcfour128,arcfour256\nJSch Log [level 1]: CheckKexes: diffie-hellman-group14-sha1,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521\nJSch Log [level 1]: CheckSignatures: ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521\nJSch Log [level 1]: SSH_MSG_KEXINIT sent\nJSch Log [level 1]: SSH_MSG_KEXINIT received\nJSch Log [level 1]: kex: server: curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group14-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512\nJSch Log [level 1]: kex: server: rsa-sha2-512,rsa-sha2-256,ecdsa-sha2-nistp256,ssh-ed25519\nJSch Log [level 1]: kex: server: aes256-gcm@openssh.com,chacha20-poly1305@openssh.com,aes256-ctr,aes128-gcm@openssh.com,aes128-ctr\nJSch Log [level 1]: kex: server: aes256-gcm@openssh.com,chacha20-poly1305@openssh.com,aes256-ctr,aes128-gcm@openssh.com,aes128-ctr\nJSch Log [level 1]: kex: server: hmac-sha2-256-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha2-256,hmac-sha1,umac-128@openssh.com,hmac-sha2-512\nJSch Log [level 1]: kex: server: hmac-sha2-256-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha2-256,hmac-sha1,umac-128@openssh.com,hmac-sha2-512\nJSch Log [level 1]: kex: server: none,zlib@openssh.com\nJSch Log [level 1]: kex: server: none,zlib@openssh.com\nJSch Log [level 1]: kex: server: \nJSch Log [level 1]: kex: server: \nJSch Log [level 1]: kex: client: ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group14-sha1,diffie-hellman-group-exchange-sha256,diffie-hellman-group-exchange-sha1,diffie-hellman-group1-sha1\nJSch Log [level 1]: kex: client: ssh-rsa,ssh-dss,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521\nJSch Log [level 1]: kex: client: aes128-ctr,aes128-cbc,3des-ctr,3des-cbc,blowfish-cbc,aes192-ctr,aes192-cbc,aes256-ctr,aes256-cbc\nJSch Log [level 1]: kex: client: aes128-ctr,aes128-cbc,3des-ctr,3des-cbc,blowfish-cbc,aes192-ctr,aes192-cbc,aes256-ctr,aes256-cbc\nJSch Log [level 1]: kex: client: hmac-md5,hmac-sha1,hmac-sha2-256,hmac-sha1-96,hmac-md5-96\nJSch Log [level 1]: kex: client: hmac-md5,hmac-sha1,hmac-sha2-256,hmac-sha1-96,hmac-md5-96\nJSch Log [level 1]: kex: client: none\nJSch Log [level 1]: kex: client: none\nJSch Log [level 1]: kex: server-&gt;client aes128-ctr hmac-sha1 none\nJSch Log [level 1]: kex: client-&gt;server aes128-ctr hmac-sha1 none\nJSch Log [level 1]: SSH_MSG_KEX_ECDH_INIT sent\nJSch Log [level 1]: expecting SSH_MSG_KEX_ECDH_REPLY\nJSch Log [level 2]: Permanently added '10.***.150' (ECDSA) to the list of known hosts.\nJSch Log [level 1]: SSH_MSG_NEWKEYS sent\nJSch Log [level 1]: SSH_MSG_NEWKEYS received\nJSch Log [level 1]: SSH_MSG_SERVICE_REQUEST sent\nJSch Log [level 1]: SSH_MSG_SERVICE_ACCEPT received\nJSch Log [level 1]: Authentications that can continue: gssapi-with-mic,publickey,keyboard-interactive,password\nJSch Log [level 1]: Next authentication method: gssapi-with-mic\nJSch Log [level 1]: Authentications that can continue: publickey,keyboard-interactive,password\nJSch Log [level 1]: Next authentication method: publickey\nJSch Log [level 1]: Authentications that can continue: password\nJSch Log [level 1]: Next authentication method: password\nJSch Log [level 1]: Disconnecting from 10.***.150 port 22\ncom.jcraft.jsch.JSchException: Auth fail\n</code></pre>\n<hr />\n<pre><code>String privateKey = &quot;-----BEGIN RSA PRIVATE KEY----- .......-----END RSA PRIVATE KEY-----&quot;; \n    byte[] privateKeyBytes = privateKey.getBytes(StandardCharsets.UTF_8);\n    \n    jsch.addIdentity(&quot;id_rsa&quot;, privateKeyBytes, null, null); // no passphrase\n    \n    JSch.setLogger(new Logger() {\n        public boolean isEnabled(int level) {\n            return level &lt;= 3; // 3 is the highest verbosity\n        }\n        public void log(int level, String message) {\n            System.out.println(&quot;JSch Log [level &quot; + level + &quot;]: &quot; + message);\n        }\n    });\n    \n    session = jsch.getSession(user, host, 22);\n    session.setConfig(&quot;StrictHostKeyChecking&quot;, &quot;no&quot;);\n    session.setConfig(&quot;LogLevel&quot;, &quot;DEBUG&quot;);\n    session.connect();\n    System.out.println(&quot;Connected to the server!&quot;);\n    \n    ChannelSftp sftp = (ChannelSftp) session.openChannel(&quot;sftp&quot;);\n    sftp.connect();\n    sftp.disconnect();\n</code></pre>\n<hr />\n<p><strong>What I’ve Done</strong></p>\n<p>Converted .ppk to OpenSSH format using PuTTYgen.</p>\n<p>Copied the public key to the server’s ~/.ssh/authorized_keys.</p>\n<p>Set correct permissions on ~/.ssh and authorized_keys.</p>\n<p>Embedded the private key as a string in Java and loaded it using jsch.addIdentity(...).</p>\n<p>Verified there’s no passphrase.</p>\n<p>Enabled detailed logging in JSch</p>\n<p>Why is JSch failing public key authentication even though the key format and authorized_keys setup seem correct? What else should I check or correct?</p>\n",
    "tags" : [ "java", "logging", "ssh" ],
    "owner" : {
      "account_id" : 29151515,
      "reputation" : 166,
      "user_id" : 22332267,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AAcHTteMmC3TlDsNht62CPTM2CLujCwbZb-hUNbmiCJHIbLb=k-s256",
      "display_name" : "Lojini",
      "link" : "https://stackoverflow.com/users/22332267/lojini"
    },
    "is_answered" : true,
    "view_count" : 133,
    "answer_count" : 1,
    "score" : 3,
    "last_activity_date" : 1746168756,
    "creation_date" : 1746001990,
    "link" : "https://stackoverflow.com/questions/79599900/jsch-ssh-authentication-failure-with-private-key-auth-fail-error",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79602928,
    "question_id" : 79599900,
    "body" : "<p><em>Solution for SSH Authentication Failure Using JSch and Alternative with Apache Mina SSHD</em></p>\n<p>Refer Link - <a href=\"https://www.javacodegeeks.com/show-every-file-on-a-remote-server-in-java.html\" rel=\"nofollow noreferrer\">https://www.javacodegeeks.com/show-every-file-on-a-remote-server-in-java.html</a></p>\n<p>After trying different solutions and approaches, I shifted to using Apache Mina SSHD as an alternative to JSch. The Mina SSHD library provided a more reliable way to handle private key-based authentication and SFTP operations.</p>\n<pre><code>URL url = AccessUtil.class.getResource(&quot;/templates/Key/id_rsa&quot;);\nif (url == null) {\n    throw new IllegalArgumentException(&quot;Private key file not found in resources.&quot;);\n}\n\nPath privateKeyPath = null;\ntry {\n    privateKeyPath = Paths.get(url.toURI());\n} catch (URISyntaxException e1) {\n    e1.printStackTrace();\n}\n\ntry (SshClient client = SshClient.setUpDefaultClient()) {\n    client.setServerKeyVerifier(AcceptAllServerKeyVerifier.INSTANCE); \n    client.start();\n\n    try (ClientSession session = client.connect(&quot;username&quot;, &quot;hostname&quot;, 22).verify().getSession()) {\n        FileKeyPairProvider fileKeyPairProvider = new FileKeyPairProvider(Collections.singletonList(privateKeyPath));\n        Iterable&lt;KeyPair&gt; keyPairs = fileKeyPairProvider.loadKeys(null);\n        for (KeyPair keyPair : keyPairs) {\n            session.addPublicKeyIdentity(keyPair);\n        }\n\n        session.auth().verify();\n\n        // SFTP Client\n        SftpClientFactory factory = SftpClientFactory.instance();\n        SftpClient sftpClient = factory.createSftpClient(session);\n        listFiles(sftpClient, &quot;/path/to/directory&quot;); \n    }\n\n    client.stop();\n} catch (IOException e) {\n    e.printStackTrace();\n}\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 29151515,
      "reputation" : 166,
      "user_id" : 22332267,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AAcHTteMmC3TlDsNht62CPTM2CLujCwbZb-hUNbmiCJHIbLb=k-s256",
      "display_name" : "Lojini",
      "link" : "https://stackoverflow.com/users/22332267/lojini"
    },
    "creation_date" : 1746168756,
    "last_activity_date" : 1746168756,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}