{
  "question" : {
    "question_id" : 79825177,
    "title" : "Problem with injecting value to the static variable",
    "body" : "<p>With the entered code here, I am trying to build a project on springboot.  I am using AES encryption in my project. I am keeping the password(key) of AES in the application properties. The variable and method in the AES class are static. I use static for using the method without creating an instance of the class. But I can't inject the value into the static variable in the AES class.  I injected using a workaround method, which is injecting the value to the instance variable and then passing it to the static variable. I also wrote setter method to inject, but these methods throwing warning in the SonarQube. I am using SonarQube to validate my code.  I don't know what to do. I just supressed the warning. Is there any way to inject value without triggering the warning in SonarQube.</p>\n<pre><code>package com.example.demo.utils;\n\nimport lombok.Getter;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Component;\n\nimport javax.crypto.*;\nimport javax.crypto.spec.GCMParameterSpec;\nimport javax.crypto.spec.PBEKeySpec;\nimport javax.crypto.spec.SecretKeySpec;\nimport java.nio.charset.StandardCharsets;\nimport java.security.InvalidAlgorithmParameterException;\nimport java.security.InvalidKeyException;\nimport java.security.NoSuchAlgorithmException;\nimport java.security.SecureRandom;\nimport java.security.spec.InvalidKeySpecException;\nimport java.util.Base64;\n\n@Component\npublic class AESUtils {\n\n    @Getter\n    private static String password;\n\n    @SuppressWarnings(&quot;squid:S2696&quot;)\n    @Value(&quot;${aes.secret.key}&quot;)\n    public void setPassword(String injectedPassword) { // Spring calls this\n        AESUtils.password = injectedPassword;\n    }\n\n    // AES parameters\n    private static final int GCM_IV_LENGTH = 12; // 12-byte IV recommended\n    private static final int GCM_TAG_LENGTH = 128; // 128-bit authentication tag\n    private static final int PBKDF2_ITERATIONS = 51159; // For key derivation\n    private static final int PBKDF2_KEY_LENGTH = 256;\n\n    private static final SecureRandom secureRandom = new SecureRandom();\n\n    // ================================================\n    // Encrypt a plaintext string using AES-GCM\n    // Generates a random IV for each encryption\n    // Returns Base64-encoded string: IV + ciphertext\n    // ================================================\n    public static String encrypt(String plainText) throws NoSuchAlgorithmException, InvalidKeySpecException, NoSuchPaddingException, IllegalBlockSizeException, BadPaddingException, InvalidAlgorithmParameterException, InvalidKeyException {\n        // Generate random 12-byte IV\n        byte[] iv = new byte[GCM_IV_LENGTH];\n        secureRandom.nextBytes(iv);\n\n        // Derive AES key from password\n        SecretKey key = deriveKey(password, iv); // using IV as salt\n\n        // Initialize cipher\n        Cipher cipher = Cipher.getInstance(&quot;AES/GCM/NoPadding&quot;);\n        GCMParameterSpec spec = new GCMParameterSpec(GCM_TAG_LENGTH, iv);\n        cipher.init(Cipher.ENCRYPT_MODE, key, spec);\n\n        // Encrypt plaintext\n        byte[] cipherText = cipher.doFinal(plainText.getBytes(StandardCharsets.UTF_8));\n\n        // Prepend IV to ciphertext\n        byte[] ivAndCipher = new byte[iv.length + cipherText.length];\n        System.arraycopy(iv, 0, ivAndCipher, 0, iv.length);\n        System.arraycopy(cipherText, 0, ivAndCipher, iv.length, cipherText.length);\n\n        // Base64 encode for easy storage/transmission\n        return  Base64.getUrlEncoder().withoutPadding().encodeToString(ivAndCipher);\n\n    }\n\n    // ================================================\n    // Decrypt a Base64-encoded ciphertext string\n    // Extracts IV from first 12 bytes\n    // Returns original plaintext\n    // ================================================\n    public static String decrypt(String base64CipherText) throws NoSuchAlgorithmException, InvalidKeySpecException, NoSuchPaddingException, InvalidAlgorithmParameterException, InvalidKeyException, IllegalBlockSizeException, BadPaddingException {\n        byte[] ivAndCipher = Base64.getUrlDecoder().decode(base64CipherText);\n\n        // Extract IV\n        byte[] iv = new byte[GCM_IV_LENGTH];\n        System.arraycopy(ivAndCipher, 0, iv, 0, GCM_IV_LENGTH);\n\n        // Extract ciphertext\n        byte[] cipherText = new byte[ivAndCipher.length - GCM_IV_LENGTH];\n        System.arraycopy(ivAndCipher, GCM_IV_LENGTH, cipherText, 0, cipherText.length);\n\n        // Derive AES key from password\n        SecretKey key = deriveKey(password, iv); // same IV used as salt\n\n        // Initialize cipher\n        Cipher cipher = Cipher.getInstance(&quot;AES/GCM/NoPadding&quot;);\n        GCMParameterSpec spec = new GCMParameterSpec(GCM_TAG_LENGTH, iv);\n        cipher.init(Cipher.DECRYPT_MODE, key, spec);\n\n        // Decrypt\n        byte[] plainBytes = cipher.doFinal(cipherText);\n\n        return  new String(plainBytes, StandardCharsets.UTF_8);\n\n    }\n\n    // ================================================\n    // Derive AES key from password using PBKDF2 with HMAC-SHA256\n    // Salt ensures unique key per encryption\n    // ================================================\n    private static SecretKey deriveKey(String password, byte[] salt) throws NoSuchAlgorithmException, InvalidKeySpecException {\n        PBEKeySpec spec = new PBEKeySpec(password.toCharArray(), salt, PBKDF2_ITERATIONS, PBKDF2_KEY_LENGTH);\n        SecretKeyFactory factory = SecretKeyFactory.getInstance(&quot;PBKDF2WithHmacSHA256&quot;);\n        byte[] keyBytes = factory.generateSecret(spec).getEncoded();\n        return new SecretKeySpec(keyBytes, &quot;AES&quot;);\n    }\n\n}\n</code></pre>\n",
    "tags" : [ "java", "static", "sonarqube-scan" ],
    "owner" : {
      "account_id" : 44741841,
      "reputation" : 1,
      "user_id" : 31911891,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/878778b7e6bce0b3c0f24b9f947abf61?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "user31911891",
      "link" : "https://stackoverflow.com/users/31911891/user31911891"
    },
    "is_answered" : false,
    "view_count" : 70,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1763651783,
    "creation_date" : 1763621422,
    "link" : "https://stackoverflow.com/questions/79825177/problem-with-injecting-value-to-the-static-variable",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79825667,
    "question_id" : 79825177,
    "body" : "<p>The correct and clean solution would be not to use static methods or static fields for AES encryption, but make <code>AESUtils</code> a Spring bean, inject the secret key normally and autowire <code>AESUtils</code> wherever needed.</p>\n<p>You could also rename the class to <code>AESCryptoService</code> so that it no longer uses the <code>Utils</code> suffix, which helps avoid the confusion of having a utility-style name on a class that doesnâ€™t contain static methods:</p>\n<pre><code>@Component\npublic class AESCryptoService {\n\n    @Value(&quot;${aes.secret.key}&quot;)\n    private String password;\n\n\n    public String encrypt(String plainText) {\n         // implementation\n    }\n\n    public String decrypt(String base64CipherText) {\n        // implementation\n    }\n}\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 18586978,
      "reputation" : 3850,
      "user_id" : 15000097,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/yFl4M.jpg?s=256",
      "display_name" : "Georgii Lvov",
      "link" : "https://stackoverflow.com/users/15000097/georgii-lvov"
    },
    "creation_date" : 1763651783,
    "last_activity_date" : 1763651783,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140863701,
    "post_id" : 79825177,
    "body" : "What is <code>AESUtils</code>, is it your class? If yes, add its code pls to your question",
    "score" : 0,
    "owner" : {
      "account_id" : 18586978,
      "reputation" : 3850,
      "user_id" : 15000097,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/yFl4M.jpg?s=256",
      "display_name" : "Georgii Lvov",
      "link" : "https://stackoverflow.com/users/15000097/georgii-lvov"
    },
    "creation_date" : 1763623705,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}