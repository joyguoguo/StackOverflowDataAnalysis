{
  "question" : {
    "question_id" : 79598818,
    "title" : "Configure Spring @HttpExchange interface to use based on a property",
    "body" : "<p>I would like to be able to configure the Spring <code>@HttpExchange</code> interface to use via <code>application.properties</code>.</p>\n<p>There are two external services that expose a REST endpoint. I do not own either of the two services, and the two services do not even know about each other.</p>\n<p>With that said, the two services offer a very similar API (while not knowing about each other).</p>\n<p>Here is the mock of each of the REST APIs:</p>\n<ul>\n<li><p>At <code>http://some-gold-price-service.com/getPrice</code></p>\n<pre class=\"lang-java prettyprint-override\"><code>@RestController\npublic class GoldPriceController {\n\n    @GetMapping(&quot;/getPrice&quot;)\n    public Map&lt;String, String&gt; getGoldPrice() throws InterruptedException {\n        Thread.sleep(800);\n        System.out.println(&quot;getGoldPrice&quot;);\n        int randomNum = (int)(Math.random() * 101);\n        return Map.of(&quot;price&quot;, String.valueOf(randomNum));\n    }\n\n}\n</code></pre>\n</li>\n<li><p>At <code>http://company-for-stock.co.uk/getPrice</code>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@RestController\npublic class StockPriceController {\n\n    @GetMapping(&quot;/getPrice&quot;)\n    public Map&lt;String, String&gt; getStockPrice() throws InterruptedException {\n        Thread.sleep(800);\n        System.out.println(&quot;Get Stock Price&quot;);\n        int randomNum = (int)(Math.random() * 101);\n        return Map.of(&quot;price&quot;, String.valueOf(randomNum));\n    }\n\n}\n</code></pre>\n</li>\n</ul>\n<p>As you can see, while not knowing about each other, it seems they offer a payload response which contains a price, and a similar <code>/getPrice</code> endpoint.</p>\n<p>To interact with each of them, I am using the code below (mainly from <code>@HttpExchange</code> from Spring):</p>\n<pre class=\"lang-java prettyprint-override\"><code>    @Bean(name = &quot;gold&quot;)\n    RestClient restGoldClient(RestClient.Builder builder, OAuth2ClientHttpRequestInterceptor interceptor) {\n        return builder\n                .baseUrl(&quot;http://some-gold-price-service.com/&quot;)\n                .requestInterceptor(interceptor)\n                .build();\n    }\n\n    @Bean(name = &quot;stock&quot;)\n    RestClient restStockClient() {\n        return RestClient.builder()\n                .baseUrl(&quot;http://company-for-stock.co.uk/&quot;)\n                .requestInterceptor(...)\n                .defaultHeader(&quot;AUTHORIZATION&quot;, fetchToken())\n                .messageConverters(...)\n                .requestFactory(clientHttpRequestFactory())\n                .build();\n    }\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>@Configuration\npublic class RestClientGoldConfiguration {\n\n    @Bean\n    public GoldPriceHttpExchange goldPriceHttpExchange(RestClient restGoldClient) {\n        return HttpServiceProxyFactory.builderFor(RestClientAdapter.create(restClient)).build().createClient(GoldPriceHttpExchange.class);\n    }\n\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>@Configuration\npublic class RestClientStockConfiguration {\n\n    @Bean\n    public StockPriceHttpExchange stockPriceHttpExchange(RestClient restStockClient) {\n        return HttpServiceProxyFactory.builderFor(RestClientAdapter.create(restClient)).build().createClient(StockPriceHttpExchange.class);\n    }\n}\n</code></pre>\n<p>Please note, each site has its own auth, etc. Therefore, we also need two <code>restClient</code>. They are now swappable.</p>\n<p>Here are the interesting bits, the <code>HttpExchange</code>s, which, by the way, seem not to accept a bean name nor a qualifier.</p>\n<pre class=\"lang-java prettyprint-override\"><code>@HttpExchange(accept = &quot;application/json&quot;)\npublic interface GoldPriceHttpExchange {\n\n    @GetExchange(&quot;/getPrice&quot;)\n    Map&lt;String, String&gt; getPrice();\n\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>@HttpExchange(accept = &quot;application/json&quot;)\npublic interface StockPriceHttpExchange {\n\n    @GetExchange(&quot;/getPrice&quot;)\n    Map&lt;String, String&gt; getPrice();\n\n}\n</code></pre>\n<p>And finally, the service using the two <code>HttpExchange</code>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Autowired\nGoldPriceHttpExchange goldPriceHttpExchange;\n\n@Autowired\nStockPriceHttpExchange stockPriceHttpExchange;\n\npublic String getSomePriceDependingOnConfiguration() {\n    // Map&lt;String, String&gt; priceResponse = goldPriceHttpExchange.getPrice();\n    Map&lt;String, String&gt; priceResponse = stockPriceHttpExchange.getPrice();\n\n    return priceResponse.get(&quot;price&quot;);\n}\n</code></pre>\n<p>As of right now, when we need the service to get the price for gold, we comment the other line <code>//Map&lt;String, String&gt; priceResponse = stockPriceHttpExchange.getPrice();</code> and rebuild the app, then configure the URL in application properties to <code>http://some-gold-price-service.com/getPrice</code> to then redeploy the app entirely.</p>\n<p>Vice versa, if we need to get the stock price, we would comment the other line <code>//Map&lt;String, String&gt; priceResponse = goldPriceHttpExchange.getPrice();</code> and again, rebuild an app, configure the application.properties to point the URL to <code>http://company-for-stock.co.uk/getPrice</code> and redeploy the app entirely again.</p>\n<p>Reason is that the underlying <code>RestClient</code> bean needs to change a well.</p>\n<p>Is there a way to simply do something like this?</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Autowired\nGoldPriceHttpExchange goldPriceHttpExchange;\n\n@Autowired\nStockPriceHttpExchange stockPriceHttpExchange;\n\npublic String getSomePriceDependingOnConfiguration() {\n    Map&lt;String, String&gt; priceResponse = {get either goldPriceHttpExchange bean or stockPriceHttpExchange bean based on a property}.getPrice();\n\n    return priceResponse.get(&quot;price&quot;);\n}\n</code></pre>\n",
    "tags" : [ "java", "spring", "spring-boot" ],
    "owner" : {
      "account_id" : 14482834,
      "reputation" : 5468,
      "user_id" : 10461625,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/fgo5D.jpg?s=256",
      "display_name" : "PatPanda",
      "link" : "https://stackoverflow.com/users/10461625/patpanda"
    },
    "is_answered" : true,
    "view_count" : 483,
    "answer_count" : 1,
    "score" : -2,
    "last_activity_date" : 1746188936,
    "creation_date" : 1745943881,
    "link" : "https://stackoverflow.com/questions/79598818/configure-spring-httpexchange-interface-to-use-based-on-a-property",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79603379,
    "question_id" : 79598818,
    "body" : "<p>If I understand correctly you are struggling with managing multiple beans of the type <code>RestClient</code>.\nThis is what the <code>@Qualifier</code> annotation is for:</p>\n<pre><code>    @Bean(name = &quot;gold&quot;)\n    @Qualifier(&quot;gold&quot;)\n    RestClient restGoldClient(RestClient.Builder builder, OAuth2ClientHttpRequestInterceptor interceptor) {\n        return ...\n    }\n\n    @Bean(name = &quot;stock&quot;)\n    @Qualifier(&quot;stock&quot;)\n    RestClient restStockClient() {\n        return ...\n    }\n\n    @Bean\n    public GoldPriceHttpExchange goldPriceHttpExchange(@Qualifier(&quot;gold&quot;) RestClient restGoldClient) {\n        return ...\n    }\n\n\n    @Bean\n    public StockPriceHttpExchange stockPriceHttpExchange(@Qualifier(&quot;stock&quot;) RestClient restStockClient) {\n        return ...\n    }\n</code></pre>\n<p>The above will match up each <code>RestClient</code> parameter with the respective bean that has the corresponding <code>@Qualifier</code> annotation.</p>\n<p>You can now have both HttpExchange types in your controller and switch between them using standard control flow:</p>\n<pre><code>@Autowired\nGoldPriceHttpExchange goldPriceHttpExchange;\n\n@Autowired\nStockPriceHttpExchange stockPriceHttpExchange;\n\npublic String getSomePriceDependingOnConfiguration() {\n    Map&lt;String, String&gt; priceResponse = \n        switch(someStringProperty) {\n            case &quot;gold&quot;  -&gt; goldPriceHttpExchange.getPrice();\n            case &quot;stock&quot; -&gt; stockPriceHttpExchange.getPrice();\n            default -&gt; null;\n        }\n    }\n    if(priceResponse == null) {\n        throw new IllegalArgumentException(&quot;Ivalid value for someStringProperty: &quot;+ someStringProperty);\n    }\n    //else\n    return priceResponse.get(&quot;price&quot;);\n}\n</code></pre>\n<p>'someStringProperty' is just an example. How you determine which price to obtain is up to you.</p>\n<p>For more information about the <code>@Qualifier</code> annotation, please see <a href=\"https://docs.spring.io/spring-framework/reference/core/beans/annotation-config/autowired-qualifiers.html\" rel=\"nofollow noreferrer\">https://docs.spring.io/spring-framework/reference/core/beans/annotation-config/autowired-qualifiers.html</a></p>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 13252051,
      "reputation" : 1788,
      "user_id" : 9569292,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/s256-rj/photo.jpg",
      "display_name" : "Thomas Timbul",
      "link" : "https://stackoverflow.com/users/9569292/thomas-timbul"
    },
    "creation_date" : 1746188936,
    "last_activity_date" : 1746188936,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140381931,
    "post_id" : 79598818,
    "body" : "Didn&#39;t you ask the exact same questions just a few days ago? With your added requirements, this sounds like a prime use case of the <i>strategy pattern</i>. Have an interface with two implementations. Add a third implementation that will delegate to one of two instances depending on certain criteria.",
    "score" : 2,
    "owner" : {
      "account_id" : 39208,
      "reputation" : 269387,
      "user_id" : 112968,
      "user_type" : "registered",
      "accept_rate" : 68,
      "profile_image" : "https://i.sstatic.net/zHTaT.png?s=256",
      "display_name" : "knittl",
      "link" : "https://stackoverflow.com/users/112968/knittl"
    },
    "creation_date" : 1745963082,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140381284,
    "post_id" : 79598818,
    "body" : "isnt that just plain <code>if</code> statement ???.....",
    "score" : 0,
    "owner" : {
      "account_id" : 1658807,
      "reputation" : 32688,
      "user_id" : 1527544,
      "user_type" : "registered",
      "accept_rate" : 54,
      "profile_image" : "https://www.gravatar.com/avatar/6665878d41d42307eb53e9fae311a471?s=256&d=identicon&r=PG",
      "display_name" : "Antoniossss",
      "link" : "https://stackoverflow.com/users/1527544/antoniossss"
    },
    "creation_date" : 1745949617,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}