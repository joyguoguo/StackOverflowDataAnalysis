{
  "question" : {
    "question_id" : 79833859,
    "title" : "Mapping an entity with an embedded key",
    "body" : "<p>There is a class with an <code>EmbeddedId</code>.</p>\n<pre><code>@Entity\n@Getter\n@Setter\n@Table(name = &quot;indicator_values&quot;)\npublic class IndicatorValue {\n\n    @EmbeddedId\n    public IndicatorValueId id;\n\n    @Column(name = &quot;value&quot;)\n    public BigDecimal value;\n\n    public IndicatorValue() {}\n\n    public IndicatorValue(\n        IndicatorValueId id,\n        BigDecimal value\n    ) {\n        this.id = id;\n        this.value = value;\n    }\n\n    // Constructor used for experimentation (invoked in the repository)\n    public IndicatorValue(\n        String categoryCode,\n        String indicatorCode,\n        BigDecimal value,\n        LocalDate effectiveDate\n    ) {\n        this.value = value;\n        this.id = new IndicatorValueId(categoryCode, indicatorCode, effectiveDate);\n    }\n\n}\n</code></pre>\n<p>Alongside it, there is an <code>@Embeddable</code> class that defines this ID.</p>\n<pre><code>@Embeddable\n@AllArgsConstructor\n@NoArgsConstructor\n@EqualsAndHashCode\n@Getter\n@Setter\npublic class IndicatorValueId implements Serializable {\n    @Column(name = &quot;category_code&quot;)\n    private String categoryCode;\n    @Column(name = &quot;indicator_code&quot;)\n    private String indicatorCode;\n    @Column(name = &quot;effective_date&quot;)\n    private LocalDate effectiveDate;\n}\n</code></pre>\n<p>And there is a repository (I’ve tried different methods to verify the result—this is not the complete list).</p>\n<pre><code>public interface IndicatorValueRepository extends JpaRepository&lt;IndicatorValue, IndicatorValueId&gt; {\n\n    @Query(&quot;&quot;&quot;\n    SELECT iv\n    FROM IndicatorValue iv\n    WHERE iv.id.indicatorCode = :indicatorCode\n      AND iv.id.effectiveDate &lt; :effectiveDate\n    ORDER BY iv.id.effectiveDate DESC\n    &quot;&quot;&quot;)\n    List&lt;IndicatorValue&gt; findByIndicatorCodeBeforeDate(\n            @Param(&quot;indicatorCode&quot;) String indicatorCode,\n            @Param(&quot;effectiveDate&quot;) LocalDate effectiveDate\n    );\n\n    @Query(&quot;&quot;&quot;\n    SELECT NEW by.vezhlivec.normsservice.entity.IndicatorValue(\n      iv.id.categoryCode,\n      iv.id.indicatorCode,\n      iv.value,\n      iv.id.effectiveDate\n      )\n    FROM IndicatorValue iv\n    WHERE iv.id.indicatorCode = :indicatorCode\n      AND iv.id.categoryCode IS NULL\n      AND iv.id.effectiveDate &lt; :effectiveDate\n    ORDER BY iv.id.effectiveDate DESC\n    &quot;&quot;&quot;)\n    List&lt;IndicatorValue&gt; findByIndicatorCodeBeforeDate1(\n            @Param(&quot;indicatorCode&quot;) String indicatorCode,\n            @Param(&quot;effectiveDate&quot;) LocalDate effectiveDate\n    );\n\n    List&lt;IndicatorValue&gt; findByIdIndicatorCode(String indicatorCode);\n\n    List&lt;IndicatorValue&gt; findByValue(BigDecimal value);\n}\n</code></pre>\n<p>The core issue is that data is retrieved correctly <strong>only</strong> when I select a specific field, use a native query, or perform mapping via a constructor (as in <code>findByIndicatorCodeBeforeDate1</code>).</p>\n<p>In all other cases—when attempting to fetch the entity or a list of entities—I either get <code>null</code> or a <code>List</code> with the correct number of elements, but every element is <code>null</code>.</p>\n<p>Even the standard <code>findById()</code> returns <code>null</code>, despite the record definitely existing in the database.</p>\n<p>Here is a test snippet from the service</p>\n<pre><code>        List&lt;IndicatorValue&gt; iv = indicatorValueRepository.findByIdIndicatorCode(&quot;worker_4th_grade_hour_rate_construction&quot;);\n        System.out.println(iv);\n        List&lt;IndicatorValue&gt; v = indicatorValueRepository.findByValue(new BigDecimal(&quot;13.02&quot;));\n        System.out.println(v);\n\n        List&lt;IndicatorValue&gt; iv1 = indicatorValueRepository\n                .findByIndicatorCodeBeforeDate(&quot;worker_4th_grade_hour_rate_construction&quot;, period.atDay(1));\n        System.out.println(iv1);\n\n        List&lt;IndicatorValue&gt; iv2 = indicatorValueRepository\n                .findByIndicatorCodeBeforeDate1(&quot;worker_4th_grade_hour_rate_construction&quot;, period.atDay(1));\n        for (IndicatorValue iv3 : iv2) {\n            log.debug(&quot;Код категории: {}, код индикатора: {}, значение: {}, дата: {}&quot;,\n                    iv3.getId().getCategoryCode(),\n                    iv3.getId().getIndicatorCode(),\n                    iv3.getValue(),\n                    iv3.getId().getEffectiveDate());\n        }\n\n        Optional&lt;IndicatorValue&gt; iv4 = indicatorValueRepository\n                .findById(new IndicatorValueId(\n                        null,\n                        &quot;worker_4th_grade_hour_rate_construction&quot;,\n                        LocalDate.of(2025, 9, 1)\n                        )\n                );\n        System.out.println(iv4.orElse(null));\n</code></pre>\n<p>and the corresponding log output.</p>\n<pre><code>2025-11-28T22:28:44.318+03:00 DEBUG 414781 --- [nio-8080-exec-2] org.hibernate.SQL                        : \n    select\n        iv1_0.category_code,\n        iv1_0.effective_date,\n        iv1_0.indicator_code,\n        iv1_0.value \n    from\n        indicator_values iv1_0 \n    where\n        iv1_0.indicator_code=?\n2025-11-28T22:28:44.323+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (1:VARCHAR) -&gt; [null]\n2025-11-28T22:28:44.324+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (1:VARCHAR) -&gt; [null]\n2025-11-28T22:28:44.324+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (1:VARCHAR) -&gt; [null]\n[null, null, null]\n2025-11-28T22:28:44.326+03:00 DEBUG 414781 --- [nio-8080-exec-2] org.hibernate.SQL                        : \n    select\n        iv1_0.category_code,\n        iv1_0.effective_date,\n        iv1_0.indicator_code,\n        iv1_0.value \n    from\n        indicator_values iv1_0 \n    where\n        iv1_0.value=?\n2025-11-28T22:28:44.327+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (1:VARCHAR) -&gt; [null]\n2025-11-28T22:28:44.327+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (1:VARCHAR) -&gt; [null]\n2025-11-28T22:28:44.327+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (1:VARCHAR) -&gt; [null]\n2025-11-28T22:28:44.327+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (1:VARCHAR) -&gt; [null]\n2025-11-28T22:28:44.327+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (1:VARCHAR) -&gt; [null]\n[null, null, null, null, null]\n2025-11-28T22:28:44.330+03:00 DEBUG 414781 --- [nio-8080-exec-2] org.hibernate.SQL                        : \n    select\n        iv1_0.category_code,\n        iv1_0.effective_date,\n        iv1_0.indicator_code,\n        iv1_0.value \n    from\n        indicator_values iv1_0 \n    where\n        iv1_0.indicator_code=? \n        and iv1_0.effective_date&lt;? \n    order by\n        iv1_0.effective_date desc\n2025-11-28T22:28:44.331+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (1:VARCHAR) -&gt; [null]\n[null]\n2025-11-28T22:28:44.333+03:00 DEBUG 414781 --- [nio-8080-exec-2] org.hibernate.SQL                        : \n    select\n        iv1_0.category_code,\n        iv1_0.indicator_code,\n        iv1_0.value,\n        iv1_0.effective_date \n    from\n        indicator_values iv1_0 \n    where\n        iv1_0.indicator_code=? \n        and iv1_0.category_code is null \n        and iv1_0.effective_date&lt;? \n    order by\n        iv1_0.effective_date desc\n2025-11-28T22:28:44.334+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (1:VARCHAR) -&gt; [null]\n2025-11-28T22:28:44.334+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (2:VARCHAR) -&gt; [worker_4th_grade_hour_rate_construction]\n2025-11-28T22:28:44.334+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (3:NUMERIC) -&gt; [13.02]\n2025-11-28T22:28:44.334+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (4:DATE) -&gt; [2024-09-01]\n2025-11-28T22:28:44.335+03:00 DEBUG 414781 --- [nio-8080-exec-2] b.v.n.s.i.u.IndicatorsUpdateService      : Код категории: null, код индикатора: worker_4th_grade_hour_rate_construction, значение: 13.02, дата: 2024-09-01\n2025-11-28T22:28:44.350+03:00 DEBUG 414781 --- [nio-8080-exec-2] org.hibernate.SQL                        : \n    select\n        iv1_0.category_code,\n        iv1_0.effective_date,\n        iv1_0.indicator_code,\n        iv1_0.value \n    from\n        indicator_values iv1_0 \n    where\n        (\n            iv1_0.category_code, iv1_0.effective_date, iv1_0.indicator_code\n        ) in ((?, ?, ?))\nnull\n</code></pre>\n",
    "tags" : [ "java", "hibernate", "jpa", "mapping" ],
    "owner" : {
      "account_id" : 35681406,
      "reputation" : 1,
      "user_id" : 31969879,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6955aa5fb9ec877d76cf319c8243ffe6?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Сергей Потапчук",
      "link" : "https://stackoverflow.com/users/31969879/%d0%a1%d0%b5%d1%80%d0%b3%d0%b5%d0%b9-%d0%9f%d0%be%d1%82%d0%b0%d0%bf%d1%87%d1%83%d0%ba"
    },
    "is_answered" : false,
    "view_count" : 70,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1764523732,
    "creation_date" : 1764503471,
    "link" : "https://stackoverflow.com/questions/79833859/mapping-an-entity-with-an-embedded-key",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140880420,
    "post_id" : 79833859,
    "body" : "My English isn&#39;t very strong. I didn’t mean that I’d found a solution—I only updated the class in the post. The database (<code>PostgreSQL</code>) uses a column of type <code>date</code>.",
    "score" : 0,
    "owner" : {
      "account_id" : 35681406,
      "reputation" : 1,
      "user_id" : 31969879,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6955aa5fb9ec877d76cf319c8243ffe6?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Сергей Потапчук",
      "link" : "https://stackoverflow.com/users/31969879/%d0%a1%d0%b5%d1%80%d0%b3%d0%b5%d0%b9-%d0%9f%d0%be%d1%82%d0%b0%d0%bf%d1%87%d1%83%d0%ba"
    },
    "creation_date" : 1764528746,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140880347,
    "post_id" : 79833859,
    "body" : "What is the date type in the DB? I noticed that findByIndicatorCodeBeforeDate1 and others use &lt; for the date value, not an == check, so I would guess it has to do with precision in your DB value vs what is passed in on the check.",
    "score" : 0,
    "owner" : {
      "account_id" : 231721,
      "reputation" : 21335,
      "user_id" : 496099,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/efa7510cf47d7bd79e80486246e7e39e?s=256&d=identicon&r=PG",
      "display_name" : "Chris",
      "link" : "https://stackoverflow.com/users/496099/chris"
    },
    "creation_date" : 1764524209,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140880336,
    "post_id" : 79833859,
    "body" : "Alright, I&#39;ve fixed it. Thank you.",
    "score" : 0,
    "owner" : {
      "account_id" : 35681406,
      "reputation" : 1,
      "user_id" : 31969879,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6955aa5fb9ec877d76cf319c8243ffe6?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Сергей Потапчук",
      "link" : "https://stackoverflow.com/users/31969879/%d0%a1%d0%b5%d1%80%d0%b3%d0%b5%d0%b9-%d0%9f%d0%be%d1%82%d0%b0%d0%bf%d1%87%d1%83%d0%ba"
    },
    "creation_date" : 1764523818,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140880307,
    "post_id" : 79833859,
    "body" : "Oh ok, I see. In that case, update your post to reflect your actual code. This will help us to provide better answers or comments. Btw yes, the Jakarta Persistence specs doesn&#39;t say anything about a compulsory all-arg constructor, but since you were trying to build an <code>IndicatorValue</code> with <code>IndicatorValueId</code>&#39;s fields rather than an actual instance, I thought that could be the cause :/ I&#39;ll keep scratching my head though. Maybe somebody else might be able to help you with the updated version of your code.",
    "score" : 0,
    "owner" : {
      "account_id" : 5569841,
      "reputation" : 8654,
      "user_id" : 4415625,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0ea1713807527aa1cf52e40579e35ec4?s=256&d=identicon&r=PG",
      "display_name" : "dani-vta",
      "link" : "https://stackoverflow.com/users/4415625/dani-vta"
    },
    "creation_date" : 1764522478,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140880290,
    "post_id" : 79833859,
    "body" : "Yes, sorry—I was experimenting, and the class actually has multiple constructors. Initially, I used the annotations: <code>@AllArgsConstructor</code> and <code>@NoArgsConstructor</code>. Later, I replaced them with explicitly written constructors. When drafting the post, I simply omitted listing all of them (including <code>@AllArgsConstructor</code>) because, as far as I understand, <code>@AllArgsConstructor</code> isn’t strictly required in this context.  But please believe me—it is present. I’ve even tried making the fields <code>public</code> to rule out visibility issues, and that didn’t help either.",
    "score" : 0,
    "owner" : {
      "account_id" : 35681406,
      "reputation" : 1,
      "user_id" : 31969879,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6955aa5fb9ec877d76cf319c8243ffe6?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Сергей Потапчук",
      "link" : "https://stackoverflow.com/users/31969879/%d0%a1%d0%b5%d1%80%d0%b3%d0%b5%d0%b9-%d0%9f%d0%be%d1%82%d0%b0%d0%bf%d1%87%d1%83%d0%ba"
    },
    "creation_date" : 1764521884,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140880236,
    "post_id" : 79833859,
    "body" : "From what I see in your question, you have an <code>@AllArgsConstructor</code> only in <code>IndicatorValueId</code> not in <code>IndicatorValue</code>.",
    "score" : 0,
    "owner" : {
      "account_id" : 5569841,
      "reputation" : 8654,
      "user_id" : 4415625,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0ea1713807527aa1cf52e40579e35ec4?s=256&d=identicon&r=PG",
      "display_name" : "dani-vta",
      "link" : "https://stackoverflow.com/users/4415625/dani-vta"
    },
    "creation_date" : 1764519193,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140880141,
    "post_id" : 79833859,
    "body" : "I added such a constructor (and it’s still present), but it doesn’t change the result at all.",
    "score" : 0,
    "owner" : {
      "account_id" : 35681406,
      "reputation" : 1,
      "user_id" : 31969879,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6955aa5fb9ec877d76cf319c8243ffe6?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Сергей Потапчук",
      "link" : "https://stackoverflow.com/users/31969879/%d0%a1%d0%b5%d1%80%d0%b3%d0%b5%d0%b9-%d0%9f%d0%be%d1%82%d0%b0%d0%bf%d1%87%d1%83%d0%ba"
    },
    "creation_date" : 1764514062,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140880129,
    "post_id" : 79833859,
    "body" : "<i>data is retrieved correctly only when I select a specific field, use a native query, or perform mapping via a constructor</i> That&#39;s because you&#39;re telling the framework how to construct your data when using finer fields. The class <code>IndicatorValue</code> should also exhibit a constructor that accepts an instance of <code>IndicatorValueId</code>. So, <code>public IndicatorValue(IndicatorValueId id, BigDecimal value)</code>.",
    "score" : 0,
    "owner" : {
      "account_id" : 5569841,
      "reputation" : 8654,
      "user_id" : 4415625,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0ea1713807527aa1cf52e40579e35ec4?s=256&d=identicon&r=PG",
      "display_name" : "dani-vta",
      "link" : "https://stackoverflow.com/users/4415625/dani-vta"
    },
    "creation_date" : 1764513183,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}