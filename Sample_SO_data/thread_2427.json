{
  "question" : {
    "question_id" : 79621306,
    "title" : "Spring boot application with powershell",
    "body" : "<p>I have developed a web application in spring boot that retrieves the membership details of Microsoft 365 Groups, Distribution Lists (DL), and Mail-Enabled Security Groups (MESG) when a user's email address is entered in the search form. The application lists all associated groups for that user, allowing individual or multiple selections for removal.</p>\n<p>Currently, the removal of Microsoft 365 Groups is handled through the Graph API, while DL and MESG removals are managed via PowerShell scripts. The issue I'm facing is that the PowerShell script successfully removes users from Distribution Lists, but fails for Mail-Enabled Security Groups, returning the error: <strong>&quot;You don't have sufficient permissions. This operation can only be performed by a manager of the group.&quot;</strong></p>\n<p>I've tried multiple approaches, and all the necessary permissions are correctly configured for the executing email address. My application uses Office 365 login, and only users with admin rights can access the removal dashboard; others are redirected to a different landing page.</p>\n<p>Below is the PowerShell script snippet for reference:</p>\n<pre><code>param ( \n    [string]$UserEmail,\n    [string]$GroupId,\n    [string]$GroupType,\n    [string]$AccessToken\n)\n\n# === Log the inputs ===\nWrite-Host &quot;UserEmail: $UserEmail&quot;\nWrite-Host &quot;GroupId: $GroupId&quot;\nWrite-Host &quot;GroupType: $GroupType&quot;\n\n# === Step 1: Connect to Exchange Online ===\nWrite-Host &quot;Connecting to Exchange Online...&quot;\ntry {\n    Connect-ExchangeOnline -AccessToken $AccessToken -Organization &quot;xxx.onmicrosoft.com&quot;\n    Write-Host &quot;✅ Connected to Exchange Online.&quot;\n} catch {\n    Write-Host &quot;❌ Failed to connect to Exchange Online.&quot;\n    Write-Host $_\n    exit 1\n}\n\n# === Step 2: Perform Removal Logic ===\nif ($GroupType -eq &quot;Mail-Enabled Security Group&quot;) {\n    Write-Host &quot;Removing user $UserEmail from Mail-Enabled Security Group: $GroupId&quot;\n    \n    try {\n        # Attempt to remove user\n        Remove-DistributionGroupMember -Identity $GroupId -Member $UserEmail -Confirm:$false -ErrorAction Stop\n        Write-Host &quot;✅ User $UserEmail removed from Mail-Enabled Security Group.&quot;\n    } catch {\n        Write-Host &quot;❌ Error during removal:&quot;\n        Write-Host $_.Exception.Message\n        Write-Host $_.ScriptStackTrace\n        Write-Host &quot;Re-checking membership status...&quot;\n\n        # Get full membership details for diagnosis\n        $memberDetails = Get-DistributionGroupMember -Identity $GroupId | Where-Object {$_.PrimarySmtpAddress -eq $UserEmail}\n        if ($memberDetails) {\n            Write-Host &quot;❌ User $UserEmail still present after removal attempt. Member Details:&quot;\n            $memberDetails | Format-List\n        } else {\n            Write-Host &quot;✅ User $UserEmail successfully removed after re-check.&quot;\n        }\n    }\n\n    Disconnect-ExchangeOnline -Confirm:$false\n    Write-Host &quot;Disconnected from Exchange Online&quot;\n} else {\n    Write-Host &quot;❌ Unknown group type: $GroupType&quot;\n}\n</code></pre>\n",
    "tags" : [ "java", "spring-boot", "azure", "powershell", "microsoft-graph-api" ],
    "owner" : {
      "account_id" : 8830179,
      "reputation" : 195,
      "user_id" : 6596872,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/113026aafd8b8ca22aa37a6f233bcafd?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "BeginnerBro",
      "link" : "https://stackoverflow.com/users/6596872/beginnerbro"
    },
    "is_answered" : false,
    "view_count" : 117,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1747241476,
    "creation_date" : 1747220098,
    "link" : "https://stackoverflow.com/questions/79621306/spring-boot-application-with-powershell",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79621943,
    "question_id" : 79621306,
    "body" : "<blockquote>\n<p>You don't have sufficient permissions. This operation can only be performed by a manager of the group</p>\n</blockquote>\n<p>Initially, I got the same error, message When I tried to delete the <code>Mail-Enabled Security</code> Group even though I had <code>Exchange Administrator</code> role assigned.</p>\n<p><a href=\"https://i.sstatic.net/UaBfjBED.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/UaBfjBED.png\" alt=\"enter image description here\" /></a></p>\n<p>To error message you are getting because, <strong>only <code>Owner</code> of that<code>Mail-Enabled Security Group</code> have permission to delete that specific Group.</strong></p>\n<p>I created one <code>Mail-Enabled Security Group</code>  in <a href=\"https://admin.microsoft.com/\" rel=\"nofollow noreferrer\">M365 Admin Center</a> and Added <code>Owner</code> and <code>Member</code> to group.</p>\n<p><a href=\"https://i.sstatic.net/OKHsz918.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/OKHsz918.png\" alt=\"enter image description here\" /></a></p>\n<p><strong>Note:</strong>   Managing of Mail Enabled Security Group is not possible on <a href=\"https://portal.azure.com\" rel=\"nofollow noreferrer\">Azure Portal</a> which means  adding or removing  <code>Owner</code> and <code>Member</code> for Mail-Enabled Security Group is not featured on Azure portal.</p>\n<p><strong>Ensure to <code>Connect-Exchange</code> using Owner's UPN of your Mail-Enabled Security Group.</strong></p>\n<p><strong>To Remove the Mail-Enabled Security Group:</strong></p>\n<pre><code>Connect-ExchangeOnline #Sign-In with Owner's UPN of Group\n\nGet-DistributionGroup -ResultSize Unlimited |\nWhere-Object {$_.RecipientTypeDetails -eq &quot;MailUniversalSecurityGroup&quot;} |\nSelect-Object Name, PrimarySmtpAddress, RecipientTypeDetails #listed all the Mail-Enabled Security Group #list all the Mail-Enabled Security group from tenant.\n\nRemove-DistributionGroup -Identity &quot;&lt;Name of your Mail-Enabled Security Group&gt;&quot;\n\n</code></pre>\n<p><strong>Responses:</strong></p>\n<p>1.Listing of all Mail-Enabled Security Group:</p>\n<p><a href=\"https://i.sstatic.net/v8ExI7jo.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/v8ExI7jo.png\" alt=\"enter image description here\" /></a></p>\n<p>2.Removing of Mail-Enabled Security Group:</p>\n<p><a href=\"https://i.sstatic.net/CUovTPCr.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/CUovTPCr.png\" alt=\"enter image description here\" /></a></p>\n<p><strong>Note:</strong> <code>RecipientTypeDetails</code>: This shows the group type: <code>MailUniversalSecurityGroup</code> --&gt; <strong>Mail-Enabled Security Group.</strong></p>\n<p>Also, I've verified from M365 Admin Center portal, Group is deleted Successfully:</p>\n<p><strong>Reference:</strong></p>\n<p><a href=\"https://learn.microsoft.com/en-us/powershell/module/exchange/remove-distributiongroup?view=exchange-ps\" rel=\"nofollow noreferrer\">Remove-DistributionGroup</a></p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 30537644,
      "reputation" : 1238,
      "user_id" : 23404481,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e91345bd5e9f160649927ad827d10bfe?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Pratik Jadhav",
      "link" : "https://stackoverflow.com/users/23404481/pratik-jadhav"
    },
    "creation_date" : 1747241476,
    "last_activity_date" : 1747241476,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140450743,
    "post_id" : 79621306,
    "body" : "Any update on the issue? @BeginnerBro",
    "score" : 0,
    "owner" : {
      "account_id" : 30537644,
      "reputation" : 1238,
      "user_id" : 23404481,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e91345bd5e9f160649927ad827d10bfe?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Pratik Jadhav",
      "link" : "https://stackoverflow.com/users/23404481/pratik-jadhav"
    },
    "creation_date" : 1747944133,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140425675,
    "post_id" : 79621306,
    "body" : "assigned user has ownership also for the same group.  The thing while checking in EAC o365 owner showing the name of assigned user but in entra portal there is no owner showing for the same group. is this normal behaviour in Entra portal?",
    "score" : 0,
    "owner" : {
      "account_id" : 8830179,
      "reputation" : 195,
      "user_id" : 6596872,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/113026aafd8b8ca22aa37a6f233bcafd?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "BeginnerBro",
      "link" : "https://stackoverflow.com/users/6596872/beginnerbro"
    },
    "creation_date" : 1747237210,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140425628,
    "post_id" : 79621306,
    "body" : "Could you please confirm does the user is <code>Owner</code> of that mail-enabled security group?",
    "score" : 0,
    "owner" : {
      "account_id" : 30537644,
      "reputation" : 1238,
      "user_id" : 23404481,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e91345bd5e9f160649927ad827d10bfe?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Pratik Jadhav",
      "link" : "https://stackoverflow.com/users/23404481/pratik-jadhav"
    },
    "creation_date" : 1747236494,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140425115,
    "post_id" : 79621306,
    "body" : "assigned roles are Exchange Administrator, Exchange Recipient Administrator, Global Administrator, Groups Administrator",
    "score" : 0,
    "owner" : {
      "account_id" : 8830179,
      "reputation" : 195,
      "user_id" : 6596872,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/113026aafd8b8ca22aa37a6f233bcafd?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "BeginnerBro",
      "link" : "https://stackoverflow.com/users/6596872/beginnerbro"
    },
    "creation_date" : 1747228684,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140424841,
    "post_id" : 79621306,
    "body" : "<code>Remove-DistributionGroup</code> command is used for deleting the Mail-Enabled Security Group and Distribution Group list as well, Could you please confirm which permission is assigned to user?",
    "score" : 0,
    "owner" : {
      "account_id" : 30537644,
      "reputation" : 1238,
      "user_id" : 23404481,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e91345bd5e9f160649927ad827d10bfe?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Pratik Jadhav",
      "link" : "https://stackoverflow.com/users/23404481/pratik-jadhav"
    },
    "creation_date" : 1747224621,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}