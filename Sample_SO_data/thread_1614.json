{
  "question" : {
    "question_id" : 79690198,
    "title" : "How to avoid extra blank space at the bottom of PDF output using headless Chrome and CDP in Java?",
    "body" : "<p>I'm generating a PDF from a responsive web page (mobile version) using a headless Chrome instance and the Chrome DevTools Protocol (CDP) in Java. The goal is to produce a single-page PDF that reflects exactly what the user would see on a mobile screen.</p>\n<p><strong>My Setup:</strong></p>\n<ol>\n<li>I launch headless Chrome in the terminal.</li>\n<li>I connect to it using the webSocketDebuggerUrl.</li>\n<li>I execute the following CDP commands in this order (all synchronously):</li>\n</ol>\n<pre><code>// Step 1: Enable required domains\nsend(&quot;Page.enable&quot;);\nsend(&quot;Runtime.enable&quot;);\nsend(&quot;Log.enable&quot;);\n\n// Step 2: Set mobile viewport\nsend(&quot;Emulation.setDeviceMetricsOverride&quot;, {\n  width: 360,\n  height: 640,\n  deviceScaleFactor: 1,\n  mobile: true\n});\n\n// Step 3: Set media to screen\nsend(&quot;Emulation.setEmulatedMedia&quot;, {\n  media: &quot;screen&quot;\n});\n\n// Step 4: Navigate to the URL\nsend(&quot;Page.navigate&quot;, {\n  url: &quot;https://arunac97.github.io/samplesite.com/newcanvas.html&quot;\n});\n\n// Step 5: Wait for the page to load (handled properly in code)\n\n// Step 6: Get layout metrics\nJSONObject layout = send(&quot;Page.getLayoutMetrics&quot;);\nJSONObject cssContentSize = layout.getJSONObject(&quot;cssContentSize&quot;);\nfloat contentWidth = cssContentSize.getFloat(&quot;width&quot;);\nfloat contentHeight = cssContentSize.getFloat(&quot;height&quot;);\n\n// Step 7: Print to PDF\nsend(&quot;Page.printToPDF&quot;, {\n  paperWidth: contentWidth / 96, (converting pixel to inch - 96 dpi)\n  paperHeight: contentHeight / 96,\n  marginTop: 0,\n  marginBottom: 0,\n  marginLeft: 0,\n  marginRight: 0,\n  scale: 1,\n  printBackground: true\n});\n</code></pre>\n<p><strong>Problem:</strong>\nThe PDF is generated correctly, but it includes a large blank space at the bottom—about 30% of the page height—which shouldn't be there.</p>\n<ol>\n<li>I'm using Page.getLayoutMetrics to determine the real content size and feeding those exact values (converted to inches) into Page.printToPDF.</li>\n<li>I'm drawing a  element using JavaScript after the page loads. The canvas is sized to exactly match the full scrollable width and height of the page and is positioned on top of all content.</li>\n</ol>\n<p>If I use a custom paperWidth and paperHeight in printToPDF that doesn't exactly match the page's real dimensions, Chrome seems to re-render the page with those new dimensions during PDF generation. This causes the canvas to become misaligned or appear at the wrong place, since it was drawn based on the original page size.</p>\n<p>That's why I'm using the exact width and height from Page.getLayoutMetrics to avoid this rendering issue and preserve the canvas position.</p>\n<p><strong>Questions:</strong>\nWhat causes this extra space to be appended to the bottom of the generated PDF?</p>\n<ol>\n<li>Is there a better way to determine the exact printable area without\ncausing canvas misalignment?</li>\n<li>Is there any known workaround to force Page.printToPDF to honor only\nthe actual visible content?</li>\n<li>Any help or insight would be deeply appreciated.</li>\n</ol>\n<hr />\n<p>This is a test website I hosted on GitHub Pages to reproduce and test these cases:\n<a href=\"https://arunac97.github.io/samplesite.com/newcanvas.html\" rel=\"nofollow noreferrer\">https://arunac97.github.io/samplesite.com/newcanvas.html</a></p>\n<hr />\n<p><strong>GitHub repo with reproducible code:</strong>\n<a href=\"https://github.com/arunac97/HeadlessApp\" rel=\"nofollow noreferrer\">https://github.com/arunac97/HeadlessApp</a>\n(Contains Java code and the canvas-drawing JS.)</p>\n<p><strong>\uD83E\uDDEA Test Cases:</strong></p>\n<ol>\n<li><p>Case 1 (multi-page, fixed dimensions): Canvas misaligns.\n<a href=\"https://github.com/arunac97/HeadlessApp/blob/main/case1.pdf\" rel=\"nofollow noreferrer\">https://github.com/arunac97/HeadlessApp/blob/main/case1.pdf</a></p>\n</li>\n<li><p>Case 2 (single tall page using getLayoutMetrics): Extra blank space at bottom.\n<a href=\"https://github.com/arunac97/HeadlessApp/blob/main/case2.pdf\" rel=\"nofollow noreferrer\">https://github.com/arunac97/HeadlessApp/blob/main/case2.pdf</a></p>\n</li>\n</ol>\n<p>Thanks!</p>\n",
    "tags" : [ "java", "google-chrome-devtools", "pdf-generation", "google-chrome-headless", "chrome-devtools-protocol" ],
    "owner" : {
      "account_id" : 12101124,
      "reputation" : 555,
      "user_id" : 8842148,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://www.gravatar.com/avatar/c989f14abc638567f36a9a425d72c4b5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Arun Kumar",
      "link" : "https://stackoverflow.com/users/8842148/arun-kumar"
    },
    "is_answered" : false,
    "view_count" : 97,
    "answer_count" : 0,
    "score" : 2,
    "last_activity_date" : 1751913082,
    "creation_date" : 1751632834,
    "link" : "https://stackoverflow.com/questions/79690198/how-to-avoid-extra-blank-space-at-the-bottom-of-pdf-output-using-headless-chrome",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140572422,
    "post_id" : 79690198,
    "body" : "@KJ  In case 1, I gave a fixed width and height—are you able to understand the issue there? The canvas is fully drawn, but after that, the page renders beyond the canvas. The canvas doesn’t redraw, so it becomes misaligned. If someone can help explain why that happens and how to prevent the page from re-rendering after the canvas is drawn, it would be really helpful. Is there a way to make the canvas stay in place while still using fixed-size pages?",
    "score" : 0,
    "owner" : {
      "account_id" : 12101124,
      "reputation" : 555,
      "user_id" : 8842148,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://www.gravatar.com/avatar/c989f14abc638567f36a9a425d72c4b5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Arun Kumar",
      "link" : "https://stackoverflow.com/users/8842148/arun-kumar"
    },
    "creation_date" : 1751947913,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140571515,
    "post_id" : 79690198,
    "body" : "@KJ Thanks for the input, but I think the actual issue might’ve been misunderstood. I’ve shared my Java and JS code here: <a href=\"https://github.com/arunac97/HeadlessApp\" rel=\"nofollow noreferrer\">github.com/arunac97/HeadlessApp</a>. The goal is to inject JS on any site (e.g. <a href=\"https://arunac97.github.io/samplesite.com/newcanvas.html\" rel=\"nofollow noreferrer\">arunac97.github.io/samplesite.com/newcanvas.html</a>), draw a full-page canvas, and export to PDF. Case 1: Fixed page size causes canvas misalignment — case1.pdf Case 2: Full layout size adds huge white space — case2.pdf Would really appreciate any suggestions or workaround!",
    "score" : 0,
    "owner" : {
      "account_id" : 12101124,
      "reputation" : 555,
      "user_id" : 8842148,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://www.gravatar.com/avatar/c989f14abc638567f36a9a425d72c4b5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Arun Kumar",
      "link" : "https://stackoverflow.com/users/8842148/arun-kumar"
    },
    "creation_date" : 1751912658,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140567880,
    "post_id" : 79690198,
    "body" : "@KJ  the sample output here <a href=\"https://fileport.io/4T1E1NB97VpN\" rel=\"nofollow noreferrer\">fileport.io/4T1E1NB97VpN</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 12101124,
      "reputation" : 555,
      "user_id" : 8842148,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://www.gravatar.com/avatar/c989f14abc638567f36a9a425d72c4b5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Arun Kumar",
      "link" : "https://stackoverflow.com/users/8842148/arun-kumar"
    },
    "creation_date" : 1751783819,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140567862,
    "post_id" : 79690198,
    "body" : "@KJ  My main concern is this: I&#39;m passing an exact paperWidth and paperHeight to Page.printToPDF, based on the actual layout size from Page.getLayoutMetrics. I expect Chrome to render the content onto a PDF with those exact dimensions. But from the output, it feels like something else is happening during rendering—as if Chrome isn&#39;t respecting the dimensions I passed in.",
    "score" : 0,
    "owner" : {
      "account_id" : 12101124,
      "reputation" : 555,
      "user_id" : 8842148,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://www.gravatar.com/avatar/c989f14abc638567f36a9a425d72c4b5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Arun Kumar",
      "link" : "https://stackoverflow.com/users/8842148/arun-kumar"
    },
    "creation_date" : 1751782726,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140567857,
    "post_id" : 79690198,
    "body" : "@KJ  I’m not generating PDFs only for the mobile version—the same process will be applied for desktop and tablet versions too, using different device metrics.  I mentioned the &quot;30% extra space&quot; to highlight that the issue is not caused by pixel-to-inch rounding errors. The extra blank space is quite significant and seems unrelated to minor unit conversions.",
    "score" : 0,
    "owner" : {
      "account_id" : 12101124,
      "reputation" : 555,
      "user_id" : 8842148,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://www.gravatar.com/avatar/c989f14abc638567f36a9a425d72c4b5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Arun Kumar",
      "link" : "https://stackoverflow.com/users/8842148/arun-kumar"
    },
    "creation_date" : 1751782408,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140567854,
    "post_id" : 79690198,
    "body" : "@KJ   Thank you for your response and explanation about how PDFs handle media boundaries—much appreciated!  Just to clarify a few things from my side:  This sample site is just for testing purposes. In reality, the URL will vary depending on the use case, so the PDF rendering needs to work consistently across different pages.",
    "score" : 0,
    "owner" : {
      "account_id" : 12101124,
      "reputation" : 555,
      "user_id" : 8842148,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://www.gravatar.com/avatar/c989f14abc638567f36a9a425d72c4b5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Arun Kumar",
      "link" : "https://stackoverflow.com/users/8842148/arun-kumar"
    },
    "creation_date" : 1751782352,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}