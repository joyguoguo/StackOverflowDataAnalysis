{
  "question" : {
    "question_id" : 79821427,
    "title" : "BufferWriter still write in a file that doesn&#39;t exists anymore",
    "body" : "<p>I'm writing via BufferWriter to a file.\nIf I delete this file from the windows file system while the BufferWriter is still writing, the program doesn't report any error.\nWhere does the BufferWriter write if the file doesn't exists anymore?</p>\n<pre><code>BufferedWriter bwFileOUTFrag = Files.newBufferedWriter(_fOUTFrag.toPath(), _fIN_CharSet);\nbwFileOUTFrag.write(&quot;my first line&quot;);\nbwFileOUTFrag.flush(); // write buffer to file\n\nThread.sleep(5000L); //while I wait for this to end, I delete the file _fOUTFrag from windows file system\n\nbwFileOUTFrag.write(&quot;the file should not exist&quot;); \nbwFileOUTFrag.flush(); // I expect an error here because the file doesn't exist!!!\nbwFileOUTFrag.close();\n</code></pre>\n<p>Why Java don't report me an exception?\nAnd, if this is an expected behavior how can I catch this event?</p>\n",
    "tags" : [ "java", "bufferedwriter" ],
    "owner" : {
      "account_id" : 44663395,
      "reputation" : 51,
      "user_id" : 31870929,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/bf3c15f6c1855c02264482fa72dbc45a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "MaxSan",
      "link" : "https://stackoverflow.com/users/31870929/maxsan"
    },
    "is_answered" : true,
    "view_count" : 80,
    "answer_count" : 2,
    "score" : 2,
    "last_activity_date" : 1763314854,
    "creation_date" : 1763293103,
    "link" : "https://stackoverflow.com/questions/79821427/bufferwriter-still-write-in-a-file-that-doesnt-exists-anymore",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79821538,
    "question_id" : 79821427,
    "body" : "<p>On <em>most</em> OSes, 'files' are abstract and nameless concepts.</p>\n<p>A filepath (i.e. <code>/home/MaxSan/Desktop/myfile.txt</code>) isn't <em>a file</em>, it's more a <em>file pointer</em>.</p>\n<p>Your mobile phone is an object. It has a phone number. But your phone isn't the same as that phone number; the number is merely a way to <em>get to the phone</em>. A phone could have 2 phone numbers. If you pop the SIM card out, it has no phone numbers.</p>\n<p>Files are exactly the same way. For example, on linux:</p>\n<pre><code>echo &quot;Hello!&quot; &gt; test.txt\nln test.txt test2.txt\nls\n</code></pre>\n<p>You now have 2 'paths' (<code>test.txt</code> and <code>test2.txt</code>) but <em>there is only the one file on disk</em>. If you run <code>nano test.txt</code> and modify it, you'll notice that <code>test2.txt</code> is also modified. In java terms, we can show this off too:</p>\n<pre><code>List&lt;String&gt; a = new ArrayList&lt;String&gt;();\nList&lt;String&gt; b = a;\na.add(&quot;Hello&quot;);\nSystem.out.println(b.size()); // This prints 1!\nb = null;\na = null;\n</code></pre>\n<p>There's only ever <strong>1</strong> list in that snippet, but 2 variables pointing at it, and then at the end, <em>no</em> variables pointing at it. The list is no longer accessible and will get garbage collected at some point, but at the end of that code <em>there is still a list!</em> - it's just no longer possible to refer to it.</p>\n<p>So, what's java writing to? <strong>The file, of course</strong>. It's just that the file <strong>path</strong> on disk that used to point at the file no longer points at it / doesn't even exist anymore.</p>\n<p>On disks systems, a file path is one way to 'get to' a file, but an open handle is another. Java has an open handle. Hence the file continues to exist.</p>\n<p>The disk system is a lot like java's garbage collector, but it just counts references. Once the JVM process exits or closes its handle, the file system driver will mark the space occupied by that file as free immediately (at least, on most file systems).</p>\n<h2>The windows wonkiness</h2>\n<p>Windows is a weird operating system. It essentially works exactly as described above, but old timey file systems used many decades ago on windows worked differently and windows half-bakedly emulates old behaviour, I think even to this day. You cannot delete a filepath on windows normally if a process has a file handle open to the same file the path is pointing to. But, you can make those 'links' on windows too (with the <code>fsutil.exe</code> tool) and I <em>think</em> as long as at least one such filepointer points at it, windows <em>does</em> let you remove the file. Backup tools make such duplicate pointers all the time (because the operation is very fast and it allows snapshot backupping which is nice). Windows also <em>does</em> allow you to <em>rename</em> a file even when there are open handles, though.</p>\n<h2>To answer your question</h2>\n<p>You.. really don't. In the sense that &quot;I want my writing process to abort with an exception if the user of the system decides to mess with a filepath entry that so happens to point at the same file I'm writing to&quot; is just a weird thing to want. The user is deleting it, they know what they are doing, don't second guess them. If you are using it as a 'signal' (i.e. you write in your documentation something like: &quot;This process will start writing a log file. If you wish to stop the process from logging, simply delete the log file&quot; - then find another way for the user to communicate with your app, such as with a frontend of some sort).</p>\n<h2>If you must...</h2>\n<p>Call <code>Files.exists(p)</code> on your path. This is a crappy way to do it; you can't call that continuously; you call it from time to time, of course. In between 2 such calls I could rename the filepath, create a new filepath with the same name that is now a completely different file and not the one your java process is writing to, and then delete the renamed one, and your <code>Files.exists</code> detection scheme wouldn't trigger.</p>\n<p>In fact, in java it is essentially not possible to do what you want in a way that isn't circumventable. There's file watchers but you really don't want to do that, I don't think.</p>\n",
    "score" : 7,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 401843,
      "reputation" : 107186,
      "user_id" : 768644,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/b13bedc5215730fbce5edff6c130988a?s=256&d=identicon&r=PG",
      "display_name" : "rzwitserloot",
      "link" : "https://stackoverflow.com/users/768644/rzwitserloot"
    },
    "creation_date" : 1763305397,
    "last_activity_date" : 1763305397,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79821455,
    "question_id" : 79821427,
    "body" : "<p>I think this is what expected by your code.</p>\n<p>when you open a file in java using <strong>bufferwriter,</strong> the os gives default file handler. And deleting the file from directory does not close the handle.</p>\n<p>so, the file will be deleted once you close all the things in os.</p>\n<p>if you want to know file is deleted by another user you can check using exit keyword. like :</p>\n<pre class=\"lang-java prettyprint-override\"><code>\nif(!file.exits(path){\nSystem.out.println(&quot;file was delted&quot;);\n}\n</code></pre>\n<p>to watch deleting events create an object of watchservice  like :</p>\n<pre class=\"lang-java prettyprint-override\"><code>WatchSerice w=FileSystems.getDefault().newWatchService();\npath p=paths.get(&quot;provide path here&quot;);\np.register(w, StandardWatchEventKinds.Entry_DELETE);\n</code></pre>\n<p>this will work , check once</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 44318283,
      "reputation" : 132,
      "user_id" : 31691216,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/331d80b7ddd44ea266a2a0876e0b0074?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Siripireddy Giri",
      "link" : "https://stackoverflow.com/users/31691216/siripireddy-giri"
    },
    "creation_date" : 1763295631,
    "last_activity_date" : 1763295631,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140857843,
    "post_id" : 79821427,
    "body" : "My OS is an old win10pro NTFS formatted. Yes, the simplified code behaves as I have described. I can delete the file while the thread is sleeping from both Explorer and command line. I see the new file appears on Explorer and while the program sleep I can select it and delete it. When the sleep end the bufferedwriter can write, flush and close without error.",
    "score" : 0,
    "owner" : {
      "account_id" : 44663395,
      "reputation" : 51,
      "user_id" : 31870929,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/bf3c15f6c1855c02264482fa72dbc45a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "MaxSan",
      "link" : "https://stackoverflow.com/users/31870929/maxsan"
    },
    "creation_date" : 1763372745,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140857262,
    "post_id" : 79821427,
    "body" : "I can reproduce the problem - file is deleted while in <code>sleep()</code> of posted code (Windows 11, jshell/JDK 26, CMD) (@Rob)",
    "score" : 1,
    "owner" : {
      "account_id" : 31180,
      "reputation" : 29752,
      "user_id" : 85421,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/kKvXH.gif?s=256",
      "display_name" : "user85421",
      "link" : "https://stackoverflow.com/users/85421/user85421"
    },
    "creation_date" : 1763334798,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140856932,
    "post_id" : 79821427,
    "body" : "Which operating system are you using? You write &quot;windows file system&quot; - but that could be NTFS on linux...",
    "score" : 1,
    "owner" : {
      "account_id" : 1888781,
      "reputation" : 2498,
      "user_id" : 1707427,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/4d1a2608ee35e2df7d2400a02e62bb20?s=256&d=identicon&r=PG",
      "display_name" : "S&#246;ren",
      "link" : "https://stackoverflow.com/users/1707427/s%c3%b6ren"
    },
    "creation_date" : 1763310589,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140856929,
    "post_id" : 79821427,
    "body" : "Have you checked hat your simplification behaves as you describe in your question?",
    "score" : 1,
    "owner" : {
      "account_id" : 1888781,
      "reputation" : 2498,
      "user_id" : 1707427,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/4d1a2608ee35e2df7d2400a02e62bb20?s=256&d=identicon&r=PG",
      "display_name" : "S&#246;ren",
      "link" : "https://stackoverflow.com/users/1707427/s%c3%b6ren"
    },
    "creation_date" : 1763310544,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140856857,
    "post_id" : 79821427,
    "body" : "@MaxSan check again.  You are likely building the file path differently in Java and by hand. Print it out. Becase unless you are playing with hardlinks, Windows would not allow open file deletion.",
    "score" : 0,
    "owner" : {
      "account_id" : 43022,
      "reputation" : 24626,
      "user_id" : 125562,
      "user_type" : "registered",
      "accept_rate" : 64,
      "profile_image" : "https://i.sstatic.net/SdIqA.png?s=256",
      "display_name" : "Basilevs",
      "link" : "https://stackoverflow.com/users/125562/basilevs"
    },
    "creation_date" : 1763307469,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140856675,
    "post_id" : 79821427,
    "body" : "yes sure! The code snippet I sent is a simplification of the actual code. In reality, the bufferedWriter writes from a thread managed by an ExecutorCompletionService, but that shouldn&#39;t change much. The fact remains that I can delete the file the BufferedWriter is writing to without it telling me anything. I also have a try/catch to catch any exceptions, but it all runs without problems.",
    "score" : 0,
    "owner" : {
      "account_id" : 44663395,
      "reputation" : 51,
      "user_id" : 31870929,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/bf3c15f6c1855c02264482fa72dbc45a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "MaxSan",
      "link" : "https://stackoverflow.com/users/31870929/maxsan"
    },
    "creation_date" : 1763295828,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140856634,
    "post_id" : 79821427,
    "body" : "If I try your scenario, Windows is not letting me delete the file as I expected. I tried using Explorer and command line, and both fail. Are you sure you&#39;re deleting the correct file?",
    "score" : 4,
    "owner" : {
      "account_id" : 1211967,
      "reputation" : 9964,
      "user_id" : 1180351,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/pKB8y.png?s=256",
      "display_name" : "Rob Spoor",
      "link" : "https://stackoverflow.com/users/1180351/rob-spoor"
    },
    "creation_date" : 1763293684,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79821538" : [ {
      "comment_id" : 140857839,
      "post_id" : 79821538,
      "body" : "I also tried BufferedReader and, as you said, I can read the entire file even if I delete it from the command line while the programme is running.",
      "score" : 0,
      "owner" : {
        "account_id" : 44663395,
        "reputation" : 51,
        "user_id" : 31870929,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/bf3c15f6c1855c02264482fa72dbc45a?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "MaxSan",
        "link" : "https://stackoverflow.com/users/31870929/maxsan"
      },
      "creation_date" : 1763372555,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140857799,
      "post_id" : 79821538,
      "body" : "Of course, that&#39;s clear. I wonder if users know exactly what they&#39;re doing :)  I&#39;m trying to handle every possible exception in the best way possible, perhaps excessively so, which is why I brought up this issue I encountered.  In practice, it will be rare, but I still wanted to understand how Java and/or operating systems work.  A new thing learned, great!",
      "score" : 0,
      "owner" : {
        "account_id" : 44663395,
        "reputation" : 51,
        "user_id" : 31870929,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/bf3c15f6c1855c02264482fa72dbc45a?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "MaxSan",
        "link" : "https://stackoverflow.com/users/31870929/maxsan"
      },
      "creation_date" : 1763371632,
      "content_license" : "CC BY-SA 4.0"
    } ],
    "79821455" : [ {
      "comment_id" : 140856853,
      "post_id" : 79821455,
      "body" : "@MaxSan I also did not know. Because it is not true for Windows.",
      "score" : 0,
      "owner" : {
        "account_id" : 43022,
        "reputation" : 24626,
        "user_id" : 125562,
        "user_type" : "registered",
        "accept_rate" : 64,
        "profile_image" : "https://i.sstatic.net/SdIqA.png?s=256",
        "display_name" : "Basilevs",
        "link" : "https://stackoverflow.com/users/125562/basilevs"
      },
      "creation_date" : 1763307248,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140856702,
      "post_id" : 79821455,
      "body" : "@MaxSan Sounds good ! glad it help you.",
      "score" : 0,
      "owner" : {
        "account_id" : 44318283,
        "reputation" : 132,
        "user_id" : 31691216,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/331d80b7ddd44ea266a2a0876e0b0074?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Siripireddy Giri",
        "link" : "https://stackoverflow.com/users/31691216/siripireddy-giri"
      },
      "creation_date" : 1763297497,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140856696,
      "post_id" : 79821455,
      "body" : "OK I didn&#39;t know about the OS handler&#39;s behavior.   I&#39;d rather handle an exception than constantly check whether the file exists but that&#39;s fine for now. I&#39;ll use your first code snippet to check whether the file still exists before flush().  Then when I go into production, I&#39;ll see what the time impact will be.  Thanks",
      "score" : 0,
      "owner" : {
        "account_id" : 44663395,
        "reputation" : 51,
        "user_id" : 31870929,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/bf3c15f6c1855c02264482fa72dbc45a?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "MaxSan",
        "link" : "https://stackoverflow.com/users/31870929/maxsan"
      },
      "creation_date" : 1763297163,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}