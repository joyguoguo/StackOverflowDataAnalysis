{
  "question" : {
    "question_id" : 79757527,
    "title" : "How to play a live stream of raw Opus packets (2‑byte BE length‑prefixed) in the browser (HTML/JS)?",
    "body" : "<p>I’m capturing Opus frames live from a Discord Lavalink fork before encryption and dumping them to disk (and/or streaming them over WebSocket). Each packet is written as:</p>\n<pre class=\"lang-java prettyprint-override\"><code>2‑byte big-endian length (N)\nN bytes of Opus payload (48 kHz, ~20 ms per frame, Discord voice compatible)\n</code></pre>\n<p>Example write logic (Kotlin, trimmed to the relevant part):</p>\n<pre class=\"lang-java prettyprint-override\"><code>override fun retrieveOpusFrame(buf: ByteBuf) {\n    // Duplicate the buffer to copy bytes for dumping\n    val ro = buffer.duplicate()\n    ro.flip()\n    val len = ro.remaining()\n    val bytes = ByteArray(len)\n    ro.get(bytes)\n\n    // Send frame to Discord\n    buf.writeBytes(buffer.flip())\n\n    // Dump frame to file: [2-byte big-endian length][Opus payload]\n    out.write((len ushr 8) and 0xFF)\n    out.write(len and 0xFF)\n    out.write(bytes)\n}\n</code></pre>\n<p>The resulting <code>.opusdump</code> file is just a sequence of raw Opus packets (no Ogg/WebM container).</p>\n<p>Example <code>.opusdump</code> (first 64 bytes, using: <code>Get-Content -Path .\\file.opusdump -Encoding Byte -TotalCount 64 | Format-Hex</code>):</p>\n<pre><code>00000000   00 03 FC FF FE 00 03 FC FF FE 00 03 FC FF FE 00\n00000010   03 FC FF FE 00 03 FC FF FE 00 03 FC FF FE 00 03\n00000020   FC FF FE 00 03 FC FF FE 00 03 FC FF FE 00 03 FC\n00000030   FF FE 00 03 FC FF FE 00 03 FC FF FE 00 03 FC FF\n</code></pre>\n<p>I want to play this audio in real time in a plain HTML/JS front-end (Chrome/Firefox), ideally by streaming packets to the browser as they’re produced. Ideally, the browser would handle playback directly from raw Opus frames or small WebM segments; I want to avoid server-side conversion or transcoding.</p>\n<p>What I’ve tried</p>\n<ul>\n<li><p>Capturing frames to a <code>.opusdump</code> file as shown above.</p>\n</li>\n<li><p>Reading browser documentation on Media Source Extensions (MSE) and Web Audio.</p>\n</li>\n<li><p>I haven’t yet tried containerizing or decoding in JS/WASM because I’m unsure where to start.</p>\n</li>\n</ul>\n<p>Main question:</p>\n<ul>\n<li>What is the recommended approach to play live raw Opus packets from Discord in a browser in real time? Can they be fed directly to Web Audio/WebCodecs, or do they need to be wrapped in a container like WebM?</li>\n</ul>\n<p>Follow-ups:</p>\n<ul>\n<li><p>If a container is needed, are there any Java/Kotlin/Node libraries to wrap raw Opus frames into WebM segments suitable for MSE (SourceBuffer with type 'audio/webm; codecs=opus')?</p>\n</li>\n<li><p>If decoding client-side, what is the best approach to handle timing, buffering, and playback (e.g., using WASM libopus or similar)?</p>\n</li>\n<li><p>Can FFmpeg process these length-prefixed raw Opus frames directly, or is a small demuxer needed first?</p>\n</li>\n<li><p>Are there any Discord-specific Opus considerations (channels, preskip, granule positions) when remuxing or decoding outside of Discord?</p>\n</li>\n</ul>\n<p>Constraints</p>\n<ul>\n<li>Front-end: plain HTML/JS (no native app).</li>\n<li>Server: JVM (Kotlin), but I’m open to a small Node sidecar if it simplifies MSE/WebM segmenting.</li>\n</ul>\n",
    "tags" : [ "java", "kotlin", "web-audio-api", "opus" ],
    "owner" : {
      "account_id" : 30166697,
      "reputation" : 7,
      "user_id" : 23118203,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c046254fac55a9c58a84ed9998b9ceb3?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "SilentRockey738",
      "link" : "https://stackoverflow.com/users/23118203/silentrockey738"
    },
    "is_answered" : false,
    "view_count" : 105,
    "answer_count" : 0,
    "score" : -1,
    "last_activity_date" : 1765281201,
    "creation_date" : 1757160257,
    "link" : "https://stackoverflow.com/questions/79757527/how-to-play-a-live-stream-of-raw-opus-packets-2-byte-be-length-prefixed-in-the",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}