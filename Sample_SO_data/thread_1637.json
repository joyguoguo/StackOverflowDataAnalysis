{
  "question" : {
    "question_id" : 79689016,
    "title" : "Database field error when launching SpringBoot integration tests with maven command (using PostgreSQLContainer)",
    "body" : "<p>I have this situation with my Spring Boot application and the management of tests:</p>\n<p>The application is running correctly. But for its unit tests, regular tests are OK, while integration tests are giving me some issues.</p>\n<p>In order to be able to operate with a database for the tests, I do the following in a base class from which all integration tests inherit:</p>\n<pre><code>public abstract class IntegrationTestBase {\n\n  protected static PostgreSQLContainer&lt;?&gt; postgres = null;\n\n  private static boolean databaseStarted = false;\n\n  @BeforeAll\n  public static void beforeAll() {\n    if (!databaseStarted) {\n      postgres = new PostgreSQLContainer&lt;&gt;(&quot;postgres:16-alpine&quot;)\n        .withReuse(true);\n\n      postgres.start();\n      databaseStarted = true;\n\n      Runtime.getRuntime().addShutdownHook(new Thread(() -&gt; {\n        // Ideally this should stop the DB only after executing all classes\n        postgres.stop();\n      }));\n    }\n  }\n}\n</code></pre>\n<p>I can launch a test individually through a command like this:</p>\n<pre><code>mvn test -Dtest=&quot;UserServiceIT&quot;\n</code></pre>\n<p>But when I try to launch all of them:</p>\n<pre><code>mvn failsafe:integration-test\n</code></pre>\n<p>I get the following error:</p>\n<pre><code>org.springframework.beans.factory.BeanCreationException:\nError creating bean with name 'entityManagerFactory' defined in class path resource\n[org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]:\nInvocation of init method failed; nested exception is javax.persistence.PersistenceException:\n[PersistenceUnit: default] Unable to build Hibernate SessionFactory;\nnested exception is org.hibernate.tool.schema.spi.SchemaManagementException:\nSchema-validation: wrong column type encountered in column [item_id] in table [Item];\nfound [int8 (Types#BIGINT)], but expecting [int4 (Types#INTEGER)]\n</code></pre>\n<p>The class &quot;Item&quot; comes from an external jar and therefore I am unable to change its type, but I can tell you it is defined as a long.</p>\n<p>I have been trying to make workarounds such as trying to redefine the entityManagerFactory but that only makes things more complicated. After all the tests are working when executing individually.</p>\n<p>Do you know what could be causing this? Am I launching the tests the right way?</p>\n",
    "tags" : [ "java", "postgresql", "spring-boot", "junit", "containers" ],
    "owner" : {
      "account_id" : 11690304,
      "reputation" : 21,
      "user_id" : 8558811,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2e59d89ca717cacd6b96db41c7d8c17e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "coriuser",
      "link" : "https://stackoverflow.com/users/8558811/coriuser"
    },
    "is_answered" : false,
    "view_count" : 55,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1751879377,
    "creation_date" : 1751553139,
    "link" : "https://stackoverflow.com/questions/79689016/database-field-error-when-launching-springboot-integration-tests-with-maven-comm",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79692578,
    "question_id" : 79689016,
    "body" : "<p>What ended up happening was that the database field types were not set in the Java classes according to the database types. As it was part of a dependency I had no clue what was going on. So if you have come across this kind of issue, know that there is some error in field type correspondence.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 11690304,
      "reputation" : 21,
      "user_id" : 8558811,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2e59d89ca717cacd6b96db41c7d8c17e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "coriuser",
      "link" : "https://stackoverflow.com/users/8558811/coriuser"
    },
    "creation_date" : 1751879377,
    "last_activity_date" : 1751879377,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140564088,
    "post_id" : 79689016,
    "body" : "I also tried removing the <code>withReuse</code> statement, but the result is the same. The issue happens from the first test.",
    "score" : 0,
    "owner" : {
      "account_id" : 11690304,
      "reputation" : 21,
      "user_id" : 8558811,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2e59d89ca717cacd6b96db41c7d8c17e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "coriuser",
      "link" : "https://stackoverflow.com/users/8558811/coriuser"
    },
    "creation_date" : 1751612137,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140564087,
    "post_id" : 79689016,
    "body" : "I have the SpringBootTest annotation in this abstract class.",
    "score" : 0,
    "owner" : {
      "account_id" : 11690304,
      "reputation" : 21,
      "user_id" : 8558811,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2e59d89ca717cacd6b96db41c7d8c17e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "coriuser",
      "link" : "https://stackoverflow.com/users/8558811/coriuser"
    },
    "creation_date" : 1751612076,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140563458,
    "post_id" : 79689016,
    "body" : "<code>withReuse</code> will keep your container running after test is finished, can it be the case where a previous run was with an int type instead of long?",
    "score" : 0,
    "owner" : {
      "account_id" : 1601399,
      "reputation" : 638,
      "user_id" : 1482356,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d6160b6e40d230fa92c6da8072b2f7e5?s=256&d=identicon&r=PG",
      "display_name" : "Peter Adrian",
      "link" : "https://stackoverflow.com/users/1482356/peter-adrian"
    },
    "creation_date" : 1751578773,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140562415,
    "post_id" : 79689016,
    "body" : "Is your test class annotated with <code>@SpringBootTest</code> or <code>@DataJpaTest</code>? Example for the latter (replace MySQLContainer with PostgreSQL): <a href=\"https://github.com/roar-skinderviken/spring-jpa-auditing-demo/blob/a196358100e4f6affbc33efa8c8ff889b233f015/src/test/java/no/mycompany/auditing/SpotifyPlayListRepositoryTests.java\" rel=\"nofollow noreferrer\">github.com/roar-skinderviken/spring-jpa-auditing-demo/blob/&hellip;</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 19255478,
      "reputation" : 11534,
      "user_id" : 14072498,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/a55d298fc2cb250243c15bd619f95613?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Roar S.",
      "link" : "https://stackoverflow.com/users/14072498/roar-s"
    },
    "creation_date" : 1751554577,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}