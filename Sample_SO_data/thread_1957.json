{
  "question" : {
    "question_id" : 79660365,
    "title" : "How to return custom exception in Spring Web Flux functional endpoint",
    "body" : "<p>I am new to <code>Spring Web Flux</code> environment. As I was practicing, I stuck to return custom exception (say if user not found)</p>\n<p>I want to handle custom exception in <code>RestControllerAdvice</code> as global exception.</p>\n<p>But flow is not going towards that exception. Below is the code I tried..</p>\n<pre><code>public Mono&lt;ServerResponse&gt; getStudentByName(ServerRequest req) {\n    System.out.println(&quot;here here here&quot;);\n    Flux&lt;Student&gt; repoFlux = repo.findByFirstName(req.pathVariable(&quot;name&quot;));\n    Flux&lt;Object&gt; handle = repoFlux.handle((stu,sink)-&gt;{\n        if(stu==null) {\n            System.out.println(&quot;USER NOT FOUND!!!&quot;);\n            System.out.println(&quot;NOT OK &gt;&quot;+stu);\n            sink.error(new UserNotFoundException(&quot;USER NOT FOUND&quot;));\n        }\n        else {\n            System.out.println(&quot;OK OK OK OK&quot;);\n            System.out.println(&quot;OK &gt; &quot;+stu);\n            sink.next(stu);\n        }\n    });\n    \n    return ServerResponse.ok().body(handle,Flux.class);\n}\n</code></pre>\n<p>I was following <a href=\"https://stackoverflow.com/a/53596358/3422726\">this</a> helpful ways to handle exception in <code>spring web flux</code></p>\n<p>In its first way, it is being done through <code>handle</code> function.</p>\n<p>I wrote log statements to check the flow, but the flow never enters on line <code>System.out.println(&quot;USER NOT FOUND!!!&quot;);</code></p>\n<p>why <code>sink.error</code> is not getting fired.</p>\n<p>How can I redirect the flow to exception to check if it is working fine. Is there any other way to handle such things.</p>\n",
    "tags" : [ "java", "spring-boot", "spring-webflux", "spring-boot-reactive" ],
    "owner" : {
      "account_id" : 4176295,
      "reputation" : 1273,
      "user_id" : 3422726,
      "user_type" : "registered",
      "accept_rate" : 55,
      "profile_image" : "https://i.sstatic.net/L35fT.jpg?s=256",
      "display_name" : "JPG",
      "link" : "https://stackoverflow.com/users/3422726/jpg"
    },
    "is_answered" : false,
    "view_count" : 65,
    "answer_count" : 3,
    "score" : 0,
    "last_activity_date" : 1749666405,
    "creation_date" : 1749555756,
    "link" : "https://stackoverflow.com/questions/79660365/how-to-return-custom-exception-in-spring-web-flux-functional-endpoint",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79661608,
    "question_id" : 79660365,
    "body" : "<p>I somehow resolved the above issue using <code>hasElements</code> method.</p>\n<pre><code>    public Mono&lt;ServerResponse&gt; getStudentByName2(ServerRequest req) {\n        System.out.println(&quot;logic entered here in getStudentByName2&quot;);\n        Flux&lt;Student&gt; repoFlux = repo.findByFirstName(req.pathVariable(&quot;name&quot;));\n\n        return repoFlux.hasElements().flatMap(b-&gt;{\n            if(b==false)\n        return Mono.error(new UserNotFoundException(&quot;no student found&quot;));\n            else\n                return ServerResponse.ok().body(repoFlux,Student.class);\n        });\n    }\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 4176295,
      "reputation" : 1273,
      "user_id" : 3422726,
      "user_type" : "registered",
      "accept_rate" : 55,
      "profile_image" : "https://i.sstatic.net/L35fT.jpg?s=256",
      "display_name" : "JPG",
      "link" : "https://stackoverflow.com/users/3422726/jpg"
    },
    "creation_date" : 1749628422,
    "last_activity_date" : 1749628422,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79662355,
    "question_id" : 79660365,
    "body" : "<p>Your usage does not look correct. You explicitly return OK.<br />\nTry this way!</p>\n<pre><code>repoFlux.handle((stu,sink)-&gt;{\n        if(stu==null) {\n            System.out.println(&quot;USER NOT FOUND!!!&quot;);\n            System.out.println(&quot;NOT OK &gt;&quot;+stu);\n            sink.error(new UserNotFoundException(&quot;USER NOT FOUND&quot;));\n        }\n        else {\n            System.out.println(&quot;OK OK OK OK&quot;);\n            System.out.println(&quot;OK &gt; &quot;+stu);\n            sink.next(stu);\n        }\n    })\n    .collectList()\n    .flatMap(ServerResponse.ok()::bodyValue)\n    .onErrorResume(ex -&gt; ServerResponse.notFound().build());\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 15328195,
      "reputation" : 3610,
      "user_id" : 11058704,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-ztEBhSShv88/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPLzwJV-FCsThe1at4N__EBPxj_gg/mo/s256-rj/photo.jpg",
      "display_name" : "RamPrakash",
      "link" : "https://stackoverflow.com/users/11058704/ramprakash"
    },
    "creation_date" : 1749659263,
    "last_activity_date" : 1749659263,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79662470,
    "question_id" : 79660365,
    "body" : "<p>Assuming you want to throw an exception at the first null value encountered</p>\n<pre class=\"lang-java prettyprint-override\"><code>Flux&lt;Object&gt; value =repo.findByFirstName(req.pathVariable(&quot;name&quot;))\n.filter(e-&gt; e!=null).map(e-&gt;{\n            System.out.println(&quot;hi&quot;);\n            return e;\n        }).switchIfEmpty(Flux.error(new MyException(&quot;this is my exception&quot;)));\n</code></pre>\n",
    "score" : -1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 15069196,
      "reputation" : 784,
      "user_id" : 10875311,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/TLHjd.jpg?s=256",
      "display_name" : "Akash Jain",
      "link" : "https://stackoverflow.com/users/10875311/akash-jain"
    },
    "creation_date" : 1749666405,
    "last_activity_date" : 1749666405,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79661608" : [ {
      "comment_id" : 140506246,
      "post_id" : 79661608,
      "body" : "your usage looks like your repoflux will be subscribed 2 times. that is , it will make 2 db calls.",
      "score" : 0,
      "owner" : {
        "account_id" : 15328195,
        "reputation" : 3610,
        "user_id" : 11058704,
        "user_type" : "registered",
        "profile_image" : "https://lh4.googleusercontent.com/-ztEBhSShv88/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPLzwJV-FCsThe1at4N__EBPxj_gg/mo/s256-rj/photo.jpg",
        "display_name" : "RamPrakash",
        "link" : "https://stackoverflow.com/users/11058704/ramprakash"
      },
      "creation_date" : 1749659800,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140506069,
      "post_id" : 79661608,
      "body" : "instead use the error operators, what you are looking for is called <code>onErrorResume</code> so for instance: <code>Mono.just(&quot;some input&quot;).flatMap(this::someDangerousCall).onErrorResume(e -&gt; Mono.error(new MyCustomException(&quot;Custom failure&quot;)))</code>",
      "score" : 0,
      "owner" : {
        "account_id" : 2064278,
        "reputation" : 15073,
        "user_id" : 1840146,
        "user_type" : "registered",
        "accept_rate" : 86,
        "profile_image" : "https://i.sstatic.net/JXdxm.png?s=256",
        "display_name" : "Toerktumlare",
        "link" : "https://stackoverflow.com/users/1840146/toerktumlare"
      },
      "creation_date" : 1749656844,
      "content_license" : "CC BY-SA 4.0"
    } ],
    "79662470" : [ {
      "comment_id" : 140513137,
      "post_id" : 79662470,
      "body" : "Flux cant contain null values, so the filter does essentially nothing",
      "score" : 0,
      "owner" : {
        "account_id" : 2064278,
        "reputation" : 15073,
        "user_id" : 1840146,
        "user_type" : "registered",
        "accept_rate" : 86,
        "profile_image" : "https://i.sstatic.net/JXdxm.png?s=256",
        "display_name" : "Toerktumlare",
        "link" : "https://stackoverflow.com/users/1840146/toerktumlare"
      },
      "creation_date" : 1749890457,
      "content_license" : "CC BY-SA 4.0"
    } ],
    "79662355" : [ {
      "comment_id" : 140513139,
      "post_id" : 79662355,
      "body" : "Mono and Fluxes cant contain null values.",
      "score" : 0,
      "owner" : {
        "account_id" : 2064278,
        "reputation" : 15073,
        "user_id" : 1840146,
        "user_type" : "registered",
        "accept_rate" : 86,
        "profile_image" : "https://i.sstatic.net/JXdxm.png?s=256",
        "display_name" : "Toerktumlare",
        "link" : "https://stackoverflow.com/users/1840146/toerktumlare"
      },
      "creation_date" : 1749890507,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}