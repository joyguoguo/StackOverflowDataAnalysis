{
  "question" : {
    "question_id" : 79598254,
    "title" : "Spring Boot Application Fails with &quot;Missing preceding open capture character&quot; in Path Pattern Despite Correct Mappings",
    "body" : "<p>I'm encountering a Spring Boot startup failure during Maven build tests in my recommendation microservice. The error indicates an invalid mapping pattern /recommendation}, but I've verified all my endpoint mappings and found no typos with extra braces.</p>\n<p><strong>Error Message:</strong></p>\n<pre><code>org.springframework.web.util.pattern.PatternParseException: \nMissing preceding open capture character before variable name{\n...\nInvalid mapping pattern detected: /recommendation}\n               ^\n</code></pre>\n<p>RecommendationService interface:</p>\n<pre><code>public interface RecommendationService {\n    @PostMapping(\n            value = &quot;/recommendation&quot;,\n            consumes = &quot;application/json&quot;,\n            produces = &quot;application/json&quot;)\n    Recommendation createRecommendation(@RequestBody Recommendation body);\n\n    @GetMapping(\n            value = &quot;/recommendation&quot;,\n            produces = &quot;application/json&quot;)\n    List&lt;Recommendation&gt; getRecommendations(@RequestParam(value = &quot;productId&quot;) int productId);\n\n    @DeleteMapping(value = &quot;/recommendation&quot;)\n    void deleteRecommendation(@RequestParam(value = &quot;productId&quot;)  int productId);\n}\n</code></pre>\n<p>RecommendationServiceImpl class:</p>\n<pre><code>@RestController\npublic class RecommendationServiceImpl implements RecommendationService {\n    private final ServiceUtil serviceUtil;\n    private final RecommendationRepository repository;\n    private final RecommendationMapper mapper;\n\n    public RecommendationServiceImpl(ServiceUtil serviceUtil, RecommendationRepository repository, @Qualifier(&quot;recommendationMapperImpl&quot;) RecommendationMapper mapper) {\n        this.serviceUtil = serviceUtil;\n        this.repository = repository;\n        this.mapper = mapper;\n    }\n\n    @Override\n    public Recommendation createRecommendation(Recommendation body) {\n        try {\n            RecommendationEntity entity = mapper.apiToEntity(body);\n            RecommendationEntity newEntity = repository.save(entity);\n\n            return mapper.entityToApi(newEntity);\n        } catch (DuplicateKeyException e) {\n            throw new InvalidInputException(&quot;Duplicate key, Product Id: &quot; + body.getProductId() + &quot;, Recommendation Id:&quot; + body.getRecommendationId());\n        }\n    }\n\n    @Override\n    public List&lt;Recommendation&gt; getRecommendations(int productId) {\n        if (productId &lt; 1) {\n            throw new InvalidInputException(&quot;Invalid productId: &quot; + productId);\n        }\n\n        List&lt;RecommendationEntity&gt; entityList = repository.findByProductId(productId);\n        List&lt;Recommendation&gt; list = mapper.entityListToApiList(entityList);\n        list.forEach(e -&gt; e.setServiceAddress(serviceUtil.getServiceAddress()));\n\n        return list;\n    }\n\n    @Override\n    public void deleteRecommendation(int productId) {\n        repository.deleteAll(repository.findByProductId(productId));\n    }\n}\n</code></pre>\n<p>RecommendationServiceImpl implementation:</p>\n<pre><code>@RestController\npublic interface RecommendationRepository extends CrudRepository&lt;RecommendationEntity, String&gt; {\n    List&lt;RecommendationEntity&gt; findByProductId(int productId);\n}\n</code></pre>\n<p><strong>What I've Tried:</strong></p>\n<ol>\n<li><p>Searched all files for /recommendation} using both IDE and grep -ri &quot;/recommendation}&quot; .\nOnly found one match:\n./target/surefire-reports/TEST-com.example.recommendation_service.RecommendationServiceApplicationTests.xml:/recommendation}</p>\n</li>\n<li><p>Cleaned and rebuilt the project (./mvnw clean install)</p>\n</li>\n<li><p>Verified all endpoint mappings exactly match /recommendation (no typos)</p>\n</li>\n<li><p>Confirmed the application runs successfully when started directly (only fails during tests)</p>\n</li>\n<li><p>Experimentally changed endpoint paths to /recommendation1, /recommendation2, etc. in both controller and tests</p>\n</li>\n<li><p>Error message still shows /recommendation} (without the numbers)</p>\n</li>\n</ol>\n<p><strong>Key Observations</strong></p>\n<ol>\n<li><p>The error only appears when running tests</p>\n</li>\n<li><p>Deleting the test file makes the error disappear</p>\n</li>\n<li><p>The error appears in the test report XML, not in source code</p>\n</li>\n</ol>\n<p><strong>Test File:</strong></p>\n<pre><code>@SpringBootTest(webEnvironment = RANDOM_PORT)\nclass RecommendationServiceApplicationTests extends MongoDbTestBase {\n\n    @Autowired\n    private WebTestClient client;\n\n    @Autowired\n    private RecommendationRepository repository;\n\n    @BeforeEach\n    void setupDb() {\n        repository.deleteAll();\n    }\n\n    @Test\n    void getRecommendationsByProductId() {\n\n        int productId = 1;\n\n        postAndVerifyRecommendation(productId, 1, OK);\n        postAndVerifyRecommendation(productId, 2, OK);\n        postAndVerifyRecommendation(productId, 3, OK);\n\n        assertEquals(3, repository.findByProductId(productId).size());\n\n        getAndVerifyRecommendationsByProductId(productId, OK)\n                .jsonPath(&quot;$.length()&quot;).isEqualTo(3)\n                .jsonPath(&quot;$[2].productId&quot;).isEqualTo(productId)\n                .jsonPath(&quot;$[2].recommendationId&quot;).isEqualTo(3);\n    }\n\n    @Test\n    void duplicateError() {\n\n        int productId = 1;\n        int recommendationId = 1;\n\n        postAndVerifyRecommendation(productId, recommendationId, OK)\n                .jsonPath(&quot;$.productId&quot;).isEqualTo(productId)\n                .jsonPath(&quot;$.recommendationId&quot;).isEqualTo(recommendationId);\n\n        assertEquals(1, repository.count());\n\n        postAndVerifyRecommendation(productId, recommendationId, UNPROCESSABLE_ENTITY)\n                .jsonPath(&quot;$.message&quot;).isEqualTo(&quot;Duplicate key, Product Id: 1, Recommendation Id:1&quot;);\n\n        assertEquals(1, repository.count());\n    }\n\n    @Test\n    void deleteRecommendations() {\n\n        int productId = 1;\n        int recommendationId = 1;\n\n        postAndVerifyRecommendation(productId, recommendationId, OK);\n        assertEquals(1, repository.findByProductId(productId).size());\n\n        deleteAndVerifyRecommendationsByProductId(productId, OK);\n        assertEquals(0, repository.findByProductId(productId).size());\n\n        deleteAndVerifyRecommendationsByProductId(productId, OK);\n    }\n\n    @Test\n    void getRecommendationsMissingParameter() {\n\n        getAndVerifyRecommendationsByProductId(&quot;&quot;, BAD_REQUEST)\n                .jsonPath(&quot;$.path&quot;).isEqualTo(&quot;/recommendation&quot;);\n    }\n\n    @Test\n    void getRecommendationsInvalidParameter() {\n\n        getAndVerifyRecommendationsByProductId(&quot;?productId=no-integer&quot;, BAD_REQUEST)\n                .jsonPath(&quot;$.path&quot;).isEqualTo(&quot;/recommendation&quot;);\n    }\n\n    @Test\n    void getRecommendationsNotFound() {\n\n        getAndVerifyRecommendationsByProductId(&quot;?productId=113&quot;, OK)\n                .jsonPath(&quot;$.length()&quot;).isEqualTo(0);\n    }\n\n    @Test\n    void getRecommendationsInvalidParameterNegativeValue() {\n\n        int productIdInvalid = -1;\n\n        getAndVerifyRecommendationsByProductId(&quot;?productId=&quot; + productIdInvalid, UNPROCESSABLE_ENTITY)\n                .jsonPath(&quot;$.message&quot;).isEqualTo(&quot;Invalid productId: &quot; + productIdInvalid);\n    }\n\n    private WebTestClient.BodyContentSpec getAndVerifyRecommendationsByProductId(int productId, HttpStatus expectedStatus) {\n        return getAndVerifyRecommendationsByProductId(&quot;?productId=&quot; + productId, expectedStatus);\n    }\n\n    private WebTestClient.BodyContentSpec getAndVerifyRecommendationsByProductId(String productIdQuery, HttpStatus expectedStatus) {\n        return client.get()\n                .uri(&quot;/recommendation&quot; + productIdQuery)\n                .accept(APPLICATION_JSON)\n                .exchange()\n                .expectStatus().isEqualTo(expectedStatus)\n                .expectHeader().contentType(APPLICATION_JSON)\n                .expectBody();\n    }\n\n    private WebTestClient.BodyContentSpec postAndVerifyRecommendation(int productId, int recommendationId, HttpStatus expectedStatus) {\n        Recommendation recommendation = new Recommendation(productId, recommendationId, &quot;Author &quot; + recommendationId, recommendationId, &quot;Content &quot; + recommendationId, &quot;SA&quot;);\n        return client.post()\n                .uri(&quot;/recommendation&quot;)\n                .body(just(recommendation), Recommendation.class)\n                .accept(APPLICATION_JSON)\n                .exchange()\n                .expectStatus().isEqualTo(expectedStatus)\n                .expectHeader().contentType(APPLICATION_JSON)\n                .expectBody();\n    }\n\n    private WebTestClient.BodyContentSpec deleteAndVerifyRecommendationsByProductId(int productId, HttpStatus expectedStatus) {\n        return client.delete()\n                .uri(&quot;/recommendation?productId=&quot; + productId)\n                .accept(APPLICATION_JSON)\n                .exchange()\n                .expectStatus().isEqualTo(expectedStatus)\n                .expectBody();\n    }\n}\n</code></pre>\n<p><strong>Question:</strong>\nHow can there be a pattern parsing error for /recommendation} when my code clearly uses /recommendation without braces? Where should I look for this phantom pattern?</p>\n",
    "tags" : [ "java", "spring", "spring-boot", "syntax-error" ],
    "owner" : {
      "account_id" : 39301295,
      "reputation" : 21,
      "user_id" : 29207084,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5d95f8a91ddc86a2e09159e35122c59d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Rahman Karimli",
      "link" : "https://stackoverflow.com/users/29207084/rahman-karimli"
    },
    "is_answered" : false,
    "view_count" : 191,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1745942346,
    "creation_date" : 1745926104,
    "link" : "https://stackoverflow.com/questions/79598254/spring-boot-application-fails-with-missing-preceding-open-capture-character-in",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140380651,
    "post_id" : 79598254,
    "body" : "Replace in interface &quot;/recommendation&quot; with &quot;/recommendation1&quot; and test if error message changed. Or better &quot;/recommendation1&quot;, &quot;/recommendation2&quot;, &quot;/recommendation3&quot;",
    "score" : 0,
    "owner" : {
      "account_id" : 14376658,
      "reputation" : 680,
      "user_id" : 10384954,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-xBdd2OnIAto/AAAAAAAAAAI/AAAAAAAAABo/fK1ZH05JT5Y/s256-rj/photo.jpg",
      "display_name" : "Wladimir Diskowski",
      "link" : "https://stackoverflow.com/users/10384954/wladimir-diskowski"
    },
    "creation_date" : 1745938654,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140379850,
    "post_id" : 79598254,
    "body" : "How did you search for &quot;/recommendation}&quot; - did you use grep or search via your ide? I would go to the filesystem directly and use grep to search, making sure you&#39;re not only searching files your IDE cares about and missing somewhere else.",
    "score" : 0,
    "owner" : {
      "account_id" : 1009321,
      "reputation" : 11523,
      "user_id" : 1022260,
      "user_type" : "registered",
      "accept_rate" : 53,
      "profile_image" : "https://www.gravatar.com/avatar/3c76c653b051fc5594b5eeb66624d3ec?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "mikeb",
      "link" : "https://stackoverflow.com/users/1022260/mikeb"
    },
    "creation_date" : 1745927113,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}