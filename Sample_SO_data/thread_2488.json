{
  "question" : {
    "question_id" : 79617458,
    "title" : "Java ImageIO support with dcm4che for compressed image stream/data eg. JPEG2000, JPEGBaseline, etc",
    "body" : "<p>I am extracting data from dicom file like images and pdf. but if there is compressed data in dicom file, I cannot read it, because .convert method uses java ImageIO that is not giving support for compressed images data like JPEG200 or JPEGBaseline etc.</p>\n<pre><code>File dicomFile = new File(&quot;dicomFile.dcm&quot;);\nFile tempImage = new File(&quot;dicomImage.jpeg&quot;);\nDcm2Jpg dcm2Jpg = new Dcm2Jpg();\ndcm2Jpg.initImageWriter(&quot;JPEG&quot;, &quot;jpeg&quot;, null, null, null); \ndcm2Jpg.convert(dicomFile, tempImage); // ErrorLine\n</code></pre>\n<p>This giving me error like this,</p>\n<pre><code>Error processing DICOM: Unsupported JPEG process: SOF type 0xc3\njavax.imageio.IIOException: Unsupported JPEG process: SOF type 0xc3\n</code></pre>\n<p>I also tried manually decoding image using ByteArray, and through this I could just extract the compressed byte data from the dicom file then I tried reading this with default ImageIO but I couldn't.</p>\n<pre><code>DicomInputStream dis = new DicomInputStream(dicomFile);\nAttributes fmi = dis.readFileMetaInformation();\nAttributes dataset = dis.readDataset(-1, -1);\ndis.close();\n\n// Extract JPEG data from fragments\nObject pixelData = dataset.getValue(Tag.PixelData);\n\nif (pixelData instanceof Fragments) {\n    Fragments fragments = (Fragments) pixelData;\n\n    // Extract JPEG data - usually skip first fragment as it contains JPEG tables\n    ByteArrayOutputStream jpegStream = new ByteArrayOutputStream();\n\n    // JPEG files need a proper header - first fragment often contains tables\n    // For JPEG Lossless, we need to handle this properly\n    byte[] jpegHeader = null;\n\n    // First, check if basic parameters are available\n    if (fragments.size() &gt; 0) {\n        byte[] firstFragment = (byte[]) fragments.get(0);\n        if (firstFragment != null &amp;&amp; firstFragment.length &gt; 0) {\n            jpegHeader = firstFragment;\n        }\n    }\n\n    // Now build complete JPEG stream with all fragments\n    for (int i = 0; i &lt; fragments.size(); i++) {\n        byte[] fragment = (byte[]) fragments.get(i);\n        if (fragment != null &amp;&amp; fragment.length &gt; 0) {\n            // Skip non-SOI fragments at the start\n            if (i == 0 &amp;&amp; !(fragment[0] == (byte) 0xFF &amp;&amp; fragment[1] == (byte) 0xD8)) {\n                System.out.println(&quot;Skipping first fragment: does not start with JPEG SOI marker&quot;);\n                continue;\n            }\n            jpegStream.write(fragment);\n        }\n    }\n    byte[] jpegData = jpegStream.toByteArray();\n\n    ImageInputStream iis = ImageIO.createImageInputStream(new ByteArrayInputStream(jpegData));\n    Iterator&lt;ImageReader&gt; readers = ImageIO.getImageReadersByFormatName(&quot;JPEG&quot;);\n\n    if (readers.hasNext()) {\n        ImageReader jpegReader = readers.next();\n        jpegReader.setInput(iis, false); // Error Line\n        BufferedImage image = jpegReader.read(0);\n        System.out.println(&quot;Decoded JPEG image: &quot; + image);\n\n        // Save decoded image\n        File outputImage = new File(&quot;decoded_image.png&quot;);\n        ImageIO.write(image, &quot;PNG&quot;, outputImage);\n        System.out.println(&quot;Image saved to: &quot; + outputImage.getAbsolutePath());\n    } else {\n        System.err.println(&quot;No JPEG reader found&quot;);\n    }\n}\n</code></pre>\n<p>and faced the same error.</p>\n<pre><code>Error processing DICOM: Unsupported JPEG process: SOF type 0xc3\njavax.imageio.IIOException: Unsupported JPEG process: SOF type 0xc3\n    at com.sun.imageio.plugins.jpeg.JPEGImageReader.readImageHeader(Native Method)\n    at com.sun.imageio.plugins.jpeg.JPEGImageReader.readNativeHeader(JPEGImageReader.java:628)\n    at com.sun.imageio.plugins.jpeg.JPEGImageReader.checkTablesOnly(JPEGImageReader.java:347)\n    at com.sun.imageio.plugins.jpeg.JPEGImageReader.gotoImage(JPEGImageReader.java:495)\n    at com.sun.imageio.plugins.jpeg.JPEGImageReader.readHeader(JPEGImageReader.java:621)\n    at com.sun.imageio.plugins.jpeg.JPEGImageReader.readInternal(JPEGImageReader.java:1078)\n    at com.sun.imageio.plugins.jpeg.JPEGImageReader.read(JPEGImageReader.java:1058)\n    at javax.imageio.ImageReader.read(ImageReader.java:939)\n</code></pre>\n<p>I also tried twelveMonkey and github-jai but that also not worked so\nHow can I achieve this using only java and maven libraries without any external tool ?</p>\n",
    "tags" : [ "java", "javax.imageio", "jpeg2000", "dcm4che" ],
    "owner" : {
      "account_id" : 40074207,
      "reputation" : 1,
      "user_id" : 29595941,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f314c06457793a1965fc52b7bd3550a0?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Om Vanara",
      "link" : "https://stackoverflow.com/users/29595941/om-vanara"
    },
    "is_answered" : false,
    "view_count" : 94,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1747053169,
    "creation_date" : 1747038262,
    "link" : "https://stackoverflow.com/questions/79617458/java-imageio-support-with-dcm4che-for-compressed-image-stream-data-eg-jpeg2000",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140424380,
    "post_id" : 79617458,
    "body" : "TwelveMonkeys ImageIO JPEG reader should be able to decode JPEGs with SOF3/Lossless Huffman (&quot;SOF type 0xC3&quot;). Maybe the plugin wasn&#39;t properly installed? At least the stack trace suggests so.",
    "score" : 1,
    "owner" : {
      "account_id" : 1531514,
      "reputation" : 27191,
      "user_id" : 1428606,
      "user_type" : "registered",
      "accept_rate" : 71,
      "profile_image" : "https://www.gravatar.com/avatar/5daf03972dae4f96a2d09ca5cc681920?s=256&d=identicon&r=PG",
      "display_name" : "Harald K",
      "link" : "https://stackoverflow.com/users/1428606/harald-k"
    },
    "creation_date" : 1747216203,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}