{
  "question" : {
    "question_id" : 79550817,
    "title" : "Harshicorp Vault OIDC Authentication via Proxy to Azure AD: &#39;Invalid Issuer&#39; Error",
    "body" : "<p>​I am currently facing challenges while configuring HashiCorp Vault to authenticate via OpenID Connect (OIDC) through a proxy that interfaces with Azure Active Directory (AAD). The proxy exposes the discovery URL, and Vault communicates with it using OIDC. However, after exchanging the authorization code for a token, Vault returns the following error on vault UI:</p>\n<pre><code>Vault login failed. Error exchanging oidc code: &quot;Provider.Exchange: id_token failed verification: Provider.VerifyIDToken: invalid id_token: oidc: id token issued by a different provider, expected \\&quot;http://{proxy_ip}:443\\&quot; got \\&quot;https://login.partner.microsoftonline.cn/{tenant-id}/v2.0\\&quot;: invalid issuer&quot;.\n</code></pre>\n<p>Modifying the issuer in the discovery URL to match the token's actual issuer leads to another error:</p>\n<pre><code>error checking oidc discovery URL: error=&quot;error creating provider with given values: NewProvider: unable to create provider: oidc: issuer did not match the issuer returned by provider, expected \\&quot;http://{proxy_ip}\\&quot; got \\&quot;https://login.partner.microsoftonline.cn/{tenant-id}/v2.0\\&quot;&quot;.\n</code></pre>\n<p>I am using Vault version 1.19.0 (7eeafb6160d60ede73c1d95566b0c8ea54f3cb5a), running in development mode locally.​</p>\n<p>Has anyone encountered similar issues when configuring Vault with a proxy for Azure AD authentication? Any insights or recommendations would be greatly appreciated.</p>\n",
    "tags" : [ "java", "openid-connect", "hashicorp-vault", "oidc-provider" ],
    "owner" : {
      "account_id" : 31397070,
      "reputation" : 1,
      "user_id" : 24217158,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6871b3739a6c72c00d23939907f5655d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Joe",
      "link" : "https://stackoverflow.com/users/24217158/joe"
    },
    "is_answered" : false,
    "view_count" : 112,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1743601520,
    "creation_date" : 1743601520,
    "link" : "https://stackoverflow.com/questions/79550817/harshicorp-vault-oidc-authentication-via-proxy-to-azure-ad-invalid-issuer-err",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}