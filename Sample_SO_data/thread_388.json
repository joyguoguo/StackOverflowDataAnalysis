{
  "question" : {
    "question_id" : 79804551,
    "title" : "How to use jsonb functions in hibernate 6?",
    "body" : "<p>We use Postgres <code>jsonb_agg</code> function in criteria query API like this:</p>\n<pre><code>cb.function(\n                JSONB_AGG_FUNCTION_NAME,\n                JsonNode.class,\n                someJoin.get(someField)\n            )\n</code></pre>\n<p>and map a result into projection with constructor:</p>\n<pre><code>Projection (&lt;some args&gt;, com.fasterxml.jackson.databind.JsonNode node)\n</code></pre>\n<p>In Hibernate 5 we registered <code>jsonb_agg</code> function using this approach:</p>\n<pre><code>public class ExtendedPgDialect extends PostgreSQLDialect {\n\npublic static final String JSONB_AGG_FUNCTION_NAME = &quot;jsonb_agg&quot;;\n\npublic ExtendedPgDialect() {\n    registerFunction(JSONB_AGG_FUNCTION_NAME,\n            new StandardSQLFunction(JSONB_AGG_FUNCTION_NAME, JsonNodeBinaryType.INSTANCE));\n     }\n}\n</code></pre>\n<p>But in Hibernate 6.6.33.Final we can't register that function and can't use it for querying data.\nAlso we used (<code>JsonNodeBinaryType</code>) type from io.hypersistence:hypersistence-utils-hibernate-53 library. How to register <code>jsonb_agg</code> function in Hibernate 6 for mapping to <code>JsonNode</code> java type?</p>\n",
    "tags" : [ "java", "postgresql", "hibernate", "criteria", "jsonb" ],
    "owner" : {
      "account_id" : 29075771,
      "reputation" : 143,
      "user_id" : 22272977,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AAcHTte84Ivji8PRE1ZJ4PbrT8hScfiqYc2zV3zX5YpeaOwC=k-s256",
      "display_name" : "Роман Григорьев",
      "link" : "https://stackoverflow.com/users/22272977/%d0%a0%d0%be%d0%bc%d0%b0%d0%bd-%d0%93%d1%80%d0%b8%d0%b3%d0%be%d1%80%d1%8c%d0%b5%d0%b2"
    },
    "is_answered" : false,
    "view_count" : 72,
    "answer_count" : 1,
    "score" : 2,
    "last_activity_date" : 1761823057,
    "creation_date" : 1761814462,
    "link" : "https://stackoverflow.com/questions/79804551/how-to-use-jsonb-functions-in-hibernate-6",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79804598,
    "question_id" : 79804551,
    "body" : "<p>Found a solution, may be it can be useful for someone.</p>\n<pre><code>public class ExtendedPgDialect extends PostgreSQLDialect {\n\n    @Override\n    protected void registerColumnTypes(TypeContributions typeContributions,\n                                       ServiceRegistry serviceRegistry) {\n        super.registerColumnTypes(typeContributions, serviceRegistry);\n        typeContributions.contributeType(JsonNodeBinaryType.INSTANCE);\n    }\n}\n</code></pre>\n<p>So I have to register io.hypersistence.utils.hibernate.type.json.JsonNodeBinaryType for Hibernate without registering any function like that and now Hibernate can map jsonb column to JsonNode java field.\nMy result generated query :</p>\n<pre><code>select\n        &lt;some columns&gt;,\n        jsonb_agg(&lt;some column&gt;)\n    from &lt;some table&gt; ...\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 29075771,
      "reputation" : 143,
      "user_id" : 22272977,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AAcHTte84Ivji8PRE1ZJ4PbrT8hScfiqYc2zV3zX5YpeaOwC=k-s256",
      "display_name" : "Роман Григорьев",
      "link" : "https://stackoverflow.com/users/22272977/%d0%a0%d0%be%d0%bc%d0%b0%d0%bd-%d0%93%d1%80%d0%b8%d0%b3%d0%be%d1%80%d1%8c%d0%b5%d0%b2"
    },
    "creation_date" : 1761817258,
    "last_activity_date" : 1761818682,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}