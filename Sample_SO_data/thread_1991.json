{
  "question" : {
    "question_id" : 79657643,
    "title" : "ZeroEvenOdd problem with synchronized key, wait and notify",
    "body" : "<p>Program is continue running after printing the data in a correct order.</p>\n<p>SynchronizedResource class is responsible to print the data using correct order. It is printing data in correct order but program still running. I'm unable to find out the reason</p>\n<p>I'm getting output like this</p>\n<pre class=\"lang-none prettyprint-override\"><code>Printing Zero 0 with iteration number :- 1 Zero Thread\nPrinting Odd number 1 Odd Thread\nPrinting Zero 0 with iteration number :- 2 Zero Thread\nPrinting Even number 2 Even Thread\nPrinting Zero 0 with iteration number :- 3 Zero Thread\nPrinting Odd number 3 Odd Thread\nPrinting Zero 0 with iteration number :- 4 Zero Thread\nPrinting Even number 4 Even Thread\nPrinting Zero 0 with iteration number :- 5 Zero Thread\nPrinting Odd number 5 Odd Thread\nPrinting Zero 0 with iteration number :- 6 Zero Thread\nPrinting Even number 6 Even Thread\nPrinting Zero 0 with iteration number :- 7 Zero Thread\nPrinting Odd number 7 Odd Thread\nPrinting Zero 0 with iteration number :- 8 Zero Thread\nPrinting Even number 8 Even Thread\nPrinting Zero 0 with iteration number :- 9 Zero Thread\nPrinting Odd number 9 Odd Thread\nPrinting Zero 0 with iteration number :- 10 Zero Thread\nPrinting Even number 10 Even Thread\n</code></pre>\n<p>but program is keep running</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class SynchronizedResource {\n    private final int loop;\n    private int zeroCounter;\n    private int oddEvenCounter;\n    private boolean signal = true;\n\n    public SynchronizedResource(\n        int loop\n    ) {\n        this.loop = loop;\n        this.zeroCounter = 1;\n        this.oddEvenCounter = 1;\n    }\n\n    public synchronized void zeroPrinting() {\n        try {\n            while(zeroCounter &lt;= loop) {\n                while(!signal) {\n                    wait();\n                }\n                System.out.println(&quot;Printing Zero 0 with iteration number :- &quot; + zeroCounter + &quot; &quot; + Thread.currentThread().getName());\n                zeroCounter = zeroCounter + 1;\n                signal = false;\n                notifyAll();\n            }\n        } catch (InterruptedException exception) {\n            System.out.println(exception.getMessage());\n        }\n    }\n\n    public synchronized void evenPrinting() {\n        try {\n            while(oddEvenCounter &lt;= loop) {\n                while( (signal) || (oddEvenCounter % 2 != 0) ) {\n                    wait();\n                }\n                System.out.println(&quot;Printing Even number &quot; +oddEvenCounter+  &quot; &quot; + Thread.currentThread().getName());\n                oddEvenCounter++;\n                signal = true;\n                notifyAll();\n            }\n        } catch (InterruptedException exception) {\n            System.out.println(exception.getMessage());\n        }\n    }\n\n    public synchronized void oddPrinting() {\n        try {\n            while(oddEvenCounter &lt;= loop) {\n                while( (signal) || (oddEvenCounter % 2 == 0)) {\n                    wait();\n                }\n                System.out.println(&quot;Printing Odd number &quot; +oddEvenCounter+  &quot; &quot; + Thread.currentThread().getName());\n                oddEvenCounter++;\n                signal = true;\n                notifyAll();\n            }\n        } catch (InterruptedException exception) {\n            System.out.println(exception.getMessage());\n        }\n    }\n}\n</code></pre>\n<p><em><strong>Main class</strong></em></p>\n<pre class=\"lang-java prettyprint-override\"><code>public class Main {\n    public static void main(String[] args) throws InterruptedException {\n        SynchronizedResource resource = new SynchronizedResource(10);\n\n        Thread zeroThread = new Thread(resource::zeroPrinting, &quot;Zero Thread&quot;);\n\n        Thread evenThread = new Thread(resource::evenPrinting, &quot;Even Thread&quot;);\n\n        Thread oddThread = new Thread(resource::oddPrinting, &quot;Odd Thread&quot;);\n\n        zeroThread.start();\n        evenThread.start();\n        oddThread.start();\n\n        zeroThread.join();\n        evenThread.join();\n        oddThread.join();\n\n\n        System.out.println(&quot;Program executed successfully........&quot;);\n    }\n}\n</code></pre>\n",
    "tags" : [ "java", "multithreading" ],
    "owner" : {
      "account_id" : 42422845,
      "reputation" : 11,
      "user_id" : 30746256,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e89f0733ee69913f48104363884ff9a8?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Sujay Ghosh",
      "link" : "https://stackoverflow.com/users/30746256/sujay-ghosh"
    },
    "is_answered" : true,
    "view_count" : 74,
    "answer_count" : 2,
    "score" : 1,
    "last_activity_date" : 1749508912,
    "creation_date" : 1749370047,
    "link" : "https://stackoverflow.com/questions/79657643/zeroevenodd-problem-with-synchronized-key-wait-and-notify",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79657653,
    "question_id" : 79657643,
    "body" : "<p>The reason your program keeps running even after printing all the output correctly is that <strong>some threads are stuck in the <code>wait()</code> state</strong> and never get notified to exit once their conditions are no longer met.</p>\n<p>Your threads enter <code>wait()</code> inside a <code>while</code> loop based on conditions (<code>signal</code>, <code>oddEvenCounter % 2</code>, etc.). Once the counters exceed the loop limit, the outer <code>while</code> loop condition becomes false, and no <code>notifyAll()</code> is called anymore. However, some threads may still be waiting and will never be awakened to check the exit condition again, so the program doesn’t terminate.</p>\n<p>To fix this, you should add additional checks after the loop or notify all waiting threads when printing is done. One way is to use <code>notifyAll()</code> after the outer <code>while</code> loop ends or add a shared <code>finished</code> flag to gracefully exit all threads.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 6962218,
      "reputation" : 442,
      "user_id" : 5341306,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/8rhmy.jpg?s=256",
      "display_name" : "Imran.Khan",
      "link" : "https://stackoverflow.com/users/5341306/imran-khan"
    },
    "creation_date" : 1749371105,
    "last_activity_date" : 1749371105,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79659592,
    "question_id" : 79657643,
    "body" : "<p>This is your code with the modification I suggested, on my machine it works correctly.</p>\n<pre><code>class SynchronizedResource {\n\n   private final int loop;\n   private int zeroCounter;\n   private int oddEvenCounter;\n   private boolean signal = true;\n\n   public SynchronizedResource( int loop ) {\n      this.loop = loop;\n      this.zeroCounter = 1;\n      this.oddEvenCounter = 1;\n   }\n\n   public synchronized void zeroPrinting() {\n      try {\n         while( zeroCounter &lt;= loop ) {\n            while(  ! signal ) {\n               wait();\n            }\n            System.out.println( &quot;Printing Zero 0 with iteration number :- &quot; + zeroCounter + &quot; &quot; + Thread.currentThread().getName() );\n            zeroCounter ++;\n            signal = false;\n            notifyAll();\n         }\n      }\n      catch( InterruptedException exception ) {\n         System.out.println( exception.getMessage() );\n      }\n   }\n\n   public synchronized void evenPrinting() {\n      try {\n         while( oddEvenCounter &lt;= loop ) {\n            while( ( signal ) || ( oddEvenCounter % 2 != 0 ) ) {\n               wait();\n            }\n            System.out.println( &quot;Printing Even number &quot; + oddEvenCounter + &quot; &quot; + Thread.currentThread().getName() );\n            oddEvenCounter ++;\n\n              // this is the modification, it only sets “xx” to “true” if the limit \n              // has not been reached (this would make the other thread wait without  \n              // knowing that the limit has been reached)\n            if( oddEvenCounter != loop ) signal = true;\n            notifyAll();\n         }\n      }\n      catch( InterruptedException exception ) {\n         System.out.println( exception.getMessage() );\n      }\n   }\n\n   public synchronized void oddPrinting() {\n      try {\n         while( oddEvenCounter &lt;= loop ) {\n            while( ( signal ) || ( oddEvenCounter % 2 == 0 ) ) {\n               wait();\n            }\n            System.out.println( &quot;Printing Odd number &quot; + oddEvenCounter + &quot; &quot; + Thread.currentThread().getName() );\n            oddEvenCounter ++;\n            if( oddEvenCounter != loop ) signal = true;\n            notifyAll();\n         }\n      }\n      catch( InterruptedException exception ) {\n         System.out.println( exception.getMessage() );\n      }\n   }\n}\n</code></pre>\n<p>The problem originates when <strong>oddPrinting</strong> makes its last execution, (after <strong>zeroPrinting</strong> made its last execution), before, it would set <strong>signal</strong> to <em>true</em>, enabling <strong>zeroPrinting</strong> to execute, which never happened because it had already finished, and <strong>evenPrinting</strong> was in the “sweet wait”... and eternal.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 10843443,
      "reputation" : 916,
      "user_id" : 20882864,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/CCQCy.jpg?s=256",
      "display_name" : "Marce Puente",
      "link" : "https://stackoverflow.com/users/20882864/marce-puente"
    },
    "creation_date" : 1749508157,
    "last_activity_date" : 1749508912,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140500714,
    "post_id" : 79657643,
    "body" : "I wrote you the code as an answer...",
    "score" : 0,
    "owner" : {
      "account_id" : 10843443,
      "reputation" : 916,
      "user_id" : 20882864,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/CCQCy.jpg?s=256",
      "display_name" : "Marce Puente",
      "link" : "https://stackoverflow.com/users/20882864/marce-puente"
    },
    "creation_date" : 1749508224,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140500686,
    "post_id" : 79657643,
    "body" : "Hello @MarcePuente it is not working",
    "score" : 0,
    "owner" : {
      "account_id" : 42422845,
      "reputation" : 11,
      "user_id" : 30746256,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e89f0733ee69913f48104363884ff9a8?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Sujay Ghosh",
      "link" : "https://stackoverflow.com/users/30746256/sujay-ghosh"
    },
    "creation_date" : 1749507498,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140497429,
    "post_id" : 79657643,
    "body" : "Hello Sujay, welcome, read the excellent explanation of @Imran.Khan, you can fix this by changing: <b>signal = true;</b> to <b>if( oddEvenCounter != 10 ) signal = true;</b>.",
    "score" : 0,
    "owner" : {
      "account_id" : 10843443,
      "reputation" : 916,
      "user_id" : 20882864,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/CCQCy.jpg?s=256",
      "display_name" : "Marce Puente",
      "link" : "https://stackoverflow.com/users/20882864/marce-puente"
    },
    "creation_date" : 1749401711,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140496722,
    "post_id" : 79657643,
    "body" : "Hint: Odd Thread ist not being terminated -- Hint2: Zero Thread must be running to terminate the other(s) Threads --  (maybe printing when a Thread [main loop] ends is helpful)",
    "score" : 0,
    "owner" : {
      "account_id" : 31180,
      "reputation" : 29752,
      "user_id" : 85421,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/kKvXH.gif?s=256",
      "display_name" : "user85421",
      "link" : "https://stackoverflow.com/users/85421/user85421"
    },
    "creation_date" : 1749371801,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79657653" : [ {
      "comment_id" : 140500746,
      "post_id" : 79657653,
      "body" : "@sujay-ghosh check this link <a href=\"https://onecompiler.com/java/43madzf9a\" rel=\"nofollow noreferrer\">onecompiler.com/java/43madzf9a</a>",
      "score" : 1,
      "owner" : {
        "account_id" : 6962218,
        "reputation" : 442,
        "user_id" : 5341306,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/8rhmy.jpg?s=256",
        "display_name" : "Imran.Khan",
        "link" : "https://stackoverflow.com/users/5341306/imran-khan"
      },
      "creation_date" : 1749510047,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140500691,
      "post_id" : 79657653,
      "body" : "Hi Imran.Khan Can you eleborate little bit more?",
      "score" : 0,
      "owner" : {
        "account_id" : 42422845,
        "reputation" : 11,
        "user_id" : 30746256,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/e89f0733ee69913f48104363884ff9a8?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Sujay Ghosh",
        "link" : "https://stackoverflow.com/users/30746256/sujay-ghosh"
      },
      "creation_date" : 1749507564,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}