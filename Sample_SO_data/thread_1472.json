{
  "question" : {
    "question_id" : 79702740,
    "title" : "Tomcat 9 change in retrieving MIME type of a resource?",
    "body" : "<p>Recently did an upgrade from Tomcat 9.0.90 to 9.0.107, and we observed a difference in how Tomcat determines a MIME type for a resource, where it appears that if a web application defines any MIME mappings in its web.xml, then the server-level web.xml is complete ignored.</p>\n<p>For example, take the following code:</p>\n<pre><code>String mimeType = getServletConfig().\n                    getServletContext().getMimeType(resource.getPath());\n</code></pre>\n<p>In our specific case, the resource was to a .txt file.  In Tomcat 9.0.90, the API call returns &quot;text/plain&quot; (Good!).  In Tomcat 9.0.107, it returns <code>null</code> (Bad!) (where our servlet code falls back to &quot;application/octet-stream&quot;).</p>\n<p>What I noticed is that the MIME mapping for 'txt' is specified in the Tomcat conf/web.xml file we use, but it is not defined in the web application's web.xml file.  When I add the mapping to the webapps' web.xml, the API call returns &quot;text/plain&quot;.</p>\n<p>I examined the Change Log for Tomcat 9.0.107, and I could not find anything that explicitly mentions this change in behavior.  If a webapp defines any MIME mappings in its web.xml, must it define a mapping for <strong>everything</strong> now?  Is this standard servlet application behavior?  Or is this a bug in Tomcat?</p>\n",
    "tags" : [ "java", "tomcat", "tomcat9" ],
    "owner" : {
      "account_id" : 42124569,
      "reputation" : 105,
      "user_id" : 30604023,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e748f39a58e540552038c612ad0245f1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "ewh.eps",
      "link" : "https://stackoverflow.com/users/30604023/ewh-eps"
    },
    "is_answered" : true,
    "view_count" : 118,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1752781056,
    "creation_date" : 1752620246,
    "link" : "https://stackoverflow.com/questions/79702740/tomcat-9-change-in-retrieving-mime-type-of-a-resource",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79704101,
    "question_id" : 79702740,
    "body" : "<p>The problem was due to an error in the <code>conf/web.xml</code> file when parsed against later versions of the servlet specification as specified by the <code>version</code> attribute of the <code>&lt;web-app&gt;</code> element.  There were two instances of the <code>&lt;session-config&gt;</code> element, which generates an error in Tomcat's server log.  When the version was <code>2.4</code>, parsing is more forgiving.</p>\n<p>With the removal of the duplicate <code>&lt;session-config&gt;</code> element, the MIME type lookup functions as expected when the <code>version</code> attribute is set to <code>3.1</code> or <code>4.0</code>.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 42124569,
      "reputation" : 105,
      "user_id" : 30604023,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e748f39a58e540552038c612ad0245f1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "ewh.eps",
      "link" : "https://stackoverflow.com/users/30604023/ewh-eps"
    },
    "creation_date" : 1752706136,
    "last_activity_date" : 1752781056,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140595070,
    "post_id" : 79702740,
    "body" : "OK - you have a workaround. Suggestions: (a) make sure all the attributes of your <code>&lt;web-app&gt;</code> tag are consistent with those provided in Tomcat&#39;s <code>web.xml</code>. And make sure they align with the <a href=\"https://tomcat.apache.org/whichversion.html\" rel=\"nofollow noreferrer\">Java EE or Jakarta EE release</a> you are using. (b) Do what I did: use a fresh Tomcat download with a &quot;helllo world&quot; servlet (which works); then change that step-by-step to match what you are actually using (and which does not work as expected) - and see at which step you break it.",
    "score" : 2,
    "owner" : {
      "account_id" : 12743722,
      "reputation" : 22621,
      "user_id" : 12567365,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/zNR3x.png?s=256",
      "display_name" : "andrewJames",
      "link" : "https://stackoverflow.com/users/12567365/andrewjames"
    },
    "creation_date" : 1752696485,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140594901,
    "post_id" : 79702740,
    "body" : "@andrewJames Changed from 3.1. to 4.0, but no change in behavior.  Get <code>null</code> back unless I explicitly define mime-mapping in the webapp&#39;s <code>web.xml</code> file. When time permits, I will try some more experiments, but for now, we will just include txt mime-mapping in webapp&#39;s <code>web.xml</code>.  Thanks for the help.",
    "score" : 0,
    "owner" : {
      "account_id" : 42124569,
      "reputation" : 105,
      "user_id" : 30604023,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e748f39a58e540552038c612ad0245f1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "ewh.eps",
      "link" : "https://stackoverflow.com/users/30604023/ewh-eps"
    },
    "creation_date" : 1752692723,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140594740,
    "post_id" : 79702740,
    "body" : "Looks like I cannot edit comments: I meant to say &quot;3.1&quot; instead of &quot;3.5&quot;.  Will test to see if switching to 4.0 makes any difference.",
    "score" : 0,
    "owner" : {
      "account_id" : 42124569,
      "reputation" : 105,
      "user_id" : 30604023,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e748f39a58e540552038c612ad0245f1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "ewh.eps",
      "link" : "https://stackoverflow.com/users/30604023/ewh-eps"
    },
    "creation_date" : 1752688455,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140594711,
    "post_id" : 79702740,
    "body" : "@andrewJames I think I discovered the trigger that affects the behavior: As part of upgrading, we also changed the web.xml version attribute from 2.x to 3.x.  When I revert back to 2.x, we get the previous behavior.  But when the web.xml files specify 3.x (&quot;3.5&quot; in our case), get the change in behavior, where I have to explicitly specify a txt mime-mapping in the webapps&#39;s web.xml to avoid a non-null value.",
    "score" : 1,
    "owner" : {
      "account_id" : 42124569,
      "reputation" : 105,
      "user_id" : 30604023,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e748f39a58e540552038c612ad0245f1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "ewh.eps",
      "link" : "https://stackoverflow.com/users/30604023/ewh-eps"
    },
    "creation_date" : 1752687782,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140593956,
    "post_id" : 79702740,
    "body" : "From the <a href=\"https://tomcat.apache.org/tomcat-9.0-doc/config/context.html#Automatic_Context_Configuration\" rel=\"nofollow noreferrer\">documentation</a>: &quot;The web application properties listed in <code>conf&#47;web.xml</code> will be processed as defaults&quot; and then any specific webapp settings will take precedence over those (and over any in <code>&#47;WEB-INF&#47;tomcat-web.xml</code>).",
    "score" : 0,
    "owner" : {
      "account_id" : 12743722,
      "reputation" : 22621,
      "user_id" : 12567365,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/zNR3x.png?s=256",
      "display_name" : "andrewJames",
      "link" : "https://stackoverflow.com/users/12567365/andrewjames"
    },
    "creation_date" : 1752671390,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140593467,
    "post_id" : 79702740,
    "body" : "&quot;if a web application defines any MIME mappings in its <code>web.xml</code>, then the server-level <code>web.xml</code> is complete ignored&quot;: isn&#39;t that exactly what you would want?",
    "score" : 0,
    "owner" : {
      "account_id" : 71739,
      "reputation" : 311869,
      "user_id" : 207421,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=256&d=identicon&r=PG",
      "display_name" : "user207421",
      "link" : "https://stackoverflow.com/users/207421/user207421"
    },
    "creation_date" : 1752659571,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140592532,
    "post_id" : 79702740,
    "body" : "I cannot recreate your problem. I tested your code, with a hard-coded text file <code>foo.txt</code> for my resource. I used Tomcat 9.0.107 (with JavaEE 8 web profile). The code returned the expected media (MIME) type of <code>text&#47;plain</code>. My web app has a custom (fictitious) <code>web.xml</code> with one custom <code>&lt;mime-mapping&gt;</code> entry, which made no difference to my results.",
    "score" : 0,
    "owner" : {
      "account_id" : 12743722,
      "reputation" : 22621,
      "user_id" : 12567365,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/zNR3x.png?s=256",
      "display_name" : "andrewJames",
      "link" : "https://stackoverflow.com/users/12567365/andrewjames"
    },
    "creation_date" : 1752627886,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79704101" : [ {
      "comment_id" : 140598127,
      "post_id" : 79704101,
      "body" : "Please avoid such non-technical idioms and abbreviations. This website has a diverse world-wide audience. Such unnecessary verbiage creates confusion.",
      "score" : 0,
      "owner" : {
        "account_id" : 322981,
        "reputation" : 346951,
        "user_id" : 642706,
        "user_type" : "registered",
        "accept_rate" : 58,
        "profile_image" : "https://i.sstatic.net/ZWEI3.jpg?s=256",
        "display_name" : "Basil Bourque",
        "link" : "https://stackoverflow.com/users/642706/basil-bourque"
      },
      "creation_date" : 1752781048,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140598044,
      "post_id" : 79704101,
      "body" : "@BasilBourque User Brain Dead",
      "score" : 0,
      "owner" : {
        "account_id" : 42124569,
        "reputation" : 105,
        "user_id" : 30604023,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/e748f39a58e540552038c612ad0245f1?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "ewh.eps",
        "link" : "https://stackoverflow.com/users/30604023/ewh-eps"
      },
      "creation_date" : 1752778961,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140595433,
      "post_id" : 79704101,
      "body" : "What does &quot;UBD&quot; mean?",
      "score" : 2,
      "owner" : {
        "account_id" : 322981,
        "reputation" : 346951,
        "user_id" : 642706,
        "user_type" : "registered",
        "accept_rate" : 58,
        "profile_image" : "https://i.sstatic.net/ZWEI3.jpg?s=256",
        "display_name" : "Basil Bourque",
        "link" : "https://stackoverflow.com/users/642706/basil-bourque"
      },
      "creation_date" : 1752708750,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}