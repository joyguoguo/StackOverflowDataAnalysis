{
  "question" : {
    "question_id" : 79637008,
    "title" : "CORS preventing access and data retrieval",
    "body" : "<p>I'm trying to setup a new project based on a working existing project. I haven't been able to get the database connection to work through JDBC. I'm not getting any errors, just an empty list result. I know there is something wonky with the setup of the database, because I was getting an error that the bean for the NamedParameterJdbcTemplate was not found. In the previous project, I had defined the database connection information in the application-default.properties, which was sufficient to allow spring to pick it up and use. However, to resolve the issue, I added a bean to the WebSecurity/Configuration file. This resolved that issue, allowing the database to at least connect. I know the connection is working, because if I intentionally mistype a table/column name then I get a SQL error that it can't find the table. Since it is finding the table, I can't fathom at this point what is preventing data from coming back.</p>\n<p>I'll note that I know there are misconfigurations I have to figure out somewhere. Not only can I not define the database in the application.properties, but I also can't get cors to work either, and have been allowing all traffic for now because I've spent ages on trying to figure out cors and gotten nowhere.</p>\n<p>Code:</p>\n<p>Repository:</p>\n<pre><code>@Slf4j\n@Repository\npublic class TestRepository {\n    private final String FIND_ALL_QUERY = \n            &quot;SELECT &quot; + \n            &quot;   test.ids AS id, &quot; + \n            &quot;   test.value AS value &quot; + \n            &quot;FROM test_table test &quot;;\n\n    @Autowired\n    private NamedParameterJdbcTemplate namedParameterJdbcTemplate;\n    \n    @Autowired\n    private DataSource dataSource;\n    \n    @Transactional\n    public List&lt;TestDto&gt; findAll() {\n        log.info(&quot;running query...&quot;);\n        return this.namedParameterJdbcTemplate.query(FIND_ALL_QUERY, BeanPropertyRowMapper.newInstance(TestDto.class));\n    }\n}\n</code></pre>\n<p>Web Security:</p>\n<pre><code>@Slf4j\n@PropertySource(&quot;classpath:application.properties&quot;)\n@Configuration\n@EnableWebSecurity\npublic class SecurityConfig {   \n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        log.info(&quot;In securityFilterChain&quot;); \n        \n        http.csrf().disable().authorizeHttpRequests().anyRequest().permitAll();\n        \n        return http.build();\n    }\n\n    @Bean\n    public DataSource dataSource() {\n        DriverManagerDataSource ds = new DriverManagerDataSource();\n        ds.setDriverClassName(&quot;oracle.jdbc.OracleDriver&quot;);\n        ds.setUrl(&quot;jdbc:oracle:thin:@localhost:1521&quot;);\n        ds.setUsername(&quot;c##redacted&quot;);\n        ds.setPassword(&quot;redacted&quot;);\n        return ds;\n    }\n    \n    @Bean\n    public NamedParameterJdbcTemplate namedParameterJdbcTemplate() {\n        return new NamedParameterJdbcTemplate(dataSource());\n    }\n}\n</code></pre>\n<p>application.properties:</p>\n<pre><code>spring.datasource.url=jdbc:oracle:thin:@localhost:1521\nspring.datasource.username=c##redacted\nspring.datasource.password=redacted\nspring.datasource.driver-class-name=oracle.jdbc.OracleDriver\n\nspring.datasource.hikari.maxLifetime=60000\n</code></pre>\n<p>Service Implementation:</p>\n<pre><code>@Slf4j\n@RequiredArgsConstructor\n@Service\npublic class TestServiceImpl implements TestService {\n    @Autowired\n    private TestRepository testRepository;\n\n    public List&lt;TestDto&gt; findAll() {\n        List&lt;TestDto&gt; test = testRepository.findAll();\n        log.info(&quot;test.size(): &quot;, test.size());\n        log.info(&quot;test.get(0): &quot;, test.get(0));\n        return test;\n    }\n}\n</code></pre>\n<p>Database Table:</p>\n<p><a href=\"https://i.sstatic.net/lQkBmWl9.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/lQkBmWl9.png\" alt=\"Database Table Name and Data\" /></a></p>\n<p>Output:</p>\n<pre><code>2025-05-24 13:16:05 INFO  campaign.controller.TestController - findingAll...\n2025-05-24 13:16:05 INFO  campaign.repository.TestRepository - running query...\n2025-05-24 13:16:05 INFO  c.serviceimpl.TestServiceImpl - test.size():\n2025-05-24 13:16:05 INFO  c.serviceimpl.TestServiceImpl - test.get(0):\n</code></pre>\n<p>Edit: This may still be an issue with CORS. I don't know how given the reconfiguration I did to WebSecurity to remove everything related to authentication and cors. However, I'm getting this error in the web console:</p>\n<pre><code>Access to XMLHttpRequest at 'http://127.0.0.1:8080/archlands/api/test/value' from origin 'http://localhost:4200' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource.\n</code></pre>\n<p>TestDto (shared by request from comment):</p>\n<pre><code>@Data\n@ToString\n@RequiredArgsConstructor\n@AllArgsConstructor\n@Entity\npublic class TestDto {\n    private Long id;\n    private String value;\n    \n    @Override\n    public boolean equals(Object checkObject) {\n        Boolean usersAreEqual = false;\n        if (this == checkObject) {\n            usersAreEqual = true;\n        } else if (checkObject == null || Hibernate.getClass(this) != Hibernate.getClass(checkObject)) {\n            usersAreEqual = false;\n        } else { // correct type, check values\n            TestDto checkUser = (TestDto) checkObject;\n            if (id != null) {\n                usersAreEqual = Objects.equals(id, checkUser.id);\n            }\n        }\n        return usersAreEqual;\n    }\n\n    @Override\n    public int hashCode() {\n        return getClass().hashCode();\n    }\n}\n</code></pre>\n",
    "tags" : [ "java", "spring", "cors" ],
    "owner" : {
      "account_id" : 6841559,
      "reputation" : 63,
      "user_id" : 5261779,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/20efb45f1b7bd27664f79cf8dee045df?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Fidelis",
      "link" : "https://stackoverflow.com/users/5261779/fidelis"
    },
    "is_answered" : true,
    "view_count" : 109,
    "answer_count" : 1,
    "score" : -4,
    "last_activity_date" : 1748132951,
    "creation_date" : 1748107069,
    "link" : "https://stackoverflow.com/questions/79637008/cors-preventing-access-and-data-retrieval",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79637063,
    "question_id" : 79637008,
    "body" : "<h2><strong>Fix CORS Policy Error as below</strong></h2>\n<p>You mentioned:</p>\n<blockquote>\n<p><em>&quot;No 'Access-Control-Allow-Origin' header is present...&quot;</em></p>\n</blockquote>\n<h3>Fix CORS in Spring Boot</h3>\n<p>Update your <code>SecurityConfig</code> to explicitly enable CORS:</p>\n<pre><code>@Configuration\n@EnableWebSecurity\npublic class SecurityConfig {\n\n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        http\n            .cors(Customizer.withDefaults()) // Enable CORS\n            .csrf().disable()\n            .authorizeHttpRequests()\n            .anyRequest().permitAll();\n        return http.build();\n    }\n\n    @Bean\n    public CorsConfigurationSource corsConfigurationSource() {\n        CorsConfiguration config = new CorsConfiguration();\n        config.setAllowedOrigins(List.of(&quot;http://localhost:4200&quot;)); // Your frontend\n        config.setAllowedMethods(List.of(&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;, &quot;OPTIONS&quot;));\n        config.setAllowedHeaders(List.of(&quot;*&quot;));\n        config.setAllowCredentials(true);\n\n        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();\n        source.registerCorsConfiguration(&quot;/**&quot;, config);\n        return source;\n    }\n}\n</code></pre>\n<p><strong>Other</strong> <strong>Problem : <code>@RequiredArgsConstructor</code> with fields not <code>final</code></strong></p>\n<p>Your fields <code>id</code> and <code>value</code> are not <code>final</code>, but you have, Remove @RequiredArgsConstructor annotation.</p>\n<p>This has <strong>no effect</strong> unless fields are <code>final</code> or annotated with <code>@NonNull</code>.</p>\n",
    "score" : 4,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 6211022,
      "reputation" : 147,
      "user_id" : 4837309,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/TMwfKcVJ.jpg?s=256",
      "display_name" : "Kirtee Chaudhary",
      "link" : "https://stackoverflow.com/users/4837309/kirtee-chaudhary"
    },
    "creation_date" : 1748111124,
    "last_activity_date" : 1748111124,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140456085,
    "post_id" : 79637008,
    "body" : "I understand that the DTO is not the controller. But it looks like that you use the entity as the interface Object that is returned by the controller to the client",
    "score" : 0,
    "owner" : {
      "account_id" : 4470050,
      "reputation" : 69587,
      "user_id" : 3636601,
      "user_type" : "registered",
      "accept_rate" : 75,
      "profile_image" : "https://www.gravatar.com/avatar/e46b43f329f0228186fb75d496316d33?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jens",
      "link" : "https://stackoverflow.com/users/3636601/jens"
    },
    "creation_date" : 1748118237,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140456082,
    "post_id" : 79637008,
    "body" : "Thanks for the tip. The Dto is not the controller though. I have a separate file that acts as my controller.",
    "score" : 0,
    "owner" : {
      "account_id" : 6841559,
      "reputation" : 63,
      "user_id" : 5261779,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/20efb45f1b7bd27664f79cf8dee045df?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Fidelis",
      "link" : "https://stackoverflow.com/users/5261779/fidelis"
    },
    "creation_date" : 1748117987,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140456043,
    "post_id" : 79637008,
    "body" : "BTW: Do not use the entity at controller level.",
    "score" : 0,
    "owner" : {
      "account_id" : 4470050,
      "reputation" : 69587,
      "user_id" : 3636601,
      "user_type" : "registered",
      "accept_rate" : 75,
      "profile_image" : "https://www.gravatar.com/avatar/e46b43f329f0228186fb75d496316d33?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jens",
      "link" : "https://stackoverflow.com/users/3636601/jens"
    },
    "creation_date" : 1748116769,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140456033,
    "post_id" : 79637008,
    "body" : "@Jens looking back at the log.info I realized a stupid error. I used the angular/frontend console log notation. They needed to be addended with a + rather than treated as an object (adding a common). Alternatively needed to use object replacement. While this doesn&#39;t fix the error, it at least got the proper values printed.",
    "score" : 0,
    "owner" : {
      "account_id" : 6841559,
      "reputation" : 63,
      "user_id" : 5261779,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/20efb45f1b7bd27664f79cf8dee045df?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Fidelis",
      "link" : "https://stackoverflow.com/users/5261779/fidelis"
    },
    "creation_date" : 1748116514,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140455833,
    "post_id" : 79637008,
    "body" : "I don&#39;t currently have a debugger setup, and will need some time to figure that out. However, the logs are printing, so there isn&#39;t a way I can think of that would involve this code not being run. While I&#39;m happy to start investigating getting a debugger working, since I want to get that feature anyway, I can&#39;t see that being relevant here. Whether there is some other issue going on preventing data from properly showing even when it is run, I couldn&#39;t say.",
    "score" : 0,
    "owner" : {
      "account_id" : 6841559,
      "reputation" : 63,
      "user_id" : 5261779,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/20efb45f1b7bd27664f79cf8dee045df?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Fidelis",
      "link" : "https://stackoverflow.com/users/5261779/fidelis"
    },
    "creation_date" : 1748109433,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140455816,
    "post_id" : 79637008,
    "body" : "Try to use a debugger, to see if your code is called.",
    "score" : 0,
    "owner" : {
      "account_id" : 4470050,
      "reputation" : 69587,
      "user_id" : 3636601,
      "user_type" : "registered",
      "accept_rate" : 75,
      "profile_image" : "https://www.gravatar.com/avatar/e46b43f329f0228186fb75d496316d33?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jens",
      "link" : "https://stackoverflow.com/users/3636601/jens"
    },
    "creation_date" : 1748108824,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140455810,
    "post_id" : 79637008,
    "body" : "Also I&#39;m not sure why getSize value is missing, that is part of the mystery to me.",
    "score" : 0,
    "owner" : {
      "account_id" : 6841559,
      "reputation" : 63,
      "user_id" : 5261779,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/20efb45f1b7bd27664f79cf8dee045df?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Fidelis",
      "link" : "https://stackoverflow.com/users/5261779/fidelis"
    },
    "creation_date" : 1748108693,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140455801,
    "post_id" : 79637008,
    "body" : "@Jens I have added TestDto to the post.",
    "score" : 0,
    "owner" : {
      "account_id" : 6841559,
      "reputation" : 63,
      "user_id" : 5261779,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/20efb45f1b7bd27664f79cf8dee045df?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Fidelis",
      "link" : "https://stackoverflow.com/users/5261779/fidelis"
    },
    "creation_date" : 1748108441,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140455794,
    "post_id" : 79637008,
    "body" : "Share TestDto. If test is empty you will get an exception in test.get(0). Also in the output of getSize() the value is missing. So you are sure that the code and the output fits.",
    "score" : 0,
    "owner" : {
      "account_id" : 4470050,
      "reputation" : 69587,
      "user_id" : 3636601,
      "user_type" : "registered",
      "accept_rate" : 75,
      "profile_image" : "https://www.gravatar.com/avatar/e46b43f329f0228186fb75d496316d33?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jens",
      "link" : "https://stackoverflow.com/users/3636601/jens"
    },
    "creation_date" : 1748108162,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79637063" : [ {
      "comment_id" : 140456063,
      "post_id" : 79637063,
      "body" : "Finally, now that CORS is working on a basic level, I will want to go back and see if I can get basic logon authentication to work. That was failing previously, but maybe it was related to just the basic CORS configuration. I suspect I&#39;m going to be beating my head against the wall on that again, but we will see.",
      "score" : 0,
      "owner" : {
        "account_id" : 6841559,
        "reputation" : 63,
        "user_id" : 5261779,
        "user_type" : "registered",
        "accept_rate" : 67,
        "profile_image" : "https://www.gravatar.com/avatar/20efb45f1b7bd27664f79cf8dee045df?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Fidelis",
        "link" : "https://stackoverflow.com/users/5261779/fidelis"
      },
      "creation_date" : 1748117484,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140456061,
      "post_id" : 79637063,
      "body" : "Second comment is a thank you on catching the detail about @RequiredArgsConstructor. I will be using non null and much more involved annotations later after my skeleton tests. I didn&#39;t actually realize that regarding the requiredArgs, but will note it going forward for relevant Dtos.",
      "score" : 0,
      "owner" : {
        "account_id" : 6841559,
        "reputation" : 63,
        "user_id" : 5261779,
        "user_type" : "registered",
        "accept_rate" : 67,
        "profile_image" : "https://www.gravatar.com/avatar/20efb45f1b7bd27664f79cf8dee045df?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Fidelis",
        "link" : "https://stackoverflow.com/users/5261779/fidelis"
      },
      "creation_date" : 1748117384,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140456055,
      "post_id" : 79637063,
      "body" : "This worked! I&#39;m getting data back. I will mark this as the solution, but would like to understand where I went wrong first. I actually had this method in previously, with minor changes like using .addAllowedMethod instead of setAllowedMethods. This is much better to do it all in one line. However, for the addAllowedOrigin I used &quot;*&quot; instead of localhost. Shouldn&#39;t the * have worked? The other project this is built from uses the * just for the use of development to enable a separate frontend compile like I&#39;m doing here.",
      "score" : 0,
      "owner" : {
        "account_id" : 6841559,
        "reputation" : 63,
        "user_id" : 5261779,
        "user_type" : "registered",
        "accept_rate" : 67,
        "profile_image" : "https://www.gravatar.com/avatar/20efb45f1b7bd27664f79cf8dee045df?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Fidelis",
        "link" : "https://stackoverflow.com/users/5261779/fidelis"
      },
      "creation_date" : 1748117256,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}