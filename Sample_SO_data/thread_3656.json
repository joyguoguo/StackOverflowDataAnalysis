{
  "question" : {
    "question_id" : 79533725,
    "title" : "Spring Boot `ApplicationContextRunner` loads `Lazy` defined beans",
    "body" : "<p>In the following configuration bean example,</p>\n<pre><code>@Configuration\npublic class LazyConfig\n{\n    @Bean\n    @Lazy\n    public SomeBean someBean(final DependencyBean dependencyBean)\n    {\n        return new SomeBean(dependencyBean);\n    }\n}\n</code></pre>\n<p>I expected the following test using <code>ApplicationContextRunner</code> should be working, but it fails:</p>\n<pre><code>class LazyConfigTest\n{\n  ApplicationContextRunner runner = new ApplicationContextRunner()\n    .withUserConfiguration(LazyConfig.class);\n\n  @Test\n  void testNoLazyIsLoaded()\n  {\n    runner.run(context -&gt; {\n      org.assertj.core.api.Assertions.assertThat(context).getBeanNames(SomeBean.class).isEmpty();\n            // &gt; Expecting empty but was: [&quot;someBean&quot;]\n      org.assertj.core.api.Assertions.assertThat(context).doesNotHaveBean(SomeBean.class);\n            // &gt; Expecting not to have, but found: &lt;[&quot;someBean&quot;]&gt;\n    });\n  }\n}\n</code></pre>\n<p><strong>But</strong> then trying to get the bean itself fails for depedant,</p>\n<pre><code>context.getBean(SomeBean.class);\n// &gt; Error creating bean with name 'someBean' defined in org.lucasvc.lazy.config.LazyConfig: Unsatisfied dependency expressed through method 'someBean' parameter 0: No qualifying bean of type 'org.lucasvc.lazy.DependencyBean' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}\n</code></pre>\n<p>It is expected that there is such &quot;beans&quot; in the context, even annotated method with <code>Lazy</code>?\nHow should be the best way to test the <code>Lazy</code> behavior?</p>\n",
    "tags" : [ "java", "spring", "spring-boot", "spring-boot-test" ],
    "owner" : {
      "account_id" : 1108575,
      "reputation" : 850,
      "user_id" : 1099452,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/69e321e94f46f17553b046865f0401f3?s=256&d=identicon&r=PG",
      "display_name" : "lucasvc",
      "link" : "https://stackoverflow.com/users/1099452/lucasvc"
    },
    "is_answered" : true,
    "view_count" : 82,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1742924924,
    "creation_date" : 1742907018,
    "link" : "https://stackoverflow.com/questions/79533725/spring-boot-applicationcontextrunner-loads-lazy-defined-beans",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79534482,
    "question_id" : 79533725,
    "body" : "<p>You have to consider how <code>@Lazy</code> beans work in Spring.  If I have a class LazyBeanA that is marked as <code>@Lazy</code>, and I declare a class NotLazyB that autowires LazyBeanA does that negate LazyBeanA's laziness?  No, it doesn't.  But how does it construct NotLazyB if it's &quot;eager&quot; if not all properties can be satisfied?  It can't satisfy the LazyBeanA autowire because it's lazy.  Well, Spring gets around that by instantiating a proxy that sits in front of LazyBeanA.  LazyBeanA isn't constructed, but the Proxy is.  The proxy is a &quot;stunt&quot; bean.  It's stands in for LazyBeanA until you invoke a method on it.  At that point it constructs LazyBeanA, populates it's dependencies, and invokes the method.</p>\n<p>So there is something registered under that bean's class/id.  It's just the stunt bean.</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 51881,
      "reputation" : 39410,
      "user_id" : 155020,
      "user_type" : "registered",
      "accept_rate" : 80,
      "profile_image" : "https://i.sstatic.net/fEqVo.png?s=256",
      "display_name" : "chubbsondubs",
      "link" : "https://stackoverflow.com/users/155020/chubbsondubs"
    },
    "creation_date" : 1742924924,
    "last_activity_date" : 1742924924,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140264875,
    "post_id" : 79533725,
    "body" : "Always forgot about Spring proxy injection. Thanks.",
    "score" : 0,
    "owner" : {
      "account_id" : 1108575,
      "reputation" : 850,
      "user_id" : 1099452,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/69e321e94f46f17553b046865f0401f3?s=256&d=identicon&r=PG",
      "display_name" : "lucasvc",
      "link" : "https://stackoverflow.com/users/1099452/lucasvc"
    },
    "creation_date" : 1742985362,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140260918,
    "post_id" : 79533725,
    "body" : "Of course the bean names will be there as the definition of the bean is there. You marked it <code>@Lazy</code> so your bean will be there but it will be a proxy which will be used instead of your actual bean (which will be deferred until there is some action on it). Which is what you see when you try to get the bean as the dependent bean isn&#39;t there and thus it fails to actually construct it.",
    "score" : 4,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126800,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1742907503,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79534482" : [ {
      "comment_id" : 140264880,
      "post_id" : 79534482,
      "body" : "Always forgot about Spring proxy injection. Thanks.",
      "score" : 0,
      "owner" : {
        "account_id" : 1108575,
        "reputation" : 850,
        "user_id" : 1099452,
        "user_type" : "registered",
        "accept_rate" : 100,
        "profile_image" : "https://www.gravatar.com/avatar/69e321e94f46f17553b046865f0401f3?s=256&d=identicon&r=PG",
        "display_name" : "lucasvc",
        "link" : "https://stackoverflow.com/users/1099452/lucasvc"
      },
      "creation_date" : 1742985399,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}