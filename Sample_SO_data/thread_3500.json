{
  "question" : {
    "question_id" : 79545704,
    "title" : "Using GRPC + Springboot, the GRPC plugin is not able to autogenerate the Streaming request object",
    "body" : "<p>I am using the new Springboot starter from <code>org.springframework.boot</code> (more details below) and I am able to use it to make a simple GRPC API to return Hello world. Now I was trying to upgrade the same program to support streaming HTTP 2 request but when I try to build my project which eventually autogenerates the models is not building the Request models.</p>\n<p>Code exerpts (shortened code wherever I can, code is bootstrapped from Spring intializer.)</p>\n<p><strong>build.gradle</strong></p>\n<pre class=\"lang-none prettyprint-override\"><code>plugins {\n    id 'java'\n    id 'org.springframework.boot' version '3.4.4'\n    id 'io.spring.dependency-management' version '1.1.7'\n    id 'com.google.protobuf' version '0.9.4'\n}\n\nrepositories {\n    mavenCentral()\n}\n\next {\n    set('springGrpcVersion', &quot;0.4.0&quot;)\n}\n\ndependencies {\n    implementation 'io.grpc:grpc-services'\n    implementation 'org.springframework.grpc:spring-grpc-spring-boot-starter'\n    testImplementation 'org.springframework.boot:spring-boot-starter-test'\n    testImplementation 'org.springframework.grpc:spring-grpc-test'\n    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'\n    implementation 'io.grpc:grpc-netty-shaded'\n    modules {\n        module(&quot;io.grpc:grpc-netty&quot;) {\n            replacedBy(&quot;io.grpc:grpc-netty-shaded&quot;, &quot;Use Netty shaded instead of regular Netty&quot;)\n        }\n    }\n}\n\ndependencyManagement {\n    imports {\n        mavenBom &quot;org.springframework.grpc:spring-grpc-dependencies:${springGrpcVersion}&quot;\n    }\n}\n\nprotobuf {\n    protoc {\n        artifact = 'com.google.protobuf:protoc'\n    }\n    plugins {\n        grpc {\n            artifact = 'io.grpc:protoc-gen-grpc-java'\n        }\n    }\n    generateProtoTasks {\n        all()*.plugins {\n            grpc {\n                option 'jakarta_omit'\n                option '@generated=omit'\n            }\n        }\n    }\n}\n\n// ...\n</code></pre>\n<p><strong>Hello World.proto</strong></p>\n<pre class=\"lang-proto prettyprint-override\"><code>syntax = &quot;proto3&quot;;\n\noption java_package = &quot;com.asr.example.grpc.demo.model&quot;;\noption java_multiple_files = true;\n\nmessage HelloWorldRequest {\n    optional string name = 1;\n}\n\nmessage HelloWorldResponse {\n    string greeting = 1;\n}\n\nservice HelloWorldService {\n    rpc sayHello(stream HelloWorldRequest) returns (stream HelloWorldResponse);\n}\n</code></pre>\n<p><strong>HelloWorldController.java</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>import com.asr.example.grpc.demo.model.HelloWorldRequest;\nimport com.asr.example.grpc.demo.model.HelloWorldResponse;\nimport com.asr.example.grpc.demo.model.HelloWorldServiceGrpc;\nimport io.grpc.stub.StreamObserver;\nimport org.springframework.grpc.server.service.GrpcService;\nimport org.springframework.util.StringUtils;\n\nimport java.text.MessageFormat;\n\n@GrpcService\npublic class HelloWorldController extends HelloWorldServiceGrpc.HelloWorldServiceImplBase {\n\n    @Override\n    public StreamObserver&lt;HelloWorldRequest&gt; sayHello(StreamObserver&lt;HelloWorldResponse&gt; responseObserver) {\n        return super.sayHello(responseObserver);\n    }\n    \n    /* Expected:\n    public StreamObserver&lt;HelloWorldResponse&gt; sayHello(HelloWorldRequest request, StreamObserver&lt;HelloWorldResponse&gt; responseObserver) {\n        // Further Implementation\n    }\n     */\n\n    // Original without streaming\n    // @Override\n    public void sayHello(\n            HelloWorldRequest request,\n            StreamObserver&lt;HelloWorldResponse&gt; responseObserver) {\n        responseObserver\n                .onNext(HelloWorldResponse.newBuilder()\n                        .setGreeting(MessageFormat.format(\n                                &quot;Hello {0}!!!&quot;,\n                                StringUtils.hasText(request.getName()) ? request.getName() : &quot;Arvind&quot;)\n                        )\n                        .build()\n                );\n        responseObserver\n                .onCompleted();\n    }\n}\n</code></pre>\n<p>Code explanation:</p>\n<ol>\n<li>Bootstrapped code from Spring Initializr.</li>\n<li>Added Protobuf specs without <code>stream</code> keyword.</li>\n<li>Implemented the generated controller using the original method.</li>\n<li>Works fine.</li>\n<li>Added <code>stream</code> keyword as prefix in HelloWorld request in Protobuf spec.</li>\n<li>Expected generated code is a bit different from what I expected, and unable to find a way to fetch the request.</li>\n</ol>\n<p>Questions:</p>\n<ol>\n<li>I believe feature is still experimental , is this the reason this is not working ?</li>\n<li>I have seen similar dependency from <a href=\"https://mvnrepository.com/artifact/io.github.lognet/grpc-spring-boot-starter\" rel=\"nofollow noreferrer\"><code>io.github.lognet</code></a> and <a href=\"https://mvnrepository.com/artifact/net.devh/grpc-spring-boot-starter\" rel=\"nofollow noreferrer\"><code>net.devh</code></a>, are any of these 2 viable alternatives for LTS ?</li>\n</ol>\n",
    "tags" : [ "java", "spring-boot", "grpc", "grpc-java", "spring-boot-3" ],
    "owner" : {
      "account_id" : 14819652,
      "reputation" : 53,
      "user_id" : 10702431,
      "user_type" : "registered",
      "profile_image" : "https://graph.facebook.com/2110766185919974/picture?type=large",
      "display_name" : "Arvind Singh Rawat",
      "link" : "https://stackoverflow.com/users/10702431/arvind-singh-rawat"
    },
    "is_answered" : true,
    "view_count" : 164,
    "answer_count" : 3,
    "score" : 0,
    "last_activity_date" : 1745153793,
    "creation_date" : 1743406402,
    "link" : "https://stackoverflow.com/questions/79545704/using-grpc-springboot-the-grpc-plugin-is-not-able-to-autogenerate-the-streami",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79550080,
    "question_id" : 79545704,
    "body" : "<p>Let's read <code>REAMDE.md</code> of Spring gRPC repository carefully</p>\n<blockquote>\n<p>Now you can implement a service <strong>based on the generated stubs</strong>:</p>\n</blockquote>\n<p>Source <a href=\"https://github.com/spring-projects-experimental/spring-grpc\" rel=\"nofollow noreferrer\">https://github.com/spring-projects-experimental/spring-grpc</a> .</p>\n<p>Use this tool and guide for generate Java stubs for Java gRPC client <a href=\"https://grpc.io/docs/languages/java/generated-code/\" rel=\"nofollow noreferrer\">https://grpc.io/docs/languages/java/generated-code/</a></p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 4597208,
      "reputation" : 1,
      "user_id" : 3728901,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://www.gravatar.com/avatar/8621a1f0563a46ea809098b960d7923f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Vy Do",
      "link" : "https://stackoverflow.com/users/3728901/vy-do"
    },
    "creation_date" : 1743582157,
    "last_activity_date" : 1743582157,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79560333,
    "question_id" : 79545704,
    "body" : "<p>For the service definition you have in the proto</p>\n<pre><code>service HelloWorldService {\n    rpc sayHello(stream HelloWorldRequest) returns (stream HelloWorldResponse);\n}\n</code></pre>\n<p>the generated service code of</p>\n<pre><code>@Override\n    public StreamObserver&lt;HelloWorldRequest&gt; sayHello(StreamObserver&lt;HelloWorldResponse&gt; responseObserver) {\n        return super.sayHello(responseObserver);\n    }\n</code></pre>\n<p>is exactly how it should be. For streaming request, the server impl should return its implementation of <em>StreamObserver&lt;HelloWorldRequest&gt;</em> so that when requests arrive, the framework can call  its <em>onNext</em> with the <em>HelloWorldRequest.</em></p>\n<p>You can see an example <a href=\"https://github.com/grpc/grpc-java/blob/aae52de3b8fee34dfc548d36d802cbb07af0c2b6/examples/src/main/java/io/grpc/examples/cancellation/CancellationServer.java#L93\" rel=\"nofollow noreferrer\">here</a>.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 218143,
      "reputation" : 225,
      "user_id" : 474323,
      "user_type" : "registered",
      "accept_rate" : 39,
      "profile_image" : "https://www.gravatar.com/avatar/851b7fa17e397da1ccbd23071404e749?s=256&d=identicon&r=PG",
      "display_name" : "Kannan J",
      "link" : "https://stackoverflow.com/users/474323/kannan-j"
    },
    "creation_date" : 1744041698,
    "last_activity_date" : 1744041698,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79583372,
    "question_id" : 79545704,
    "body" : "<p>Hey @Kannan J and @Vy Do</p>\n<p>Thanks for your answers, but for clarifications for newbies like me. Getting into more details.</p>\n<p>Yes, as @Kannan J mentioned, the created stub for <code>HelloWorldService.sayHello</code> is expected as it is mentioned in question. The parameter for HelloWorldResponse can be considered as a Consumer of the response <em>(Drawing analogy from Java 8's Consumer methods)</em> which needs to be consuming the response which needs to be sent back to the client. Whereas, Request is also a consumer <em>(again, the same Java 8's Consumer method's analogy)</em> here will be called once a <code>HelloWorldRequest</code> is received, so we need to define what needs to be done by implementing and returning that.</p>\n<p>Here's the sample implementation of the same:</p>\n<pre><code>    @Override\n    public StreamObserver&lt;HelloWorldRequest&gt; sayHello(StreamObserver&lt;HelloWorldResponse&gt; responseObserver) {\n\n        return new StreamObserver&lt;&gt;() {\n            @Override\n            public void onNext(HelloWorldRequest helloWorldRequest) {\n                String name = helloWorldRequest.getName();\n                String greeting = null;\n                if (StringUtils.hasText(name)) {\n                    if (!name.startsWith(&quot;Hello&quot;))\n                        greeting = &quot;Hello &quot; + name;\n                } else {\n                    greeting = &quot;Hello World&quot;;\n                }\n                if (StringUtils.hasText(name)) {\n                    HelloWorldResponse response = HelloWorldResponse.newBuilder()\n                            .setGreeting(greeting)\n                            .build();\n                    responseObserver.onNext(response);\n                }\n            }\n\n            @Override\n            public void onError(Throwable throwable) {\n                // Handle error\n                log.error(&quot;Error occurred: {}&quot;, throwable.getMessage(), throwable);\n                responseObserver.onError(throwable);\n            }\n\n            @Override\n            public void onCompleted() {\n                // Complete the response\n                log.info(&quot;Request completed&quot;);\n                HelloWorldResponse response = HelloWorldResponse.newBuilder()\n                        .setGreeting(&quot;Quitting chat , Thank you&quot;)\n                        .build();\n                responseObserver.onNext(response);\n                responseObserver.onCompleted();\n            }\n        };\n    }\n</code></pre>\n<p>Here, I am creating a new StreamObserver for the request , which tells what to do with the incoming messages (since, it is a stream there could be more than one, like a P2P chat). <code>onNext</code> tells what to do when a message is received, which can be used using the parameter provided for the same. <code>onError</code> when something breaks, and finally <code>onCompleted</code> when a streaming connection is closed. Within these methods <code>responseObserver</code> for sending messages (or emitting messages, analogy from Reactor streams) back to the client.</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 14819652,
      "reputation" : 53,
      "user_id" : 10702431,
      "user_type" : "registered",
      "profile_image" : "https://graph.facebook.com/2110766185919974/picture?type=large",
      "display_name" : "Arvind Singh Rawat",
      "link" : "https://stackoverflow.com/users/10702431/arvind-singh-rawat"
    },
    "creation_date" : 1745153793,
    "last_activity_date" : 1745153793,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140281702,
    "post_id" : 79545704,
    "body" : "You are right. spring grpc starter is experimental and may not be ready for production.",
    "score" : 0,
    "owner" : {
      "account_id" : 29231405,
      "reputation" : 163,
      "user_id" : 22395035,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f29a6c01cf0e794be1f7eba72fa48149?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "kush parsaniya",
      "link" : "https://stackoverflow.com/users/22395035/kush-parsaniya"
    },
    "creation_date" : 1743413772,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79560333" : [ {
      "comment_id" : 140323697,
      "post_id" : 79560333,
      "body" : "How can I access request from the said object ? Using <code>responseObserver</code>&#39;s <code>onNext()</code> method , that seems wrong  Let&#39;s say I need username from one of the fields from HelloWorldRequest and pass that on to HelloWorldResponse , how would I do that ?",
      "score" : 0,
      "owner" : {
        "account_id" : 14819652,
        "reputation" : 53,
        "user_id" : 10702431,
        "user_type" : "registered",
        "profile_image" : "https://graph.facebook.com/2110766185919974/picture?type=large",
        "display_name" : "Arvind Singh Rawat",
        "link" : "https://stackoverflow.com/users/10702431/arvind-singh-rawat"
      },
      "creation_date" : 1744360854,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}