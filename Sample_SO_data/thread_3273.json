{
  "question" : {
    "question_id" : 79560202,
    "title" : "How to add a new method and method call using ast-grep in Java code",
    "body" : "<p>I'm working with ast-grep and trying to modify Java code by adding a new method at the end of the class (not necessarily at end, it can be anywhere in class )and inserting a method call. Despite several attempts, I haven't been able to figure out the correct approach.</p>\n<p>Here's what I'm trying to achieve:</p>\n<ol>\n<li>Add required imports in the import section of the class.</li>\n</ol>\n<pre><code>import com.company.package.agent.OverBuilder;\nimport com.company.package.agent.config.OverApplication;\nimport com.company.package.agent.config.OverGroup;\nimport com.company.package.agent.OverNoOpImpl;\n</code></pre>\n<ol start=\"2\">\n<li>In the method containing <code>SpecificClassName.initialize(arg1, arg2, arg3);</code>  line, After this line, add a new line to call method <code>initOverAgent();</code></li>\n</ol>\n<pre><code>SpecificClassName.initialize(arg1, arg2, arg3);\ninitOverAgent();\n</code></pre>\n<ol start=\"3\">\n<li>Declare <code>initOverAgent</code> method in the class.</li>\n</ol>\n<p><strong>Notes:</strong></p>\n<ol>\n<li><p>The class can be a simple class, or it can be extending some class or implementing an interface, e.g.:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Log4j2\npublic class StoneModule implements Module {\n</code></pre>\n<p>or</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Log4j2\npublic final class FitnessReportTool {\n</code></pre>\n<p>or</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class ConfigModule extends AbstractModule {\n</code></pre>\n</li>\n<li><p>The class can have some, none, or many annotations like:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Module\n@Log4j2\n</code></pre>\n</li>\n<li><p>If <code>SpecificClassName.initialize(arg1, arg2, arg3);</code> line is within a static method, the declaration of <code>initOverAgent</code> should be static; otherwise, it should be non-static.</p>\n</li>\n</ol>\n<p>Here's an example of the original class and the desired output:</p>\n<p><strong>Original class:</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.company.package;\n\nimport com.google.inject.Injector;\nimport org.slf4j.Logger;\n\npublic class Remapter {\n    public static void main(String[] args) throws Throwable {\n        ...\n    }\n    private static synchronized void stopServer(BobcatServer server) {\n        ...\n    }\n    private static void initSpecificClassName(String[] args3) throws InterruptedException \n    {\n        ...someCode\n        SpecificClassName.initialize(arg1, arg2, arg3);\n        ...someCode\n    }\n}\n</code></pre>\n<p><strong>Desired output:</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.company.package;\n\nimport com.google.inject.Injector;\nimport org.slf4j.Logger;\nimport com.company.package.agent.OverBuilder;\nimport com.company.package.agent.config.OverApplication;\nimport com.company.package.agent.config.OverGroup;\nimport com.company.package.agent.OverNoOpImpl;\n\npublic class Remapter {\n    public static void main(String[] args) throws Throwable {\n        ...\n    }\n    private static synchronized void stopServer(BobcatServer server) {\n        ...\n    }\n    private static void initSpecificClassName(String[] args3) throws InterruptedException \n    {\n        ...someCode\n        SpecificClassName.initialize(arg1, arg2, arg3);\n        initOverAgent();\n        ...someCode\n    }  \n    public static void initOverAgent() {\n        if (!staticCondition) {\n            new OverNoOpImpl().start();\n        }\n        new OverBuilder()\n            .withOverGroup(new OverGroup().withName(NAME)\n            .withOverApplication(new OverApplication().withApplicationName(APP_NAME)\n            .build().start();\n    }\n}\n</code></pre>\n<p>I've tried using some YAML configuration, but I'm not able to satisfy all my required conditions.</p>\n<pre><code>id: declareOverAgent\nlanguage: java\nrule:\n  kind: class_declaration\n  pattern: |\n    @$A\n    public class $CLASS {\n      $$$CLASS_BODY\n    }\nfix: |-\n  @$A\n  public class $CLASS {\n    $$$CLASS_BODY\n    public static void initOverAgent() {\n        if (!staticCondition) {\n            new OverNoOpImpl().start();\n        }\n        new OverBuilder()\n            .withOverGroup(new OverGroup().withName(NAME)\n            .withOverApplication(new OverApplication().withApplicationName(APP_NAME)\n            .build().start();\n    }\n  }\n---\nid: initializeOverAgent\nlanguage: java\nrule:\n  kind: expression_statement\n  pattern: SpecificClassName.initialize(arg1, arg2, arg3);\nfix: |-\n  SpecificClassName.initialize(arg1, arg2, arg3);\n  initializeCloudCoverJavaAgent();\n</code></pre>\n<p>I've been looking through the ast-grep documentation but haven't found a clear way to achieve this. Could someone please help me with how to add new method in the class and the method call ?</p>\n<p>Any help or guidance would be greatly appreciated!</p>\n",
    "tags" : [ "java", "abstract-syntax-tree", "ast-grep" ],
    "owner" : {
      "account_id" : 19360476,
      "reputation" : 77,
      "user_id" : 14155821,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/bab8f2023a39bf77935c6bfbf0a82b7f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "bazzinga",
      "link" : "https://stackoverflow.com/users/14155821/bazzinga"
    },
    "is_answered" : false,
    "view_count" : 100,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1744038148,
    "creation_date" : 1744037707,
    "link" : "https://stackoverflow.com/questions/79560202/how-to-add-a-new-method-and-method-call-using-ast-grep-in-java-code",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}