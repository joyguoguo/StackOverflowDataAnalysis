{
  "question" : {
    "question_id" : 79634099,
    "title" : "Spring HTTP/2 Support with RestClient",
    "body" : "<p>I am refactoring my code to use <a href=\"https://docs.spring.io/spring-framework/reference/integration/rest-clients.html#rest-restclient\" rel=\"nofollow noreferrer\">RestClient</a> for calling upstream services. These services support HTTP/2. What do I need to do (if anything) to configure RestClient to use HTTP/2?</p>\n<p>For example, if I was using the java native HttpClient I would:</p>\n<pre><code>HttpClient.newBuilder()\n      .version(Version.HTTP_2)\n      .build();\n</code></pre>\n",
    "tags" : [ "java", "spring", "http2", "spring-restclient" ],
    "owner" : {
      "account_id" : 92537,
      "reputation" : 7017,
      "user_id" : 253575,
      "user_type" : "registered",
      "accept_rate" : 83,
      "profile_image" : "https://www.gravatar.com/avatar/41e91e4c9bd6752c7de05055717fc0a8?s=256&d=identicon&r=PG",
      "display_name" : "IcedDante",
      "link" : "https://stackoverflow.com/users/253575/iceddante"
    },
    "is_answered" : true,
    "view_count" : 716,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1748355286,
    "creation_date" : 1747928553,
    "link" : "https://stackoverflow.com/questions/79634099/spring-http-2-support-with-restclient",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79634191,
    "question_id" : 79634099,
    "body" : "<p>If you're referring to the <strong><a href=\"https://docs.spring.io/spring-framework/reference/integration/rest-clients.html#rest-restclient\" rel=\"nofollow noreferrer\">Spring's new RestClient</a></strong> (introduced in Spring Framework 6 / Spring Boot 3). You can use <strong><a href=\"https://hc.apache.org/httpcomponents-client-5.5.x/migration-guide/migration-to-async-http2.html\" rel=\"nofollow noreferrer\">Apache HttpClient v5</a></strong> (specifically 5.1+), which does support HTTP/2.</p>\n<pre><code>import org.apache.hc.client5.http.impl.async.CloseableHttpAsyncClient\nimport org.apache.hc.client5.http.impl.async.HttpAsyncClients\nimport org.apache.hc.client5.http.ssl.SSLConnectionSocketFactoryBuilder\nimport org.apache.hc.core5.http2.HttpVersionPolicy\nimport org.apache.hc.core5.reactor.IOReactorConfig\nimport org.springframework.http.client.HttpComponentsAsyncClientHttpRequestFactory\nimport org.springframework.web.client.RestClient\n\nval httpClient: CloseableHttpAsyncClient = HttpAsyncClients.custom()\n    .setIOReactorConfig(IOReactorConfig.custom().build())\n    .setVersionPolicy(HttpVersionPolicy.NEGOTIATE) // Enables HTTP/2 with fallback to HTTP/1.1\n    .build()\n\nhttpClient.start()\n\nval requestFactory = HttpComponentsAsyncClientHttpRequestFactory(httpClient)\n\nval restClient = RestClient.builder()\n    .requestFactory(requestFactory)\n    .baseUrl(&quot;https://example.com&quot;)\n    .build()\n</code></pre>\n<p>Maven Dependencies</p>\n<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.httpcomponents.client5&lt;/groupId&gt;\n    &lt;artifactId&gt;httpclient5&lt;/artifactId&gt;\n    &lt;version&gt;5.2.1&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.httpcomponents.core5&lt;/groupId&gt;\n    &lt;artifactId&gt;httpcore5&lt;/artifactId&gt;\n    &lt;version&gt;5.2.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>You can also configure the HTTP/2 when using <a href=\"https://docs.spring.io/spring-framework/reference/web/webflux-webclient/client-builder.html\" rel=\"nofollow noreferrer\">WebClient</a></p>\n<pre><code>import reactor.netty.http.HttpProtocol;\nimport reactor.netty.http.client.HttpClient;\nimport org.springframework.http.client.reactive.ReactorClientHttpConnector;\nimport org.springframework.web.reactive.function.client.WebClient;\n\n\nHttpClient client = HttpClient.create()\n            .protocol(HttpProtocol.H2);\n\nWebClient webClient = WebClient.builder()\n            .clientConnector(new ReactorClientHttpConnector(client))\n            .build();\n</code></pre>\n<p>If using <code>RestTemplate</code>, it's important to note that it might use an older HTTP client implementation that may not fully support HTTP/2. Consider switching to <code>WebClient</code> for more robust HTTP/2 support.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 13798611,
      "reputation" : 40443,
      "user_id" : 9959152,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/QZ0Cl.png?s=256",
      "display_name" : "Ryuzaki L",
      "link" : "https://stackoverflow.com/users/9959152/ryuzaki-l"
    },
    "creation_date" : 1747931818,
    "last_activity_date" : 1748355286,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79634191" : [ {
      "comment_id" : 140463672,
      "post_id" : 79634191,
      "body" : "Thanks L. I am aware that there are many HTTP Clients that support this protocol. My question really is specific to Spring RestClient and nothing else.",
      "score" : 0,
      "owner" : {
        "account_id" : 92537,
        "reputation" : 7017,
        "user_id" : 253575,
        "user_type" : "registered",
        "accept_rate" : 83,
        "profile_image" : "https://www.gravatar.com/avatar/41e91e4c9bd6752c7de05055717fc0a8?s=256&d=identicon&r=PG",
        "display_name" : "IcedDante",
        "link" : "https://stackoverflow.com/users/253575/iceddante"
      },
      "creation_date" : 1748371541,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140462829,
      "post_id" : 79634191,
      "body" : "try my updated answer @IcedDante",
      "score" : 0,
      "owner" : {
        "account_id" : 13798611,
        "reputation" : 40443,
        "user_id" : 9959152,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/QZ0Cl.png?s=256",
        "display_name" : "Ryuzaki L",
        "link" : "https://stackoverflow.com/users/9959152/ryuzaki-l"
      },
      "creation_date" : 1748355302,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140460461,
      "post_id" : 79634191,
      "body" : "the great L should know that, from a reading of the question, I am not using WebClient nor RestTemplate. Perhaps you have relinquished ownership of this question and forgot what you were answering?",
      "score" : 0,
      "owner" : {
        "account_id" : 92537,
        "reputation" : 7017,
        "user_id" : 253575,
        "user_type" : "registered",
        "accept_rate" : 83,
        "profile_image" : "https://www.gravatar.com/avatar/41e91e4c9bd6752c7de05055717fc0a8?s=256&d=identicon&r=PG",
        "display_name" : "IcedDante",
        "link" : "https://stackoverflow.com/users/253575/iceddante"
      },
      "creation_date" : 1748283614,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}