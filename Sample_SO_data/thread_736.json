{
  "question" : {
    "question_id" : 79777797,
    "title" : "How to prevent N+1 queries in Spring",
    "body" : "<p>Could you please help me with how to avoid N+1 queries in Spring?</p>\n<p>For example, I have the following two entities:</p>\n<pre><code>@ManyToOne(fetch = FetchType.EAGER)\n@JoinColumn(name=&quot;CourseID&quot;)\nprivate CourseEntity courses;\n\n@OneToMany(mappedBy = &quot;courses&quot;, fetch = FetchType.LAZY)\nprivate Set&lt;CourseModules&gt; courseModules = new HashSet&lt;&gt;();\n</code></pre>\n<p>When I perform queries in the JpaRepository for either of these entities, I encounter the N+1 query problem, which significantly impacts query performance. Currently, I have to use native queries to fetch the objects from these entities.</p>\n<p>Does anyone know a way to avoid N+1 queries without using native queries? Thank you very much!</p>\n",
    "tags" : [ "java", "spring-boot", "spring-data-jpa" ],
    "owner" : {
      "account_id" : 34586094,
      "reputation" : 33,
      "user_id" : 26649163,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3d2e758751d51b78950b736fee609eb8?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Dma_Dugn",
      "link" : "https://stackoverflow.com/users/26649163/dma-dugn"
    },
    "is_answered" : true,
    "view_count" : 252,
    "answer_count" : 2,
    "score" : 1,
    "last_activity_date" : 1761667838,
    "creation_date" : 1759127294,
    "link" : "https://stackoverflow.com/questions/79777797/how-to-prevent-n1-queries-in-spring",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79790662,
    "question_id" : 79777797,
    "body" : "<p><code>@BatchSize</code> is a Hibernate-specific annotation that optimizes the N+1 query problem by fetching lazy-loaded associations in batches rather than one at a time, then you can optimize as:</p>\n<pre><code>@OneToMany(mappedBy = &quot;courses&quot;, fetch = FetchType.LAZY)\n@BatchSize(size = 25) \nprivate Set&lt;CourseModules&gt; courseModules = new HashSet&lt;&gt;();\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 25532911,
      "reputation" : 11,
      "user_id" : 19320575,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14Gi6NnQFVNYhL9y5lcfi3mtCYhGOrmDBKdlintCgoGQ=k-s256",
      "display_name" : "Alvaro Montesinos",
      "link" : "https://stackoverflow.com/users/19320575/alvaro-montesinos"
    },
    "creation_date" : 1760479978,
    "last_activity_date" : 1760479978,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79803048,
    "question_id" : 79777797,
    "body" : "<p>If you are doing simple joins in the native query, JPQL might be enough for retrieving the data without the <code>N+1</code> issue in most cases.</p>\n<p>From my experience with JPA and SQL, anything can be achieve with JPQL, with some configurations, even using native database functions as part of the JPQL syntax.</p>\n<p>Depending on your needs, you might also set everything as <code>FetchType.LAZY</code> and create specific JPQL queries in the jpa repository to load the entity alongside the desired dependencies, e.g <code>getParentWithCourses</code> or <code>getParentWithCourseModules</code>.</p>\n<p>For the <code>OneToMany</code> relationships there is no way as such to prevent the <code>N+1</code> problem when loading multiple records for the parent entity since it is a cartesian product. Hence my advice is to define the relationship on the <code>Many</code> side and avoid doing bidirectional relationships if possible.</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 7673258,
      "reputation" : 2114,
      "user_id" : 6200354,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/1afc8346f23819373b78aae36744b53a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "atish.s",
      "link" : "https://stackoverflow.com/users/6200354/atish-s"
    },
    "creation_date" : 1761667838,
    "last_activity_date" : 1761667838,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140788244,
    "post_id" : 79777797,
    "body" : "Maybe use a <a href=\"https://thorben-janssen.com/hibernate-tips-difference-join-left-join-fetch-join/\" rel=\"nofollow noreferrer\"><code>JOIN FETCH</code></a> in the query to force the provider to fetch the entities in a single query? Eclipselink also has a dedicated annotation (<a href=\"https://eclipse.dev/eclipselink/documentation/2.4/jpa/extensions/a_joinfetch.htm\" rel=\"nofollow noreferrer\"><code>JoinFetch</code></a>) to force join fetch on entity load without JPQL.",
    "score" : 4,
    "owner" : {
      "account_id" : 6349534,
      "reputation" : 3145,
      "user_id" : 4929038,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c4e51f11f5d5dd52d5a0544b3161ae32?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "kidney",
      "link" : "https://stackoverflow.com/users/4929038/kidney"
    },
    "creation_date" : 1760096542,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}