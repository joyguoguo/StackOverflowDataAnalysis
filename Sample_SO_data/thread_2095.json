{
  "question" : {
    "question_id" : 79647740,
    "title" : "How can we make @TenantId as part of composite primary key in spring boot jpa",
    "body" : "<p>I have a multi tenants LMS application. I have <code>Academy</code> entity which will act as tenant in my LMS. Every other entity will have <code>academy_id</code> column.</p>\n<p>Using discriminator based multi tenancy feature of hibernate.</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Entity\n@Data\npublic class Academy implements Serializable {\n  @Id private long id;\n\n  @Column(nullable = false)\n  private String name;\n\n  @Column(nullable = false, unique = true)\n  private String domain;\n\n  @Column(nullable = false)\n  private boolean isActive;\n\n  @Column(nullable = false)\n  private long features;\n\n  @Column(nullable = false, updatable = false)\n  private ZonedDateTime createdAt;\n\n  @Column(nullable = false)\n  @Version\n  private ZonedDateTime lastModified;\n\n  @PrePersist\n  protected void setCreatedAt() {\n    createdAt = ZonedDateTime.now();\n  }\n}\n\n</code></pre>\n<p>I have another entity, <code>AcademyUser</code>.</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Entity\n@Data\n@SuperBuilder\n@NoArgsConstructor\n@AllArgsConstructor\n@Table(uniqueConstraints = {@UniqueConstraint(columnNames = {&quot;academy_id&quot;, &quot;email&quot;})})\npublic class AcademyUser extends EntityBase {\n  @EmbeddedId private AcademyUserKey key;\n\n  @Column(nullable = false)\n  @Enumerated(EnumType.STRING)\n  private UserType userType;\n\n  private PhoneNumber phoneNumber;\n\n  @Column(nullable = false)\n  private String firstName;\n\n  @Column(nullable = false)\n  private String lastName;\n\n  @Column(nullable = false)\n  private boolean isBlocked;\n\n  @Column(nullable = false)\n  private short roles;\n}\n\n\n// AcademyUserKey.java\n@Data\n@Builder\n@Embeddable\n@NoArgsConstructor\n@AllArgsConstructor\npublic class AcademyUserKey implements Serializable {\n  @TenantId\n  @Column(name = &quot;academy_id&quot;) // Map to your database column\n  private long academyId;\n\n  @Column(name = &quot;user_email&quot;)\n  private String email;\n}\n</code></pre>\n<p>I am getting the following error</p>\n<pre class=\"lang-java prettyprint-override\"><code>Failed to initialize JPA EntityManagerFactory: Property 'org.w3worker.academy.api_server.academy_user.models.AcademyUser.key.academy' is annotated 'interface org.hibernate.annotations.TenantId' which is not an '@IdGeneratorType'\n</code></pre>\n<p>In sort, unable to use <code>@TenantId</code> as part of the primary key. Is there any solution?</p>\n",
    "tags" : [ "java", "spring", "hibernate", "jpa" ],
    "owner" : {
      "account_id" : 20145110,
      "reputation" : 2661,
      "user_id" : 14773830,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0861f2f909daf9ccff91d8c10e0547c8?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Rahul",
      "link" : "https://stackoverflow.com/users/14773830/rahul"
    },
    "is_answered" : true,
    "view_count" : 65,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1749707312,
    "creation_date" : 1748796415,
    "link" : "https://stackoverflow.com/questions/79647740/how-can-we-make-tenantid-as-part-of-composite-primary-key-in-spring-boot-jpa",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79662978,
    "question_id" : 79647740,
    "body" : "<p>Do NOT map relationships inside <code>@Embeddable</code> classes. (Only primitive types are allowed there.)</p>\n<p>To use tenantId as a part of the primary key, update the code as below.</p>\n<pre><code>@Data\n@Builder\n@Embeddable\n@NoArgsConstructor\n@AllArgsConstructor\npublic class AcademyUserKey implements Serializable {\n  \n  @Column(name = &quot;academy_id&quot;)\n  private long academyId;\n\n  @Column(name = &quot;user_email&quot;)\n  private String email;\n}\n\n\n@Entity\n@Data\n@SuperBuilder\n@NoArgsConstructor\n@AllArgsConstructor\n@Table(uniqueConstraints = {@UniqueConstraint(columnNames = {&quot;academy_id&quot;, &quot;email&quot;})})\npublic class AcademyUser extends EntityBase {\n  \n  @EmbeddedId \n  private AcademyUserKey key;\n\n  @ManyToOne\n  @MapsId(&quot;academyId&quot;)\n  @JoinColumn(name = &quot;academy_id&quot;)\n  private Academy academy;\n    \n  ...\n}\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 31253438,
      "reputation" : 26,
      "user_id" : 24060368,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/85d2d00e4685a1dc2152c6506304acb7?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Ankit Bhimani",
      "link" : "https://stackoverflow.com/users/24060368/ankit-bhimani"
    },
    "creation_date" : 1749707312,
    "last_activity_date" : 1749707312,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}