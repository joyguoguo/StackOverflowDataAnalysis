{
  "question" : {
    "question_id" : 79604252,
    "title" : "Issue with pyflink api code for inserting data into sql",
    "body" : "<p>I use the following development environment.</p>\n<ul>\n<li>Flink : 2.0</li>\n<li>MySQL : 8.0.4</li>\n<li>JDK : 17.0.2</li>\n</ul>\n<p>And I develop python flink API code, which inserts a simple data into MySQL.</p>\n<pre class=\"lang-python prettyprint-override\"><code>from pyflink.common import Types\nfrom pyflink.datastream import StreamExecutionEnvironment\nfrom pyflink.datastream.connectors.jdbc import JdbcConnectionOptions, JdbcExecutionOptions, JdbcSink\nfrom pyflink.datastream.stream_execution_environment import RuntimeExecutionMode\n\nenv = StreamExecutionEnvironment.get_execution_environment()\nenv.set_runtime_mode(RuntimeExecutionMode.STREAMING)\nenv.set_parallelism(1)\n\nenv.add_jars('file:///Users/joseph/Downloads/flink-connector-jdbc-core-4.0.0-2.0.jar',\n             'file:///Users/joseph/Downloads/flink-connector-jdbc-mysql-4.0.0-2.0.jar',\n             'file:///Users/joseph/Downloads/mysql-connector-j-8.4.0.jar')\n\ntype_info = Types.ROW([Types.STRING(), Types.INT()])\nds = env.from_collection([('GM', 300), ('Volvo', 400)], type_info=type_info)\n\ninsert_sql = 'insert into Car (brand, price) values (?, ?)'\n\njdbc_exe_option = JdbcExecutionOptions.builder() \\\n                .with_batch_interval_ms(1000) \\\n                .with_batch_size(200) \\\n                .with_max_retries(5) \\\n                .build()\n\njdbc_conn_option = JdbcConnectionOptions.JdbcConnectionOptionsBuilder() \\\n                   .with_url('jdbc:mysql://localhost:3306/etlmysql') \\\n                   .with_driver_name('com.mysql.cj.jdbc.Driver') \\\n                   .with_user_name('root') \\\n                   .with_password('p@$$w0rd') \\\n                   .build()\n\nsink = JdbcSink.sink(insert_sql, type_info, jdbc_conn_option, jdbc_exe_option)\n\nds.add_sink(sink)\n\nenv.execute()\nenv.close()\n</code></pre>\n<p>But the error message are thrown from <code>JdbcSink.sink</code> line.</p>\n<pre class=\"lang-none prettyprint-override\"><code>File &quot;c:\\VSCode_Workspace\\flink-python\\com\\aaa\\flink\\flink-jdbc-test.py&quot;, line 32, in &lt;module&gt;\n    sink = JdbcSink.sink(insert_sql, type_info, jdbc_conn_option, jdbc_exe_option)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File &quot;C:\\VSCode_Workspace\\.venv-etl\\Lib\\site-packages\\pyflink\\datastream\\connectors\\jdbc.py&quot;, line 60, in sink\n    j_builder_method = output_format_clz.getDeclaredMethod('createRowJdbcStatementBuilder',\n                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File &quot;C:\\VSCode_Workspace\\.venv-etl\\Lib\\site-packages\\py4j\\java_gateway.py&quot;, line 1322, in __call__\n    return_value = get_return_value(\n                   ^^^^^^^^^^^^^^^^^\n  File &quot;C:\\VSCode_Workspace\\.venv-etl\\Lib\\site-packages\\pyflink\\util\\exceptions.py&quot;, line 162, in deco\n    return f(*a, **kw)\n           ^^^^^^^^^^^\n  File &quot;C:\\VSCode_Workspace\\.venv-etl\\Lib\\site-packages\\py4j\\protocol.py&quot;, line 326, in get_return_value\n    raise Py4JJavaError(\npy4j.protocol.Py4JJavaError: An error occurred while calling o71.getDeclaredMethod.\n: java.lang.NoSuchMethodException: org.apache.flink.connector.jdbc.internal.JdbcOutputFormat.createRowJdbcStatementBuilder([I)\n        at java.base/java.lang.Class.getDeclaredMethod(Class.java:2675)\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)      \n        at java.base/java.lang.reflect.Method.invoke(Method.java:568)\n</code></pre>\n<p>For your information, I attach Java code of the same flink MySQL connector.</p>\n<pre class=\"lang-java prettyprint-override\"><code>JdbcExecutionOptions jdbcExeOption = JdbcExecutionOptions.builder()\n        .withBatchSize(1000)\n        .withBatchIntervalMs(200)\n        .withMaxRetries(5)\n        .build();\n                \nJdbcConnectionOptions jdbcConnOption = new JdbcConnectionOptions.JdbcConnectionOptionsBuilder()\n        .withUrl(&quot;jdbc:mysql://localhost:3306/etlmysql&quot;)\n        .withDriverName(&quot;com.mysql.cj.jdbc.Driver&quot;)\n        .withUsername(&quot;root&quot;)\n        .withPassword(&quot;p@$$w0rd&quot;)\n        .build();\n        \nJdbcSink&lt;Car&gt; jdbcSink = new JdbcSinkBuilder&lt;Car&gt;()\n        .withQueryStatement(\n                &quot;INSERT INTO car VALUES(?,?)&quot;,\n                (statement, car) -&gt; {\n                        statement.setString(1, car.getBrand());\n                        statement.setInt(2, car.getPrice());\n                })\n        .withExecutionOptions(jdbcExeOption)\n        .buildAtLeastOnce(jdbcConnOption);\n               \n        \nstream.sinkTo(jdbcSink);\n</code></pre>\n<p>As you see, java <code>JdbcSink</code> connector class has different shape from python <code>JdbcSink</code> connector. In Java code, <code>jdbcSink</code> object is generated from <code>JdbcSinkBuilder</code> class, but in python it is not. I think these errors are due to API version mismatch. Any idea to solve these errors?</p>\n",
    "tags" : [ "python", "java", "apache-flink", "flink-streaming", "pyflink" ],
    "owner" : {
      "account_id" : 4750876,
      "reputation" : 1433,
      "user_id" : 3840940,
      "user_type" : "registered",
      "accept_rate" : 87,
      "profile_image" : "https://www.gravatar.com/avatar/7e5771bd6b1b6e5786cfabde2b242ea5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Joseph Hwang",
      "link" : "https://stackoverflow.com/users/3840940/joseph-hwang"
    },
    "is_answered" : false,
    "view_count" : 157,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1746269775,
    "creation_date" : 1746230267,
    "link" : "https://stackoverflow.com/questions/79604252/issue-with-pyflink-api-code-for-inserting-data-into-sql",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140707975,
    "post_id" : 79604252,
    "body" : "Someone kindly inform me when the next version of flink-connector-jdbc-core will be released.",
    "score" : 0,
    "owner" : {
      "account_id" : 4750876,
      "reputation" : 1433,
      "user_id" : 3840940,
      "user_type" : "registered",
      "accept_rate" : 87,
      "profile_image" : "https://www.gravatar.com/avatar/7e5771bd6b1b6e5786cfabde2b242ea5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Joseph Hwang",
      "link" : "https://stackoverflow.com/users/3840940/joseph-hwang"
    },
    "creation_date" : 1756772604,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}