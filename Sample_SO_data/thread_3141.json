{
  "question" : {
    "question_id" : 79569495,
    "title" : "Docker on WSL2 bind mounted files are created as folder",
    "body" : "<p>I'm trying to write integration tests for my java application using testcontainers (version 1.20.6). I'm working on a windows (<strong>without Docker Desktop on windows, I cannot use it</strong>).</p>\n<p>I want to test my api which is connected to an opensearch api. I need in my test to start a new instance of opensearch, populate the data, and connect my api to this new instance of opensearch.</p>\n<p>I made a configuration to start a container which has multiple services (opensearch, opensearch-dashboards, init-index which create one index in opensearch and populates it), my init-index service is configured as follow:</p>\n<pre><code>  init-index:\n    image: curlimages/curl:latest\n    depends_on:\n      opensearch:\n        condition: service_healthy\n    volumes:\n      - ./data/:/data/\n      - ./init-index.sh:/init-index.sh\n    entrypoint: [ &quot;sh&quot;, &quot;/init-index.sh&quot; ]\n</code></pre>\n<p>When starting the container from wsl2, I encounter no problem, the files are copied to the container, the init-index.sh is executed and my opensearch is populated correctly. The problem comes when I try to do the same process but from running my testcontainers.</p>\n<p>When using a GenericContainer from testcontainers, I can the option withCopyFileToContainer (which simply copy a file to the container) works correctly, but the problem comes when I try to use ComposeContainer which take a yaml file as input of its constructor, the problem is that the init-index service (which is configured the same as above) does have data copied as directory instead of files.</p>\n<p><a href=\"https://i.sstatic.net/3GrMNbql.png\" rel=\"nofollow noreferrer\">init-index service ls -la /</a></p>\n<p>I'm really confused as I read that if docker cannot find the source file/folder, it will still create an empty directory in the targetted path, but we can see in the screen that ls -la /data display 2 directories countries.json and idx-geo-countries.json which are the 2 files in my project/src/test/resources/data folder.</p>\n<p>Note that for debugging reason, I changed the entrypoint configured above to: entrypoint: [ &quot;sh&quot;, &quot;-c&quot;, &quot;sh /init-index.sh &amp;&amp; sleep 300&quot; ]\nin order to check what is going on inside the container. My project is located in my windows filesystem, I'm using intellij from windows also.</p>\n<p>My test looks like below:</p>\n<pre><code>public class MyTest {\n    @Rule\n    public ComposeContainer composeContainer = new ComposeContainer(new File(&quot;src/test/resources/compose.yaml&quot;))\n            .withExposedService(&quot;opensearch&quot;, 9200);\n\n    @Test\n    public void testing() {\n        //Putting a debug here to check what is going on in the containers\n        ...\n    }\n}\n</code></pre>\n",
    "tags" : [ "java", "docker", "docker-compose", "testcontainers", "wsl2" ],
    "owner" : {
      "account_id" : 20011229,
      "reputation" : 11,
      "user_id" : 14668200,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-WBP0UvMJbkU/AAAAAAAAAAI/AAAAAAAAAAA/AMZuuclO7V8OVlXzs4ccxDqLctj1n3vJ_A/s96-c/s256-rj/photo.jpg",
      "display_name" : "Sun864",
      "link" : "https://stackoverflow.com/users/14668200/sun864"
    },
    "is_answered" : false,
    "view_count" : 49,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1744395582,
    "creation_date" : 1744395582,
    "link" : "https://stackoverflow.com/questions/79569495/docker-on-wsl2-bind-mounted-files-are-created-as-folder",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}