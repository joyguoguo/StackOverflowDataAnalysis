{
  "question" : {
    "question_id" : 79720723,
    "title" : "Aerospike Batch Write In Single IOPS",
    "body" : "<p>As title says, i have a springboot service which writes to single Aerospike server node with around 180k TPS;</p>\n<p>I found out that even when im doing batch writes, it only helps with reducing connections, for example, i batches every 10k records;</p>\n<p>A batch contains 10k records will be counted as single connection to server, but on server, it does 10k write operations;</p>\n<p>I tested this by writing with smaller TPS (45k) and the IOPS is reaching 100%;</p>\n<p>I cannot ask about scaling the server, the higher up cannot spend or provisioning anymore;</p>\n<p>Currently i'm doing stupid workaround by &quot;bucketing&quot; a batch into 1 bucket record; So, a bucket record will have a bin containing 10k List of records in JSON;</p>\n<p>This is working, the iops is below 8% now but the downstream application will do extra works;</p>\n<p>Are there any better idea to write batch records but minimizing iops?</p>\n",
    "tags" : [ "java", "aerospike" ],
    "owner" : {
      "account_id" : 543997,
      "reputation" : 352,
      "user_id" : 913297,
      "user_type" : "registered",
      "accept_rate" : 56,
      "profile_image" : "https://www.gravatar.com/avatar/9333e3c2233cde71f6e7c040761d5a5f?s=256&d=identicon&r=PG",
      "display_name" : "Lynx777",
      "link" : "https://stackoverflow.com/users/913297/lynx777"
    },
    "is_answered" : true,
    "view_count" : 60,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1753977885,
    "creation_date" : 1753930991,
    "link" : "https://stackoverflow.com/questions/79720723/aerospike-batch-write-in-single-iops",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79720833,
    "question_id" : 79720723,
    "body" : "<p>You are correct that the batch API is mainly to reduce network overhead of doing individual reads/writes. The individual writes are handled pretty much the same on the database server side, whether doing individual writes or batching them, as you seem to have figured out already.</p>\n<p>But the writes themselves don't each generate a drive write IOPS on the server side (the records are aggregated and flushed at the <a href=\"https://aerospike.com/docs/database/reference/config#namespace__flush-size\" rel=\"nofollow noreferrer\"><code>flush-size</code></a> or <a href=\"https://aerospike.com/docs/database/reference/config#namespace__write-block-size\" rel=\"nofollow noreferrer\"><code>write-block-size</code></a> -- depending on the version). They would generate a read IOPS if the records are updated, though. There may be a way to optimize that if possible depending on your use case (whether using 'replace' in lieu of update or other potential adjustments based on your configuration -- such as whether the PK is stored or there are secondary indices defined).</p>\n<p>Having said that, bucketing multiple application records into a single record is not necessarily a bad idea at all. It will also reduce the index footprint. But make sure to then leverage the Aerospike's native <a href=\"https://aerospike.com/docs/develop/data-types/collections/\" rel=\"nofollow noreferrer\">CDT types</a> (List and Maps) so you can have the server side do operations on them and offload from the application.</p>\n",
    "score" : 2,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 355705,
      "reputation" : 2994,
      "user_id" : 4147181,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/CIuNh.jpg?s=256",
      "display_name" : "Meher",
      "link" : "https://stackoverflow.com/users/4147181/meher"
    },
    "creation_date" : 1753941063,
    "last_activity_date" : 1753941063,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79720894,
    "question_id" : 79720723,
    "body" : "<p>Bucketing helps depending on data access pattern. If you are writing once and then only reading later, its fine. But if you bucket 10K records into a single Aerospike record, and then need to update one of those records, as suggested in above answer, use CDT data type, say using map k:v pair as each bucketed record, so you can update the specific key value map pair that pertains to that application record. If you do your own custom bucketing then you need a strategy to retain the other unchanged records in the bucket when you want to update one or few only.  IOPs wise, any update would entail reading the whole 10K bucket from disc and rewriting it to a new location on disc, regardless.  Also, you lose ability to expire the application records individually.  The aggregated record gets the &quot;time-to-live&quot; which quite likely you will set as &quot;live-forever&quot;.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 2163589,
      "reputation" : 5475,
      "user_id" : 1917187,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/115760c69c4f709ccf66ec14e08882b2?s=256&d=identicon&r=PG",
      "display_name" : "pgupta",
      "link" : "https://stackoverflow.com/users/1917187/pgupta"
    },
    "creation_date" : 1753944779,
    "last_activity_date" : 1753977885,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}