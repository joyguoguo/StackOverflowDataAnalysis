{
  "question" : {
    "question_id" : 79595421,
    "title" : "Ehcache Not Working with Hibernate Second-Level Cache",
    "body" : "<p>I'm working on a maven application using Hibernate and Ehcache for second-level caching. Despite configuring Ehcache, the cache doesn't seem to be working as expected. Every time I query the database, the data is fetched from the database instead of the cache. Here are the details of my setup:</p>\n<p>hibernate.cfg.xml:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;!DOCTYPE hibernate-configuration PUBLIC\n        &quot;-//Hibernate/Hibernate Configuration DTD 3.0//EN&quot;\n        &quot;http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd&quot;&gt;\n&lt;hibernate-configuration&gt;\n    &lt;session-factory&gt;\n        &lt;property name=&quot;hibernate.connection.driver_class&quot;&gt;com.mysql.cj.jdbc.Driver&lt;/property&gt;\n        &lt;property name=&quot;hibernate.connection.password&quot;&gt;root&lt;/property&gt;\n        &lt;property name=&quot;hibernate.connection.url&quot;&gt;jdbc:mysql://127.0.0.1:3306/testdatabase&lt;/property&gt;\n        &lt;property name=&quot;hibernate.connection.username&quot;&gt;root&lt;/property&gt;\n        &lt;property name=&quot;hibernate.dialect&quot;&gt;org.hibernate.dialect.MySQL8Dialect&lt;/property&gt;\n        &lt;property name=&quot;hibernate.hbm2ddl.auto&quot;&gt;validate&lt;/property&gt;\n        &lt;property name=&quot;hibernate.show_sql&quot;&gt;true&lt;/property&gt;\n        &lt;property name=&quot;hibernate.cache.use_second_level_cache&quot;&gt;true&lt;/property&gt;\n        &lt;property name=&quot;hibernate.cache.use_query_cache&quot;&gt;true&lt;/property&gt;\n        &lt;property name=&quot;hibernate.cache.region.factory_class&quot;&gt;org.hibernate.cache.ehcache.EhCacheRegionFactory&lt;/property&gt;\n\n    &lt;/session-factory&gt;\n&lt;/hibernate-configuration&gt;\n</code></pre>\n<p>Entity class:-</p>\n<pre><code>package com.ankit.maven_hibn8.model.one2one.bidirectional;\n\nimport javax.persistence.Cacheable;\nimport javax.persistence.Column;\nimport javax.persistence.Entity;\nimport javax.persistence.GeneratedValue;\nimport javax.persistence.GenerationType;\nimport javax.persistence.Id;\nimport javax.persistence.OneToOne;\nimport javax.persistence.Table;\n\nimport org.hibernate.annotations.Cache;\nimport org.hibernate.annotations.CacheConcurrencyStrategy;\n\n@Entity(name = &quot;address_ent&quot;)\n@Table(name = &quot;address_table&quot;)\npublic class AddressClass {\n    @Id\n    @Column(name = &quot;addressqw_id&quot;)\n    public int id;\n    public String street;\n    public String city;\n    public String state;\n\n    @OneToOne(mappedBy = &quot;addressret&quot;, cascade = javax.persistence.CascadeType.ALL)\n    public Employee employee;\n\n    public Employee getEmployee() {\n        return employee;\n    }\n\n    public void setEmployee(Employee employee) {\n        this.employee = employee;\n    }\n\n    public int getId() {\n        return id;\n    }\n\n    public void setId(int id) {\n        this.id = id;\n    }\n\n    public String country;\n\n    public String getStreet() {\n        return street;\n    }\n\n    public void setStreet(String street) {\n        this.street = street;\n    }\n\n    public String getCity() {\n        return city;\n    }\n\n    public void setCity(String city) {\n        this.city = city;\n    }\n\n    public String getState() {\n        return state;\n    }\n\n    public void setState(String state) {\n        this.state = state;\n    }\n\n    public String getCountry() {\n        return country;\n    }\n\n    public void setCountry(String country) {\n        this.country = country;\n    }\n\n}\n</code></pre>\n<p>Employee Entity class:-</p>\n<pre><code>package com.ankit.maven_hibn8.model.one2one.bidirectional;\n\nimport javax.persistence.Cacheable;\nimport javax.persistence.CascadeType;\nimport javax.persistence.Entity;\nimport javax.persistence.GeneratedValue;\nimport javax.persistence.GenerationType;\nimport javax.persistence.Id;\nimport javax.persistence.JoinColumn;\nimport javax.persistence.OneToOne;\n\nimport org.hibernate.annotations.Cache;\nimport org.hibernate.annotations.CacheConcurrencyStrategy;\n\n@Entity\n@Cacheable()\n@Cache(usage = CacheConcurrencyStrategy.READ_WRITE)\npublic class Employee {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.SEQUENCE)\n    public int id;\n    public String name;\n    public String email;\n    public String phone;\n\n    @OneToOne(cascade = CascadeType.ALL)\n    public AddressClass addressret;\n\n    public AddressClass getAddress() {\n        return addressret;\n    }\n\n    public void setAddress(AddressClass address) {\n        this.addressret = address;\n    }\n\n    public int getId() {\n        return id;\n    }\n\n    public void setId(int id) {\n        this.id = id;\n    }\n\n    public String getName() {\n        return name;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    public String getEmail() {\n        return email;\n    }\n\n    public void setEmail(String email) {\n        this.email = email;\n    }\n\n    public String getPhone() {\n        return phone;\n    }\n\n    public void setPhone(String phone) {\n        this.phone = phone;\n    }\n\n}\n</code></pre>\n<p>App.java:-</p>\n<pre><code>package com.ankit.maven_hibn8;\n\nimport org.hibernate.Session;\nimport org.hibernate.SessionFactory;\nimport org.hibernate.Transaction;\nimport org.hibernate.cfg.Configuration;\n\n//import com.ankit.maven_hibn8.model.many2many.unibi.*;\nimport com.ankit.maven_hibn8.model.one2one.bidirectional.*;\n\n/**\n * Hello world!\n *\n */\npublic class App {\n    public static void main(String[] args) {\n        System.out.println(&quot;Hello World!&quot;);\n\n        SessionFactory sf = new Configuration().configure(&quot;hibernate.cfg.xml&quot;).addAnnotatedClass(AddressClass.class)\n                .addAnnotatedClass(Employee.class).buildSessionFactory();\n\n        Session s = sf.openSession();\n        Transaction t = s.beginTransaction();\n//      oneToOneDataPush(s);\n        oneToOneDataGetUnidirectional(s);\n        t.commit();\n        s.close();\n\n        Session s2 = sf.openSession();\n        Transaction t2 = s2.beginTransaction();\n        oneToOneDataGetUnidirectional(s2);\n        t2.commit();\n//      t.commit();\n        s2.close();\n    }\n\n    public static void oneToOneDataPush(Session s) {\n        Employee e = new Employee();\n        e.setId(1);\n        e.setName(&quot;Test&quot;);\n        e.setEmail(&quot;atb@gmail.com&quot;);\n        e.setPhone(&quot;1234567890&quot;);\n        AddressClass a = new AddressClass();\n        a.setStreet(&quot;123 Main St&quot;);\n        a.setCity(&quot;New York&quot;);\n        a.setState(&quot;NY&quot;);\n        e.setAddress(a);\n        s.save(e);\n    }\n\n    public static void oneToOneDataGetUnidirectional(Session s) {\n        Employee e = (Employee) s.get(Employee.class, 1);\n        System.out.println(&quot;Employee Name: &quot; + e.getName());\n        System.out.println(&quot;Employee Email: &quot; + e.getEmail());\n        System.out.println(&quot;Employee Phone: &quot; + e.getPhone());\n    }\n}\n</code></pre>\n<p>POM.xml:</p>\n<pre><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;\n    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n\n    &lt;groupId&gt;com.ankit&lt;/groupId&gt;\n    &lt;artifactId&gt;maven-hibn8-caching&lt;/artifactId&gt;\n    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n    &lt;packaging&gt;jar&lt;/packaging&gt;\n\n    &lt;name&gt;maven-hibn8&lt;/name&gt;\n    &lt;url&gt;http://maven.apache.org&lt;/url&gt;\n\n    &lt;properties&gt;\n        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;\n    &lt;/properties&gt;\n\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;junit&lt;/groupId&gt;\n            &lt;artifactId&gt;junit&lt;/artifactId&gt;\n            &lt;version&gt;3.8.1&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.hibernate&lt;/groupId&gt;\n            &lt;artifactId&gt;hibernate-core&lt;/artifactId&gt;\n            &lt;version&gt;5.6.13.Final&lt;/version&gt;\n            &lt;scope&gt;provided&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.mysql&lt;/groupId&gt;\n            &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;\n            &lt;version&gt;8.2.0&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-core&lt;/artifactId&gt;\n            &lt;version&gt;5.3.38&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.ehcache&lt;/groupId&gt;\n            &lt;artifactId&gt;ehcache&lt;/artifactId&gt;\n            &lt;version&gt;3.8.1&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.hibernate&lt;/groupId&gt;\n            &lt;artifactId&gt;hibernate-ehcache&lt;/artifactId&gt;\n            &lt;version&gt;5.6.13.Final&lt;/version&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n&lt;/project&gt;\n</code></pre>\n<p>Despite the above configuration, the cache files are created but remain empty, and data is always fetched from the database. There are no errors in the logs, but I see warnings about missing caches being created on-the-fly and read-only caching for mutable entities.</p>\n<p>Logs in console:-</p>\n<pre><code>Hello World!\nApr 28, 2025 1:00:50 AM org.hibernate.Version logVersion\nINFO: HHH000412: Hibernate ORM core version 5.6.13.Final\nApr 28, 2025 1:00:51 AM org.hibernate.cache.ehcache.internal.EhcacheRegionFactory &lt;init&gt;\nWARN: HHH020100: The Ehcache second-level cache provider for Hibernate is deprecated.  See https://hibernate.atlassian.net/browse/HHH-12441 for details.\nApr 28, 2025 1:00:51 AM org.hibernate.annotations.common.reflection.java.JavaReflectionManager &lt;clinit&gt;\nINFO: HCANN000001: Hibernate Commons Annotations {5.1.2.Final}\nApr 28, 2025 1:00:52 AM org.hibernate.engine.jdbc.connections.internal.DriverManagerConnectionProviderImpl configure\nWARN: HHH10001002: Using Hibernate built-in connection pool (not for production use!)\nApr 28, 2025 1:00:52 AM org.hibernate.engine.jdbc.connections.internal.DriverManagerConnectionProviderImpl buildCreator\nINFO: HHH10001005: using driver [com.mysql.cj.jdbc.Driver] at URL [jdbc:mysql://127.0.0.1:3306/testdatabase]\nApr 28, 2025 1:00:52 AM org.hibernate.engine.jdbc.connections.internal.DriverManagerConnectionProviderImpl buildCreator\nINFO: HHH10001001: Connection properties: {user=root, password=****}\nApr 28, 2025 1:00:52 AM org.hibernate.engine.jdbc.connections.internal.DriverManagerConnectionProviderImpl buildCreator\nINFO: HHH10001003: Autocommit mode: false\nApr 28, 2025 1:00:52 AM org.hibernate.engine.jdbc.connections.internal.DriverManagerConnectionProviderImpl$PooledConnections &lt;init&gt;\nINFO: HHH000115: Hibernate connection pool size: 20 (min=1)\nApr 28, 2025 1:00:53 AM org.hibernate.dialect.Dialect &lt;init&gt;\nINFO: HHH000400: Using dialect: org.hibernate.dialect.MySQL8Dialect\nSLF4J: Failed to load class &quot;org.slf4j.impl.StaticLoggerBinder&quot;.\nSLF4J: Defaulting to no-operation (NOP) logger implementation\nSLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.\nApr 28, 2025 1:00:54 AM org.hibernate.cache.ehcache.internal.EhcacheRegionFactory createCache\nWARN: HHH90001006: Missing cache[default-update-timestamps-region] was created on-the-fly. The created cache will use a provider-specific default configuration: make sure you defined one. You can disable this warning by setting 'hibernate.cache.ehcache.missing_cache_strategy' to 'create'.\nApr 28, 2025 1:00:54 AM org.hibernate.cache.ehcache.internal.EhcacheRegionFactory createCache\nWARN: HHH90001006: Missing cache[default-query-results-region] was created on-the-fly. The created cache will use a provider-specific default configuration: make sure you defined one. You can disable this warning by setting 'hibernate.cache.ehcache.missing_cache_strategy' to 'create'.\nApr 28, 2025 1:00:54 AM org.hibernate.cache.ehcache.internal.EhcacheRegionFactory createCache\nWARN: HHH90001006: Missing cache[com.ankit.maven_hibn8.model.one2one.bidirectional.Employee] was created on-the-fly. The created cache will use a provider-specific default configuration: make sure you defined one. You can disable this warning by setting 'hibernate.cache.ehcache.missing_cache_strategy' to 'create'.\nApr 28, 2025 1:00:54 AM org.hibernate.cache.ehcache.internal.EhcacheRegionFactory createCache\nWARN: HHH90001006: Missing cache[com.ankit.maven_hibn8.model.one2one.bidirectional.AddressClass] was created on-the-fly. The created cache will use a provider-specific default configuration: make sure you defined one. You can disable this warning by setting 'hibernate.cache.ehcache.missing_cache_strategy' to 'create'.\nApr 28, 2025 1:00:55 AM org.hibernate.resource.transaction.backend.jdbc.internal.DdlTransactionIsolatorNonJtaImpl getIsolatedConnection\nINFO: HHH10001501: Connection obtained from JdbcConnectionAccess [org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator$ConnectionProviderJdbcConnectionAccess@7df76d99] for (non-JTA) DDL execution was not in auto-commit mode; the Connection 'local transaction' will be committed and the Connection will be set into auto-commit mode.\nApr 28, 2025 1:00:55 AM org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator initiateService\nINFO: HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]\nHibernate: select employee0_.id as id1_1_0_, employee0_.addressret_addressqw_id as addressr5_1_0_, employee0_.email as email2_1_0_, employee0_.name as name3_1_0_, employee0_.phone as phone4_1_0_, addresscla1_.addressqw_id as addressq1_0_1_, addresscla1_.city as city2_0_1_, addresscla1_.country as country3_0_1_, addresscla1_.state as state4_0_1_, addresscla1_.street as street5_0_1_ from Employee employee0_ left outer join address_table addresscla1_ on employee0_.addressret_addressqw_id=addresscla1_.addressqw_id where employee0_.id=?\nEmployee Name: Test\nEmployee Email: atb@gmail.com\nEmployee Phone: 1234567890\nHibernate: select employee0_.id as id1_1_1_, employee0_.addressret_addressqw_id as addressr5_1_1_, employee0_.email as email2_1_1_, employee0_.name as name3_1_1_, employee0_.phone as phone4_1_1_, addresscla1_.addressqw_id as addressq1_0_0_, addresscla1_.city as city2_0_0_, addresscla1_.country as country3_0_0_, addresscla1_.state as state4_0_0_, addresscla1_.street as street5_0_0_ from Employee employee0_ left outer join address_table addresscla1_ on employee0_.addressret_addressqw_id=addresscla1_.addressqw_id where employee0_.addressret_addressqw_id=?\nEmployee Name: Test\nEmployee Email: atb@gmail.com\nEmployee Phone: 1234567890\n</code></pre>\n",
    "tags" : [ "java", "spring", "hibernate", "jpa", "ehcache" ],
    "owner" : {
      "account_id" : 18719253,
      "reputation" : 89,
      "user_id" : 13647541,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/a91835baa535d0bef79b06c3f39b4d8b?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Ankit Bhardwaj",
      "link" : "https://stackoverflow.com/users/13647541/ankit-bhardwaj"
    },
    "is_answered" : false,
    "view_count" : 74,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1745782534,
    "creation_date" : 1745782534,
    "link" : "https://stackoverflow.com/questions/79595421/ehcache-not-working-with-hibernate-second-level-cache",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140393139,
    "post_id" : 79595421,
    "body" : "I tried using ehcache 2. But result is still same. Still 2 calls are going on.  POM file: &lt;dependency&gt; &lt;groupId&gt;org.hibernate&lt;/groupId&gt; &lt;artifactId&gt;hibernate-core&lt;/artifactId&gt; &lt;version&gt;4.1.6.Final&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; \t\t\t&lt;groupId&gt;net.sf.ehcache&lt;/groupId&gt; \t\t\t&lt;artifactId&gt;ehcache&lt;/artifactId&gt; \t\t\t&lt;version&gt;2.8.3&lt;/version&gt; \t\t&lt;/dependency&gt;  \t\t&lt;dependency&gt; \t\t\t&lt;groupId&gt;org.hibernate&lt;/groupId&gt; \t\t\t&lt;artifactId&gt;hibernate-ehcache&lt;/artifactId&gt; \t\t\t&lt;version&gt;4.1.6.Final&lt;/version&gt; \t\t&lt;/dependency&gt;",
    "score" : 0,
    "owner" : {
      "account_id" : 18719253,
      "reputation" : 89,
      "user_id" : 13647541,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/a91835baa535d0bef79b06c3f39b4d8b?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Ankit Bhardwaj",
      "link" : "https://stackoverflow.com/users/13647541/ankit-bhardwaj"
    },
    "creation_date" : 1746293482,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140375598,
    "post_id" : 79595421,
    "body" : "EhCacheRegionFactory seems to be for ehcache 2 (end of life). You need to use jcache; here is a <a href=\"https://github.com/ben-manes/caffeine/blob/master/examples/hibernate/src/main/resources/hibernate.properties\" rel=\"nofollow noreferrer\">sample</a> you could adapt from using ehcache 3 as the provider instead. Note that itâ€™s very <a href=\"https://m.youtube.com/watch?reload=9&amp;v=lD28ApBmFeA\" rel=\"nofollow noreferrer\">slow</a>, but you can <a href=\"https://gist.github.com/ben-manes/6312727adfa2235cb7c5e25cae523ad0\" rel=\"nofollow noreferrer\">mitigate</a> to some extent.",
    "score" : 0,
    "owner" : {
      "account_id" : 10326,
      "reputation" : 9711,
      "user_id" : 19450,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/40d9bb2e8df635f2f598b7577c5b3eb9?s=256&d=identicon&r=PG",
      "display_name" : "Ben Manes",
      "link" : "https://stackoverflow.com/users/19450/ben-manes"
    },
    "creation_date" : 1745827624,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140374784,
    "post_id" : 79595421,
    "body" : "Try Ehcache 2.x version, like <code>net.sf.ehcache:ehcache:2.10.9.2</code>, also add <code>@Cacheable</code> and <code>@Cache</code> on your <code>AddressClass</code> to make second-level cache actually work.",
    "score" : 0,
    "owner" : {
      "account_id" : 7645025,
      "reputation" : 440,
      "user_id" : 5795975,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-6KwPUS4RnyA/AAAAAAAAAAI/AAAAAAAAC8w/auZqreI45x0/s256-rj/photo.jpg",
      "display_name" : "Vijay",
      "link" : "https://stackoverflow.com/users/5795975/vijay"
    },
    "creation_date" : 1745798050,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}