{
  "question" : {
    "question_id" : 79833790,
    "title" : "Firestore only updates when accessed through a specific Android activity",
    "body" : "<p>I'm working on an Android app where users can add and remove restaurants from their favourites via the RestaurantPage activity. When I access the RestaurantPage activity from the UserFavourites activity and attempt to remove the restaurant from my favourites, Firestore successfully updates, removing the restaurant from my favourites in the database. However, when I access a restaurant via the Search activity, I cannot remove the restaurant from my favourites (Firestore isn't updated when the favourite button is clicked). Here is the code for my RestaurantPage activity, UserFavourites activity, Search activity and AppManager class. I'm new to Android developing so any help would be much appreciated!</p>\n<p>RestaurantPage:</p>\n<pre><code>\n\nimport android.content.Intent;\nimport android.net.Uri;\nimport android.os.Bundle;\nimport android.util.Log;\nimport android.widget.Button;\n\nimport java.util.ArrayList;\n\n\npublic class RestaurantPage extends AppCompatActivity {\n\n    Button favourited;\n    \n    \n    \n\n   \n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        EdgeToEdge.enable(this);\n        setContentView(R.layout.menu_restaurantpage);\n        favourited = findViewById(R.id.favouriteButton);\n\n        Restaurant currRestaurant = AppManager.getCurrentRestaurant();\n        \n        ArrayList&lt;Restaurant&gt; currFavourites = AppManager.getCurrentUser().getFavourites();\n        Log.d(&quot;CURR USER&quot;, AppManager.getCurrentUser().getUsername());\n\n        int i = 0;\n        boolean flag = false;\n        while (i &lt; currFavourites.size() &amp;&amp; !flag){\n            if (currFavourites.get(i).getName().equals(currRestaurant.getName())){\n                flag = true;\n            }\n            i++;\n        }\n\n        if (flag) {\n            favourited.setText(&quot;Remove from favourites&quot;);\n        }\n        else {\n            favourited.setText(&quot;Add to favourites&quot;);\n        }\n\n\n\n        favourited.setOnClickListener((view) -&gt; {\n            ArrayList&lt;Restaurant&gt; currentFavourites = AppManager.getCurrentUser().getFavourites();\n            int j = 0;\n            boolean flag2 = false;\n            while (j &lt; currentFavourites.size() &amp;&amp; !flag2) {\n                if (currentFavourites.get(j).getName().equals(currRestaurant.getName())) {\n                    flag2 = true;\n                }\n                j++;\n            }\n\n            if (flag2) {\n                AppManager.getCurrentUser().removeFavourite(currRestaurant);\n                favourited.setText(&quot;Add to favourites&quot;);\n            }\n            else {\n                AppManager.getCurrentUser().addFavourite(currRestaurant);\n                favourited.setText(&quot;Remove from favourites&quot;);\n            }\n            AppManager.uploadUser(AppManager.getCurrentUser());\n        });\n\n        \n\n\n     \n    }\n\n\n}\n</code></pre>\n<p>UserFavourites:</p>\n<pre><code>\n\n\npublic class UserFavourites extends AppCompatActivity implements AdapterView.OnItemSelectedListener {\n\n    private FirebaseAuth authenticate;\n    private ArrayList&lt;User&gt; userList;\n\n    private User currentUser;\n\n    private SearchView favouritesBar;\n\n    private RecyclerView favouritesRecyclerView;\n\n    private SearchAdapter searchAdapter;\n\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        EdgeToEdge.enable(this);\n        setContentView(R.layout.menu_favourites);\n        authenticate = FirebaseAuth.getInstance();\n\n       \n\n        favouritesRecyclerView = findViewById(R.id.favourites_list);\n\n        favouritesRecyclerView.setItemAnimator(new DefaultItemAnimator());\n        favouritesRecyclerView.addItemDecoration(new DividerItemDecoration(this, LinearLayoutManager.VERTICAL));\n        currentUser = AppManager.getCurrentUser();\n        if (currentUser == null){\n            Log.d( &quot;USER FAIL&quot;, &quot;No user found&quot;);\n            startActivity(new Intent(UserFavourites.this, HomeScreen.class));\n            return;\n        }\n        else {\n            Log.d(&quot;USER FOUND&quot;, &quot;User found&quot;);\n        }\n\n        searchAdapter = new SearchAdapter(currentUser.getFavourites(), UserFavourites.this, new SearchAdapter.ItemClickListener() {\n            @Override\n            public void onItemClick(Restaurant restaurant) {\n                Log.d(&quot;NEWPAGE&quot;, &quot;User sent to restaurant page for &quot; + restaurant.getName());\n                AppManager.setCurrentRestaurant(restaurant);\n                startActivity(new Intent(UserFavourites.this, RestaurantPage.class));\n            }\n        });\n\n\n    }\n\n    \n\n\n}\n</code></pre>\n<p>Search:</p>\n<pre><code>public class Search extends AppCompatActivity implements AdapterView.OnItemSelectedListener {\n\n    protected ArrayList&lt;Restaurant&gt; searchList;\n    protected RecyclerView searchRecyclerView;\n    SearchAdapter searchAdapter;\n\n   \n\n    private DrawerLayout nav_layout;\n    private Toolbar nav_toolbar;\n\n    private NavigationView nav_view;\n\n    private ArrayList&lt;User&gt; userList;\n\n    private User currentUser;\n\n    private FirebaseAuth authenticate;\n\n\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        EdgeToEdge.enable(this);\n        setContentView(R.layout.menu_searchpage);\n        nav_layout = findViewById(R.id.nav_layout);\n        nav_toolbar = findViewById(R.id.nav_toolbar);\n        nav_view = findViewById(R.id.navigationView);\n        nav_view.setItemIconTintList(null);\n\n        searchRecyclerView = findViewById(R.id.search_list);\n        searchRecyclerView.setItemAnimator(new DefaultItemAnimator());\n        searchRecyclerView.addItemDecoration(new DividerItemDecoration(this, LinearLayoutManager.VERTICAL));\n        searchList = AppManager.getRestaurants();\n        authenticate = FirebaseAuth.getInstance();\n        currentUser = AppManager.getCurrentUser();\n        if (currentUser == null){\n            Log.d( &quot;USER FAIL&quot;, &quot;No user found&quot;);\n            startActivity(new Intent(Search.this, HomeScreen.class));\n            return;\n        }\n        else {\n            Log.d(&quot;USER FOUND&quot;, &quot;User found&quot;);\n            \n        }\n\n\n        searchAdapter = new SearchAdapter(searchList, Search.this, new SearchAdapter.ItemClickListener() {\n            @Override\n            public void onItemClick(Restaurant restaurant) {\n                Log.d(&quot;NEWPAGE&quot;, &quot;User sent to restaurant page for &quot; + restaurant.getName());\n                AppManager.setCurrentRestaurant(restaurant);\n                startActivity(new Intent(Search.this, RestaurantPage.class));\n\n            }\n        });\n\n       \n    }\n\n}\n</code></pre>\n<p>AppManager:</p>\n<pre><code>\n\npublic class AppManager {\n\n    private static int numOfRestaurants;\n    private static FirebaseFirestore db = FirebaseFirestore.getInstance();\n    private static ArrayList&lt;User&gt; users = new ArrayList&lt;User&gt;();\n    protected static ArrayList&lt;Restaurant&gt; restaurants = new ArrayList&lt;Restaurant&gt;();\n\n    private static Restaurant currentRestaurant;\n    private static User currentUser;\n\n\n\n\n    public static ArrayList&lt;User&gt; getUsersImmediately(){\n        return users;\n    }\n    public static ArrayList&lt;User&gt; getUsers(){\n        users.clear();\n        db.collection(&quot;users&quot;).get()\n                .addOnCompleteListener((task) -&gt; {\n                    if (task.isSuccessful()) {\n                        for (QueryDocumentSnapshot document : task.getResult()) {\n                            users.add(document.toObject(User.class));\n                            Log.d(&quot;USER ADD&quot;, &quot;Added user to user list&quot;);\n\n                        }\n                        Log.d(&quot;DOWNLOAD DB&quot;, &quot;Successfully obtained users&quot;);\n\n                    }\n                })\n                .addOnFailureListener((task) -&gt; {\n                    Log.d(&quot;DOWNLOAD DB&quot;, &quot;Failed to obtain users&quot;);\n                });\n\n        return users;\n    }\n\n\n\n\n    public static void downloadRestaurants(){\n\n        restaurants.clear();\n        db.collection(&quot;restaurants&quot;).get()\n                .addOnCompleteListener((task) -&gt; {\n                    if (task.isSuccessful()) {\n                        for (QueryDocumentSnapshot document : task.getResult()) {\n                            restaurants.add(document.toObject(Restaurant.class));\n                            Log.d(&quot;RESTAURANT ADD&quot;, &quot;Added restaurant to restaurant list&quot;);\n\n                        }\n                        Log.d(&quot;DOWNLOAD DB&quot;, &quot;Successfully downloaded restaurants&quot;);\n\n                    }\n                })\n                .addOnFailureListener((task) -&gt; {\n                    Log.d(&quot;DOWNLOAD DB&quot;, &quot;Failed to download restaurants&quot;);\n                });\n\n\n    }\n\n\n    public static void downloadUsers(){\n\n        users.clear();\n        db.collection(&quot;users&quot;).get()\n                .addOnCompleteListener((task) -&gt; {\n                    if (task.isSuccessful()) {\n                        for (QueryDocumentSnapshot document : task.getResult()) {\n                            users.add(document.toObject(User.class));\n                            Log.d(&quot;USER ADD&quot;, &quot;Added user to user list&quot;);\n\n                        }\n                        Log.d(&quot;DOWNLOAD DB&quot;, &quot;Successfully downloaded users&quot;);\n\n                    }\n                })\n                .addOnFailureListener((task) -&gt; {\n                    Log.d(&quot;DOWNLOAD DB&quot;, &quot;Failed to download users&quot;);\n                });\n\n\n    }\n\n    public static void uploadUser(User user){\n        db.collection(&quot;users&quot;).document(user.getUsername())\n                .set(user)\n                .addOnSuccessListener((task) -&gt; {\n                    Log.d(&quot;UPLOAD DB&quot;, &quot;User &quot; + user.getUsername() + &quot; uploaded to database&quot;);\n                })\n                .addOnFailureListener((task) -&gt;{\n                    Log.d(&quot;UPLOAD DB&quot;, &quot;User could not be uploaded&quot;);\n\n                });\n    }\n\n    public static void uploadRestaurant(Restaurant restaurant){\n        db.collection(&quot;restaurants&quot;).document(restaurant.getName())\n                .set(restaurant)\n                .addOnSuccessListener((task) -&gt; {\n                    Log.d(&quot;UPLOAD DB&quot;, &quot;Restaurant &quot; + restaurant.getName() + &quot; uploaded to database&quot;);\n                })\n                .addOnFailureListener((task) -&gt;{\n                    Log.d(&quot;UPLOAD DB&quot;, &quot;Restaurant could not be uploaded&quot;);\n\n                });\n    }\n\n\n    public static ArrayList&lt;Restaurant&gt; getRestaurants(){\n        restaurants.clear();\n        db.collection(&quot;restaurants&quot;).get()\n                .addOnCompleteListener((task) -&gt; {\n                    if (task.isSuccessful()) {\n                        for (QueryDocumentSnapshot document : task.getResult()) {\n                            restaurants.add(document.toObject(Restaurant.class));\n                            Log.d(&quot;RESTAURANT ADD&quot;, &quot;Added restaurant to restaurant list&quot;);\n\n                        }\n                        Log.d(&quot;DOWNLOAD DB&quot;, &quot;Successfully obtained restaurants&quot;);\n\n                    }\n                })\n                .addOnFailureListener((task) -&gt; {\n                    Log.d(&quot;DOWNLOAD DB&quot;, &quot;Failed to obtain restaurants&quot;);\n                });\n\n        return restaurants;\n    }\n\n\n    \n\n\n    \n\n\n\n    public static Restaurant getRestaurant(int i){\n        return restaurants.get(i);\n    }\n\n\n\n    public static Restaurant getCurrentRestaurant() {\n        return currentRestaurant;\n    }\n\n    public static void setCurrentRestaurant(Restaurant newCurrent) {\n        currentRestaurant = newCurrent;\n    }\n\n    public static User getCurrentUser() {\n        return currentUser;\n    }\n\n    public static void setCurrentUser(User currentUser) {\n        AppManager.currentUser = currentUser;\n    }\n\n}\n\n</code></pre>\n",
    "tags" : [ "java", "android", "google-cloud-firestore" ],
    "owner" : {
      "account_id" : 43828404,
      "reputation" : 17,
      "user_id" : 31437107,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e066c4c6ab11a24e1953f9f5f05c2b04?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "999",
      "link" : "https://stackoverflow.com/users/31437107/999"
    },
    "is_answered" : false,
    "view_count" : 85,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1764660143,
    "creation_date" : 1764494858,
    "link" : "https://stackoverflow.com/questions/79833790/firestore-only-updates-when-accessed-through-a-specific-android-activity",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}