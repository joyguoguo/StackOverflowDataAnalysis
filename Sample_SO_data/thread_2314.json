{
  "question" : {
    "question_id" : 79631060,
    "title" : "Why does jOOQ multiset fail with SQLite when using row(...) and multiset(...) inside findAll()?",
    "body" : "<p>I'm using jOOQ (version 3.20.2) with SQLite, and I'm trying to fetch a record along with a multiset of related entries. I know that jOOQ emulates MULTISET via JSON in SQLite, but I get a runtime exception when calling a method that uses a row(...) with a multiset(...).</p>\n<p>The error occurs when I call this method:</p>\n<pre><code>public List&lt;Profile&gt; findAll() {\n  return findBy().collect(JooqUtils.toScalarList());\n}\n</code></pre>\n<p>The findBy Method:</p>\n<pre><code>  private SelectOptionalOnStep&lt;Record1&lt;Profile&gt;&gt; findBy() {\n    return jooq().select(fullBaseEntity(PROFILE))\n                 .from(PROFILE)\n                 .leftJoin(PROFILE.profileSongs());\n  }\n</code></pre>\n<p>Here's the query generated by jOOQ:</p>\n<pre><code>select \n  `PROFILE`.`ID` as `nested.PROFILE.ID`,\n  `PROFILE`.`NAME` as `nested.PROFILE.NAME`,\n  `PROFILE`.`USERNAME` as `nested.PROFILE.USERNAME`,\n  `PROFILE`.`PROFILE_PICTURE` as `nested.PROFILE.PROFILE_PICTURE`,\n  (\n    select coalesce(json_group_array(json_array(t.`v0`)), json_array()) \n    from (\n      select `PROFILE_SONGS`.`SONG_ID` as `v0`\n    ) as t\n  ) as `nested.multiset`\nfrom `PROFILE`\nleft outer join `PROFILE_SONGS` \n  on `PROFILE_SONGS`.`PROFILE_ID` = `PROFILE`.`ID`\n</code></pre>\n<p>And this is how the field is built:</p>\n<pre><code>protected SelectField&lt;Profile&gt; fullBaseEntity(ProfileTable source) {\n      return row(\n          source.convertFrom(JooqUtils::nullIfEmptyKey),\n          JooqUtils.scalarSet(source.profileSongs().SONG_ID)\n                   .convertFrom(JooqUtils::nullIfEmptyList)\n      ).mapping(profileMapper::toEntity);\n    }\n</code></pre>\n<p>scalarSet wraps a multiset(select(...)) and maps results like this:</p>\n<pre><code>public &lt;T&gt; SelectField&lt;List&lt;T&gt;&gt; scalarSet(SelectField&lt;T&gt; field) {\n  return multiset(select(field)).convertFrom(r -&gt; \n      r.map(Record1::component1)\n       .stream()\n       .filter(Objects::nonNull)\n       .toList()\n  );\n}\n</code></pre>\n<p>The stack trace:</p>\n<pre><code>    SQL [select `PLAYLIST`.`ID` as `nested.PLAYLIST.ID`, `PLAYLIST`.`NAME` as `nested.PLAYLIST.NAME`, `PLAYLIST`.`DESCRIPTION` as `nested.PLAYLIST.DESCRIPTION`, (select coalesce(json_group_array(json_array(t.`v0`)), json_array()) from (select `alias_119079805`.`SONG_ID` as `v0`) as t) as `nested.multiset` from `PLAYLIST` left outer join `PLAYLIST_SONGS` as `alias_119079805` on `alias_119079805`.`PLAYLIST_ID` = `PLAYLIST`.`ID`]; Error while reading field: row (\n  row (&quot;PLAYLIST&quot;.&quot;ID&quot;, &quot;PLAYLIST&quot;.&quot;NAME&quot;, &quot;PLAYLIST&quot;.&quot;DESCRIPTION&quot;),\n  multiset(\n    select &quot;alias_119079805&quot;.&quot;SONG_ID&quot;\n  )\n), at JDBC index: 1\norg.jooq.exception.DataAccessException: SQL [select `PLAYLIST`.`ID` as `nested.PLAYLIST.ID`, `PLAYLIST`.`NAME` as `nested.PLAYLIST.NAME`, `PLAYLIST`.`DESCRIPTION` as `nested.PLAYLIST.DESCRIPTION`, (select coalesce(json_group_array(json_array(t.`v0`)), json_array()) from (select `alias_119079805`.`SONG_ID` as `v0`) as t) as `nested.multiset` from `PLAYLIST` left outer join `PLAYLIST_SONGS` as `alias_119079805` on `alias_119079805`.`PLAYLIST_ID` = `PLAYLIST`.`ID`]; Error while reading field: row (\n  row (&quot;PLAYLIST&quot;.&quot;ID&quot;, &quot;PLAYLIST&quot;.&quot;NAME&quot;, &quot;PLAYLIST&quot;.&quot;DESCRIPTION&quot;),\n  multiset(\n    select &quot;alias_119079805&quot;.&quot;SONG_ID&quot;\n  )\n), at JDBC index: 1\n    at org.jooq_3.20.2.SQLITE.debug(Unknown Source)\n    at org.jooq.impl.Tools.translate(Tools.java:3667)\n    at org.jooq.impl.Tools.translate(Tools.java:3640)\n    at org.jooq.impl.DefaultExecuteContext.sqlException(DefaultExecuteContext.java:847)\n    at org.jooq.impl.CursorImpl$CursorIterator.fetchNext(CursorImpl.java:1394)\n    at org.jooq.impl.CursorImpl$CursorIterator.hasNext(CursorImpl.java:1355)\n    at java.base/java.util.Iterator.forEachRemaining(Iterator.java:132)\n    at java.base/java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1939)\n    at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)\n    at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)\n    at java.base/java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:921)\n    at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n    at java.base/java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:682)\n    at org.jooq.impl.AbstractCursor.collect(AbstractCursor.java:78)\n    at org.jooq.impl.ResultQueryTrait.collect(ResultQueryTrait.java:360)\n    at org.jooq.impl.ResultQueryTrait.fetch(ResultQueryTrait.java:1464)\n    at ch.supsi.marsch.engine.repository.PlaylistRepository.findAll(PlaylistRepository.java:110)\n    at ch.supsi.marsch.engine.service.PlaylistService.findAll(PlaylistService.java:39)\n    at ch.supsi.marsch.engine.controller.PlaylistAPI.findAll(PlaylistAPI.java:34)\n    at ch.supsi.marsch.seraph.api.PlaylistTest.createPlaylistWithSong(PlaylistTest.java:31)\n    at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)\n    at java.base/java.lang.reflect.Method.invoke(Method.java:580)\n    at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:728)\n    at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)\n    at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)\n    at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:156)\n    at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:147)\n    at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:86)\n    at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(InterceptingExecutableInvoker.java:103)\n    at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.lambda$invoke$0(InterceptingExecutableInvoker.java:93)\n    at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)\n    at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)\n    at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)\n    at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)\n    at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:92)\n    at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:86)\n    at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:218)\n    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\n    at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:214)\n    at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:139)\n    at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:69)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)\n    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)\n    at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)\n    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)\n    at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\n    at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)\n    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)\n    at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)\n    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)\n    at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\n    at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)\n    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)\n    at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)\n    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)\n    at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)\n    at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)\n    at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)\n    at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:107)\n    at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)\n    at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)\n    at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)\n    at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)\n    at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)\n    at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:86)\n    at org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:86)\n    at org.gradle.api.internal.tasks.testing.junitplatform.JUnitPlatformTestClassProcessor$CollectAllTestClassesExecutor.processAllTestClasses(JUnitPlatformTestClassProcessor.java:124)\n    at org.gradle.api.internal.tasks.testing.junitplatform.JUnitPlatformTestClassProcessor$CollectAllTestClassesExecutor.access$000(JUnitPlatformTestClassProcessor.java:99)\n    at org.gradle.api.internal.tasks.testing.junitplatform.JUnitPlatformTestClassProcessor.stop(JUnitPlatformTestClassProcessor.java:94)\n    at org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.stop(SuiteTestClassProcessor.java:63)\n    at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)\n    at java.base/java.lang.reflect.Method.invoke(Method.java:580)\n    at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:36)\n    at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)\n    at org.gradle.internal.dispatch.ContextClassLoaderDispatch.dispatch(ContextClassLoaderDispatch.java:33)\n    at org.gradle.internal.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler.invoke(ProxyDispatchAdapter.java:92)\n    at jdk.proxy1/jdk.proxy1.$Proxy4.stop(Unknown Source)\n    at org.gradle.api.internal.tasks.testing.worker.TestWorker$3.run(TestWorker.java:200)\n    at org.gradle.api.internal.tasks.testing.worker.TestWorker.executeAndMaintainThreadName(TestWorker.java:132)\n    at org.gradle.api.internal.tasks.testing.worker.TestWorker.execute(TestWorker.java:103)\n    at org.gradle.api.internal.tasks.testing.worker.TestWorker.execute(TestWorker.java:63)\n    at org.gradle.process.internal.worker.child.ActionExecutionWorker.execute(ActionExecutionWorker.java:56)\n    at org.gradle.process.internal.worker.child.SystemApplicationClassLoaderWorker.call(SystemApplicationClassLoaderWorker.java:121)\n    at org.gradle.process.internal.worker.child.SystemApplicationClassLoaderWorker.call(SystemApplicationClassLoaderWorker.java:71)\n    at worker.org.gradle.process.internal.worker.GradleWorkerMain.run(GradleWorkerMain.java:69)\n    at worker.org.gradle.process.internal.worker.GradleWorkerMain.main(GradleWorkerMain.java:74)\nCaused by: java.sql.SQLException: Error while reading field: row (\n  row (&quot;PLAYLIST&quot;.&quot;ID&quot;, &quot;PLAYLIST&quot;.&quot;NAME&quot;, &quot;PLAYLIST&quot;.&quot;DESCRIPTION&quot;),\n  multiset(\n    select &quot;alias_119079805&quot;.&quot;SONG_ID&quot;\n  )\n), at JDBC index: 1\n    at org.jooq.impl.CursorImpl$CursorRecordInitialiser.setValue(CursorImpl.java:1572)\n    at org.jooq.impl.CursorImpl$CursorRecordInitialiser.apply(CursorImpl.java:1503)\n    at org.jooq.impl.CursorImpl$CursorRecordInitialiser.apply(CursorImpl.java:1422)\n    at org.jooq.impl.RecordDelegate.operate(RecordDelegate.java:144)\n    at org.jooq.impl.CursorImpl$CursorIterator.fetchNext(CursorImpl.java:1379)\n    ... 95 more\nCaused by: java.sql.SQLException: Error while reading field: &quot;nested.multiset&quot;, at JDBC index: 4\n    at org.jooq.impl.CursorImpl$CursorRecordInitialiser.setValue(CursorImpl.java:1572)\n    at org.jooq.impl.CursorImpl$CursorRecordInitialiser.apply(CursorImpl.java:1503)\n    at org.jooq.impl.CursorImpl$CursorRecordInitialiser.apply(CursorImpl.java:1422)\n    at org.jooq.impl.RecordDelegate.operate(RecordDelegate.java:144)\n    at org.jooq.impl.CursorImpl$CursorRecordInitialiser.setValue(CursorImpl.java:1551)\n    ... 99 more\nCaused by: java.lang.NullPointerException: Cannot invoke &quot;org.jooq.Field.getDataType()&quot; because &quot;field&quot; is null\n    at org.jooq.impl.DefaultBinding$DefaultResultBinding.get0(DefaultBinding.java:4799)\n    at org.jooq.impl.DefaultBinding$DefaultResultBinding.get0(DefaultBinding.java:4778)\n    at org.jooq.impl.DefaultBinding$InternalBinding.get(DefaultBinding.java:1274)\n    at org.jooq.impl.ChainedConverterBinding.get(ChainedConverterBinding.java:97)\n    at org.jooq.impl.CursorImpl$CursorRecordInitialiser.setValue(CursorImpl.java:1562)\n    ... 103 more\n\n\nError while reading field: row (\n  row (&quot;PLAYLIST&quot;.&quot;ID&quot;, &quot;PLAYLIST&quot;.&quot;NAME&quot;, &quot;PLAYLIST&quot;.&quot;DESCRIPTION&quot;),\n  multiset(\n    select &quot;alias_119079805&quot;.&quot;SONG_ID&quot;\n  )\n), at JDBC index: 1\njava.sql.SQLException: Error while reading field: row (\n  row (&quot;PLAYLIST&quot;.&quot;ID&quot;, &quot;PLAYLIST&quot;.&quot;NAME&quot;, &quot;PLAYLIST&quot;.&quot;DESCRIPTION&quot;),\n  multiset(\n    select &quot;alias_119079805&quot;.&quot;SONG_ID&quot;\n  )\n), at JDBC index: 1\n    at org.jooq.impl.CursorImpl$CursorRecordInitialiser.setValue(CursorImpl.java:1572)\n    at org.jooq.impl.CursorImpl$CursorRecordInitialiser.apply(CursorImpl.java:1503)\n    at org.jooq.impl.CursorImpl$CursorRecordInitialiser.apply(CursorImpl.java:1422)\n    at org.jooq.impl.RecordDelegate.operate(RecordDelegate.java:144)\n    at org.jooq.impl.CursorImpl$CursorIterator.fetchNext(CursorImpl.java:1379)\n    at org.jooq.impl.CursorImpl$CursorIterator.hasNext(CursorImpl.java:1355)\n    at java.base/java.util.Iterator.forEachRemaining(Iterator.java:132)\n    at java.base/java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1939)\n    at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)\n    at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)\n    at java.base/java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:921)\n    at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n    at java.base/java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:682)\n    at org.jooq.impl.AbstractCursor.collect(AbstractCursor.java:78)\n    at org.jooq.impl.ResultQueryTrait.collect(ResultQueryTrait.java:360)\n    at org.jooq.impl.ResultQueryTrait.fetch(ResultQueryTrait.java:1464)\n    at ch.supsi.marsch.engine.repository.PlaylistRepository.findAll(PlaylistRepository.java:110)\n    at ch.supsi.marsch.engine.service.PlaylistService.findAll(PlaylistService.java:39)\n    at ch.supsi.marsch.engine.controller.PlaylistAPI.findAll(PlaylistAPI.java:34)\n    at ch.supsi.marsch.seraph.api.PlaylistTest.createPlaylistWithSong(PlaylistTest.java:31)\n    at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)\n    at java.base/java.lang.reflect.Method.invoke(Method.java:580)\n    at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:728)\n    at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)\n    at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)\n    at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:156)\n    at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:147)\n    at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:86)\n    at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(InterceptingExecutableInvoker.java:103)\n    at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.lambda$invoke$0(InterceptingExecutableInvoker.java:93)\n    at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)\n    at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)\n    at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)\n    at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)\n    at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:92)\n    at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:86)\n    at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:218)\n    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\n    at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:214)\n    at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:139)\n    at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:69)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)\n    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)\n    at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)\n    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)\n    at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\n    at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)\n    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)\n    at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)\n    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)\n    at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\n    at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)\n    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)\n    at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)\n    at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)\n    at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)\n    at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)\n    at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)\n    at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)\n    at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:107)\n    at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)\n    at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)\n    at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)\n    at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)\n    at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)\n    at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:86)\n    at org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:86)\n    at org.gradle.api.internal.tasks.testing.junitplatform.JUnitPlatformTestClassProcessor$CollectAllTestClassesExecutor.processAllTestClasses(JUnitPlatformTestClassProcessor.java:124)\n    at org.gradle.api.internal.tasks.testing.junitplatform.JUnitPlatformTestClassProcessor$CollectAllTestClassesExecutor.access$000(JUnitPlatformTestClassProcessor.java:99)\n    at org.gradle.api.internal.tasks.testing.junitplatform.JUnitPlatformTestClassProcessor.stop(JUnitPlatformTestClassProcessor.java:94)\n    at org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.stop(SuiteTestClassProcessor.java:63)\n    at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)\n    at java.base/java.lang.reflect.Method.invoke(Method.java:580)\n    at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:36)\n    at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)\n    at org.gradle.internal.dispatch.ContextClassLoaderDispatch.dispatch(ContextClassLoaderDispatch.java:33)\n    at org.gradle.internal.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler.invoke(ProxyDispatchAdapter.java:92)\n    at jdk.proxy1/jdk.proxy1.$Proxy4.stop(Unknown Source)\n    at org.gradle.api.internal.tasks.testing.worker.TestWorker$3.run(TestWorker.java:200)\n    at org.gradle.api.internal.tasks.testing.worker.TestWorker.executeAndMaintainThreadName(TestWorker.java:132)\n    at org.gradle.api.internal.tasks.testing.worker.TestWorker.execute(TestWorker.java:103)\n    at org.gradle.api.internal.tasks.testing.worker.TestWorker.execute(TestWorker.java:63)\n    at org.gradle.process.internal.worker.child.ActionExecutionWorker.execute(ActionExecutionWorker.java:56)\n    at org.gradle.process.internal.worker.child.SystemApplicationClassLoaderWorker.call(SystemApplicationClassLoaderWorker.java:121)\n    at org.gradle.process.internal.worker.child.SystemApplicationClassLoaderWorker.call(SystemApplicationClassLoaderWorker.java:71)\n    at worker.org.gradle.process.internal.worker.GradleWorkerMain.run(GradleWorkerMain.java:69)\n    at worker.org.gradle.process.internal.worker.GradleWorkerMain.main(GradleWorkerMain.java:74)\nCaused by: java.sql.SQLException: Error while reading field: &quot;nested.multiset&quot;, at JDBC index: 4\n    at org.jooq.impl.CursorImpl$CursorRecordInitialiser.setValue(CursorImpl.java:1572)\n    at org.jooq.impl.CursorImpl$CursorRecordInitialiser.apply(CursorImpl.java:1503)\n    at org.jooq.impl.CursorImpl$CursorRecordInitialiser.apply(CursorImpl.java:1422)\n    at org.jooq.impl.RecordDelegate.operate(RecordDelegate.java:144)\n    at org.jooq.impl.CursorImpl$CursorRecordInitialiser.setValue(CursorImpl.java:1551)\n    ... 99 more\nCaused by: java.lang.NullPointerException: Cannot invoke &quot;org.jooq.Field.getDataType()&quot; because &quot;field&quot; is null\n    at org.jooq.impl.DefaultBinding$DefaultResultBinding.get0(DefaultBinding.java:4799)\n    at org.jooq.impl.DefaultBinding$DefaultResultBinding.get0(DefaultBinding.java:4778)\n    at org.jooq.impl.DefaultBinding$InternalBinding.get(DefaultBinding.java:1274)\n    at org.jooq.impl.ChainedConverterBinding.get(ChainedConverterBinding.java:97)\n    at org.jooq.impl.CursorImpl$CursorRecordInitialiser.setValue(CursorImpl.java:1562)\n    ... 103 more\n</code></pre>\n<p>Schemas:</p>\n<pre><code>    CREATE TABLE profile (\n    id UUID PRIMARY KEY,\n    name TEXT,\n    username TEXT,\n    profile_picture UUID\n);\n\nCREATE TABLE profile_songs (\n    profile_id UUID,\n    song_id UUID,\n    PRIMARY KEY (profile_id, song_id),\n    FOREIGN KEY (profile_id) REFERENCES profile (id),\n    FOREIGN KEY (song_id) REFERENCES song (id)\n);\n</code></pre>\n<p>Question:\nWhy does calling findAll() result in a NullPointerException when using row(...) and multiset(...) in jOOQ with SQLite? Is this a bug, limitation of the SQLite emulation, or is there something wrong in how Iâ€™m constructing the scalarSet Method?</p>\n",
    "tags" : [ "java", "sqlite", "code-generation", "jooq" ],
    "owner" : {
      "account_id" : 40635297,
      "reputation" : 11,
      "user_id" : 29876421,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f4d00a8b732699f05ae56b6f65b8c764?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "schufi73",
      "link" : "https://stackoverflow.com/users/29876421/schufi73"
    },
    "is_answered" : false,
    "view_count" : 57,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1747769433,
    "creation_date" : 1747769433,
    "link" : "https://stackoverflow.com/questions/79631060/why-does-jooq-multiset-fail-with-sqlite-when-using-row-and-multiset-in",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140444955,
    "post_id" : 79631060,
    "body" : "Probably a bug in jOOQ. I suspect your usage of <code>convertFrom()</code> within <code>row()</code> using path expressions. If you can create a more minimal reproducer and report it here: <a href=\"https://github.com/jOOQ/jOOQ/issues/new/choose\" rel=\"nofollow noreferrer\">github.com/jOOQ/jOOQ/issues/new/choose</a>, I&#39;ll will be happy to look at it. (the bug reporting form has a template for minimal reproducers: <a href=\"https://github.com/jOOQ/jOOQ-mcve\" rel=\"nofollow noreferrer\">github.com/jOOQ/jOOQ-mcve</a>)",
    "score" : 0,
    "owner" : {
      "account_id" : 247217,
      "reputation" : 223532,
      "user_id" : 521799,
      "user_type" : "registered",
      "accept_rate" : 89,
      "profile_image" : "https://www.gravatar.com/avatar/eb96efa7a5664ba1c4ebf586abd4121f?s=256&d=identicon&r=PG",
      "display_name" : "Lukas Eder",
      "link" : "https://stackoverflow.com/users/521799/lukas-eder"
    },
    "creation_date" : 1747816187,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}