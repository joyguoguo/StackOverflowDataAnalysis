{
  "question" : {
    "question_id" : 79727113,
    "title" : "protocol.ResponseProcessCookies.processCookies Invalid cookie header, invalid expires attribute",
    "body" : "<p>I'm using the API provided by RaveCapture (previously Trustspot) to send a review request when a customer makes a purchase.</p>\n<p>Used to work fine, stopped working a few months ago, I was referring to the old URL so modified to new URL thinking that was issue but still continues to fail</p>\n<p><strong>Java Code</strong></p>\n<p>API_CODE, SECRET_KEY, MERCHANT_CODE and email modified</p>\n<pre><code>package com.jthink.store.trustspot;\n\nimport com.google.gson.FieldNamingPolicy;\nimport com.google.gson.Gson;\nimport com.google.gson.GsonBuilder;\nimport com.jthink.store.util.Email;\nimport org.apache.http.HttpResponse;\nimport org.apache.http.client.HttpClient;\nimport org.apache.http.client.methods.HttpPost;\nimport org.apache.http.entity.StringEntity;\nimport org.apache.http.impl.client.CloseableHttpClient;\nimport org.apache.http.impl.client.DefaultHttpClient;\nimport org.apache.http.impl.client.HttpClients;\n\nimport javax.crypto.Mac;\nimport javax.crypto.spec.SecretKeySpec;\nimport javax.net.ssl.SSLContext;\nimport java.io.BufferedReader;\nimport java.io.InputStreamReader;\nimport java.io.PrintWriter;\nimport java.io.StringWriter;\nimport java.net.URL;\nimport java.nio.charset.Charset;\nimport java.nio.file.Files;\nimport java.nio.file.Path;\nimport java.nio.file.Paths;\nimport java.util.ArrayList;\nimport java.util.Base64;\nimport java.util.List;\n\n/**\n * Created by Paul on 27/01/2017.\n */\npublic class TrustSpotProductRequest\n{\n\n    public static final String API_KEY = &quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;;\n    public static final String SECRET_KEY = &quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;;\n    public static final String MERCHANT_ID = &quot;xxxx&quot;;\n\n    private Order           order;\n    private List&lt;Product&gt;   products;\n\n    public TrustSpotProductRequest()\n    {\n\n    }\n\n    public void sendRequest(Order order)\n    {\n        HttpPost httpMethod;\n        URL url;\n\n        try\n        {\n            CloseableHttpClient httpclient = HttpClients.createSystem();\n\n            this.order=order;\n            String dataForHmac      = MERCHANT_ID + order.getOrderId() + order.getCustomerEmail();\n            String calculatedHmac   = base64sha256(dataForHmac, SECRET_KEY);\n            order.setHmac(calculatedHmac);\n            order.setKey(API_KEY);\n\n            Gson gson = new GsonBuilder().setFieldNamingPolicy(FieldNamingPolicy.LOWER_CASE_WITH_UNDERSCORES).setPrettyPrinting().create();\n            System.out.println(gson.toJson(order));\n\n            String jsonData = gson.toJson(order);\n\n            url = new URL(&quot;https://app.ravecapture.com/api/pub/new_order_product&quot;);\n            httpMethod = new HttpPost(url.toExternalForm());\n            //httpMethod.addHeader(&quot;Accept&quot;, &quot;application/json&quot;);\n            httpMethod.addHeader(&quot;Content-Type&quot;, &quot;application/json&quot;);\n            StringEntity se = new StringEntity(jsonData);\n            httpMethod.setEntity(se);\n            HttpResponse httpResponse = httpclient.execute(httpMethod);\n            InputStreamReader is = new InputStreamReader(httpResponse.getEntity().getContent());\n            BufferedReader rd;\n            rd = new BufferedReader(is);\n\n            String line = &quot;&quot;;\n            while ((line = rd.readLine()) != null)\n            {\n                System.out.println(line);\n            }\n        }\n        catch(Exception ex)\n        {\n            ex.printStackTrace();\n            StringWriter messageBody = new StringWriter();\n            PrintWriter pw = new PrintWriter(messageBody);\n            ex.printStackTrace(pw);\n            Email.sendAlert(&quot;Unable to send ravecpature review request:&quot;+ order.getCustomerEmail(), messageBody.toString());\n        }\n    }\n\n    public static String base64sha256(String data, String secret) throws Exception\n    {\n        Mac sha256_HMAC = Mac.getInstance(&quot;HmacSHA256&quot;);\n        SecretKeySpec secret_key = new SecretKeySpec(secret.getBytes(), &quot;HmacSHA256&quot;);\n        sha256_HMAC.init(secret_key);\n        byte[] res = sha256_HMAC.doFinal(data.getBytes());\n        return Base64.getEncoder().encodeToString(res);\n    }\n\n    public static void main(String[] args) throws Exception\n    {\n        //Read data from csv file\n        Path path = Paths.get(&quot;C:/code/jaikoz.csv&quot;);\n        System.out.println(&quot;Path exist:&quot;+Files.isRegularFile(path));\n        List&lt;String&gt; rows = Files.readAllLines(path);\n        System.out.println(&quot;RowsSize:&quot;+rows.size());\n        for(int i=1; i &lt; rows.size(); i++)\n        {\n            String row = rows.get(i);\n\n            String[] parts = row.split(&quot;,&quot;);\n            String purchaseDate = parts[0];\n            String orderId = parts[1];\n            String name = parts[2] + &quot; &quot; + parts[3];\n            String email = parts[4];\n\n            Order order = new Order();\n            order.setMerchantId(String.valueOf(MERCHANT_ID));\n            order.setOrderId((orderId));\n            order.setCustomerName(name);\n            order.setCustomerEmail(email);\n            order.setPurchaseDate(purchaseDate);\n\n            Product p1 = new Product();\n            p1.setProductSku(String.valueOf(1001));\n            p1.setProductName(&quot;Jaikoz&quot;);\n            p1.setProductDesc(&quot;Deceptively Powerful Automated Music Tagging&quot;);\n            p1.setProductPrice(&quot;30.00&quot;);\n            p1.setProductUrl(&quot;https://www.jthink.net/jaikoz&quot;);\n            p1.setProductImage(&quot;https://www.jthink.net/jaikoz/images/jaikoz128x128.png&quot;);\n            order.addProducts(p1);\n            TrustSpotProductRequest tspr = new TrustSpotProductRequest();\n            tspr.sendRequest(order);\n        }\n\n    }\n\n    public static void mainOld(String[] args) throws Exception\n    {\n        Order order = new Order();\n        order.setMerchantId(String.valueOf(MERCHANT_ID));\n        order.setOrderId((&quot;12A49085JX0082328&quot;));\n        order.setCustomerName(&quot;Karen Taylor&quot;);\n        order.setCustomerEmail(&quot;testuser@test.com&quot;);\n        order.setPurchaseDate(&quot;2021-11-26 22:05:56&quot;);\n\n\n        Product p1 = new Product();\n        p1.setProductSku(String.valueOf(1002));\n        p1.setProductName(&quot;SongKong&quot;);\n        p1.setProductDesc(&quot;Deceptively Powerful Automated Music Tagging&quot;);\n        p1.setProductPrice(&quot;30.00&quot;);\n        p1.setProductUrl(&quot;http://www.jthink.net/songkong&quot;);\n        p1.setProductImage(&quot;http://www.jthink.net/songkong/images/songkong_icon256.png&quot;);\n        order.addProducts(p1);\n        TrustSpotProductRequest tspr = new TrustSpotProductRequest();\n        tspr.sendRequest(order);\n    }\n\n\n    public static void mainTest(String[] args) throws Exception\n    {\n        Order order = new Order();\n        order.setMerchantId(String.valueOf(526));\n        order.setOrderId(String.valueOf(15));\n        order.setCustomerName(&quot;Tom Tester&quot;);\n        order.setCustomerEmail(&quot;larry+tomtester@trustspot.io&quot;);\n        order.setPurchaseDate(&quot;2017-01-27 22:05:56&quot;);\n        order.setHmac(&quot;kH9AAiRPMdHTP/dZgcUCPaldhpL9ttUw+lYl7LdB32Q=&quot;);\n\n        Product p1 = new Product();\n        p1.setProductSku(String.valueOf(47));\n        p1.setProductName(&quot;HP LP3065&quot;);\n        p1.setProductDesc(&quot;\\r\\nStop your co-workers in their tracks with the stunning new 30-inc&quot;);\n        p1.setProductPrice(&quot;100.0000&quot;);\n        p1.setProductUrl(&quot;http://ts.oc-develop.com/index.php?route=product/product&amp;amp;product_id=47&quot;);\n        p1.setProductImage(&quot;http://ts.oc-develop.com/image/cache/catalog/demo/hp_1-500x500.jpg&quot;);\n        order.addProducts(p1);\n        Product p2 = new Product();\n        p2.setProductSku(String.valueOf(41));\n        p2.setProductName(&quot;iMac&quot;);\n        p2.setProductDesc(&quot;\\r\\nJust when you thought iMac had everything,&quot;);\n        p2.setProductPrice(&quot;100.0000&quot;);\n        p2.setProductUrl(&quot;http://ts.oc-develop.com/index.php?route=product/product&amp;amp;product_id=41&quot;);\n        p2.setProductImage(&quot;http://ts.oc-develop.com/image/cache/catalog/demo/imac_1-500x500.jpg&quot;);\n        order.addProducts(p2);\n\n        Gson gson = new GsonBuilder().setFieldNamingPolicy(FieldNamingPolicy.LOWER_CASE_WITH_UNDERSCORES).setPrettyPrinting().create();\n        System.out.println(gson.toJson(order));\n\n        //TrustSpotProductRequest tspr = new TrustSpotProductRequest();\n        //tspr.sendRequest(order);\n    }\n\n\n    /**\n     * Created by Paul on 27/01/2017.\n     */\n    public static class Order\n    {\n        private String merchantId;\n        private String customerEmail;\n        private String customerName;\n        private String orderId;\n        private String purchaseDate;\n        private String key;\n        private String hmac;\n        private List&lt;Product&gt; products = new ArrayList();\n\n        public String getCustomerEmail()\n        {\n            return customerEmail;\n        }\n\n        public void setCustomerEmail(String customerEmail)\n        {\n            this.customerEmail = customerEmail;\n        }\n\n        public String getCustomerName()\n        {\n            return customerName;\n        }\n\n        public void setCustomerName(String customerName)\n        {\n            this.customerName = customerName;\n        }\n\n        public String getOrderId()\n        {\n            return orderId;\n        }\n\n        public void setOrderId(String orderId)\n        {\n            this.orderId = orderId;\n        }\n\n        public String getPurchaseDate()\n        {\n            return purchaseDate;\n        }\n\n        public void setPurchaseDate(String purchaseDate)\n        {\n            this.purchaseDate = purchaseDate;\n        }\n\n        public String getMerchantId()\n        {\n            return merchantId;\n        }\n\n        public void setMerchantId(String merchantId)\n        {\n            this.merchantId = merchantId;\n        }\n\n        public String getKey()\n        {\n            return key;\n        }\n\n        public void setKey(String key)\n        {\n            this.key = key;\n        }\n\n        public String getHmac()\n        {\n            return hmac;\n        }\n\n        public void setHmac(String hmac)\n        {\n            this.hmac = hmac;\n        }\n\n        public List&lt;Product&gt; getProducts()\n        {\n            return products;\n        }\n\n        public void addProducts(Product product)\n        {\n            products.add(product);\n        }\n    }\n\n    /**\n     * Created by Paul on 27/01/2017.\n     */\n    public static class Product\n    {\n        private String productSku;\n        private String productName;\n        private String productDesc;\n        private String productPrice;\n        private String productUrl;\n        private String productImage;\n\n        public String getProductSku()\n        {\n            return productSku;\n        }\n\n        public void setProductSku(String productSku)\n        {\n            this.productSku = productSku;\n        }\n\n        public String getProductName()\n        {\n            return productName;\n        }\n\n        public void setProductName(String productName)\n        {\n            this.productName = productName;\n        }\n\n        public String getProductDesc()\n        {\n            return productDesc;\n        }\n\n        public void setProductDesc(String productDesc)\n        {\n            this.productDesc = productDesc;\n        }\n\n        public String getProductPrice()\n        {\n            return productPrice;\n        }\n\n        public void setProductPrice(String productPrice)\n        {\n            this.productPrice = productPrice;\n        }\n\n        public String getProductUrl()\n        {\n            return productUrl;\n        }\n\n        public void setProductUrl(String productUrl)\n        {\n            this.productUrl = productUrl;\n        }\n\n        public String getProductImage()\n        {\n            return productImage;\n        }\n\n        public void setProductImage(String productImage)\n        {\n            this.productImage = productImage;\n        }\n    }\n}\n\n\n    System.out.println(&quot;trustspot_start_request:&quot;+emailAddress);\n    TrustSpotProductRequest ts = new TrustSpotProductRequest();\n    TrustSpotProductRequest.Order order = createTrustSpotOrder(emailAddress, name, orderId);\n    TrustSpotProductRequest.Product product = createProduct();\n    order.addProducts(product);\n    ts.sendRequest(order);\n    System.out.println(&quot;trustspot_end_request:&quot;+emailAddress);\n</code></pre>\n<p><strong>Output</strong></p>\n<pre><code>trustspot_start_request:odex@lantic.net\n{\n  &quot;merchant_id&quot;: &quot;1212&quot;,\n  &quot;customer_email&quot;: &quot;testuser1@jthink.net&quot;,\n  &quot;customer_name&quot;: &quot;P Taylor&quot;,\n  &quot;order_id&quot;: &quot;1LS122694B720990G&quot;,\n  &quot;purchase_date&quot;: &quot;2025-08-218 05:11:27&quot;,\n  &quot;key&quot;: &quot;3dd4fcc59699d43abfa4428928d945886b6205fb31356f13cd8d0daba8bc9f56609032a74fc8e505bebf4c3dd14846c804a40ba0304e0c84ef38c279b05edb60&quot;,\n  &quot;hmac&quot;: &quot;V+NvYpdeokziw3MdmJ/AT2nrqD6FrpJ/1xovu8Q6asM\\u003d&quot;,\n  &quot;products&quot;: [\n    null\n  ]\n}\n06-Aug-2025 05:11:27.618 WARNING [http-nio-8080-exec-2] org.apache.http.client.protocol.ResponseProcessCookies.processCookies Invalid cookie header: &quot;Set-Cookie: AWSALB=3NMQt20uE38u9PViCI39etqLpbYTIL41YvJnFAjzOHr3wTC/Qeynraxg8sx1yOfeMUW+pdXh9Ot2IIN3bNaKyEVZAKRu/zlZLRJZKuc8nxE0XsvqoRFk1KuGIpFJ; Expires=Wed, 13 Aug 2025 09:11:27 GMT; Path=/&quot;. Invalid 'expires' attribute: Wed, 13 Aug 2025 09:11:27 GMT\n06-Aug-2025 05:11:27.618 WARNING [http-nio-8080-exec-2] org.apache.http.client.protocol.ResponseProcessCookies.processCookies Invalid cookie header: &quot;Set-Cookie: AWSALBCORS=3NMQt20uE38u9PViCI39etqLpbYTIL41YvJnFAjzOHr3wTC/Qeynraxg8sx1yOfeMUW+pdXh9Ot2IIN3bNaKyEVZAKRu/zlZLRJZKuc8nxE0XsvqoRFk1KuGIpFJ; Expires=Wed, 13 Aug 2025 09:11:27 GMT; Path=/; SameSite=None; Secure&quot;. Invalid 'expires' attribute: Wed, 13 Aug 2025 09:11:27 GMT\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;xml&gt;&lt;status&gt;fail&lt;/status&gt;&lt;error&gt;Please contact support. UUID: 68931c3f9009b2.77074223&lt;/error&gt;&lt;/xml&gt;\ntrustspot_end_request:testuser1@jthink.net\n</code></pre>\n<p>So it complaining about the cookie expiry. But don't know how to address this, unclear if the issue is my code or on their server ?</p>\n",
    "tags" : [ "java", "cookies" ],
    "owner" : {
      "account_id" : 111681,
      "reputation" : 13382,
      "user_id" : 1480018,
      "user_type" : "registered",
      "accept_rate" : 87,
      "profile_image" : "https://www.gravatar.com/avatar/adc85b2c054f3eb102da8eb68545dca4?s=256&d=identicon&r=PG",
      "display_name" : "Paul Taylor",
      "link" : "https://stackoverflow.com/users/1480018/paul-taylor"
    },
    "is_answered" : false,
    "view_count" : 35,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1754911014,
    "creation_date" : 1754473653,
    "link" : "https://stackoverflow.com/questions/79727113/protocol-responseprocesscookies-processcookies-invalid-cookie-header-invalid-ex",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}