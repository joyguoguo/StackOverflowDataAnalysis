{
  "question" : {
    "question_id" : 79661350,
    "title" : "Does System.nanoTime() pause when the machine sleeps?",
    "body" : "<p>I'm tracking a bug in my software that is caused by <code>System.nanoTime()</code> stopping counting time when the machine enters a deep sleep state, whereas <code>System.currentTimeMillis()</code> does not.</p>\n<p>Here's a minimal reproducible example. It continuously tracks the difference in milliseconds between <code>System.currentTimeMillis()</code> and <code>System.nanoTime()</code>.</p>\n<pre class=\"lang-java prettyprint-override\"><code>public static void main(String[] args) throws Exception {\n    while (true) {\n        long epoch = System.currentTimeMillis();\n        System.out.println(new Date(epoch) + &quot; &quot; + \n                          (epoch - TimeUnit.NANOSECONDS.toMillis(System.nanoTime())));\n        Thread.sleep(1000);\n    }\n}\n</code></pre>\n<p>I'm running it on a MacBook Pro with macOS 15.5 on Java version <code>21.0.2-amzn</code> downloaded via <a href=\"https://sdkman.io/\" rel=\"nofollow noreferrer\">SdkMan</a>. The reproduction steps are:</p>\n<ul>\n<li>Run the program and let it loop for a while</li>\n<li>Put the laptop in sleep mode by clicking the apple logo menu and selecting &quot;Sleep&quot;</li>\n<li>Wait some time</li>\n<li>Wake up the computer</li>\n<li>Check that the difference has increased</li>\n</ul>\n<p>In the following example, you can see that after a 15-second sleep, the difference has increased by almost the same amount.</p>\n<pre><code>...\nWed Jun 11 00:21:20 BRT 2025 1749394409334\nWed Jun 11 00:21:21 BRT 2025 1749394409334\nWed Jun 11 00:21:36 BRT 2025 1749394423732\nWed Jun 11 00:21:37 BRT 2025 1749394423732\n...\n</code></pre>\n<p>The <a href=\"https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/System.html#nanoTime()\" rel=\"nofollow noreferrer\">documentation</a> says that:</p>\n<blockquote>\n<p>The value returned represents nanoseconds since some fixed but arbitrary origin time [...]. The same origin is used by all invocations of this method in an instance of a Java virtual machine [...]</p>\n</blockquote>\n<p>However, that does not appear to be the case in this example.</p>\n<p>Has anyone seen that before? Am I missing something?</p>\n",
    "tags" : [ "java", "time", "nanotime" ],
    "owner" : {
      "account_id" : 1397805,
      "reputation" : 10677,
      "user_id" : 1327235,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/bYzzp.jpg?s=256",
      "display_name" : "Juan Lopes",
      "link" : "https://stackoverflow.com/users/1327235/juan-lopes"
    },
    "is_answered" : true,
    "view_count" : 139,
    "answer_count" : 1,
    "score" : 3,
    "last_activity_date" : 1749651420,
    "creation_date" : 1749612802,
    "link" : "https://stackoverflow.com/questions/79661350/does-system-nanotime-pause-when-the-machine-sleeps",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79661371,
    "question_id" : 79661350,
    "body" : "<p>I think that this behavior fits within the bounds of the javadoc.</p>\n<p>In JDK bug report <a href=\"https://bugs.openjdk.org/browse/JDK-8307677\" rel=\"nofollow noreferrer\">JDK-8307677</a> on the accuracy of <code>nanotime()</code>, the first response comment is as follows:</p>\n<blockquote>\n<p>&quot;It is an erroneous assumption to assume that ‘correct’ behaviour would be to continue tracking nanoTime() across sleep/suspend. When you are using relative times and timeouts they are typically relative to the operation of the JVM not the external world, so if the JVM stops then &quot;time&quot; stops. This is the only mode of operation the JVM supports.&quot;</p>\n</blockquote>\n<p>The javadoc includes this sentence:</p>\n<blockquote>\n<p>This method can only be used to measure elapsed time <strong>and is not related to any other notion of system or wall-clock time</strong>.</p>\n</blockquote>\n<p>In practice, <code>nanotime()</code> returns &quot;JVM time&quot; ... which stops when the hardware sleeps.  The Java team holds that this behavior is by design, and by implication that it is consistent with the javadoc.  The bug has been marked as &quot;won't fix&quot;.</p>\n",
    "score" : 4,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 47283,
      "reputation" : 723428,
      "user_id" : 139985,
      "user_type" : "registered",
      "accept_rate" : 69,
      "profile_image" : "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=256&d=identicon&r=PG",
      "display_name" : "Stephen C",
      "link" : "https://stackoverflow.com/users/139985/stephen-c"
    },
    "creation_date" : 1749614634,
    "last_activity_date" : 1749651420,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140504279,
    "post_id" : 79661350,
    "body" : "Apparently ... nanotime is using a hardware clock that is paused when your hardware goes into deep sleep. This is certainly the case for Android; see <a href=\"https://stackoverflow.com/questions/26266441\">stackoverflow.com/questions/26266441</a>",
    "score" : 1,
    "owner" : {
      "account_id" : 47283,
      "reputation" : 723428,
      "user_id" : 139985,
      "user_type" : "registered",
      "accept_rate" : 69,
      "profile_image" : "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=256&d=identicon&r=PG",
      "display_name" : "Stephen C",
      "link" : "https://stackoverflow.com/users/139985/stephen-c"
    },
    "creation_date" : 1749613708,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79661371" : [ {
      "comment_id" : 140507683,
      "post_id" : 79661371,
      "body" : "As Douglas Adams wrote: &quot;Time is an illusion.  Lunchtime doubly so.&quot;",
      "score" : 0,
      "owner" : {
        "account_id" : 47283,
        "reputation" : 723428,
        "user_id" : 139985,
        "user_type" : "registered",
        "accept_rate" : 69,
        "profile_image" : "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=256&d=identicon&r=PG",
        "display_name" : "Stephen C",
        "link" : "https://stackoverflow.com/users/139985/stephen-c"
      },
      "creation_date" : 1749713421,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140507668,
      "post_id" : 79661371,
      "body" : "In this case ... &quot;point in time&quot; is referring to a timeline where time stops when the hardware is in sleep/suspend.  Both the &quot;origin&quot; and &quot;current&quot; time points are on that timeline.  This why the javadoc says &quot;.... not related to any other notion of system or wall-clock time&quot;.  (And you are &quot;erroneously&quot; assuming that it is.)",
      "score" : 0,
      "owner" : {
        "account_id" : 47283,
        "reputation" : 723428,
        "user_id" : 139985,
        "user_type" : "registered",
        "accept_rate" : 69,
        "profile_image" : "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=256&d=identicon&r=PG",
        "display_name" : "Stephen C",
        "link" : "https://stackoverflow.com/users/139985/stephen-c"
      },
      "creation_date" : 1749713098,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140506488,
      "post_id" : 79661371,
      "body" : "I&#39;m really not convinced that does not break the guarantee stated in the JavaDoc. It clearly says nanoTime() returns the number of nanoseconds since a fixed arbitrary origin point in time, which should not change when called from the same JVM. If the clock stops when the computer sleeps, the origin time is changing inside the same JVM, which seems to be a surprising behavior when you are trying to track elapsed real time. But your answer really helped me understand JDK dev team vision about that. Thank you.",
      "score" : 0,
      "owner" : {
        "account_id" : 1397805,
        "reputation" : 10677,
        "user_id" : 1327235,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/bYzzp.jpg?s=256",
        "display_name" : "Juan Lopes",
        "link" : "https://stackoverflow.com/users/1327235/juan-lopes"
      },
      "creation_date" : 1749664456,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140505768,
      "post_id" : 79661371,
      "body" : "@Holger - Do you know how to interpret the following comment on JDK-8307677?  &quot;The observations on Windows 10: JDK 20: Passed, no problem observed.&quot;  Does it mean that sleep/suspend on that platform doesn&#39;t stop the nanotime time?  (Or is it simply an &quot;internal&quot; communication that shouldn&#39;t be public.)",
      "score" : 0,
      "owner" : {
        "account_id" : 47283,
        "reputation" : 723428,
        "user_id" : 139985,
        "user_type" : "registered",
        "accept_rate" : 69,
        "profile_image" : "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=256&d=identicon&r=PG",
        "display_name" : "Stephen C",
        "link" : "https://stackoverflow.com/users/139985/stephen-c"
      },
      "creation_date" : 1749651374,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140505707,
      "post_id" : 79661371,
      "body" : "That is a much better explanation.  I&#39;ll update my answer.",
      "score" : 0,
      "owner" : {
        "account_id" : 47283,
        "reputation" : 723428,
        "user_id" : 139985,
        "user_type" : "registered",
        "accept_rate" : 69,
        "profile_image" : "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=256&d=identicon&r=PG",
        "display_name" : "Stephen C",
        "link" : "https://stackoverflow.com/users/139985/stephen-c"
      },
      "creation_date" : 1749650152,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140505568,
      "post_id" : 79661371,
      "body" : "And then, there’s already <a href=\"https://bugs.openjdk.org/browse/JDK-8307677\" rel=\"nofollow noreferrer\">JDK-8307677</a> precisely about the issue of this question: “<i>It is an erroneous assumption to assume that ‘correct’ behaviour would be to continue tracking nanoTime() across sleep/suspend. When you are using relative times and timeouts they are typically relative to the operation of the JVM not the external world, so if the JVM stops then &quot;time&quot; stops. This is the only mode of operation the JVM supports.</i>”",
      "score" : 3,
      "owner" : {
        "account_id" : 3211603,
        "reputation" : 300981,
        "user_id" : 2711488,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/t2hoD.jpg?s=256",
        "display_name" : "Holger",
        "link" : "https://stackoverflow.com/users/2711488/holger"
      },
      "creation_date" : 1749647914,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140505560,
      "post_id" : 79661371,
      "body" : "It’s not an issue of accuracy. <code>currentTimeMillis</code> and <code>nanoTime</code> simply are two entirely different things and there’s no point in comparing them. As stated in <a href=\"https://bugs.openjdk.org/browse/JDK-8338732\" rel=\"nofollow noreferrer\">JDK-8338732</a> “<i>nanoTime uses a mononotic clock whereas currentTimeMillis is the wall clock.  currentTimeMillis may go forward or backward in time if the wall clock is adjusted - for instance through NTP (Network Time Protocol).  nanoTime should never go backward, and is insensitive to adjustments of the wall clock.    Drifts between the two clocks should therefore be expected.</i>”",
      "score" : 3,
      "owner" : {
        "account_id" : 3211603,
        "reputation" : 300981,
        "user_id" : 2711488,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/t2hoD.jpg?s=256",
        "display_name" : "Holger",
        "link" : "https://stackoverflow.com/users/2711488/holger"
      },
      "creation_date" : 1749647807,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140504340,
      "post_id" : 79661371,
      "body" : "I don&#39;t see how.  The origin isn&#39;t changing.  What is changing is the accuracy.  Or at least, that&#39;s how I think <i>they</i> would argue this.  (And I infer that that is what is happening at the OS level.  The timer is stopping.  Its update frequency goes to zero while the hardware is in deep sleep.)",
      "score" : 0,
      "owner" : {
        "account_id" : 47283,
        "reputation" : 723428,
        "user_id" : 139985,
        "user_type" : "registered",
        "accept_rate" : 69,
        "profile_image" : "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=256&d=identicon&r=PG",
        "display_name" : "Stephen C",
        "link" : "https://stackoverflow.com/users/139985/stephen-c"
      },
      "creation_date" : 1749617585,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140504290,
      "post_id" : 79661371,
      "body" : "In the javadocs: &quot;the same origin is used by all invocations of this method in an instance of a Java virtual machine&quot;. Isn&#39;t this guarantee violated in the deep sleep case?",
      "score" : 0,
      "owner" : {
        "account_id" : 1397805,
        "reputation" : 10677,
        "user_id" : 1327235,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/bYzzp.jpg?s=256",
        "display_name" : "Juan Lopes",
        "link" : "https://stackoverflow.com/users/1327235/juan-lopes"
      },
      "creation_date" : 1749614804,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}