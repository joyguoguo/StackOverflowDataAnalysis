{
  "question" : {
    "question_id" : 79713301,
    "title" : "How to create a frame that opens automatically?",
    "body" : "<p>I'm developing an Android application with the Expo Framework (no iOS version).</p>\n<p>I'm looking to integrate an auto-open feature when unlocking the phone, so I've modified my Kotlin code present in the ./android/ folder as well as my AndroidManifest.xml file. This frame should also close when tapped.</p>\n<p>I have two main problems:\n- my ACTION_BOOT_COMPLETED event never triggers\n- I have no idea how to open an Expo frame (i.e. via a myframe.tsx file)</p>\n<p><strong>AndroidManifest.xml</strong></p>\n<pre><code>&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;\n\n  &lt;uses-permission android:name=&quot;android.permission.FOREGROUND_SERVICE&quot;/&gt;\n  &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;\n  &lt;uses-permission android:name=&quot;android.permission.READ_EXTERNAL_STORAGE&quot;/&gt;\n  &lt;uses-permission android:name=&quot;android.permission.SYSTEM_ALERT_WINDOW&quot;/&gt;\n  &lt;uses-permission android:name=&quot;android.permission.VIBRATE&quot;/&gt;\n  &lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;/&gt;\n  &lt;uses-permission android:name=&quot;android.permission.RECEIVE_BOOT_COMPLETED&quot;/&gt;\n  &lt;uses-permission android:name=&quot;android.permission.FOREGROUND_SERVICE_SPECIAL_USE&quot; /&gt;\n\n  &lt;queries&gt;\n    &lt;intent&gt;\n      &lt;action android:name=&quot;android.intent.action.VIEW&quot;/&gt;\n      &lt;category android:name=&quot;android.intent.category.BROWSABLE&quot;/&gt;\n      &lt;data android:scheme=&quot;https&quot;/&gt;\n    &lt;/intent&gt;\n  &lt;/queries&gt;\n  &lt;application android:name=&quot;.MainApplication&quot; android:label=&quot;@string/app_name&quot; android:icon=&quot;@mipmap/ic_launcher&quot; android:roundIcon=&quot;@mipmap/ic_launcher_round&quot; android:allowBackup=&quot;true&quot; android:theme=&quot;@style/AppTheme&quot; android:supportsRtl=&quot;true&quot; android:fullBackupContent=&quot;@xml/secure_store_backup_rules&quot; android:dataExtractionRules=&quot;@xml/secure_store_data_extraction_rules&quot;&gt;\n    &lt;meta-data android:name=&quot;expo.modules.updates.ENABLED&quot; android:value=&quot;false&quot;/&gt;\n    &lt;meta-data android:name=&quot;expo.modules.updates.EXPO_UPDATES_CHECK_ON_LAUNCH&quot; android:value=&quot;ALWAYS&quot;/&gt;\n    &lt;meta-data android:name=&quot;expo.modules.updates.EXPO_UPDATES_LAUNCH_WAIT_MS&quot; android:value=&quot;0&quot;/&gt;\n    &lt;activity android:name=&quot;.MainActivity&quot; android:configChanges=&quot;keyboard|keyboardHidden|orientation|screenSize|screenLayout|uiMode&quot; android:launchMode=&quot;singleTask&quot; android:windowSoftInputMode=&quot;adjustResize&quot; android:theme=&quot;@style/Theme.App.SplashScreen&quot; android:exported=&quot;true&quot; android:screenOrientation=&quot;portrait&quot;&gt;\n      &lt;intent-filter&gt;\n        &lt;action android:name=&quot;android.intent.action.MAIN&quot;/&gt;\n        &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot;/&gt;\n      &lt;/intent-filter&gt;\n      &lt;intent-filter&gt;\n        &lt;action android:name=&quot;android.intent.action.VIEW&quot;/&gt;\n        &lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;\n        &lt;category android:name=&quot;android.intent.category.BROWSABLE&quot;/&gt;\n        &lt;data android:scheme=&quot;activmotiv&quot;/&gt;\n        &lt;data android:scheme=&quot;exp+activmotiv&quot;/&gt;\n      &lt;/intent-filter&gt;\n    &lt;/activity&gt;\n    &lt;receiver android:name=&quot;.BootReceiver&quot; android:exported=&quot;true&quot;&gt;\n      &lt;intent-filter&gt;\n        &lt;action android:name=&quot;android.intent.action.BOOT_COMPLETED&quot;/&gt;\n      &lt;/intent-filter&gt;\n    &lt;/receiver&gt;\n    &lt;service\n      android:label=&quot;Service&quot;\n      android:foregroundServiceType=&quot;specialUse&quot;  android:name=&quot;.MainService&quot; /&gt;\n  &lt;/application&gt;\n&lt;/manifest&gt;\n</code></pre>\n<p><strong>/MainService.kt</strong></p>\n<pre><code>package fr.devsoleo.activmotiv\n\nimport android.app.Notification\nimport android.app.NotificationChannel\nimport android.app.NotificationManager\nimport android.app.NotificationManager.IMPORTANCE_DEFAULT\nimport android.app.Service\nimport android.content.Context\nimport android.content.Intent\nimport android.content.IntentFilter\nimport android.os.Build\nimport android.os.IBinder\nimport androidx.annotation.RequiresApi\nimport fr.devsoleo.activmotiv.popup.PresenceReceiver\n\nclass MainService : Service() {\n    private val receiver = PresenceReceiver()\n\n    override fun onCreate() {\n        super.onCreate()\n        val filter = IntentFilter(Intent.ACTION_USER_PRESENT)\n        applicationContext.registerReceiver(receiver, filter)\n    }\n\n    override fun onDestroy() {\n        applicationContext.unregisterReceiver(receiver)\n    }\n\n    override fun onBind(intent: Intent?): IBinder? {\n        return null\n    }\n\n    @RequiresApi(Build.VERSION_CODES.O)\n    override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {\n        startNotification()\n        return START_STICKY\n    }\n\n    @RequiresApi(Build.VERSION_CODES.O)\n    private fun startNotification() {\n        val channel = NotificationChannel(CHANNEL_ID, CHANNEL_NAME, IMPORTANCE_DEFAULT).apply {\n            description = &quot;ActivMotiv Notification Channel&quot;\n        }\n\n        val notificationManager: NotificationManager =\n            getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager\n        notificationManager.createNotificationChannel(channel)\n\n        val notification: Notification = Notification.Builder(this, CHANNEL_ID)\n            .setContentTitle(&quot;Notification titre&quot;)\n            .setContentText(&quot;Notification contenu&quot;)\n            .build()\n\n        startForeground(2, notification)\n    }\n\n    companion object {\n        const val CHANNEL_ID = &quot;ActivMotivNotif&quot;\n        const val CHANNEL_NAME = &quot;ActivMotiv&quot;\n    }\n}\n</code></pre>\n<p><strong>/BootReceiver.kt</strong></p>\n<pre><code>class BootReceiver : BroadcastReceiver() {\n    @RequiresApi(Build.VERSION_CODES.O)\n    override fun onReceive(context: Context, intent: Intent) {\n        if (intent.action == Intent.ACTION_BOOT_COMPLETED) {\n            val serviceIntent = Intent(context, MainService::class.java)\n            context.startForegroundService(serviceIntent)\n        }\n    }\n}\n</code></pre>\n<p><strong>/popup/PresenceReceiver.kt</strong></p>\n<pre><code>package fr.devsoleo.activmotiv.popup\n\nimport android.content.BroadcastReceiver\nimport android.content.Context\nimport android.content.Intent\n\nclass PresenceReceiver : BroadcastReceiver() {\n    override fun onReceive(context: Context, intent: Intent) {\n        if (intent.action == Intent.ACTION_USER_PRESENT) {\n            val startIntent = Intent(context, ImagesActivity::class.java)\n            startIntent.flags = Intent.FLAG_ACTIVITY_NEW_TASK or Intent.FLAG_ACTIVITY_CLEAR_TASK\n            context.startActivity(startIntent)\n        }\n    }\n}\n</code></pre>\n<p><strong>/popup/ImageActivity.kt</strong></p>\n<pre><code>package fr.devsoleo.activmotiv.popup\n\nimport android.os.Bundle\nimport android.util.Log\nimport androidx.activity.ComponentActivity\n\nclass ImagesActivity : ComponentActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n    }\n\n    override fun onRestart() {\n        super.onRestart()\n    }\n\n    override fun onResume() {\n        super.onResume()\n    }\n\n    override fun onStop() {\n        super.onStop()\n    }\n}\n</code></pre>\n<p>I managed to get the automatic opening to work (on an empty Activity), but I can't get back to that stage.</p>\n<p>I've based my work partly on the develop branch of the project: <a href=\"https://github.com/NozBead/ActivMotiv/tree/develop\" rel=\"nofollow noreferrer\">https://github.com/NozBead/ActivMotiv/tree/develop</a></p>\n<p>But I'd like to adapt this code for SDK 53.</p>\n<p>At the moment, nothing works.</p>\n<p>Thanks in advance !</p>\n",
    "tags" : [ "java", "android", "kotlin", "expo" ],
    "owner" : {
      "account_id" : 17498445,
      "reputation" : 11,
      "user_id" : 12689266,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/05fe1864251c7e0fba88d106cb97dbf2?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Soleo",
      "link" : "https://stackoverflow.com/users/12689266/soleo"
    },
    "is_answered" : false,
    "view_count" : 72,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1753369176,
    "creation_date" : 1753357999,
    "link" : "https://stackoverflow.com/questions/79713301/how-to-create-a-frame-that-opens-automatically",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79713580,
    "question_id" : 79713301,
    "body" : "<p><code>PresenceReceiver</code> should be also registered in <code>AndroidManifest.xml</code>. Try the following:</p>\n<pre><code> &lt;receiver android:name=&quot;./popup/PresenceReceiver.kt&quot;&gt;\n         &lt;intent-filter&gt;\n             &lt;action android:name=&quot;android.intent.action.ACTION_USER_PRESENT&quot; /&gt;\n             &lt;action android:name=&quot;android.intent.action.ACTION_SCREEN_ON&quot; /&gt;\n     &lt;/intent-filter&gt;\n &lt;/receiver&gt;\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1674773,
      "reputation" : 2044,
      "user_id" : 1540563,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2dd399e0142b8b14b521a9cb6e039623?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "olegr",
      "link" : "https://stackoverflow.com/users/1540563/olegr"
    },
    "creation_date" : 1753369176,
    "last_activity_date" : 1753369176,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79713580" : [ {
      "comment_id" : 140616272,
      "post_id" : 79713580,
      "body" : "Thanks for your reply! I adjusted and added this code to my AndroidManifest.xml, but unfortunately it had no effect. I would also like to point out that I have enabled the “Display over other apps” option and that the application&#39;s “Permissions” menu is disabled. I launch my app using the npx expo run:android command, and I would also like to point out that I know my Kotlin code is being read, as I checked by deliberately adding syntax errors that would cause the compilation to crash, and the crash did indeed occur.",
      "score" : 0,
      "owner" : {
        "account_id" : 17498445,
        "reputation" : 11,
        "user_id" : 12689266,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/05fe1864251c7e0fba88d106cb97dbf2?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Soleo",
        "link" : "https://stackoverflow.com/users/12689266/soleo"
      },
      "creation_date" : 1753388337,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}