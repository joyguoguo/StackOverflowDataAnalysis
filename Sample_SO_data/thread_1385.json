{
  "question" : {
    "question_id" : 79712732,
    "title" : "RestClient POST response is encoded/garbled (Spring Boot 3.5)",
    "body" : "<p>I am trying to submit a POST request to an API to get a JSON payload in Response. My application is a Spring Boot 3.5 application. I am using RestClient to make the request. The request is accepted successfully, but the response I get back in the response body is unprintable / encoded characters. Status Code is 200. I am able to make successful request in Postman</p>\n<p>Here is my constructor code which sets up the RestClient object:</p>\n<pre><code>public VivxWebApiService(RestClient.Builder restClientBuilder, ApplicationLocationConfiguration applicationLocationConfiguration) {\n        List&lt;HttpMessageConverter&lt;?&gt;&gt; vivxHttpMessageConverters = new ArrayList&lt;&gt;();\n        \n        vivxHttpMessageConverters.add(new FormHttpMessageConverter());\n        vivxHttpMessageConverters.add(new MappingJackson2HttpMessageConverter());\n\n        this.restClient = restClientBuilder\n                .baseUrl(applicationLocationConfiguration.getVivxWebApi())\n                .messageConverters(vivxHttpMessageConverters)\n                .build();\n        this.restClient.head().accept(MediaType.APPLICATION_JSON);\n    }\n</code></pre>\n<p>The method that does the actual POST call:</p>\n<pre><code>public void getDesignColors(String designName) {\n        LOG.debug(&quot;Attempting to get design colors for design: {}&quot;, designName);\n        String getColorsUri = &quot;/design/colors&quot;;\n        \n        MultiValueMap&lt;String, String&gt; mvMap = new LinkedMultiValueMap&lt;&gt;();\n        mvMap.add(&quot;name&quot;,designName);\n        \n        ResponseEntity&lt;VivxDesignColorDataResponse&gt; getColorsResponse = restClient.post()\n                .uri(getColorsUri)\n                .contentType(MediaType.APPLICATION_FORM_URLENCODED)\n                .body(mvMap)\n                .retrieve()\n                .toEntity(VivxDesignColorDataResponse.class);\n        LOG.debug(&quot;GetColorResponse: {}&quot;, getColorsResponse);\n    }\n\n</code></pre>\n<p>I have tried many different iterations of using &quot;.toEntity()&quot; or &quot;.body()&quot; to get the response, but nothing seems to work.</p>\n<p>I did put a request interceptor in the RestClient to get debug, and this is what it shows:</p>\n<pre><code>2025-07-23T21:23:03.758-05:00 DEBUG 3000 --- [art-services] [nio-8083-exec-1] c.j.b.a.service.VivxWebApiService        : Attempting to get design colors for design: 3408315_SP032826_71153\n2025-07-23T21:23:03.762-05:00 DEBUG 3000 --- [art-services] [nio-8083-exec-1] o.s.web.client.DefaultRestClient         : Writing [{name=[3408315_SP032826_71153]}] as &quot;application/x-www-form-urlencoded&quot; with org.springframework.http.converter.FormHttpMessageConverter\n2025-07-23T21:23:08.478-05:00  INFO 3000 --- [art-services] [nio-8083-exec-1] c.j.b.a.service.VivxWebApiService        : Request: POST https://devneffvivx.jostensaws.com/vivxwebapi/design/colors\n2025-07-23T21:23:08.478-05:00  INFO 3000 --- [art-services] [nio-8083-exec-1] c.j.b.a.service.VivxWebApiService        : Response headers: [Content-Type:&quot;application/x-www-form-urlencoded&quot;, Content-Length:&quot;27&quot;]\n2025-07-23T21:23:08.478-05:00  INFO 3000 --- [art-services] [nio-8083-exec-1] c.j.b.a.service.VivxWebApiService        : Request body: name=3408315_SP032826_71153\n2025-07-23T21:23:10.645-05:00  INFO 3000 --- [art-services] [nio-8083-exec-1] c.j.b.a.service.VivxWebApiService        : Response status: 200 OK\n2025-07-23T21:23:10.645-05:00  INFO 3000 --- [art-services] [nio-8083-exec-1] c.j.b.a.service.VivxWebApiService        : Response headers: [:status:&quot;200&quot;, access-control-allow-headers:&quot;Content-Type&quot;, access-control-allow-origin:&quot;*&quot;, content-encoding:&quot;gzip&quot;, content-type:&quot;application/json&quot;, date:&quot;Thu, 24 Jul 2025 02:23:08 GMT&quot;, server:&quot;Microsoft-HTTPAPI/2.0&quot;]\n2025-07-23T21:23:14.496-05:00  INFO 3000 --- [art-services] [nio-8083-exec-1] c.j.b.a.service.VivxWebApiService        : Response body: �\n�C�!�=���9�iHq��h껬&amp;\n2025-07-23T21:23:14.498-05:00 DEBUG 3000 --- [art-services] [nio-8083-exec-1] c.j.b.a.service.VivxWebApiService        : GetColorResponse: &lt;200 OK OK,[:status:&quot;200&quot;, access-control-allow-headers:&quot;Content-Type&quot;, access-control-allow-origin:&quot;*&quot;, content-encoding:&quot;gzip&quot;, content-type:&quot;application/json&quot;, date:&quot;Thu, 24 Jul 2025 02:23:08 GMT&quot;, server:&quot;Microsoft-HTTPAPI/2.0&quot;]&gt;\n\n</code></pre>\n<p>Any idea what setup I may have incorrect/missing?</p>\n",
    "tags" : [ "java", "json", "spring", "spring-boot" ],
    "owner" : {
      "account_id" : 202497,
      "reputation" : 293,
      "user_id" : 4603276,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-KXUOaTvYXD8/AAAAAAAAAAI/AAAAAAAABXM/X8jK2ZwfdlU/s256-rj/photo.jpg",
      "display_name" : "B-Wieg",
      "link" : "https://stackoverflow.com/users/4603276/b-wieg"
    },
    "is_answered" : true,
    "view_count" : 115,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1753338284,
    "creation_date" : 1753324579,
    "link" : "https://stackoverflow.com/questions/79712732/restclient-post-response-is-encoded-garbled-spring-boot-3-5",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79712867,
    "question_id" : 79712732,
    "body" : "<pre><code>2025-07-23T21:23:10.645-05:00  INFO 3000 --- [art-services] [nio-8083-exec-1] c.j.b.a.service.VivxWebApiService        : Response headers: [:status:&quot;200&quot;, access-control-allow-headers:&quot;Content-Type&quot;, access-control-allow-origin:&quot;*&quot;, content-encoding:&quot;gzip&quot;, content-type:&quot;application/json&quot;, date:&quot;Thu, 24 Jul 2025 02:23:08 GMT&quot;, server:&quot;Microsoft-HTTPAPI/2.0&quot;]\n</code></pre>\n<p>This line says it all. To be more precise this header <code>content-encoding:&quot;gzip&quot;,</code> gives it away, you are getting a gzipped response. Which you must first decompress before you can use it.</p>\n<p>You can do this in 2 ways</p>\n<ol>\n<li>Use a <code>ClientInterceptor</code> to wrap the incoming response to decompress</li>\n<li>Use a different HTTP client which does the decompression.</li>\n</ol>\n<h2>Response Interceptor</h2>\n<p>First create a custom response</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class GzipDecompressingClientHttpResponse implements ClientHttpResponse {\n\n    private final ClientHttpResponse response;\n\n    public GzipDecompressingClientHttpResponse(ClientHttpResponse response) {\n        this.response = response;\n    }\n\n    @Override\n    public InputStream getBody() throws IOException {\n        InputStream body = response.getBody();\n        if (isGzipped(response)) {\n            return new GZIPInputStream(new BufferedInputStream(body));\n        }\n        return body;\n    }\n\n    private boolean isGzipped(ClientHttpResponse response) {\n        String contentEncoding = response.getHeaders().getFirst(&quot;Content-Encoding&quot;);\n        return contentEncoding != null &amp;&amp; contentEncoding.toLowerCase().contains(&quot;gzip&quot;);\n    }\n\n\n    @Override\n    public HttpStatusCode getStatusCode() throws IOException {\n        return response.getStatusCode();\n    }\n\n    @Override\n    public String getStatusText() throws IOException {\n        return response.getStatusText();\n    }\n\n    @Override\n    public void close() {\n        response.close();\n    }\n\n    @Override\n    public org.springframework.http.HttpHeaders getHeaders() {\n        return response.getHeaders();\n    }\n}\n</code></pre>\n<p>Then add an interceptor to wrap the incoming <code>ClientResponse</code> with this <code>GzipDecompressingClientHttpResponse</code>.</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class GzipResponseInterceptor implements ClientHttpRequestInterceptor {\n\n  public ClientHttpResponse intercept(HttpRequest request, byte[] body, ClientHttpRequestExecution execution)\n            throws IOException {\n    return new GzipDecompressingClientHttpResponse(execution.execute(request, body));\n  }\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>this.restClient = restClientBuilder\n    .baseUrl(applicationLocationConfiguration.getVivxWebApi())\n    .messageConverters(vivxHttpMessageConverters)\n    .requestInterceptor(new GzipResponseInterceptor());\n    .build();\n</code></pre>\n<p>Benefit of this solution is that it will work regardless of the technology in use.</p>\n<h2>Use Apache Http Client</h2>\n<p>You can also switch the HTTP client used by the <code>RestClient</code> when using the default it will use the JDK provided HTTP client. You can switch this to one that automatically will support gzip responses, like Apache Http Client.</p>\n<p>You will need to add a dependency on the client and configure the builder to take that as the HTTP client to use.</p>\n<pre class=\"lang-java prettyprint-override\"><code>this.restClient = restClientBuilder\n    .baseUrl(applicationLocationConfiguration.getVivxWebApi())\n    .messageConverters(vivxHttpMessageConverters)\n    .requestFactory(new HttpComponentsClientHttpRequestFactory(HttpClientBuilder.create().build())););\n    .build();\n</code></pre>\n<p>This will work without adding an additional interceptor, drawback is you need an additional dependency.</p>\n<p>See also <a href=\"https://stackoverflow.com/questions/34415144/how-to-parse-gzip-encoded-response-with-resttemplate-in-spring-web\">this answer</a> and <a href=\"https://bootcamptoprod.com/gzip-compressed-requests-and-responses/#31-approach-1-using-a-response-interceptor\" rel=\"nofollow noreferrer\">this blog</a> which were used as inspiration for this answer.</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126800,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1753338284,
    "last_activity_date" : 1753338284,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140613931,
    "post_id" : 79712732,
    "body" : "Have you really looked at the response you get (hint look at the headers). The <code>content-encoding:&quot;gzip&quot;</code> is the give-away here. You get a zipped response, meaning you cannot directly read it as it is gzipped. You will need to unzip it. You can either add an interceptor or use a different client library as mentioned in <a href=\"https://stackoverflow.com/questions/34415144/how-to-parse-gzip-encoded-response-with-resttemplate-in-spring-web\" title=\"how to parse gzip encoded response with resttemplate in spring web\">stackoverflow.com/questions/34415144/&hellip;</a>. Or check <a href=\"https://bootcamptoprod.com/gzip-compressed-requests-and-responses/\" rel=\"nofollow noreferrer\">bootcamptoprod.com/gzip-compressed-requests-and-responses</a> which explains both approaches.",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126800,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1753337185,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140613839,
    "post_id" : 79712732,
    "body" : "@AndreyMetelyov - Yeah, I have gone through those spring docs and tried the various examples and haven&#39;t been able to get the response to be un-encoded into a normal String or to be de-serialized into a VivxDesignColorDataResponse object that I have defined.",
    "score" : 0,
    "owner" : {
      "account_id" : 202497,
      "reputation" : 293,
      "user_id" : 4603276,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-KXUOaTvYXD8/AAAAAAAAAAI/AAAAAAAABXM/X8jK2ZwfdlU/s256-rj/photo.jpg",
      "display_name" : "B-Wieg",
      "link" : "https://stackoverflow.com/users/4603276/b-wieg"
    },
    "creation_date" : 1753332540,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140613751,
    "post_id" : 79712732,
    "body" : "have you tried all the examples listed in documentation? <a href=\"https://docs.spring.io/spring-framework/reference/integration/rest-clients.html#rest-restclient\" rel=\"nofollow noreferrer\">docs.spring.io/spring-framework/reference/integration/&hellip;</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 22223068,
      "reputation" : 3,
      "user_id" : 16460395,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/8f2488866d34fa0c64207bea9b8be9d5?s=256&d=identicon&r=PG",
      "display_name" : "Andrey Metelyov",
      "link" : "https://stackoverflow.com/users/16460395/andrey-metelyov"
    },
    "creation_date" : 1753327293,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79712867" : [ {
      "comment_id" : 140615021,
      "post_id" : 79712867,
      "body" : "This worked perfectly! Thanks for your very helpful answer! Adding the GZIP interceptor was the way to go for me. I noticed the GZIP in the header, but since I saw the same thing in Postman, it didn&#39;t occur to me that it wouldn&#39;t be automatically handled with the RestClient. Incorporating new libraries can tend to throw a few hiccups, but I&#39;m glad you were able to lead me in the right direction!",
      "score" : 1,
      "owner" : {
        "account_id" : 202497,
        "reputation" : 293,
        "user_id" : 4603276,
        "user_type" : "registered",
        "profile_image" : "https://lh4.googleusercontent.com/-KXUOaTvYXD8/AAAAAAAAAAI/AAAAAAAABXM/X8jK2ZwfdlU/s256-rj/photo.jpg",
        "display_name" : "B-Wieg",
        "link" : "https://stackoverflow.com/users/4603276/b-wieg"
      },
      "creation_date" : 1753361155,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}