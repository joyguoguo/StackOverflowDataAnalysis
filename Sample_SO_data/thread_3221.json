{
  "question" : {
    "question_id" : 79564086,
    "title" : "Quarkus: 3rd party module not included in native image classpath",
    "body" : "<p>I'm using <a href=\"https://mvnrepository.com/artifact/org.simplejavamail/simple-java-mail/8.12.4\" rel=\"nofollow noreferrer\">simplejavamail</a> in my Quarkus application. I have both the library and its batch-module included in my pom.xml:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>    &lt;dependency&gt;\n      &lt;groupId&gt;org.simplejavamail&lt;/groupId&gt;\n      &lt;artifactId&gt;simple-java-mail&lt;/artifactId&gt;\n      &lt;version&gt;8.12.4&lt;/version&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.simplejavamail&lt;/groupId&gt;\n      &lt;artifactId&gt;batch-module&lt;/artifactId&gt;\n      &lt;version&gt;8.12.4&lt;/version&gt;\n    &lt;/dependency&gt;\n</code></pre>\n<p>My code works fine in dev environment, but after building the native image, I get this error:</p>\n<pre><code>org.simplejavamail.internal.moduleloader.ModuleLoaderException: Batch module not found, make sure it is on the classpath (https://github.com/bbottema/simple-java-mail/tree/develop/modules/batch-module)\n        at org.simplejavamail.internal.moduleloader.ModuleLoader.loadModule(ModuleLoader.java:133)\n        at org.simplejavamail.internal.moduleloader.ModuleLoader.loadBatchModule(ModuleLoader.java:95)\n        at org.simplejavamail.mailer.internal.MailerGenericBuilderImpl.determineDefaultExecutorService(MailerGenericBuilderImpl.java:674)\n        at org.simplejavamail.mailer.internal.MailerGenericBuilderImpl.buildOperationalConfig(MailerGenericBuilderImpl.java:319)\n        at org.simplejavamail.mailer.internal.MailerImpl.&lt;init&gt;(MailerImpl.java:128)\n        at org.simplejavamail.mailer.internal.MailerRegularBuilderImpl.buildMailer(MailerRegularBuilderImpl.java:212)\n</code></pre>\n<p>I have tried <a href=\"https://quarkus.io/guides/writing-native-applications-tips#registering-for-reflection\" rel=\"nofollow noreferrer\">registering the BatchModule class for reflection</a> with no success:</p>\n<pre class=\"lang-java prettyprint-override\"><code>import io.quarkus.runtime.annotations.RegisterForReflection;\nimport org.simplejavamail.internal.modules.BatchModule;\n\n@RegisterForReflection(targets = {\n  BatchModule.class\n})\npublic class LibReflectionRegister {\n}\n</code></pre>\n<p>How do I fix this?</p>\n<p>P.S. I don't know if this problem is related to this property I set to address another build error:</p>\n<pre class=\"lang-yaml prettyprint-override\"><code>quarkus:\n  native:\n    additional-build-args: &quot;--initialize-at-run-time=org.simplejavamail.internal.util.MiscUtil&quot;\n</code></pre>\n",
    "tags" : [ "java", "quarkus", "graalvm-native-image", "quarkus-native", "simple-java-mail" ],
    "owner" : {
      "account_id" : 19519664,
      "reputation" : 80,
      "user_id" : 14281832,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-kPyxRuBI_iM/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucnLrVy00zUsnVmlDu2cidBPJ3gr4Q/s256-rj/photo.jpg",
      "display_name" : "Minh Long Vu",
      "link" : "https://stackoverflow.com/users/14281832/minh-long-vu"
    },
    "is_answered" : true,
    "view_count" : 93,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1744288597,
    "creation_date" : 1744194173,
    "link" : "https://stackoverflow.com/questions/79564086/quarkus-3rd-party-module-not-included-in-native-image-classpath",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79566671,
    "question_id" : 79564086,
    "body" : "<p>As you already noticed <code>simplejavamail</code> is not supported by Quarkus and thus requires some extra configuration to make it work in native mode.</p>\n<p>Looking at <a href=\"https://github.com/bbottema/simple-java-mail/blob/ac9a42997c062cdb8f48dfa112930cc1c8d04af1/modules/simple-java-mail/src/main/java/org/simplejavamail/internal/moduleloader/ModuleLoader.java#L75-L87\" rel=\"nofollow noreferrer\">https://github.com/bbottema/simple-java-mail/blob/ac9a42997c062cdb8f48dfa112930cc1c8d04af1/modules/simple-java-mail/src/main/java/org/simplejavamail/internal/moduleloader/ModuleLoader.java#L75-L87</a> my understanding is that the code is using <code>org.simplejavamail.internal.batchsupport.BatchSupport</code> to assess if the module is available or not. So you would need to register this class for reflection, but I am afraid this will only allow you to move past this error till you hit a different one.</p>\n<p>Runtime initializing <code>org.simplejavamail.internal.moduleloader.ModuleLoader</code> might be necessary as well.</p>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 1133977,
      "reputation" : 2090,
      "user_id" : 1119431,
      "user_type" : "registered",
      "accept_rate" : 80,
      "profile_image" : "https://www.gravatar.com/avatar/8df28305c3e61591f9c985aab4b0dc8c?s=256&d=identicon&r=PG",
      "display_name" : "zakkak",
      "link" : "https://stackoverflow.com/users/1119431/zakkak"
    },
    "creation_date" : 1744288597,
    "last_activity_date" : 1744288597,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}