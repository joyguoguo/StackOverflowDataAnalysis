{
  "question" : {
    "question_id" : 79620887,
    "title" : "Maven downgrades transitive dependency scopes",
    "body" : "<p>Let's assume I have a simple Java project. For some reason I need, let's say, some <code>StringUtil</code> class in my tests. So, I add the dependency with a <code>test</code> scope. This works fine and it as it should be.</p>\n<p>But if someone in the future either adds the <code>StringUtil</code> dependency to any of my <code>compile</code> dependencies - or if I add a new <code>compile</code> dependency which also uses it - maven will still see it as a <code>test</code> dependency without any warning or similar - well documented <a href=\"https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html#Dependency_Scope\" rel=\"nofollow noreferrer\">here</a>, even if the dependency actually also needs it during runtime.</p>\n<p>In combination with the spring boot maven plugin, which packages a fat jar, this seems very dangerous, because as <code>test</code>, the <code>StringUtil</code> will not be part of that fat jar, leading to quite obvious runtime problems.</p>\n<p>Anyone ever encountered that and found a good way to handle it?</p>\n",
    "tags" : [ "java", "maven", "dependency-management", "spring-boot-maven-plugin" ],
    "owner" : {
      "account_id" : 5955901,
      "reputation" : 10682,
      "user_id" : 4682610,
      "user_type" : "registered",
      "accept_rate" : 29,
      "profile_image" : "https://i.sstatic.net/sMhnZ.jpg?s=256",
      "display_name" : "Florian Schaetz",
      "link" : "https://stackoverflow.com/users/4682610/florian-schaetz"
    },
    "is_answered" : false,
    "view_count" : 88,
    "answer_count" : 1,
    "score" : 2,
    "last_activity_date" : 1747213816,
    "creation_date" : 1747206243,
    "link" : "https://stackoverflow.com/questions/79620887/maven-downgrades-transitive-dependency-scopes",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79621098,
    "question_id" : 79620887,
    "body" : "<p>Dependency Mediation is gambling, if you want to be sure about versions and scopes, use <code>&lt;dependencyManagement&gt;</code> to fix them.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 888714,
      "reputation" : 36707,
      "user_id" : 927493,
      "user_type" : "registered",
      "accept_rate" : 61,
      "profile_image" : "https://i.sstatic.net/sxsnm.png?s=256",
      "display_name" : "JF Meier",
      "link" : "https://stackoverflow.com/users/927493/jf-meier"
    },
    "creation_date" : 1747213816,
    "last_activity_date" : 1747213816,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140425944,
    "post_id" : 79620887,
    "body" : "Personally, we found this problem a while ago and I actually produced a bug that then only showed on staging this way. It does happen. And it&#39;s really hard to notice unless you ignore maven and manually check all(!) your dependencies, including the transient ones. Which nobody wants to do.",
    "score" : 0,
    "owner" : {
      "account_id" : 5955901,
      "reputation" : 10682,
      "user_id" : 4682610,
      "user_type" : "registered",
      "accept_rate" : 29,
      "profile_image" : "https://i.sstatic.net/sMhnZ.jpg?s=256",
      "display_name" : "Florian Schaetz",
      "link" : "https://stackoverflow.com/users/4682610/florian-schaetz"
    },
    "creation_date" : 1747242326,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140425450,
    "post_id" : 79620887,
    "body" : "@JFabianMeier, then the dependency info that you explicitly declare in pom.xml can be ignored and be overwritten by the transitive info? Naah.. That would confuse everyone. I could tentatively agree that for scopes it may make sense, but I&#39;d certainly not choose the latest version. Latest doesn&#39;t mean better.",
    "score" : 0,
    "owner" : {
      "account_id" : 476019,
      "reputation" : 15556,
      "user_id" : 886697,
      "user_type" : "registered",
      "accept_rate" : 92,
      "profile_image" : "https://i.sstatic.net/b5Dq4.jpg?s=256",
      "display_name" : "Stanislav Bashkyrtsev",
      "link" : "https://stackoverflow.com/users/886697/stanislav-bashkyrtsev"
    },
    "creation_date" : 1747234273,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140425025,
    "post_id" : 79620887,
    "body" : "@StanislavBashkyrtsev It does not really sound sensible to me. What you usually want is the highest version and the largest scope, so if you e.g. encounter the same dependency with <code>test</code> scope and <code>compile</code> scope, you want <code>compile</code>, and this does not depend on which dependency is &quot;nearer to the root&quot;.",
    "score" : 1,
    "owner" : {
      "account_id" : 888714,
      "reputation" : 36707,
      "user_id" : 927493,
      "user_type" : "registered",
      "accept_rate" : 61,
      "profile_image" : "https://i.sstatic.net/sxsnm.png?s=256",
      "display_name" : "JF Meier",
      "link" : "https://stackoverflow.com/users/927493/jf-meier"
    },
    "creation_date" : 1747227443,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140424711,
    "post_id" : 79620887,
    "body" : "The closer the dependency to the root in the dependency hierarchy, the higher the priorities of its settings like scope - that&#39;s true, and it sounds sensible. This can go unnoticed, as you mentioned, only when it&#39;s a runtime dependency, which is a rare thing.. Personally, I&#39;ve never run into problems like this in the last 16 years, sound like quite an edge case.",
    "score" : 0,
    "owner" : {
      "account_id" : 476019,
      "reputation" : 15556,
      "user_id" : 886697,
      "user_type" : "registered",
      "accept_rate" : 92,
      "profile_image" : "https://i.sstatic.net/b5Dq4.jpg?s=256",
      "display_name" : "Stanislav Bashkyrtsev",
      "link" : "https://stackoverflow.com/users/886697/stanislav-bashkyrtsev"
    },
    "creation_date" : 1747222485,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79621098" : [ {
      "comment_id" : 140426059,
      "post_id" : 79621098,
      "body" : "Firstly, you don&#39;t need to check all transitive dependencies, only those which you also use in <code>test</code> scope. You could filter <code>mvn dependency:tree</code> for that. Secondly, it would certainly be possible to write an enforcer rule analogous to <a href=\"https://maven.apache.org/enforcer/enforcer-rules/requireUpperBoundDeps.html\" rel=\"nofollow noreferrer\">maven.apache.org/enforcer/enforcer-rules/&hellip;</a> to check if one of your transitive dependencies was &quot;downgraded in scope&quot; and then fail the build. This saves you manually checking beforehand, and only requires you to fix the cases found by the rule. Changing the dependency mediation itself is maybe possible through extensions.",
      "score" : 0,
      "owner" : {
        "account_id" : 888714,
        "reputation" : 36707,
        "user_id" : 927493,
        "user_type" : "registered",
        "accept_rate" : 61,
        "profile_image" : "https://i.sstatic.net/sxsnm.png?s=256",
        "display_name" : "JF Meier",
        "link" : "https://stackoverflow.com/users/927493/jf-meier"
      },
      "creation_date" : 1747244666,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140425940,
      "post_id" : 79621098,
      "body" : "This implies that I manually check all the transitive dependencies which is really not what I want. I want to tell maven that my code need this for tests but maven should figure out that one of my transitive dependencies wants more from this relationship and thus it gets it.",
      "score" : 0,
      "owner" : {
        "account_id" : 5955901,
        "reputation" : 10682,
        "user_id" : 4682610,
        "user_type" : "registered",
        "accept_rate" : 29,
        "profile_image" : "https://i.sstatic.net/sMhnZ.jpg?s=256",
        "display_name" : "Florian Schaetz",
        "link" : "https://stackoverflow.com/users/4682610/florian-schaetz"
      },
      "creation_date" : 1747242230,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140425018,
      "post_id" : 79621098,
      "body" : "@Robert Maven has an internal mechanism called &quot;Dependency Mediation&quot; to find out which version/scope to use if Maven encounters a (transitive) dependency at least twice. The logic is &quot;nearest dependency wins&quot;, which is often not what you really want. So the way to go is to use the <code>&lt;dependencyManagement&gt;</code> section of your <code>pom.xml</code> to fix versions and scopes of your (transitive) dependencies so that will be no surprises.",
      "score" : 0,
      "owner" : {
        "account_id" : 888714,
        "reputation" : 36707,
        "user_id" : 927493,
        "user_type" : "registered",
        "accept_rate" : 61,
        "profile_image" : "https://i.sstatic.net/sxsnm.png?s=256",
        "display_name" : "JF Meier",
        "link" : "https://stackoverflow.com/users/927493/jf-meier"
      },
      "creation_date" : 1747227361,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140425005,
      "post_id" : 79621098,
      "body" : "Sorry but I don&#39;t understand what you want to say with this short answer.",
      "score" : 0,
      "owner" : {
        "account_id" : 50585,
        "reputation" : 43459,
        "user_id" : 150978,
        "user_type" : "registered",
        "accept_rate" : 78,
        "profile_image" : "https://www.gravatar.com/avatar/feadc214792e2581c3c750140e3eb2c7?s=256&d=identicon&r=PG",
        "display_name" : "Robert",
        "link" : "https://stackoverflow.com/users/150978/robert"
      },
      "creation_date" : 1747227109,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}