{
  "question" : {
    "question_id" : 79639057,
    "title" : "Message loss in KafkaListener",
    "body" : "<p>I’ve encountered an issue in my project related to Kafka message consumption. When a message is published to a Kafka topic, the KafkaListener successfully reads and commits the offset for most of the messages. However, it appears that for certain messages, there is an underlying problem — these messages seem to disappear upon reaching the listener without leaving any trace or triggering any errors or exceptions.</p>\n<p>It’s important to note that this issue occurs intermittently. In approximately 90% of the cases, everything works as expected, and the messages are processed correctly. However, in about 10% of the cases, the listener does not process the message at all — the message is sometimes read and sometimes not, even though it was published. This inconsistent behavior is specifically observed with certain messages that are inconsistently consumed</p>\n<pre><code>    public void sendCartablErrorMessage(String erroMessage, String errorCode, String cartableTrackingNo) {\n\n        String topicName = &quot;CCM_COMMIT_ERROR_REQUEST&quot;;\n        CartableCommitMessage cartableCommitMessage = new CartableCommitMessage(\n                errorCode, erroMessage,\n                Long.valueOf(cartableTrackingNo));\n        sendCartablMessageInCntCcmTest(cartableCommitMessage);\n        log.error(&quot;Cartable Error Message sent to kafka :&quot;+cartableTrackingNo);\n    }\n</code></pre>\n<hr />\n<pre><code>    public void sendCartablMessageInCntCcmTest(CartableCommitMessage cartableCommitMessage) {\n        String topicName = Topics.CNT_CCM_TEST;\n        kafkaTemplate.send(topicName, cartableCommitMessage);\n    }\n</code></pre>\n<hr />\n<pre><code>    @KafkaListener(topics = Topics.CNT_CCM_TEST,containerFactory = &quot;kafkaListenerContainerFactoryAutoAck&quot;)\n    public void onConfirmPayCartableEventTest(CartableCommitMessage request) throws JsonProcessingException {\n        log.info(&quot;Start CNT_CCM_TEST Listener..............&quot;);\n\n        try {\n            log.info(&quot;**********Cartable Listener RAW Topics.CNT_CCM_TEST : {}&quot;, new ObjectMapper().writeValueAsString(request));\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n</code></pre>\n",
    "tags" : [ "java", "apache-kafka", "spring-kafka" ],
    "owner" : {
      "account_id" : 11830160,
      "reputation" : 1,
      "user_id" : 8657108,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/51Y9lZ0H.png?s=256",
      "display_name" : "mohammadHosseinBiadar",
      "link" : "https://stackoverflow.com/users/8657108/mohammadhosseinbiadar"
    },
    "is_answered" : false,
    "view_count" : 39,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1748299360,
    "creation_date" : 1748267597,
    "link" : "https://stackoverflow.com/questions/79639057/message-loss-in-kafkalistener",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140460382,
    "post_id" : 79639057,
    "body" : "your listener has a catch all error, therefore preventing the upstream kafka process to know that an error happened, then commit the message. The upstream process for the kafka libreary in spring needs to know an error happened, if you are catching it, nothing happened. Remove the try catch and see what happens.",
    "score" : 3,
    "owner" : {
      "account_id" : 209503,
      "reputation" : 23867,
      "user_id" : 460557,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/b4565f97815833390c9c880e9e8522e4?s=256&d=identicon&r=PG",
      "display_name" : "Jorge Campos",
      "link" : "https://stackoverflow.com/users/460557/jorge-campos"
    },
    "creation_date" : 1748281216,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}