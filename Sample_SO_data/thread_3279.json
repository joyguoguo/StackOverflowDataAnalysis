{
  "question" : {
    "question_id" : 79559751,
    "title" : "CORS strict-origin-when-cross-origin",
    "body" : "<p>I seem to be running into some issues with my CORS configurations. I am using Keycloak for my authentication. All of my endpoints are redirected to a login page, with an error 302 (Found). When I checked the request in network I saw that I get &quot;strict-origin-when-cross-origin&quot; as a referrer policy. I have put my SecurityConfig in my API Gateway, and have ensured I am using the correct endpoint, but it still seems to be throwing this error. Can someone give me a hint what could I have configured wrong? Thank you! :)</p>\n<blockquote>\n<p>Access to XMLHttpRequest at\n'http://localhost:8078/api-category/getAll' from origin\n'http://localhost:5173' has been blocked by CORS policy: No\n'Access-Control-Allow-Origin' header is present on the requested\nresource. homepage.tsx:42</p>\n<p>AxiosError {message: 'Network Error', name: 'AxiosError', code:\n'ERR_NETWORK', config: {…}, request: XMLHttpRequest, …} (anonymous) @\nhomepage.tsx:42 Promise.catch (anonymous) @ homepage.tsx:42\nreact-stack-bottom-frame @ react-dom_client.js?v=6e2d2c08:16242\nrunWithFiberInDEV @ react-dom_client.js?v=6e2d2c08:726\ncommitHookEffectListMount @ react-dom_client.js?v=6e2d2c08:7767\ncommitHookPassiveMountEffects @ react-dom_client.js?v=6e2d2c08:7825\ncommitPassiveMountOnFiber @ react-dom_client.js?v=6e2d2c08:9182\nrecursivelyTraversePassiveMountEffects @\nreact-dom_client.js?v=6e2d2c08:9163 commitPassiveMountOnFiber @\nreact-dom_client.js?v=6e2d2c08:9265\nrecursivelyTraversePassiveMountEffects @\nreact-dom_client.js?v=6e2d2c08:9163 commitPassiveMountOnFiber @\nreact-dom_client.js?v=6e2d2c08:9176\nrecursivelyTraversePassiveMountEffects @\nreact-dom_client.js?v=6e2d2c08:9163 commitPassiveMountOnFiber @\nreact-dom_client.js?v=6e2d2c08:9176\nrecursivelyTraversePassiveMountEffects @\nreact-dom_client.js?v=6e2d2c08:9163 commitPassiveMountOnFiber @\nreact-dom_client.js?v=6e2d2c08:9265\nrecursivelyTraversePassiveMountEffects @\nreact-dom_client.js?v=6e2d2c08:9163 commitPassiveMountOnFiber @\nreact-dom_client.js?v=6e2d2c08:9265\nrecursivelyTraversePassiveMountEffects @\nreact-dom_client.js?v=6e2d2c08:9163 commitPassiveMountOnFiber @\nreact-dom_client.js?v=6e2d2c08:9176\nrecursivelyTraversePassiveMountEffects @\nreact-dom_client.js?v=6e2d2c08:9163 commitPassiveMountOnFiber @\nreact-dom_client.js?v=6e2d2c08:9176\nrecursivelyTraversePassiveMountEffects @\nreact-dom_client.js?v=6e2d2c08:9163 commitPassiveMountOnFiber @\nreact-dom_client.js?v=6e2d2c08:9176\nrecursivelyTraversePassiveMountEffects @\nreact-dom_client.js?v=6e2d2c08:9163 commitPassiveMountOnFiber @\nreact-dom_client.js?v=6e2d2c08:9265\nrecursivelyTraversePassiveMountEffects @\nreact-dom_client.js?v=6e2d2c08:9163 commitPassiveMountOnFiber @\nreact-dom_client.js?v=6e2d2c08:9176\nrecursivelyTraversePassiveMountEffects @\nreact-dom_client.js?v=6e2d2c08:9163 commitPassiveMountOnFiber @\nreact-dom_client.js?v=6e2d2c08:9265\nrecursivelyTraversePassiveMountEffects @\nreact-dom_client.js?v=6e2d2c08:9163 commitPassiveMountOnFiber @\nreact-dom_client.js?v=6e2d2c08:9186 flushPassiveEffects @\nreact-dom_client.js?v=6e2d2c08:11119 performSyncWorkOnRoot @\nreact-dom_client.js?v=6e2d2c08:11445 flushSyncWorkAcrossRoots_impl @\nreact-dom_client.js?v=6e2d2c08:11356 commitRootImpl @\nreact-dom_client.js?v=6e2d2c08:11073 commitRoot @\nreact-dom_client.js?v=6e2d2c08:10989 commitRootWhenReady @\nreact-dom_client.js?v=6e2d2c08:10477 performWorkOnRoot @\nreact-dom_client.js?v=6e2d2c08:10421 performWorkOnRootViaSchedulerTask\n@ react-dom_client.js?v=6e2d2c08:11436 performWorkUntilDeadline @\nreact-dom_client.js?v=6e2d2c08:35 CategoryService.tsx:14</p>\n<p>GET\nhttp://localhost:8078/api-category/getAll net::ERR_FAILED 302 (Found)Error fetching the categories:</p>\n</blockquote>\n<pre><code>\n@EnableWebFluxSecurity\n@EnableMethodSecurity(jsr250Enabled = true)\n@Configuration\npublic class SecurityConfig {\n\n    @Bean\n    public SecurityWebFilterChain securityWebFilterChain(ServerHttpSecurity http) {\n        return http\n                .csrf(ServerHttpSecurity.CsrfSpec::disable)\n                .cors(cors -&gt; cors.configurationSource(corsConfigurationSource()))\n                .authorizeExchange(exchanges -&gt; exchanges\n                        .pathMatchers(HttpMethod.OPTIONS, &quot;/**&quot;).permitAll()\n                        .pathMatchers(HttpMethod.GET, &quot;/category-service/category/getAll&quot;).permitAll()\n                        .anyExchange().authenticated()\n                )\n                .exceptionHandling(handling -&gt; handling\n                        .authenticationEntryPoint((exchange, ex) -&gt;\n                                Mono.fromRunnable(() -&gt; {\n                                    exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);\n                                })\n                        )\n                )\n                .build();\n    }\n\n    @Bean\n    public UrlBasedCorsConfigurationSource corsConfigurationSource() {\n        CorsConfiguration corsConfig = new CorsConfiguration();\n        corsConfig.setAllowedOrigins(List.of(&quot;http://localhost:5173&quot;));\n        corsConfig.setAllowedMethods(List.of(&quot;GET&quot;, &quot;POST&quot;, &quot;OPTIONS&quot;));\n        corsConfig.setAllowedHeaders(List.of(&quot;Origin&quot;, &quot;Content-Type&quot;, &quot;Accept&quot;, &quot;Authorization&quot;));\n        corsConfig.setAllowCredentials(true);\n\n        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();\n        source.registerCorsConfiguration(&quot;/**&quot;, corsConfig);\n        return source;\n    }\n}\n\n\n</code></pre>\n<p>As you can see in the UrlBasedCorsConfigurationSource, I have allowed all methods of localhost:5173, but it still does not work.</p>\n<p><a href=\"https://i.sstatic.net/AKCeX8JT.png\" rel=\"nofollow noreferrer\">Keycloak Config</a></p>\n<pre><code>\nconst keycloak = new Keycloak({\n  \n  url: &quot;http://localhost:8080/&quot;,\n  realm: &quot;pibble-tv&quot;,\n  clientId: &quot;pibbletv-frontend&quot;,\n\n});\n\n\n</code></pre>\n",
    "tags" : [ "java", "cors", "microservices", "keycloak", "cross-domain" ],
    "owner" : {
      "account_id" : 40948960,
      "reputation" : 1,
      "user_id" : 30043063,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/55360c810d47518b42e4f3bcf0d71698?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Hristo Ganchev",
      "link" : "https://stackoverflow.com/users/30043063/hristo-ganchev"
    },
    "is_answered" : true,
    "view_count" : 285,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1748530058,
    "creation_date" : 1744024983,
    "link" : "https://stackoverflow.com/questions/79559751/cors-strict-origin-when-cross-origin",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79559891,
    "question_id" : 79559751,
    "body" : "<p>Maybe try using <code>org.springframework.web.cors.reactive.CorsConfigurationSource</code> instead of the servlet-based <code>UrlBasedCorsConfigurationSource</code></p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 16396964,
      "reputation" : 1,
      "user_id" : 11844183,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-IOYmLuzO_F4/AAAAAAAAAAI/AAAAAAAAELk/vBc4On0-tKQ/s256-rj/photo.jpg",
      "display_name" : "Rohan",
      "link" : "https://stackoverflow.com/users/11844183/rohan"
    },
    "creation_date" : 1744029043,
    "last_activity_date" : 1744029043,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79644116,
    "question_id" : 79559751,
    "body" : "<p>So, I managed to find the error, and it was a very stupid one. Spring did not detect my SecurityConfig file at all, and this is why none of my configurations worked.</p>\n<p>To ensure everything is working, make sure that you put the SecurityConfig on the same level as your Application file! Then, everything should be working fine. :)</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 40948960,
      "reputation" : 1,
      "user_id" : 30043063,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/55360c810d47518b42e4f3bcf0d71698?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Hristo Ganchev",
      "link" : "https://stackoverflow.com/users/30043063/hristo-ganchev"
    },
    "creation_date" : 1748530058,
    "last_activity_date" : 1748530058,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140311636,
    "post_id" : 79559751,
    "body" : "Yess! I just did that.",
    "score" : 0,
    "owner" : {
      "account_id" : 40948960,
      "reputation" : 1,
      "user_id" : 30043063,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/55360c810d47518b42e4f3bcf0d71698?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Hristo Ganchev",
      "link" : "https://stackoverflow.com/users/30043063/hristo-ganchev"
    },
    "creation_date" : 1744114292,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140310259,
    "post_id" : 79559751,
    "body" : "Do you mind pasting the error stack trace as text with the question as well?",
    "score" : 0,
    "owner" : {
      "account_id" : 14482834,
      "reputation" : 5468,
      "user_id" : 10461625,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/fgo5D.jpg?s=256",
      "display_name" : "PatPanda",
      "link" : "https://stackoverflow.com/users/10461625/patpanda"
    },
    "creation_date" : 1744089093,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140307557,
    "post_id" : 79559751,
    "body" : "<code>strict-origin-when-cross-origin</code> has nothing to do with CORS and everything to do with Referrer Policy.",
    "score" : 0,
    "owner" : {
      "account_id" : 2021661,
      "reputation" : 67260,
      "user_id" : 2541573,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://i.sstatic.net/Z1qtP.png?s=256",
      "display_name" : "jub0bs",
      "link" : "https://stackoverflow.com/users/2541573/jub0bs"
    },
    "creation_date" : 1744026323,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79559891" : [ {
      "comment_id" : 140320107,
      "post_id" : 79559891,
      "body" : "Hello! I just did that in my new update. I still cannot find the reason why I am getting the CORS errors, but maybe it has to do with the way I have set up my Web Origins.",
      "score" : 0,
      "owner" : {
        "account_id" : 40948960,
        "reputation" : 1,
        "user_id" : 30043063,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/55360c810d47518b42e4f3bcf0d71698?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Hristo Ganchev",
        "link" : "https://stackoverflow.com/users/30043063/hristo-ganchev"
      },
      "creation_date" : 1744284583,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140316161,
      "post_id" : 79559891,
      "body" : "Could you provide your keycloak config? Both from keycloak and codebase",
      "score" : 0,
      "owner" : {
        "account_id" : 16396964,
        "reputation" : 1,
        "user_id" : 11844183,
        "user_type" : "registered",
        "profile_image" : "https://lh4.googleusercontent.com/-IOYmLuzO_F4/AAAAAAAAAAI/AAAAAAAAELk/vBc4On0-tKQ/s256-rj/photo.jpg",
        "display_name" : "Rohan",
        "link" : "https://stackoverflow.com/users/11844183/rohan"
      },
      "creation_date" : 1744204195,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140311638,
      "post_id" : 79559891,
      "body" : "I just tried using CorsConfigurationSource instead and I still get the same error :/ I wonder if the issue might be from Keycloak, but I didn&#39;t find anything wrong there.",
      "score" : 0,
      "owner" : {
        "account_id" : 40948960,
        "reputation" : 1,
        "user_id" : 30043063,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/55360c810d47518b42e4f3bcf0d71698?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Hristo Ganchev",
        "link" : "https://stackoverflow.com/users/30043063/hristo-ganchev"
      },
      "creation_date" : 1744114318,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}