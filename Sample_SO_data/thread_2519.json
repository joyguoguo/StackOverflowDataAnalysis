{
  "question" : {
    "question_id" : 79615121,
    "title" : "RestTemplate.postForObject() is throwing RestClientException because the request JSONObject is null",
    "body" : "<p>I am trying to call a PostMapping endpoint from a GetMapping endpoint using the <em>RestTemplate.postForObject()</em> api call. But always getting a <strong>RestClientException</strong> saying that the request JSONObject is &quot;null&quot;.</p>\n<p>The code I am using:</p>\n<pre><code>JSONObject responseObject = new JSONObject();\nJSONObject requestObject = new JSONObject();\nString url = &quot;https://thirdpParty_API.com/api/auth/login&quot;;\ntry {\n            requestObject.put(&quot;userName&quot;, &quot;Tom&quot;);\n            requestObject.put(&quot;password&quot;, &quot;Pass@12345&quot;);\n            responseObject = restTemplate.postForObject(url, requestObject , JSONObject.class);\n} catch(RestClientException rex) {\n            logger.error(&quot;RestClientException occured : &quot;+rex.getMessage());\n            return ResponseEntity.badRequest().build();\n        }\nreturn ResponseEntity.ok(responseObject);\n</code></pre>\n<p>The PostMapping is expecting a json RequestBody like this:</p>\n<pre><code>{\n  &quot;userName&quot;: &quot;Tom&quot;,\n  &quot;password&quot;: &quot;Pass@12345&quot;\n}\n</code></pre>\n<p>But every time I'm getting RestClientException like <strong>userName: must not be null, password: must not be null</strong>.</p>\n<p>Exception is this:</p>\n<blockquote>\n<p>org.springframework.web.client.HttpClientErrorException$BadRequest: 400  on POST request for &quot;https://thirdpParty_API.com/api/auth/login&quot;: &quot;{&quot;type&quot;:&quot;urn:problem-type:bad-request&quot;,&quot;title&quot;:&quot;Bad Request&quot;,&quot;status&quot;:400,&quot;detail&quot;:&quot;Errors on loginRequestV1Dto: userName: must not be null, password: must not be null&quot;,&quot;arguments&quot;:[]}&quot;</p>\n</blockquote>\n<p>Not able to understand why request JSON is always changing to null. Can anyone please suggest the correct approach to fetch a 200 (OK) response back from the PostMapping? Or, there is any other way to achieve the scenario above?</p>\n<p>Note: When I hit the same post request directly using the <strong>Postman</strong> mentioning the above json <em>userName/password</em> in the request body, then it is working fine and returning the 200 (OK) response correctly.</p>\n",
    "tags" : [ "java", "spring-boot", "rest" ],
    "owner" : {
      "account_id" : 15682947,
      "reputation" : 385,
      "user_id" : 11316422,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/1d73e9a80933179e8f00db24c473bd69?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jerry",
      "link" : "https://stackoverflow.com/users/11316422/jerry"
    },
    "is_answered" : true,
    "view_count" : 92,
    "answer_count" : 2,
    "score" : 1,
    "last_activity_date" : 1746852057,
    "creation_date" : 1746848625,
    "link" : "https://stackoverflow.com/questions/79615121/resttemplate-postforobject-is-throwing-restclientexception-because-the-request",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79615140,
    "question_id" : 79615121,
    "body" : "<p>The RestClientException with userName: must not be null, password: must not be null occurs because RestTemplate isn't serializing the JSONObject correctly for the third-party API, which expects a JSON payload. The JSONObject from org.json may not be properly converted to the expected request body format*.*</p>\n<p>A way to resolve <em>this</em> is to use a Map or a custom DTO to create the request body, and set the Content-Type to application/json using HttpEntity. Try the code below if that works for you.</p>\n<pre class=\"lang-java prettyprint-override\"><code>import org.springframework.http.HttpEntity;\nimport org.springframework.http.HttpHeaders;\nimport org.springframework.http.MediaType;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.client.RestTemplate;\n\nRestTemplate restTemplate = new RestTemplate();\n\nString url = &quot;https://thirdpParty_API.com/api/auth/login&quot;;\n\ntry {\n    Map&lt;String, String&gt; requestBody = new HashMap&lt;&gt;();\n    requestBody.put(&quot;userName&quot;, &quot;Tom&quot;);\n    requestBody.put(&quot;password&quot;, &quot;Pass@12345&quot;);\n\n    HttpHeaders headers = new HttpHeaders();\n    headers.setContentType(MediaType.APPLICATION_JSON);\n\n    HttpEntity&lt;Map&lt;String, String&gt;&gt; request = new HttpEntity&lt;&gt;(requestBody, headers);\n\n    JSONObject responseObject = restTemplate.postForObject(url, request, JSONObject.class);\n    return ResponseEntity.ok(responseObject);\n} catch (RestClientException rex) {\n    logger.error(&quot;RestClientException occurred: {}&quot;, rex.getMessage());\n    return ResponseEntity.badRequest().build();\n}\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 20686847,
      "reputation" : 62,
      "user_id" : 15189063,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0fbe8d6b4dd70a526004e9a5e20dbeaf?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Oladejo Olajide",
      "link" : "https://stackoverflow.com/users/15189063/oladejo-olajide"
    },
    "creation_date" : 1746850495,
    "last_activity_date" : 1746850495,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79615133,
    "question_id" : 79615121,
    "body" : "<p>You're passing an org.json.JSONObject directly to RestTemplate, which doesn't automatically convert it into a proper JSON request body. It just sends it as an object, which becomes null in deserialization.Postman automatically sets the correct Content-Type and sends the JSON string. In code, unless you use the right body object and headers, Spring might not serialize it to the proper format, resulting in null values being received by the API.Use a Map&lt;String, String&gt; or create a POJO for the request body, and ensure the correct headers are set.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 35656773,
      "reputation" : 7,
      "user_id" : 27330437,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/0bRNdWeC.jpg?s=256",
      "display_name" : "Arjit singh kushwaha",
      "link" : "https://stackoverflow.com/users/27330437/arjit-singh-kushwaha"
    },
    "creation_date" : 1746849580,
    "last_activity_date" : 1746849580,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79615133" : [ {
      "comment_id" : 140413161,
      "post_id" : 79615133,
      "body" : "// Create request body as a Map&lt;String, String&gt; Map&lt;String, String&gt; requestBody = new HashMap&lt;&gt;(); requestBody.put(&quot;userName&quot;, &quot;Tom&quot;); requestBody.put(&quot;password&quot;, &quot;Pass@12345&quot;);  // Set headers for JSON content type HttpHeaders headers = new HttpHeaders(); headers.setContentType(MediaType.APPLICATION_JSON);  // Create HttpEntity with the request body and headers HttpEntity&lt;Map&lt;String, String&gt;&gt; request = new HttpEntity&lt;&gt;(requestBody, headers);  // Send the POST request JSONObject responseObject = restTemplate.postForObject(url, request, JSONObject.class);",
      "score" : 0,
      "owner" : {
        "account_id" : 35656773,
        "reputation" : 7,
        "user_id" : 27330437,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/0bRNdWeC.jpg?s=256",
        "display_name" : "Arjit singh kushwaha",
        "link" : "https://stackoverflow.com/users/27330437/arjit-singh-kushwaha"
      },
      "creation_date" : 1746866191,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140412870,
      "post_id" : 79615133,
      "body" : "Thank you, can you please provide the code snippet for what you suggested using Map&lt;String, String&gt; please ?",
      "score" : 0,
      "owner" : {
        "account_id" : 15682947,
        "reputation" : 385,
        "user_id" : 11316422,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/1d73e9a80933179e8f00db24c473bd69?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Jerry",
        "link" : "https://stackoverflow.com/users/11316422/jerry"
      },
      "creation_date" : 1746849939,
      "content_license" : "CC BY-SA 4.0"
    } ],
    "79615140" : [ {
      "comment_id" : 140412971,
      "post_id" : 79615140,
      "body" : "You can also use Map to deserialise the response instead of JSONObject.class. Code updated below: ```  ResponseEntity&lt;Map&gt; response = restTemplate.exchange(url, HttpMethod.POST, request, Map.class);      logger.info(&quot;Response body: {}&quot;, response.getBody());      return ResponseEntity.ok(response.getBody()); ```",
      "score" : 1,
      "owner" : {
        "account_id" : 20686847,
        "reputation" : 62,
        "user_id" : 15189063,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/0fbe8d6b4dd70a526004e9a5e20dbeaf?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Oladejo Olajide",
        "link" : "https://stackoverflow.com/users/15189063/oladejo-olajide"
      },
      "creation_date" : 1746856227,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140412931,
      "post_id" : 79615140,
      "body" : "Thank you. The above code is working and the <b>RestClientException</b> is not throwing now. 200 (OK) response is coming. But the response body is completely empty. The response body must have a <b>&quot;token&quot;</b> in the json. But is is coming as empty json.",
      "score" : 0,
      "owner" : {
        "account_id" : 15682947,
        "reputation" : 385,
        "user_id" : 11316422,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/1d73e9a80933179e8f00db24c473bd69?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Jerry",
        "link" : "https://stackoverflow.com/users/11316422/jerry"
      },
      "creation_date" : 1746854132,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}