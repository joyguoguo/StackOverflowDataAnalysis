{
  "question" : {
    "question_id" : 79724271,
    "title" : "Use flattened pom for filtering resources",
    "body" : "<p>I'm using a script to replace a property's value in flattened pom, but the original pom's property is injected into filtered resources instead. Why? Is it a configuration issue, a bug or simply not possible to accomplish?</p>\n<p>Sanity check:</p>\n<ul>\n<li>the text file has filtering enabled</li>\n<li>flatten plugin has <code>updatePomFile</code> set to <code>true</code></li>\n<li>I use <code>mvn clean process-resources</code> but tried <code>mvn clean package</code> and <code>mvn clean install</code>, same happens in generated <code>target/classes/test.txt</code> and in final jar</li>\n<li>I added a second execution of the flatten plugin in case current pom is kept in memory and didn't update after my script changed its file</li>\n<li>flattening and script are set to <code>validate</code> phase, <a href=\"https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#Lifecycle_Reference\" rel=\"nofollow noreferrer\">which is 5 steps before <code>process-resources</code></a>, but I also tried every other phase just in case, for both flatten executions</li>\n</ul>\n<p><code>pom.xml</code>:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n\n    &lt;name&gt;${projectname}&lt;/name&gt;\n\n    &lt;groupId&gt;eu.test&lt;/groupId&gt;\n    &lt;artifactId&gt;${projectname}&lt;/artifactId&gt;\n    &lt;version&gt;${revision}&lt;/version&gt;\n    &lt;packaging&gt;jar&lt;/packaging&gt;\n\n    &lt;properties&gt;\n        &lt;projectname&gt;PomScriptTest&lt;/projectname&gt;\n        &lt;revision&gt;1.0&lt;/revision&gt;\n\n        &lt;testProperty&gt;#testFailure&lt;/testProperty&gt;\n    &lt;/properties&gt;\n\n    &lt;build&gt;\n        &lt;defaultGoal&gt;clean install&lt;/defaultGoal&gt;\n\n        &lt;resources&gt;\n            &lt;resource&gt;\n                &lt;directory&gt;src/main/resources&lt;/directory&gt;\n                &lt;filtering&gt;true&lt;/filtering&gt;\n            &lt;/resource&gt;\n        &lt;/resources&gt;\n\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;\n                &lt;artifactId&gt;flatten-maven-plugin&lt;/artifactId&gt;\n                &lt;version&gt;1.7.2&lt;/version&gt;\n                &lt;executions&gt;\n                    &lt;execution&gt;\n                        &lt;id&gt;flatten.clean&lt;/id&gt;\n                        &lt;phase&gt;clean&lt;/phase&gt;\n                        &lt;goals&gt;\n                            &lt;goal&gt;clean&lt;/goal&gt;\n                        &lt;/goals&gt;\n                    &lt;/execution&gt;\n                    &lt;execution&gt;\n                        &lt;id&gt;flatten&lt;/id&gt;\n                        &lt;phase&gt;validate&lt;/phase&gt;\n                        &lt;goals&gt;\n                            &lt;goal&gt;flatten&lt;/goal&gt;\n                        &lt;/goals&gt;\n                        &lt;configuration&gt;\n                            &lt;updatePomFile&gt;true&lt;/updatePomFile&gt;\n                            &lt;flattenMode&gt;bom&lt;/flattenMode&gt;\n                        &lt;/configuration&gt;\n                    &lt;/execution&gt;\n                    &lt;execution&gt;\n                        &lt;id&gt;update-changed-pom&lt;/id&gt;\n                        &lt;phase&gt;initialize&lt;/phase&gt;\n                        &lt;goals&gt;\n                            &lt;goal&gt;flatten&lt;/goal&gt;\n                        &lt;/goals&gt;\n                        &lt;configuration&gt;\n                            &lt;updatePomFile&gt;true&lt;/updatePomFile&gt;\n                            &lt;flattenMode&gt;bom&lt;/flattenMode&gt;\n                            &lt;flattenedPomFilename&gt;.updated-pom.xml&lt;/flattenedPomFilename&gt;\n                        &lt;/configuration&gt;\n                    &lt;/execution&gt;\n                &lt;/executions&gt;\n            &lt;/plugin&gt;\n            &lt;plugin&gt;\n                &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt;\n                &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;\n                &lt;version&gt;3.5.1&lt;/version&gt;\n                &lt;executions&gt;\n                    &lt;execution&gt;\n                        &lt;id&gt;exec-script&lt;/id&gt;\n                        &lt;phase&gt;validate&lt;/phase&gt;\n                        &lt;goals&gt;\n                            &lt;goal&gt;exec&lt;/goal&gt;\n                        &lt;/goals&gt;\n                        &lt;configuration&gt;\n                            &lt;executable&gt;scripts/pomScript.bat&lt;/executable&gt;\n                        &lt;/configuration&gt;\n                    &lt;/execution&gt;\n                &lt;/executions&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n&lt;/project&gt;\n</code></pre>\n<p><code>src/main/resources/test.txt</code>:</p>\n<pre><code>name: ${project.name}\nversion: ${project.version}\ntestProperty: ${testProperty}\n</code></pre>\n<p><code>scripts/pomScript.bat</code>:</p>\n<pre><code>cd scripts\npowershell -command &quot;(Get-Content '../.flattened-pom.xml' -Raw) -replace '#testFailure', '#testSuccess' | Set-Content '../.flattened-pom.xml'&quot;\n</code></pre>\n",
    "tags" : [ "java", "maven", "flatten-maven-plugin" ],
    "owner" : {
      "account_id" : 28195297,
      "reputation" : 170,
      "user_id" : 21550046,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AGNmyxYteMBojPQfR3HvmDzoOgwQhCkZxrZhTAXh2MXQ=k-s256",
      "display_name" : "Nathalie Kitty",
      "link" : "https://stackoverflow.com/users/21550046/nathalie-kitty"
    },
    "is_answered" : false,
    "view_count" : 75,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1754298962,
    "creation_date" : 1754248446,
    "link" : "https://stackoverflow.com/questions/79724271/use-flattened-pom-for-filtering-resources",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140640439,
    "post_id" : 79724271,
    "body" : "Well, I think that there are a couple of things in play here that might interfere with what you&#39;re trying to do: &quot;Build vs consumer&quot; and filtering. The purpose of the flattened POM is to provide enough information to a consumer (that will use your artifact) to resolve its dependencies of your artifact. No processing of the (flattened) POM occurs other than the bare essentials for <i>consuming</i>. Maven, AFAIK, will never pick up an output (such as your flattened POM) and restart the build lifecycle mid-air unless it&#39;s a completely new invocation. This is the <i>build</i> role of the POM. Make sense?",
    "score" : 1,
    "owner" : {
      "account_id" : 1709870,
      "reputation" : 4241,
      "user_id" : 1568138,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/04uBZ.png?s=256",
      "display_name" : "Daniel",
      "link" : "https://stackoverflow.com/users/1568138/daniel"
    },
    "creation_date" : 1754304861,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140640204,
    "post_id" : 79724271,
    "body" : "I also added second execution of flatten plugin, in case it needs to update in-memory copy of pom after my script changes the file - updated my question with this info",
    "score" : 0,
    "owner" : {
      "account_id" : 28195297,
      "reputation" : 170,
      "user_id" : 21550046,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AGNmyxYteMBojPQfR3HvmDzoOgwQhCkZxrZhTAXh2MXQ=k-s256",
      "display_name" : "Nathalie Kitty",
      "link" : "https://stackoverflow.com/users/21550046/nathalie-kitty"
    },
    "creation_date" : 1754299038,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140640137,
    "post_id" : 79724271,
    "body" : "@Daniel Nope :( I tried <a href=\"https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#Default_Lifecycle\" rel=\"nofollow noreferrer\">every phase</a> for both plugins",
    "score" : 0,
    "owner" : {
      "account_id" : 28195297,
      "reputation" : 170,
      "user_id" : 21550046,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AGNmyxYteMBojPQfR3HvmDzoOgwQhCkZxrZhTAXh2MXQ=k-s256",
      "display_name" : "Nathalie Kitty",
      "link" : "https://stackoverflow.com/users/21550046/nathalie-kitty"
    },
    "creation_date" : 1754297403,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140639970,
    "post_id" : 79724271,
    "body" : "Try binding the <code>flatten</code> goal to the <code>process-resources</code> phase instead. I don&#39;t have enough information to conclusively say what might be wrong, but my gut tells me that <code>updatePomFile</code> does not trigger a re-processing of that POM (I don&#39;t think that was ever the intention) and things are happening out of order.",
    "score" : 0,
    "owner" : {
      "account_id" : 1709870,
      "reputation" : 4241,
      "user_id" : 1568138,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/04uBZ.png?s=256",
      "display_name" : "Daniel",
      "link" : "https://stackoverflow.com/users/1568138/daniel"
    },
    "creation_date" : 1754291829,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140639339,
    "post_id" : 79724271,
    "body" : "I updated the plugins to newest versions (1.7.2 &amp; 3.5.1), didn&#39;t help. Edited the post.",
    "score" : 0,
    "owner" : {
      "account_id" : 28195297,
      "reputation" : 170,
      "user_id" : 21550046,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AGNmyxYteMBojPQfR3HvmDzoOgwQhCkZxrZhTAXh2MXQ=k-s256",
      "display_name" : "Nathalie Kitty",
      "link" : "https://stackoverflow.com/users/21550046/nathalie-kitty"
    },
    "creation_date" : 1754250739,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140639306,
    "post_id" : 79724271,
    "body" : "Maven version is <code>3.9.9 (8e8579a9e76f7d015ee5ec7bfcdc97d260186937)</code>",
    "score" : 0,
    "owner" : {
      "account_id" : 28195297,
      "reputation" : 170,
      "user_id" : 21550046,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AGNmyxYteMBojPQfR3HvmDzoOgwQhCkZxrZhTAXh2MXQ=k-s256",
      "display_name" : "Nathalie Kitty",
      "link" : "https://stackoverflow.com/users/21550046/nathalie-kitty"
    },
    "creation_date" : 1754249160,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}