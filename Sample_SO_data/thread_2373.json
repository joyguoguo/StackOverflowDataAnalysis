{
  "question" : {
    "question_id" : 79624644,
    "title" : "Spring boot 3.3.4 to 3.4.5 with multiple configurations (@SpringBootTest(classes = setupA) aappears to load the incorrect setup",
    "body" : "<p>In our project, we have 2 setups for the integration tests. Each of the setups needs other containers. The containers were initialized in the static block of the springboot application.</p>\n<p>Code to explain the problem:</p>\n<p><strong>setupA:</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>@SpringBootApplication\npublic class SetupA {\n\n    public static void main(String[] args) {\n        SpringApplication.run(SetupA.class, args);\n    }\n\n    static {\n        System.out.println(&quot;============================ setup of A ====================================&quot;);\n        // Containers to startup for setup A\n    }\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>@SpringBootTest(classes = SetupA.class)\npublic class BaseATest {\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>class SetupATests extends BaseATest {\n\n    @Test\n    void testA() {\n        System.out.println(&quot;============================ executed A test ====================================&quot;);\n    }\n}\n</code></pre>\n<p><strong>setupB:</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>@SpringBootApplication\npublic class SetupB {\n\n    public static void main(String[] args) {\n        SpringApplication.run(SetupB.class, args);\n    }\n\n    static {\n        System.out.println(&quot;============================ setup of B ====================================&quot;);\n        // Containers to startup for setup B\n    }\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>@SpringBootTest(classes = SetupB.class)\npublic class BaseBTest {\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>class SetupBTests extends BaseBTest{\n\n    @Test\n    void testB() {\n        System.out.println(&quot;============================ executed B test ====================================&quot;);\n    }\n}\n</code></pre>\n<p>code also available at <a href=\"https://github.com/koenv-star/springboot-test-problem.git\" rel=\"nofollow noreferrer\">https://github.com/koenv-star/springboot-test-problem.git</a></p>\n<p>Using this setup in Spring Boot 3.3.4, if we run the tests of <code>setupA</code>, we see both the static blocks are executed:</p>\n<p><a href=\"https://i.sstatic.net/kZZ2Z9vb.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/kZZ2Z9vb.png\" alt=\"sb 3.34\" /></a></p>\n<p>while in Spring Boot 3.4.5. only the static block of <code>setupB</code> is executed:</p>\n<p><a href=\"https://i.sstatic.net/M6AzjPkp.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/M6AzjPkp.png\" alt=\"enter image description here\" /></a></p>\n<p>Why is this suddenly different?</p>\n<p>Also, important to mention that starting the containers in a static block, it was probably not the best usecase, because all the static blocks ran and all the containers started, but still want to know what introduced the different behavior between the Spring Boot versions.</p>\n",
    "tags" : [ "java", "spring", "spring-boot" ],
    "owner" : {
      "account_id" : 20138787,
      "reputation" : 43,
      "user_id" : 14769129,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/48e4339fd6474b14765fb4317e57beca?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Koen",
      "link" : "https://stackoverflow.com/users/14769129/koen"
    },
    "is_answered" : false,
    "view_count" : 124,
    "answer_count" : 0,
    "score" : 2,
    "last_activity_date" : 1747422060,
    "creation_date" : 1747379051,
    "link" : "https://stackoverflow.com/questions/79624644/spring-boot-3-3-4-to-3-4-5-with-multiple-configurations-springboottestclasses",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140547141,
    "post_id" : 79624644,
    "body" : "I had similar problem but I did not research what was exactly the cause. Change was in version 3.3.10. It looked like Spring Boot started loading classes in totally different and somewhat random order. I extracted static block to a new class and referenced it in both base test classes and <code>@SpringBootApplication</code> classes to prevent Spring Boot affecting order of the execution of static initializers.",
    "score" : 0,
    "owner" : {
      "account_id" : 66967,
      "reputation" : 604,
      "user_id" : 196207,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c01c5b8834da35cbfbcf09c29d101600?s=256&d=identicon&r=PG",
      "display_name" : "Sankozi",
      "link" : "https://stackoverflow.com/users/196207/sankozi"
    },
    "creation_date" : 1751025320,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140441775,
    "post_id" : 79624644,
    "body" : "When the code stops in the debugger due to hitting one of the breakpoints it will display the stack of the thread that has been paused. Looking at that stack will tell you what triggered the loading of the class and the execution of its static block.",
    "score" : 0,
    "owner" : {
      "account_id" : 1473276,
      "reputation" : 117494,
      "user_id" : 1384297,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://i.sstatic.net/rmR9b.jpg?s=256",
      "display_name" : "Andy Wilkinson",
      "link" : "https://stackoverflow.com/users/1384297/andy-wilkinson"
    },
    "creation_date" : 1747727601,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140441276,
    "post_id" : 79624644,
    "body" : "What do you mean by &#39;look at the stack trace&#39;? There is no stack trace â€” this is just a simplified setup to illustrate my question (unless I&#39;m missing something). The beans are being registered, which is why the static blocks are executing. But why is bean registration behaving differently between the two Spring Boot versions? What has changed?",
    "score" : 0,
    "owner" : {
      "account_id" : 20138787,
      "reputation" : 43,
      "user_id" : 14769129,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/48e4339fd6474b14765fb4317e57beca?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Koen",
      "link" : "https://stackoverflow.com/users/14769129/koen"
    },
    "creation_date" : 1747711112,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140432855,
    "post_id" : 79624644,
    "body" : "Debugging the tests with a breakpoint in the static blocks and then looking at the stack trace when the breakpoint is reached should tell you why the class is being loaded",
    "score" : 0,
    "owner" : {
      "account_id" : 1473276,
      "reputation" : 117494,
      "user_id" : 1384297,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://i.sstatic.net/rmR9b.jpg?s=256",
      "display_name" : "Andy Wilkinson",
      "link" : "https://stackoverflow.com/users/1384297/andy-wilkinson"
    },
    "creation_date" : 1747408116,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}