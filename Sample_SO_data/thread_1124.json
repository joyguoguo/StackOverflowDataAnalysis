{
  "question" : {
    "question_id" : 79740622,
    "title" : "RabbitMQ error connection in Spring Application - getsockotp",
    "body" : "<p>I’m building a Spring Boot application that uses RabbitMQ.\nHere is my current setup:</p>\n<p>application.properties</p>\n<pre><code>spring.rabbitmq.host=localhost\nspring.rabbitmq.port=5672\nspring.rabbitmq.username=guest\nspring.rabbitmq.password=guest\nspring.rabbitmq.listener.simple.auto-startup=true\n</code></pre>\n<pre><code>RabbitConfig\n@Configuration\npublic class RabbitMqConfig {\n    // Email OTP queue\n    public static final String OTP_QUEUE = &quot;otp_email_queue&quot;;\n    public static final String OTP_EXCHANGE = &quot;otp_email_exchange&quot;;\n    public static final String OTP_ROUTING_KEY = &quot;otp_email_routing&quot;;\n\n    // Registration notification queue\n    public static final String REGISTRATION_QUEUE = &quot;registration_email_queue&quot;;\n    public static final String REGISTRATION_EXCHANGE = &quot;registration_email_exchange&quot;;\n    public static final String REGISTRATION_ROUTING_KEY = &quot;registration_email_routing&quot;;\n\n    @Bean\n    public Queue otpQueue() {\n        return new Queue(OTP_QUEUE, true);\n    }\n\n    @Bean\n    public DirectExchange otpExchange() {\n        return new DirectExchange(OTP_EXCHANGE);\n    }\n\n    @Bean\n    public Binding otpBinding() {\n        return BindingBuilder.bind(otpQueue()).to(otpExchange()).with(OTP_ROUTING_KEY);\n    }\n\n    @Bean\n    public Queue registrationQueue() {\n        return new Queue(REGISTRATION_QUEUE, true);\n    }\n\n    @Bean\n    public DirectExchange registrationExchange() {\n        return new DirectExchange(REGISTRATION_EXCHANGE);\n    }\n\n    @Bean\n    public Binding registrationBinding() {\n        return BindingBuilder.bind(registrationQueue()).to(registrationExchange()).with(REGISTRATION_ROUTING_KEY);\n    }\n\n    @Bean\n    public MessageConverter jsonMessageConverter() {\n        return new Jackson2JsonMessageConverter();\n    }\n\n    @Bean\n    public RabbitTemplate rabbitTemplate(ConnectionFactory connectionFactory) {\n        final RabbitTemplate rabbitTemplate = new RabbitTemplate(connectionFactory);\n        rabbitTemplate.setMessageConverter(jsonMessageConverter());\n        return rabbitTemplate;\n    }\n}\n</code></pre>\n<p>Error logs</p>\n<p>When I run the application, I keep getting connection errors like this:</p>\n<pre><code>20-08-2025 11:22:11.873 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] INFO  org.springframework.amqp.rabbit.connection.CachingConnectionFactory.connectAddresses - Attempting to connect to: [localhost:5672]\n20-08-2025 11:22:11.900 [main] INFO  org.springframework.amqp.rabbit.connection.CachingConnectionFactory.connectAddresses - Attempting to connect to: [localhost:5672]\n20-08-2025 11:22:11.931 [main] INFO  org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.checkMismatchedQueues - Broker not available; cannot force queue declarations during start: java.net.ConnectException: Connection refused: getsockopt\n20-08-2025 11:22:11.932 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  org.springframework.amqp.rabbit.connection.CachingConnectionFactory.connectAddresses - Attempting to connect to: [localhost:5672]\n20-08-2025 11:22:11.964 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] ERROR org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.redeclareElementsIfNecessary - Failed to check/redeclare auto-delete queue(s).\norg.springframework.amqp.AmqpConnectException: java.net.ConnectException: Connection refused: getsockopt\n    at org.springframework.amqp.rabbit.support.RabbitExceptionTranslator.convertRabbitAccessException(RabbitExceptionTranslator.java:61)\n    at org.springframework.amqp.rabbit.connection.AbstractConnectionFactory.createBareConnection(AbstractConnectionFactory.java:632)\n    at org.springframework.amqp.rabbit.connection.CachingConnectionFactory.createConnection(CachingConnectionFactory.java:726)\n    at org.springframework.amqp.rabbit.connection.ConnectionFactoryUtils.createConnection(ConnectionFactoryUtils.java:257)\n    at org.springframework.amqp.rabbit.core.RabbitTemplate.doExecute(RabbitTemplate.java:2262)\n    at org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:2235)\n    at org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:2215)\n    at org.springframework.amqp.rabbit.core.RabbitAdmin.getQueueInfo(RabbitAdmin.java:467)\nWARN  org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.logConsumerException - Consumer raised exception, processing can restart if the connection factory supports it. Exception summary: org.springframework.amqp.AmqpConnectException: java.net.ConnectException: Connection refused: getsockopt\n20-08-2025 11:22:16.970 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] INFO  org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.killOrRestart - Restarting Consumer@7c654cfc: tags=[[]], channel=null, acknowledgeMode=AUTO local queue size=0\n20-08-2025 11:22:16.971 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  org.springframework.amqp.rabbit.connection.CachingConnectionFactory.connectAddresses - Attempting to connect to: [localhost:5672]\n20-08-2025 11:22:17.008 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] ERROR org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.redeclareElementsIfNecessary - Failed to check/redeclare auto-delete queue(s).\n</code></pre>\n<p>What I tried / What I’m confused about</p>\n<p>I’m running my Spring Boot application with Docker, and I already exposed ports 5672 and 15672.</p>\n<p>However, I can’t access the RabbitMQ management UI (http://localhost:15672), it doesn’t show up.</p>\n<p>The Spring Boot app keeps retrying to connect but always fails with Connection refused.</p>\n<p>Question</p>\n<p>Can someone explain clearly why Spring can’t connect to RabbitMQ in this setup and what I need to fix (either in Docker, properties, or config) so that the application can connect successfully?</p>\n<p>Thanks in advance! \uD83D\uDE4F</p>\n",
    "tags" : [ "java", "spring", "spring-boot", "spring-mvc", "rabbitmq" ],
    "owner" : {
      "account_id" : 27242278,
      "reputation" : 1,
      "user_id" : 20768244,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/02b502003f6a3aa2ef6ee9b0647496d0?s=256&d=identicon&r=PG",
      "display_name" : "tnw",
      "link" : "https://stackoverflow.com/users/20768244/tnw"
    },
    "is_answered" : false,
    "view_count" : 141,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1755665873,
    "creation_date" : 1755664763,
    "link" : "https://stackoverflow.com/questions/79740622/rabbitmq-error-connection-in-spring-application-getsockotp",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140826315,
    "post_id" : 79740622,
    "body" : "I have 2 questions:   Is your Spring app running locally or in a container?   You exposed the ports, but did you forward the ports to access them on localhost?",
    "score" : 0,
    "owner" : {
      "account_id" : 5420076,
      "reputation" : 1,
      "user_id" : 4314013,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/562927d4424807170425c2a41c9079cc?s=256&d=identicon&r=PG",
      "display_name" : "Pream Totaram",
      "link" : "https://stackoverflow.com/users/4314013/pream-totaram"
    },
    "creation_date" : 1761803244,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}