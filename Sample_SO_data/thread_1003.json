{
  "question" : {
    "question_id" : 79753210,
    "title" : "How to use both authorization_code and client_credentials grant types in the same Spring application?",
    "body" : "<p>I have a web application which uses okta oauth2 with authorization_code grant types, SSO is also configured for the same enterprise okta auth server.\nI want to expose some APIs from the same web app, API consumers will be using client_credentials grant type while accessing those APIs.</p>\n<p>Is it possible to use two grant types, authorization_code and client_credentials in the same application?  If yes then how to configure spring security for having two grant types? Or I have to create a separate application for APIs which will have a separate authorization server and client_ids.</p>\n",
    "tags" : [ "java", "spring-boot", "oauth-2.0", "okta-api" ],
    "owner" : {
      "account_id" : 3398201,
      "reputation" : 1143,
      "user_id" : 2851184,
      "user_type" : "registered",
      "accept_rate" : 43,
      "profile_image" : "https://i.sstatic.net/WwzNm.jpg?s=256",
      "display_name" : "M Alok",
      "link" : "https://stackoverflow.com/users/2851184/m-alok"
    },
    "is_answered" : true,
    "view_count" : 111,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1757632725,
    "creation_date" : 1756798608,
    "link" : "https://stackoverflow.com/questions/79753210/how-to-use-both-authorization-code-and-client-credentials-grant-types-in-the-sam",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79754041,
    "question_id" : 79753210,
    "body" : "<blockquote>\n<p>Is it possible to use two grant types, authorization_code and client_credentials in the same application?</p>\n</blockquote>\n<p>Yes. But it's not clear if your application is an <code>oauth2Client</code> or an <code>oauth2ResourceServer</code> (you expose nothing from your conf in your question)</p>\n<h4>How OAuth2 works</h4>\n<p>OAuth2 is a 3-actor thing:</p>\n<ul>\n<li>authorization server (Okta in your case, frequent alternatives being Keycloak, Auth0, Entra ID, ...): authenticates users &amp; clients, and issues tokens</li>\n<li>client: get tokens from the authorization server (using the authorization code and then the refresh token flows to act on behalf of users, or the client credentials flow to act in their own name)</li>\n<li>resource server: validates tokens and take access decision for the resources it manages. Which flow was used by a client to get an access token is none of the resource server's business.</li>\n</ul>\n<p>So, whatever the flow, tokens are issued by an authorization server to a client, for it to query resource servers.</p>\n<h4>What does Spring <code>oauth2Login</code> do?</h4>\n<p>Spring <code>oauth2Login</code> provides server-side handling for the authorization code and refresh token flows. It:</p>\n<ul>\n<li>Is an OAuth2 client feature (just look at the Spring Boot properties).</li>\n<li><strong>Makes the app stateful</strong>: requests are authorized with session cookies, not <code>Bearer</code> tokens.</li>\n</ul>\n<p><strong>A security filter-chain with <code>oauth2Login</code> is not adapted to server-to-server communication</strong>: a remote server can hardly handle the autorization code flow and won't handle session cookies natively like browsers do.</p>\n<h4>REST resources should be served by an <code>oauth2ResourceServer</code></h4>\n<p><strong>A scalable REST API should be stateless</strong>: no session, request authorization based on <code>Bearer</code> tokens.</p>\n<p>A remote server can keep a secret and, as so, can use the client credentials flow to get the tokens required to consume a stateless resource servers. So, <strong>a filter-chain with <code>oauth2ResourceServer</code> is well suited for server-to-server communication</strong>.</p>\n<h4><code>oauth2Login</code> and <code>oauth2ResourceServer</code> should not be mixed in the same <code>SecurityFilterChain</code></h4>\n<p>A filter chain can't be stateful and stateless at the same time.</p>\n<p>If you want your system to offer <code>oauth2Login</code> and to expose a REST API to other servers, isolate <code>oauth2Login</code> and <code>oauth2ResoureServer</code> in different security filter-chains (which might be in the same app or in different ones).</p>\n<p>In an app with Thymeleaf, JSF, etc., use a filter-chain with <code>oauth2Login</code> to render templates, and a second filter-chain to serve REST resources (what returns a <code>@ResponseBody</code> like <code>@RestController</code> methods).</p>\n<p>As a reminder, when two or more <code>SecurityFilterChain</code> beans are standing in the same app, all must have different <code>@Order</code>, and all but the one with the highest order (lowest precedence) must contain a <code>securityMatcher</code>: only the filter-chain with the 1st matching <code>securityMatcher</code> is used. You might define security matchers based on the request path, or in this case, on the <code>Authorization</code> header (starting with <code>Bearer </code> for an <code>oauth2ResourceServer</code> rejecting <strong>all</strong> anonymous requests), or on a session cookie being set.</p>\n<p>If the frontend is a single-page or mobile app, put an OAuth2 BFF between it and the stateless resource server(s) (for instance a <a href=\"https://www.baeldung.com/spring-cloud-gateway-bff-oauth2\" rel=\"nofollow noreferrer\">Spring Cloud Gateway with <code>oauth2Login</code> and the <code>TokenRelay=</code> filter</a>).</p>\n<p>In any cases, the REST endpoints would be secured with an <code>oauth2ResourceServer</code> filter-chain and the OAuth2 client should either be:</p>\n<ul>\n<li>A filter-chain with <code>oauth2Login</code>:\n<ul>\n<li>(maybe) in the same app rendering templates (in case of a Thymeleaf frontend for instance)</li>\n<li>in a gateway routing frontend requests with the <code>TokenRelay=</code> filter (case of single-page and mobile applications).</li>\n</ul>\n</li>\n<li>A server application using the client-credentials flow.</li>\n</ul>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 308139,
      "reputation" : 13879,
      "user_id" : 619830,
      "user_type" : "registered",
      "accept_rate" : 75,
      "profile_image" : "https://www.gravatar.com/avatar/f4d00b0a82e9307b1d68b29867fee4e5?s=256&d=identicon&r=PG",
      "display_name" : "ch4mp",
      "link" : "https://stackoverflow.com/users/619830/ch4mp"
    },
    "creation_date" : 1756859673,
    "last_activity_date" : 1757632725,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}