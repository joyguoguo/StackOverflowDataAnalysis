{
  "question" : {
    "question_id" : 79654460,
    "title" : "No suitable HttpMessageConverter found for response type",
    "body" : "<p>I am trying to create image generator with OpenAI. I'm facing this:</p>\n<blockquote>\n<p>error(Title) --Exception: Could not extract response: no suitable HttpMessageConverter found for response type [class org.springframework.ai.openai.api.OpenAiImageApi$OpenAiImageResponse] and content type [text/html;charset=utf-8</p>\n</blockquote>\n<p>This is my application.properties file:</p>\n<pre><code>spring.application.name=ImageGenerator\nspring.ai.openai.api-key=API_KEY\nspring.ai.openai.base-url=https://openrouter.ai/api\nlogging.level.org.springframework.ai=DEBUG\nserver.port=8081\nspring.ai.openai.image.options.model=dall-e-3\n</code></pre>\n<p>This is my Controller Class:</p>\n<pre><code>package com.image_generator.ImageGenerator;\n\nimport org.springframework.ai.chat.client.ResponseEntity;\nimport org.springframework.ai.image.ImagePrompt;\nimport org.springframework.ai.image.ImageResponse;\nimport org.springframework.ai.openai.OpenAiImageModel;\nimport org.springframework.ai.openai.OpenAiImageOptions;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.*;\n\n\n@RestController\npublic class AIController {\n\n    @Autowired\n    private OpenAiImageModel openAiImageModel;\n\n    @GetMapping(&quot;image/{prompt}&quot;)\n    public  String generateImage(@PathVariable String prompt){\n        System.out.println(&quot;prompt = &quot; + prompt);\n        try{\n            ImageResponse imageResponse = openAiImageModel.call(\n                    new ImagePrompt(prompt,\n                            OpenAiImageOptions.builder()\n                                    .responseFormat(&quot;b64_json&quot;)\n                                    .model(&quot;dall-e-3&quot;)\n                                    .height(1024)\n                                    .quality(&quot;standard&quot;)\n                                    .width(1024)\n                                    .N(1)\n                                    .build())\n            );\n            System.out.println(&quot;Url ===========&quot; +imageResponse.getResult().getOutput().getUrl());\n            return  imageResponse.getResult().getOutput().getUrl();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n      return &quot;BAd&quot;;\n\n    }\n}\n</code></pre>\n<p>My pom.xml:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;parent&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n        &lt;version&gt;3.5.0&lt;/version&gt;\n        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;\n    &lt;/parent&gt;\n    &lt;groupId&gt;com.image-generator&lt;/groupId&gt;\n    &lt;artifactId&gt;ImageGenerator&lt;/artifactId&gt;\n    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n    &lt;name&gt;ImageGenerator&lt;/name&gt;\n    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;\n    &lt;url/&gt;\n    &lt;licenses&gt;\n        &lt;license/&gt;\n    &lt;/licenses&gt;\n    &lt;developers&gt;\n        &lt;developer/&gt;\n    &lt;/developers&gt;\n    &lt;scm&gt;\n        &lt;connection/&gt;\n        &lt;developerConnection/&gt;\n        &lt;tag/&gt;\n        &lt;url/&gt;\n    &lt;/scm&gt;\n    &lt;properties&gt;\n        &lt;java.version&gt;17&lt;/java.version&gt;\n        &lt;spring-ai.version&gt;1.0.0&lt;/spring-ai.version&gt;\n    &lt;/properties&gt;\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-ai-starter-model-openai&lt;/artifactId&gt;\n\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        \n        &lt;dependency&gt;\n    &lt;groupId&gt;org.apache.httpcomponents.client5&lt;/groupId&gt;\n    &lt;artifactId&gt;httpclient5&lt;/artifactId&gt;\n  \n&lt;/dependency&gt;\n    &lt;/dependencies&gt;\n    &lt;dependencyManagement&gt;\n        &lt;dependencies&gt;\n            &lt;dependency&gt;\n                &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-ai-bom&lt;/artifactId&gt;\n                &lt;version&gt;${spring-ai.version}&lt;/version&gt;\n                &lt;type&gt;pom&lt;/type&gt;\n                &lt;scope&gt;import&lt;/scope&gt;\n            &lt;/dependency&gt;\n        &lt;/dependencies&gt;\n    &lt;/dependencyManagement&gt;\n\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n\n&lt;/project&gt;\n</code></pre>\n",
    "tags" : [ "java", "spring-boot", "dependency-injection", "openai-api", "image-generation" ],
    "owner" : {
      "account_id" : 25828573,
      "reputation" : 1,
      "user_id" : 19566197,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AFdZucowbFaEe2VEKaX1ilRhETfRJE39b4tYUVo4ajpQ-Q=k-s256",
      "display_name" : "Piyush Sahu ",
      "link" : "https://stackoverflow.com/users/19566197/piyush-sahu"
    },
    "is_answered" : false,
    "view_count" : 57,
    "answer_count" : 1,
    "score" : -1,
    "last_activity_date" : 1749131947,
    "creation_date" : 1749127142,
    "link" : "https://stackoverflow.com/questions/79654460/no-suitable-httpmessageconverter-found-for-response-type",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79654626,
    "question_id" : 79654460,
    "body" : "<p>The root cause is that the OpenAI image API client expects a <code>JSON</code> response, but <code>https://openrouter.ai/api</code> is returning an <code>HTML</code> error page with content type <code>text/html;charset=utf-8</code>. This causes Spring's <code>RestTemplate</code> to fail with <code>HttpMessageConverter</code> errors.</p>\n<p><code>spring-ai</code>'s <code>OpenAiImageModel</code> is tailored to the official OpenAI API and expects JSON responses in a specific format. However, <code>https://openrouter.ai/api</code> is not fully compatible with the OpenAI image generation endpoint for models like <code>dall-e-3</code>.</p>\n<p>Update your application.properties<br />\n<code>spring.ai.openai.base-url=https://api.openai.com/v1</code></p>\n<p>Also make sure your api key is from OpenAI and not from OpenRouter.. At least, your model should also be supported by OpenAI, check that.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 24986210,
      "reputation" : 990,
      "user_id" : 18847956,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c2fb9754711baf2db7e43c68a3188e1e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Salt",
      "link" : "https://stackoverflow.com/users/18847956/salt"
    },
    "creation_date" : 1749131947,
    "last_activity_date" : 1749131947,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140490419,
    "post_id" : 79654460,
    "body" : "i also cried to catch exception for both ResponseFormat(URL) and b64_json It gives json file on browser  ---- {&quot;error&quot;: &quot;Failed to generate image: Could not extract response: no suitable HttpMessageConverter found for response type [class org.springframework.ai.openai.api.OpenAiImageApi$OpenAiImage&zwnj;&#8203;Response] and content type [text/html;charset=utf-8]&quot; }",
    "score" : 0,
    "owner" : {
      "account_id" : 25828573,
      "reputation" : 1,
      "user_id" : 19566197,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AFdZucowbFaEe2VEKaX1ilRhETfRJE39b4tYUVo4ajpQ-Q=k-s256",
      "display_name" : "Piyush Sahu ",
      "link" : "https://stackoverflow.com/users/19566197/piyush-sahu"
    },
    "creation_date" : 1749131318,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140490327,
    "post_id" : 79654460,
    "body" : "@Salt it return -BAd",
    "score" : 0,
    "owner" : {
      "account_id" : 25828573,
      "reputation" : 1,
      "user_id" : 19566197,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AFdZucowbFaEe2VEKaX1ilRhETfRJE39b4tYUVo4ajpQ-Q=k-s256",
      "display_name" : "Piyush Sahu ",
      "link" : "https://stackoverflow.com/users/19566197/piyush-sahu"
    },
    "creation_date" : 1749129951,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140490200,
    "post_id" : 79654460,
    "body" : "What exact response are you getting from <a href=\"https://openrouter.ai/api\" rel=\"nofollow noreferrer\">openrouter.ai/api</a> when making the image request (e.g., HTTP status code and body)? This will help verify if the server is returning HTML instead of the expected JSON response.",
    "score" : 0,
    "owner" : {
      "account_id" : 24986210,
      "reputation" : 990,
      "user_id" : 18847956,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c2fb9754711baf2db7e43c68a3188e1e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Salt",
      "link" : "https://stackoverflow.com/users/18847956/salt"
    },
    "creation_date" : 1749127747,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}