{
  "question" : {
    "question_id" : 79687122,
    "title" : "Spring Boot 3.3 -&gt; 3.4 Upgrade, too many open files, possible cause?",
    "body" : "<p>I have a Spring Boot application that currently runs version 3.3.13. For the past 2 release cycles I have been trying to update to 3.4.x. But everytime I deploy to production, I start running into &quot;too many open files&quot; errors after a few hours. So for the past 2 releases I ended up downgrading to 3.3 again.</p>\n<p>There are no other changes in the maintenance release, the spring boot update is what is causing this. Debugging this is quite a pain, because once it happens you can't really do a heap dump anymore and reconfiguring production on the fly isn't supported by the organization.</p>\n<p>I suspect that the problem is a RestTemplate opening connections and not closing them, because I noticed a few hundred open sockets in ESTABLISHED state that don't seem to go away. The http-client used by the RestTemplate is Apache Httpclient 5, which went from 5.3.1 -&gt; 5.4.4 in the spring boot upgrade. But I can't seem to find the problem, because the requests are identical in both versions.</p>\n<p>I would be grateful for any idea, what might be causing this.</p>\n",
    "tags" : [ "java", "spring", "spring-boot", "resttemplate", "apache-httpclient-5.x" ],
    "owner" : {
      "account_id" : 5089768,
      "reputation" : 23,
      "user_id" : 4083194,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-Zx3W2XMbo8Q/AAAAAAAAAAI/AAAAAAAAADk/UT7Ko-U3w5g/s256-rj/photo.jpg",
      "display_name" : "Lukas Stampf",
      "link" : "https://stackoverflow.com/users/4083194/lukas-stampf"
    },
    "is_answered" : false,
    "view_count" : 374,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1751446214,
    "creation_date" : 1751446214,
    "link" : "https://stackoverflow.com/questions/79687122/spring-boot-3-3-3-4-upgrade-too-many-open-files-possible-cause",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140561326,
    "post_id" : 79687122,
    "body" : "you can temporary downgrade just http client to using 5.3.1 instead of 5.4.4 in pom.xml and let it run and see if the problem really from http client, before doing too far",
    "score" : 0,
    "owner" : {
      "account_id" : 1512934,
      "reputation" : 765,
      "user_id" : 1414594,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/791eca52586bec514a8f92f463bbe464?s=256&d=identicon&r=PG",
      "display_name" : "Hendra",
      "link" : "https://stackoverflow.com/users/1414594/hendra"
    },
    "creation_date" : 1751533528,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140558809,
    "post_id" : 79687122,
    "body" : "Because of change in behavior. If you had read the comments on the threads I posted above, you’d have noticed one common theme kept coming up. I’ll leave it to you to find out what that is.",
    "score" : 0,
    "owner" : {
      "account_id" : 446597,
      "reputation" : 25249,
      "user_id" : 839733,
      "user_type" : "registered",
      "accept_rate" : 69,
      "profile_image" : "https://i.sstatic.net/2s6lO.jpg?s=256",
      "display_name" : "Abhijit Sarkar",
      "link" : "https://stackoverflow.com/users/839733/abhijit-sarkar"
    },
    "creation_date" : 1751465299,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140558596,
    "post_id" : 79687122,
    "body" : "How can the version not be important if all I do is upgrading it from 3.3.13 -&gt; 3.4.7 and suddenly something that has worked for 2+ years isn&#39;t working anymore?",
    "score" : 0,
    "owner" : {
      "account_id" : 5089768,
      "reputation" : 23,
      "user_id" : 4083194,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-Zx3W2XMbo8Q/AAAAAAAAAAI/AAAAAAAAADk/UT7Ko-U3w5g/s256-rj/photo.jpg",
      "display_name" : "Lukas Stampf",
      "link" : "https://stackoverflow.com/users/4083194/lukas-stampf"
    },
    "creation_date" : 1751461952,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140558541,
    "post_id" : 79687122,
    "body" : "The problem isn’t a spring bug, so, the version isn’t very important. What’s important is how people fixed it",
    "score" : 1,
    "owner" : {
      "account_id" : 446597,
      "reputation" : 25249,
      "user_id" : 839733,
      "user_type" : "registered",
      "accept_rate" : 69,
      "profile_image" : "https://i.sstatic.net/2s6lO.jpg?s=256",
      "display_name" : "Abhijit Sarkar",
      "link" : "https://stackoverflow.com/users/839733/abhijit-sarkar"
    },
    "creation_date" : 1751460655,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140558514,
    "post_id" : 79687122,
    "body" : "Don&#39;t think those posts are relevant. They deal with much older versions of the used libraries.",
    "score" : 0,
    "owner" : {
      "account_id" : 5089768,
      "reputation" : 23,
      "user_id" : 4083194,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-Zx3W2XMbo8Q/AAAAAAAAAAI/AAAAAAAAADk/UT7Ko-U3w5g/s256-rj/photo.jpg",
      "display_name" : "Lukas Stampf",
      "link" : "https://stackoverflow.com/users/4083194/lukas-stampf"
    },
    "creation_date" : 1751459890,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140558203,
    "post_id" : 79687122,
    "body" : "<a href=\"https://stackoverflow.com/a/74884560/839733\">stackoverflow.com/a/74884560/839733</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 446597,
      "reputation" : 25249,
      "user_id" : 839733,
      "user_type" : "registered",
      "accept_rate" : 69,
      "profile_image" : "https://i.sstatic.net/2s6lO.jpg?s=256",
      "display_name" : "Abhijit Sarkar",
      "link" : "https://stackoverflow.com/users/839733/abhijit-sarkar"
    },
    "creation_date" : 1751452494,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140558202,
    "post_id" : 79687122,
    "body" : "<a href=\"https://github.com/spring-projects/spring-boot/issues/26214#issuecomment-856214007\" rel=\"nofollow noreferrer\">github.com/spring-projects/spring-boot/issues/&hellip;</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 446597,
      "reputation" : 25249,
      "user_id" : 839733,
      "user_type" : "registered",
      "accept_rate" : 69,
      "profile_image" : "https://i.sstatic.net/2s6lO.jpg?s=256",
      "display_name" : "Abhijit Sarkar",
      "link" : "https://stackoverflow.com/users/839733/abhijit-sarkar"
    },
    "creation_date" : 1751452479,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}