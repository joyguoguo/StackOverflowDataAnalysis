{
  "question" : {
    "question_id" : 79841945,
    "title" : "Composite ListCells",
    "body" : "<p>Is it possible to create a combo box in JavaFX 8 so that each item, besides its string representation, also has a small delete button to the right on hover?</p>\n<p>In Swing, for instance, a combo box item may be represented by any component, including relatively complex ones, like in my example.</p>\n<p>Here's my attempt. There are two problems with my solution.</p>\n<ol>\n<li>While buttons do appear on hover and do delete items, the dropdown is not updated correctly: the removed item is replaced by a duplicate of the item below.</li>\n</ol>\n<p><em>before clicking:</em></p>\n<p><a href=\"https://i.sstatic.net/nSz0ZBKP.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/nSz0ZBKP.png\" alt=\"enter image description here\" /></a></p>\n<p><em>after clicking:</em></p>\n<p><a href=\"https://i.sstatic.net/cWVLdlIg.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/cWVLdlIg.png\" alt=\"enter image description here\" /></a></p>\n<ol start=\"2\">\n<li>Buttons don't stick to the right, as I want them to, even if I add a spacer before the button.</li>\n</ol>\n<pre class=\"lang-java prettyprint-override\"><code>Region spacer = new Region();\nHBox.setHgrow(spacer, Priority.ALWAYS);\n</code></pre>\n<p>My attempt:</p>\n<pre class=\"lang-java prettyprint-override\"><code>import com.sun.javafx.scene.control.skin.ComboBoxListViewSkin;\nimport javafx.application.Application;\nimport javafx.beans.property.Property;\nimport javafx.beans.property.SimpleObjectProperty;\nimport javafx.event.ActionEvent;\nimport javafx.event.EventHandler;\nimport javafx.geometry.Insets;\nimport javafx.geometry.Pos;\nimport javafx.scene.Scene;\nimport javafx.scene.control.Button;\nimport javafx.scene.control.ComboBox;\nimport javafx.scene.control.ContentDisplay;\nimport javafx.scene.control.ListCell;\nimport javafx.scene.image.Image;\nimport javafx.scene.image.ImageView;\nimport javafx.scene.layout.HBox;\nimport javafx.scene.layout.VBox;\nimport javafx.stage.Stage;\n\nimport java.net.URL;\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.Objects;\nimport java.util.function.Function;\n\npublic class FXComboBoxDemo extends Application {\n\n    static ComboBox&lt;Person&gt; personCombo;\n\n    @Override\n    public void start(Stage primaryStage) {\n        primaryStage.setScene(createScene());\n        primaryStage.setTitle(&quot;ComboBox Demo&quot;);\n        primaryStage.show();\n    }\n\n    private static Scene createScene() {\n        VBox root = createRoot();\n        Scene scene = new Scene(root);\n        URL stylesheet = FXComboBoxDemo.class.getResource(&quot;/styles/styles.css&quot;);\n        if (stylesheet != null) scene.getStylesheets().add(stylesheet.toExternalForm());\n        return scene;\n    }\n\n    private static VBox createRoot() {\n        VBox root = new VBox(10);\n        root.alignmentProperty().set(Pos.CENTER);\n        ComboBox&lt;Person&gt; personCombo = createPersonCombo();\n        root.getChildren().add(personCombo);\n        root.paddingProperty().setValue(new Insets(10));\n        return root;\n    }\n\n    private static ComboBox&lt;Person&gt; createPersonCombo() {\n        personCombo = new ComboBox&lt;&gt;();\n        personCombo.setCellFactory(lv -&gt; createCell());\n        personCombo.getItems().addAll(createPeople());\n        personCombo.getSelectionModel().selectFirst();\n        personCombo.setButtonCell(personCombo.getCellFactory().call(null));\n        personCombo.setSkin(new ComboBoxListViewSkin&lt;Person&gt;(personCombo) {\n            @Override\n            protected boolean isHideOnClickEnabled() {\n                return false;\n            }\n        });\n        return personCombo;\n    }\n\n    private static ListCell&lt;Person&gt; createCell() {\n        HoverButtonCell&lt;Person&gt; cell = new HoverButtonCell&lt;&gt;();\n        cell.setStringFunction(Person::getName);\n        cell.setButton(createRemoveButton(), prop -&gt; event -&gt; personCombo.itemsProperty().get().remove(prop.getValue()));\n        return cell;\n    }\n\n    private static Button createRemoveButton() {\n        Button removeButton = new Button();\n        URL imageUrl = Objects.requireNonNull(FXComboBoxDemo.class.getResource(&quot;/bin.png&quot;));\n        Image icon = new Image(imageUrl.toExternalForm());\n        ImageView iconView = new ImageView(icon);\n        removeButton.setGraphic(iconView);\n        removeButton.getStyleClass().add(&quot;transparent-button&quot;);\n        return removeButton;\n    }\n\n    private static List&lt;Person&gt; createPeople() {\n        List&lt;Person&gt; people = new ArrayList&lt;&gt;();\n        people.add(new Person(&quot;Alice&quot;));\n        people.add(new Person(&quot;Bob&quot;));\n        people.add(new Person(&quot;Charlie&quot;));\n        return people;\n    }\n\n    public static void main(String[] args) {\n        launch(args);\n    }\n\n    private static class HoverButtonCell&lt;T&gt; extends ListCell&lt;T&gt; {\n\n        private final Property&lt;T&gt; hoveredItemProperty;\n        private HBox buttonContainer;\n        private Function&lt;? super T, String&gt; stringFunction;\n\n        public HoverButtonCell() {\n            this.hoveredItemProperty = new SimpleObjectProperty&lt;&gt;();\n            this.stringFunction = Objects::toString;\n            setGraphic(createGraphic());\n            setContentDisplay(ContentDisplay.RIGHT);\n        }\n\n        private HBox createGraphic() {\n            buttonContainer = new HBox();\n            buttonContainer.alignmentProperty().set(Pos.CENTER_RIGHT);\n            return buttonContainer;\n        }\n\n        public void setButton(Button button, Function&lt;Property&lt;T&gt;, EventHandler&lt;ActionEvent&gt;&gt; hoveredItemToActionHandler) {\n            buttonContainer.getChildren().addAll(button);\n            button.visibleProperty().bind(hoverProperty());\n            if (hoveredItemToActionHandler != null) button.setOnAction(e -&gt; hoveredItemToActionHandler.apply(hoveredItemProperty()).handle(e));\n        }\n\n        private Property&lt;T&gt; hoveredItemProperty() {\n            return hoveredItemProperty;\n        }\n\n        public void setStringFunction(Function&lt;? super T, String&gt; stringFunction) {\n            this.stringFunction = stringFunction;\n        }\n\n        @Override\n        protected void updateItem(T item, boolean empty) {\n            super.updateItem(item, empty);\n            if (item != null) setText(stringFunction.apply(item));\n            hoveredItemProperty().setValue(item);\n        }\n    }\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>public class Person {\n\n    private String name;\n\n    public Person(String name) {\n        this.name = name;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    public String getName() {\n        return name;\n    }\n\n    @Override\n    public String toString() {\n        return &quot;Person &quot; + name;\n    }\n}\n</code></pre>\n<pre class=\"lang-css prettyprint-override\"><code>/* resources/styles/styles.css */\n\n.transparent-button {\n    -fx-background-color : transparent;\n    -fx-cursor : hand;\n    -fx-padding : 5;\n}\n</code></pre>\n<p><code>resources/bin.png</code></p>\n<p><a href=\"https://i.sstatic.net/rWyId6kZ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/rWyId6kZ.png\" alt=\"bin icon\" /></a></p>\n",
    "tags" : [ "java", "javafx" ],
    "owner" : {
      "account_id" : 10187542,
      "reputation" : 2675,
      "user_id" : 20692967,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
      "display_name" : "Sergey Zolotarev",
      "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
    },
    "is_answered" : false,
    "view_count" : 55,
    "closed_date" : 1765289136,
    "answer_count" : 0,
    "score" : -5,
    "last_activity_date" : 1765291727,
    "creation_date" : 1765284787,
    "link" : "https://stackoverflow.com/questions/79841945/composite-listcells",
    "closed_reason" : "Duplicate"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140895024,
    "post_id" : 79841945,
    "body" : "Off-topic: This all just seems way too convoluted (especially for an <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>). In your cell subclass, you can just do <code>button.setOnAction(_ -&gt; getListView().getItems().remove(getIndex()));</code>. What is the purpose of <code>hoveredItemProperty()</code>? It seems to always contain the same value as the <code>itemProperty()</code>.",
    "score" : 2,
    "owner" : {
      "account_id" : 2518243,
      "reputation" : 210916,
      "user_id" : 2189127,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
      "display_name" : "James_D",
      "link" : "https://stackoverflow.com/users/2189127/james-d"
    },
    "creation_date" : 1765310055,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140895005,
    "post_id" : 79841945,
    "body" : "The new issue (since you updated the question) is caused exactly by the issue I described in my previous comment. Your <code>updateItem(...)</code> method is incorrectly implemented. Read the documentation, which explicitly states how it should be implemented.",
    "score" : 2,
    "owner" : {
      "account_id" : 2518243,
      "reputation" : 210916,
      "user_id" : 2189127,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
      "display_name" : "James_D",
      "link" : "https://stackoverflow.com/users/2189127/james-d"
    },
    "creation_date" : 1765309385,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140894906,
    "post_id" : 79841945,
    "body" : "You should rethink your user interface design.  This is not a good use of a ComboBox.  Consider using a ListView or TableView, with a ‘Delete’ button beside it which operates on the selected row(s).",
    "score" : 2,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44971,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1765305594,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140894372,
    "post_id" : 79841945,
    "body" : "Off-topic (a little): your <code>updateItem(...)</code> method is broken. You need to address all possible code paths and set the text (and graphic, if you use a graphic) in all of them. In this case, if cell that was previously non-empty becomes empty, the text will still appear in it. (In a combo box this might not happen, or might not happen often, but it still needs to be dealt with.) Again, read the <a href=\"https://openjfx.io/javadoc/25/javafx.controls/javafx/scene/control/Cell.html#updateItem(T,boolean)\" rel=\"nofollow noreferrer\">documentation</a> carefully.",
    "score" : 2,
    "owner" : {
      "account_id" : 2518243,
      "reputation" : 210916,
      "user_id" : 2189127,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
      "display_name" : "James_D",
      "link" : "https://stackoverflow.com/users/2189127/james-d"
    },
    "creation_date" : 1765288606,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140894366,
    "post_id" : 79841945,
    "body" : "&quot;No buttons appear anywhere, despite adding them to the list cell&quot;. Adding a node to the cell in the form of adding it to the child list will not work. (The cell does not behave as a container.) Use <a href=\"https://openjfx.io/javadoc/25/javafx.controls/javafx/scene/control/Labeled.html#setGraphic(javafx.scene.Node)\" rel=\"nofollow noreferrer\"><code>setGraphic</code></a>.",
    "score" : 2,
    "owner" : {
      "account_id" : 2518243,
      "reputation" : 210916,
      "user_id" : 2189127,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
      "display_name" : "James_D",
      "link" : "https://stackoverflow.com/users/2189127/james-d"
    },
    "creation_date" : 1765288456,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140894313,
    "post_id" : 79841945,
    "body" : "See <i>javadoc</i> for class <a href=\"https://openjfx.io/javadoc/25/javafx.controls/javafx/scene/control/Cell.html\" rel=\"nofollow noreferrer\">javafx.scene.control.Cell</a>",
    "score" : 2,
    "owner" : {
      "account_id" : 2485939,
      "reputation" : 20969,
      "user_id" : 2164365,
      "user_type" : "registered",
      "accept_rate" : 40,
      "profile_image" : "https://i.sstatic.net/RKSgV.png?s=256",
      "display_name" : "Abra",
      "link" : "https://stackoverflow.com/users/2164365/abra"
    },
    "creation_date" : 1765286719,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140894287,
    "post_id" : 79841945,
    "body" : "<a href=\"https://stackoverflow.com/questions/36141472/how-to-add-remove-button-in-combobox\" title=\"how to add remove button in combobox\">stackoverflow.com/questions/36141472/&hellip;</a>",
    "score" : 2,
    "owner" : {
      "account_id" : 2485939,
      "reputation" : 20969,
      "user_id" : 2164365,
      "user_type" : "registered",
      "accept_rate" : 40,
      "profile_image" : "https://i.sstatic.net/RKSgV.png?s=256",
      "display_name" : "Abra",
      "link" : "https://stackoverflow.com/users/2164365/abra"
    },
    "creation_date" : 1765285850,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140894285,
    "post_id" : 79841945,
    "body" : "<a href=\"https://stackoverflow.com/questions/46102923/how-to-set-buttoncell-in-combobox-javafx\" title=\"how to set buttoncell in combobox javafx\">stackoverflow.com/questions/46102923/&hellip;</a>",
    "score" : 2,
    "owner" : {
      "account_id" : 2485939,
      "reputation" : 20969,
      "user_id" : 2164365,
      "user_type" : "registered",
      "accept_rate" : 40,
      "profile_image" : "https://i.sstatic.net/RKSgV.png?s=256",
      "display_name" : "Abra",
      "link" : "https://stackoverflow.com/users/2164365/abra"
    },
    "creation_date" : 1765285749,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}