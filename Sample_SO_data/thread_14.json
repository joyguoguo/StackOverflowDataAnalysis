{
  "question" : {
    "question_id" : 79835446,
    "title" : "Why large string log data cause the java progress memory high?",
    "body" : "<h1>problem--why the large string log data cause the jvm memory go high?</h1>\n<p><a href=\"https://i.sstatic.net/Z44baqqm.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/Z44baqqm.png\" alt=\"memory problem\" /></a></p>\n<p><a href=\"https://i.sstatic.net/YFLvsBSx.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/YFLvsBSx.png\" alt=\"top res\" /></a></p>\n<ul>\n<li>problem: the java process is using more and more memory over time.</li>\n<li>jvm argument:java -Xmx5120M -Xms5120M -XX:NewRatio=1 -XX:MetaspaceSize=512m -XX:MaxMetaspaceSize=512m -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/data/log -XX:+PrintCommandLineFlags -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -Xloggc:/data/log/gc-%t.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=5 -XX:GCLogFileSize=20m -XX:ErrorFile=/data/log/hs_err_%p.log -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=80 -XX:+UseCMSInitiatingOccupancyOnly -XX:AutoBoxCacheMax=20000 -XX:-UseBiasedLocking -XX:NativeMemoryTracking=detail -jar /data/app/app-live-admin-service/app_live_admin_services.jar</li>\n<li>jdkversion:openjdk version &quot;1.8.0_412&quot;</li>\n<li>the docker memory is 8GB</li>\n</ul>\n<h2>jcmd GC heap info:</h2>\n<pre class=\"lang-none prettyprint-override\"><code>root@app-live-admin-service-prod-gzhy-idc-1283210-ml75f:~# jcmd 115 GC.heap_info\n115:\n par new generation   total 2359296K, used 406730K [0x00000006a0800000, 0x0000000740800000, 0x0000000740800000)\n  eden space 2097152K,  18% used [0x00000006a0800000, 0x00000006b8266b70, 0x0000000720800000)\n  from space 262144K,   7% used [0x0000000730800000, 0x0000000731acbd30, 0x0000000740800000)\n  to   space 262144K,   0% used [0x0000000720800000, 0x0000000720800000, 0x0000000730800000)\n concurrent mark-sweep generation total 2621440K, used 362690K [0x0000000740800000, 0x00000007e0800000, 0x00000007e0800000)\n Metaspace       used 180048K, capacity 196318K, committed 196608K, reserved 1224704K\n  class space    used 19486K, capacity 22194K, committed 22272K, reserved 1048576K\n</code></pre>\n<h2>heap_info</h2>\n<pre class=\"lang-none prettyprint-override\"><code>Attaching to process ID 115, please wait...\nDebugger attached successfully.\nServer compiler detected.\nJVM version is 25.412-b08\n\nusing parallel threads in the new generation.\nusing thread-local object allocation.\nConcurrent Mark-Sweep GC\n\nHeap Configuration:\n   MinHeapFreeRatio         = 40\n   MaxHeapFreeRatio         = 70\n   MaxHeapSize              = 5368709120 (5120.0MB)\n   NewSize                  = 2684354560 (2560.0MB)\n   MaxNewSize               = 2684354560 (2560.0MB)\n   OldSize                  = 2684354560 (2560.0MB)\n   NewRatio                 = 1\n   SurvivorRatio            = 8\n   MetaspaceSize            = 536870912 (512.0MB)\n   CompressedClassSpaceSize = 528482304 (504.0MB)\n   MaxMetaspaceSize         = 536870912 (512.0MB)\n   G1HeapRegionSize         = 0 (0.0MB)\n\nHeap Usage:\nNew Generation (Eden + 1 Survivor Space):\n   capacity = 2415919104 (2304.0MB)\n   used     = 53123984 (50.66297912597656MB)\n   free     = 2362795120 (2253.3370208740234MB)\n   2.1989140245649548% used\nEden Space:\n   capacity = 2147483648 (2048.0MB)\n   used     = 31850616 (30.37511444091797MB)\n   free     = 2115633032 (2017.624885559082MB)\n   1.4831598848104477% used\nFrom Space:\n   capacity = 268435456 (256.0MB)\n   used     = 21273368 (20.287864685058594MB)\n   free     = 247162088 (235.7121353149414MB)\n   7.924947142601013% used\nTo Space:\n   capacity = 268435456 (256.0MB)\n   used     = 0 (0.0MB)\n   free     = 268435456 (256.0MB)\n   0.0% used\nconcurrent mark-sweep generation:\n   capacity = 2684354560 (2560.0MB)\n   used     = 395406008 (377.0885543823242MB)\n   free     = 2288948552 (2182.911445617676MB)\n   14.73002165555954% used\n\n85820 interned Strings occupying 9118248 bytes.\n\n</code></pre>\n<h2>nmt info</h2>\n<p><a href=\"https://github.com/walkertest/JavaStudy/blob/master/doc/problemdoc/AMemoryHighProblem/nmt.txt\" rel=\"nofollow noreferrer\">detail see</a></p>\n<ul>\n<li>jcmd pid VM.native_memory detail scale=MB &gt; nmt.txt</li>\n</ul>\n<pre class=\"lang-none prettyprint-override\"><code>Native Memory Tracking:\n\nTotal: reserved=7532MB, committed=6442MB\n-                 Java Heap (reserved=5120MB, committed=5120MB)\n                            (mmap: reserved=5120MB, committed=5120MB) \n \n-                     Class (reserved=1202MB, committed=198MB)\n                            (classes #29966)\n                            (malloc=6MB #91853) \n                            (mmap: reserved=1196MB, committed=192MB) \n \n-                    Thread (reserved=632MB, committed=632MB)\n                            (thread #629)\n                            (stack: reserved=630MB, committed=630MB)\n                            (malloc=1MB #3768) \n                            (arena=1MB #1253)\n \n-                      Code (reserved=277MB, committed=191MB)\n                            (malloc=34MB #42103) \n                            (mmap: reserved=244MB, committed=158MB) \n \n-                        GC (reserved=31MB, committed=31MB)\n                            (malloc=16MB #2974) \n                            (mmap: reserved=15MB, committed=15MB) \n \n-                  Compiler (reserved=2MB, committed=2MB)\n                            (malloc=2MB #4636) \n \n-                  Internal (reserved=155MB, committed=155MB)\n                            (malloc=155MB #52511) \n \n-                    Symbol (reserved=31MB, committed=31MB)\n                            (malloc=27MB #309643) \n                            (arena=4MB #1)\n \n-    Native Memory Tracking (reserved=9MB, committed=9MB)\n                            (malloc=1MB #9371) \n                            (tracking overhead=8MB)\n \n-                   Unknown (reserved=73MB, committed=73MB)\n                            (mmap: reserved=73MB, committed=73MB) \n \nVirtual memory map:\n</code></pre>\n<h2>jmap detail data</h2>\n<p><a href=\"https://i.sstatic.net/2f30gJQM.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/2f30gJQM.png\" alt=\"jmap mat\" /></a></p>\n<h2>pmap info</h2>\n<pre class=\"lang-none prettyprint-override\"><code>pmap infoï¼špmap -x pid &gt; pmap1.txt\npmap info sort :sort -n -k 3 -r pmap1.txt -o pmap2.txt\nsee the addressinfo :tail -c +$((0x00007f8eec000000+1)) /proc/${pid}/mem|head -c $((11616*1024))|strings &gt; data10.txt\n</code></pre>\n<p><a href=\"https://github.com/walkertest/JavaStudy/blob/master/doc/problemdoc/AMemoryHighProblem/pmap1.txt\" rel=\"nofollow noreferrer\">pmap1.txt</a>\n<a href=\"https://github.com/walkertest/JavaStudy/blob/master/doc/problemdoc/AMemoryHighProblem/pmap2.txt\" rel=\"nofollow noreferrer\">pmap2.txt</a>\n<a href=\"https://raw.githubusercontent.com/walkertest/JavaStudy/refs/heads/master/doc/problemdoc/AMemoryHighProblem/data10.txt\" rel=\"nofollow noreferrer\">data10.txt</a></p>\n<p><a href=\"https://i.sstatic.net/JYJkE52C.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/JYJkE52C.png\" alt=\"enter image description here\" /></a></p>\n<p><a href=\"https://i.sstatic.net/TMOXbTaJ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/TMOXbTaJ.png\" alt=\"enter image description here\" /></a></p>\n<ul>\n<li>there are many memory info has be releated to the large string log data(The log may be serval days before). So i do a version that not log large string data then the memory is normal.</li>\n<li>I want to know why the large string log data will cause the jvm memory go high? And which area the memory go high(the log address is not in the nmt info)?</li>\n<li>The large string log data means that the log line has 20KB or more bigger. The code is like below picture.\n<a href=\"https://i.sstatic.net/f9bTec6t.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/f9bTec6t.png\" alt=\"enter image description here\" /></a></li>\n</ul>\n",
    "tags" : [ "java", "memory", "memory-leaks", "pmap", "nmt" ],
    "owner" : {
      "account_id" : 9972847,
      "reputation" : 69,
      "user_id" : 7378390,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/9TbCM.jpg?s=256",
      "display_name" : "walker_fish",
      "link" : "https://stackoverflow.com/users/7378390/walker-fish"
    },
    "is_answered" : false,
    "view_count" : 51,
    "answer_count" : 0,
    "score" : -1,
    "last_activity_date" : 1764726643,
    "creation_date" : 1764644612,
    "link" : "https://stackoverflow.com/questions/79835446/why-large-string-log-data-cause-the-java-progress-memory-high",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140884418,
    "post_id" : 79835446,
    "body" : "I have update the question. Sorry about that. Looking forward to your reply",
    "score" : 0,
    "owner" : {
      "account_id" : 9972847,
      "reputation" : 69,
      "user_id" : 7378390,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/9TbCM.jpg?s=256",
      "display_name" : "walker_fish",
      "link" : "https://stackoverflow.com/users/7378390/walker-fish"
    },
    "creation_date" : 1764725488,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140883187,
    "post_id" : 79835446,
    "body" : "What do you mean by &quot;big data log&quot;? Please read <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a> and explain what your application does and how it works.",
    "score" : 0,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26502,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1764677682,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140882693,
    "post_id" : 79835446,
    "body" : "It seems that the progress has 110 jdbc connnections, not 1200. I use mat to count.",
    "score" : 0,
    "owner" : {
      "account_id" : 9972847,
      "reputation" : 69,
      "user_id" : 7378390,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/9TbCM.jpg?s=256",
      "display_name" : "walker_fish",
      "link" : "https://stackoverflow.com/users/7378390/walker-fish"
    },
    "creation_date" : 1764658363,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140882534,
    "post_id" : 79835446,
    "body" : "Why do you have 1200 JDBC connection objects?",
    "score" : 0,
    "owner" : {
      "account_id" : 71739,
      "reputation" : 311872,
      "user_id" : 207421,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=256&d=identicon&r=PG",
      "display_name" : "user207421",
      "link" : "https://stackoverflow.com/users/207421/user207421"
    },
    "creation_date" : 1764646007,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}