{
  "question" : {
    "question_id" : 79833022,
    "title" : "AudioSystem,isAudioLineSupported returns false",
    "body" : "<p>I am trying to use some Java audio code that worked back in 2019. I am now using the Eclipse IDE with JavaSE-21 running on Windows 11. The following code is not working:</p>\n<pre><code>    AudioFormat af = makeAudioFormat();\n    DataLine.Info info = new DataLine.Info(TargetDataLine.class, af); \n    if (!AudioSystem.isLineSupported(info)) {\n        System.out.println(&quot;Unsupported audio format&quot;);\n        System.out.println(info);\n    }\n</code></pre>\n<p>The println outputs this information:</p>\n<pre><code>Unsupported audio format interface \nTargetDataLine supporting format PCM_SIGNED 44100.0 Hz, 16 bit, mono, 2 bytes/frame, big-endian\n</code></pre>\n<p>I have tried mono/stereo and big-endian/little-endian: they all fail.</p>\n<p>After looking at the Oracle documentation I tried this code:</p>\n<pre><code>    if (AudioSystem.isLineSupported(Port.Info.MICROPHONE)) {\n</code></pre>\n<p>It also fails with Port.Info.LINE_IN.</p>\n<p>Audio input definitely works with Audacity, and with the C program that I wish to replace The C program uses the line settings that I have specified here.</p>\n<p>In Settings/Privacy &amp; Security/Microphone, &quot;let apps access your microphone&quot; is enabled, and I can see records of Audacity and my C program using the microphone, but there is no reference to the Java app.</p>\n<p>If I go on and try to use the TargetDataLine anyway, I get the following stack trace:</p>\n<pre><code>Exception in thread &quot;AWT-EventQueue-0&quot; java.lang.IllegalArgumentException: No line matching interface TargetDataLine supporting format PCM_SIGNED 44100.0 Hz, 16 bit, mono, 2 bytes/frame, big-endian is supported.\n    at java.desktop/javax.sound.sampled.AudioSystem.getLine(AudioSystem.java:423)\n    at foo.recorder.AudioIn.&lt;init&gt;(AudioIn.java:75)\n    at foo.recorder.RecorderTab.startRecord(RecorderTab.java:379)\n    at foo.recorder.RecorderTab$6.buttonPressed(RecorderTab.java:364)\n    at foo.recorder.NoteClickImage$Listener.onClick(NoteClickImage.java:23)\n    at foo.recorder.ClickListener.mouseClicked(ClickListener.java:12)\n    at java.desktop/java.awt.AWTEventMulticaster.mouseClicked(AWTEventMulticaster.java:280)\n    at java.desktop/java.awt.Component.processMouseEvent(Component.java:6624)\n    at java.desktop/javax.swing.JComponent.processMouseEvent(JComponent.java:3398)\n    at java.desktop/java.awt.Component.processEvent(Component.java:6386)\n    at java.desktop/java.awt.Container.processEvent(Container.java:2266)\n    at java.desktop/java.awt.Component.dispatchEventImpl(Component.java:4996)\n    at java.desktop/java.awt.Container.dispatchEventImpl(Container.java:2324)\n    at java.desktop/java.awt.Component.dispatchEvent(Component.java:4828)\n    at java.desktop/java.awt.LightweightDispatcher.retargetMouseEvent(Container.java:4948)\n    at java.desktop/java.awt.LightweightDispatcher.processMouseEvent(Container.java:4584)\n    at java.desktop/java.awt.LightweightDispatcher.dispatchEvent(Container.java:4516)\n    at java.desktop/java.awt.Container.dispatchEventImpl(Container.java:2310)\n    at java.desktop/java.awt.Window.dispatchEventImpl(Window.java:2780)\n    at java.desktop/java.awt.Component.dispatchEvent(Component.java:4828)\n    at java.desktop/java.awt.EventQueue.dispatchEventImpl(EventQueue.java:775)\n    at java.desktop/java.awt.EventQueue$4.run(EventQueue.java:720)\n    at java.desktop/java.awt.EventQueue$4.run(EventQueue.java:714)\n    at java.base/java.security.AccessController.doPrivileged(AccessController.java:400)\n    at java.base/java.security.ProtectionDomain$JavaSecurityAccessImpl.doIntersectionPrivilege(ProtectionDomain.java:87)\n    at java.base/java.security.ProtectionDomain$JavaSecurityAccessImpl.doIntersectionPrivilege(ProtectionDomain.java:98)\n    at java.desktop/java.awt.EventQueue$5.run(EventQueue.java:747)\n    at java.desktop/java.awt.EventQueue$5.run(EventQueue.java:745)\n    at java.base/java.security.AccessController.doPrivileged(AccessController.java:400)\n    at java.base/java.security.ProtectionDomain$JavaSecurityAccessImpl.doIntersectionPrivilege(ProtectionDomain.java:87)\n    at java.desktop/java.awt.EventQueue.dispatchEvent(EventQueue.java:744)\n    at java.desktop/java.awt.EventDispatchThread.pumpOneEventForFilters(EventDispatchThread.java:203)\n    at java.desktop/java.awt.EventDispatchThread.pumpEventsForFilter(EventDispatchThread.java:124)\n    at java.desktop/java.awt.EventDispatchThread.pumpEventsForHierarchy(EventDispatchThread.java:113)\n    at java.desktop/java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:109)\n    at java.desktop/java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:101)\n    at java.desktop/java.awt.EventDispatchThread.run(EventDispatchThread.java:90)\n</code></pre>\n<p>I have read that this exception can also be caused by a security issue.</p>\n<hr>\nFollowing @greg-449's advice, I added code to list available Source datalines, which produced this:\n<pre><code>Mixer: Primary Sound Driver\n  interface SourceDataLine supporting 8 audio formats, and buffers of at least 32 bytes\n    PCM_UNSIGNED unknown sample rate, 8 bit, mono, 1 bytes/frame\n    PCM_SIGNED unknown sample rate, 8 bit, mono, 1 bytes/frame\n    PCM_SIGNED unknown sample rate, 16 bit, mono, 2 bytes/frame, little-endian\n    PCM_SIGNED unknown sample rate, 16 bit, mono, 2 bytes/frame, big-endian\n    PCM_UNSIGNED unknown sample rate, 8 bit, stereo, 2 bytes/frame\n    PCM_SIGNED unknown sample rate, 8 bit, stereo, 2 bytes/frame\n    PCM_SIGNED unknown sample rate, 16 bit, stereo, 4 bytes/frame, little-endian\n    PCM_SIGNED unknown sample rate, 16 bit, stereo, 4 bytes/frame, big-endian\n</code></pre>\n<p>It lists lots of SourceDataLines, but no TargetDataLines. As i understand it, a source is (rather illogically) an output, and a target is an input, so I have the choice of lots of output formats, but no input formats. This confirms my view that it's a security issue.</p>\n<hr>\n<p>I added this code to check whether I have permission to record:</p>\n<pre><code>    javax.sound.sampled.AudioPermission ap = new javax.sound.sampled.AudioPermission(&quot;record&quot;);\n    System.out.println (&quot;audio permission &quot; + ap.toString());\n    \n     try {\n            // Check if the current execution context has the permission\n            AccessController.checkPermission(ap);\n            System.out.println(&quot;Permission is granted. The app can record audio.&quot;);\n            // Proceed with the action\n        } catch (SecurityException e) {\n            System.out.println(&quot;Permission denied. The app cannot rrecord audio.&quot;);\n            // Handle the lack of permission gracefully\n            e.printStackTrace();\n        }\n</code></pre>\n<p>And this is the result:</p>\n<pre><code>audio permission (&quot;javax.sound.sampled.AudioPermission&quot; &quot;record&quot;)\nPermission denied. The app cannot rrecord audio.\njava.security.AccessControlException: access denied (&quot;javax.sound.sampled.AudioPermission&quot; &quot;record&quot;)\n    at java.base/java.security.AccessControlContext.checkPermission(AccessControlContext.java:488)\n    at java.base/java.security.AccessController.checkPermission(AccessController.java:1071)\n</code></pre>\n<p>I tried creating an app.policy file with audio play and record permissions and added it as a VM parameter in Eclipse.</p>\n<ul>\n<li>The above code now reports that I have permission to record</li>\n<li>I get a message saying that Security Manager is deprecated</li>\n<li>I get a security exception when I try to read a file</li>\n<li>I still see no TargetDataLines, and I can't open one.</li>\n</ul>\n",
    "tags" : [ "java", "windows", "audio", "javasound" ],
    "owner" : {
      "account_id" : 3396830,
      "reputation" : 396,
      "user_id" : 2850217,
      "user_type" : "registered",
      "accept_rate" : 42,
      "profile_image" : "https://i.sstatic.net/QZr9N.png?s=256",
      "display_name" : "JavaLatte",
      "link" : "https://stackoverflow.com/users/2850217/javalatte"
    },
    "is_answered" : false,
    "view_count" : 74,
    "closed_date" : 1764454499,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1764454476,
    "creation_date" : 1764383659,
    "link" : "https://stackoverflow.com/questions/79833022/audiosystem-isaudiolinesupported-returns-false",
    "closed_reason" : "Not suitable for this site"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140879496,
    "post_id" : 79833022,
    "body" : "@JavaLatte Do not include solution to question please (post a separate answer instead).",
    "score" : 0,
    "owner" : {
      "account_id" : 5195749,
      "reputation" : 3000,
      "user_id" : 4157124,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ccb2110df592e8d6b210ad3a764f092a?s=256&d=identicon&r=PG",
      "display_name" : "user4157124",
      "link" : "https://stackoverflow.com/users/4157124/user4157124"
    },
    "creation_date" : 1764454495,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140878986,
    "post_id" : 79833022,
    "body" : "Turns out to be a faulty USB cable. I&#39;m going to close this question.",
    "score" : 0,
    "owner" : {
      "account_id" : 3396830,
      "reputation" : 396,
      "user_id" : 2850217,
      "user_type" : "registered",
      "accept_rate" : 42,
      "profile_image" : "https://i.sstatic.net/QZr9N.png?s=256",
      "display_name" : "JavaLatte",
      "link" : "https://stackoverflow.com/users/2850217/javalatte"
    },
    "creation_date" : 1764425376,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140878849,
    "post_id" : 79833022,
    "body" : "Note: AccessController was deprecated for removal in Java 17. At least in Java 25 the checkPermission method <b>always</b> throws an access denied  exception - not sure about Java 21, but I don&#39;t think it is checking anything in the OS.",
    "score" : 0,
    "owner" : {
      "account_id" : 3159259,
      "reputation" : 111551,
      "user_id" : 2670892,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/4iPV5.png?s=256",
      "display_name" : "greg-449",
      "link" : "https://stackoverflow.com/users/2670892/greg-449"
    },
    "creation_date" : 1764415581,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140878793,
    "post_id" : 79833022,
    "body" : "Yes, the lack of TargetDataLines is the issue. I don&#39;t use Windows to I don&#39;t know what the issue might be.",
    "score" : 0,
    "owner" : {
      "account_id" : 3159259,
      "reputation" : 111551,
      "user_id" : 2670892,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/4iPV5.png?s=256",
      "display_name" : "greg-449",
      "link" : "https://stackoverflow.com/users/2670892/greg-449"
    },
    "creation_date" : 1764412694,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140878720,
    "post_id" : 79833022,
    "body" : "There is some code in <a href=\"https://stackoverflow.com/a/39510109/2670892\">this answer</a> which lists what Java thinks is available which might help.",
    "score" : 0,
    "owner" : {
      "account_id" : 3159259,
      "reputation" : 111551,
      "user_id" : 2670892,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/4iPV5.png?s=256",
      "display_name" : "greg-449",
      "link" : "https://stackoverflow.com/users/2670892/greg-449"
    },
    "creation_date" : 1764406682,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}