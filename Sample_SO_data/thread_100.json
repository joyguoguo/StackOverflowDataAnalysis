{
  "question" : {
    "question_id" : 79835931,
    "title" : "MessageFormat.format() gives ClassCast exception",
    "body" : "<p>The following code snippet throws a ClassCastException.</p>\n<p>I know how to fix it, but I'm disappointed that I have to fix it at all, as the Javadoc seems to indicate this should work. But the implementation tries to cast it to an Array (without checking).</p>\n<pre><code>  @Test\n  public void testHelloWorldFormat() {\n    MessageFormat fmt = new MessageFormat(\n        &quot;Hello, {0}.&quot;);\n\n    assertThat(fmt.format(&quot;world&quot;)).isEqualTo(&quot;Hello, world.&quot;);\n  }\n</code></pre>\n<p>I have to write it according to the following, and I don't like it:</p>\n<pre><code>  @Test\n  public void testHelloWorldFormat() {\n    MessageFormat fmt = new MessageFormat(\n        &quot;Hello, {0}.&quot;);\n\n    assertThat(fmt.format(new String[] { &quot;world&quot; })).isEqualTo(&quot;Hello, world.&quot;);\n  }\n</code></pre>\n<p>Relevant link: <a href=\"https://docs.oracle.com/en/java/javase/25/docs/api//java.base/java/text/MessageFormat.html\" rel=\"nofollow noreferrer\">javadoc of <code>MessageFormat</code></a>.</p>\n<p>I found the cause of the problem:</p>\n<p>I'm calling a method from the generic superclass <strong>Format</strong></p>\n<p><code>public final String format(Object obj) </code></p>\n<p>With the generic javadoc &quot;Formats an object to produce a string..&quot;</p>\n",
    "tags" : [ "java", "formatting", "classcastexception", "messageformat" ],
    "owner" : {
      "account_id" : 181683,
      "reputation" : 460,
      "user_id" : 415848,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/CekZ3.jpg?s=256",
      "display_name" : "Maarten van Leunen",
      "link" : "https://stackoverflow.com/users/415848/maarten-van-leunen"
    },
    "is_answered" : false,
    "view_count" : 101,
    "closed_date" : 1764751697,
    "answer_count" : 0,
    "score" : -1,
    "last_activity_date" : 1764862110,
    "creation_date" : 1764682383,
    "link" : "https://stackoverflow.com/questions/79835931/messageformat-format-gives-classcast-exception",
    "closed_reason" : "Needs details or clarity"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140885946,
    "post_id" : 79835931,
    "body" : "Yes, @Slaw, that&#39;s it exactly.  Or at least, that&#39;s the same as my take.",
    "score" : 0,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1764785383,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140885943,
    "post_id" : 79835931,
    "body" : "(i.e., <code>MessageFormat</code> is fundamentally an implementation for formatting <i>arrays</i> and so expects an array, not an arbitrary object; such &quot;arbitrary objects&quot; are actually the elements of the array)",
    "score" : 1,
    "owner" : {
      "account_id" : 8532578,
      "reputation" : 49884,
      "user_id" : 6395627,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Slaw",
      "link" : "https://stackoverflow.com/users/6395627/slaw"
    },
    "creation_date" : 1764785344,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140885936,
    "post_id" : 79835931,
    "body" : "@JohnBollinger Reconsidering, I had a disconnect between the docs and the behavior. I was viewing the argument to <code>MessageFormat</code> in relation to the <i>pattern</i>. In that context, I expected <code>format(Object)</code> and <code>format(Object, ..., ...)</code> to treat the object as a <i>single</i> parameter to the pattern. I believe the existence of the <code>format(Object[], ..., ...)</code> method confused me here (I also thought that method came from <code>Format</code>, but it doesn&#39;t). In reality, it&#39;s in relation to the <i>format</i> and <code>Object[]</code> is to <code>MessageFormat</code> like <code>Number</code> is to <code>DecimalFormat</code>.",
    "score" : 1,
    "owner" : {
      "account_id" : 8532578,
      "reputation" : 49884,
      "user_id" : 6395627,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Slaw",
      "link" : "https://stackoverflow.com/users/6395627/slaw"
    },
    "creation_date" : 1764785167,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140885334,
    "post_id" : 79835931,
    "body" : "But that&#39;s beside the point.  Rants are off-topic here.  This post doesn&#39;t exactly present as one, but it&#39;s unclear to me what else it&#39;s supposed to be.  I&#39;d be happy for it to be reopened if it were edited to present a <i>bona fide</i> on-topic question.",
    "score" : 0,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1764767589,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140885314,
    "post_id" : 79835931,
    "body" : "No, @Slaw, the API docs for <code>Format</code> would not lead me to expect the OP&#39;s code to work.  It makes no sense to interpret the docs or signature of <code>Format.format(Object)</code> to mean that every <code>Format</code> should be able to format objects of every type.  And indeed, they don&#39;t.  This old-school (Java 1.1!) API formats objects of types characteristic of the concrete <code>Format</code> implementation.  The only surprising thing here is that a CCE is thrown, whereas the <code>Format</code> docs seem to indicate that an <code>IllegalArgumentException</code> should be expected when the object presented is inappropriate for the <code>Format</code>.",
    "score" : 1,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1764767012,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140885127,
    "post_id" : 79835931,
    "body" : "@JohnBollinger I don&#39;t think this is a good/clear question as asked but, to be fair, the behavior is a little surprising. Based on the documentation of <code>Format</code> you&#39;d expect the OP&#39;s code to work. Yet <code>MessageFormat</code> changes the <code>format(Object,StringBuffer,FieldPosition)</code> method in an incompatible way, even if the new behavior is documented. And that change indirectly changes how <code>format(Object)</code> works. So, the OP could simply be asking why <code>MessageFormat</code> was implemented this way instead of just adding a <code>format(Object...)</code> overload. Though that&#39;s still not a great question for Stack Overflow",
    "score" : 0,
    "owner" : {
      "account_id" : 8532578,
      "reputation" : 49884,
      "user_id" : 6395627,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Slaw",
      "link" : "https://stackoverflow.com/users/6395627/slaw"
    },
    "creation_date" : 1764759710,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140883716,
    "post_id" : 79835931,
    "body" : "What is the actual question here? (Please edit the question to clarify.) I presume it&#39;s not &quot;but there isn&#39;t one?&quot;, because you&#39;re clearly looking at the relevant API docs, so you must already know there isn&#39;t.",
    "score" : 4,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1764693873,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140883411,
    "post_id" : 79835931,
    "body" : "There is a static method <code>format(String, Object...)</code>. Is that not suitable?",
    "score" : 2,
    "owner" : {
      "account_id" : 2485939,
      "reputation" : 20969,
      "user_id" : 2164365,
      "user_type" : "registered",
      "accept_rate" : 40,
      "profile_image" : "https://i.sstatic.net/RKSgV.png?s=256",
      "display_name" : "Abra",
      "link" : "https://stackoverflow.com/users/2164365/abra"
    },
    "creation_date" : 1764684978,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140883402,
    "post_id" : 79835931,
    "body" : "&quot;as the Javadoc seems to indicate this should work&quot; - could you clarify <i>exactly</i> what in the Javadoc leads you to expect that will work? The Javadoc I&#39;m reading now seems to indicate there&#39;ll be a cast to <code>Object[]</code>: &quot;This is equivalent to <code>format((Object[]) arguments, result, pos)</code>&quot;",
    "score" : 1,
    "owner" : {
      "account_id" : 11683,
      "reputation" : 1520942,
      "user_id" : 22656,
      "user_type" : "registered",
      "accept_rate" : 86,
      "profile_image" : "https://www.gravatar.com/avatar/6d8ebb117e8d83d74ea95fbdd0f87e13?s=256&d=identicon&r=PG",
      "display_name" : "Jon Skeet",
      "link" : "https://stackoverflow.com/users/22656/jon-skeet"
    },
    "creation_date" : 1764684735,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}