{
  "question" : {
    "question_id" : 79640924,
    "title" : "Are `org.reflections.Reflections` not working on Android?",
    "body" : "<p>I wrote myself a small library that scans one or more packages for classes that are annotated using a specific annotation and then does some fancy stuff on these classes.\nNow I just wanted to use that library in an Android application that I am writing but here this doesn't seem to work.</p>\n<pre><code>import org.reflections.Reflections;\n\n    ...\n    public void scanPackages(String[] packageNames) {\n        Reflections reflections = new Reflections(packageNames);\n\n        // Scan for base types\n        Set&lt;Class&lt;?&gt;&gt; baseTypes = reflections.getTypesAnnotatedWith(PolymorphicBaseType.class);\n        Log.i(TAG, &quot;polymorphic types are: &quot; + baseTypes);\n        ...\n        // further code omitted for brevity...\n    }\n    ...\n</code></pre>\n<p>When using a standard Java environment the above code works fine (i.e. the Set <code>baseTypes</code> contains a set with all classes that have the requested annotation after the call to <code>getTypesAnnotatedWith(...)</code>). But when executing this code on Android <code>baseTypes</code> is a always empty. :-(</p>\n<p>My code uses the library &quot;org.reflections:reflections:0.10.2&quot; which IMHO is pretty standard and widely used to query for classes fulfilling certain criteria, like here, e.g. having specific annotations.</p>\n<p>I am aware of this question: <a href=\"https://stackoverflow.com/questions/32772229/reflections-library-returns-empty-list-in-android\">Reflections library returns empty list in Android</a> but that was 6 years ago. Is this still the state of the art, i.e. is reflection this still not working on Android?</p>\n<p>In case this matters: My settings re. SDK are:</p>\n<pre><code>compileSdk 35\nminSdk 26\ntargetSdk 35\n</code></pre>\n<p>Since for some reason I can't add an answer to this question - presumably because someone smart defined this question as a duplicate - I add my own solution here:</p>\n<p><strong>Solution/workaround:</strong></p>\n<p>In case anyone comes up with the same question: here's my work-around using <code>dalvik.system.DexFile</code> (which is also deprecated and may also soon not be supported anymore but until then it should work).\nFor this work-around one needs to pass-in the current app's <code>Context</code> (if that is passed in as null then the code assumes to be NOT running in an Android runtime which is helpful e.g. when using the class in unit tests - as I do):</p>\n<pre><code>import android.content.Context;\nimport dalvik.system.DexFile;\n... other imports omitted for brevity ...\n\n    public void scanPackages(Context context, String[] packageNames) {\n        Collection&lt;Class&lt;?&gt;&gt; baseTypes;\n        Collection&lt;Class&lt;?&gt;&gt; subTypes;\n        if (context != null) { // we are on Android\n            List&lt;Class&lt;?&gt;&gt; allClasses = new ArrayList&lt;&gt;();\n            try {\n                DexFile dex = new DexFile(context.getApplicationInfo().sourceDir);\n                Enumeration&lt;String&gt; classes = dex.entries();\n                while (classes.hasMoreElements()) {\n                    String className = classes.nextElement();\n                    for (String packageName: packageNames) {\n                        if (className.startsWith(packageName)) {\n                            allClasses.add(Class.forName(className));\n                            break;\n                        }\n                    }\n                }\n            } catch (Exception e) {\n                Log.e(TAG, &quot;Exception obtaining classes&quot;, e);\n                return;\n            }\n            // now we can try to filter the obtained class-list for whatever criteria we need. E.g.:\n            baseTypes = getTypesAnnotatedWith(allClasses, YamlPolymorphicBaseType.class);\n            subTypes = getTypesAnnotatedWith(allClasses, YamlPolymorphicSubtype.class);\n        } else { // hopefully an environment where Reflections are working:\n            Reflections reflections = new Reflections(packageNames);\n            // Scan for base types\n            baseTypes = reflections.getTypesAnnotatedWith(YamlPolymorphicBaseType.class);\n            subTypes  = reflections.getTypesAnnotatedWith(YamlPolymorphicSubtype.class);\n        }\n        ... do your stuff using the found classes here ...\n    }\n\n    Collection&lt;Class&lt;?&gt;&gt; getTypesAnnotatedWith(Collection&lt;Class&lt;?&gt;&gt; allClasses, Class&lt;? extends Annotation&gt; annotationClass) {\n        return allClasses\n            .stream()\n            .filter(clazz -&gt; clazz.isAnnotationPresent(annotationClass))\n            .collect(Collectors.toList());\n    }\n    ...\n}\n</code></pre>\n",
    "tags" : [ "java", "android", "annotations" ],
    "owner" : {
      "account_id" : 186200,
      "reputation" : 4396,
      "user_id" : 423411,
      "user_type" : "registered",
      "accept_rate" : 25,
      "profile_image" : "https://www.gravatar.com/avatar/c10c9233ec4dc1174a22150f3c76c792?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "mmo",
      "link" : "https://stackoverflow.com/users/423411/mmo"
    },
    "is_answered" : false,
    "view_count" : 25,
    "closed_date" : 1748366065,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1748440253,
    "creation_date" : 1748365849,
    "link" : "https://stackoverflow.com/questions/79640924/are-org-reflections-reflections-not-working-on-android",
    "closed_reason" : "Duplicate"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140464121,
    "post_id" : 79640924,
    "body" : "That library specifically does not support Android, apparently. It&#39;s been discussed in several issues over the years -- see <a href=\"https://github.com/ronmamo/reflections/issues/127\" rel=\"nofollow noreferrer\">this additional issue</a> as one of several. And, that library is no longer being actively maintained.",
    "score" : 0,
    "owner" : {
      "account_id" : 39846,
      "reputation" : 1011205,
      "user_id" : 115145,
      "user_type" : "registered",
      "accept_rate" : 84,
      "profile_image" : "https://i.sstatic.net/wDnd8.png?s=256",
      "display_name" : "CommonsWare",
      "link" : "https://stackoverflow.com/users/115145/commonsware"
    },
    "creation_date" : 1748381723,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140463913,
    "post_id" : 79640924,
    "body" : "I don&#39;t quite get what this is supposed to tell me.",
    "score" : 0,
    "owner" : {
      "account_id" : 186200,
      "reputation" : 4396,
      "user_id" : 423411,
      "user_type" : "registered",
      "accept_rate" : 25,
      "profile_image" : "https://www.gravatar.com/avatar/c10c9233ec4dc1174a22150f3c76c792?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "mmo",
      "link" : "https://stackoverflow.com/users/423411/mmo"
    },
    "creation_date" : 1748377066,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140463439,
    "post_id" : 79640924,
    "body" : "See also <a href=\"https://github.com/ronmamo/reflections/issues/339\" rel=\"nofollow noreferrer\">github.com/ronmamo/reflections/issues/339</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 39846,
      "reputation" : 1011205,
      "user_id" : 115145,
      "user_type" : "registered",
      "accept_rate" : 84,
      "profile_image" : "https://i.sstatic.net/wDnd8.png?s=256",
      "display_name" : "CommonsWare",
      "link" : "https://stackoverflow.com/users/115145/commonsware"
    },
    "creation_date" : 1748366094,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}