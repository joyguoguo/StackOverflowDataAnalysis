{
  "question" : {
    "question_id" : 79602264,
    "title" : "Upgrading from ojdbc8 to ojdbc17 causes error when trying to query a date field",
    "body" : "<p>I have a Java application that uses an Oracle database with date fields in a number of the tables.</p>\n<p>I have a number of queries in the code in which attempt to retrieve the date values and stuff them into an instance variable.</p>\n<p>These all worked fine when my Oracle JDBC driver was ojdbc8 version 19.8.0.0, but I've since had to upgrade to ojdbc17 version 23.7.0.25.01, and those queries now come back with the following error or something similar:</p>\n<blockquote>\n<p>Could not extract column [1] from JDBC ResultSet [ORA-18716: {0} not in any time zone.DATE https://docs.oracle.com/error-help/db/ora-18716/] [n/a]</p>\n</blockquote>\n<p>Here is an example of one of the queries in the code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@PersistenceContext\nprivate EntityManager em;\n\nString sqlQueryString = &quot;SELECT h.commentDate FROM CommentsHistory as h WHERE h.revisionId = 4878&quot;;\n\nTypedQuery&lt;Instant&gt; resolvedCommentDateQuery = em.createQuery(sqlQueryString, Instant.class);\n\ntry {\n    //This is where the error is thrown! \n    List&lt;Instant&gt; instantList = resolvedCommentDateQuery.getResultList();\n    return null;\n} catch (NoResultException nre) {\n    return null;\n}\n</code></pre>\n<p>Previously, my pom.xml file dependency looked like this, and it worked fine:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;!-- Oracle JDBC Driver --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;com.oracle.database.jdbc&lt;/groupId&gt;\n    &lt;artifactId&gt;ojdbc8&lt;/artifactId&gt;\n    &lt;version&gt;19.8.0.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>I had to update my pom.xml file dependency to this, and now it throws the error:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;!-- Oracle JDBC Driver --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;com.oracle.database.jdbc&lt;/groupId&gt;\n    &lt;artifactId&gt;ojdbc17&lt;/artifactId&gt;\n    &lt;version&gt;23.7.0.25.01&lt;/version&gt; \n&lt;/dependency&gt;\n</code></pre>\n",
    "tags" : [ "java", "oracle-database", "jdbc", "ojdbc" ],
    "owner" : {
      "account_id" : 19033204,
      "reputation" : 867,
      "user_id" : 13894850,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/56b085ca89bdbc97e22bbb768cc752bf?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Tim",
      "link" : "https://stackoverflow.com/users/13894850/tim"
    },
    "is_answered" : true,
    "view_count" : 935,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1746361203,
    "creation_date" : 1746119475,
    "link" : "https://stackoverflow.com/questions/79602264/upgrading-from-ojdbc8-to-ojdbc17-causes-error-when-trying-to-query-a-date-field",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79605605,
    "question_id" : 79602264,
    "body" : "<p><code>ojdbc17</code> is strict about mismatches and will not auto convert <code>Date</code> to <code>Instant</code> which has caused ORA-18716 error. First of all, we will map oracle <code>Date</code> to Java <code>Date</code> and then we will convert <code>Date</code> to <code>Instant</code></p>\n<pre><code>TypedQuery&lt;Date&gt; resolvedCommentDateQuery = em.createQuery(sqlQueryString, Date.class);\n\ntry {\n    List&lt;Date&gt; dateList = resolvedCommentDateQuery.getResultList();\n    List&lt;Instant&gt; instantList = dateList.stream()\n                                        .map(Date::toInstant)\n                                        .collect(Collectors.toList());\n\n    return null;\n} catch (NoResultException nre) {\n    return null;\n}\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 9378438,
      "reputation" : 1337,
      "user_id" : 8504033,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/48c7c7f25b9c7ba3e9348f52d92eb489?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Abdul Alim Shakir",
      "link" : "https://stackoverflow.com/users/8504033/abdul-alim-shakir"
    },
    "creation_date" : 1746361203,
    "last_activity_date" : 1746361203,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140390955,
    "post_id" : 79602264,
    "body" : "Thanks I did something similar and grabbed it as a java.util.Date and converted it to an Instant manually.",
    "score" : 0,
    "owner" : {
      "account_id" : 19033204,
      "reputation" : 867,
      "user_id" : 13894850,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/56b085ca89bdbc97e22bbb768cc752bf?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Tim",
      "link" : "https://stackoverflow.com/users/13894850/tim"
    },
    "creation_date" : 1746206501,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140388752,
    "post_id" : 79602264,
    "body" : "@Tim, Try replacing <code>Instant.class</code> with <code>java.sql.Timestamp.class</code> or <code>LocalDateTime.class</code> in your <code>TypedQuery</code>, then convert it to Instant manually.",
    "score" : 1,
    "owner" : {
      "account_id" : 7645025,
      "reputation" : 440,
      "user_id" : 5795975,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-6KwPUS4RnyA/AAAAAAAAAAI/AAAAAAAAC8w/auZqreI45x0/s256-rj/photo.jpg",
      "display_name" : "Vijay",
      "link" : "https://stackoverflow.com/users/5795975/vijay"
    },
    "creation_date" : 1746151292,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140388706,
    "post_id" : 79602264,
    "body" : "I don&#39;t think that &gt;that&lt; query code should produce that error.  An <code>Instant</code> is not a zoned timestamp. Please show us the stacktrace and the corresponding code for an actual failure.",
    "score" : 1,
    "owner" : {
      "account_id" : 47283,
      "reputation" : 723428,
      "user_id" : 139985,
      "user_type" : "registered",
      "accept_rate" : 69,
      "profile_image" : "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=256&d=identicon&r=PG",
      "display_name" : "Stephen C",
      "link" : "https://stackoverflow.com/users/139985/stephen-c"
    },
    "creation_date" : 1746148277,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140388697,
    "post_id" : 79602264,
    "body" : "The info at that URL is: &quot;ORA-18716. The data does not include timezone information. Cause: The data being processed does not contain timezone information, which is required for operations involving timezone-aware types. Action: Ensure that the input data includes timezone information when working with timezone-sensitive types such as <code>OffsetDateTime</code>, <code>OffsetTime</code>, or <code>ZonedDateTime</code>.",
    "score" : 1,
    "owner" : {
      "account_id" : 47283,
      "reputation" : 723428,
      "user_id" : 139985,
      "user_type" : "registered",
      "accept_rate" : 69,
      "profile_image" : "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=256&d=identicon&r=PG",
      "display_name" : "Stephen C",
      "link" : "https://stackoverflow.com/users/139985/stephen-c"
    },
    "creation_date" : 1746148036,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}