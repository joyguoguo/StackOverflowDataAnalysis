{
  "question" : {
    "question_id" : 79553827,
    "title" : "Why @Encode annotation isn&#39;t applied to multiple parameters at Controller level?",
    "body" : "<p>I have a problem with OpenAPI curl generation.</p>\n<p>I have to create <code>POST</code> method with <strong>three parameters</strong>: <strong>application/json, text/plain and multipart/form-data medium types</strong>. So <code>curl</code> that is going to be generated by OpenAPI is supposed to be like:</p>\n<pre class=\"lang-http prettyprint-override\"><code>curl -X 'POST' \\\n  'http://localhost:8080/test/third' \\\n  -H 'accept: */*' \\\n  -H 'Content-Type: multipart/form-data' \\\n  -F 'file=@test_file.docx;type=multipart/form-data' \\\n  -F 'dto={&quot;name&quot;:&quot;string&quot;,&quot;description&quot;:&quot;string&quot;};type=application/json' \\\n  -F 'str=some_test_value;type=text/plain' \\\n</code></pre>\n<p>But <strong>it doesn't work</strong>.</p>\n<p><strong>Controller:</strong></p>\n<pre><code>package org.example.springbased.web;\n\nimport io.swagger.v3.oas.annotations.Parameter;\nimport io.swagger.v3.oas.annotations.media.Content;\nimport io.swagger.v3.oas.annotations.media.Encoding;\nimport io.swagger.v3.oas.annotations.parameters.RequestBody;\nimport org.springframework.http.MediaType;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestPart;\nimport org.springframework.web.bind.annotation.RestController;\nimport org.springframework.web.multipart.MultipartFile;\n\n@RestController\n@RequestMapping(&quot;/test&quot;)\npublic class TestController {\n\n    @PostMapping(value = &quot;/second&quot;, consumes = MediaType.MULTIPART_FORM_DATA_VALUE)\n    public ResponseEntity&lt;String&gt; test(\n        @RequestBody(content = @Content(encoding = @Encoding(name = &quot;dto&quot;, contentType = MediaType.APPLICATION_JSON_VALUE)))\n        @Parameter(description = &quot;An extra JSON payload sent with file&quot;)\n        @RequestPart(&quot;dto&quot;)\n        DTO dto,\n        @RequestBody(content = @Content(encoding = @Encoding(name = &quot;file&quot;, contentType = MediaType.MULTIPART_FORM_DATA_VALUE)))\n        @Parameter(required = true)\n        @RequestPart(&quot;file&quot;) MultipartFile file){\n        return ResponseEntity.ok(&quot;Request Accepted: &quot; + dto.toString());\n    }\n\n    @PostMapping(value =&quot;/first&quot;, consumes = MediaType.MULTIPART_FORM_DATA_VALUE)\n    public ResponseEntity&lt;String&gt; uploadMultipartWithBody(\n        @RequestBody(content = @Content(encoding = @Encoding(name = &quot;file&quot;, contentType = MediaType.MULTIPART_FORM_DATA_VALUE)))\n        @Parameter(required = true)\n        @RequestPart(&quot;file&quot;) MultipartFile file,\n        @RequestBody(content = @Content(encoding = @Encoding(name = &quot;dto&quot;, contentType = MediaType.APPLICATION_JSON_VALUE)))\n        @Parameter(description = &quot;An extra JSON payload sent with file&quot;)\n        @RequestPart(&quot;dto&quot;)\n        DTO dto){\n        return ResponseEntity.ok(&quot;Request Accepted: &quot; + dto.toString());\n    }\n\n    @PostMapping(value =&quot;/third&quot;, consumes = MediaType.MULTIPART_FORM_DATA_VALUE)\n    public ResponseEntity&lt;String&gt; threeParams(\n        @RequestBody(content = @Content(encoding = @Encoding(name = &quot;file&quot;, contentType = MediaType.MULTIPART_FORM_DATA_VALUE)))\n        @Parameter(required = true)\n        @RequestPart(&quot;file&quot;) MultipartFile file,\n        @RequestBody(content = @Content(encoding = @Encoding(name = &quot;dto&quot;, contentType = MediaType.APPLICATION_JSON_VALUE)))\n        @Parameter(description = &quot;An extra JSON payload sent with file&quot;)\n        @RequestPart(&quot;dto&quot;)\n        DTO dto,\n        @RequestBody(content = @Content(encoding = @Encoding(name = &quot;str&quot;, contentType = MediaType.TEXT_PLAIN_VALUE)))\n        @RequestPart(&quot;str&quot;)\n        String str){\n        return ResponseEntity.ok(&quot;Request Accepted: &quot; + dto.toString());\n    }\n}\n</code></pre>\n<p><strong>Generated OpenAPI:</strong></p>\n<pre><code>{\n  &quot;openapi&quot;: &quot;3.1.0&quot;,\n  &quot;info&quot;: {\n    &quot;title&quot;: &quot;OpenAPI definition&quot;,\n    &quot;version&quot;: &quot;v0&quot;\n  },\n  &quot;servers&quot;: [\n    {\n      &quot;url&quot;: &quot;http://localhost:8080&quot;,\n      &quot;description&quot;: &quot;Generated server url&quot;\n    }\n  ],\n  &quot;paths&quot;: {\n    &quot;/test/third&quot;: {\n      &quot;post&quot;: {\n        &quot;tags&quot;: [\n          &quot;test-controller&quot;\n        ],\n        &quot;operationId&quot;: &quot;threeParams&quot;,\n        &quot;requestBody&quot;: {\n          &quot;content&quot;: {\n            &quot;multipart/form-data&quot;: {\n              &quot;schema&quot;: {\n                &quot;type&quot;: &quot;object&quot;,\n                &quot;properties&quot;: {\n                  &quot;file&quot;: {\n                    &quot;type&quot;: &quot;string&quot;,\n                    &quot;format&quot;: &quot;binary&quot;\n                  },\n                  &quot;dto&quot;: {\n                    &quot;$ref&quot;: &quot;#/components/schemas/DTO&quot;\n                  },\n                  &quot;str&quot;: {\n                    &quot;type&quot;: &quot;string&quot;\n                  }\n                },\n                &quot;required&quot;: [\n                  &quot;dto&quot;,\n                  &quot;file&quot;,\n                  &quot;str&quot;\n                ]\n              },\n              &quot;encoding&quot;: {\n                &quot;file&quot;: {\n                  &quot;contentType&quot;: &quot;multipart/form-data&quot;\n                }\n              }\n            }\n          }\n        },\n        &quot;responses&quot;: {\n          &quot;200&quot;: {\n            &quot;description&quot;: &quot;OK&quot;,\n            &quot;content&quot;: {\n              &quot;*/*&quot;: {\n                &quot;schema&quot;: {\n                  &quot;type&quot;: &quot;string&quot;\n                }\n              }\n            }\n          }\n        }\n      }\n    },\n    &quot;/test/second&quot;: {\n      &quot;post&quot;: {\n        &quot;tags&quot;: [\n          &quot;test-controller&quot;\n        ],\n        &quot;operationId&quot;: &quot;test&quot;,\n        &quot;requestBody&quot;: {\n          &quot;content&quot;: {\n            &quot;multipart/form-data&quot;: {\n              &quot;schema&quot;: {\n                &quot;type&quot;: &quot;object&quot;,\n                &quot;properties&quot;: {\n                  &quot;dto&quot;: {\n                    &quot;$ref&quot;: &quot;#/components/schemas/DTO&quot;\n                  },\n                  &quot;file&quot;: {\n                    &quot;type&quot;: &quot;string&quot;,\n                    &quot;format&quot;: &quot;binary&quot;\n                  }\n                },\n                &quot;required&quot;: [\n                  &quot;dto&quot;,\n                  &quot;file&quot;\n                ]\n              },\n              &quot;encoding&quot;: {\n                &quot;dto&quot;: {\n                  &quot;contentType&quot;: &quot;application/json&quot;\n                }\n              }\n            }\n          }\n        },\n        &quot;responses&quot;: {\n          &quot;200&quot;: {\n            &quot;description&quot;: &quot;OK&quot;,\n            &quot;content&quot;: {\n              &quot;*/*&quot;: {\n                &quot;schema&quot;: {\n                  &quot;type&quot;: &quot;string&quot;\n                }\n              }\n            }\n          }\n        }\n      }\n    },\n    &quot;/test/first&quot;: {\n      &quot;post&quot;: {\n        &quot;tags&quot;: [\n          &quot;test-controller&quot;\n        ],\n        &quot;operationId&quot;: &quot;uploadMultipartWithBody&quot;,\n        &quot;requestBody&quot;: {\n          &quot;content&quot;: {\n            &quot;multipart/form-data&quot;: {\n              &quot;schema&quot;: {\n                &quot;type&quot;: &quot;object&quot;,\n                &quot;properties&quot;: {\n                  &quot;file&quot;: {\n                    &quot;type&quot;: &quot;string&quot;,\n                    &quot;format&quot;: &quot;binary&quot;\n                  },\n                  &quot;dto&quot;: {\n                    &quot;$ref&quot;: &quot;#/components/schemas/DTO&quot;\n                  }\n                },\n                &quot;required&quot;: [\n                  &quot;dto&quot;,\n                  &quot;file&quot;\n                ]\n              },\n              &quot;encoding&quot;: {\n                &quot;file&quot;: {\n                  &quot;contentType&quot;: &quot;multipart/form-data&quot;\n                }\n              }\n            }\n          }\n        },\n        &quot;responses&quot;: {\n          &quot;200&quot;: {\n            &quot;description&quot;: &quot;OK&quot;,\n            &quot;content&quot;: {\n              &quot;*/*&quot;: {\n                &quot;schema&quot;: {\n                  &quot;type&quot;: &quot;string&quot;\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  &quot;components&quot;: {\n    &quot;schemas&quot;: {\n      &quot;DTO&quot;: {\n        &quot;type&quot;: &quot;object&quot;,\n        &quot;description&quot;: &quot;An extra JSON payload sent with file&quot;,\n        &quot;properties&quot;: {\n          &quot;name&quot;: {\n            &quot;type&quot;: &quot;string&quot;\n          },\n          &quot;description&quot;: {\n            &quot;type&quot;: &quot;string&quot;\n          }\n        }\n      }\n    }\n  }\n}\n</code></pre>\n<p>As you can see even if I specify</p>\n<pre class=\"lang-java prettyprint-override\"><code>@RequestBody(content = @Content(encoding = @Encoding(name = &quot;...&quot;, contentType = MediaType....))\n</code></pre>\n<p>for each parameter it takes only the first one that's specified for the first parameter.</p>\n<p>Why? What I need to do to make it works?</p>\n<p>Dependencies that I use with gradle + java 21:</p>\n<pre class=\"lang-java prettyprint-override\"><code>dependencies {\n    implementation 'org.springframework.boot:spring-boot-starter-web'\n    implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.8.6'\n    implementation 'org.springframework.boot:spring-boot-devtools'\n}\n</code></pre>\n<p>Documentation that I followed: <a href=\"https://springdoc.org/#is-file-upload-supported\" rel=\"nofollow noreferrer\">https://springdoc.org/#is-file-upload-supported</a></p>\n",
    "tags" : [ "java", "spring", "spring-boot", "spring-mvc", "openapi" ],
    "owner" : {
      "account_id" : 41176007,
      "reputation" : 21,
      "user_id" : 30160001,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Xx4xNbcg.gif?s=256",
      "display_name" : "tidik",
      "link" : "https://stackoverflow.com/users/30160001/tidik"
    },
    "is_answered" : false,
    "view_count" : 58,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1746113057,
    "creation_date" : 1743708553,
    "link" : "https://stackoverflow.com/questions/79553827/why-encode-annotation-isnt-applied-to-multiple-parameters-at-controller-level",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79602100,
    "question_id" : 79553827,
    "body" : "<p>From the maintainer...</p>\n<p>These multiple encodings should be defined on the <code>RequestBody</code> annotation.\nHere is an example, to get your expected result:</p>\n<pre class=\"lang-java prettyprint-override\"><code>    @PostMapping(value =&quot;/first&quot;, consumes = MediaType.MULTIPART_FORM_DATA_VALUE)\n    @RequestBody(content = @Content(encoding = {\n            @Encoding(name = &quot;file&quot;, contentType = MediaType.APPLICATION_OCTET_STREAM_VALUE),\n            @Encoding(name = &quot;dto&quot;, contentType = MediaType.APPLICATION_JSON_VALUE)\n    }))\n    public ResponseEntity&lt;String&gt; uploadMultipartWithBody(\n            @Parameter(required = true)\n            @RequestPart(&quot;file&quot;) MultipartFile file,\n            @Parameter(description = &quot;An extra JSON payload sent with file&quot;)\n            @RequestPart(&quot;dto&quot;)\n            PersonDTO dto){\n        return ResponseEntity.ok(&quot;Request Accepted: &quot; + dto.toString());\n    }\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 11698906,
      "reputation" : 3650,
      "user_id" : 8564731,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-YS7UCJcQ0-Q/AAAAAAAAAAI/AAAAAAAAACg/55XwHWieOlI/s256-rj/photo.jpg",
      "display_name" : "Jeremy Fiel",
      "link" : "https://stackoverflow.com/users/8564731/jeremy-fiel"
    },
    "creation_date" : 1746113057,
    "last_activity_date" : 1746113057,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140296746,
    "post_id" : 79553827,
    "body" : "@JeremyFiel, thank you!",
    "score" : 0,
    "owner" : {
      "account_id" : 41176007,
      "reputation" : 21,
      "user_id" : 30160001,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Xx4xNbcg.gif?s=256",
      "display_name" : "tidik",
      "link" : "https://stackoverflow.com/users/30160001/tidik"
    },
    "creation_date" : 1743712938,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140296709,
    "post_id" : 79553827,
    "body" : "btw, your <code>file: { format: binary }</code> should be <code>application&#47;octet-stream</code>, not a nested multipart document.  If you want to use a nested multipart document, I can almost guarantee there is no tooling to handle that use case.",
    "score" : 0,
    "owner" : {
      "account_id" : 11698906,
      "reputation" : 3650,
      "user_id" : 8564731,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-YS7UCJcQ0-Q/AAAAAAAAAAI/AAAAAAAAACg/55XwHWieOlI/s256-rj/photo.jpg",
      "display_name" : "Jeremy Fiel",
      "link" : "https://stackoverflow.com/users/8564731/jeremy-fiel"
    },
    "creation_date" : 1743712232,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140296606,
    "post_id" : 79553827,
    "body" : "<a href=\"https://github.com/springdoc/springdoc-openapi/issues/2958\" rel=\"nofollow noreferrer\">github.com/springdoc/springdoc-openapi/issues/2958</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 11698906,
      "reputation" : 3650,
      "user_id" : 8564731,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-YS7UCJcQ0-Q/AAAAAAAAAAI/AAAAAAAAACg/55XwHWieOlI/s256-rj/photo.jpg",
      "display_name" : "Jeremy Fiel",
      "link" : "https://stackoverflow.com/users/8564731/jeremy-fiel"
    },
    "creation_date" : 1743710316,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}