{
  "question" : {
    "question_id" : 79743762,
    "title" : "Check if a JdbcClient transaction ran successfully in Java Spring",
    "body" : "<p>I need to insert one row of data in two different tables. Since the tables are related, i grouped the insert in a <code>TRANSACTION</code> in order to make them behave as an atomic operation.</p>\n<p>My code follows:</p>\n<pre><code>    String query = &quot;&quot;&quot;\n        BEGIN TRANSACTION;\n\n        INSERT INTO usuario (\n            email,\n            senha,\n            nome,\n            status\n        )\n        VALUES (\n            :email,\n            :senha,\n            :nome,\n            'Ativo'\n        );\n\n        INSERT INTO organizador (\n            id,\n            cpf_cnpj\n        )\n        VALUES (\n            (\n                SELECT us.id \n                FROM usuario AS us \n                WHERE us.email = :email AND us.senha = :senha\n            ),\n            :cpf\n        );\n\n        COMMIT;\n    &quot;&quot;&quot;;\n\n    int res = jdbcClient\n        .sql(query)\n        .param(&quot;email&quot;, email)\n        .param(&quot;senha&quot;, senha)\n        .param(&quot;nome&quot;, nome)\n        .param(&quot;cpf&quot;, cpf)\n        .update();\n\n        \n    System.out.println(&quot;result: &quot; + res);\n    \n    return res == 2;\n</code></pre>\n<p>After running, I can check pgAdmin and verify that the rows were correctly inserted.</p>\n<p>However, when checking the variable <code>res</code> in the code, to see how many rows were affected, it's value is always 0. i believe this is because its not a plain insert, but a transaction.</p>\n<p>How would I be able to check wether my transaction ran successfully or not?</p>\n<p>Note that I'm using the <strong>Spring</strong> framework and a <strong>PostgreSQL</strong> database, accessed through the <strong>JdbcClient</strong></p>\n",
    "tags" : [ "java", "spring", "postgresql", "jdbc", "spring-jdbc" ],
    "owner" : {
      "account_id" : 12205819,
      "reputation" : 307,
      "user_id" : 8908951,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-rqQkreaFZWA/AAAAAAAAAAI/AAAAAAAAR3o/XXxb5Xcvugk/s256-rj/photo.jpg",
      "display_name" : "Lucca Bibar",
      "link" : "https://stackoverflow.com/users/8908951/lucca-bibar"
    },
    "is_answered" : true,
    "view_count" : 130,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1756211290,
    "creation_date" : 1755888859,
    "link" : "https://stackoverflow.com/questions/79743762/check-if-a-jdbcclient-transaction-ran-successfully-in-java-spring",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79746832,
    "question_id" : 79743762,
    "body" : "<p>Not the answer but a different strategy:</p>\n<p>I would like to suggest to use <a href=\"https://www.geeksforgeeks.org/java/jpa-introduction/\" rel=\"nofollow noreferrer\">jpa</a> / <a href=\"https://www.w3resource.com/PostgreSQL/snippets/postgresql-spring-boot.php\" rel=\"nofollow noreferrer\">postgresSQL with spring</a>, to create entities: mapping sql tables to Java objects.</p>\n<p>Then jpa takes care of low level stuff, and you take care of the logic and don't need to use 'low level' sql.</p>\n<p>Add a service layer in your spring application with @Transactional on the service or method addUsuario(...)</p>\n<p>And use <a href=\"https://www.geeksforgeeks.org/springboot/what-is-spring-data-jpa/\" rel=\"nofollow noreferrer\">Spring JPA</a> defining JPA Repositories for the 'crud' actions and custom queries.</p>\n<p>and with correct auto create ids config in your Entities this would be something like</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Transactional\npublic class OrganizadorService {\n    public create(String name, cpf)\n        Usuario usuario = new Usuario();\n        \n        usuario.setNome(name);\n        // or find using the UsuarioRepository.findById (or Name)\n        // and create if not found\n        Usuario newUsuario = UsuarioRepostory.save(usuario); // Create \n        // new Instance returned , use that one futher\n        Organizador org = new Organizador();\n        org.setCpf(cpf);\n        org.setUsuario(newUsuario);\n        \n        \n        OrganizadorRepository.save(org);\n    }\n}\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 5932321,
      "reputation" : 93,
      "user_id" : 7968292,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/842e09d76080a97ff694c2833dc942ec?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jvo",
      "link" : "https://stackoverflow.com/users/7968292/jvo"
    },
    "creation_date" : 1756211290,
    "last_activity_date" : 1756211290,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140687807,
    "post_id" : 79743762,
    "body" : "@SpaceTrucker @MarkRotterveel thanks for the feedback. I now understand the reason why <code>res</code> is equal to 0, and that there is a proper way to make multiple updates atomically in Spring. However, I can&#39;t figure out how to properly make multiple updates atomically using JdbcClient, even after reading the docs you provided. I will read it more thoroughly, but I would ask for a clearer article or tutorial, if you happen to know one.",
    "score" : 0,
    "owner" : {
      "account_id" : 12205819,
      "reputation" : 307,
      "user_id" : 8908951,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-rqQkreaFZWA/AAAAAAAAAAI/AAAAAAAAR3o/XXxb5Xcvugk/s256-rj/photo.jpg",
      "display_name" : "Lucca Bibar",
      "link" : "https://stackoverflow.com/users/8908951/lucca-bibar"
    },
    "creation_date" : 1755996877,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140687094,
    "post_id" : 79743762,
    "body" : "When using JDBC, Spring JDBC, and other libraries built on JDBC, you should <i>not</i> issue statements like <code>BEGIN TRANSACTION;</code> and <code>COMMIT;</code>",
    "score" : 2,
    "owner" : {
      "account_id" : 213468,
      "reputation" : 110282,
      "user_id" : 466862,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d873f397779db38cd510d9ee5416fd43?s=256&d=identicon&r=PG",
      "display_name" : "Mark Rotteveel",
      "link" : "https://stackoverflow.com/users/466862/mark-rotteveel"
    },
    "creation_date" : 1755964734,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140685918,
    "post_id" : 79743762,
    "body" : "I think the 0 you are seeing is only the number of rows affected by the <code>COMMIT;</code> statement - the last statement executed by the <code>update()</code> method. This statement doesn&#39;t affect any rows but the transaction. Hence the 0 return value. But note that the usual way of handling transactions using spring is documented at <a href=\"https://docs.spring.io/spring-framework/reference/data-access/transaction.html\" rel=\"nofollow noreferrer\">docs.spring.io/spring-framework/reference/data-access/&hellip;</a>",
    "score" : 1,
    "owner" : {
      "account_id" : 1580843,
      "reputation" : 13706,
      "user_id" : 1466267,
      "user_type" : "registered",
      "accept_rate" : 91,
      "profile_image" : "https://www.gravatar.com/avatar/c47d1f7544a8c4a1bb7a41d511f53604?s=256&d=identicon&r=PG",
      "display_name" : "SpaceTrucker",
      "link" : "https://stackoverflow.com/users/1466267/spacetrucker"
    },
    "creation_date" : 1755898241,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140685650,
    "post_id" : 79743762,
    "body" : "From here <a href=\"https://www.postgresql.org/docs/current/sql-insert.html\" rel=\"nofollow noreferrer\">INSERT</a>: <i>On successful completion, an INSERT command returns a command tag of the form INSERT oid count</i>. That is not actually a result. You can get a result by using <code>RETURNING &lt;some_value&gt;</code>, then count the number of results you get. Read the link provided for more information.",
    "score" : 0,
    "owner" : {
      "account_id" : 9513375,
      "reputation" : 20363,
      "user_id" : 7070613,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/iZQNZ.jpg?s=256",
      "display_name" : "Adrian Klaver",
      "link" : "https://stackoverflow.com/users/7070613/adrian-klaver"
    },
    "creation_date" : 1755890386,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79746832" : [ {
      "comment_id" : 140735649,
      "post_id" : 79746832,
      "body" : "The JPA approach seems to handle transactions really well, but unfortunaly, this project requires that i use the traditional JDBC approach. It would have been cool if Spring offered a way to easily use transactions with theis JDBCClient (if there is a way, i havent found it lol), without needing to use the plain JDBC pattern.",
      "score" : 0,
      "owner" : {
        "account_id" : 12205819,
        "reputation" : 307,
        "user_id" : 8908951,
        "user_type" : "registered",
        "profile_image" : "https://lh6.googleusercontent.com/-rqQkreaFZWA/AAAAAAAAAAI/AAAAAAAAR3o/XXxb5Xcvugk/s256-rj/photo.jpg",
        "display_name" : "Lucca Bibar",
        "link" : "https://stackoverflow.com/users/8908951/lucca-bibar"
      },
      "creation_date" : 1757890593,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}