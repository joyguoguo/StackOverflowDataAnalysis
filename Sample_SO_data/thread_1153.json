{
  "question" : {
    "question_id" : 79737814,
    "title" : "Tomcat embed with JULI cannot separate webapp&#39;s servlet context logging from Catalina container logging",
    "body" : "<p>I'm using tomcat's JULI logger and the properties file to launch a Tomcat embed server, in which there is a single webapp named <code>myapp</code> on localhost. (working directory: <code>/Users/me/TomcatEmbedTest</code>)</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class Main {\n    public static void main(String[] args) {\n        Tomcat tomcat = new Tomcat();\n        tomcat.setBaseDir(new File(&quot;resource&quot;).getAbsolutePath());\n        tomcat.setPort(8080);\n        tomcat.getConnector();\n        tomcat.addWebapp(&quot;/myapp&quot;, new File(&quot;/Users/me/TomcatEmbedTest/resource/webapps/myapp&quot;).getAbsolutePath());\n        try {\n            tomcat.start();\n        } catch (LifecycleException e) {\n            throw new RuntimeException(e);\n        }\n    }\n}\n</code></pre>\n<p>In order to use JULI, I used the following arguments:</p>\n<pre class=\"lang-none prettyprint-override\"><code>-Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager \n-Djava.util.logging.config.file=/Users/me/TomcatEmbedTest/resource/logging.properties\n</code></pre>\n<p>In the properties file I designate <code>myapp</code>'s servlet context log to be logged using <code>3myapp.org.apache.juli.AsyncFileHandler</code>, which logs to file with prefix <code>myapp</code>:</p>\n<pre class=\"lang-none prettyprint-override\"><code>3myapp.org.apache.juli.AsyncFileHandler.prefix = myapp.\n\norg.apache.catalina.core.ContainerBase.[Catalina].[localhost].[/myapp].level = INFO\norg.apache.catalina.core.ContainerBase.[Catalina].[localhost].[/myapp].handlers = 3myapp.org.apache.juli.AsyncFileHandler\n</code></pre>\n<p>For readability, the full properties file is appended at the bottom of the question.</p>\n<p>The test servlet only executes the following line:</p>\n<pre class=\"lang-java prettyprint-override\"><code>req.getServletContext().log(&quot;========my web app's log=====&quot;);\n</code></pre>\n<p>For readability, the full servlet class is appended at the bottom of the question.</p>\n<p>As I've configured in the properties file, when the application launches, it creates 3 log files in the <code>log</code> directory inside my tomcat-embed application.</p>\n<pre class=\"lang-bash prettyprint-override\"><code>.\n├── catalina.2025-08-17.log\n├── localhost.2025-08-17.log\n└── myapp.2025-08-17.log\n</code></pre>\n<p>However, the <code>localhost</code> log and <code>myapp</code> log is just empty. And the <code>ServletContext#log</code> log in my servlet goes to <code>catalina</code> log.</p>\n<p>When I deploy the same webapp inside a stand-alone tomcat, and use the same properties file, <code>ServletContext#log</code> log goes to separate log files declared in <code>logging.properties</code> file (in this case it is <code>myapp.2025-08-17.log</code>.</p>\n<p>I wonder if this is a bug for tomcat-embed, or tomcat-embed inherently does not support separate logs for webapps' servlet context log?</p>\n<p>My single test-purpose servlet:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@WebServlet(&quot;/test&quot;)\npublic class TestServlet extends HttpServlet {\n    @Override\n    protected void doGet(HttpServletRequest req, HttpServletResponse resp)\n            throws ServletException, IOException {\n        req.getServletContext().log(&quot;========my web app's log=====&quot;);\n        resp.getWriter().write(&quot;Hello, this is /test servlet!&quot;);\n    }\n}\n</code></pre>\n<p>my properties file:</p>\n<pre class=\"lang-none prettyprint-override\"><code>handlers = java.util.logging.ConsoleHandler, 1catalina.org.apache.juli.AsyncFileHandler, 2localhost.org.apache.juli.AsyncFileHandler, 3myapp.org.apache.juli.AsyncFileHandler\n\n.handlers = 1catalina.org.apache.juli.AsyncFileHandler, java.util.logging.ConsoleHandler\n\n1catalina.org.apache.juli.AsyncFileHandler.level = FINE\n1catalina.org.apache.juli.AsyncFileHandler.directory = logs\n1catalina.org.apache.juli.AsyncFileHandler.prefix = catalina.\n1catalina.org.apache.juli.AsyncFileHandler.maxDays = 90\n1catalina.org.apache.juli.AsyncFileHandler.encoding = UTF-8\n\n2localhost.org.apache.juli.AsyncFileHandler.level = FINE\n2localhost.org.apache.juli.AsyncFileHandler.directory = logs\n2localhost.org.apache.juli.AsyncFileHandler.prefix = localhost.\n2localhost.org.apache.juli.AsyncFileHandler.maxDays = 90\n2localhost.org.apache.juli.AsyncFileHandler.encoding = UTF-8\n\n3myapp.org.apache.juli.AsyncFileHandler.level = FINE\n3myapp.org.apache.juli.AsyncFileHandler.directory = logs\n3myapp.org.apache.juli.AsyncFileHandler.prefix = myapp.\n3myapp.org.apache.juli.AsyncFileHandler.maxDays = 90\n3myapp.org.apache.juli.AsyncFileHandler.encoding = UTF-8\n\njava.util.logging.ConsoleHandler.level = FINE\njava.util.logging.ConsoleHandler.formatter = org.apache.juli.OneLineFormatter\njava.util.logging.ConsoleHandler.encoding = UTF-8\n\norg.apache.catalina.core.ContainerBase.[Catalina].level = INFO\norg.apache.catalina.core.ContainerBase.[Catalina].handlers = 1catalina.org.apache.juli.AsyncFileHandler\n\norg.apache.catalina.core.ContainerBase.[Catalina].[localhost].[/myapp].level = INFO\norg.apache.catalina.core.ContainerBase.[Catalina].[localhost].[/myapp].handlers = 3myapp.org.apache.juli.AsyncFileHandler\n\n</code></pre>\n<p>My dependencies:</p>\n<pre class=\"lang-bash prettyprint-override\"><code>.\n├── tomcat-annotations-api-9.0.108-sources.jar\n├── tomcat-annotations-api-9.0.108.jar\n├── tomcat-embed-core-9.0.108-sources.jar\n├── tomcat-embed-core-9.0.108.jar\n├── tomcat-embed-logging-juli-9.0.0.M6-sources.jar\n└── tomcat-embed-logging-juli-9.0.0.M6.jar\n\n</code></pre>\n",
    "tags" : [ "java", "tomcat" ],
    "owner" : {
      "account_id" : 17436033,
      "reputation" : 518,
      "user_id" : 12639005,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AAuE7mD9BKI5xQp34xippuV_CnsMhoCVSn_rzQJzfqiD=k-s256",
      "display_name" : "Name Null",
      "link" : "https://stackoverflow.com/users/12639005/name-null"
    },
    "is_answered" : true,
    "view_count" : 53,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1755443645,
    "creation_date" : 1755433232,
    "link" : "https://stackoverflow.com/questions/79737814/tomcat-embed-with-juli-cannot-separate-webapps-servlet-context-logging-from-cat",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79737869,
    "question_id" : 79737814,
    "body" : "<p>Since there is scarce documentation or other resources online, I debugged tomcat-embed source code myself, and I found the problem arises from inconsistent logger name creation between tomcat standalone and tomcat-embed.</p>\n<p>The logger names in tomcat's <code>logging.properties</code>  like <code>org.apache.catalina.core.ContainerBase.[Catalina].[localhost].[/myapp].level = INFO</code> are composed in <code>ContainerBase#getLogName</code> in tomcat standalone, and <code>Tomcat#getLoggerName</code> in tomcat-embed.</p>\n<p>In tomcat-embed, the correct logger name in the properties file should be <code>org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/myapp]</code>  instead of <code>org.apache.catalina.core.ContainerBase.[Catalina].[localhost].[/myapp]</code></p>\n<p>This is because, as the following code shows, <code>host.getParent()</code>  is <code>StandardEngine[Tomcat]</code> , whose name is <code>Tomcat</code> instead of <code>Catalina</code>.</p>\n<pre class=\"lang-java prettyprint-override\"><code>// Tomcat.java, getLoggerName\nprivate String getLoggerName(Host host, String contextName) {\n    if (host == null) {\n        host = getHost();\n    }\n    StringBuilder loggerName = new StringBuilder();\n    loggerName.append(ContainerBase.class.getName());\n    loggerName.append(&quot;.[&quot;);\n    // Engine name\n    loggerName.append(host.getParent().getName());\n    loggerName.append(&quot;].[&quot;);\n    // Host name\n    loggerName.append(host.getName());\n    loggerName.append(&quot;].[&quot;);\n    // Context name\n    if (contextName == null || contextName.isEmpty()) {\n        loggerName.append('/');\n    } else if (contextName.startsWith(&quot;##&quot;)) {\n        loggerName.append('/');\n        loggerName.append(contextName);\n    }\n    loggerName.append(']');\n\n    return loggerName.toString();\n}\n</code></pre>\n<p>Whereas in Tomcat standalone, the standard engine's name is <code>Catalina</code> .</p>\n<p>By changing logger names in the <code>logging.properties</code>  to cater to tomcat-embed (changing original <code>org.apache.catalina.core.ContainerBase.[Catalina].[localhost].</code>  to <code>org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].</code> , the problem resolves and logging functions correctly.</p>\n<p>So I believe this should be clarified in tomcat-embed documentation, or this is a bug that needs correction.</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 17436033,
      "reputation" : 518,
      "user_id" : 12639005,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AAuE7mD9BKI5xQp34xippuV_CnsMhoCVSn_rzQJzfqiD=k-s256",
      "display_name" : "Name Null",
      "link" : "https://stackoverflow.com/users/12639005/name-null"
    },
    "creation_date" : 1755438448,
    "last_activity_date" : 1755443645,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140671585,
    "post_id" : 79737814,
    "body" : "@andrewJames Thanks for reminding me that the version <code>9.0.0.M6</code> is too old. I just retested my question with newest tomcat-embed 11.0.10 and related dependencies. It turns out that the issue is still with <code>Tomcat</code> class itself ( which is in <code>tomcat-embed-core.jar</code>). The <code>JULI</code> logging system asks <code>Tomcat#getLoggerName </code> for a name, but the name it gives is inconsistent with tomcat standalone. See my answer for more details.",
    "score" : 0,
    "owner" : {
      "account_id" : 17436033,
      "reputation" : 518,
      "user_id" : 12639005,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AAuE7mD9BKI5xQp34xippuV_CnsMhoCVSn_rzQJzfqiD=k-s256",
      "display_name" : "Name Null",
      "link" : "https://stackoverflow.com/users/12639005/name-null"
    },
    "creation_date" : 1755443423,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140671521,
    "post_id" : 79737814,
    "body" : "Just a side note (sorry, I don&#39;t have a solution): The <code>9.0.0.M6</code> (milestone 6) version of embedded JULI logging is <a href=\"https://mvnrepository.com/artifact/org.apache.tomcat.embed/tomcat-embed-logging-juli/9.0.0.M6\" rel=\"nofollow noreferrer\">over 10 years old</a> - and there is isn&#39;t a more recent release. So, perhaps &quot;incomplete/abandoned&quot; might be one reason you have hit this problem.",
    "score" : 0,
    "owner" : {
      "account_id" : 12743722,
      "reputation" : 22621,
      "user_id" : 12567365,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/zNR3x.png?s=256",
      "display_name" : "andrewJames",
      "link" : "https://stackoverflow.com/users/12567365/andrewjames"
    },
    "creation_date" : 1755440951,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}