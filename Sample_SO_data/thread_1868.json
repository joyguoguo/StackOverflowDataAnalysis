{
  "question" : {
    "question_id" : 79668993,
    "title" : "GluonFX Native Image MIDI Issues",
    "body" : "<p>I have a JavaFX App where I use a MIDI device (Akai APC mini mk2) and I need to make a native image using GluonFX. Issue is concerning GluonFX native image and the use of MIDI.</p>\n<p><strong>Remember to read below Update 1 and 2.</strong></p>\n<p>The App is built in IntelliJ and this is MRE:</p>\n<pre><code>package org.example;\n\nimport javafx.application.Application;\nimport javafx.scene.Scene;\nimport javafx.scene.control.ListView;\nimport javafx.scene.layout.VBox;\nimport javafx.stage.Stage;\n\nimport javax.sound.midi.MidiDevice.Info;\nimport javax.sound.midi.MidiSystem;\n\npublic class FindMidiApp extends Application {\n\n    @Override\n    public void start(Stage primaryStage) {\n\n        primaryStage.setTitle(&quot;Find Midi&quot;);\n        ListView&lt;String&gt; listView = new ListView&lt;&gt;();\n        VBox vbox = new VBox(10, listView);\n\n        try {\n\n            Info[] midiInfos = MidiSystem.getMidiDeviceInfo();\n\n            for (Info info : midiInfos) {\n\n                listView.getItems().add(String.format(&quot;%s - %s&quot;, info.getName(), info.getDescription()));\n                \n            }\n\n        } catch (Exception e) {\n\n            e.printStackTrace();\n\n        }\n\n        Scene scene = new Scene(vbox, 500, 300);\n        primaryStage.setScene(scene);\n        primaryStage.show();\n\n    }\n\n    public static void main(String[] args) {\n\n        launch(args);\n\n    }\n\n}\n</code></pre>\n<p>Using maven so this is the pom:</p>\n<pre><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;groupId&gt;org.example&lt;/groupId&gt;\n    &lt;artifactId&gt;ListMidi&lt;/artifactId&gt;\n    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n    &lt;properties&gt;\n        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;\n        &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt;\n        &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt;\n    &lt;/properties&gt;\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.openjfx&lt;/groupId&gt;\n            &lt;artifactId&gt;javafx-controls&lt;/artifactId&gt;\n            &lt;version&gt;23&lt;/version&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;com.gluonhq&lt;/groupId&gt;\n                &lt;artifactId&gt;gluonfx-maven-plugin&lt;/artifactId&gt;\n                &lt;version&gt;1.0.26&lt;/version&gt;\n                &lt;configuration&gt;\n                    &lt;mainClass&gt;org.example.FindMidiApp&lt;/mainClass&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n                &lt;version&gt;3.8.0&lt;/version&gt;\n                &lt;configuration&gt;\n                    &lt;release&gt;11&lt;/release&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.openjfx&lt;/groupId&gt;\n                &lt;artifactId&gt;javafx-maven-plugin&lt;/artifactId&gt;\n                &lt;version&gt;0.0.6&lt;/version&gt;\n                &lt;configuration&gt;\n                    &lt;mainClass&gt;org.example.FindMidiApp&lt;/mainClass&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n&lt;/project&gt;\n</code></pre>\n<p>And this is the  module-info.java:</p>\n<pre><code>module org.example {\n    requires javafx.controls;\n    requires java.desktop;\n    exports org.example;\n}\n</code></pre>\n<ul>\n<li>Using Windows 11.</li>\n<li>Maven 3.9.10</li>\n<li>graalvm-java23-windows-amd64-gluon-23+25.1-dev (for building native image)</li>\n<li>JavaFX 23 (when running in IntelliJ)</li>\n<li>gluonfx-maven-plugin 1.0.26</li>\n<li>OpenJDK 23 (when running in IntelliJ)</li>\n</ul>\n<p>In IntelliJ the App works fine and it finds the APC Mini.</p>\n<p>I have read and followed this: <a href=\"https://docs.gluonhq.com/#platforms_windows\" rel=\"nofollow noreferrer\">https://docs.gluonhq.com/#platforms_windows</a> so now I want to turn the App into a native image with GluonFX so I open X64 native tool prompt and first browse to the folder with the project. Now I run (on computer a):</p>\n<p><em>mvn clean</em></p>\n<p>And then:</p>\n<p><em>mvn gluonfx:runagent</em></p>\n<p>App opens and finds APC mini.\nNow I run:</p>\n<p><em>mvn gluonfx:build</em></p>\n<p>Native image is built, and I run:</p>\n<p><em>mvn gluonfx:nativerun</em></p>\n<p>App opens and APC Mini is found and the same is going on if I open the native image directly from the folder, so far all is good.</p>\n<p><strong>This is the issue:</strong></p>\n<p>If I move the native image to another computer (computer b) and plugs the APC Mini into that computer only “Gervill – Software Midi Synthesizer” and “Real Time Sequencer – Software sequencer” are found.\nNo APC Mini is found and not “Microsoft Midi Mapper – Windows Midi_mapper” and “Microsoft GS WaveTable Synth – Internal Software synthesizer” that was found on computer a.</p>\n<p>If I copy the entire project to computer b, and runs it in IntelliJ then all the midi devices are found. All devices are also found on computer b if i run mvn glunfx:runagent but mvn gluonfx:nativerun (after gluonfx:build) only finds “Gervill – Software Midi Synthesizer” and “Real Time Sequencer – Software sequencer” and the same is happening if I run the generated native image directly from the folder.</p>\n<p>So native image works on computer a and not (when moved) on computer b. And native image generated on computer b is not working working on computer b.\nAnd! when native image generated on computer b runs on computer a then it works so all in all native image works on computer a, no matter where it is generated.</p>\n<p>I'm not sure this is related to the code or general Windows. Both computers have the same Windows version and updates. I have tested the APC Mini with a third party app, <a href=\"https://hautetechnique.com/midi/midiview/\" rel=\"nofollow noreferrer\">https://hautetechnique.com/midi/midiview/</a>, and it finds the APC Mini on both computers.</p>\n<p><strong>Update 1:</strong></p>\n<p>When running below simple java from cmd in windows all devices are found on computer b (and computer a):</p>\n<pre><code>import javax.sound.midi.MidiDevice;\nimport javax.sound.midi.MidiSystem;\n\npublic class Main {\n    public static void main(String[] args) {\n        \n        MidiDevice.Info[] midiInfos = MidiSystem.getMidiDeviceInfo();\n        for (MidiDevice.Info info : midiInfos) {\n            System.out.println(info.getName() + &quot; &quot; + info.getDescription());\n        }\n    }\n}\n</code></pre>\n<p><strong>Update 2:</strong></p>\n<p>Okay, this is interesting:\nI found that having C:\\yy\\xx.jdks\\openjdk-24\\bin defined in the environment variable PATH on computer B allows the app to find all devices on computer B, even when using the native image generated on computer A.</p>\n<p>So, the short answer is: The native image doesn't find any devices on computer B because Java is not defined in the PATH.</p>\n<p>Is that how it is supposed to be?</p>\n",
    "tags" : [ "java", "javafx", "midi", "graalvm-native-image", "gluonfx" ],
    "owner" : {
      "account_id" : 8022892,
      "reputation" : 184,
      "user_id" : 6050980,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/5ac27bb4f07c147810844d92bfe31bd7?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "droid",
      "link" : "https://stackoverflow.com/users/6050980/droid"
    },
    "is_answered" : true,
    "view_count" : 167,
    "answer_count" : 1,
    "score" : 3,
    "last_activity_date" : 1750181326,
    "creation_date" : 1750160659,
    "link" : "https://stackoverflow.com/questions/79668993/gluonfx-native-image-midi-issues",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79669530,
    "question_id" : 79668993,
    "body" : "<p>This fixed it for me:</p>\n<p>I fixed the issue by placing jsound.dll in the same folder as the generated native image. I distribute the native image with Inno Setup so Inno Setup is doing the job distributing the .dll in to same folder as the .exe</p>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 8022892,
      "reputation" : 184,
      "user_id" : 6050980,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/5ac27bb4f07c147810844d92bfe31bd7?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "droid",
      "link" : "https://stackoverflow.com/users/6050980/droid"
    },
    "creation_date" : 1750181326,
    "last_activity_date" : 1750181326,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140520295,
    "post_id" : 79668993,
    "body" : "A single, short .java file run from cmd in Windows finds all devices, including the APC Mini, on computer B. I will update the Q with that info.",
    "score" : 1,
    "owner" : {
      "account_id" : 8022892,
      "reputation" : 184,
      "user_id" : 6050980,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/5ac27bb4f07c147810844d92bfe31bd7?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "droid",
      "link" : "https://stackoverflow.com/users/6050980/droid"
    },
    "creation_date" : 1750162949,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140520246,
    "post_id" : 79668993,
    "body" : "I suspect making an application image has nothing to do with this.  Try writing a very simple program, consisting of a single, short .java file, that prints each element returned by <code>MidiSystem.getMidiDeviceInfo()</code>, and run that on computer B.",
    "score" : 0,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44936,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1750161918,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}