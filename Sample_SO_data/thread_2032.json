{
  "question" : {
    "question_id" : 79653623,
    "title" : "Java 21 JMX: InvalidClassException when passing Instant as a parameter",
    "body" : "<p>I'm using Java 21 and invoking remote JMX methods.</p>\n<p>Calling a remote JMX method that returns a <code>java.time.Instant</code> works fine.\nHowever, when I try to invoke a method that takes an <code>java.time.Instant</code> as a parameter, I get the following exception:</p>\n<pre><code>Exception in thread &quot;main&quot; java.io.InvalidClassException: filter status: REJECTED\n        at java.base/java.io.ObjectInputStream.filterCheck(ObjectInputStream.java:1439)\n        at java.base/java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:2071)\n        at java.base/java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1927)\n        at java.base/java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2252)\n        at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1762)\n        at java.base/java.io.ObjectInputStream.readArray(ObjectInputStream.java:2186)\n        at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1750)\n        at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:540)\n        at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:498)\n        at java.rmi/java.rmi.MarshalledObject.get(MarshalledObject.java:183)\n        at java.management.rmi/javax.management.remote.rmi.RMIConnectionImpl.unwrap(RMIConnectionImpl.java:1590)\n        at java.management.rmi/javax.management.remote.rmi.RMIConnectionImpl.unwrap(RMIConnectionImpl.java:1632)\n        at java.management.rmi/javax.management.remote.rmi.RMIConnectionImpl.invoke(RMIConnectionImpl.java:812)\n        at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)\n        at java.base/java.lang.reflect.Method.invoke(Method.java:580)\n        at java.rmi/sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:360)\n        at java.rmi/sun.rmi.transport.Transport$1.run(Transport.java:200)\n        at java.rmi/sun.rmi.transport.Transport$1.run(Transport.java:197)\n        at java.base/java.security.AccessController.doPrivileged(AccessController.java:714)\n        at java.rmi/sun.rmi.transport.Transport.serviceCall(Transport.java:196)\n        at java.rmi/sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:598)\n        at java.rmi/sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:844)\n        at java.rmi/sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.lambda$run$0(TCPTransport.java:721)\n        at java.base/java.security.AccessController.doPrivileged(AccessController.java:400)\n        at java.rmi/sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:720)\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n        at java.base/java.lang.Thread.run(Thread.java:1583)\n        at java.rmi/sun.rmi.transport.StreamRemoteCall.exceptionReceivedFromServer(StreamRemoteCall.java:304)\n        at java.rmi/sun.rmi.transport.StreamRemoteCall.executeCall(StreamRemoteCall.java:280)\n        at java.rmi/sun.rmi.server.UnicastRef.invoke(UnicastRef.java:166)\n        at jdk.remoteref/jdk.jmx.remote.internal.rmi.PRef.invoke(Unknown Source)\n        at java.management.rmi/javax.management.remote.rmi.RMIConnectionImpl_Stub.invoke(RMIConnectionImpl_Stub.java:419)\n        at java.management.rmi/javax.management.remote.rmi.RMIConnector$RemoteMBeanServerConnection.invoke(RMIConnector.java:1020)\n\n</code></pre>\n<p>Both the client and the server are running the same JDK - jdk-21.0.7.</p>\n<p>I tried launching both JVMs with <code>-Djdk.serialFilter=*</code> but it made no difference.</p>\n<p>server:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class JMXServer {\n    public interface JMXScriptMBean {\n        Instant oper1();\n        void oper2(Instant inst);\n    }\n    static class JMXScript implements JMXScriptMBean {\n        @Override\n        public Instant oper1() {\n            return Instant.now(); \n        }\n        @Override\n        public void oper2(Instant inst) {\n        }\n    }\n    public static void main(String[] args) throws Exception {\n        // Create and register the MBean\n        javax.management.MBeanServer mbs = java.lang.management.ManagementFactory.getPlatformMBeanServer();\n        JMXScriptMBean scriptBean = new JMXScript();\n        javax.management.ObjectName name = new javax.management.ObjectName(&quot;MDPubBeans:name=functionEnricher&quot;);\n        mbs.registerMBean(scriptBean, name);\n\n        System.out.println(&quot;JMXServer is running. Press Enter to exit...&quot;);\n        System.in.read();\n    }\n}\n</code></pre>\n<p>client:</p>\n<pre class=\"lang-java prettyprint-override\"><code>  public static void main(String[] args) throws Exception\n  {\n      JMXServiceURL url = new JMXServiceURL(&quot;service:jmx:rmi:///jndi/rmi://localhost:9999/jmxrmi&quot;);\n      JMXConnector jmxc = JMXConnectorFactory.connect(url);\n      MBeanServerConnection mbsc = jmxc.getMBeanServerConnection();\n      ObjectName on = new ObjectName(&quot;MDPubBeans:name=functionEnricher&quot;);\n      Object output = mbsc.invoke(on, &quot;oper1&quot;, new Object[0], new String[0]);\n      System.out.println(output);\n      output = mbsc.invoke(on, &quot;oper2&quot;, new Object[]{Instant.now()}, new String[]{Instant.class.getName()});\n      System.out.println(output);\n  }\n</code></pre>\n<p>Is there a way to allow <code>java.time.Instant</code> as a parameter for remote JMX calls in Java 21?\nAny workaround or additional configuration needed?</p>\n",
    "tags" : [ "java", "jmx" ],
    "owner" : {
      "account_id" : 14156033,
      "reputation" : 326,
      "user_id" : 10226743,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-C2XxSClTEZ4/AAAAAAAAAAI/AAAAAAAATdA/-0PKgvaBrIc/s256-rj/photo.jpg",
      "display_name" : "hmad",
      "link" : "https://stackoverflow.com/users/10226743/hmad"
    },
    "is_answered" : true,
    "view_count" : 118,
    "answer_count" : 1,
    "score" : 2,
    "last_activity_date" : 1749298265,
    "creation_date" : 1749079755,
    "link" : "https://stackoverflow.com/questions/79653623/java-21-jmx-invalidclassexception-when-passing-instant-as-a-parameter",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79656920,
    "question_id" : 79653623,
    "body" : "<p>JMX (open MBean) supports only a limited set of <a href=\"https://docs.oracle.com/cd/E19698-01/816-7609/6mdjrf844/index.html\" rel=\"nofollow noreferrer\">basic data types</a>, and unfortunately, <code>Instant</code> is not one of them. Looks like internally, the JMX serializer enforces this restriction using a hardcoded serialization filter, which blocks unsupported types like <code>Instant</code>.</p>\n<p>Proper way to pass <code>Instant</code> is to wrap it in a <a href=\"https://docs.oracle.com/cd/E19698-01/816-7609/openmbean-4/index.html\" rel=\"nofollow noreferrer\">CompositeData</a>. Interestingly, <code>Instant</code> did seem to work when returned directly as an operator return value. I'm not entirely sure why that is.</p>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 14156033,
      "reputation" : 326,
      "user_id" : 10226743,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-C2XxSClTEZ4/AAAAAAAAAAI/AAAAAAAATdA/-0PKgvaBrIc/s256-rj/photo.jpg",
      "display_name" : "hmad",
      "link" : "https://stackoverflow.com/users/10226743/hmad"
    },
    "creation_date" : 1749298265,
    "last_activity_date" : 1749298265,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}