{
  "question" : {
    "question_id" : 79587903,
    "title" : "Spring @ConfigurationProperties works wierd, maybe incorrect",
    "body" : "<p>Was working on configuration classes and spotted strange behavior. Prepared small test to reproduce it:</p>\n<pre><code>@Slf4j\n@Configuration\n@ExtendWith(SpringExtension.class)\n@ContextConfiguration(classes = TestInjectingProperties.class)\n@TestPropertySource(&quot;classpath:test.yml&quot;)\npublic class TestInjectingProperties\n{\n\n    @Getter\n    @Setter\n    @ToString\n    @Configuration\n    @ConditionalOnProperty(&quot;a.b&quot;)\n    @ConfigurationProperties(&quot;a.b&quot;)\n    public class AbOptionalProperties\n    {\n\n        private String id;\n\n    }\n\n    @Getter\n    @Setter\n    @ToString\n    @Configuration\n    @ConditionalOnProperty(&quot;c.d&quot;)\n    @ConfigurationProperties(&quot;c.d&quot;)\n    public class CdOptionalProperties\n    {\n\n        private String id;\n\n    }\n\n    @Getter\n    @Setter\n    @ToString\n    @Configuration\n    @ConditionalOnProperty(&quot;e.f&quot;)\n    @ConfigurationProperties(&quot;e.f&quot;)\n    public class EfOptionalProperties\n    {\n\n        private String g;\n        private String h;\n\n    }\n\n    @Getter\n    @Setter\n    @ToString\n    @Configuration\n    @ConditionalOnProperty(&quot;e.f&quot;)\n    @ConfigurationProperties(&quot;e.f&quot;)\n    public class EfgOptionalProperties\n    {\n\n        private String g;\n        private String h;\n\n    }\n\n    @Autowired(required = false)\n    private AbOptionalProperties abOptionalProperties;\n\n    @Autowired(required = false)\n    private CdOptionalProperties cdOptionalProperties;\n\n    @Autowired(required = false)\n    private CdOptionalProperties efOptionalProperties;\n\n    @Autowired(required = false)\n    private EfgOptionalProperties efgOptionalProperties;\n\n    @Test\n    void testProperties()\n    {\n        log.info(&quot;ab optional properties = {}&quot;, abOptionalProperties);\n        log.info(&quot;cd optional properties = {}&quot;, cdOptionalProperties);\n        log.info(&quot;ef optional properties = {}&quot;, efOptionalProperties);\n        log.info(&quot;efg optional properties = {}&quot;, efgOptionalProperties);\n    }\n\n}\n</code></pre>\n<p>Test yml file content:</p>\n<pre><code>a.b:\n\nc.d: null\n\ne.f.g: abc\n</code></pre>\n<p>Output is :</p>\n<pre><code>ab optional properties = TestInjectingProperties.AbOptionalProperties(id=null)\ncd optional properties = TestInjectingProperties.CdOptionalProperties(id=null)\nef optional properties = TestInjectingProperties.CdOptionalProperties(id=null)\nefg optional properties = null\n</code></pre>\n<p>As you can see conditional on property is able to find yml nodes which do not have any child nodes declared (like: 'a.b' or 'c.d') but it fails to do that for 'e.f' cause it have children in it.</p>\n",
    "tags" : [ "java", "spring", "testing", "dependency-injection", "properties" ],
    "owner" : {
      "account_id" : 6714937,
      "reputation" : 11,
      "user_id" : 5177046,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-JXE2oVKwLCc/AAAAAAAAAAI/AAAAAAAAAAw/YZNdCwFNUTs/s256-rj/photo.jpg",
      "display_name" : "0xff",
      "link" : "https://stackoverflow.com/users/5177046/0xff"
    },
    "is_answered" : false,
    "view_count" : 57,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1745544407,
    "creation_date" : 1745386361,
    "link" : "https://stackoverflow.com/questions/79587903/spring-configurationproperties-works-wierd-maybe-incorrect",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140361526,
    "post_id" : 79587903,
    "body" : "Sorted out this: changed test annotations to: ` @Slf4j @Configuration @ExtendWith(SpringExtension.class) @ContextConfiguration(classes = TestInjectingProperties.class) @TestPropertySource(&quot;classpath:test.yml&quot;) `  note: it make no sense of using SpringBootTest which brings up full context slowing up tests",
    "score" : 0,
    "owner" : {
      "account_id" : 6714937,
      "reputation" : 11,
      "user_id" : 5177046,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-JXE2oVKwLCc/AAAAAAAAAAI/AAAAAAAAAAw/YZNdCwFNUTs/s256-rj/photo.jpg",
      "display_name" : "0xff",
      "link" : "https://stackoverflow.com/users/5177046/0xff"
    },
    "creation_date" : 1745414223,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140361326,
    "post_id" : 79587903,
    "body" : "Tried both, results are pretty same",
    "score" : 0,
    "owner" : {
      "account_id" : 6714937,
      "reputation" : 11,
      "user_id" : 5177046,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-JXE2oVKwLCc/AAAAAAAAAAI/AAAAAAAAAAw/YZNdCwFNUTs/s256-rj/photo.jpg",
      "display_name" : "0xff",
      "link" : "https://stackoverflow.com/users/5177046/0xff"
    },
    "creation_date" : 1745411073,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140360530,
    "post_id" : 79587903,
    "body" : "If you dont want to use the <code>@SpringBootTest</code>, you have to add at at least the <code>@EnableConfigurationProperties</code>, and also to pull properties from  the yaml, you need to do <a href=\"https://www.baeldung.com/spring-yaml-propertysource\" rel=\"nofollow noreferrer\">this</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 18586978,
      "reputation" : 3850,
      "user_id" : 15000097,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/yFl4M.jpg?s=256",
      "display_name" : "Georgii Lvov",
      "link" : "https://stackoverflow.com/users/15000097/georgii-lvov"
    },
    "creation_date" : 1745395145,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140360197,
    "post_id" : 79587903,
    "body" : "You are testing a spring boot feature without using spring boot features. <code>@TestPropertySource</code> doesn&#39;t do anything iwth <code>@ConfigurationProperties</code>. You would need a full blown <code>@SpringBootTest</code> with proper loading through Spring Boot of the properties.",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126800,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1745388797,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}