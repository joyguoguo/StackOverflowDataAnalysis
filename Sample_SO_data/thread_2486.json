{
  "question" : {
    "question_id" : 79617552,
    "title" : "onnxruntime with java and spring boot cannot load onnxruntime.dll",
    "body" : "<p>I need to use the onnxruntime with Java and spring boot to work with mkask detection model. but I have the below exception when calling <code>OrtEnvironment env = OrtEnvironment.getEnvironment()</code></p>\n<p>I tried to add <code>-Djava.library.path=&quot;C:\\Users\\rnassar\\onnxruntime.dll&quot;</code> to load the onnxruntime.dll with no hope.</p>\n<pre><code>java.lang.UnsatisfiedLinkError: C:\\Users\\rnassar\\AppData\\Local\\Temp\\onnxruntime-java10600223397968714237\\onnxruntime.dll: A dynamic link library (DLL) initialization routine failed\n    at java.base/jdk.internal.loader.NativeLibraries.load(Native Method) ~[na:na]\n    at java.base/jdk.internal.loader.NativeLibraries$NativeLibraryImpl.open(NativeLibraries.java:331) ~[na:na]\n    at java.base/jdk.internal.loader.NativeLibraries.loadLibrary(NativeLibraries.java:197) ~[na:na]\n    at java.base/jdk.internal.loader.NativeLibraries.loadLibrary(NativeLibraries.java:139) ~[na:na]\n    at java.base/java.lang.ClassLoader.loadLibrary(ClassLoader.java:2418) ~[na:na]\n    at java.base/java.lang.Runtime.load0(Runtime.java:852) ~[na:na]\n    at java.base/java.lang.System.load(System.java:2025) ~[na:na]\n    at ai.onnxruntime.OnnxRuntime.load(OnnxRuntime.java:387) ~[onnxruntime-1.22.0.jar:1.22.0]\n    at ai.onnxruntime.OnnxRuntime.init(OnnxRuntime.java:166) ~[onnxruntime-1.22.0.jar:1.22.0]\n    at ai.onnxruntime.OrtEnvironment.&lt;clinit&gt;(OrtEnvironment.java:34) ~[onnxruntime-1.22.0.jar:1.22.0]\n    at org.mask.onnxface.MaskDetectionService.detectMask(MaskDetectionService.java:28) ~[classes/:na]\n    at org.mask.onnxface.MaskDetectionController.detectMask(MaskDetectionController.java:25) ~[classes/:na]\n    at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]\n    at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]\n    at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.6.jar:6.2.6]\n    at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.6.jar:6.2.6]\n    at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.6.jar:6.2.6]\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:986) ~[spring-webmvc-6.2.6.jar:6.2.6]\n</code></pre>\n",
    "tags" : [ "java", "spring-boot", "intellij-idea", "onnxruntime" ],
    "owner" : {
      "account_id" : 5751861,
      "reputation" : 445,
      "user_id" : 4541271,
      "user_type" : "registered",
      "profile_image" : "https://graph.facebook.com/10155152560505497/picture?type=large",
      "display_name" : "Rami Nassar",
      "link" : "https://stackoverflow.com/users/4541271/rami-nassar"
    },
    "is_answered" : true,
    "view_count" : 427,
    "answer_count" : 3,
    "score" : 2,
    "last_activity_date" : 1755001580,
    "creation_date" : 1747042021,
    "link" : "https://stackoverflow.com/questions/79617552/onnxruntime-with-java-and-spring-boot-cannot-load-onnxruntime-dll",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79638664,
    "question_id" : 79617552,
    "body" : "<p>I'm not sure about my solution, but in my environment very important jdk version. I mean not all jdk version works with onnxruntime. In my environment: windows 11 and onnx 1.22, 1.21, 1.20 corectly works with jdk 17 and high (Only). If I try using jdk less 17 then pop up message like yours.  If i want use jdk 11 I have to use onnxruntime  1.19.2 and less.   For  Ubuntu  not  checked.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 32085903,
      "reputation" : 11,
      "user_id" : 24888034,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e8dd282cb1525aa06685429054e3f193?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "gorbunkov2023",
      "link" : "https://stackoverflow.com/users/24888034/gorbunkov2023"
    },
    "creation_date" : 1748251980,
    "last_activity_date" : 1748252172,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79667249,
    "question_id" : 79617552,
    "body" : "<p>For my setup (Java 23 and 24), ONNX runtime version &gt;= 1.21 are throwing the same error.</p>\n<p>This is due to an incompatibility in VC runtime versions betweek the OpenJDK (on which most JREs are based) and the one needed by the ONNX runtime version (see <a href=\"https://github.com/microsoft/onnxruntime/discussions/23971#discussioncomment-12457124\" rel=\"nofollow noreferrer\">comment</a> on <a href=\"https://github.com/microsoft/onnxruntime/discussions/23971\" rel=\"nofollow noreferrer\">discussion</a>).</p>\n<p>ONNX runtime v1.20.0 is working fine.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1107482,
      "reputation" : 3146,
      "user_id" : 1098603,
      "user_type" : "registered",
      "accept_rate" : 94,
      "profile_image" : "https://i.sstatic.net/sb0id.png?s=256",
      "display_name" : "Matthieu",
      "link" : "https://stackoverflow.com/users/1098603/matthieu"
    },
    "creation_date" : 1750061312,
    "last_activity_date" : 1750061312,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79733177,
    "question_id" : 79617552,
    "body" : "<p>I had the same issue with OpenJDK, Windows and ONNX (multiple versions), and the reason was that the Microsoft Visual Studio Runtime shipped with the official OpenJDK build was too old.</p>\n<p>I switched from the official OpenJDK build to the Microsoft OpenJDK 21.0.8 build and it works like a charm:</p>\n<p><a href=\"https://learn.microsoft.com/en-us/java/openjdk/download\" rel=\"nofollow noreferrer\">https://learn.microsoft.com/en-us/java/openjdk/download</a></p>\n<p><a href=\"https://aka.ms/download-jdk/microsoft-jdk-21.0.8-windows-x64.zip\" rel=\"nofollow noreferrer\">https://aka.ms/download-jdk/microsoft-jdk-21.0.8-windows-x64.zip</a></p>\n<p>(probably Microsoft uses a more current toolchain for their builds)</p>\n<p>The complete working config is ONNX 1.22.0, Microsoft Visual Studio Redistributable v14.44.35211.0, CUDA 12.9.1, CuDNN 9.12.0</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 273623,
      "reputation" : 1482,
      "user_id" : 565341,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3079ae823efcf926254bd1c614682f19?s=256&d=identicon&r=PG",
      "display_name" : "Christoph Henkelmann",
      "link" : "https://stackoverflow.com/users/565341/christoph-henkelmann"
    },
    "creation_date" : 1755001580,
    "last_activity_date" : 1755001580,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140516592,
    "post_id" : 79617552,
    "body" : "Side note: the <code>java.library.path</code> should define <i>paths</i> and not files; so <code>-Djava.library.path=&quot;C:\\Users\\rnassar&quot;</code> (without the .dll file).",
    "score" : 0,
    "owner" : {
      "account_id" : 1107482,
      "reputation" : 3146,
      "user_id" : 1098603,
      "user_type" : "registered",
      "accept_rate" : 94,
      "profile_image" : "https://i.sstatic.net/sb0id.png?s=256",
      "display_name" : "Matthieu",
      "link" : "https://stackoverflow.com/users/1098603/matthieu"
    },
    "creation_date" : 1750064457,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}