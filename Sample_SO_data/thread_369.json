{
  "question" : {
    "question_id" : 79811820,
    "title" : "Why can&#39;t I return type byte in lambda expression in Arrays.setAll",
    "body" : "<p>I'm trying to implement a lambda function (for educational purposes) to initiate an array to append to the front of potentially encrypted data to save information like salt and initiation vector, which uses an if-elseif conditional to set its first byte to its own length (so you know where the buffer ends and data starts), and then to add the salt and initiation vector.\nProblem is I keep getting these errors:</p>\n<blockquote>\n<p>The method setAll(T[], IntFunction&lt;? extends T&gt;) in the type Arrays is\nnot applicable for the arguments (byte[]::buffer, ( i) -&gt; {})</p>\n<p>The target type of this expression must be a functional interface</p>\n<p>Type mismatch: cannot convert from byte to T</p>\n</blockquote>\n<p>From what I understand, this is because it doesn't like me using bytes. Why is this, and what are some ways to work around this?</p>\n<p>The byte[] casting before buffer in the setAll parameter is added because I tried to make it not be T[] in an attempt to have it accept bytes.</p>\n<pre><code>public final class App {\n   public static void main(final String[] args) {\n        byte[] salt = new byte[16];\n        SecureRandom secRand = new SecureRandom();\n        secRand.nextBytes(salt);\n        byte[] initVectorBytes = new byte[16];\n        secRand.nextBytes(initVectorBytes);\n        byte[] buffer = new byte[salt.length + initVectorBytes.length + 1];\n        Arrays.setAll(byte[] buffer, i -&gt; {\n            if(i ==0) {\n                return (byte) (salt.length + initVectorBytes.length + 1)\n            }else if(i &lt; 17) {\n                return salt[i-1];\n            }else if(i &gt;= 17) {\n                return initVectorBytes[i-17];\n            }\n        });\n   }\n}\n</code></pre>\n",
    "tags" : [ "java", "arrays", "lambda", "byte" ],
    "owner" : {
      "account_id" : 37604239,
      "reputation" : 105,
      "user_id" : 28332552,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5a84dbd7a917124e895a66d1b7b38d61?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Lucy",
      "link" : "https://stackoverflow.com/users/28332552/lucy"
    },
    "is_answered" : true,
    "view_count" : 145,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1762471298,
    "creation_date" : 1762467412,
    "link" : "https://stackoverflow.com/questions/79811820/why-cant-i-return-type-byte-in-lambda-expression-in-arrays-setall",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79811851,
    "question_id" : 79811820,
    "body" : "<blockquote>\n<p>From what I understand, this is because it doesn't like me using bytes. Why is this, and what are some ways to work around this?</p>\n</blockquote>\n<p>It doesn't like you using bytes because arrays of different element types are not compatible, and none of the overloads of <code>Arrays.setAll()</code> accepts an array argument of type <code>byte[]</code>. That includes the generic one, because type parameters can match only reference types, whereas <code>byte</code> is a primitive type.</p>\n<p>In your particular case, the best workaround is probably to stop trying to be so clever.  It would be clearer, shorter, and almost surely faster to do this, instead:</p>\n<pre><code>    final static int SALT_LENGTH = 16;\n    final static int INIT_VECTOR_LENGTH = 16;\n\n    // ...\n\n        SecureRandom secRand = new SecureRandom();\n        byte[] buffer = new byte[1 + SALT_LENGTH + INIT_VECTOR_LENGTH];\n        secRand.nextBytes(buffer);\n        buffer[0] = buffer.length;\n</code></pre>\n<p>Even if there were a <code>setAll()</code> that worked on <code>byte</code> arrays, it wouldn't offer an advantage over that.</p>\n<p>Note also that if this were for use in a method that might be invoked more than once then it it would be better to have a single <code>SecureRandom</code> that you reuse, instead of setting up a new one every time the method is invoked.</p>\n<p>Furthermore, if you wanted to generate random bytes for only a small portion of a large array, such that it didn't make sense to start by filling the whole array, then <code>System.arraycopy()</code> is a much better way to copy a range of elements from from one array into another than <code>Arrays.setAll()</code>.</p>\n",
    "score" : 8,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1762470830,
    "last_activity_date" : 1762471298,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140841218,
    "post_id" : 79811820,
    "body" : "As an aside, the syntax for a cast has round brackets: <code>(byte[]) buffer</code>, In your case you are casting from one type to itself, though. so it will never make any difference.",
    "score" : 3,
    "owner" : {
      "account_id" : 7612423,
      "reputation" : 87400,
      "user_id" : 5772882,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/8283c64511fa80afed5259d10850168f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Anonymous",
      "link" : "https://stackoverflow.com/users/5772882/anonymous"
    },
    "creation_date" : 1762496582,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140840877,
    "post_id" : 79811820,
    "body" : "<code>Arrays.setAll()</code> comes in four overloaded versions for arrays of <code>int</code>, <code>long</code>, <code>double</code> and references (the last one generic). There is no <code>setAll()</code> for arrays of <code>byte</code>.",
    "score" : 4,
    "owner" : {
      "account_id" : 7612423,
      "reputation" : 87400,
      "user_id" : 5772882,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/8283c64511fa80afed5259d10850168f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Anonymous",
      "link" : "https://stackoverflow.com/users/5772882/anonymous"
    },
    "creation_date" : 1762467838,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79811851" : [ {
      "comment_id" : 140841880,
      "post_id" : 79811851,
      "body" : "@Lucy There is no reason to think that a combination of two distinct <code>SecureRandom</code>s will generate sequences that are observably more uniform or less self-correlated than one will do alone.  The idea of &quot;generating entropy&quot; is a little fraught, though -- a <code>SecureRandom</code> whose output is truly non-deterministic, as the specs say it must be, is better viewed as <i>transforming</i> or even <i>consuming</i> entropy to do so.",
      "score" : 3,
      "owner" : {
        "account_id" : 2792262,
        "reputation" : 190832,
        "user_id" : 2402272,
        "user_type" : "registered",
        "accept_rate" : 85,
        "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
        "display_name" : "John Bollinger",
        "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
      },
      "creation_date" : 1762521889,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140841682,
      "post_id" : 79811851,
      "body" : "From what I&#39;ve read, it generates more entropy set up a new SecureRandom each time, is this not true?",
      "score" : 0,
      "owner" : {
        "account_id" : 37604239,
        "reputation" : 105,
        "user_id" : 28332552,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/5a84dbd7a917124e895a66d1b7b38d61?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Lucy",
        "link" : "https://stackoverflow.com/users/28332552/lucy"
      },
      "creation_date" : 1762514285,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}