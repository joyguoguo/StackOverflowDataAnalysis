{
  "question" : {
    "question_id" : 79540124,
    "title" : "Spotbugs + Java: EI_EXPOSE_REP2 may expose internal representation by storing an externally mutable object into MyService.observationRegistry",
    "body" : "<p>Small question regarding a Spotbugs finding I am having a hard time fixing.</p>\n<p>In this super simple class:</p>\n<pre><code>import io.micrometer.observation.ObservationRegistry;\n\n@Service\npublic final class MyService {\n\n  private final ObservationRegistry observationRegistry;\n\n  public MyService(final ObservationRegistry registry) {\n     this.observationRegistry = registry;\n    }\n\n</code></pre>\n<p>I am getting flagged on the observationRegistry with</p>\n<blockquote>\n<p><em>may expose internal representation by storing an externally mutable object into MyService.observationRegistry</em></p>\n</blockquote>\n<p>I tried invoking a possible <code>clone()</code> method on the registry, but no luck.</p>\n<p>How do I fix this?</p>\n",
    "tags" : [ "java", "findbugs", "micrometer", "spring-micrometer", "spotbugs" ],
    "owner" : {
      "account_id" : 14482834,
      "reputation" : 5468,
      "user_id" : 10461625,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/fgo5D.jpg?s=256",
      "display_name" : "PatPanda",
      "link" : "https://stackoverflow.com/users/10461625/patpanda"
    },
    "is_answered" : true,
    "view_count" : 145,
    "closed_date" : 1761991567,
    "answer_count" : 1,
    "score" : -1,
    "last_activity_date" : 1761895146,
    "creation_date" : 1743113054,
    "link" : "https://stackoverflow.com/questions/79540124/spotbugs-java-ei-expose-rep2-may-expose-internal-representation-by-storing-an",
    "closed_reason" : "Needs details or clarity"
  },
  "answers" : [ {
    "answer_id" : 79547455,
    "question_id" : 79540124,
    "body" : "<p>Did you read the whole description?</p>\n<p><a href=\"https://spotbugs.readthedocs.io/en/latest/bugDescriptions.html#ei2-may-expose-internal-representation-by-incorporating-reference-to-mutable-object-ei-expose-rep2\" rel=\"nofollow noreferrer\">https://spotbugs.readthedocs.io/en/latest/bugDescriptions.html#ei2-may-expose-internal-representation-by-incorporating-reference-to-mutable-object-ei-expose-rep2</a></p>\n<blockquote>\n<p>EI2: May expose internal representation by incorporating reference to mutable object (EI_EXPOSE_REP2)\nThis code stores a reference to an externally mutable object into the internal representation of the object.  If instances are accessed by untrusted code, and unchecked changes to the mutable object would compromise security or other important properties, you will need to do something different. Storing a copy of the object is better approach in many situations.</p>\n</blockquote>\n<p>The whole point here is making internal data available externally, I'm not sure this is valid here since &quot;untrusted code&quot; might be able to just &quot;attack&quot; your registered handlers or read their outputs. Also, I might misunderstand this but if your instances can be accessed by &quot;untrusted code&quot;, I'm not sure this will save you from anything. I guess the solution here is rather not adding sensitive data to your <code>Observation</code>s (and suppress the warning).</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 944144,
      "reputation" : 7381,
      "user_id" : 971735,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/04b971677fdfecde181c1d086a0158a7?s=256&d=identicon&r=PG",
      "display_name" : "Jonatan Ivanov",
      "link" : "https://stackoverflow.com/users/971735/jonatan-ivanov"
    },
    "creation_date" : 1743465603,
    "last_activity_date" : 1761895146,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79547455" : [ {
      "comment_id" : 140284968,
      "post_id" : 79547455,
      "body" : "Make sence @Jonatan Ivanov . Upvoted. Thanks for the clear writing",
      "score" : 0,
      "owner" : {
        "account_id" : 14482834,
        "reputation" : 5468,
        "user_id" : 10461625,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/fgo5D.jpg?s=256",
        "display_name" : "PatPanda",
        "link" : "https://stackoverflow.com/users/10461625/patpanda"
      },
      "creation_date" : 1743473490,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}