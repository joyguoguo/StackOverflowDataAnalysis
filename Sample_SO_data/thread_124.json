{
  "question" : {
    "question_id" : 79833859,
    "title" : "Mapping an entity with an embedded key",
    "body" : "<p>There is a class with an <code>EmbeddedId</code>.</p>\n<pre><code>@Entity\n@Getter\n@Setter\n@Table(name = &quot;indicator_values&quot;)\npublic class IndicatorValue {\n\n    @EmbeddedId\n    public IndicatorValueId id;\n\n    @Column(name = &quot;value&quot;)\n    public BigDecimal value;\n\n    public IndicatorValue() {}\n\n    public IndicatorValue(\n        IndicatorValueId id,\n        BigDecimal value\n    ) {\n        this.id = id;\n        this.value = value;\n    }\n\n    // Constructor used for experimentation (invoked in the repository)\n    public IndicatorValue(\n        String categoryCode,\n        String indicatorCode,\n        BigDecimal value,\n        LocalDate effectiveDate\n    ) {\n        this.value = value;\n        this.id = new IndicatorValueId(categoryCode, indicatorCode, effectiveDate);\n    }\n\n}\n</code></pre>\n<p>Alongside it, there is an <code>@Embeddable</code> class that defines this ID.</p>\n<pre><code>@Embeddable\n@AllArgsConstructor\n@NoArgsConstructor\n@EqualsAndHashCode\n@Getter\n@Setter\npublic class IndicatorValueId implements Serializable {\n    @Column(name = &quot;category_code&quot;)\n    private String categoryCode;\n    @Column(name = &quot;indicator_code&quot;)\n    private String indicatorCode;\n    @Column(name = &quot;effective_date&quot;)\n    private LocalDate effectiveDate;\n}\n</code></pre>\n<p>And there is a repository (I’ve tried different methods to verify the result—this is not the complete list).</p>\n<pre><code>public interface IndicatorValueRepository extends JpaRepository&lt;IndicatorValue, IndicatorValueId&gt; {\n\n    @Query(&quot;&quot;&quot;\n    SELECT iv\n    FROM IndicatorValue iv\n    WHERE iv.id.indicatorCode = :indicatorCode\n      AND iv.id.effectiveDate &lt; :effectiveDate\n    ORDER BY iv.id.effectiveDate DESC\n    &quot;&quot;&quot;)\n    List&lt;IndicatorValue&gt; findByIndicatorCodeBeforeDate(\n            @Param(&quot;indicatorCode&quot;) String indicatorCode,\n            @Param(&quot;effectiveDate&quot;) LocalDate effectiveDate\n    );\n\n    @Query(&quot;&quot;&quot;\n    SELECT NEW by.vezhlivec.normsservice.entity.IndicatorValue(\n      iv.id.categoryCode,\n      iv.id.indicatorCode,\n      iv.value,\n      iv.id.effectiveDate\n      )\n    FROM IndicatorValue iv\n    WHERE iv.id.indicatorCode = :indicatorCode\n      AND iv.id.categoryCode IS NULL\n      AND iv.id.effectiveDate &lt; :effectiveDate\n    ORDER BY iv.id.effectiveDate DESC\n    &quot;&quot;&quot;)\n    List&lt;IndicatorValue&gt; findByIndicatorCodeBeforeDate1(\n            @Param(&quot;indicatorCode&quot;) String indicatorCode,\n            @Param(&quot;effectiveDate&quot;) LocalDate effectiveDate\n    );\n\n    List&lt;IndicatorValue&gt; findByIdIndicatorCode(String indicatorCode);\n\n    List&lt;IndicatorValue&gt; findByValue(BigDecimal value);\n}\n</code></pre>\n<p>The core issue is that data is retrieved correctly <strong>only</strong> when I select a specific field, use a native query, or perform mapping via a constructor (as in <code>findByIndicatorCodeBeforeDate1</code>).</p>\n<p>In all other cases—when attempting to fetch the entity or a list of entities—I either get <code>null</code> or a <code>List</code> with the correct number of elements, but every element is <code>null</code>.</p>\n<p>Even the standard <code>findById()</code> returns <code>null</code>, despite the record definitely existing in the database.</p>\n<p>Here is a test snippet from the service</p>\n<pre><code>        List&lt;IndicatorValue&gt; iv = indicatorValueRepository.findByIdIndicatorCode(&quot;worker_4th_grade_hour_rate_construction&quot;);\n        System.out.println(iv);\n        List&lt;IndicatorValue&gt; v = indicatorValueRepository.findByValue(new BigDecimal(&quot;13.02&quot;));\n        System.out.println(v);\n\n        List&lt;IndicatorValue&gt; iv1 = indicatorValueRepository\n                .findByIndicatorCodeBeforeDate(&quot;worker_4th_grade_hour_rate_construction&quot;, period.atDay(1));\n        System.out.println(iv1);\n\n        List&lt;IndicatorValue&gt; iv2 = indicatorValueRepository\n                .findByIndicatorCodeBeforeDate1(&quot;worker_4th_grade_hour_rate_construction&quot;, period.atDay(1));\n        for (IndicatorValue iv3 : iv2) {\n            log.debug(&quot;Код категории: {}, код индикатора: {}, значение: {}, дата: {}&quot;,\n                    iv3.getId().getCategoryCode(),\n                    iv3.getId().getIndicatorCode(),\n                    iv3.getValue(),\n                    iv3.getId().getEffectiveDate());\n        }\n\n        Optional&lt;IndicatorValue&gt; iv4 = indicatorValueRepository\n                .findById(new IndicatorValueId(\n                        null,\n                        &quot;worker_4th_grade_hour_rate_construction&quot;,\n                        LocalDate.of(2025, 9, 1)\n                        )\n                );\n        System.out.println(iv4.orElse(null));\n</code></pre>\n<p>and the corresponding log output.</p>\n<pre><code>2025-11-28T22:28:44.318+03:00 DEBUG 414781 --- [nio-8080-exec-2] org.hibernate.SQL                        : \n    select\n        iv1_0.category_code,\n        iv1_0.effective_date,\n        iv1_0.indicator_code,\n        iv1_0.value \n    from\n        indicator_values iv1_0 \n    where\n        iv1_0.indicator_code=?\n2025-11-28T22:28:44.323+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (1:VARCHAR) -&gt; [null]\n2025-11-28T22:28:44.324+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (1:VARCHAR) -&gt; [null]\n2025-11-28T22:28:44.324+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (1:VARCHAR) -&gt; [null]\n[null, null, null]\n2025-11-28T22:28:44.326+03:00 DEBUG 414781 --- [nio-8080-exec-2] org.hibernate.SQL                        : \n    select\n        iv1_0.category_code,\n        iv1_0.effective_date,\n        iv1_0.indicator_code,\n        iv1_0.value \n    from\n        indicator_values iv1_0 \n    where\n        iv1_0.value=?\n2025-11-28T22:28:44.327+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (1:VARCHAR) -&gt; [null]\n2025-11-28T22:28:44.327+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (1:VARCHAR) -&gt; [null]\n2025-11-28T22:28:44.327+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (1:VARCHAR) -&gt; [null]\n2025-11-28T22:28:44.327+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (1:VARCHAR) -&gt; [null]\n2025-11-28T22:28:44.327+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (1:VARCHAR) -&gt; [null]\n[null, null, null, null, null]\n2025-11-28T22:28:44.330+03:00 DEBUG 414781 --- [nio-8080-exec-2] org.hibernate.SQL                        : \n    select\n        iv1_0.category_code,\n        iv1_0.effective_date,\n        iv1_0.indicator_code,\n        iv1_0.value \n    from\n        indicator_values iv1_0 \n    where\n        iv1_0.indicator_code=? \n        and iv1_0.effective_date&lt;? \n    order by\n        iv1_0.effective_date desc\n2025-11-28T22:28:44.331+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (1:VARCHAR) -&gt; [null]\n[null]\n2025-11-28T22:28:44.333+03:00 DEBUG 414781 --- [nio-8080-exec-2] org.hibernate.SQL                        : \n    select\n        iv1_0.category_code,\n        iv1_0.indicator_code,\n        iv1_0.value,\n        iv1_0.effective_date \n    from\n        indicator_values iv1_0 \n    where\n        iv1_0.indicator_code=? \n        and iv1_0.category_code is null \n        and iv1_0.effective_date&lt;? \n    order by\n        iv1_0.effective_date desc\n2025-11-28T22:28:44.334+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (1:VARCHAR) -&gt; [null]\n2025-11-28T22:28:44.334+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (2:VARCHAR) -&gt; [worker_4th_grade_hour_rate_construction]\n2025-11-28T22:28:44.334+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (3:NUMERIC) -&gt; [13.02]\n2025-11-28T22:28:44.334+03:00 TRACE 414781 --- [nio-8080-exec-2] org.hibernate.orm.jdbc.extract           : extracted value (4:DATE) -&gt; [2024-09-01]\n2025-11-28T22:28:44.335+03:00 DEBUG 414781 --- [nio-8080-exec-2] b.v.n.s.i.u.IndicatorsUpdateService      : Код категории: null, код индикатора: worker_4th_grade_hour_rate_construction, значение: 13.02, дата: 2024-09-01\n2025-11-28T22:28:44.350+03:00 DEBUG 414781 --- [nio-8080-exec-2] org.hibernate.SQL                        : \n    select\n        iv1_0.category_code,\n        iv1_0.effective_date,\n        iv1_0.indicator_code,\n        iv1_0.value \n    from\n        indicator_values iv1_0 \n    where\n        (\n            iv1_0.category_code, iv1_0.effective_date, iv1_0.indicator_code\n        ) in ((?, ?, ?))\nnull\n</code></pre>\n",
    "tags" : [ "java", "hibernate", "jpa", "mapping" ],
    "owner" : {
      "account_id" : 35681406,
      "reputation" : 1,
      "user_id" : 31969879,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6955aa5fb9ec877d76cf319c8243ffe6?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Сергей Потапчук",
      "link" : "https://stackoverflow.com/users/31969879/%d0%a1%d0%b5%d1%80%d0%b3%d0%b5%d0%b9-%d0%9f%d0%be%d1%82%d0%b0%d0%bf%d1%87%d1%83%d0%ba"
    },
    "is_answered" : false,
    "view_count" : 83,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1764523732,
    "creation_date" : 1764503471,
    "link" : "https://stackoverflow.com/questions/79833859/mapping-an-entity-with-an-embedded-key",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}