{
  "question" : {
    "question_id" : 79563007,
    "title" : "ActiveMQ Artemis does not display console when runs in K8S",
    "body" : "<p>I deployed <code>apache/activemq-artemis:2.40.0-alpine</code> in k8s cluster. First run goes well, but when I open console I'm unable to view literally everything but white list:\n<a href=\"https://i.sstatic.net/LR6hVtVd.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/LR6hVtVd.png\" alt=\"enter image description here\" /></a>\n<a href=\"https://i.sstatic.net/8HdEn9TK.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/8HdEn9TK.png\" alt=\"enter image description here\" /></a></p>\n<p>Log:</p>\n<pre class=\"lang-none prettyprint-override\"><code>│ 2025-04-08 18:01:11,109 INFO  [org.apache.activemq.artemis.core.server] AMQ221043: Protocol module found: [artemis-amqp-protocol]. Adding protocol support for: AMQP                                                                       │\n│ 2025-04-08 18:01:11,109 INFO  [org.apache.activemq.artemis.core.server] AMQ221043: Protocol module found: [artemis-hornetq-protocol]. Adding protocol support for: HORNETQ                                                                 │\n│ 2025-04-08 18:01:11,110 INFO  [org.apache.activemq.artemis.core.server] AMQ221043: Protocol module found: [artemis-mqtt-protocol]. Adding protocol support for: MQTT                                                                       │\n│ 2025-04-08 18:01:11,110 INFO  [org.apache.activemq.artemis.core.server] AMQ221043: Protocol module found: [artemis-openwire-protocol]. Adding protocol support for: OPENWIRE                                                               │\n│ 2025-04-08 18:01:11,110 INFO  [org.apache.activemq.artemis.core.server] AMQ221043: Protocol module found: [artemis-stomp-protocol]. Adding protocol support for: STOMP                                                                     │\n│ 2025-04-08 18:01:11,298 INFO  [org.apache.activemq.artemis.core.server] AMQ221034: Waiting indefinitely to obtain primary lock                                                                                                             │\n│ 2025-04-08 18:01:11,299 INFO  [org.apache.activemq.artemis.core.server] AMQ221035: Primary Server Obtained primary lock                                                                                                                    │\n│ 2025-04-08 18:01:11,510 INFO  [org.apache.activemq.artemis.core.server] AMQ221080: Deploying address DLQ supporting [ANYCAST]                                                                                                              │\n│ 2025-04-08 18:01:11,594 INFO  [org.apache.activemq.artemis.core.server] AMQ221003: Deploying ANYCAST queue DLQ on address DLQ                                                                                                              │\n│ 2025-04-08 18:01:11,804 INFO  [org.apache.activemq.artemis.core.server] AMQ221080: Deploying address ExpiryQueue supporting [ANYCAST]                                                                                                      │\n│ 2025-04-08 18:01:11,805 INFO  [org.apache.activemq.artemis.core.server] AMQ221003: Deploying ANYCAST queue ExpiryQueue on address ExpiryQueue                                                                                              │\n│ 2025-04-08 18:01:12,699 INFO  [org.apache.activemq.artemis.core.server] AMQ221020: Started EPOLL Acceptor at 0.0.0.0:61616 for protocols [CORE,MQTT,AMQP,STOMP,HORNETQ,OPENWIRE]                                                           │\n│ 2025-04-08 18:01:12,700 INFO  [org.apache.activemq.artemis.core.server] AMQ221020: Started EPOLL Acceptor at 0.0.0.0:5445 for protocols [HORNETQ,STOMP]                                                                                    │\n│ 2025-04-08 18:01:12,702 INFO  [org.apache.activemq.artemis.core.server] AMQ221020: Started EPOLL Acceptor at 0.0.0.0:5672 for protocols [AMQP]                                                                                             │\n│ 2025-04-08 18:01:12,703 INFO  [org.apache.activemq.artemis.core.server] AMQ221020: Started EPOLL Acceptor at 0.0.0.0:1883 for protocols [MQTT]                                                                                             │\n│ 2025-04-08 18:01:12,704 INFO  [org.apache.activemq.artemis.core.server] AMQ221020: Started EPOLL Acceptor at 0.0.0.0:61613 for protocols [STOMP]                                                                                           │\n│ 2025-04-08 18:01:12,706 INFO  [org.apache.activemq.artemis.core.server] AMQ221007: Server is now active                                                                                                                                    │\n│ 2025-04-08 18:01:12,706 INFO  [org.apache.activemq.artemis.core.server] AMQ221001: Apache ActiveMQ Artemis Message Broker version 2.40.0 [0.0.0.0, nodeID=7401e03f-14a3-11f0-ac6e-02d91668a613]                                            │\n│ 2025-04-08 18:01:12,713 INFO  [org.apache.activemq.artemis] AMQ241003: Starting embedded web server                                                                                                                                        │\n│ 2025-04-08 18:01:14,205 INFO  [io.hawt.HawtioContextListener] Initialising Hawtio services                                                                                                                                                 │\n│ 2025-04-08 18:01:14,210 INFO  [io.hawt.jmx.JmxTreeWatcher] Welcome to Hawtio 4.2.0                                                                                                                                                         │\n│ 2025-04-08 18:01:14,292 INFO  [io.hawt.web.auth.AuthenticationConfiguration] Authentication throttling is enabled                                                                                                                          │\n│ 2025-04-08 18:01:14,390 INFO  [io.hawt.web.auth.AuthenticationConfiguration] Starting Hawtio authentication filter, JAAS realm: &quot;activemq&quot; authorized role(s): &quot;amq&quot; role principal classes: &quot;org.apache.activemq.artemis.spi.core.securit │\n│ 2025-04-08 18:01:14,390 INFO  [io.hawt.web.auth.AuthenticationConfiguration] Looking for OIDC configuration file in: /var/lib/artemis-instance/etc/hawtio-oidc.properties                                                                  │\n│ 2025-04-08 18:01:14,505 INFO  [io.hawt.web.auth.ClientRouteRedirectFilter] Hawtio ClientRouteRedirectFilter is using 1800 sec. HttpSession timeout                                                                                         │\n│ 2025-04-08 18:01:14,611 INFO  [org.apache.activemq.artemis] AMQ241001: HTTP Server started at http://0.0.0.0:8161                                                                                                                          │\n│ 2025-04-08 18:01:14,611 INFO  [org.apache.activemq.artemis] AMQ241002: Artemis Jolokia REST API available at http://0.0.0.0:8161/console/jolokia                                                                                           │\n│ 2025-04-08 18:01:14,611 INFO  [org.apache.activemq.artemis] AMQ241004: Artemis Console available at http://0.0.0.0:8161/console                                                                                                            │\n│ 2025-04-08 18:01:28,287 INFO  [io.hawt.web.auth.keycloak.KeycloakServlet] Keycloak integration is disabled                                                                                                                                 │\n│ 2025-04-08 18:01:34,108 INFO  [io.hawt.web.auth.LoginServlet] Hawtio login is using 1800 sec. HttpSession timeout                                                                                                                          │\n│ 2025-04-08 18:01:34,401 INFO  [io.hawt.web.auth.LoginServlet] Logging in user: artemis                                                                                                                                                     │\n│ 2025-04-08 18:01:47,631 INFO  [io.hawt.web.servlets.JolokiaConfiguredAgentServlet] Jolokia overridden property: [key=policyLocation, value=file:/var/lib/artemis-instance/./etc/jolokia-access.xml]                                        │\n│ 2025-04-08 18:01:47,634 INFO  [io.hawt.web.proxy.ProxyServlet] Proxy servlet is disabled                                                                                                                                                   │\n│ 2025-04-08 18:02:47,861 INFO  [io.hawt.web.auth.LoginServlet] Logging in user: artemis                                                                                                                                                     │\n│ 2025-04-08 20:16:49,260 INFO  [io.hawt.web.auth.LoginServlet] Logging in user: artemis  \n</code></pre>\n<p>moreover, in browser console i see the following error:\n<a href=\"https://i.sstatic.net/3SckIxlD.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/3SckIxlD.png\" alt=\"enter image description here\" /></a></p>\n<p>My current ingress configuration:</p>\n<pre class=\"lang-yaml prettyprint-override\"><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  labels:\n    app.kubernetes.io/component: Ingress\n  name: amq-artemis\n  annotations:\n    external-dns.alpha.kubernetes.io/hostname: hidden\n    external-dns.alpha.kubernetes.io/ingress-hostname-source: annotation-only\n    cert-manager.io/cluster-issuer: hidden\n    cert-manager.io/duration: 2160h\n    cert-manager.io/renew-before: 720h\n    nginx.ingress.kubernetes.io/keepalive_timeout: &quot;1200&quot;\n    nginx.ingress.kubernetes.io/proxy-body-size: &quot;250m&quot;\n    nginx.ingress.kubernetes.io/proxy-buffers-number: &quot;4 256k&quot;\n    nginx.ingress.kubernetes.io/proxy-buffering: 'on'\n    nginx.ingress.kubernetes.io/proxy-buffer-size: &quot;128k&quot;\n    nginx.ingress.kubernetes.io/proxy-read-timeout: &quot;300&quot;\n    nginx.ingress.kubernetes.io/proxy-connect-timeout: &quot;300&quot;\n    nginx.ingress.kubernetes.io/proxy-send-timeout: &quot;300&quot;\n    nginx.ingress.kubernetes.io/backend-protocol: HTTP\n    nginx.ingress.kubernetes.io/ssl-redirect: &quot;true&quot;\n    nginx.ingress.kubernetes.io/affinity: &quot;cookie&quot;\n    nginx.ingress.kubernetes.io/session-cookie-name: &quot;amq-artemis&quot;\n    nginx.ingress.kubernetes.io/session-cookie-samesite: &quot;None&quot;\n    nginx.ingress.kubernetes.io/session-cookie-secure: &quot;true&quot;\n    nginx.ingress.kubernetes.io/session-cookie-path: &quot;/; Secure&quot;\n    nginx.ingress.kubernetes.io/app-root: /console/artemis\n    nginx.ingress.kubernetes.io/cors-allow-methods: &quot;PUT, GET, POST, OPTIONS&quot;\n    nginx.ingress.kubernetes.io/enable-cors: &quot;true&quot;\n    nginx.ingress.kubernetes.io/cors-allow-credentials: &quot;true&quot;\n    nginx.ingress.kubernetes.io/cors-allow-origin: &quot;*&quot;\n    nginx.ingress.kubernetes.io/cors-allow-headers: &quot;DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type&quot;\n    nginx.ingress.kubernetes.io/configuration-snippet: |\n      proxy_busy_buffers_size   256k;\n      client_body_buffer_size   10m;\n      send_timeout              300;\nspec:\n  ingressClassName: nginx\n  tls:\n    - hosts:\n        - hidden\n      secretName: artemis-fqdn-cert\n  rules:\n    - host: hidden\n      http:\n        paths:\n        - path: /\n          pathType: Prefix\n          backend:\n            service:\n              name: amq-artemis\n              port:\n                number: 8161\n        - path: /jolokia\n          pathType: Prefix\n          backend:\n            service:\n              name: amq-artemis\n              port:\n                number: 8161\n        - path: /hawtio\n          pathType: Prefix\n          backend:\n            service:\n              name: amq-artemis\n              port:\n                number: 8161\n        - path: /console\n          pathType: Prefix\n          backend:\n            service:\n              name: amq-artemis\n              port:\n                number: 8161\n</code></pre>\n<p>I run broker with the following parameters: <code>--relax-jolokia --name art --http-host 0.0.0.0 </code></p>\n<p>I have tried with various of ingress rules and annotations, but futile. Any idea what it could be?</p>\n",
    "tags" : [ "java", "kubernetes", "activemq-artemis" ],
    "owner" : {
      "account_id" : 15016264,
      "reputation" : 77,
      "user_id" : 10839199,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-4hHSoEEhmQo/AAAAAAAAAAI/AAAAAAAAAEM/Or9E6JvtjcA/s256-rj/photo.jpg",
      "display_name" : "Roman R.",
      "link" : "https://stackoverflow.com/users/10839199/roman-r"
    },
    "is_answered" : true,
    "view_count" : 239,
    "answer_count" : 3,
    "score" : 0,
    "last_activity_date" : 1748345265,
    "creation_date" : 1744144307,
    "link" : "https://stackoverflow.com/questions/79563007/activemq-artemis-does-not-display-console-when-runs-in-k8s",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79563023,
    "question_id" : 79563007,
    "body" : "<p>ActiveMQ Artemis 2.40.0 introduced a new web console based on a new version of Hawtio and Jolokia. Due to this change any request with an origin header using the <code>https</code> scheme which is ultimately received by Jolokia via HTTP is now discarded by default since it is deemed insecure. If you use a TLS proxy that transforms secure requests to insecure requests (e.g. in a Kubernetes environment) then consider changing the proxy to preserve HTTPS and switching the <a href=\"https://activemq.apache.org/components/artemis/documentation/latest/web-server.html#embedded-web-server\" rel=\"nofollow noreferrer\">embedded web server</a> to HTTPS. If that isn’t feasible then you can accept the risk by adding <code>&lt;ignore-scheme/&gt;</code> to <code>etc/jolokia-access.xml</code>. See the <a href=\"https://jolokia.org/reference/html/manual/security.html\" rel=\"nofollow noreferrer\">Jolokia documentation</a> for more details.</p>\n",
    "score" : 3,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 11434008,
      "reputation" : 36282,
      "user_id" : 8381946,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-ORs8fPNVzDU/AAAAAAAAAAI/AAAAAAAADBs/F3IsdsProVY/s256-rj/photo.jpg",
      "display_name" : "Justin Bertram",
      "link" : "https://stackoverflow.com/users/8381946/justin-bertram"
    },
    "creation_date" : 1744144901,
    "last_activity_date" : 1744161078,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79640383,
    "question_id" : 79563007,
    "body" : "<p>Example K8s configuration that worked for me:</p>\n<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  namespace: activemq\n  name: activemq\n  labels:\n    app.kubernetes.io/name: activemq\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: activemq\n  template:\n    metadata:\n      labels:\n        app.kubernetes.io/name: activemq\n    spec:\n      containers:\n      - name: activemq\n        image: apache/activemq-artemis:2.41.0-alpine\n        imagePullPolicy: Always\n        ports:\n          - containerPort: 61616\n            name: messaging\n          - containerPort: 8161\n            name: http\n        volumeMounts:\n          - name: activemq-config\n            mountPath:  /var/lib/artemis-instance/etc-override\n      volumes:\n        - name: activemq-config\n          configMap:\n            name: activemq-config\n            items:\n              - key: jolokia-access.xml\n                path: jolokia-access.xml \n</code></pre>\n<pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  namespace: activemq\n  name: activemq-config\n  labels:\n    app.kubernetes.io/name: activemq  \ndata:\n  jolokia-access.xml: |\n    &lt;cors&gt;\n      &lt;ignore-scheme/&gt;\n    &lt;/cors&gt;\n</code></pre>\n",
    "score" : 2,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1026562,
      "reputation" : 413,
      "user_id" : 1035746,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/48702671092ef3aadc7e618107dbdefa?s=256&d=identicon&r=PG",
      "display_name" : "Tom Davis",
      "link" : "https://stackoverflow.com/users/1035746/tom-davis"
    },
    "creation_date" : 1748345265,
    "last_activity_date" : 1748345265,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79633264,
    "question_id" : 79563007,
    "body" : "<p>Adding <code>&lt;ignore-scheme/&gt;</code> was the solution for us. Just make sure to add it within the <code>&lt;cors&gt;</code> section of the <code>jolokia-access.xml</code>. We are using the official artemis image and mount it from a configmap to /<code>var/lib/artemis-instance/etc-override/jolokia-access.xml</code> so it gets copied to the install directory on startup.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 42091708,
      "reputation" : 11,
      "user_id" : 30589948,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/138552bc99cfb828aad586eb27768150?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Christian Platzer",
      "link" : "https://stackoverflow.com/users/30589948/christian-platzer"
    },
    "creation_date" : 1747898572,
    "last_activity_date" : 1747898572,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79563023" : [ {
      "comment_id" : 140314140,
      "post_id" : 79563023,
      "body" : "Yes. Jetty is the embedded web server.",
      "score" : 0,
      "owner" : {
        "account_id" : 11434008,
        "reputation" : 36282,
        "user_id" : 8381946,
        "user_type" : "registered",
        "profile_image" : "https://lh3.googleusercontent.com/-ORs8fPNVzDU/AAAAAAAAAAI/AAAAAAAADBs/F3IsdsProVY/s256-rj/photo.jpg",
        "display_name" : "Justin Bertram",
        "link" : "https://stackoverflow.com/users/8381946/justin-bertram"
      },
      "creation_date" : 1744161016,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140313627,
      "post_id" : 79563023,
      "body" : "Jetty is embedded web server. Isn&#39;t it?",
      "score" : 0,
      "owner" : {
        "account_id" : 15016264,
        "reputation" : 77,
        "user_id" : 10839199,
        "user_type" : "registered",
        "profile_image" : "https://lh4.googleusercontent.com/-4hHSoEEhmQo/AAAAAAAAAAI/AAAAAAAAAEM/Or9E6JvtjcA/s256-rj/photo.jpg",
        "display_name" : "Roman R.",
        "link" : "https://stackoverflow.com/users/10839199/roman-r"
      },
      "creation_date" : 1744146817,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}