{
  "question" : {
    "question_id" : 79570103,
    "title" : "BLE bluetooth not receiving all fragments",
    "body" : "<p>To Summarize,\nI am trying to establish a connection with a digital wallet on my Android phone using BLE .</p>\n<pre><code>BLE Peripheral -&gt; Linux Box (NXP Imx8mm running yocto mickledore)\nBLE Central Client -&gt; is an Android phone hosting a Digital Wallet\n</code></pre>\n<p>I am using dbus-java, bluez-dbus along with a native unix socket.</p>\n<ul>\n<li>Data is Sent Successfully from my GattServer to client . This is OK.</li>\n<li>The client is sending bursts of data (&quot;Digital Identity&quot; information)\nbut my server doesnt receive them.</li>\n<li>The spec mandates a &quot;write-without-response&quot; characteristic which my server has registered to .</li>\n</ul>\n<p>hcidump :  Can see all data</p>\n<p>From BTMON: (Btmon Sees the Packets , The Last Data is 00757314 which is received by me )  ..\nWireshark is able to reassemble this dump</p>\n<pre><code>&gt; ACL Data RX: Handle 3585 flags 0x02 dlen 27                                                                #236 [hci0] 35.621960\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #237 [hci0] 35.622618\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #238 [hci0] 35.623279\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #239 [hci0] 35.623949\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #240 [hci0] 35.624712\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #241 [hci0] 35.625339\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #242 [hci0] 35.625974\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #243 [hci0] 35.626730\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #244 [hci0] 35.627355\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #245 [hci0] 35.632511\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #246 [hci0] 35.633049\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #247 [hci0] 35.633734\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #248 [hci0] 35.634414\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #249 [hci0] 35.635083\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #250 [hci0] 35.635754\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #251 [hci0] 35.636440\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #252 [hci0] 35.637134\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #253 [hci0] 35.637809\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #254 [hci0] 35.638470\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 6                                                                 #255 [hci0] 35.638970\n      ATT: Write Command (0x52) len 514\n        Handle: 0x00c7\n          Data: \n&gt; ACL Data RX: Handle 3585 flags 0x02 dlen 27                                                                #256 [hci0] 35.639735\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #257 [hci0] 35.640344\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #258 [hci0] 35.641001\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #259 [hci0] 35.641737\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #260 [hci0] 35.642366\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #261 [hci0] 35.643034\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #262 [hci0] 35.643735\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #263 [hci0] 35.644394\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #264 [hci0] 35.645058\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #265 [hci0] 35.645734\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 22                                                                #266 [hci0] 35.647456\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #267 [hci0] 35.648035\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #268 [hci0] 35.648734\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #269 [hci0] 35.649370\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #270 [hci0] 35.650060\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #271 [hci0] 35.650736\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #272 [hci0] 35.651415\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #273 [hci0] 35.652086\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 27                                                                #274 [hci0] 35.652784\n&gt; ACL Data RX: Handle 3585 flags 0x01 dlen 11                                                                #275 [hci0] 35.653307\n      ATT: Write Command (0x52) len 514\n        Handle: 0x00c7\n          Data: \n&gt; ACL Data RX: Handle 3585 flags 0x02 dlen 11                                                                #276 [hci0] 35.653852\n      ATT: Write Command (0x52) len 6\n        Handle: 0x00c7\n          Data: 00757314\n</code></pre>\n<p>WireShark can reassemble all this data successfully</p>\n<p>But unfortunately, none of these fragments land on my Characteristic's Write callback, even on bluez dbus either ,\nMTU is negotiated at 517 which is ok</p>\n<pre><code>sudo dbus-monitor --system interface=org.bluez.GattCharacteristic1\n\nmethod call time=1744433606.234999 sender=:1.176 -&gt; destination=:1.228 serial=1088 path=/credenceid/service0/state; interface=org.bluez.GattCharacteristic1; member=WriteValue\n   array of bytes [\n      01\n   ]\n   array [\n      dict entry(\n         string &quot;device&quot;\n         variant             object path &quot;/org/bluez/hci0/dev_4B_02_AB_E4_B8_D9&quot;\n      )\n      dict entry(\n         string &quot;link&quot;\n         variant             string &quot;LE&quot;\n      )\n      dict entry(\n         string &quot;mtu&quot;\n         variant             uint16 517\n      )\n   ]\nmethod call time=1744433609.654247 sender=:1.176 -&gt; destination=:1.228 serial=1089 path=/credenceid/service0/clientToServer; interface=org.bluez.GattCharacteristic1; member=WriteValue\n   array of bytes [\n      00 75 73 14\n   ]\n   array [\n      dict entry(\n         string &quot;device&quot;\n         variant             object path &quot;/org/bluez/hci0/dev_4B_02_AB_E4_B8_D9&quot;\n      )\n      dict entry(\n         string &quot;link&quot;\n         variant             string &quot;LE&quot;\n      )\n      dict entry(\n         string &quot;mtu&quot;\n         variant             uint16 517\n      )\n   ]\nmethod call time=1744433611.482766 sender=:1.176 -&gt; destination=:1.228 serial=1096 path=/credenceid/service0/serverToClient; interface=org.bluez.GattCharacteristic1; member=StopNotify\nmethod call time=1744433611.482820 sender=:1.176 -&gt; destination=:1.228 serial=1097 path=/credenceid/service0/state; interface=org.bluez.GattCharacteristic1; member=StopNotify\n</code></pre>\n<p>Can some one explain what i am missing here ?? I am using bluez 5.66</p>\n",
    "tags" : [ "java", "bluetooth", "bluetooth-lowenergy", "dbus", "bluez" ],
    "owner" : {
      "account_id" : 6147280,
      "reputation" : 23,
      "user_id" : 4792834,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-1uKQUUskVfA/AAAAAAAAAAI/AAAAAAAAFOA/Lx73J9bE7uE/s256-rj/photo.jpg",
      "display_name" : "Pavan Nittala",
      "link" : "https://stackoverflow.com/users/4792834/pavan-nittala"
    },
    "is_answered" : false,
    "view_count" : 42,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1744439691,
    "creation_date" : 1744439269,
    "link" : "https://stackoverflow.com/questions/79570103/ble-bluetooth-not-receiving-all-fragments",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}