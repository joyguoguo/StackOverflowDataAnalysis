{
  "question" : {
    "question_id" : 79778698,
    "title" : "LIFF getIDToken returns undefined on iOS but works on Android",
    "body" : "<p>I am building an application with Java Spring Boot + Jquery using LiffSDK for my chat application.</p>\n<pre><code>  @GetMapping\n  public String init(@RequestParam String liffChannelId,\n      @RequestParam String messageChannelId,\n      @RequestParam String isInit,\n      @RequestParam String idToken,\n      HttpServletRequest request, Model model) {\n    if (Objects.isNull(isInit)) {\n      return &quot;chat_ui&quot;;\n    }\n\n    ChatForm form =chatHelper.init(liffChannelId, messageChannelId, idToken, request);\n    model.addAttribute(&quot;form&quot;, form);\n\n    return &quot;chat_ui&quot;;\n  }\n</code></pre>\n<p>And in my Js:</p>\n<pre><code>$(document).ready(function () {\n  const urlParams = new URLSearchParams(window.location.search);\n  const isInit = urlParams.get(&quot;isInit&quot;);\n  if (!isInit) {\n    initLiffApp();\n  }\n});\n\nfunction initLiffApp() {\n  const messageChannelId = new URLSearchParams(window.location.search).get(&quot;messageChannelId&quot;);\n\n  const liffChannelId = new URLSearchParams(window.location.search).get(&quot;liffChannelId&quot;);\n\n  const liffId = new URLSearchParams(window.location.search).get(&quot;liffId&quot;);\n\n  liff\n    .init({\n      liffId: liffId\n    })\n    .then(() =&gt; {\n      const idToken = liff.getIDToken();\n      if (!idToken) {\n        alert(&quot;Failed to get ID Token&quot;);\n        return;\n      }\n      sendToServer(liffChannelId, messageChannelId, idToken);\n    })\n    .catch(err =&gt; {\n      console.error(&quot;LIFF error&quot;, err);\n    });\n}\n\nfunction sendToServer(liffChannelId, messageChannelId, idToken) {\n  const redirectUrl = `/chat?liffChannelId=${encodeURIComponent(liffChannelId)}&amp;messageChannelId=${encodeURIComponent(messageChannelId)}&amp;isInit=1&amp;idToken=${encodeURIComponent(idToken)}`;\n  window.location.href = redirectUrl;\n}\n</code></pre>\n<p>The application being deployed will call the server twice. When initializing, based on whether the isInit variable is passed or not, it will return to the interface. Then in Js, it will call Liff Server to get idToken. At this time, it will call the server a second time with the isInit variable = true and then the server will continue processing.</p>\n<p>I tested on Android and it still received normally, but on iOS it kept saying it could not get idToken and displayed an alert cannot get idToken.</p>\n<p>Can someone help me with this problem? Thank you very much</p>\n",
    "tags" : [ "javascript", "java", "spring", "thymeleaf", "chat" ],
    "owner" : {
      "account_id" : 29759639,
      "reputation" : 51,
      "user_id" : 22807550,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/TppBMj7J.jpg?s=256",
      "display_name" : "TunazZz",
      "link" : "https://stackoverflow.com/users/22807550/tunazzz"
    },
    "is_answered" : false,
    "view_count" : 70,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1759206501,
    "creation_date" : 1759206501,
    "link" : "https://stackoverflow.com/questions/79778698/liff-getidtoken-returns-undefined-on-ios-but-works-on-android",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140768063,
    "post_id" : 79778698,
    "body" : "Yes, I debugged and the liffId from the URL is correct. I’m currently using &lt;script src=&#39;<a href=\"https://static.line-scdn.net/liff/edge/2/sdk.js&#39;&gt;&lt;/script\" rel=\"nofollow noreferrer\">static.line-scdn.net/liff/edge/2/sdk.js&#39;&gt;&lt;/script</a>&gt;. I can’t debug directly on Safari since I don’t have a Mac, I’m testing with the Mac emulator in Edge. How can I check if this SDK version is compatible with iOS Safari?",
    "score" : 0,
    "owner" : {
      "account_id" : 29759639,
      "reputation" : 51,
      "user_id" : 22807550,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/TppBMj7J.jpg?s=256",
      "display_name" : "TunazZz",
      "link" : "https://stackoverflow.com/users/22807550/tunazzz"
    },
    "creation_date" : 1759215734,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140768041,
    "post_id" : 79778698,
    "body" : "Have you tried debugging the <code>liffId</code> you get from the query string? It seems odd that the promise would resolve successfully and <code>getIdToken()</code> to return an empty value. You might need to check if the Liff SDK is compatible with your iOS Safari version",
    "score" : 0,
    "owner" : {
      "account_id" : 106364,
      "reputation" : 165663,
      "user_id" : 283366,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/9ad213d8adabe4b64c2d53c5e0e3cab4?s=256&d=identicon&r=PG",
      "display_name" : "Phil",
      "link" : "https://stackoverflow.com/users/283366/phil"
    },
    "creation_date" : 1759215105,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140768022,
    "post_id" : 79778698,
    "body" : "Yes, on iOS it actually shows the alert with the message &quot;Failed to get ID Token&quot;.",
    "score" : 0,
    "owner" : {
      "account_id" : 29759639,
      "reputation" : 51,
      "user_id" : 22807550,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/TppBMj7J.jpg?s=256",
      "display_name" : "TunazZz",
      "link" : "https://stackoverflow.com/users/22807550/tunazzz"
    },
    "creation_date" : 1759214610,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140768008,
    "post_id" : 79778698,
    "body" : "<i>&quot;on iOS it kept saying it could not get idToken&quot;</i>... as in it showed your alert <code>Failed to get ID Token</code> or was the problem reported in some other way?",
    "score" : 0,
    "owner" : {
      "account_id" : 106364,
      "reputation" : 165663,
      "user_id" : 283366,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/9ad213d8adabe4b64c2d53c5e0e3cab4?s=256&d=identicon&r=PG",
      "display_name" : "Phil",
      "link" : "https://stackoverflow.com/users/283366/phil"
    },
    "creation_date" : 1759214333,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}