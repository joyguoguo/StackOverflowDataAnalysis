{
  "question" : {
    "question_id" : 79798621,
    "title" : "Unit testing with TestFX (and Mockito)",
    "body" : "<p>It is my understanding that you have to @ExtendWith(MockitoExtension.class) to run a test class with Mockito runner. And to use TestFX to test a JavaFX application you would need to @ExtendWith(ApplicationExtension.class). My question is, how do you do both at the same time?\nWhere I can I find good examples/tutorials for unit tests for a JavaFX application, that has an MVC architecture? Yes, I have googled, but the examples are basic...</p>\n<p>In a spring boot application i am testing, my test class has mock objects (Using @InjectMocks and @Mock).</p>\n<pre><code>@ExtendWith(MockitoExtension.class)\nclass BurgerControllerTest extends FXTest {\n    @InjectMocks\n    BurgerController burgerController;\n\n    @Mock\n    BurgerUtils burgerUtils;\n\n    @Mock\n    ApplicationEventPublisher publisher;\n\n//This is for spring, so I can pick up events published\n    @Autowired\n    ApplicationEvents applicationEvents;\n    \n    @Test\n    void testSomething(){\n    burgerController.onBurgerSaveEvent(int x);\n    assertEquals(1, applicationEvents.stream(LocalFileSaveRequestEvent.class)).count(),&quot;There was a save file event!&quot;);\n    }\n</code></pre>\n<p>The FXTest class just does Platform.startup, it doesnt launch the application with a stage or anything.</p>\n<p>I want to test onBurgerSaveEvent method but it's invoking &quot;ApplicationStartupTask.getPrimaryStage()&quot; which looks like this</p>\n<pre><code>public class ApplicationStartupTask extends Task&lt;Void&gt; {\nApplicationStartupTask(Stage primaryStage, Application application) {\n        stage = primaryStage;\n        this.application = application;\n    }\n}\n</code></pre>\n<pre><code>class BurgerController{\n    @Autowired\n    private burgerUtils;\n    @Autowired\n    private ApplicationEventPublisher publisher;\n\n    onBurgerSaveEvent(int x){\n        File file = LocalFileManager.chooseWriteFile(ApplicationStartupTask.getPrimaryStage());\n        publisher.publishEvent(new LocalFileSaveRequestEvent(this, file, x));\n    }\n    }\n</code></pre>\n<p>It calls this other class LocalFileManager that has JavaFX stuff in it..</p>\n<pre><code>class LocalFileManager{\n        public static File chooseWriteFile(Stage stage) {\n            //Adds a stage to the existing javafx application\n            Stage dummy = new Stage();\n            dummy.initOwner(stage);\n            FileChooser fileChooser = new FileChooser();\n            File selected = fileChooser.showSaveDialog(dummy);\n.....\n        }\n}\n</code></pre>\n<p>The issue is that my Test doesnt run, it complains that it's not on the JavaFX thread. its on the main thread, as soon as the BurgerController.onBurgerSaveEvent hits its LocalFileManager.chooseWriteFile line. Even if I use Platform.runLater it doesn't work.\nTo run everything on the same thread I assume I have to extend ApplicationTest or run with ApplicationExtension.class and create a start/@Start method that sets up a stage and stage.show()\nBut if I do this then I can't run with MockitoExtension.class, and it will say all my mocks are null.</p>\n",
    "tags" : [ "java", "unit-testing", "javafx" ],
    "owner" : {
      "account_id" : 4202987,
      "reputation" : 11,
      "user_id" : 11431627,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/eA2Gx.png?s=256",
      "display_name" : "tM_za",
      "link" : "https://stackoverflow.com/users/11431627/tm-za"
    },
    "is_answered" : true,
    "view_count" : 103,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1761533400,
    "creation_date" : 1761299008,
    "link" : "https://stackoverflow.com/questions/79798621/unit-testing-with-testfx-and-mockito",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79799070,
    "question_id" : 79798621,
    "body" : "<p>To run a test class with Mockito runner:</p>\n<pre><code>@ExtendWith(MockitoExtension.class)\n</code></pre>\n<p>To use TestFX to test a JavaFX application:</p>\n<pre><code>@ExtendWith(ApplicationExtension.class)\n</code></pre>\n<blockquote>\n<p>how do you do both at the same time?</p>\n</blockquote>\n<p><a href=\"https://docs.junit.org/5.11.1/api/org.junit.jupiter.api/org/junit/jupiter/api/extension/ExtendWith.html#value()\" rel=\"nofollow noreferrer\"><code>@ExtendWith</code></a> can handle multiple extensions.</p>\n<p>The value for the extension classes can be an array.</p>\n<pre><code>@ExtendWith({\n     MockitoExtension.class,\n     ApplicationExtension.class\n})\n</code></pre>\n<p>The asker notes in comments:</p>\n<blockquote>\n<p>it works for this case</p>\n</blockquote>\n<hr />\n<h3>Related</h3>\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/56268274/order-of-multiple-extensions-in-junit-5\">Order of multiple extensions in JUnit 5</a></li>\n</ul>\n<h3>Additional thoughts</h3>\n<p>Alternately, you could treat tests with mocks as unit tests which don't involve JavaFX code, running those with the <code>MockitoExtension</code>. And treat the JavaFX TestFX tests as integration tests which don't use mocks, running those with the TestFX <code>ApplicationExtension</code>.</p>\n<p>You might also want to consider the <a href=\"https://docs.spring.io/spring-framework/reference/testing/testcontext-framework/support-classes.html#testcontext-junit-jupiter-extension\" rel=\"nofollow noreferrer\"><code>SpringExtension</code></a> as you are using Spring.</p>\n<h3>FAQ</h3>\n<blockquote>\n<p>Where I can I find good examples/tutorials for unit tests for a JavaFX application, that has an MVC architecture?</p>\n</blockquote>\n<p>I am not associated with any of the projects listed below.</p>\n<p>The JavaFX platform has lots of tests.  You might want something less rigorous and different in structure as you are building an app using a platform rather than a platform itself.  Still, in case you are interested:</p>\n<ul>\n<li><a href=\"https://github.com/openjdk/jfx/tree/master/tests\" rel=\"nofollow noreferrer\">JavaFX functional tests</a></li>\n<li><a href=\"https://github.com/openjdk/jfx/tree/master/modules/javafx.controls/src/test\" rel=\"nofollow noreferrer\">JavaFX controls tests</a> (other modules have similar locations).</li>\n<li><a href=\"https://wiki.openjdk.org/display/OpenJFX/OpenJFX+unit+tests\" rel=\"nofollow noreferrer\">JavaFX test wiki</a> (this is older info and might be outdated).</li>\n</ul>\n<p>SceneBuilder has lots of tests and is an app based on JavaFX rather than the JavaFX platform itself, so could be relevant to you.  It isn't Spring-based, so testing will be a bit different based on that.  It tests using a <a href=\"https://github.com/gluonhq/scenebuilder/blob/master/kit/src/test/java/com/oracle/javafx/scenebuilder/kit/JfxInitializer.java\" rel=\"nofollow noreferrer\"><code>JFXIntitializer</code></a> used in a test <a href=\"https://github.com/gluonhq/scenebuilder/blob/master/kit/src/test/java/com/oracle/javafx/scenebuilder/kit/editor/job/RelocateSelectionJobTest.java#L50\" rel=\"nofollow noreferrer\">like this</a> rather than TestFX.</p>\n<ul>\n<li><a href=\"https://github.com/gluonhq/scenebuilder/tree/master/kit/src/test/java/com\" rel=\"nofollow noreferrer\">SceneBuilder tests</a></li>\n</ul>\n<p>VocabHunter has tests using both Mockito's <code>MockitoExtension</code> and TestFX's <code>ApplicationExtension</code> in conjunction with junit Jupiter.  This matches the scenario you ask about in your question.  You can find an example test class at:</p>\n<ul>\n<li><a href=\"https://github.com/VocabHunter/VocabHunter/blob/master/gui/src/test/java/io/github/vocabhunter/gui/main/GuiTest.java\" rel=\"nofollow noreferrer\">VocabHunter git repository GUI test classes</a></li>\n</ul>\n",
    "score" : 2,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1180113,
      "reputation" : 160456,
      "user_id" : 1155209,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5192e7cbcf2f72a847d6fb0d1552f049?s=256&d=identicon&r=PG",
      "display_name" : "jewelsea",
      "link" : "https://stackoverflow.com/users/1155209/jewelsea"
    },
    "creation_date" : 1761330089,
    "last_activity_date" : 1761533400,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140815239,
    "post_id" : 79798621,
    "body" : "It&#39;s hard to say with certainty without knowing more about your setup, but part of the issue may be your hard-coded use of <code>LocalFileManager::chooseWriteFile</code> in your controller. That means three things during unit testing: (1) The JavaFX toolkit has to be running; (2) you have to ensure at least part of the test is executed on the FX thread; (3) and it&#39;s not easy to mock <code>chooseWriteFile</code>. Given this is Spring, you may want to create an interface for choosing files and inject it into your controller. Then the unit test could use an implementation that doesn&#39;t require JavaFX.",
    "score" : 0,
    "owner" : {
      "account_id" : 8532578,
      "reputation" : 49884,
      "user_id" : 6395627,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Slaw",
      "link" : "https://stackoverflow.com/users/6395627/slaw"
    },
    "creation_date" : 1761314058,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140815092,
    "post_id" : 79798621,
    "body" : "Thank you, I didn&#39;t realise that @ExtendWith can handle multiple values :&#39;) it works for this case",
    "score" : 0,
    "owner" : {
      "account_id" : 4202987,
      "reputation" : 11,
      "user_id" : 11431627,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/eA2Gx.png?s=256",
      "display_name" : "tM_za",
      "link" : "https://stackoverflow.com/users/11431627/tm-za"
    },
    "creation_date" : 1761310446,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}