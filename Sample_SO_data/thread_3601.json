{
  "question" : {
    "question_id" : 79537222,
    "title" : "Writing and returning a File in Kotlin using a buffer",
    "body" : "<p>I'm working on a function to process some data and output the results as a csv file. I am using a 'use' block to wrap the function and ensure all the resources are closed. the problem I am running into is that I want the function to return the newly created File to the caller. The use block has the ability to return a value, however since it is being called with a bufferedWriter, there is no ability to actually return the File object from inside the block. Can anyone offer suggestions on how to solve this?</p>\n<p>I want to do something like:</p>\n<pre><code>fun List&lt;Contact&gt;.buildCsv():File\n{\n    return File(&quot;people.csv&quot;).bufferedWriter(Charsets.ISO_8859_1).use { out -&gt;\n\n            out.write(&quot;a,b,c,d\\n&quot;)\n            this.forEach {\n                out.write(it.toString())\n            }\n        }\n\n}\n</code></pre>\n<p>but that code does not compile.</p>\n",
    "tags" : [ "java", "kotlin", "file", "bufferedwriter", "closeable" ],
    "owner" : {
      "account_id" : 2090213,
      "reputation" : 1839,
      "user_id" : 1860222,
      "user_type" : "registered",
      "accept_rate" : 52,
      "profile_image" : "https://www.gravatar.com/avatar/dcd9cf0881ee1e7a5f28175308628e25?s=256&d=identicon&r=PG",
      "display_name" : "pbuchheit",
      "link" : "https://stackoverflow.com/users/1860222/pbuchheit"
    },
    "is_answered" : true,
    "view_count" : 120,
    "answer_count" : 2,
    "score" : 2,
    "last_activity_date" : 1743142133,
    "creation_date" : 1743021187,
    "link" : "https://stackoverflow.com/questions/79537222/writing-and-returning-a-file-in-kotlin-using-a-buffer",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79537253,
    "question_id" : 79537222,
    "body" : "<p>You can use some builtin scope functions such as apply, also, etc.</p>\n<p>An example:</p>\n<pre><code>fun List&lt;Contact&gt;.buildCsv() = File(&quot;people.csv&quot;).apply {\n    bufferedWriter(Charsets.ISO_8859_1).use { out -&gt;\n        out.write(&quot;a,b,c,d\\n&quot;)\n        forEach { out.write(&quot;$it&quot;) }\n    }\n}\n</code></pre>\n",
    "score" : 3,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 55050,
      "reputation" : 196642,
      "user_id" : 164835,
      "user_type" : "registered",
      "accept_rate" : 80,
      "profile_image" : "https://i.sstatic.net/ayYoh.jpg?s=256",
      "display_name" : "Kent",
      "link" : "https://stackoverflow.com/users/164835/kent"
    },
    "creation_date" : 1743022128,
    "last_activity_date" : 1743022128,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79537240,
    "question_id" : 79537222,
    "body" : "<p>How about:</p>\n<pre><code>fun List&lt;Contact&gt;.buildCsv(): File {\n    val file = File(&quot;people.csv&quot;)\n\n    file.bufferedWriter(Charsets.ISO_8859_1).use { out -&gt;\n        out.write(&quot;a,b,c,d\\n&quot;)\n        this.forEach {\n            out.write(it.toString())\n        }\n    }\n\n    return file\n}\n</code></pre>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 85850,
      "reputation" : 9394,
      "user_id" : 239101,
      "user_type" : "registered",
      "accept_rate" : 57,
      "profile_image" : "https://i.sstatic.net/zEXWJ.jpg?s=256",
      "display_name" : "David Soroko",
      "link" : "https://stackoverflow.com/users/239101/david-soroko"
    },
    "creation_date" : 1743021821,
    "last_activity_date" : 1743025438,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140267167,
    "post_id" : 79537222,
    "body" : "I&#39;d recommend you don&#39;t tie yourself to <code>File</code>s and hence the file system. It gets messy when unit testing. (You do write unit tests, right?) Instead of a <code>File</code>, pass an <code>OutputStream</code> or a <code>StreamWriter</code>. In a test you can pass one that collects what gets written in a byte array or string. In real life, you can still pass a stream that writes to a file. But this decouples I/O from the logic in your <code>buildCsv</code> function.",
    "score" : 0,
    "owner" : {
      "account_id" : 1535561,
      "reputation" : 9056,
      "user_id" : 1431720,
      "user_type" : "registered",
      "accept_rate" : 89,
      "profile_image" : "https://www.gravatar.com/avatar/f5a1388d4d3b2bf03b11bb5658c68c29?s=256&d=identicon&r=PG",
      "display_name" : "Robert",
      "link" : "https://stackoverflow.com/users/1431720/robert"
    },
    "creation_date" : 1743029081,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140266916,
    "post_id" : 79537222,
    "body" : "I am not very familiar with Kotlin, but I would use a library over just trying to create CSV content the way you are doing it. If things get complicated, your output will pay the price.",
    "score" : 0,
    "owner" : {
      "account_id" : 2819940,
      "reputation" : 14002,
      "user_id" : 2423906,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://i.sstatic.net/rkpYv.jpg?s=256",
      "display_name" : "SedJ601",
      "link" : "https://stackoverflow.com/users/2423906/sedj601"
    },
    "creation_date" : 1743023525,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140266842,
    "post_id" : 79537222,
    "body" : "You can&#39;t return a <code>File</code> in Java. It&#39;s not what you think. The functionality of that class is really to manipulate paths and the like. It really has little to do with the actual content of a file system. If you really want to return a &#39;file&#39; you would do well to think of it as returning a stream to the actual content (and all that entails)",
    "score" : 2,
    "owner" : {
      "account_id" : 22124137,
      "reputation" : 4243,
      "user_id" : 16376827,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/1ImPw.png?s=256",
      "display_name" : "g00se",
      "link" : "https://stackoverflow.com/users/16376827/g00se"
    },
    "creation_date" : 1743021867,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79537253" : [ {
      "comment_id" : 140268688,
      "post_id" : 79537253,
      "body" : "This answer would be perfect if it included strong advice to use one of the many CSV libraries available, instead of manually writing the content.",
      "score" : 0,
      "owner" : {
        "account_id" : 19118721,
        "reputation" : 12469,
        "user_id" : 13963086,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/9df2c3c4c87d8050b8fd6a59c88c7133?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "k314159",
        "link" : "https://stackoverflow.com/users/13963086/k314159"
      },
      "creation_date" : 1743068132,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140267005,
      "post_id" : 79537253,
      "body" : "The Kotlin ideomatic way to this.",
      "score" : 1,
      "owner" : {
        "account_id" : 85850,
        "reputation" : 9394,
        "user_id" : 239101,
        "user_type" : "registered",
        "accept_rate" : 57,
        "profile_image" : "https://i.sstatic.net/zEXWJ.jpg?s=256",
        "display_name" : "David Soroko",
        "link" : "https://stackoverflow.com/users/239101/david-soroko"
      },
      "creation_date" : 1743025581,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}