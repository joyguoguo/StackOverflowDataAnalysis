{
  "question" : {
    "question_id" : 79831621,
    "title" : "How does the JVM instruction getfield work?",
    "body" : "<p>Thread A performs <code>getfield Stop.flag</code> and the value is <code>false</code>. At a certain point, another thread modifies <code>Stop.flag</code> to <code>true</code>, but Thread A keeps getting <code>false</code> when reading <code>Stop.flag</code>.</p>\n<p>I don’t understand. Under the CPU MESI protocol, even if the latest value is not read from memory, Thread A should still be able to read <code>true</code> from the cache with MESI support. Is it possible that <code>getfield</code> does not read from the CPU cache?</p>\n<pre class=\"lang-java prettyprint-override\"><code>package org.example;\n\nimport java.util.concurrent.TimeUnit;\n\npublic class TestVolatile2 {\n    public static class Stop {\n        boolean flag = false;\n    }\n\n    public static void main(String[] args) {\n        final Stop stop = new Stop();\n        // Thread-A\n        new Thread(&quot;Thread A&quot;) {\n            @Override\n            public void run() {\n                Stop s = stop;\n                while (!s.flag) { // getfield Stop.flag, but always false. even getfield from cpu caches, but msei sync true. why? getfield always false\n                }\n                System.out.println(Thread.currentThread() + &quot; stopped&quot;);\n            }\n        }.start();\n\n        // Thread-main\n        try {\n            TimeUnit.SECONDS.sleep(1);\n            System.out.println(Thread.currentThread() + &quot; after 1 seconds&quot;);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        stop.flag = true;\n    }\n}\n</code></pre>\n",
    "tags" : [ "java", "jvm", "volatile" ],
    "owner" : {
      "account_id" : 14761714,
      "reputation" : 25,
      "user_id" : 10660856,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/lqjCz.png?s=256",
      "display_name" : "杨尚山",
      "link" : "https://stackoverflow.com/users/10660856/%e6%9d%a8%e5%b0%9a%e5%b1%b1"
    },
    "is_answered" : true,
    "view_count" : 114,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1764566519,
    "creation_date" : 1764240269,
    "link" : "https://stackoverflow.com/questions/79831621/how-does-the-jvm-instruction-getfield-work",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}