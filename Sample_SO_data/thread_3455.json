{
  "question" : {
    "question_id" : 79548394,
    "title" : "error: cannot find symbol .antMatcher(&quot;/**&quot;)",
    "body" : "<p>I have upgraded my Spring Boot application from version 2.6.15 to version 3.1.12. But it appears that some methods have been renamed and their positions are changed. For example antMatcher() doesn't exist anymore. I found out that there is requestMatchers() within authorizeHttpRequests() but then access() doesn't accept string. And also I don't know where I should put oauth2ResourceServer() and jwt().</p>\n<p>The following is my current code which doesn't work because antMatcher() does not exist anymore:</p>\n<pre class=\"lang-java prettyprint-override\"><code>import org.springframework.beans.factory.annotation.Value;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configuration.WebSecurityCustomizer;\nimport org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.security.oauth2.jwt.Jwt;\nimport org.springframework.security.web.SecurityFilterChain;\n\n@Configuration\n@EnableWebSecurity\npublic class ResourceServerConfig {\n\n    @Bean\n    SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n        http\n                .csrf(AbstractHttpConfigurer::disable)\n                .antMatcher(&quot;/**&quot;) // &lt;----- the method no longer exists\n                .authorizeRequests().anyRequest()\n                .access(&quot;@webSecurityAccess.hasAccess(authentication)&quot;)\n                .and()\n                .oauth2ResourceServer()\n                .jwt();\n        return http.build();\n    }\n\n    @Bean\n    WebSecurityAccess webSecurityAccess() {\n        return new WebSecurityAccess();\n    }\n\n    @Bean\n    WebSecurityCustomizer webSecurityCustomizer() {\n        return (web) -&gt; web.ignoring().requestMatchers(&quot;/**/actuator/health&quot;);\n    }\n\n\n    public static class WebSecurityAccess {\n\n        @Value(&quot;${om.test.app.client-id}&quot;)\n        private String omTestAppClientId;\n\n        public boolean hasAccess(Authentication authentication) {\n            return authentication.isAuthenticated() &amp;&amp; authentication.getPrincipal() instanceof Jwt\n                    &amp;&amp; omTestAppClientId.equals(((Jwt) authentication.getPrincipal()).getClaims().get(&quot;clientId&quot;));\n        }\n    }\n\n}\n</code></pre>\n<p>How I should fix this problem with antMatcher() and access()? Or are there any good tutorials?</p>\n",
    "tags" : [ "java", "spring-boot", "spring-security" ],
    "owner" : {
      "account_id" : 83131,
      "reputation" : 9085,
      "user_id" : 233286,
      "user_type" : "registered",
      "accept_rate" : 73,
      "profile_image" : "https://i.sstatic.net/0ivuN.jpg?s=256",
      "display_name" : "ilhan",
      "link" : "https://stackoverflow.com/users/233286/ilhan"
    },
    "is_answered" : false,
    "view_count" : 129,
    "answer_count" : 1,
    "score" : -1,
    "last_activity_date" : 1743996732,
    "creation_date" : 1743504130,
    "link" : "https://stackoverflow.com/questions/79548394/error-cannot-find-symbol-antmatcher",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79552454,
    "question_id" : 79548394,
    "body" : "<p>Although there is no <em>good</em> tutorial, I have made usable examples with OAuth for you to consider. I have tried all the steps described below.</p>\n<p>Part 1: <em>Change .antMatcher</em></p>\n<pre class=\"lang-java prettyprint-override\"><code>.antMatcher(&quot;/**&quot;) // &lt;----- the method no longer exists\n</code></pre>\n<p><a href=\"https://github.com/Hdvlp/SpringBootSecurityFilterChainMigration/blob/main/src/main/java/com/securityfilterchainmigration/demo/config/ResourceServerConfig.java\" rel=\"nofollow noreferrer\">The repository is here</a>. I have tested the code, and I logged in via <a href=\"https://github.com/settings/developers\" rel=\"nofollow noreferrer\">OAuth Apps</a>.</p>\n<p>To try the application, you need</p>\n<pre><code>git clone https://github.com/Hdvlp/SpringBootSecurityFilterChainMigration.git\n</code></pre>\n<p>and <em>other</em> steps in developing a Spring Boot application. (not a complete tutorial here)</p>\n<p>To create your <a href=\"https://github.com/settings/developers\" rel=\"nofollow noreferrer\">OAuth Apps</a>, you need these:</p>\n<p>Fill in:</p>\n<p><em>Your</em> client-id and client-secret in <a href=\"https://github.com/Hdvlp/SpringBootSecurityFilterChainMigration/blob/main/src/main/resources/application.yml\" rel=\"nofollow noreferrer\">application.yml</a>.</p>\n<p>Homepage URL:</p>\n<p><a href=\"http://127.0.0.1:8080\" rel=\"nofollow noreferrer\">http://127.0.0.1:8080</a></p>\n<p>Authorization callback URL:</p>\n<p><a href=\"http://127.0.0.1:8080/login/oauth2/code/github\" rel=\"nofollow noreferrer\">http://127.0.0.1:8080/login/oauth2/code/github</a></p>\n<p>After running the Spring Boot application locally, open in the browser:</p>\n<p><a href=\"http://127.0.0.1:8080\" rel=\"nofollow noreferrer\">http://127.0.0.1:8080</a></p>\n<p>You may try <a href=\"https://github.com/Hdvlp/SpringBootSecurityFilterChainMigration/blob/main/src/main/java/com/securityfilterchainmigration/demo/controller/WebController.java\" rel=\"nofollow noreferrer\">other paths</a> in the browser to see the effect before and after logging in, e.g.</p>\n<p><a href=\"http://127.0.0.1:8080/member/area\" rel=\"nofollow noreferrer\">http://127.0.0.1:8080/member/area</a></p>\n<p><a href=\"http://127.0.0.1:8080/actuator/health/servicea\" rel=\"nofollow noreferrer\">http://127.0.0.1:8080/actuator/health/servicea</a></p>\n<p>As illustrated below, you need to decide what paths are in what order.</p>\n<p>This is what I tried: The logic of evaluation is like...</p>\n<p>The @Order which is smaller in number wins. The path matching <code>matchedPaths</code> wins.</p>\n<p>If you have two @Order annotations with the same <code>matchedPaths</code>, and one @Order contains a smaller value, the latter wins. (The <code>SecurityFilterChain</code> with the larger @Order annotation produces no effect.) You can try different values of @Order annotations to verify this.</p>\n<p>If you have two <code>SecurityFilterChain</code>s with <em>different</em> <code>matchedPaths</code>, and one of these <code>SecurityFilterChain</code>s is marked with an @Order(100) annotation, and the other one with an @Order(200) annotation, both <code>SecurityFilterChain</code>s are valid and work when matching the <code>matchedPaths</code> respectively.</p>\n<p>As far as I tried, matching <code>&quot;/actuator/health/**&quot;</code> left prefix works, whereas matching <code>&quot;/**/actuator/health&quot;</code> right suffix does <em>not</em> work (easily). You may need to change your paths accordingly.</p>\n<pre class=\"lang-java prettyprint-override\"><code>    @Bean\n    @Order(400)\n    SecurityFilterChain securityFilterChainPermitAll(HttpSecurity http) throws Exception {\n        String[] matchedPaths = { &quot;/permit&quot;, &quot;/permit/**&quot; };\n        http\n            .csrf(AbstractHttpConfigurer::disable)\n            .securityMatcher(matchedPaths)\n            .authorizeHttpRequests(\n                auth -&gt; \n                    auth\n                        .requestMatchers(matchedPaths)\n                        .permitAll()\n            );\n\n        return http.build();\n    }\n\n    @Bean\n    @Order(500)\n    SecurityFilterChain securityFilterChainActuator(HttpSecurity http) throws Exception {\n        String[] matchedPaths = { &quot;/actuator/health/**&quot; };\n        http\n            .csrf(AbstractHttpConfigurer::disable)\n            .securityMatcher(matchedPaths)\n            .authorizeHttpRequests(\n                auth -&gt; \n                    auth\n                        .requestMatchers(matchedPaths)\n                        .permitAll()\n            );\n\n        return http.build();\n    }\n</code></pre>\n<p>Using @Order(500) with three digits is a <em>nice</em> thing to do because when you need to insert another <code>SecurityFilterChain</code> before this one, you can use @Order(499). You can insert another <code>SecurityFilterChain</code> below this one by adding a <code>SecurityFilterChain</code> marked with @Order(501). To keep the same order you would have to change many numbers if the annotations were @Order(1), @Order(2), @Order(3), @Order(4), @Order(5)... Using three digits will save you some time.</p>\n<p>Part 2: <em>Change .jwt()</em></p>\n<p>An example is <a href=\"https://github.com/Hdvlp/SpringBootSecurityFilterChainMigration/blob/b392477af065c5d47f50b3dcdca0836380c43a87/src/main/java/com/securityfilterchainmigration/demo/config/OAuth2AuthenticationSuccessHandler.java#L35\" rel=\"nofollow noreferrer\">here</a>.</p>\n<pre class=\"lang-java prettyprint-override\"><code>                // Add custom claims to the JWT token:\n\n                ObjectMapper objectMapper = new ObjectMapper();\n                Nutrition nutrition = new Nutrition();\n                String nutritionJson = objectMapper.writeValueAsString(nutrition);\n\n                Personalities personalities = new Personalities();\n                String personalitiesJson = objectMapper.writeValueAsString(personalities);\n\n\n                Map.Entry&lt;String, Object&gt; nutritionMap = Map.entry(\n                    &quot;nutrition&quot;, \n                    nutritionJson);\n                Map.Entry&lt;String, Object&gt; personalitiesMap = Map.entry(\n                    &quot;personalities&quot;, \n                    personalitiesJson);\n                String jwt = JwtUtils.generate(\n                    JwtConfig.getJwtClaimSubject(), \n                    JwtConfig.getJwtClaimIssuer(), \n                    JwtConfig.getJwtExpiryTimeMilliseconds(),\n                    Map.ofEntries(nutritionMap, personalitiesMap));\n</code></pre>\n<p>I would like to add two objects to JWT. One is <code>Nutrition</code> and the other one is <code>Personalities</code>.</p>\n<p>The <code>Nutrition</code> object is <a href=\"https://github.com/Hdvlp/SpringBootSecurityFilterChainMigration/blob/main/src/main/java/com/securityfilterchainmigration/demo/config/objects/Nutrition.java\" rel=\"nofollow noreferrer\">here</a>.</p>\n<pre><code>public class Nutrition {\n    public String[] nutrition = new String[]{&quot;vitamin A&quot;, &quot;carbohydrate&quot;};\n    public String toString(){\n        return String.join(&quot;|&quot;, nutrition);\n    }\n}\n</code></pre>\n<p>The <code>Personalities</code> object is <a href=\"https://github.com/Hdvlp/SpringBootSecurityFilterChainMigration/blob/main/src/main/java/com/securityfilterchainmigration/demo/config/objects/Personalities.java\" rel=\"nofollow noreferrer\">here</a>.</p>\n<pre><code>public class Personalities {\n    public String[] personalities = new String[]{&quot;active&quot;, &quot;outgoing&quot;};\n    public String toString(){\n        return String.join(&quot;|&quot;, personalities);\n    }\n}\n</code></pre>\n<p>To read the JWT, an example is <a href=\"https://github.com/Hdvlp/SpringBootSecurityFilterChainMigration/blob/b13526322db49f9506cba56acda40491196a1268/src/main/java/com/securityfilterchainmigration/demo/config/JwtUtils.java#L58C1-L88C31\" rel=\"nofollow noreferrer\">here</a>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>        try{\n\n            SignedJWT signedJWT = SignedJWT.parse(token);\n            JWTClaimsSet claimSet = signedJWT.getJWTClaimsSet();\n            String subjectClaim = claimSet.getStringClaim(&quot;sub&quot;);\n\n            ObjectMapper objectMapper = new ObjectMapper();\n\n            String nutritionJson = signedJWT.getJWTClaimsSet().getStringClaim(&quot;nutrition&quot;);\n            Nutrition nutrition = objectMapper.readValue(nutritionJson, Nutrition.class);\n\n            String personalitiesJson = signedJWT.getJWTClaimsSet().getStringClaim(&quot;personalities&quot;);\n            Personalities personalities = objectMapper.readValue(personalitiesJson, Personalities.class);\n            \n            if (Objects.equals(subjectClaim, null)){\n                return;\n            }\n            if (Objects.equals(nutrition.toString(), null)){\n                return;\n            }\n            if (Objects.equals(personalities.toString(), null)){\n                return;\n            }\n  \n            System.out.println(&quot;What claims are in JWT?&quot;);\n\n            System.out.println(subjectClaim);\n            System.out.println(nutrition.toString());\n            System.out.println(personalities.toString());\n\n        }catch (Exception e){}\n</code></pre>\n<p>Part 3: <em>Change access() because access() doesn't accept string</em></p>\n<p>In my <a href=\"https://github.com/Hdvlp/SpringBootSecurityFilterChainMigration/blob/main/src/main/java/com/securityfilterchainmigration/demo/config/JwtAuthenticationFilter.java\" rel=\"nofollow noreferrer\">example</a>, I handle this in a class.</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Configuration\npublic class JwtAuthenticationFilter extends OncePerRequestFilter {\n    // Notes: \n    //\n    // OncePerRequestFilter:\n    //     Filter base class that aims to guarantee a single execution per request dispatch, \n    //     on any servlet container. \n    //     It provides a doFilterInternal(jakarta.servlet.http.HttpServletRequest, \n    //     jakarta.servlet.http.HttpServletResponse, jakarta.servlet.FilterChain) method  \n    //     with HttpServletRequest and HttpServletResponse arguments.\n    //     https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/filter/OncePerRequestFilter.html\n\n</code></pre>\n<p>I think that my examples above partially help you start over. Perhaps, starting over is an easier way than modifying a few lines.</p>\n<p>In all the files, please see my code and my comments with //, which may help you know how the code works and you may know what the code is doing.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 41072977,
      "reputation" : 96,
      "user_id" : 30106291,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/LRapA3Kd.jpg?s=256",
      "display_name" : "Hdvlp",
      "link" : "https://stackoverflow.com/users/30106291/hdvlp"
    },
    "creation_date" : 1743670877,
    "last_activity_date" : 1743996732,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140286532,
    "post_id" : 79548394,
    "body" : "Correction to my previous comment, this specific change is covered under <a href=\"https://docs.spring.io/spring-security/reference/5.8/migration/servlet/config.html\" rel=\"nofollow noreferrer\">configuration</a> (section <i>&quot;Use the new <code>requestMatchers</code> methods&quot;</i>).",
    "score" : 2,
    "owner" : {
      "account_id" : 213468,
      "reputation" : 110282,
      "user_id" : 466862,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d873f397779db38cd510d9ee5416fd43?s=256&d=identicon&r=PG",
      "display_name" : "Mark Rotteveel",
      "link" : "https://stackoverflow.com/users/466862/mark-rotteveel"
    },
    "creation_date" : 1743505959,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140286519,
    "post_id" : 79548394,
    "body" : "<code>are there any good tutorials</code> no but there are docs",
    "score" : 3,
    "owner" : {
      "account_id" : 2064278,
      "reputation" : 15073,
      "user_id" : 1840146,
      "user_type" : "registered",
      "accept_rate" : 86,
      "profile_image" : "https://i.sstatic.net/JXdxm.png?s=256",
      "display_name" : "Toerktumlare",
      "link" : "https://stackoverflow.com/users/1840146/toerktumlare"
    },
    "creation_date" : 1743505699,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140286504,
    "post_id" : 79548394,
    "body" : "This is covered by <a href=\"https://docs.spring.io/spring-boot/upgrading.html\" rel=\"nofollow noreferrer\">Upgrading Spring Boot</a>, which links the <a href=\"https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Migration-Guide\" rel=\"nofollow noreferrer\">Spring Boot 3.0 Migration Guide</a>, which links the <a href=\"https://docs.spring.io/spring-security/reference/5.8/migration/index.html\" rel=\"nofollow noreferrer\">Spring Security - Preparing for 6.0</a>, and from there you need the Servlet section on <a href=\"https://docs.spring.io/spring-security/reference/5.8/migration/servlet/authorization.html\" rel=\"nofollow noreferrer\">authorization</a>.",
    "score" : 2,
    "owner" : {
      "account_id" : 213468,
      "reputation" : 110282,
      "user_id" : 466862,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d873f397779db38cd510d9ee5416fd43?s=256&d=identicon&r=PG",
      "display_name" : "Mark Rotteveel",
      "link" : "https://stackoverflow.com/users/466862/mark-rotteveel"
    },
    "creation_date" : 1743505538,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}