{
  "question" : {
    "question_id" : 79673125,
    "title" : "Jpa lazy loading on a detached field doesn&#39;t throw LazyInitializationException",
    "body" : "<p>As far as I read and heard lazy loading of a field on a detached entity is supposed to result in LazyInitializationException, but it doesn't happen.</p>\n<p>I have a User entity with a Lazy collection</p>\n<pre class=\"lang-java prettyprint-override\"><code>@OneToMany(mappedBy = &quot;user&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY)\nprivate List&lt;Vehicle&gt; vehicles;\n</code></pre>\n<p>and a Vehicle entity</p>\n<pre class=\"lang-java prettyprint-override\"><code>@ManyToOne(cascade = CascadeType.ALL)\n@JoinColumn(name = &quot;rf_user_id&quot;, referencedColumnName = &quot;user_id&quot;)\nprivate User user;\n</code></pre>\n<p>I have a class which extends CommandLineRunner and inside its run method does the following</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Override\n@Transactional\npublic void run(String... args) {\n  User user = userRepository.findById(1L).get();\n  myService.checkContext(user);\n}\n</code></pre>\n<p>And here what MyService.checkContext bean does</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Transactional(propagation = Propagation.REQUIRES_NEW)\npublic void checkContext(User_1toM user) {\n  Vehicle_Mto1 vehicle = user.getVehicles().get(0);\n}\n\n</code></pre>\n<p>As I understant, the &quot;run-method transaction&quot; has it's own persistence-context, and the &quot;checkContext-method transaction&quot; has it's own persistence-context, so I am supposed (as I understand) to get a <strong>LazyInitializationException</strong> on getting the '<em>lazy vehicle</em>' but I don't.</p>\n<p>*SQL log shows that Hibernate is doing a select to fetch Vehicle data.</p>\n<pre class=\"lang-sql prettyprint-override\"><code>select vm1_0.rf_user_id,vm1_0.vehicle_id,vm1_0.model from vehicle vm1_0 where vm1_0.rf_user_id=?*\n</code></pre>\n<p>Am I missing something? Trying to grasp Hibernate but I'm kinda very confused on that one.</p>\n<p><strong>P.S.</strong> In checkContext method I tried to do -Hibernate.isInitialized(user.getVehicles()) shows False,\nentityManager.contains(user) is also False (so it's really in Detached state)</p>\n<p><strong>P.S.S.</strong> only removing Transactional over 'run' does result in a LazyInitializationException in 'checkContext' when getting a Vehicle.</p>\n",
    "tags" : [ "java", "spring", "hibernate", "jpa" ],
    "owner" : {
      "account_id" : 16554318,
      "reputation" : 47,
      "user_id" : 12026176,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AAuE7mBZfWFG_ERubZIVgIYXC6w3VLKYcJPKfix0rthx=k-s256",
      "display_name" : "Amazonian pet",
      "link" : "https://stackoverflow.com/users/12026176/amazonian-pet"
    },
    "is_answered" : false,
    "view_count" : 70,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1750411253,
    "creation_date" : 1750410699,
    "link" : "https://stackoverflow.com/questions/79673125/jpa-lazy-loading-on-a-detached-field-doesnt-throw-lazyinitializationexception",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140552180,
    "post_id" : 79673125,
    "body" : "They are isolated but the context isn&#39;t closed it is still open and thus able to fetch resources.",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126800,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1751262795,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140544326,
    "post_id" : 79673125,
    "body" : "@M.Deinum Do they overlap eachother then? I thought that they are supposed to be isolated from one another (like - one persistent context is not aware of the other, because of two entirely different transactions). Could you please share a resource on that if so?",
    "score" : 0,
    "owner" : {
      "account_id" : 16554318,
      "reputation" : 47,
      "user_id" : 12026176,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AAuE7mBZfWFG_ERubZIVgIYXC6w3VLKYcJPKfix0rthx=k-s256",
      "display_name" : "Amazonian pet",
      "link" : "https://stackoverflow.com/users/12026176/amazonian-pet"
    },
    "creation_date" : 1750943532,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140539161,
    "post_id" : 79673125,
    "body" : "Yes but that isn&#39;t being closed the one with the enclosing tx is still active.",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126800,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1750789545,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140538684,
    "post_id" : 79673125,
    "body" : "@M.Deinum But isn&#39;t each transaction context has its own persistence context(where entites are managed, first-level-cache for that transaction is located)?",
    "score" : 0,
    "owner" : {
      "account_id" : 16554318,
      "reputation" : 47,
      "user_id" : 12026176,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AAuE7mBZfWFG_ERubZIVgIYXC6w3VLKYcJPKfix0rthx=k-s256",
      "display_name" : "Amazonian pet",
      "link" : "https://stackoverflow.com/users/12026176/amazonian-pet"
    },
    "creation_date" : 1750777454,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140534120,
    "post_id" : 79673125,
    "body" : "No you have 2 contexts, both are still open (the tx is suspended but the persistence context doesn&#39;t close) so that is perfectly fine still going to retrieve things. Now if your <code>run</code> method wouldn&#39;t be <code>@Transactional</code> you would get errors as after the find the tx would be finished and the persistence context closed.",
    "score" : 1,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126800,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1750658416,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140529622,
    "post_id" : 79673125,
    "body" : "It means you are still in the transaction. Check where is your transaction boundary.",
    "score" : 0,
    "owner" : {
      "account_id" : 4688171,
      "reputation" : 11611,
      "user_id" : 3795036,
      "user_type" : "registered",
      "accept_rate" : 88,
      "profile_image" : "https://i.sstatic.net/eM2E2.png?s=256",
      "display_name" : "K.Nicholas",
      "link" : "https://stackoverflow.com/users/3795036/k-nicholas"
    },
    "creation_date" : 1750425685,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}