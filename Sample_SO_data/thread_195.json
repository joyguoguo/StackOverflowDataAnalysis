{
  "question" : {
    "question_id" : 79827774,
    "title" : "Inconsistent behavior of DELETE_ON_CLOSE between platforms",
    "body" : "<p>Let's run this straightforward piece of code:</p>\n<pre><code>import java.io.*;\nimport java.nio.file.*;\nimport java.util.Arrays;\n\npublic class Main {\n\n    public static void main(String[] args) throws IOException {\n        Path path = Files.createTempFile(null, null);\n        byte[] array = &quot;test&quot;.getBytes();\n        Files.write(path, array);\n        System.err.println(&quot;1 File.length = &quot; + path.toFile().length());\n        System.err.println(&quot;1 Files.size = &quot; + Files.size(path));\n        try (InputStream in = Files.newInputStream(path, StandardOpenOption.DELETE_ON_CLOSE)) {\n            System.err.println(&quot;2 File.length = &quot; + path.toFile().length());\n            System.err.println(&quot;2 Files.size = &quot; + Files.size(path));\n            byte[] buf = new byte[array.length];\n            in.read(buf, 0, array.length);\n            if (Arrays.equals(array, buf)) {\n                System.err.println(&quot;Read OK&quot;);\n            }\n        } finally {\n            if (Files.deleteIfExists(path)) {\n                System.err.println(&quot;Deleted&quot;);\n            }\n        }\n    }\n}\n\n</code></pre>\n<p>Output on Windows:</p>\n<pre><code>1 File.length = 4\n1 Files.size = 4\n2 File.length = 4\n2 Files.size = 4\nRead OK\n</code></pre>\n<p>Output on Linux:</p>\n<pre><code>1 File.length = 4\n1 Files.size = 4\n2 File.length = 0\nException in thread &quot;main&quot; java.nio.file.NoSuchFileException: /tmp/1848835007433869473.tmp\n    at sun.nio.fs.UnixException.translateToIOException(UnixException.java:86)\n    at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)\n    at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)\n    at sun.nio.fs.UnixFileAttributeViews$Basic.readAttributes(UnixFileAttributeViews.java:55)\n    at sun.nio.fs.UnixFileSystemProvider.readAttributes(UnixFileSystemProvider.java:144)\n    at sun.nio.fs.LinuxFileSystemProvider.readAttributes(LinuxFileSystemProvider.java:99)\n    at java.nio.file.Files.readAttributes(Files.java:1737)\n    at java.nio.file.Files.size(Files.java:2332)\n    at Main.main(Main.java:15)\n</code></pre>\n<p>Tested with JDK 8, 17 and 25.</p>\n<p>Without <code>StandardOpenOption.DELETE_ON_CLOSE</code> the program works consistently on the two platforms producing the Windows output.</p>\n<p><a href=\"https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/nio/file/StandardOpenOption.html#DELETE_ON_CLOSE\" rel=\"nofollow noreferrer\">Javadoc for DELETE_ON_CLOSE</a> starts by saying this:</p>\n<blockquote>\n<p>When this option is present then the implementation makes a <em>best effort</em> attempt to delete the file when closed by the appropriate <code>close</code> method.</p>\n</blockquote>\n<p>but, as you can see, no <code>close</code> method has been called at all.</p>\n",
    "tags" : [ "java", "linux", "windows", "delete-file" ],
    "owner" : {
      "account_id" : 3949403,
      "reputation" : 1203,
      "user_id" : 3260495,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/7a50dbacc6549ee2a3f0c7751122faf6?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Robert Hume",
      "link" : "https://stackoverflow.com/users/3260495/robert-hume"
    },
    "is_answered" : true,
    "view_count" : 119,
    "closed_date" : 1763982369,
    "answer_count" : 1,
    "score" : 3,
    "last_activity_date" : 1763905500,
    "creation_date" : 1763887859,
    "link" : "https://stackoverflow.com/questions/79827774/inconsistent-behavior-of-delete-on-close-between-platforms",
    "closed_reason" : "Duplicate"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}