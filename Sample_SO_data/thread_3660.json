{
  "question" : {
    "question_id" : 79533562,
    "title" : "Which ThreadPoolTaskExecutor bean is autowired when multiple Executors exist in Spring configuration?",
    "body" : "<p>I'm configuring multiple <code>ThreadPoolTaskExecutor</code> in Spring and encountering ambiguity in bean autowiring. I need help understanding the injection behavior.</p>\n<p>Configuration class:</p>\n<pre><code>@Configuration\n@EnableAsync\npublic class ThreadPoolConfig implements AsyncConfigurer {\n    public static final String COMMON_EXECUTOR = &quot;commonExecutor&quot;;\n    public static final String TEST_EXECUTOR = &quot;testExecutor&quot;;\n\n    @Override\n    public Executor getAsyncExecutor() {\n        return commonExecutor();\n    }\n\n    @Primary\n    @Bean(COMMON_EXECUTOR)\n    public ThreadPoolTaskExecutor commonExecutor() {\n        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();\n        // Configuration details...\n        return executor;\n    }\n\n    @Bean(TEST_EXECUTOR)\n    public ThreadPoolTaskExecutor testExecutor() {\n        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();\n        // Different configuration...\n        return executor;\n    }\n}\n</code></pre>\n<p>Service class:</p>\n<pre><code>@Slf4j\n@Service\n@RequiredArgsConstructor\npublic class WareVarietyServiceImpl implements WareVarietyService {\n    private final ThreadPoolTaskExecutor testExecutor;\n}\n</code></pre>\n<p>There are two <code>ThreadPoolTaskExecutor</code> beans defined: <code>commonExecutor</code> (marked with <code>@Primary</code>) and <code>testExecutor</code>. When autowiring <code>testExecutor</code> in the service class:</p>\n<p>Expected: Injection of the <code>testExecutor</code> bean specifically.</p>\n<p>Actual: Injection of the <code>commonExecutor</code> bean specifically.</p>\n",
    "tags" : [ "java", "spring", "autowired" ],
    "owner" : {
      "account_id" : 22282157,
      "reputation" : 21,
      "user_id" : 16510402,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/82d04bb2ff2bbdff15477a0ab6e1f7fa?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "一生热爱",
      "link" : "https://stackoverflow.com/users/16510402/%e4%b8%80%e7%94%9f%e7%83%ad%e7%88%b1"
    },
    "is_answered" : false,
    "view_count" : 80,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1743847863,
    "creation_date" : 1742903087,
    "link" : "https://stackoverflow.com/questions/79533562/which-threadpooltaskexecutor-bean-is-autowired-when-multiple-executors-exist-in",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79533692,
    "question_id" : 79533562,
    "body" : "<p>the <code>@Primary</code> executor bean is going to be injected.</p>\n<p>If you were to remove <code>@Primary</code> then it will try to match by bean name (default bean name is the method name = <code>testExecutor</code>) and for that to work you would need to use <code>@Qualifier(&quot;testExecutor&quot;)</code>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class WareVarietyServiceImpl implements WareVarietyService {\n    @Autowired \n    @Qualfier(&quot;testExecutor&quot;)\n    private ThreadPoolTaskExecutor testExecutor;\n}\n</code></pre>\n<p>Without <code>@Qualfier</code> it will throw an exception because 2 beans of same type are defined without <code>@Primary</code> or <code>@Qualifier</code> annotations present</p>\n<p>See <a href=\"https://docs.spring.io/spring-framework/reference/core/beans/annotation-config/autowired-primary.html\" rel=\"nofollow noreferrer\">relevant documentation</a></p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 16657879,
      "reputation" : 4340,
      "user_id" : 12038714,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AAuE7mAgRe8u2G_kzJJ-KZ2yZwAD1E4kxs9eRlqnY45BUw=k-s256",
      "display_name" : "asgarov1",
      "link" : "https://stackoverflow.com/users/12038714/asgarov1"
    },
    "creation_date" : 1742906249,
    "last_activity_date" : 1742906575,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79534028,
    "question_id" : 79533562,
    "body" : "<p>Spring offers different ways of injecting dependencies. Some examples are <code>@Autowired</code>, <code>@Inject</code>, and <code>@Resource</code>, where each annotation provides a different wiring mechanism. In your case, you should first understand which annotation is applied implicitly under the hood.</p>\n<p>Since Spring 4.3, when a class provides a single constructor, this is automatically annotated with <code>@Autowired</code>. Quoting an extract from the Spring docs <a href=\"https://docs.spring.io/spring-framework/reference/core/beans/annotation-config/autowired.html\" rel=\"nofollow noreferrer\">Using @Autowired</a>:</p>\n<blockquote>\n<p>As of Spring Framework 4.3, an @Autowired annotation on such a constructor is no longer necessary if the target bean defines only one constructor to begin with. However, if several constructors are available and there is no primary/default constructor, at least one of the constructors must be annotated with @Autowired in order to instruct the container which one to use.</p>\n</blockquote>\n<p>In your case, since <code>WareVarietyServiceImpl</code> offers only a single constructor due to Lombok's <code>@RequiredArgsConstructor</code>, Spring automatically applies the annotation <code>@Autowired</code> to it. Therefore, your class is equivalent to:</p>\n<pre><code>@Slf4j\n@Service\npublic class WareVarietyServiceImpl implements WareVarietyService {\n    private final ThreadPoolTaskExecutor testExecutor;\n\n    @Autowired\n    public WareVarietyServiceImpl(ThreadPoolTaskExecutor testExecutor) {\n        this.testExecutor = testExecutor;\n    }\n}\n</code></pre>\n<p>Now that we know which autowiring mechanism is used, we can break down what actually happens. <code>@Autowired</code> injects dependencies by type; therefore, both beans <code>commonExecutor</code> and <code>testExecutor</code> are valid candidates to be injected into <code>WareVarietyServiceImpl</code>.</p>\n<p>However, in your code, you're also using  <code>@Primary</code> to annotate the bean definition <code>commonExecutor</code>. This annotation basically marks a bean as the one to favorite when concurring for injection with other candidates. Quoting the <a href=\"https://docs.spring.io/spring-framework/reference/core/beans/annotation-config/autowired-primary.html\" rel=\"nofollow noreferrer\">docs</a>:</p>\n<blockquote>\n<p>@Primary indicates that a particular bean should be given preference when multiple beans are candidates to be autowired to a single-valued dependency. If exactly one primary bean exists among the candidates, it becomes the autowired value.</p>\n</blockquote>\n<p>This explains why <code>commonExecutor</code> is injected, even though <code>WareVarietyServiceImpl</code>'s field shares the same name of the bean definition <code>testExecutor</code>. If you want <code>WareVarietyServiceImpl</code> to be injected with <code>testExecutor</code>, either use <a href=\"https://docs.spring.io/spring-framework/reference/core/beans/annotation-config/resource.html#page-title\" rel=\"nofollow noreferrer\"><code>@Resource</code></a> which matches by name first and by type second, or <a href=\"https://docs.spring.io/spring-framework/reference/core/beans/annotation-config/autowired-qualifiers.html\" rel=\"nofollow noreferrer\"><code>@Qualifier</code></a> which narrows down a set of type matches by a qualifying value. If no qualifying value is provided to a bean definition, the bean's name is used as a default qualifier.</p>\n<h3>@Resource Solution</h3>\n<pre><code>@Slf4j\n@Service\n@RequiredArgsConstructor\npublic class WareVarietyServiceImpl implements WareVarietyService {\n    @Resource\n    private final ThreadPoolTaskExecutor testExecutor;\n}\n</code></pre>\n<h3>@Qualifier Solution</h3>\n<pre><code>@Slf4j\n@Service\npublic class WareVarietyServiceImpl implements WareVarietyService {\n    private final ThreadPoolTaskExecutor testExecutor;\n\n    @Autowired\n    public WareVarietyServiceImpl(@Qualifier(ThreadPoolConfig.TEST_EXECUTOR) ThreadPoolTaskExecutor testExecutor) {\n        this.testExecutor = testExecutor;\n    }\n}\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 5569841,
      "reputation" : 8664,
      "user_id" : 4415625,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0ea1713807527aa1cf52e40579e35ec4?s=256&d=identicon&r=PG",
      "display_name" : "dani-vta",
      "link" : "https://stackoverflow.com/users/4415625/dani-vta"
    },
    "creation_date" : 1742913996,
    "last_activity_date" : 1743847863,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}