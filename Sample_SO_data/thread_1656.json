{
  "question" : {
    "question_id" : 79687463,
    "title" : "How does spring kafka batch listener work?",
    "body" : "<p>I have a little question about spring kafka batch listener work. As I know, if we set this property</p>\n<pre><code>factory.setBatchListener(true);\n</code></pre>\n<p>Then we will be able to consume message batches. But will we be able to still consume messages one by one? Recently we had a problem on our project - our kafka listener stopped consuming messages, we tried to restart our pods in k8s, but nothing helped. It was a batch listener. I checked <code>max.poll.records</code> property and it was set to 200, as I saw - there were barely 4 messages in the topic in test env, so my guess was that because we don't have enough messages - our consumer is not consuming and waiting for 200 messages. I set <code>setBatchListener</code> to false, after this we've faced with deserialization problem after which I set it back to true and reduced <code>max.poll.records</code> to 1 and it started to work. Now I set this property to 250 and it is still working but as I saw there are pretty much messages coming to our topic now in test env.</p>\n<p>So is it possible that the problem was related to batch listener or maybe something else? Will batch listener consume messages one by one if there are not much of them or still will wait for bigger batch size?</p>\n",
    "tags" : [ "java", "apache-kafka", "spring-kafka" ],
    "owner" : {
      "account_id" : 23090602,
      "reputation" : 366,
      "user_id" : 18073200,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d221ed174f855f0377335079c5121b61?s=256&d=identicon&r=PG",
      "display_name" : "denstran",
      "link" : "https://stackoverflow.com/users/18073200/denstran"
    },
    "is_answered" : true,
    "view_count" : 144,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1751644242,
    "creation_date" : 1751461343,
    "link" : "https://stackoverflow.com/questions/79687463/how-does-spring-kafka-batch-listener-work",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79688092,
    "question_id" : 79687463,
    "body" : "<p>Most likely the issue is not connected with batch listener.<br />\nKafkaListener heavily rely on kafka-clients lib, and, KafkaConsumer created only once for your listener (by default).</p>\n<p>In other words, all &quot;batching&quot; technique depends only on KafkaConsumer object and its behavior which kafka-clients and kafka itself gives to him.<br />\nPolling is being done in a container thread. You can see source code <a href=\"https://github.com/spring-projects/spring-kafka/blob/main/spring-kafka/src/main/java/org/springframework/kafka/listener/KafkaMessageListenerContainer.java#L1456\" rel=\"nofollow noreferrer\">here</a>.</p>\n<p>Spring &quot;batch&quot; listener just gives you another method signature (in your case), that's it.Batch listener is expected to catch single messages from container -&gt; consumer.</p>\n<p>PS: I had a project on spring kafka 3.0.7 but I updated it to 3.3.7 and checked the behavior on both.<br />\nI don't know which versions you're using, because there is even a 4.0.0 which utilizes kafka-clients 4.0.0 but as far as i know boot doesn't support it yet.</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 20850387,
      "reputation" : 108,
      "user_id" : 15315053,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/1db5386ca04a80b976c5a77df9bcbe01?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Yan",
      "link" : "https://stackoverflow.com/users/15315053/yan"
    },
    "creation_date" : 1751491348,
    "last_activity_date" : 1751491348,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79688092" : [ {
      "comment_id" : 140587683,
      "post_id" : 79688092,
      "body" : "Yep, just found problem, the reason that we have a few instances of the application, our topic has 20 partitions and 10 partitions are went to the first application and 0 partitions to another one. Now trying to figure it out",
      "score" : 0,
      "owner" : {
        "account_id" : 23090602,
        "reputation" : 366,
        "user_id" : 18073200,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/d221ed174f855f0377335079c5121b61?s=256&d=identicon&r=PG",
        "display_name" : "denstran",
        "link" : "https://stackoverflow.com/users/18073200/denstran"
      },
      "creation_date" : 1752486000,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}