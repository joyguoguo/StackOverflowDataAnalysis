{
  "question" : {
    "question_id" : 79563367,
    "title" : "Flatpak build missing Gtk .so dependencies",
    "body" : "<p>I have a Java project that uses Java-GI Gtk/Adw bindings. It uses the maven-flatpak-plugin to generate a .desktop, metainfo.xml and .yml manifest. Then I run flatpak-builder:</p>\n<pre><code>sudo flatpak-builder --force-clean --verbose --install build-dir ca.footeware.java.texty3.yml\n</code></pre>\n<p>...and it seems to install fine. Running it however, causes the error:</p>\n<pre><code>java.lang.UnsatisfiedLinkError: no libgtk-4.so.1 in java.library.path: :/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib\n</code></pre>\n<p>So the flatpak container was missing dependencies on the Gtk libraries, a dependency of Java-GI. I copied the .so files into the <em>/app/share</em> folder during install. I found <strong>libgtk-4.so.1</strong> on the host and copied it into the container using the yml manifest:</p>\n<pre><code>  - &quot;install -D libgtk-4.so.1 /app/share/libgtk-4.so.1&quot;\n  ...\n  - type: &quot;file&quot;\n    path: &quot;../../src/flatpak/lib/libgtk-4.so.1&quot;\n  ...\n  - &quot;--env=LD_LIBRARY_PATH=/app/share:/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib&quot;\n</code></pre>\n<p>Rebuilt and reinstalled and got a different error:</p>\n<pre><code>java.lang.UnsatisfiedLinkError: /app/share/libgtk-4.so.1: /app/share/libgtk-4.so.1: undefined symbol: pango_font_map_add_font_file\n</code></pre>\n<p>I think this indicates it found the gtk.so. I did a similar search for pango and found <strong>libpangocairo-1.0.so.0.5600.3</strong> and similarly copied it into <em>/app/share</em> and confirmed its presence. Rebuilt and reinstalled and got the same error. I read that the <code>pango_font_map_add_font_file</code> symbol was introduced in 1.55 and I verified that <strong>libpangocairo-1.0.so.0.5600.3</strong> is version 1.56.</p>\n<p>Two questions:</p>\n<ol>\n<li>Is this the best strategy? I feel like I'm reinstalling all the Gtk libraries. There must be a simpler way to meet the dependencies.</li>\n<li>If this is the correct thing to do, how do I make <strong>libgtk-4.so.1</strong> in <strong>/app/share</strong> see <strong>libpangocairo-1.0.so</strong> in the same folder?</li>\n</ol>\n",
    "tags" : [ "java", "c", "flatpak", "flatpak-builder" ],
    "owner" : {
      "account_id" : 2645778,
      "reputation" : 474,
      "user_id" : 2288506,
      "user_type" : "registered",
      "accept_rate" : 25,
      "profile_image" : "https://www.gravatar.com/avatar/0dff0ff19db0fbcba1cfa9cb5eb901f6?s=256&d=identicon&r=PG",
      "display_name" : "CraigFoote",
      "link" : "https://stackoverflow.com/users/2288506/craigfoote"
    },
    "is_answered" : true,
    "view_count" : 104,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1744203695,
    "creation_date" : 1744166739,
    "link" : "https://stackoverflow.com/questions/79563367/flatpak-build-missing-gtk-so-dependencies",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79564409,
    "question_id" : 79563367,
    "body" : "<p>Thanks to @bbhtt over on Flatpak Matrix. He said I should use org.gnome.Platform and org.gnome.Sdk rather than the freedesktop runtimes because they already have Gtk installed.</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 2645778,
      "reputation" : 474,
      "user_id" : 2288506,
      "user_type" : "registered",
      "accept_rate" : 25,
      "profile_image" : "https://www.gravatar.com/avatar/0dff0ff19db0fbcba1cfa9cb5eb901f6?s=256&d=identicon&r=PG",
      "display_name" : "CraigFoote",
      "link" : "https://stackoverflow.com/users/2288506/craigfoote"
    },
    "creation_date" : 1744203695,
    "last_activity_date" : 1744203695,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}