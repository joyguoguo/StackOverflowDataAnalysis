{
  "question" : {
    "question_id" : 79653598,
    "title" : "How to properly design a Flat entity extending Address in Spring Boot with Builder pattern?",
    "body" : "<p>I'm working on a Java Spring Boot application using JPA, where I have an Address base class and a Flat subclass representing apartment units.</p>\n<p>I use the Builder pattern to create Flat instances and have a factory to create Flats with validation.</p>\n<p>I also have a repository interface and a service layer. I wrote some tests using Spring Boot's TestRestTemplate.</p>\n<p>My questions are:</p>\n<p>Is my use of short as the data type for identifiers and numbers appropriate? Should I use int or Long instead for IDs like unitNumber and addressId?</p>\n<p>Is my Builder pattern implementation and how I extend Address in Flat good practice?</p>\n<p>Any suggestions to improve repository and service layer interfaces?</p>\n<p>Are there any common mistakes I should avoid in such a layered Spring Boot app design?</p>\n<p>Domain:</p>\n<pre><code>package za.ac.shinysneakerz.domain;\n\nimport jakarta.persistence.Entity;\nimport jakarta.persistence.Id;\n\n@Entity\npublic class Flat extends Address{\n\n    @Id\n    private short unitNumber;\n\n    private String flatName;\n\n    protected Flat() {\n        super();\n    }\n\n    private Flat(Builder builder) {\n        this.unitNumber = builder.unitNumber;\n        this.flatName = builder.flatName;\n\n        this.addressId = builder.addressId;\n        this.streetNumber = builder.streetNumber;\n        this.streetName = builder.streetName;\n        this.suburb = builder.suburb;\n        this.city = builder.city;\n        this.province = builder.province;\n        this.postalCode = builder.postalCode;\n    }\n\n    public short getUnitNumber() {\n        return unitNumber;\n    }\n    public String getFlatName() {\n        return flatName;\n    }\n\n    @Override\n    public String toString() {\n        return &quot;Flat{&quot; +\n                &quot;flatName='&quot; + flatName + '\\'' +\n                &quot;, unitNumber=&quot; + unitNumber +\n                '}';\n    }\n\n    public static class Builder{\n        private short unitNumber;\n        private String flatName;\n\n        private Long addressId;\n        private short streetNumber;\n        private String streetName;\n        private String suburb;\n        private String city;\n        private String province;\n        private short postalCode;\n\n        public Builder setUnitNumber ( short unitNumber){\n            this.unitNumber = unitNumber;\n            return this;\n        }\n\n        public Builder setFlatName (String flatName){\n            this.flatName = flatName;\n            return this;\n        }\n\n        public Builder setAddressId(Long addressId) {\n            this.addressId = addressId;\n            return this;\n        }\n\n        public Builder setSuburb(String suburb) {\n            this.suburb = suburb;\n            return this;\n        }\n\n        public Builder setCity(String city) {\n            this.city = city;\n            return this;\n        }\n\n        public Builder setPostalCode(short postalCode) {\n            this.postalCode = postalCode;\n            return this;\n        }\n\n        public Builder setProvince(String province) {\n            this.province = province;\n            return this;\n        }\n\n        public Builder setStreetName(String streetName) {\n            this.streetName = streetName;\n            return this;\n        }\n\n        public Builder setStreetNumber(short streetNumber) {\n            this.streetNumber = streetNumber;\n            return this;\n        }\n\n        public Builder copy(Flat flat){\n            this.unitNumber = flat.unitNumber;\n            this.flatName = flat.flatName;\n\n            this.addressId = flat.addressId;\n            this.streetNumber = flat.streetNumber;\n            this.streetName = flat.streetName;\n            this.suburb = flat.suburb;\n            this.city = flat.city;\n            this.province = flat.province;\n            this.postalCode = flat.postalCode;\n\n            return this;\n        }\n\n        public Flat build(){\n            return new Flat(this);\n        }\n\n        }\n\n}\n</code></pre>\n<p>Factory:</p>\n<pre><code>package za.ac.shinysneakerz.factory;\n\nimport za.ac.shinysneakerz.domain.Flat;\nimport za.ac.shinysneakerz.util.Helper;\n\npublic class FlatFactory {\n\n    public static Flat createFlat(short unitNumber, String flatName, Long addressId, short streetNumber, String suburb, String city, String province, short postalCode) {\n\n        if(Helper.isNullOrEmpty(flatName)\n                || Helper.isValidPostalCode(postalCode)\n                || Helper.isValidStreetNumber(streetNumber)\n                || Helper.isValidUnitNumber(unitNumber)){\n            return null;\n        }\n\n            return new Flat.Builder()\n                    .setUnitNumber(unitNumber)\n                    .setFlatName(flatName)\n                    .setAddressId(addressId)\n                    .setSuburb(suburb)\n                    .setCity(city)\n                    .setProvince(province)\n                    .setPostalCode(postalCode)\n                    .build();\n\n    }\n}\n</code></pre>\n<p>Repository:</p>\n<pre><code>package za.ac.shinysneakerz.repository;\n\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.stereotype.Repository;\nimport za.ac.shinysneakerz.domain.Flat;\n\nimport java.util.Optional;\nimport java.util.Set;\n\n@Repository\npublic interface FlatRepository extends JpaRepository&lt;Flat, Short&gt; {\n\n    Set&lt;Flat&gt; getAll();\n\n    Optional&lt;Flat&gt; findByFlatName(String flatName);\n\n    Optional&lt;Flat&gt; findByStreetName(String streetName); //This are the address atts put them in flat too\n\n    //Optional&lt;Flat&gt; findByStreetNumber(Long streetNumber); //This are the address atts put them in flat too\n\n    //Optional&lt;Flat&gt; findByStreetNumber(long streetNumber);\n}\n</code></pre>\n<p>Flat Service:</p>\n<pre><code>package za.ac.shinysneakerz.service;\n\nimport za.ac.shinysneakerz.domain.Flat;\n\nimport java.util.Optional;\nimport java.util.Set;\n\npublic interface FlatService extends Service &lt;Flat,Short&gt;{\n    Set&lt;Flat&gt; getAll();\n\n    Optional&lt;Flat&gt; findByFlatName(String flatName);\n\n    Optional&lt;Flat&gt; findByStreetName(String streetName);\n}\n</code></pre>\n<p>Service Implementation:</p>\n<pre><code>package za.ac.shinysneakerz.service;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport za.ac.shinysneakerz.domain.Flat;\nimport za.ac.shinysneakerz.repository.FlatRepository;\n\nimport java.util.Optional;\nimport java.util.Set;\n\n@Service\npublic class FlatServiceImplementation implements FlatService {\n\n//    @Autowired\n//    private static FlatService service;\n\n    private FlatRepository repository;\n\n    @Autowired //Constructor injection\n    FlatServiceImplementation(FlatRepository repository) {\n        this.repository = repository;\n    }\n\n\n    @Override\n    public Set&lt;Flat&gt; getAll() {\n        return this.repository.getAll();\n        //return this.repository.findAll();\n    }\n\n    @Override\n    public Optional&lt;Flat&gt; findByFlatName(String flatName) {\n        return Optional.empty();\n    }\n\n    @Override\n    public Optional&lt;Flat&gt; findByStreetName(String streetName) {\n        return Optional.empty();\n    }\n\n    @Override\n    public Flat create(Flat flat) {\n        return this.repository.save(flat);\n    }\n\n    @Override\n    public Flat read(Short id) {\n        return this.repository.findById(id).orElse(null);\n    }\n\n    @Override\n    public Flat update(Flat flat) {\n        return this.repository.save(flat);\n    }\n\n    @Override\n    public void delete(Short id) {\n        this.repository.deleteById(id);\n    }\n\n\n}\n</code></pre>\n<p>Service interface:</p>\n<pre><code>package za.ac.shinysneakerz.service;\n\npublic interface Service &lt;T, ID&gt;{\n    //T create(ID id); //Naidoo uses T's here\n    T create(T t);\n\n    T read(ID id);\n\n    T update(T t);\n\n    //void delete(T t); //Naidoo uses ID's here\n    void delete(ID id);\n}\n</code></pre>\n<p>Controller Test:</p>\n<pre><code>package za.ac.shinysneakerz.controller;\n\nimport org.junit.jupiter.api.*;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.boot.test.web.client.TestRestTemplate;\nimport org.springframework.http.ResponseEntity;\nimport za.ac.shinysneakerz.domain.Flat;\nimport za.ac.shinysneakerz.factory.FlatFactory;\n\nimport static org.junit.jupiter.api.Assertions.*;\n\n//@SpringBootTest\n@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)\n@TestMethodOrder(MethodOrderer.OrderAnnotation.class)\nclass FlatControllerTest {\n\n    private static Flat flat;\n\n    @Autowired\n    private TestRestTemplate restTemplate;\n\n    private static final String baseUrl = &quot;http://localhost:8080/flat&quot;;\n    //private String baseUrl = &quot;http://localhost:8080/flat&quot;;\n\n    @BeforeAll\npublic static void setUp() {\n        flat = FlatFactory.createFlat((short) 23, &quot;Blake&quot;, 123456L, (short) 23, &quot;Bold&quot;, &quot;Cape&quot;, &quot;Some&quot;,(short) 45);\n    }\n\n    @Test\n    @Order(1)\n    void create() {\n        String url = baseUrl + &quot;/create&quot;;\n        System.out.println(&quot;Post data: &quot; + flat);\n        ResponseEntity&lt;Flat&gt; postResponse = restTemplate.postForEntity(url, flat, Flat.class);\n        System.out.println(&quot;Save data: &quot; + flat);\n        assertNotNull(postResponse.getBody());;\n    }\n\n    @Test\n    @Order(2)\n    void read() {\n        String url = baseUrl + &quot;/read&quot; + flat.getUnitNumber();\n        System.out.println(&quot;URL: &quot; + url);\n        ResponseEntity&lt;Flat&gt; postResponse = restTemplate.getForEntity(url, Flat.class);\n        assertNotNull(postResponse.getBody());\n    }\n\n    @Test\n    @Order(3)\n    void update() {\n        Flat updated = new Flat.Builder().copy(flat).setFlatName(&quot;Bloke&quot;).build();\n        String url = baseUrl + &quot;update&quot;;\n        System.out.println(&quot;Post data: &quot; + updated);\n        ResponseEntity&lt;Flat&gt; response = restTemplate.postForEntity(url, updated, Flat.class);\n        assertNotNull(response.getBody());\n    }\n\n    @Test\n    @Order(4)\n    void getAll() {\n        String url = baseUrl + &quot;All&quot;;\n        System.out.println(&quot;URL: &quot; + url);\n    }\n\n    @Test\n    @Order(5)\n    void delete() {\n        String url = baseUrl + &quot;delete/&quot; + flat.getUnitNumber();\n        System.out.println(&quot;URL: &quot; + url);\n        restTemplate.delete(url);\n    }\n}\n\n  \n  \n</code></pre>\n<p>Factory Test:</p>\n<pre><code>package za.ac.shinysneakerz.factory;\n\nimport org.junit.jupiter.api.Test;\nimport za.ac.shinysneakerz.domain.Flat;\n\nimport static org.junit.jupiter.api.Assertions.*;\nclass FlatFactoryTest {\n\n    @Test\n    void createFlat() {\n        //Flat flat = FlatFactory.createFlat((short) 10, &quot;Blake&quot;);\n        Flat flat = FlatFactory.createFlat((short) 23, &quot;Blake&quot;, 123456L, (short) 23, &quot;Bold&quot;, &quot;Cape&quot;, &quot;Some&quot;,(short) 45);\n    }\n}\n\nService Test:\npackage za.ac.shinysneakerz.service;\n\nimport org.junit.jupiter.api.MethodOrderer;\nimport org.junit.jupiter.api.Test;\nimport org.junit.jupiter.api.TestMethodOrder;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport za.ac.shinysneakerz.domain.Flat;\nimport za.ac.shinysneakerz.factory.FlatFactory;\n\nimport static org.junit.jupiter.api.Assertions.*;\n\n@SpringBootTest\n@TestMethodOrder(MethodOrderer.MethodName.class)\nclass FlatServiceImplementationTest {\n\n    @Autowired\n    private FlatService service;\n\n    private Flat flat = FlatFactory.createFlat((short) 23, &quot;Blake&quot;, 123456L, (short) 23, &quot;Bold&quot;, &quot;Cape&quot;, &quot;Some&quot;,(short) 45);\n\n//    @Test\n//    void findByFlatName() {\n//    }\n//\n//    @Test\n//    void findByStreetName() {\n//    }\n\n    @Test\n    void create() {\n        Flat created = service.create(flat);\n        assertNotNull(created);\n        System.out.println(created);\n    }\n\n    @Test\n    void read() {\n        Flat read = service.read(flat.getUnitNumber());\n        assertNotNull(read);\n        System.out.println(read);\n    }\n\n    @Test\n    void update() {\n        Flat newFlat = new Flat.Builder().copy(flat).setFlatName(&quot;Ryan&quot;).build();\n        Flat updated = service.update(newFlat);\n        assertNotNull(updated);\n        System.out.println(updated);\n    }\n\n    @Test\n    void getAll() {\n        System.out.println(service.getAll());\n    }\n\n    @Test\n    void delete() {\n    }\n}\n</code></pre>\n",
    "tags" : [ "java" ],
    "owner" : {
      "account_id" : 42375001,
      "reputation" : 1,
      "user_id" : 30723382,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d9b7771887243cfbded728bdd93874bd?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Ezile Xozwa",
      "link" : "https://stackoverflow.com/users/30723382/ezile-xozwa"
    },
    "is_answered" : false,
    "view_count" : 63,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1749077104,
    "creation_date" : 1749077104,
    "link" : "https://stackoverflow.com/questions/79653598/how-to-properly-design-a-flat-entity-extending-address-in-spring-boot-with-build",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}