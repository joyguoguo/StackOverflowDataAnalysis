{
  "question" : {
    "question_id" : 79713291,
    "title" : "InitializationException: The EN 16931 VES are missing when using PeppolValidation2025_05 error",
    "body" : "<p>I'm encountering an error when trying to run a simple PEPPOL validation example using the phive-rules-peppol version 3.2.14 or bellow to 3.2.5. The exception I'm seeing is:</p>\n<pre><code>Exception in thread &quot;main&quot; java.lang.ExceptionInInitializerError   \nat billing.PeppolValidationExample.main(PeppolValidationExample.java:7)   \nCaused by: com.helger.commons.exception.InitializationException: The EN 16931 VES are missing   \nat com.helger.phive.peppol.PeppolValidation2025_03.init(PeppolValidation2025_03.java:82)   \nat com.helger.phive.peppol.PeppolValidationBisEurope.init(PeppolValidationBisEurope.java:68)   \nat com.helger.phive.peppol.PeppolValidation.initStandard(PeppolValidation.java:58)   \nat billing.PeppolXmlValidator.initializeValidator(PeppolXmlValidator.java:50)   \nat billing.PeppolXmlValidator.&lt;clinit&gt;(PeppolXmlValidator.java:43)   \n... 1 more \n</code></pre>\n<p>From what I understand, it seems that the validator can't find the EN 16931 Validation Artefacts (DVRCoord), but I'm not sure what the correct way is to include or register them.</p>\n<p>I'm using the following version of the PEPPOL libraries:</p>\n<pre><code>&lt;dependency&gt;\n            &lt;groupId&gt;com.helger.commons&lt;/groupId&gt;\n            &lt;artifactId&gt;ph-commons&lt;/artifactId&gt;\n            &lt;version&gt;11.2.6&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.helger.phive.rules&lt;/groupId&gt;\n            &lt;artifactId&gt;phive-rules-peppol&lt;/artifactId&gt;\n            &lt;version&gt;3.2.14&lt;/version&gt;\n            &lt;scope&gt;compile&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.helger.diver&lt;/groupId&gt;\n            &lt;artifactId&gt;ph-diver-api&lt;/artifactId&gt;\n            &lt;version&gt;3.0.0&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.helger.phive&lt;/groupId&gt;\n            &lt;artifactId&gt;phive-xml&lt;/artifactId&gt;\n            &lt;version&gt;10.1.1&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.helger.phive&lt;/groupId&gt;\n            &lt;artifactId&gt;phive-api&lt;/artifactId&gt;\n            &lt;version&gt;10.1.1&lt;/version&gt;\n        &lt;/dependency&gt;\n\n            &lt;dependency&gt;\n                &lt;groupId&gt;org.slf4j&lt;/groupId&gt;\n                &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;\n                &lt;version&gt;2.0.16&lt;/version&gt;\n            &lt;/dependency&gt;\n            \n            &lt;dependency&gt;\n    &lt;groupId&gt;jakarta.xml.bind&lt;/groupId&gt;\n    &lt;artifactId&gt;jakarta.xml.bind-api&lt;/artifactId&gt;\n    &lt;version&gt;4.0.2&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;!-- JAXB Runtime --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.glassfish.jaxb&lt;/groupId&gt;\n    &lt;artifactId&gt;jaxb-runtime&lt;/artifactId&gt;\n    &lt;version&gt;4.0.5&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;!-- Schematron SVRL JAXB --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;com.helger.schematron&lt;/groupId&gt;\n    &lt;artifactId&gt;ph-schematron-xslt&lt;/artifactId&gt;\n    &lt;version&gt;7.1.1&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n    &lt;groupId&gt;com.helger.schematron&lt;/groupId&gt;\n    &lt;artifactId&gt;ph-schematron-api&lt;/artifactId&gt;\n    &lt;version&gt;7.1.1&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n    &lt;groupId&gt;net.sf.saxon&lt;/groupId&gt;\n    &lt;artifactId&gt;Saxon-HE&lt;/artifactId&gt;\n    &lt;version&gt;10.9&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>I would appreciate any guidance on:</p>\n<p>How to correctly include or reference the EN 16931 VES</p>\n<p>Whether I need to manually download and register certain Schematron or XML files</p>\n<p>Or if thereâ€™s a preferred way to bootstrap PeppolValidation2025_03</p>\n<p>Here my code</p>\n<pre><code>package billing;\nimport com.helger.commons.error.list.ErrorList;\nimport com.helger.commons.io.resource.inmemory.ReadableResourceString;\nimport com.helger.diver.api.coord.DVRCoordinate;\nimport com.helger.phive.api.execute.ValidationExecutionManager;\nimport com.helger.phive.api.executorset.IValidationExecutorSet;\nimport com.helger.phive.api.executorset.IValidationExecutorSetRegistry;\nimport com.helger.phive.api.executorset.ValidationExecutorSetRegistry;\nimport com.helger.phive.api.result.ValidationResultList;\nimport com.helger.phive.peppol.PeppolValidation;\nimport com.helger.phive.peppol.PeppolValidation2024_05;\nimport com.helger.phive.peppol.PeppolValidation2025_05;\nimport com.helger.phive.xml.source.IValidationSourceXML;\nimport com.helger.phive.xml.source.ValidationSourceXML;\nimport org.w3c.dom.Document;\n\nimport javax.xml.parsers.DocumentBuilder;\nimport javax.xml.parsers.DocumentBuilderFactory;\nimport javax.xml.transform.Transformer;\nimport javax.xml.transform.TransformerFactory;\nimport javax.xml.transform.dom.DOMSource;\nimport javax.xml.transform.stream.StreamResult;\nimport java.io.File;\nimport java.io.StringWriter;\nimport java.nio.charset.StandardCharsets;\nimport java.nio.file.Files;\nimport java.util.List;\nimport java.util.Locale;\nimport java.util.stream.Collectors;\n\nimport static java.util.Collections.emptyList;\n\npublic class PeppolXmlValidator {\n\n    private static IValidationExecutorSetRegistry&lt;IValidationSourceXML&gt; validationExecutorSetRegistry;\n    private static DVRCoordinate vesid_invoice;\n    private static DVRCoordinate vesid_creditNote;\n    private static DVRCoordinate vesid_order;\n    private static DVRCoordinate vesid_orderResponse;\n    private static DVRCoordinate vesid_despatchAdvice;\n\n    static {\n        initializeValidator();\n    }\n\n    private static void initializeValidator() {\n        validationExecutorSetRegistry = new ValidationExecutorSetRegistry&lt;&gt;();\n        \n        // Initialize PEPPOL validation rules\n        PeppolValidation.initStandard(validationExecutorSetRegistry);\n        \n        // Set up document type VESIDs (Validation Executor Set IDs)\n        vesid_invoice = PeppolValidation2025_05.VID_OPENPEPPOL_INVOICE_UBL_V3;\n        vesid_creditNote = PeppolValidation2025_05.VID_OPENPEPPOL_CREDIT_NOTE_UBL_V3;\n        vesid_order = PeppolValidation2025_05.VID_OPENPEPPOL_ORDER_V3;\n        vesid_orderResponse = PeppolValidation2025_05.VID_OPENPEPPOL_ORDER_RESPONSE_V3;\n        vesid_despatchAdvice = PeppolValidation2025_05.VID_OPENPEPPOL_DESPATCH_ADVICE_V3;\n    }\n\n    /**\n     * Validates XML file from project directory\n     */\n    public ValidationResult validateFile(String filePath) {\n        try {\n            File xmlFile = new File(filePath);\n            if (!xmlFile.exists()) {\n                throw new IllegalArgumentException(&quot;File not found: &quot; + filePath);\n            }\n            \n            String xmlContent = new String(Files.readAllBytes(xmlFile.toPath()), StandardCharsets.UTF_8);\n            return validateXmlContent(xmlContent);\n            \n        } catch (Exception e) {\n            return new DefaultValidationResult(Validity.INVALID, \n                List.of(&quot;Failed to read or validate file: &quot; + e.getMessage()), \n                emptyList());\n        }\n    }\n\n    /**\n     * Validates XML content string\n     */\n    public ValidationResult validateXmlContent(String xmlContent) {\n        try {\n            // Parse XML to determine document type\n            DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n            factory.setNamespaceAware(true);\n            DocumentBuilder builder = factory.newDocumentBuilder();\n            Document document = builder.parse(new java.io.ByteArrayInputStream(xmlContent.getBytes(StandardCharsets.UTF_8)));\n            \n            // Determine document type and get appropriate validation executor set\n            IValidationExecutorSet&lt;IValidationSourceXML&gt; aVES = getValidationExecutorSet(document);\n            \n            if (aVES != null) {\n                return doValidation(aVES, xmlContent);\n            } else {\n                return new DefaultValidationResult(Validity.INVALID, \n                    List.of(&quot;Unsupported PEPPOL document type or invalid XML structure&quot;), \n                    emptyList());\n            }\n            \n        } catch (Exception e) {\n            return new DefaultValidationResult(Validity.INVALID, \n                List.of(&quot;Failed to parse or validate XML: &quot; + e.getMessage()), \n                emptyList());\n        }\n    }\n\n    /**\n     * Validates XML Document object\n     */\n    public ValidationResult validateDocument(Document document) {\n        try {\n            // Convert Document to XML string\n            TransformerFactory transformerFactory = TransformerFactory.newInstance();\n            Transformer transformer = transformerFactory.newTransformer();\n            StringWriter writer = new StringWriter();\n            transformer.transform(new DOMSource(document), new StreamResult(writer));\n            String xmlContent = writer.toString();\n            \n            return validateXmlContent(xmlContent);\n            \n        } catch (Exception e) {\n            return new DefaultValidationResult(Validity.INVALID, \n                List.of(&quot;Failed to convert document to XML: &quot; + e.getMessage()), \n                emptyList());\n        }\n    }\n\n    /**\n     * Determines the appropriate validation executor set based on document type\n     */\n    private IValidationExecutorSet&lt;IValidationSourceXML&gt; getValidationExecutorSet(Document document) {\n        String rootElementName = document.getDocumentElement().getLocalName();\n        String namespaceURI = document.getDocumentElement().getNamespaceURI();\n        \n        // Check for UBL 2.1 namespace\n        if (namespaceURI != null &amp;&amp; namespaceURI.contains(&quot;urn:oasis:names:specification:ubl:schema:xsd:&quot;)) {\n            switch (rootElementName) {\n                case &quot;Invoice&quot;:\n                    return validationExecutorSetRegistry.getOfID(vesid_invoice);\n                case &quot;CreditNote&quot;:\n                    return validationExecutorSetRegistry.getOfID(vesid_creditNote);\n                case &quot;Order&quot;:\n                    return validationExecutorSetRegistry.getOfID(vesid_order);\n                case &quot;OrderResponse&quot;:\n                    return validationExecutorSetRegistry.getOfID(vesid_orderResponse);\n                case &quot;DespatchAdvice&quot;:\n                    return validationExecutorSetRegistry.getOfID(vesid_despatchAdvice);\n            }\n        }\n        \n        // Fallback: check namespace endings (for compatibility)\n        if (namespaceURI != null) {\n            if (namespaceURI.endsWith(&quot;Invoice-2&quot;)) {\n                return validationExecutorSetRegistry.getOfID(vesid_invoice);\n            }\n            if (namespaceURI.endsWith(&quot;CreditNote-2&quot;)) {\n                return validationExecutorSetRegistry.getOfID(vesid_creditNote);\n            }\n        }\n        \n        return null;\n    }\n\n    /**\n     * Performs the actual validation using PEPPOL rules\n     */\n    private ValidationResult doValidation(IValidationExecutorSet&lt;IValidationSourceXML&gt; aVES, String xmlContent) {\n        try {\n            // Create validation source from XML content\n            final IValidationSourceXML validationSourceXML = ValidationSourceXML.create(\n                new ReadableResourceString(xmlContent, StandardCharsets.UTF_8));\n\n            // Execute validation\n            final ValidationResultList vResult = ValidationExecutionManager.executeValidation(aVES, validationSourceXML);\n            \n            // Process results\n            if (vResult.containsAtLeastOneError()) {\n                return new DefaultValidationResult(Validity.INVALID, \n                    getTextFrom(vResult.getAllErrors()), \n                    getTextFrom(vResult.getAllFailures()));\n            } else if (vResult.containsAtLeastOneFailure()) {\n                return new DefaultValidationResult(Validity.WITH_WARNINGS, \n                    emptyList(), \n                    getTextFrom(vResult.getAllFailures()));\n            } else {\n                return new DefaultValidationResult(Validity.VALID, emptyList(), emptyList());\n            }\n            \n        } catch (Exception e) {\n            return new DefaultValidationResult(Validity.INVALID, \n                List.of(&quot;Validation execution failed: &quot; + e.getMessage()), \n                emptyList());\n        }\n    }\n\n    /**\n     * Converts ErrorList to List of String messages\n     */\n    private List&lt;String&gt; getTextFrom(ErrorList errorList) {\n        return errorList.stream()\n            .map(error -&gt; error.getAsString(Locale.getDefault()))\n            .collect(Collectors.toList());\n    }\n\n    /**\n     * Gets available PEPPOL document types\n     */\n    public static List&lt;String&gt; getSupportedDocumentTypes() {\n        return List.of(&quot;Invoice&quot;, &quot;CreditNote&quot;, &quot;Order&quot;, &quot;OrderResponse&quot;, &quot;DespatchAdvice&quot;, &quot;ReceiptAdvice&quot;);\n    }\n\n    /**\n     * Utility method to check if a document type is supported\n     */\n    public static boolean isDocumentTypeSupported(String documentType) {\n        return getSupportedDocumentTypes().contains(documentType);\n    }\n}\n</code></pre>\n<p>Thanks in advance!</p>\n<p>I have tried to add some other dependencies and the same error always appear</p>\n",
    "tags" : [ "java", "maven", "peppol" ],
    "owner" : {
      "account_id" : 23927465,
      "reputation" : 11,
      "user_id" : 17922420,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GiBl2p4r2qtCwj7sUxLb8bSMuA6UiczLVmuwHl4Sg=k-s256",
      "display_name" : "ahmed homrani",
      "link" : "https://stackoverflow.com/users/17922420/ahmed-homrani"
    },
    "is_answered" : true,
    "view_count" : 58,
    "answer_count" : 2,
    "score" : 1,
    "last_activity_date" : 1763239269,
    "creation_date" : 1753357609,
    "link" : "https://stackoverflow.com/questions/79713291/initializationexception-the-en-16931-ves-are-missing-when-using-peppolvalidatio",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79766054,
    "question_id" : 79713291,
    "body" : "<p>i think the problem is here.</p>\n<pre><code>// Initialize PEPPOL validation rules\n//PeppolValidation.initStandard(validationExecutorSetRegistry);\nPeppolValidation2025_05.init(validationExecutorSetRegistry);\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 43955924,
      "reputation" : 21,
      "user_id" : 31500807,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/be12c8e74e3834e33f8c0ce353a90e4d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Franco Graziani",
      "link" : "https://stackoverflow.com/users/31500807/franco-graziani"
    },
    "creation_date" : 1758015367,
    "last_activity_date" : 1758015367,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79821103,
    "question_id" : 79713291,
    "body" : "<p>You need to add</p>\n<pre><code>    EN16931Validation.initStandard(validationExecutorSetRegistry);\n</code></pre>\n<p>before your call</p>\n<pre><code>    PeppolValidation.initStandard(validationExecutorSetRegistry);\n</code></pre>\n<p>This will solve your problem</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 8455,
      "reputation" : 1914,
      "user_id" : 15254,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vjODY.png?s=256",
      "display_name" : "Philip Helger",
      "link" : "https://stackoverflow.com/users/15254/philip-helger"
    },
    "creation_date" : 1763239269,
    "last_activity_date" : 1763239269,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}