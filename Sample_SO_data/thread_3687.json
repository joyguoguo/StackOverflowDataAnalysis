{
  "question" : {
    "question_id" : 79531501,
    "title" : "Jenetics lib: Constraints are still violated",
    "body" : "<p>I am working on a linear programming optimization problem similar to this picture\n<a href=\"https://i.sstatic.net/Jp7sy4X2.png\" rel=\"nofollow noreferrer\">(a linear optimization example)</a>\nThis is a simplified example, in my case I am dealing with around 25 thousands of variables (in denoted as x's in the picture) and those variables can take a value of 0, or 1.\nThink of this problem as a list of items I want to add to my collection, where 0 means I add the item, and 1 means I don't add it.\nI have a set of constraints as well, around hundreds of them.</p>\n<p>What I did so far is implementing this engine</p>\n<pre><code> Engine&lt;BitGene, Long&gt; engine = Engine.builder(this::fittness, genotypeFactory)\n            .populationSize(100)\n            .optimize(Optimize.MAXIMUM)\n            .alterers(new ShuffleMutator&lt;&gt;(0.7), new UniformCrossover&lt;&gt;(0.5),\n                new SwapMutator&lt;&gt;(0.3))\n            .offspringSelector(new TournamentSelector&lt;&gt;(10000))\n            .survivorsSelector(new RouletteWheelSelector&lt;&gt;())\n            .constraint(constraint)\n            .build();\n        Phenotype&lt;BitGene, Long&gt; best = engine.stream()\n            .limit(Limits.bySteadyFitness(200))\n            .collect(EvolutionResult.toBestPhenotype());\n</code></pre>\n<p>Where the <code>constraint</code> is the following</p>\n<pre><code> Constraint&lt;BitGene, Long&gt; constraint = Constraint.of(\n            phenotype -&gt; {\n                Genotype&lt;BitGene&gt; genotype = phenotype.genotype();\n                BitChromosome chromosome = genotype.chromosome().as(BitChromosome.class);\n\n                int[] solution = chromosome.stream()\n                    .map(gene -&gt; gene.bit() ? 1 : 0)\n                    .mapToInt(Integer::intValue)\n                    .toArray();\n\n                for (int i = 0; i &lt; constraintCoeffs.length; i++) {\n                    long sum = 0;\n                    for (int j = 0; j &lt; solution.length; j++) {\n                        sum += constraintCoeffs[i][j] * solution[j];\n                    }\n                    if (sum &gt; bounds[i]) {\n                        return false; // Solution violates a constraint\n                    }\n                }\n\n                return true; // Solution is valid\n            }\n        );\n</code></pre>\n<p>Here's the genotype factory</p>\n<pre><code>Factory&lt;Genotype&lt;BitGene&gt;&gt; genotypeFactory = Genotype.of(\n            BitChromosome.of(objects.size(), 0.9)\n        );\n</code></pre>\n<p>and here's my fitness function</p>\n<pre><code>private long fittness(Genotype&lt;BitGene&gt; genotype) {\n        var bitChromosome = genotype.chromosome().as(BitChromosome.class);\n        variables = bitChromosome.stream().mapToInt(gene -&gt; gene.bit() ? 1 : 0).toArray();\n        var objects = dataModel.getObjects();\n        for (int i = 0; i &lt; constraintCoeffs.length; i++) {\n            long temp = 0;\n            for (int j = 0; j &lt; variables.length; j++) {\n                temp += constraintCoeffs[i][j] * variables[j];\n            }\n\n            if (temp &gt; bounds[i]) {\n                return 0;\n            }\n        }\n\n        double result = 0.0;\n        for (int i = 0; i &lt; objects.size(); i++) {\n            result += objects.get(i).getValue() * variables[i];\n        }\n        long longResult = (long) (result * 100000000);\n        return longResult * 30000;\n    }\n</code></pre>\n<p>My issue is that regardless of how long I run this code, and regardless of the count of generations in it, or the count of individuals in it, I can't seem to reach a solution that actually satisfies my bounds limits.\nFor instance, I have a value of the bounds where the percentage of the selected objects should not exceed 9% but for some reason it's always around 9.0x%</p>\n",
    "tags" : [ "java", "jenetics" ],
    "owner" : {
      "account_id" : 40490250,
      "reputation" : 1,
      "user_id" : 29806152,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c8a9901afab90f2fa5f490b14fbd21aa?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Ali Wassouf",
      "link" : "https://stackoverflow.com/users/29806152/ali-wassouf"
    },
    "is_answered" : false,
    "view_count" : 36,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1742841677,
    "creation_date" : 1742830704,
    "link" : "https://stackoverflow.com/questions/79531501/jenetics-lib-constraints-are-still-violated",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}