{
  "question" : {
    "question_id" : 79659695,
    "title" : "How to support CRUD operations on user profile in Spring Boot when Keycloak manages user table?",
    "body" : "<p>I'm developing a Spring Boot application integrated with Keycloak for authentication and authorization. After reading <a href=\"https://stackoverflow.com/questions/77850668/how-to-map-user-in-hibernate-entity-from-keycloak\">this StackOverflow answer</a>, I understand that the recommended approach is to <strong>not</strong> directly map Spring Boot entity tables with Keycloak's <code>user_entity</code> tables. Instead, I should maintain only a reference to the immutable user ID, similar to microservice architecture patterns.</p>\n<p><strong>My Challenge</strong></p>\n<p>However, my application requires comprehensive user profile CRUD operations (Create, Read, Update, Delete) for user-specific data. After further research, I discovered that Keycloak provides REST endpoints for user management, such as:</p>\n<pre><code>PUT /admin/realms/{realm}/users/{user-id}\nGET /admin/realms/{realm}/users/{user-id}\nPOST /admin/realms/{realm}/users\nDELETE /admin/realms/{realm}/users/{user-id}\n</code></pre>\n<p><strong>My Approach</strong></p>\n<p>I'm thinking of implementing it like this:</p>\n<ol>\n<li>Spring Boot /profile endpoints for GET and PUT/PATCH.</li>\n<li>Internally, these endpoints would call Keycloak’s Admin REST API using a service client.</li>\n<li>Data would flow in and out via DTOs in my Spring Boot application—no direct JPA mapping to Keycloak tables.</li>\n</ol>\n<p><strong>Questions</strong></p>\n<ul>\n<li>Should I use the Keycloak Maven dependency <code>(org.keycloak)</code> for easier integration, or stick with direct REST API calls?</li>\n<li>Is this approach considered a best practice for handling user profile management with Keycloak integration?</li>\n<li>Are there any potential drawbacks to this approach (performance, security, maintainability)?</li>\n<li>Is this approach considered a best practice for handling user profile management with Keycloak integration?</li>\n</ul>\n",
    "tags" : [ "java", "spring-boot", "spring-data-jpa", "keycloak" ],
    "owner" : {
      "account_id" : 32616046,
      "reputation" : 55,
      "user_id" : 25346567,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d9e207d7983195d45de53cedb3aef07a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Gaurav Kumar",
      "link" : "https://stackoverflow.com/users/25346567/gaurav-kumar"
    },
    "is_answered" : true,
    "view_count" : 261,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1749837902,
    "creation_date" : 1749520448,
    "link" : "https://stackoverflow.com/questions/79659695/how-to-support-crud-operations-on-user-profile-in-spring-boot-when-keycloak-mana",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79661179,
    "question_id" : 79659695,
    "body" : "<p>You don't need Keycloak's Java libs for that. The <a href=\"https://www.keycloak.org/docs-api/latest/rest-api/index.html\" rel=\"nofollow noreferrer\">OpenAPI specification</a> of its admin API is enough.</p>\n<p>There are Spring generators for <a href=\"https://github.com/OpenAPITools/openapi-generator/tree/master/modules/openapi-generator-maven-plugin\" rel=\"nofollow noreferrer\">maven</a> and <a href=\"https://github.com/OpenAPITools/openapi-generator/tree/master/modules/openapi-generator-gradle-plugin\" rel=\"nofollow noreferrer\">gradle</a> that you can configure to genere only <code>@HttpExchange</code> interfaces from an OpenAPI specification (carefully read <a href=\"https://openapi-generator.tech/docs/generators/spring/\" rel=\"nofollow noreferrer\">the generator doc</a> to work around the Keycloak's OpenAPI spec imperfections and to generate only the <code>@HttpExchange</code> interfaces).</p>\n<p>You can have Spring <a href=\"https://docs.spring.io/spring-framework/reference/integration/rest-clients.html#rest-http-interface\" rel=\"nofollow noreferrer\">generate implementations (&quot;proxies&quot;) from <code>@HttpExchange</code> interfaces</a>.</p>\n<p>The only tricky part is to configure the <code>RestClient</code> or <code>WebClient</code> to provide to the <code>@HttpExchange</code> proxy factory. But I wrote <a href=\"https://github.com/ch4mpy/spring-addons/tree/master/spring-addons-starter-rest\" rel=\"nofollow noreferrer\">a Boot starter </a>that can be of great help, especially if you use the client credential flow and want token to be scoped to the application (Spring Security always scopes tokens to the user, even with the client credentials flow), or have to go through a proxy, or need to disable self-signed SSL certificate validation, ....</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 308139,
      "reputation" : 13879,
      "user_id" : 619830,
      "user_type" : "registered",
      "accept_rate" : 75,
      "profile_image" : "https://www.gravatar.com/avatar/f4d00b0a82e9307b1d68b29867fee4e5?s=256&d=identicon&r=PG",
      "display_name" : "ch4mp",
      "link" : "https://stackoverflow.com/users/619830/ch4mp"
    },
    "creation_date" : 1749593460,
    "last_activity_date" : 1749837902,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79661179" : [ {
      "comment_id" : 140513744,
      "post_id" : 79661179,
      "body" : "You should accept it, then (checkmark on the top left of the answer)",
      "score" : 1,
      "owner" : {
        "account_id" : 308139,
        "reputation" : 13879,
        "user_id" : 619830,
        "user_type" : "registered",
        "accept_rate" : 75,
        "profile_image" : "https://www.gravatar.com/avatar/f4d00b0a82e9307b1d68b29867fee4e5?s=256&d=identicon&r=PG",
        "display_name" : "ch4mp",
        "link" : "https://stackoverflow.com/users/619830/ch4mp"
      },
      "creation_date" : 1749917155,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140513034,
      "post_id" : 79661179,
      "body" : "Thank you for clarifying! Your response absolutely satisfies my question - it was just that I wasn&#39;t aware of the &quot;@HttpExchange&quot; feature in Spring Boot, so it took me some time to do more research and reading on it.",
      "score" : 0,
      "owner" : {
        "account_id" : 32616046,
        "reputation" : 55,
        "user_id" : 25346567,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/d9e207d7983195d45de53cedb3aef07a?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Gaurav Kumar",
        "link" : "https://stackoverflow.com/users/25346567/gaurav-kumar"
      },
      "creation_date" : 1749885683,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140513024,
      "post_id" : 79661179,
      "body" : "I have another question related to the Keycloak &quot;client credentials flow&quot;. Is there a way or setting to make admin REST API requests without first requesting a token, holding onto it, and renewing it periodically? I know I can increase the token expiration time limit, but I&#39;m looking for a solution that uses some kind of signature or API key that I can provide with each request to verify my identity and authorization - similar to how AWS uses signed requests. Does Keycloak support this type of stateless authentication for admin API calls?",
      "score" : 0,
      "owner" : {
        "account_id" : 32616046,
        "reputation" : 55,
        "user_id" : 25346567,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/d9e207d7983195d45de53cedb3aef07a?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Gaurav Kumar",
        "link" : "https://stackoverflow.com/users/25346567/gaurav-kumar"
      },
      "creation_date" : 1749884949,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140512142,
      "post_id" : 79661179,
      "body" : "@GauravKumar I&#39;m surprised that the above doesn&#39;t answer your question.",
      "score" : 1,
      "owner" : {
        "account_id" : 308139,
        "reputation" : 13879,
        "user_id" : 619830,
        "user_type" : "registered",
        "accept_rate" : 75,
        "profile_image" : "https://www.gravatar.com/avatar/f4d00b0a82e9307b1d68b29867fee4e5?s=256&d=identicon&r=PG",
        "display_name" : "ch4mp",
        "link" : "https://stackoverflow.com/users/619830/ch4mp"
      },
      "creation_date" : 1749837673,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140506454,
      "post_id" : 79661179,
      "body" : "Yes, you don&#39;t want to grant all users the right to query the admin API. Only a dedicated client (your own REST API) should be allowed to. This exactly what I refer to with the <i>&quot;client credentials flow&quot;</i> in my answer. So, in Keycloak, create a client with what they call <i>&quot;Service accounts roles&quot;</i> (look at the text in the popup when you click the question mark next to it), enable a minimum of <code>query-users</code> &amp; <code>view-users</code> (plus what you need for edition), and in Spring, add a registration for this client and use it to authorize <code>RestClient</code> requests.",
      "score" : 1,
      "owner" : {
        "account_id" : 308139,
        "reputation" : 13879,
        "user_id" : 619830,
        "user_type" : "registered",
        "accept_rate" : 75,
        "profile_image" : "https://www.gravatar.com/avatar/f4d00b0a82e9307b1d68b29867fee4e5?s=256&d=identicon&r=PG",
        "display_name" : "ch4mp",
        "link" : "https://stackoverflow.com/users/619830/ch4mp"
      },
      "creation_date" : 1749663734,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140505948,
      "post_id" : 79661179,
      "body" : "Would it be a good practice to create a separate dedicated client in Keycloak specifically for my Spring Boot backend? I&#39;m thinking of using client_id and client_secret for authenticating.    I found <a href=\"https://boottechnologies-ci.medium.com/spring-boot-3-keycloak-admin-client-integration-e18cdac198aa#78db\" rel=\"nofollow noreferrer\">this article</a> that shows a similar approach.",
      "score" : 0,
      "owner" : {
        "account_id" : 32616046,
        "reputation" : 55,
        "user_id" : 25346567,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/d9e207d7983195d45de53cedb3aef07a?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Gaurav Kumar",
        "link" : "https://stackoverflow.com/users/25346567/gaurav-kumar"
      },
      "creation_date" : 1749654469,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}