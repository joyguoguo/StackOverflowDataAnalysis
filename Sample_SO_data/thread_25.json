{
  "question" : {
    "question_id" : 79842258,
    "title" : "Spring Data Couchbase @JsonAnySetter / @JsonAnyGetter support",
    "body" : "<p>I am working on a service that uses Spring Data Couchbase and I have an entity that maps some of the fields of a document and I need all the other fields to be mapped to a Map&lt;String, Object&gt;.</p>\n<p>I was hoping to use @JsonAnyGetter and @JsonAnySetter to map any field unrecognized in the entity to a Map field, but it seems that is not working for me.</p>\n<p>I tried de-serializing a string representation of the couchbase document using an ObjectMapper and the entity is correctly de-serialized with the unrecognized fields into the map.</p>\n<p>So I am thinking that this may be an issue with Spring Data Couchbase but I am not sure if its supported or I am missing some configuration.</p>\n<p>The entity is pretty simple:</p>\n<pre><code>@Document\n@SuperBuilder\n@AllArgsConstructor\n@NoArgsConstructor(access = AccessLevel.PRIVATE)\n@ToString\n@EqualsAndHashCode(of = &quot;id&quot;, callSuper = false)\npublic class Asset extends AbstractEntity implements TypedAsset {\n\n    @Id\n    private String id;\n    private String type;\n\n    @JsonAnyGetter\n    @JsonAnySetter\n    private Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;();\n\n}\n</code></pre>\n",
    "tags" : [ "java", "spring", "jackson", "spring-data-couchbase" ],
    "owner" : {
      "account_id" : 231359,
      "reputation" : 1110,
      "user_id" : 495551,
      "user_type" : "registered",
      "accept_rate" : 50,
      "profile_image" : "https://www.gravatar.com/avatar/247fad6bb57e0a427200a164e34d3b7d?s=256&d=identicon&r=PG",
      "display_name" : "Mauro Monti",
      "link" : "https://stackoverflow.com/users/495551/mauro-monti"
    },
    "is_answered" : true,
    "view_count" : 30,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1765316478,
    "creation_date" : 1765304674,
    "link" : "https://stackoverflow.com/questions/79842258/spring-data-couchbase-jsonanysetter-jsonanygetter-support",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79842282,
    "question_id" : 79842258,
    "body" : "<p>This is a common point of confusion with Spring Data Couchbase. The issue is that <em><strong>Spring Data Couchbase</strong></em> doesn't use Jackson for entity mapping - it uses its own <em><strong>MappingCouchbaseConverter</strong></em> which is part of Spring Data's mapping infrastructure.</p>\n<p>So while @JsonAnySetter/@JsonAnyGetter work perfectly with ObjectMapper, they're simply ignored by Spring Data Couchbase's converter.</p>\n<p><a href=\"https://docs.spring.io/spring-data/couchbase/docs/current/api/org/springframework/data/couchbase/core/convert/MappingCouchbaseConverter.html\" rel=\"nofollow noreferrer\">MappingCouchbaseConverter</a></p>\n<p>Yo can use custom converter like:</p>\n<pre><code>@ReadingConverter\npublic class AssetReadConverter implements Converter&lt;CouchbaseDocument, Asset&gt; {\n    @Override\n    public Asset convert(CouchbaseDocument source) {\n        Map&lt;String, Object&gt; content = new HashMap&lt;&gt;(source.getContent());\n        Asset asset = new Asset();\n        asset.setId(source.getId());\n        asset.setType((String) content.remove(&quot;type&quot;));\n        content.remove(&quot;_class&quot;);\n        asset.setProperties(content);\n        return asset;\n    }\n}\n\n@WritingConverter  \npublic class AssetWriteConverter implements Converter&lt;Asset, CouchbaseDocument&gt; {\n    @Override\n    public CouchbaseDocument convert(Asset source) {\n        CouchbaseDocument doc = new CouchbaseDocument(source.getId());\n        doc.put(&quot;type&quot;, source.getType());\n        source.getProperties().forEach(doc::put);\n        return doc;\n    }\n}\n\n@Override\npublic CouchbaseCustomConversions customConversions() {\n    return new CouchbaseCustomConversions(List.of(new AssetReadConverter(), new AssetWriteConverter()));\n}\n</code></pre>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 25583936,
      "reputation" : 1394,
      "user_id" : 19361968,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/1d19c6d51232c67af617cf944af5a30c?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Murat K.",
      "link" : "https://stackoverflow.com/users/19361968/murat-k"
    },
    "creation_date" : 1765306595,
    "last_activity_date" : 1765306595,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140894922,
    "post_id" : 79842258,
    "body" : "AFAIK the couchbase support doesn&#39;t use Jackson to (de)serialize entities but rather dedicated mappings. So trying to add Jackson annotations won&#39;t work (as you already noticed).",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126818,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1765306364,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}