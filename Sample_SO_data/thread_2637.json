{
  "question" : {
    "question_id" : 79607354,
    "title" : "Java 2D game: cat down animation not rendering while moving down",
    "body" : "<p>I'm building a 2D Java game (without any game engines), inspired by Pac-Man. In it, a cat character moves around and is animated using sprite frames for each direction (up, down, left, right).</p>\n<p>Each direction has 6 frames loaded from <code>.png</code> files.</p>\n<p>The issue is that the cat moves correctly in all directions, animations for UP, LEFT, and RIGHT work fine, however, when moving DOWN, the cat's image disappears.</p>\n<p>Debug steps I've taken are that I confirmed that the DOWN images are loading correctly and not null or corrupted, confirmed that the animation loop is entering the DOWN case and updating the frame index as expected and no exceptions or errors are thrown.</p>\n<p>I feel really stuck and I don't know what else to do.\nThe folders:\nsrc -&gt; Images -&gt; KittyDown -&gt; KittyDown 0.png, KittyDown 1.png, etc.</p>\n<pre><code>    import javax.swing.JFrame;\n\npublic class Main{\n    public static void main(String[] args) throws Exception{\n        //Creating the size of the window\n        int rowNum = 13;\n        int columnNum = 19;\n        int tileSize = 64;\n        int boardWidth = columnNum * tileSize;\n        int boardHeight = rowNum * tileSize;\n\n        JFrame window = new JFrame (&quot;Cat-ch Fishy&quot;);\n        //window.setVisible(true);\n        window.setLocationRelativeTo(null); // setting the window at the center of teh screen\n        window.setResizable(false); // do not let the user resize the window.\n        window.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n\n        CatchFishy catchFishyGame = new CatchFishy();//creating an instance of the JPanel\n        window.add(catchFishyGame);\n        window.pack();\n        window.setVisible(true);\n    }\n}\n\n    import java.awt.*;\nimport java.awt.event.*;\nimport java.util.HashSet;\nimport java.util.Random;\nimport javax.swing.*;\nimport java.awt.Image;\n\n\npublic class CatchFishy extends JPanel {// inherits JPanel\n\n    class Block {  // inner class to represent a block on the map, such as, wall, cat, etc.\n        int x; // positions of the block\n        int y;\n        int width; // size of the block\n        int height;\n        Image image; // the image to draw for this block\n\n        int startX; // the initial spawn position\n        int startY;\n\n        Block(Image image, int x, int y, int width, int height) {\n            this.image = image;\n            this.x = x;\n            this.y = y;\n            this.width = width;\n            this.height = height;\n            this.startX = x;\n            this.startY = y;\n        }\n    }\n\n    enum Direction {\n        UP, DOWN, LEFT, RIGHT\n    }\n\n    // grid setup\n    // JPanel will have the same size as the window\n    private final int rowNum = 13;\n    private final int columnNum = 19;\n    private final int tileSize = 64; // each tile will be 64x64 pixels\n    private final int boardWidth = columnNum * tileSize;\n    private final int boardHeight = rowNum * tileSize;\n\n    // game background and wall image\n    private final Image bgImage;\n    private final Image wallImage;\n\n    // animation frames for the fish, cat, and dog\n    private final Image[] FishFrames = new Image[2];\n\n    private final Image[] DogUpFrames = new Image[6];\n    private final Image[] DogDownFrames = new Image[6];\n    private final Image[] DogLeftFrames = new Image[6];\n    private final Image[] DogRightFrames = new Image[6];\n\n    private final Image[] CatUpFrames = new Image[6];\n    private final Image[] CatDownFrames = new Image[6];\n    private final Image[] CatLeftFrames = new Image[6];\n    private final Image[] CatRightFrames = new Image[6];\n\n    // game object colletions\n    HashSet&lt;Block&gt; walls; // stores wall blocks\n    HashSet&lt;Block&gt; food; //stores food blocks\n    Block cat; // the player character\n    HashSet&lt;Block&gt; dogs; // the player enemy\n\n    // tile map representation: X = wall, C = cat, D = dog, space = empty\n    private String[] tileMap = {\n            &quot;XXXXXXXXXXXXXXXXXXX&quot;,\n            &quot;X X XX   X   XX X X&quot;,\n            &quot;X      XX XX      X&quot;,\n            &quot;X  XXX       XXX  X&quot;,\n            &quot;X  X X XXCXX X X  X&quot;,\n            &quot;X  X    XXX    X  X&quot;,\n            &quot;   XXX       XXX   &quot;,\n            &quot;X    X  XXX  X    X&quot;,\n            &quot;XX XXX XDXDX XXX XX&quot;,\n            &quot;XX X     D     X XX&quot;,\n            &quot;X  XX  XXXXX  XX  X&quot;,\n            &quot;X        X        X&quot;,\n            &quot;XXXXXXXXXXXXXXXXXXX&quot;\n    };\n\n    // animation frame tracking\n    private int catFrameIndex = 0;\n    private int dogFrameIndex = 0;\n    private int fishFrameIndex = 0;\n    private long lastFrameTime = 0;\n    private final int frameDelay = 100; // animation delay in milliseconds (10 FPS)\n    private final int fishframeDelay = 300;\n\n    // constructor to set up game panel\n    CatchFishy() {//Creating a constructor\n        setPreferredSize(new Dimension(boardWidth, boardHeight)); // set panel size\n        setLayout(null); // no layout manager aka using absolute positioning\n\n        // load background and wall images\n        bgImage = new ImageIcon(&quot;Images/BG.png&quot;).getImage();\n        wallImage = new ImageIcon(&quot;Images/Wall.png&quot;).getImage();\n\n        // load animation frames for the cat and dog (6 frames per direction)\n        for (int i = 0; i &lt; 6; i++) {\n            CatUpFrames[i] = new ImageIcon(&quot;Images/KittyUp/KittyUp &quot; + i + &quot;.png&quot;).getImage();\n            CatDownFrames[i] = new ImageIcon(&quot;Images/KittyDown/KittyDown &quot; + i + &quot; copy.png&quot;).getImage();\n            CatLeftFrames[i] = new ImageIcon(&quot;Images/KittyLeft/KittyLeft &quot; + i + &quot;.png&quot;).getImage();\n            CatRightFrames[i] = new ImageIcon(&quot;Images/KittyRight/KittyRight &quot; + i + &quot;.png&quot;).getImage();\n\n            DogUpFrames[i] = new ImageIcon(&quot;Images/PuppyUp/PuppyUp &quot; + i + &quot;.png&quot;).getImage();\n            DogDownFrames[i] = new ImageIcon(&quot;Images/PuppyDown/PuppyDown &quot; + i + &quot;.png&quot;).getImage();\n            DogLeftFrames[i] = new ImageIcon(&quot;Images/PuppyLeft/PuppyLeft &quot; + i + &quot;.png&quot;).getImage();\n            DogRightFrames[i] = new ImageIcon(&quot;Images/PuppyRight/PuppyRight &quot; + i + &quot;.png&quot;).getImage();\n        }\n        // load animation frames for the fish (2 frame loop)\n        for (int i = 0; i &lt; 2; i++) {\n            FishFrames[i] = new ImageIcon(&quot;Images/Fish/Fish &quot; + i + &quot;.png&quot;).getImage();\n            if (FishFrames[i] == null) {\n                System.out.println(&quot;FishFrames &quot; + i + &quot; failed to load&quot;); // checking to make sure\n            }\n        }\n\n        loadMap();\n        startFishAnimationTimer();\n        startCatAnimationTimer();\n        setupControls();\n\n        // testing to see if they show up\n        System.out.println(walls.size());\n        System.out.println(food.size());\n    }\n\n    public void loadMap() {\n        walls = new HashSet&lt;Block&gt;();\n        food = new HashSet&lt;Block&gt;();\n        dogs = new HashSet&lt;Block&gt;();\n\n        for (int r = 0; r &lt; rowNum; r++) {\n            for (int c = 0; c &lt; columnNum; c++) {\n                String row = tileMap[r];\n                char tileMapChar = row.charAt(c);\n\n                int x = c * tileSize;\n                int y = r * tileSize;\n\n                if (tileMapChar == 'X') { // block wall\n                    Block wall = new Block(wallImage, x, y, tileSize, tileSize);\n                    walls.add(wall);\n                } else if (tileMapChar == ' ') { // food\n                    Block fish = new Block(FishFrames[fishFrameIndex], x, y, tileSize, tileSize);\n                    food.add(fish);\n                } else if (tileMapChar == 'C') { // kitty cat\n                    cat = new Block(CatRightFrames[0], x, y, tileSize, tileSize);\n                } else if (tileMapChar == 'D') { // dog\n                    Block dog = new Block(DogRightFrames[0], x, y, tileSize, tileSize);\n                    dogs.add(dog);\n                }\n            }\n        }\n    }\n\n    private void startFishAnimationTimer() {\n        Timer fishTimer = new Timer(fishframeDelay, new ActionListener() {\n            public void actionPerformed(ActionEvent e) {\n                fishFrameIndex = (fishFrameIndex + 1) % FishFrames.length;\n                for (Block fish : food) {\n                    fish.image = FishFrames[fishFrameIndex];\n                }\n                repaint();\n            }\n        });\n        fishTimer.start();\n    }\n    private void startCatAnimationTimer() {\n        Timer catTimer = new Timer(150, new ActionListener() {\n            public void actionPerformed(ActionEvent e) {\n                catFrameIndex = (catFrameIndex + 1) % 6;\n                switch (catDirection) {\n                    case UP: cat.image = CatUpFrames[catFrameIndex]; break;\n                    case DOWN: cat.image = CatDownFrames[catFrameIndex]; break;\n                    case LEFT: cat.image = CatLeftFrames[catFrameIndex]; break;\n                    case RIGHT: cat.image = CatRightFrames[catFrameIndex]; break;\n                }\n                System.out.println(&quot;Animating: &quot; + catDirection + &quot; Frame: &quot; + catFrameIndex);\n                repaint();\n            }\n        });\n        catTimer.start();\n    }\n\n    private Direction catDirection = Direction.RIGHT;\n\n    private void setupControls() {\n        //Cat Movement\n        getInputMap(WHEN_IN_FOCUSED_WINDOW).put(KeyStroke.getKeyStroke(&quot;UP&quot;), &quot;catMoveUp&quot;);\n        getActionMap().put(&quot;catMoveUp&quot;, new AbstractAction() {\n            public void actionPerformed(ActionEvent e) {\n                moveCat(Direction.UP);\n            }\n        });\n        getInputMap(WHEN_IN_FOCUSED_WINDOW).put(KeyStroke.getKeyStroke(&quot;DOWN&quot;), &quot;catMoveDown&quot;);\n        getActionMap().put(&quot;catMoveDown&quot;, new AbstractAction() {\n            public void actionPerformed(ActionEvent e) {\n                moveCat(Direction.DOWN);\n            }\n        });\n        getInputMap(WHEN_IN_FOCUSED_WINDOW).put(KeyStroke.getKeyStroke(&quot;LEFT&quot;), &quot;catMoveLeft&quot;);\n        getActionMap().put(&quot;catMoveLeft&quot;, new AbstractAction() {\n            public void actionPerformed(ActionEvent e) {\n                moveCat(Direction.LEFT);\n            }\n        });\n        getInputMap(WHEN_IN_FOCUSED_WINDOW).put(KeyStroke.getKeyStroke(&quot;RIGHT&quot;), &quot;catMoveRight&quot;);\n        getActionMap().put(&quot;catMoveRight&quot;, new AbstractAction() {\n            public void actionPerformed(ActionEvent e) {\n                moveCat(Direction.RIGHT);\n            }\n        });\n    }\n\n    private void moveCat(Direction dir) {\n        int dx = 0;\n        int dy = 0;\n        switch (dir) {\n            case UP: dy = -tileSize; break;\n            case DOWN: dy = tileSize; break;\n            case LEFT: dx = -tileSize; break;\n            case RIGHT: dx = tileSize; break;\n        }\n\n        int newX = cat.x + dx;\n        int newY = cat.y + dy;\n        Rectangle nextPos = new Rectangle(newX, newY, tileSize, tileSize);\n\n        for (Block wall : walls) {\n            if (nextPos.intersects(new Rectangle(wall.x, wall.y, tileSize, tileSize))) {\n                return; // if it hits wall it does not move through it\n            }\n        }\n        cat.x = newX;\n        cat.y = newY;\n        catDirection = dir;\n        System.out.println(&quot;cat direction &quot; + catDirection); // checking directions (troubleshooting)\n\n        repaint();\n    }\n\n    // custom painting of the panel\n    @Override\n    protected void paintComponent(Graphics g) {\n        super.paintComponent(g);\n\n        // draw the background\n        g.drawImage(bgImage, 0, 0, null);\n\n        // draw all wall blocks\n        for (Block wall : walls) {\n            if (wall.image != null) {\n                g.drawImage(wall.image, wall.x, wall.y, wall.width, wall.height, null);\n            }\n        }\n\n        // draw all food blocks\n        for (Block fish : food) {\n            if (fish.image != null) {\n                g.drawImage(fish.image, fish.x, fish.y, fish.width, fish.height, null);\n            }\n        }\n\n        // draw the cat\n        if (cat != null &amp;&amp; cat.image != null) {\n            g.drawImage(cat.image, cat.x, cat.y, cat.width, cat.height, null);\n        }\n\n        // draw all dog blocks\n        for (Block dog : dogs) {\n            if (dog != null &amp;&amp; dog.image != null) {\n                g.drawImage(dog.image, dog.x, dog.y, dog.width, dog.height, null);\n            }\n        }\n    }\n\n}\n</code></pre>\n",
    "tags" : [ "java", "swing", "animation", "game-development" ],
    "owner" : {
      "account_id" : 41797975,
      "reputation" : 11,
      "user_id" : 30453997,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/44533cff37565491c98b8b83f79742e3?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Dimitri",
      "link" : "https://stackoverflow.com/users/30453997/dimitri"
    },
    "is_answered" : false,
    "view_count" : 82,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1746666893,
    "creation_date" : 1746464877,
    "link" : "https://stackoverflow.com/questions/79607354/java-2d-game-cat-down-animation-not-rendering-while-moving-down",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79611592,
    "question_id" : 79607354,
    "body" : "<p>When I ran your code, it worked for me after I set up the correct directories. With the caveat that I made it so there were only two frames so I didn't need as many images. I compiled the code using javac then ran the class files with the java command. I don't have a definitive answer for why it isn't working for you, but here are some observations and things you can try:</p>\n<ol>\n<li><p>I did some experimentation using the <code>ImageIcon</code> constructor with different images. I noticed that if an image or path was incorrect, the constructor <em>did not</em> return <code>null</code>. You have a check here:</p>\n<pre class=\"lang-java prettyprint-override\"><code>if (FishFrames[i] == null) {\n    System.out.println(&quot;FishFrames &quot; + i + &quot; failed to load&quot;); // checking to make sure\n}\n</code></pre>\n<p>but I don't think FishFrames[i] will ever be null.</p>\n</li>\n<li><p>In <a href=\"https://docs.oracle.com/javase/8/docs/api/java/awt/Graphics.html#drawImage-java.awt.Image-int-int-java.awt.Color-java.awt.image.ImageObserver-\" rel=\"nofollow noreferrer\">the documentation</a> for the Graphics object's drawImage() method, it states that it can return false if pixels are being changed or have not been fully loaded. You could check the return value of that function when drawing the cat to see if it ever returns false.</p>\n</li>\n<li><p>I know you were previously asked if you checked the image filenames for correctness. I also note that in your question you state that the images are under src -&gt; Images -&gt; KittyDown -&gt; KittyDown 0.png, KittyDown 1.png, etc. One thing you could check is where the compiled .class files are being executed from. Is it possible you have a directory other than src, where there is a copy of the Images directory that is old or missing some files? The relative directory for filenames you specify in the code is based on where the .class file is being executed from.</p>\n</li>\n<li><p>You can also check your the images that aren't appearing for transparency (alpha channel values of 1.0 I think) to make sure they aren't transparent.</p>\n</li>\n</ol>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 2702148,
      "reputation" : 28,
      "user_id" : 2332649,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/773f6a099e7b740e116665c799852a60?s=256&d=identicon&r=PG",
      "display_name" : "Liam",
      "link" : "https://stackoverflow.com/users/2332649/liam"
    },
    "creation_date" : 1746666893,
    "last_activity_date" : 1746666893,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140399950,
    "post_id" : 79607354,
    "body" : "Try adding some debugging code, like: <code>Path downImageFile = Path.of(&quot;Images&#47;KittyDown&#47;KittyDown &quot; + i + &quot; copy.png&quot;); System.out.println(&quot;\\&quot;&quot; + downImageFile + &quot;\\&quot; exists: &quot; + Files.exists(downImageFile));</code>  (For now, Iâ€™m ignoring the fact that you should be using Class.getResource rather than filenames.)",
    "score" : 0,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44936,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1746529338,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140397786,
    "post_id" : 79607354,
    "body" : "This was while I was checking if its the images themselves were the problem, but I changed it back to &quot;Images/KittyDown/KittyDown &quot; + i + &quot;.png&quot;. Unfortunately, that was not the issue...",
    "score" : 0,
    "owner" : {
      "account_id" : 41797975,
      "reputation" : 11,
      "user_id" : 30453997,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/44533cff37565491c98b8b83f79742e3?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Dimitri",
      "link" : "https://stackoverflow.com/users/30453997/dimitri"
    },
    "creation_date" : 1746467193,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140397753,
    "post_id" : 79607354,
    "body" : "Is this file name correct? <code>&quot;Images&#47;KittyDown&#47;KittyDown &quot; + i + &quot; copy.png&quot;</code> it is the only one with <code>copy</code> and a space in the name.",
    "score" : 1,
    "owner" : {
      "account_id" : 209503,
      "reputation" : 23867,
      "user_id" : 460557,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/b4565f97815833390c9c880e9e8522e4?s=256&d=identicon&r=PG",
      "display_name" : "Jorge Campos",
      "link" : "https://stackoverflow.com/users/460557/jorge-campos"
    },
    "creation_date" : 1746466407,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}