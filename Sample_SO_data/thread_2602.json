{
  "question" : {
    "question_id" : 79609481,
    "title" : "Spring @Retryable annotation -- why trying to recover on unmentioned exceptions?",
    "body" : "<p>I'm trying to use <code>@Retryable</code> and <code>@Recover</code> and there's clearly something I am missing.</p>\n<p>The (very paraphrased, very simplified) code is essentially</p>\n<pre><code>// MyRetryableException is a RuntimeException\n@Retryable(retryFor = MyRetryableException.class, maxAttempts = 3)\npublic void doSomething(String s) throws JustGiveUpException {\n    final var response = talkToSomething(s);\n    if (response.getStatus().equals(&quot;retryableProblem&quot;)) {\n        throw new MyRetryableException(s);\n    else if (response.getStatus().equals(&quot;someOtherProblem&quot;)) {\n        throw new JustGiveUpException(s);\n    }\n}\n\n// UnableToCommunicateException is a RuntimeException\n@Recover\npublic void handleFailedRetries(MyRetryableException e, String s) {\n    throw new UnableToCommunicateException(s);\n}\n</code></pre>\n<p>When the response status is <code>retryableProblem</code> everything works as I'd expect. When I test the code using a mock that will always return a response with <code>retryableProblem</code> I ultimately get back a <code>UnableToCommunicateException</code> and can verify that <code>talkToSomething</code> was indeed called three times.</p>\n<p>But when the response status is <code>someOtherProblem</code> I don't get what I'm expecting.  I expected to get a <code>JustGiveUpException</code>.  But instead I get an <code>ExhaustedRetryException</code> with a cause of <code>JustGiveUpException</code> and a message of <code>Cannot locate recovery method</code>. Though I do see that <code>talkToSomething</code> is only called once.</p>\n<p>Why is that happening?  I'm telling the <code>Retryable</code> annotation that it only should retry on <code>MyRetryableException</code>.  So why is it trying to retry/recover on another exception?</p>\n",
    "tags" : [ "java", "spring", "spring-retry", "retry-logic" ],
    "owner" : {
      "account_id" : 179030,
      "reputation" : 13980,
      "user_id" : 411393,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/f2e5f9f5893bd92a1eaa3f55bc3c3055?s=256&d=identicon&r=PG",
      "display_name" : "QuantumMechanic",
      "link" : "https://stackoverflow.com/users/411393/quantummechanic"
    },
    "is_answered" : true,
    "view_count" : 284,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1746603195,
    "creation_date" : 1746565177,
    "link" : "https://stackoverflow.com/questions/79609481/spring-retryable-annotation-why-trying-to-recover-on-unmentioned-exceptions",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79610012,
    "question_id" : 79609481,
    "body" : "<p>You can try below annotation on doSomething() method:</p>\n<p>@Retryable(retryFor = MyRetryableException.<strong>class</strong>, notRecoverable=JustGiveUpException.<strong>class</strong>, maxAttempts = 3, backoff = @Backoff(delay = 2000))</p>\n<p>Most probably, the spring-retry version that you are using, requires &quot;notRecoverable&quot; attribute to specify the Exception(s) which needs to be excluded from retry logic.</p>\n<p>Hope it works.</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 3319936,
      "reputation" : 56,
      "user_id" : 2791367,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/63dd3daadaf4bc6636e059fbba80c422?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Ravindra Verma",
      "link" : "https://stackoverflow.com/users/2791367/ravindra-verma"
    },
    "creation_date" : 1746603195,
    "last_activity_date" : 1746603195,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79610012" : [ {
      "comment_id" : 140407822,
      "post_id" : 79610012,
      "body" : "@QuantumMechanic I think it does <a href=\"https://docs.spring.io/spring-retry/docs/current/apidocs/org/springframework/retry/annotation/Retryable.html#retryFor()\" rel=\"nofollow noreferrer\">docs.spring.io/spring-retry/docs/current/apidocs/org/&hellip;</a>",
      "score" : 0,
      "owner" : {
        "account_id" : 195331,
        "reputation" : 281037,
        "user_id" : 438154,
        "user_type" : "registered",
        "accept_rate" : 98,
        "profile_image" : "https://www.gravatar.com/avatar/4ec21df1e55febf8deb2e3b24b9cb39b?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Sotirios Delimanolis",
        "link" : "https://stackoverflow.com/users/438154/sotirios-delimanolis"
      },
      "creation_date" : 1746711983,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140404186,
      "post_id" : 79610012,
      "body" : "Thanks.  That does work.  But it would have been nice if the Retryable documentation talked about this behavior -- that even exceptions not specified in <code>retryFor</code> will attempt to be recovered on unless they are excluded from recovery.",
      "score" : 0,
      "owner" : {
        "account_id" : 179030,
        "reputation" : 13980,
        "user_id" : 411393,
        "user_type" : "registered",
        "accept_rate" : 100,
        "profile_image" : "https://www.gravatar.com/avatar/f2e5f9f5893bd92a1eaa3f55bc3c3055?s=256&d=identicon&r=PG",
        "display_name" : "QuantumMechanic",
        "link" : "https://stackoverflow.com/users/411393/quantummechanic"
      },
      "creation_date" : 1746623542,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}