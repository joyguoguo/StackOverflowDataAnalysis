{
  "question" : {
    "question_id" : 79707806,
    "title" : "How could I catch all exceptions while starting or running a Spring Cloud Stream app?",
    "body" : "<p>This application is for DBAs and they couldn't modify the source codes. So I must consider all situations in the application from the start of the program to the end of the program and report these problems (wrong configuration, unreachable network, unreachable db, wrong message...). It is for incremental data synchronization from one db(briefly describe db1) to other dbs(briefly describe db2), a program gets redo logs from db1 and send it to kafka, then my app will pull these logs , convert it to sql and use jdbc to execute these sql statements.  And while the application start running, It can't bind the topic in configuation, and app stopped because of exception. I wanna catch this exception in main code:</p>\n<pre><code> public static void main(String[] args) {\n        try {\n            SpringApplication.run(ConsumerApplication.class, args);\n        } catch (Exception e) {\n            // Here actually I can't catch the ProvisioningException\n            // Check for Kafka provisioning exception in the cause chain\n            Throwable rootCause = getRootCause(e);\n            if (rootCause instanceof org.springframework.cloud.stream.provisioning.ProvisioningException) {\n                logger.error(&quot;Failed to start ConsumerApplication: {} - The Kafka topic cannot be found or created. &quot; +\n                                &quot;Please check if Kafka is running and the topic exists or can be auto-created.&quot;,\n                        KAFKA_PROVISIONING_ERROR, e);\n            } else {\n                logger.error(&quot;Failed to start ConsumerApplication: {}&quot;, e.getMessage(), e);\n            }\n            System.exit(1); // Exit with error code\n        }\n    }\n</code></pre>\n<p>But it can't catch this exception.\nHere is the output in terminal:</p>\n<pre><code>2025-07-20 11:53:06 [kafka-admin-client-thread | adminclient-1] WARN  o.apache.kafka.clients.NetworkClient - [AdminClient clientId=adminclient-1] Connection to node -1 (/172.32.230.85:9092) could not be established. Broker may not be available.\n2025-07-20 11:53:28 [kafka-admin-client-thread | adminclient-1] WARN  o.apache.kafka.clients.NetworkClient - [AdminClient clientId=adminclient-1] Connection to node -1 (/172.32.230.85:9092) could not be established. Broker may not be available.\n2025-07-20 11:53:35 [main] ERROR o.s.c.stream.binding.BindingService - Failed to create consumer binding; retrying in 30 seconds\norg.springframework.cloud.stream.provisioning.ProvisioningException: Provisioning exception encountered for testtbl.testtbl\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.createTopic(KafkaTopicProvisioner.java:377)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.doProvisionConsumerDestination(KafkaTopicProvisioner.java:246)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.provisionConsumerDestination(KafkaTopicProvisioner.java:211)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.provisionConsumerDestination(KafkaTopicProvisioner.java:96)\n    at org.springframework.cloud.stream.binder.AbstractMessageChannelBinder.doBindConsumer(AbstractMessageChannelBinder.java:523)\n    at org.springframework.cloud.stream.binder.AbstractMessageChannelBinder.doBindConsumer(AbstractMessageChannelBinder.java:102)\n    at org.springframework.cloud.stream.binder.AbstractBinder.bindConsumer(AbstractBinder.java:144)\n    at org.springframework.cloud.stream.binding.BindingService.doBindConsumer(BindingService.java:186)\n    at org.springframework.cloud.stream.binding.BindingService.bindConsumer(BindingService.java:139)\n    at org.springframework.cloud.stream.binding.AbstractBindableProxyFactory.createAndBindInputs(AbstractBindableProxyFactory.java:98)\n    at org.springframework.cloud.stream.binding.InputBindingLifecycle.doStartWithBindable(InputBindingLifecycle.java:58)\n    at java.base/java.util.LinkedHashMap$LinkedValues.forEach(LinkedHashMap.java:833)\n    at org.springframework.cloud.stream.binding.AbstractBindingLifecycle.start(AbstractBindingLifecycle.java:59)\n    at org.springframework.context.support.DefaultLifecycleProcessor.doStart(DefaultLifecycleProcessor.java:284)\n    at org.springframework.context.support.DefaultLifecycleProcessor$LifecycleGroup.start(DefaultLifecycleProcessor.java:467)\n    at java.base/java.lang.Iterable.forEach(Iterable.java:75)\n    at org.springframework.context.support.DefaultLifecycleProcessor.startBeans(DefaultLifecycleProcessor.java:256)\n    at org.springframework.context.support.DefaultLifecycleProcessor.onRefresh(DefaultLifecycleProcessor.java:201)\n    at org.springframework.context.support.AbstractApplicationContext.finishRefresh(AbstractApplicationContext.java:965)\n    at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:619)\n    at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)\n    at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:753)\n    at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:455)\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:323)\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1342)\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1331)\n    at sync.ConsumerApplication.main(ConsumerApplication.java:53)\nCaused by: java.util.concurrent.TimeoutException: null\n    at java.base/java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1960)\n    at java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2095)\n    at org.apache.kafka.common.internals.KafkaFutureImpl.get(KafkaFutureImpl.java:180)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.createTopicAndPartitions(KafkaTopicProvisioner.java:413)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.createTopicIfNecessary(KafkaTopicProvisioner.java:387)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.createTopic(KafkaTopicProvisioner.java:364)\n    ... 26 common frames omitted\n2025-07-20 11:53:45 [kafka-binder-health-1] WARN  o.apache.kafka.clients.NetworkClient - [Consumer clientId=consumer-null-1, groupId=null] Bootstrap broker 172.32.230.85:9092 (id: -1 rack: null) disconnected\n2025-07-20 11:54:01 [kafka-binder-health-1] WARN  o.apache.kafka.clients.NetworkClient - [Consumer clientId=consumer-null-1, groupId=null] Bootstrap broker 172.32.230.85:9092 (id: -1 rack: null) disconnected\n2025-07-20 11:54:23 [kafka-binder-health-1] WARN  o.apache.kafka.clients.NetworkClient - [Consumer clientId=consumer-null-1, groupId=null] Connection to node -1 (/172.32.230.85:9092) could not be established. Broker may not be available.\n2025-07-20 11:54:23 [kafka-binder-health-1] WARN  o.apache.kafka.clients.NetworkClient - [Consumer clientId=consumer-null-1, groupId=null] Bootstrap broker 172.32.230.85:9092 (id: -1 rack: null) disconnected\n2025-07-20 11:54:36 [RMI TCP Connection(1)-192.168.10.104] WARN  o.s.b.a.health.HealthEndpointSupport - Health contributor org.springframework.cloud.stream.binder.kafka.KafkaBinderHealthIndicator (binders/kafka) took 60010ms to respond\n2025-07-20 11:54:55 [kafka-admin-client-thread | adminclient-2] WARN  o.apache.kafka.clients.NetworkClient - [AdminClient clientId=adminclient-2] Connection to node -1 (/172.32.230.85:9092) could not be established. Broker may not be available.\n2025-07-20 11:55:16 [kafka-admin-client-thread | adminclient-2] WARN  o.apache.kafka.clients.NetworkClient - [AdminClient clientId=adminclient-2] Connection to node -1 (/172.32.230.85:9092) could not be established. Broker may not be available.\n2025-07-20 11:55:16 [scheduling-1] ERROR o.s.c.stream.binding.BindingService - Failed to create consumer binding; retrying in 30 seconds\norg.springframework.cloud.stream.provisioning.ProvisioningException: Provisioning exception encountered for testtbl.testtbl\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.createTopic(KafkaTopicProvisioner.java:377)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.doProvisionConsumerDestination(KafkaTopicProvisioner.java:246)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.provisionConsumerDestination(KafkaTopicProvisioner.java:211)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.provisionConsumerDestination(KafkaTopicProvisioner.java:96)\n    at org.springframework.cloud.stream.binder.AbstractMessageChannelBinder.doBindConsumer(AbstractMessageChannelBinder.java:523)\n    at org.springframework.cloud.stream.binder.AbstractMessageChannelBinder.doBindConsumer(AbstractMessageChannelBinder.java:102)\n    at org.springframework.cloud.stream.binder.AbstractBinder.bindConsumer(AbstractBinder.java:144)\n    at org.springframework.cloud.stream.binding.BindingService.lambda$rescheduleConsumerBinding$1(BindingService.java:211)\n    at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)\n    at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)\n    at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)\n    at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)\n    at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n    at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n    at java.base/java.lang.Thread.run(Thread.java:1583)\nCaused by: java.util.concurrent.TimeoutException: null\n    at java.base/java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1960)\n    at java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2095)\n    at org.apache.kafka.common.internals.KafkaFutureImpl.get(KafkaFutureImpl.java:180)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.createTopicAndPartitions(KafkaTopicProvisioner.java:413)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.createTopicIfNecessary(KafkaTopicProvisioner.java:387)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.createTopic(KafkaTopicProvisioner.java:364)\n    ... 14 common frames omitted\n2025-07-20 11:56:38 [kafka-admin-client-thread | adminclient-3] WARN  o.apache.kafka.clients.NetworkClient - [AdminClient clientId=adminclient-3] Connection to node -1 (/172.32.230.85:9092) could not be established. Broker may not be available.\n2025-07-20 11:56:46 [scheduling-1] ERROR o.s.c.stream.binding.BindingService - Failed to create consumer binding; retrying in 30 seconds\norg.springframework.cloud.stream.provisioning.ProvisioningException: Provisioning exception encountered for testtbl.testtbl\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.createTopic(KafkaTopicProvisioner.java:377)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.doProvisionConsumerDestination(KafkaTopicProvisioner.java:246)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.provisionConsumerDestination(KafkaTopicProvisioner.java:211)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.provisionConsumerDestination(KafkaTopicProvisioner.java:96)\n    at org.springframework.cloud.stream.binder.AbstractMessageChannelBinder.doBindConsumer(AbstractMessageChannelBinder.java:523)\n    at org.springframework.cloud.stream.binder.AbstractMessageChannelBinder.doBindConsumer(AbstractMessageChannelBinder.java:102)\n    at org.springframework.cloud.stream.binder.AbstractBinder.bindConsumer(AbstractBinder.java:144)\n    at org.springframework.cloud.stream.binding.BindingService.lambda$rescheduleConsumerBinding$1(BindingService.java:211)\n    at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)\n    at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)\n    at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)\n    at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)\n    at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n    at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n    at java.base/java.lang.Thread.run(Thread.java:1583)\nCaused by: java.util.concurrent.TimeoutException: null\n    at java.base/java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1960)\n    at java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2095)\n    at org.apache.kafka.common.internals.KafkaFutureImpl.get(KafkaFutureImpl.java:180)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.createTopicAndPartitions(KafkaTopicProvisioner.java:413)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.createTopicIfNecessary(KafkaTopicProvisioner.java:387)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.createTopic(KafkaTopicProvisioner.java:364)\n    ... 14 common frames omitted\n2025-07-20 11:57:46 [kafka-admin-client-thread | adminclient-4] WARN  o.apache.kafka.clients.NetworkClient - [AdminClient clientId=adminclient-4] Connection to node -1 (/172.32.230.85:9092) could not be established. Broker may not be available.\n2025-07-20 11:58:07 [kafka-admin-client-thread | adminclient-4] WARN  o.apache.kafka.clients.NetworkClient - [AdminClient clientId=adminclient-4] Connection to node -1 (/172.32.230.85:9092) could not be established. Broker may not be available.\n2025-07-20 11:58:16 [scheduling-1] ERROR o.s.c.stream.binding.BindingService - Failed to create consumer binding; retrying in 30 seconds\norg.springframework.cloud.stream.provisioning.ProvisioningException: Provisioning exception encountered for testtbl.testtbl\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.createTopic(KafkaTopicProvisioner.java:377)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.doProvisionConsumerDestination(KafkaTopicProvisioner.java:246)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.provisionConsumerDestination(KafkaTopicProvisioner.java:211)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.provisionConsumerDestination(KafkaTopicProvisioner.java:96)\n    at org.springframework.cloud.stream.binder.AbstractMessageChannelBinder.doBindConsumer(AbstractMessageChannelBinder.java:523)\n    at org.springframework.cloud.stream.binder.AbstractMessageChannelBinder.doBindConsumer(AbstractMessageChannelBinder.java:102)\n    at org.springframework.cloud.stream.binder.AbstractBinder.bindConsumer(AbstractBinder.java:144)\n    at org.springframework.cloud.stream.binding.BindingService.lambda$rescheduleConsumerBinding$1(BindingService.java:211)\n    at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)\n    at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)\n    at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)\n    at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)\n    at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n    at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n    at java.base/java.lang.Thread.run(Thread.java:1583)\nCaused by: java.util.concurrent.TimeoutException: null\n    at java.base/java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1960)\n    at java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2095)\n    at org.apache.kafka.common.internals.KafkaFutureImpl.get(KafkaFutureImpl.java:180)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.createTopicAndPartitions(KafkaTopicProvisioner.java:413)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.createTopicIfNecessary(KafkaTopicProvisioner.java:387)\n    at org.springframework.cloud.stream.binder.kafka.provisioning.KafkaTopicProvisioner.createTopic(KafkaTopicProvisioner.java:364)\n    ... 14 common frames omitted\n2025-07-20 11:59:34 [kafka-admin-client-thread | adminclient-5] WARN  o.apache.kafka.clients.NetworkClient - [AdminClient clientId=adminclient-5] Connection to node -1 (/172.32.230.85:9092) could not be established. Broker may not be available.\n\n\n</code></pre>\n<p>I try to catch the PrevisionException in the main, but this app's output is not what I excepted.</p>\n",
    "tags" : [ "java", "spring", "database", "spring-kafka" ],
    "owner" : {
      "account_id" : 25944026,
      "reputation" : 1,
      "user_id" : 19662995,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AItbvmmaojPyhhNUPj-PaWTwxCeM1vZ1r8TFqp_GLF1f=k-s256",
      "display_name" : "P2ink",
      "link" : "https://stackoverflow.com/users/19662995/p2ink"
    },
    "is_answered" : false,
    "view_count" : 86,
    "answer_count" : 1,
    "score" : -1,
    "last_activity_date" : 1753017992,
    "creation_date" : 1752995789,
    "link" : "https://stackoverflow.com/questions/79707806/how-could-i-catch-all-exceptions-while-starting-or-running-a-spring-cloud-stream",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79707818,
    "question_id" : 79707806,
    "body" : "<ol>\n<li><p>Use <code>@ServiceActivator</code> on the <code>.errors</code> channel to catch runtime message exceptions.</p>\n</li>\n<li><p>Use <code>try-catch</code> blocks inside your consumer functions for fine-grained handling.</p>\n</li>\n<li><p>Wrap your <code>main</code> method with a <code>try-catch</code> to handle startup exceptions.</p>\n</li>\n</ol>\n",
    "score" : -1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 43130621,
      "reputation" : 1,
      "user_id" : 31094025,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5d2d6d6fe585a9adeb368fe37d823c55?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "V T VENKATESH",
      "link" : "https://stackoverflow.com/users/31094025/v-t-venkatesh"
    },
    "creation_date" : 1752996849,
    "last_activity_date" : 1752996849,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140608941,
    "post_id" : 79707806,
    "body" : "It appears Spring is using an ExecutorService, which has its own threads, to make those BindingService calls.  You cannot catch exceptions which occur in other threads.",
    "score" : 0,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44936,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1753187664,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}