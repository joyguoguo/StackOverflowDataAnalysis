{
  "question" : {
    "question_id" : 79609529,
    "title" : "How to handle recyclerview delete, undo and permanently delete items",
    "body" : "<p>I have the method in my NoteActivity class and the NoteAdapter class. I'm facing some issues.</p>\n<ol>\n<li><p>I'm getting &quot;java lang null pointer exception&quot; attempt to invoke interface method NoteAdapter$onItemListener onItemClick java lang String on Null object reference and pointing to my view holder class timeNameHolder.onClick.</p>\n</li>\n<li><p>When clicking delete and I UNDO the delete, the deleted item when it is restored the colour changes as it supposed to but the item that replaced the deleted item now on its original position is also highlighted which it should change to default.</p>\n</li>\n<li><p>Occasionally I get index out of bounds.</p>\n</li>\n</ol>\n<p>So I don't know what is happening, can anyone help?</p>\n<pre class=\"lang-none prettyprint-override\"><code>        noteAdapter.setOnItemClickListener(new NoteAdapter.OnItemClickListener() {\n            @Override\n            public void onItemSelect(int position, timeNameViewHolder holder) {\n                try {\n                    isNotifEnabled = false;\n                    DataHolder.creatingNote = false;\n                    current = java.util.Calendar.getInstance();\n                    selectedPosition = position;\n                    System.out.println(&quot;onItemSelect position: &quot; + position);\n                    selectedNote = noteAdapter.getCurrentNotes().get(position);\n                    selectedNoteId = selectedNote.getNoteId();\n                    if (DataHolder.hideEditButton != true) {\n                        Save.setVisibility(View.VISIBLE);\n                        Save.setText(&quot;Create&quot;);\n                    }\n                    noteAdapter.setSelectedPosition(position);\n                    linearLayoutMA4.setVisibility(View.VISIBLE);\n                    linearLayoutMA3.setVisibility(View.GONE);\n                    toolbar.setTitle(&quot;Your Notes&quot;);\n                    String titleEntered = selectedNote.getTitle();\n                    String descriptionEntered = selectedNote.getDescription();\n                    created = selectedNote.getCreatedAt();\n                    long updated = selectedNote.getUpdatedAt();\n                    enteredTitle.setText(titleEntered);\n                    enteredDescription.setText(descriptionEntered);\n                    getSetUpdated(created, updated, selectedNote);\n                    long currenMilliTime = current.getTimeInMillis();\n                    if (DataHolder.notificationTime(selectedNote) &gt; currenMilliTime) {\n                        notifiActiveOff1.setImageResource(R.drawable.notifications_active);\n                        notificationText1.setText(&quot;Notification On&quot;);\n                        notifiActiveOff2.setImageResource(R.drawable.notifications_active);\n                        notificationText2.setText(&quot;Notification On&quot;);\n                        isNotificationOn = true;\n                    } else {\n                        notifiActiveOff1.setImageResource(R.drawable.notifications_off);\n                        notificationText1.setText(&quot;Notification Off&quot;);\n                        notifiActiveOff2.setImageResource(R.drawable.notifications_off);\n                        notificationText2.setText(&quot;Notification Off&quot;);\n                    }\n                }\n                catch (Exception e) {\n                }\n            }\n            @Override\n            public void onEditClick(int noteId, String title, String description){\n                try {\n                    isNotifEnabled = true;\n                    DataHolder.creatingNote = false;\n                    enterTittle.setText(title);\n                    enterDescription.setText(description);\n                    selectedNoteId = noteId;\n                    Save.setText(&quot;Save&quot;);\n                    toolbar.setTitle(&quot;Editing Notes&quot;);\n                    isEditing = true;\n                    linearLayoutMA4.setVisibility(View.GONE);\n                    linearLayoutMA3.setVisibility(View.VISIBLE);\n                    enteredTitle.setText(&quot;&quot;);\n                    enteredDescription.setText(&quot;&quot;);\n                } catch (Exception e) {\n                }\n            }\n            @Override\n            public void onDeleteClick(int position, int noteId, timeNameViewHolder holder) {\n                DataHolder.creatingNote = false;\n                //CANCEL NOTIFICATION DISPLAYED IN NOTIFICATION BAR IF CANCELLED HERE\n                if (isDeleting) {\n                    return;\n                }\n                isDeleting = true;\n                //System.out.println(&quot;isDeleting: &quot; + isDeleting);\n                //System.out.println(&quot;selectedNoteId: &quot; + selectedNoteId);\n                if (selectedNoteId == -1) {\n                    //isDeleting = false;\n                    //return;\n                }\n                //System.out.println(&quot;selectedNoteId: &quot; + selectedNoteId);\n                //System.out.println(&quot;selectedPosition: &quot; + selectedPosition);\n                //System.out.println(&quot;position: &quot; + position);\n                final int deletedPosition = selectedPosition;\n                //System.out.println(&quot;deletedPosition: &quot; + deletedPosition + &quot; noteAdapter.getItemCount(): &quot; + noteAdapter.getItemCount());\n                if (deletedPosition &lt; 0 || deletedPosition &gt;= noteAdapter.getItemCount()) {\n                    //isDeleting = false;\n                    //return;\n                }\n                //System.out.println(&quot;CHECK CHECK CHECK CHECK&quot;);\n                final Note noteToDelete = noteAdapter.getNoteAt(deletedPosition);\n                if (currentSnackbar != null &amp;&amp; currentSnackbar.isShown()) {\n                    currentSnackbar.dismiss();\n                }\n                noteAdapter.getCurrentNotes().remove(deletedPosition);\n                noteAdapter.notifyItemRemoved(deletedPosition);\n                deleteQueue.offer(new PendingDelete(noteToDelete, deletedPosition));\n                clearNoteUI();\n                new Handler(Looper.getMainLooper()).postDelayed(new Runnable() {\n                    @Override\n                    public void run() {\n                        if (noteAdapter.getItemCount() &gt; 0) {\n                            int newPosition;\n                            if (deletedPosition == 0) {\n                                newPosition = 0;\n                            } else {\n                                newPosition = deletedPosition - 1;\n                            }\n                            noteAdapter.setSelectedPosition(newPosition);\n                            updateUIWithNote(noteAdapter.getNoteAt(newPosition));\n                        } else {\n                            noteAdapter.resetSelection();\n                        }\n                    }\n                }, 200);\n                // Create new Snackbar\n                currentSnackbar = Snackbar.make(recyclerView, &quot;Note deleted&quot;, Snackbar.LENGTH_LONG);\n                currentSnackbar.setAction(&quot;UNDO&quot;, new View.OnClickListener() {\n                    @Override\n                    public void onClick(View v) {\n                        PendingDelete pendingDelete = deleteQueue.poll();\n                        if (pendingDelete != null) {\n                            Note restoredNote = pendingDelete.getNote();\n                            int position = pendingDelete.getPosition();\n                            noteAdapter.restoreDeletedNote(position, restoredNote);\n                            noteAdapter.setSelectedPosition(position);\n                            recyclerView.scrollToPosition(position);\n                            updateUIWithNote(restoredNote);\n                            isDeleting = false;\n                        }\n                    }\n                });\n                currentSnackbar.addCallback(new Snackbar.Callback() {\n                    @Override\n                    public void onDismissed(Snackbar snackbar, int event) {\n                        if (event == Snackbar.Callback.DISMISS_EVENT_TIMEOUT) {\n                            PendingDelete pendingDelete = deleteQueue.poll();\n                            if (pendingDelete != null) {\n                                cancelNotification();\n                                noteViewModel.delete(pendingDelete.getNote());\n                                if (noteAdapter.getItemCount() != 0) {\n                                    int newPosition = Math.max(0, Math.min(deletedPosition - 1, noteAdapter.getItemCount() - 1));\n                                    Note newNote = noteAdapter.getNoteAt(newPosition);\n                                    if (newNote != null) {\n                                        selectedNoteId = selectedNote.getNoteId();\n                                        selectedPosition = newPosition;\n                                        updateUIWithNote(newNote);\n                                        recyclerView.scrollToPosition(newPosition);\n                                    }\n                                }\n                                else {\n                                    if (DataHolder.hideEditButton == true &amp;&amp; noteAdapter.getItemCount() == 0) {\n                                        finish();\n                                    }\n                                    else {\n                                        savedDayMonthYear1.setText(&quot;Date: &quot; + todatDate);\n                                        editedDayMonthYear1.setText(&quot;Edited: No Edits&quot;);\n                                        savedDayMonthYear2.setText(&quot;Date: &quot; + todatDate);\n                                        editedDayMonthYear2.setText(&quot;Edited: No Edits&quot;);\n                                        showEditTextMode();\n                                    }\n                                }\n                                DataHolder.creatingNote = true;\n                                isDeleting = false;\n                            }\n                        }\n                    }\n                });\n                currentSnackbar.show();\n            }\n        });\n    }\n\n\n @NonNull\n    @Override\n    public timeNameViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {\n        LayoutInflater inflater = LayoutInflater.from(parent.getContext());\n        View view = inflater.inflate(R.layout.list_item, parent, false);\n        ViewGroup.LayoutParams layoutParams = view.getLayoutParams();\n        return new timeNameViewHolder(view, onItemListener);\n    }\n    public interface OnItemClickListener {\n        void onEditClick(int noteId, String title, String description);\n        void onDeleteClick(int position, int noteId, timeNameViewHolder holder);\n        void onItemSelect(int position, timeNameViewHolder holder);\n    }\n    public void setOnItemClickListener(OnItemClickListener listener) {\n        this.listener = listener;\n    }\n    public void setNotes(List&lt;Note&gt; notes) {\n        this.notes = notes;\n        notifyDataSetChanged();\n    }\n\n    public List&lt;Note&gt; getCurrentNotes() {\n        return notes;\n    }\n\n    /*\n    public void setSelectedPosition(int position) {\n        //if (position &gt;= 0 &amp;&amp; position &lt; getItemCount()) {\n            int oldPosition = selectedPosition;\n            selectedPosition = position;\n            notifyItemChanged(oldPosition);\n            notifyItemChanged(selectedPosition);\n        //}\n        //else {\n            //int oldPosition = selectedPosition;\n            //selectedPosition = -1;\n            //if (oldPosition != -1) {\n                //notifyItemChanged(oldPosition);\n            //}\n        }\n     */\n    public int getSelectedPosition() {\n        return selectedPosition;\n    }\n\n    public void setSelectedPosition(int position) {\n        int oldSelectedPosition = selectedPosition;\n        this.selectedPosition = position;\n        notifyItemChanged(oldSelectedPosition);\n        notifyItemChanged(selectedPosition);\n    }\n\n    public Note getNoteAt(int position) {\n       return notes.get(position);\n    }\n\n    public void resetSelection() {\n        this.selectedPosition = RecyclerView.NO_POSITION;\n        notifyDataSetChanged();\n    }\n\n    public void restoreDeletedNote(int position, Note note) {\n        notes.add(position, note);\n        notifyItemInserted(position);\n        setSelectedPosition(position);\n    }\n\n    public int getNotePositionById(int noteId) {\n        for (int i = 0; i &lt; notes.size(); i++) {\n            if (notes.get(i).getNoteId() == noteId) {\n                return i;\n            }\n        }\n        return -1;\n    }\n\n    public void setVisibility(timeNameViewHolder holder) {\n        if (DataHolder.hideEditButton == true) {\n            holder.imageEdit.setVisibility(View.GONE);\n        }\n        else {\n            holder.imageEdit.setVisibility(View.VISIBLE);\n        }\n    }\n\n    @Override\n    public void onBindViewHolder(@NonNull timeNameViewHolder holder, int position) {\n        Note currentNote = notes.get(position);\n        holder.timeNameCell.setText(currentNote.getTitle());\n\n        if (position == selectedPosition) {\n            holder.timeNameCell.setBackgroundColor(Color.parseColor(&quot;#5D81FF&quot;));\n            holder.imageDelete.setVisibility(View.VISIBLE);\n            setVisibility(holder);\n        } else {\n            //holder.timeNameCell.setBackgroundColor(Color.LTGRAY);\n            holder.timeNameCell.setBackgroundColor(Color.GREEN);\n            holder.imageDelete.setVisibility(View.GONE);\n            holder.imageEdit.setVisibility(View.GONE);\n        }\n\n        holder.timeNameCell.setOnClickListener(v -&gt; {\n            selectedPosition = holder.getAdapterPosition();\n            if (listener != null) {\n                listener.onItemSelect(position, holder);\n            }\n            notifyDataSetChanged();\n        });\n\n        holder.imageEdit.setOnClickListener(v -&gt; {\n            if (listener != null) {\n                listener.onEditClick(currentNote.getNoteId(), currentNote.getTitle(), currentNote.getDescription());\n            }\n        });\n\n        holder.imageDelete.setOnClickListener(v -&gt; {\n            if (listener != null) {\n                listener.onDeleteClick(position, currentNote.getNoteId(), holder);\n            }\n        });\n    }\n\n    private void restoreItem() {\n        DataHolder.deleted = false;\n        isRestored = true;\n        DataHolder.isRestored2 = true;\n        itemViewActive = false;\n        //enteredTitle.setText(deletedTimeName);\n        //enteredDescription.setText(deletedDescrList);\n        timeName.add(recentlyDeletedItemPosition, deletedTimeName);\n        descrList.add(recentlyDeletedItemPosition, deletedDescrList);\n        savingEdit.add(recentlyDeletedItemPosition, deletedSavingEdit);\n        notifyItemInserted(recentlyDeletedItemPosition);\n    }\n    \n\n    @Override\n    public int getItemCount() {\n        return notes.size();\n    }\n\n    public interface OnItemListener {\n        void onItemClick(int position, String timeText);\n    }\n</code></pre>\n",
    "tags" : [ "java", "android", "android-recyclerview", "adapter", "android-snackbar" ],
    "owner" : {
      "account_id" : 30224010,
      "reputation" : 1,
      "user_id" : 23163004,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/496b55bd2c1c91015dfdf9fc5e8fb1ee?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "sibunuel",
      "link" : "https://stackoverflow.com/users/23163004/sibunuel"
    },
    "is_answered" : false,
    "view_count" : 27,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1746568015,
    "creation_date" : 1746568015,
    "link" : "https://stackoverflow.com/questions/79609529/how-to-handle-recyclerview-delete-undo-and-permanently-delete-items",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}