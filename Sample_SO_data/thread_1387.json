{
  "question" : {
    "question_id" : 79712563,
    "title" : "Snowflake stored procedure returns no results via JDBC but works in web UI",
    "body" : "<p>I'm attempting to invoke a Snowflake stored procedure from my Java application, but I consistently receive the following error:</p>\n<blockquote>\n<p>Stored procedure execution error on line 1 position 20: Missing rowset from response. No results found.</p>\n</blockquote>\n<p>Interestingly, the same procedure executes correctly and returns the expected results when run directly in the Snowflake UI. I also attempted to convert the results to JSON within the procedure, but the error persists.</p>\n<p>Could this be related to how Snowflake procedures return result sets when called via JDBC or from external clients? How can I correctly retrieve tabular output from a stored procedure in a Java application?</p>\n<p>Here's the SQL query for reference:</p>\n<pre class=\"lang-sql prettyprint-override\"><code>SELECT * FROM TABLE(MY_DB.MY_SCHEMA.MY_PROCEDURE());\n</code></pre>\n<p>Java code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public List&lt;ResultDTO&gt; fetchResults() throws SQLException {\n    List&lt;ResultDTO&gt; results = new ArrayList&lt;&gt;();\n\n    Properties props = new Properties();\n    props.put(&quot;user&quot;, username);\n    props.put(&quot;password&quot;, password);\n\n    try (Connection conn = DriverManager.getConnection(url, props)) {\n        try (Statement stmt = conn.createStatement()) {\n            stmt.execute(&quot;ALTER SESSION SET JDBC_QUERY_RESULT_FORMAT='JSON'&quot;);\n        }\n\n        try (PreparedStatement pstmt = conn.prepareStatement(&quot;SELECT * FROM TABLE(MY_DB.MY_SCHEMA.MY_PROCEDURE());&quot;)) {\n            ResultSet rs = pstmt.executeQuery();\n\n            while (rs.next()) {\n                ResultDTO dto = new ResultDTO();\n                dto.setFlagA(rs.getBoolean(&quot;FLAG_A&quot;));\n                dto.setLimitExceeded(rs.getBoolean(&quot;LIMIT_EXCEEDED&quot;));\n                dto.setMessage(rs.getString(&quot;MESSAGE&quot;));\n                results.add(dto);\n            }\n        }\n    }\n\n    return results;\n}\n</code></pre>\n<p>Snowflake Procedure:</p>\n<pre class=\"lang-sql prettyprint-override\"><code>CREATE OR REPLACE PROCEDURE MY_DB.SCHEMA.DETECT_PROC()\nRETURNS TABLE (\n    &quot;FLAG_A&quot; BOOLEAN, \n    &quot;LIMIT_EXCEEDED&quot; BOOLEAN, \n    &quot;MESSAGE&quot; VARCHAR\n)\nLANGUAGE PYTHON\nRUNTIME_VERSION = '3.11'\nPACKAGES = ('numpy==2.3.1','scikit-learn==1.6.1','snowflake-snowpark-python==*')\nHANDLER = 'main'\nIMPORTS = (\n    '@MY_DB.SCHEMA.UTILS/processor.py',\n    '@MY_DB.SCHEMA.UTILS/analyzer.py'\n)\nEXECUTE AS OWNER\nAS '\n//Python Code\n';\n</code></pre>\n",
    "tags" : [ "java", "jdbc", "snowflake-cloud-data-platform" ],
    "owner" : {
      "account_id" : 43193826,
      "reputation" : 1,
      "user_id" : 31128434,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/8a57bfc2c9e947d8315ec0cda236faa4?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Symantic",
      "link" : "https://stackoverflow.com/users/31128434/symantic"
    },
    "is_answered" : false,
    "view_count" : 87,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1753425044,
    "creation_date" : 1753304688,
    "link" : "https://stackoverflow.com/questions/79712563/snowflake-stored-procedure-returns-no-results-via-jdbc-but-works-in-web-ui",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79712573,
    "question_id" : 79712563,
    "body" : "<p>Given the SQL called by the JDBC/Java code is a SELECT. The problem is not really this part.</p>\n<p>But to prove this is not the problem you could change to:</p>\n<pre><code>select seq, index, value from table(flatten(array_generate_range(1,4)))\n</code></pre>\n<p>which gives three rows.</p>\n<p>So assuming that works in your Java code, this implies the failure to generate results inside your proc, it might be a permission problem, if your original select code runs in WebUI generates results. The first place is to check in the query history, but if it's a different user, you will not be able to see the results of that query. But you should be able to see no errors occurred. Yuo can also grant yourself the role of the JDBC users, and then turned off secondary roles, and check the results work as expected.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 18974,
      "reputation" : 26695,
      "user_id" : 43992,
      "user_type" : "registered",
      "accept_rate" : 75,
      "profile_image" : "https://www.gravatar.com/avatar/2e3113a8dd4cf6adfaebded29560874a?s=256&d=identicon&r=PG",
      "display_name" : "Simeon Pilgrim",
      "link" : "https://stackoverflow.com/users/43992/simeon-pilgrim"
    },
    "creation_date" : 1753305284,
    "last_activity_date" : 1753305284,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79712573" : [ {
      "comment_id" : 140619235,
      "post_id" : 79712573,
      "body" : "@Symantic great to hear, you are closer to resolving this.",
      "score" : 0,
      "owner" : {
        "account_id" : 18974,
        "reputation" : 26695,
        "user_id" : 43992,
        "user_type" : "registered",
        "accept_rate" : 75,
        "profile_image" : "https://www.gravatar.com/avatar/2e3113a8dd4cf6adfaebded29560874a?s=256&d=identicon&r=PG",
        "display_name" : "Simeon Pilgrim",
        "link" : "https://stackoverflow.com/users/43992/simeon-pilgrim"
      },
      "creation_date" : 1753479818,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140613919,
      "post_id" : 79712573,
      "body" : "Thanks for helping me out. I was able to run the query you provided so SQL is not the problem. Also the user through which I&#39;m trying to run the query has Ownership privilege on the Stored Procedure so, I don&#39;t think its a problem of permission too. I also checked the Query History and the query is failing.",
      "score" : 1,
      "owner" : {
        "account_id" : 43193826,
        "reputation" : 1,
        "user_id" : 31128434,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/8a57bfc2c9e947d8315ec0cda236faa4?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Symantic",
        "link" : "https://stackoverflow.com/users/31128434/symantic"
      },
      "creation_date" : 1753336900,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}