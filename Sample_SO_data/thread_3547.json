{
  "question" : {
    "question_id" : 79541331,
    "title" : "How can I save connections(ISOSource) to the JPOS?",
    "body" : "<p>I have two services that use JPOS in spring boot and first of them sends a message and the second one receives it, saves the communication channel with the first service and sends a response. Here is the code:</p>\n<pre><code>@Slf4j\n@Service\npublic class HandleMsg implements ISORequestListener {\n\n    private static ISOSource clientConnection;\n\n\n    @Override\n    public boolean process(ISOSource source, ISOMsg m) {\n        clientConnection = source;\n        try {\n            if (&quot;0800&quot;.equals(m.getMTI())) {\n                ISOMsg r = (ISOMsg) m.clone();\n                r.setResponseMTI();\n                r.set(33, &quot;Good Message&quot;);\n                source.send(r);\n                return true;\n            }\n        } catch (ISOException | IOException e) {\n            log.error(e.getMessage());\n        }\n        return false;\n    }\n\n    public void sendMessageToService(String message) {\n        try {\n            if (Objects.isNull(clientConnection) || !clientConnection.isConnected()) {\n                log.error(&quot;Client connection is null!&quot;);\n                return;\n            }\n            ISOMsg serverPush = new ISOMsg();\n            serverPush.setMTI(&quot;0210&quot;);\n            serverPush.set(33, message);\n            clientConnection.send(serverPush);\n        } catch (IOException | ISOException e) {\n            throw new RuntimeException(e);\n        }\n    }\n</code></pre>\n<p>and its .xml config for JPOS:</p>\n<pre><code>&lt;server class=&quot;org.jpos.q2.iso.QServer&quot; logger=&quot;Q2&quot; name=&quot;simulator_10000&quot;&gt;\n    &lt;attr name=&quot;port&quot; type=&quot;java.lang.Integer&quot;&gt;10000&lt;/attr&gt;\n    &lt;channel class=&quot;org.jpos.iso.channel.XMLChannel&quot; logger=&quot;Q2&quot; packager=&quot;org.jpos.iso.packager.XMLPackager&quot;/&gt;\n    &lt;request-listener class=&quot;com.example.jpos.services.HandleMsg&quot; logger=&quot;Q2&quot;/&gt;\n    &lt;in&gt;network-out&lt;/in&gt; \n    &lt;out&gt;network-in&lt;/out&gt;\n&lt;/server&gt;\n</code></pre>\n<p>As you can see, at the time of receipt, I keep the connection channel of the message source, and later I can call the class method anywhere and if the channel is still active, then send a message to the second service using it.\nBut this approach creates problems, since in order for the second service to be able to send a message to the second, the first must first send to the second service.</p>\n<p>My question sounds like this: At the moment when the first service connects and creates a communication channel with the first service, a message about this appears in the logs of the first service:</p>\n<pre><code>&lt;log realm=&quot;simulator_10000.server.session/127.0.0.1:622222&quot; at=&quot;2025-03-28T16:26:18.439899700&quot;&gt;\n  &lt;session-start/&gt;\n&lt;/log&gt;\n</code></pre>\n<p>and first services .xml config for JPOS to create connection channel:</p>\n<pre><code>&lt;channel-adaptor name='clientsimulator-adaptor'\n                 class=&quot;org.jpos.q2.iso.ChannelAdaptor&quot; logger=&quot;Q2&quot;&gt;\n    &lt;channel class=&quot;org.jpos.iso.channel.XMLChannel&quot; logger=&quot;Q2&quot;\n             packager=&quot;org.jpos.iso.packager.XMLPackager&quot;&gt;\n\n        &lt;property name=&quot;host&quot; value=&quot;${client.host}&quot; /&gt;\n        &lt;property name=&quot;port&quot; value=&quot;${client.port}&quot; /&gt;\n        &lt;property name=&quot;keep-alive&quot; value=&quot;${client.keep_alive}&quot; /&gt;\n    &lt;/channel&gt;\n    &lt;in&gt;my-send&lt;/in&gt;\n    &lt;out&gt;my-receive&lt;/out&gt;\n    &lt;reconnect-delay&gt;${client.reconnect_delay}&lt;/reconnect-delay&gt;\n&lt;/channel-adaptor&gt;\n</code></pre>\n<p>That is, he understands that he is already connected. I need him to save the data of this channel to ISOSource so that the server(the second service) I could send messages to the first service without receiving a message from it.</p>\n",
    "tags" : [ "java", "spring", "iso8583", "jpos" ],
    "owner" : {
      "account_id" : 21606474,
      "reputation" : 27,
      "user_id" : 16909643,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GhTqcuQGzYYwkb64hUOc1qzuA3VfmZlr8csEYw2=k-s256",
      "display_name" : "shaxa 2000",
      "link" : "https://stackoverflow.com/users/16909643/shaxa-2000"
    },
    "is_answered" : true,
    "view_count" : 55,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1743364648,
    "creation_date" : 1743162135,
    "link" : "https://stackoverflow.com/questions/79541331/how-can-i-save-connectionsisosource-to-the-jpos",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79545096,
    "question_id" : 79541331,
    "body" : "<p>You can use <code>ISOServer</code>'s <code>lastConnectedISOChannel</code> to get a hold of the <code>ISOChannel</code>. However, you need to ensure that the party connecting to the <code>ISOServer</code> is ready to receive messages and that the connection is not bogusâ€”such as those generated by penetration testing attempts.</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 61653,
      "reputation" : 1388,
      "user_id" : 183639,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6bffde8ac41960c91ce246a839f5d88c?s=256&d=identicon&r=PG",
      "display_name" : "apr",
      "link" : "https://stackoverflow.com/users/183639/apr"
    },
    "creation_date" : 1743364648,
    "last_activity_date" : 1743364648,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}