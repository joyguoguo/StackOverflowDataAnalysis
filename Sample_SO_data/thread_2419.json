{
  "question" : {
    "question_id" : 79621643,
    "title" : "Set up to send a message from account A ECS task to SQS in account B",
    "body" : "<p>I want to send a message from the task running ECS cluster in Account A to the SQS in account B.</p>\n<p>Referrring different documentation to do the setup, i'm little confused as it is mentioned in few cases that we need to create an assume role to acheive it and in some cases it is mentioned that we need both the assume role and also have to use the AWSSTSAssumeRoleWrapper in the java code where we send the message to the queue.</p>\n<p>We can send the message from SNS in account A to the SQS in Account B without any assume role setup. Do we really need this incase of sending message from ECS task to the SQS in different account?</p>\n",
    "tags" : [ "java", "amazon-web-services", "amazon-ec2", "amazon-ecs", "amazon-sqs" ],
    "owner" : {
      "account_id" : 8040686,
      "reputation" : 589,
      "user_id" : 6062443,
      "user_type" : "registered",
      "accept_rate" : 69,
      "profile_image" : "https://www.gravatar.com/avatar/afd8dd6c0366dc1a6d9bfac1bf5ddd19?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Rajashree Gr",
      "link" : "https://stackoverflow.com/users/6062443/rajashree-gr"
    },
    "is_answered" : false,
    "view_count" : 113,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1747261330,
    "creation_date" : 1747231332,
    "link" : "https://stackoverflow.com/questions/79621643/set-up-to-send-a-message-from-account-a-ecs-task-to-sqs-in-account-b",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79622350,
    "question_id" : 79621643,
    "body" : "<p><strong>Short: no, it is not necessary.</strong></p>\n<ul>\n<li><p>The ECS Task in account A needs permissions to send messages to SQS queue in account B.</p>\n<ul>\n<li><p>The task (container) assumes a role, which grants access to e.g. sending messages to an SQS queue. See <a href=\"https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-iam-roles.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-iam-roles.html</a> .</p>\n</li>\n<li><p>Here is a simple example for <a href=\"https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-basic-examples-of-sqs-policies.html\" rel=\"nofollow noreferrer\">SQS policy from the AWS documentation</a>:</p>\n<pre><code>{\n   &quot;Version&quot;: &quot;2012-10-17&quot;,\n   &quot;Id&quot;: &quot;Queue1_Policy_UUID&quot;,\n   &quot;Statement&quot;: [{\n      &quot;Sid&quot;:&quot;Queue1_SendMessage&quot;,\n      &quot;Effect&quot;: &quot;Allow&quot;,\n      &quot;Principal&quot;: {\n         &quot;AWS&quot;: [ \n            &quot;&lt;AccountA_ID&gt;&quot;\n         ]\n      },\n      &quot;Action&quot;: &quot;sqs:SendMessage&quot;,\n      &quot;Resource&quot;: &quot;arn:aws:sqs:us-east-2:&lt;AccountB_ID&gt;:queue1&quot;\n   }]  \n}\n</code></pre>\n</li>\n<li><p>The SDK in the java application will take care of authentication, see <a href=\"https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/credentials-chain.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/credentials-chain.html</a></p>\n</li>\n</ul>\n</li>\n<li><p>The SQS queue in account B must allow access to the ECS Task in account A.</p>\n<ul>\n<li><p><a href=\"https://docs.aws.amazon.com/lambda/latest/dg/with-sqs-cross-account-example.html\" rel=\"nofollow noreferrer\">Here is an AWS documentation for cross-account access for an SQS queue</a>. You will need the access policy for the queue:</p>\n<pre><code>{\n   &quot;Version&quot;: &quot;2012-10-17&quot;,\n   &quot;Id&quot;: &quot;Queue1_Policy_UUID&quot;,\n   &quot;Statement&quot;: [{\n      &quot;Sid&quot;:&quot;Queue1_SendMessage&quot;,\n      &quot;Effect&quot;: &quot;Allow&quot;,\n      &quot;Principal&quot;: {\n         &quot;AWS&quot;: [\n            &quot;arn:aws:iam::&lt;AccountA_ID&gt;:role/cross-account-ecs-task-role&quot;\n         ]\n      },\n      &quot;Action&quot;: &quot;sqs:SendMessage&quot;,\n      &quot;Resource&quot;: &quot;arn:aws:sqs:us-east-1:&lt;AccountB_ID&gt;:LambdaCrossAccountQueue&quot;\n    }\n  ]\n}\n</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<p><strong>Last but not least</strong>, don't forget to have a look at the <a href=\"https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-security-best-practices.html\" rel=\"nofollow noreferrer\">AWS Security Best Practises for SQS</a>.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 31361400,
      "reputation" : 178,
      "user_id" : 24179087,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/t6T3k.png?s=256",
      "display_name" : "Christian Banfi",
      "link" : "https://stackoverflow.com/users/24179087/christian-banfi"
    },
    "creation_date" : 1747261330,
    "last_activity_date" : 1747261330,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}