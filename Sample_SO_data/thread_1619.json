{
  "question" : {
    "question_id" : 79689947,
    "title" : "How to solve error multiple tools with the same name in MCP",
    "body" : "<p>I implemented two Spring AI Model Context Protocol (MCP), client and server. Especially, I used Standard MCP Client with SSE HTTP protocol and WebMVC Server Transport for MCP sever. Both start without problem. But, when I send a request to MCP Client, I get an error like Multiple tools with the same name found in ToolCallingChatOptions. I tried to exclude SseWebFluxTransportAutoConfiguration.class and StdioTransportAutoConfiguration.class from spring ai default autoconfiguration. I still have the same problem even when I tried with Webflux protocol.</p>\n<p>Client <code>pom.xml</code>:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-ai-starter-mcp-client&lt;/artifactId&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-ai-starter-model-ollama&lt;/artifactId&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;\n    &lt;scope&gt;runtime&lt;/scope&gt;\n    &lt;optional&gt;true&lt;/optional&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n    &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n    &lt;optional&gt;true&lt;/optional&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>Client <code>application.properties</code>:</p>\n<pre class=\"lang-ini prettyprint-override\"><code>server.port=8080\n\nspring.ai.mcp.client.enabled=true\nspring.ai.mcp.client.name=mcp-client\nspring.ai.mcp.client.version=1.0.0\nspring.ai.mcp.client.request-timeout=30s\nspring.ai.mcp.client.type=SYNC\nspring.ai.mcp.client.sse.connections.mcp-server.url=http://localhost:8082\nspring.ai.mcp.client.toolcallback.enabled=true\nspring.ai.ollama.base-url= http://ip_address:port\nspring.ai.ollama.chat.options.model= model_version\nspring.ai.ollama.chat.temperature= 0.7\nspring.ai.ollama.chat.max-tokens= 8192\n</code></pre>\n<p>In my main class I tried to exclude <code>SseWebFluxTransportAutoConfiguration</code> and <code>StdioTransportAutoConfiguration</code> like that:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@SpringBootApplication(\n    exclude = {\n            SseWebFluxTransportAutoConfiguration.class,\n            StdioTransportAutoConfiguration.class\n    }\n)\npublic class McpclientApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(McpclientApplication.class, args);\n    }\n}\n</code></pre>\n<p>Server <code>pom.xml</code>:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-ai-starter-mcp-server-webmvc&lt;/artifactId&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;\n    &lt;scope&gt;runtime&lt;/scope&gt;\n    &lt;optional&gt;true&lt;/optional&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n    &lt;groupId&gt;org.postgresql&lt;/groupId&gt;\n    &lt;artifactId&gt;postgresql&lt;/artifactId&gt;\n    &lt;scope&gt;runtime&lt;/scope&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n    &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n    &lt;optional&gt;true&lt;/optional&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>Server <code>application.properties</code>:</p>\n<pre class=\"lang-ini prettyprint-override\"><code>spring.application.name=mcp-server\nserver.port=8082\nspring.main.banner-mode=off\nlogging.file.name=./logs/spring-boot-ai-mcp-server.log\n\nspring.ai.mcp.server.name=mcp-server\nspring.ai.mcp.server.version=0.0.1 \n\nspring.datasource.url= jdbc:postgresql://ip_address:port/db_name\nspring.datasource.driver-class-name=org.postgresql.Driver\nspring.datasource.username= \nspring.datasource.password= \n</code></pre>\n<p>I tried Spring AI 1.0.0 version and 1.1.0-SNAPSHOT but I still have same issue.</p>\n<p>I get error:</p>\n<pre class=\"lang-none prettyprint-override\"><code>java.lang.IllegalStateException: Multiple tools with the same name (mcp_client_mcp_server_author2, mcp_client_mcp_server_PostgreSQL, mcp_client_mcp_server_author) found in ToolCallingChatOptions\n    at org.springframework.ai.model.tool.ToolCallingChatOptions.validateToolCallbacks(ToolCallingChatOptions.java:146) ~[spring-ai-model-1.0.0.jar:1.0.0]\n    at org.springframework.ai.chat.client.DefaultChatClientUtils.toChatClientRequest(DefaultChatClientUtils.java:106) ~[spring-ai-client-chat-1.0.0.jar:1.0.0]\n    at org.springframework.ai.chat.client.DefaultChatClient$DefaultChatClientRequestSpec.call(DefaultChatClient.java:905) ~[spring-ai-client-chat-1.0.0.jar:1.0.0]\n    at com.mcpclient.mcpclient.service.ChatService.askQuestion(ChatService.java:65) ~[classes/:na]\n    at com.mcpclient.mcpclient.controller.ChatController.processPromptStreaming(ChatController.java:48) ~[classes/:na]\n    at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]\n    at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]\n    at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.8.jar:6.2.8]\n</code></pre>\n",
    "tags" : [ "java", "spring", "artificial-intelligence", "ollama", "model-context-protocol" ],
    "owner" : {
      "account_id" : 14759161,
      "reputation" : 81,
      "user_id" : 10659018,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/7de99957e55fa99e65a3075db60bdcfd?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "user10659018",
      "link" : "https://stackoverflow.com/users/10659018/user10659018"
    },
    "is_answered" : true,
    "view_count" : 652,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1751800342,
    "creation_date" : 1751621110,
    "link" : "https://stackoverflow.com/questions/79689947/how-to-solve-error-multiple-tools-with-the-same-name-in-mcp",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79691276,
    "question_id" : 79689947,
    "body" : "<p>I found a workaround based on a Github discussion <a href=\"https://github.com/spring-projects/spring-ai/issues/2650\" rel=\"nofollow noreferrer\">https://github.com/spring-projects/spring-ai/issues/2650</a></p>\n<p>So it seems like the error was caused by how ChatClient was building.</p>\n<p>For my version of code that gave an error:</p>\n<p>In Spring AI Mcp Client, in order to handle tools recovery and register the tools with the ChatClient I created a Class called McpClientConfig like that:</p>\n<pre><code>@Configuration\n@AllArgsConstructor\npublic class McpClientConfig {\n\n    @Bean\n    @Primary\n    public SyncMcpToolCallbackProvider syncMcpToolCallbackProvider(List&lt;McpSyncClient&gt;    mcpClients) {\n        return new SyncMcpToolCallbackProvider(mcpClients);\n    }\n\n    @Bean\n    public ChatClient chatClient(ChatClient.Builder chatClientBuilder, SyncMcpToolCallbackProvider tools) {\n        return chatClientBuilder.defaultToolCallbacks(tools).build();\n    }\n\n}\n</code></pre>\n<p>In my class that will use ChatClient to give a response, I implemented like this:</p>\n<pre><code>@Service\n@AllArgsConstructor\npublic class ChatService {\n\n    private final SyncMcpToolCallbackProvider toolCallbackProvider;\n    private final ChatClient chatClient;\n\n    public String askQuestion(String question) {\n        return chatClient.prompt()\n                .user(question)\n                .toolCallbacks(toolCallbackProvider)\n                .call()\n                .content();\n    }\n\n}\n</code></pre>\n<p>Solution:</p>\n<p>I changed my ChatService like that and it work fine now:</p>\n<pre><code>@Service\npublic class ChatService {\n\n    private final ChatClient chatClient;\n    public ChatService(ChatClient.Builder chatClientBuilder, List&lt;McpSyncClient&gt; mcpSyncClients) {\n        this.chatClient = chatClientBuilder\n                .defaultSystem(&quot;You are useful assistant to reply to your questions.&quot;)\n                .defaultToolCallbacks(new SyncMcpToolCallbackProvider(mcpSyncClients))\n                .build();\n    }\n\n    public String askQuestion(String question) {\n        return chatClient.prompt()\n                .user(question)\n                .call().content();\n    }\n\n}\n</code></pre>\n<p>I don't know if this is the best solution. For the moment it's what works for me. But I would like to have other suggestion for improvement if there any.</p>\n",
    "score" : 2,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 14759161,
      "reputation" : 81,
      "user_id" : 10659018,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/7de99957e55fa99e65a3075db60bdcfd?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "user10659018",
      "link" : "https://stackoverflow.com/users/10659018/user10659018"
    },
    "creation_date" : 1751742401,
    "last_activity_date" : 1751800342,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}