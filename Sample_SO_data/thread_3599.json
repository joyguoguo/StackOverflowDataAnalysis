{
  "question" : {
    "question_id" : 79537466,
    "title" : "How do I configure Tomcat to send access log to syslog-ng server on another host?",
    "body" : "<p>I have configured a Tomcat server (currently version 8.5.x) to use log4j2 to send some logging to a syslog-ng server using the following <code>log4j.xml</code> file:</p>\n<pre class=\"lang-none prettyprint-override\"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;Configuration&gt;\n    &lt;Appenders&gt;\n        &lt;Socket name=&quot;RemoteAppender&quot; host=&quot;__syslog_server_hostname_here__&quot; port=&quot;###&quot;&gt;\n          &lt;PatternLayout pattern=&quot;%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n&quot;/&gt;\n        &lt;/Socket&gt;\n        &lt;Async name=&quot;ASYNC&quot;&gt;\n          &lt;AppenderRef ref=&quot;RemoteAppender&quot;/&gt;\n        &lt;/Async&gt;\n    &lt;/Appenders&gt;\n\n    &lt;Loggers&gt;\n        &lt;Root level=&quot;info&quot;&gt;\n            &lt;AppenderRef ref=&quot;ASYNC&quot;/&gt;\n        &lt;/Root&gt;\n    &lt;/Loggers&gt;\n&lt;/Configuration&gt;\n</code></pre>\n<p>This is working well, but I'm having difficulty transitioning Tomcat's access log to do the same. The Tomcat <code>server.xml</code> has the following for reference:</p>\n<pre class=\"lang-none prettyprint-override\"><code>        &lt;Valve className=&quot;org.apache.catalina.valves.AccessLogValve&quot; directory=&quot;logs&quot;\n               fileDateFormat=&quot;yyyy-MM&quot;\n               prefix=&quot;access_log.&quot; suffix=&quot;.txt&quot;\n               pattern=&quot;%h %l %u %t &amp;quot;%r&amp;quot; %s %b&quot; /&gt;\n</code></pre>\n<p>What scant information I have found on how to do this says you need to use a <code>Log4JAccessLogValve</code>, but I don't know where to get it (is it included in some Tomcat or log4j2 jar file? some very old information says that you need to compile your own?) or how to configure it in the <code>server.xml</code> and incorporate it into the above <code>log4j.xml</code> in such a way that I can add a separate filter for it in syslog-ng. Can anyone help?</p>\n",
    "tags" : [ "java", "tomcat", "log4j", "log4j2" ],
    "owner" : {
      "account_id" : 6680358,
      "reputation" : 504,
      "user_id" : 5153779,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/rvNh9.png?s=256",
      "display_name" : "Ed Sabol",
      "link" : "https://stackoverflow.com/users/5153779/ed-sabol"
    },
    "is_answered" : true,
    "view_count" : 149,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1763910380,
    "creation_date" : 1743030508,
    "link" : "https://stackoverflow.com/questions/79537466/how-do-i-configure-tomcat-to-send-access-log-to-syslog-ng-server-on-another-host",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79827943,
    "question_id" : 79537466,
    "body" : "<p>As per my understanding, <a href=\"https://github.com/joshdevins/log4j-scribe-appender/blob/master/src/main/java/org/apache/catalina/valves/Log4JAccessLogValve.java\" rel=\"nofollow noreferrer\">Log4JAccessLogValve</a> does indeed exist. I have never used it. However, looking at the source code it is clear it is a tomcat valve. Therefore, the current access log valve on tomcat/conf/server.xml</p>\n<pre><code>&lt;Valve className=&quot;org.apache.catalina.valves.AccessLogValve&quot; directory=&quot;logs&quot;\n       prefix=&quot;localhost_access_log&quot; suffix=&quot;.txt&quot;\n       pattern=&quot;%h %l %u %t &amp;quot;%r&amp;quot; %s %b&quot; /&gt;\n</code></pre>\n<p>can be replaced with the log4j access valve. However, it uses Scribe appender I am not familiar with, so not sure if logs can be transmitted to syslog server directly through this valve. I also don't see any configurable properties on the class.</p>\n<p>Therefore, the log4j access log <em><strong>may not be a direct rout</strong></em> to writing to syslog server.</p>\n<p>Another way is to extends <a href=\"https://tomcat.apache.org/tomcat-8.5-doc/api/org/apache/catalina/valves/ValveBase.html\" rel=\"nofollow noreferrer\">ValveBase</a> class to make a custom valve and then use log4j SocketAppender to send the formatted log to syslog server. The above valve declaration can be replaced with the custom valve. Properties can be added to the valve for configurability.</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 4809624,
      "reputation" : 3855,
      "user_id" : 3883475,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/71106c6d5cd85776d437a95b7db6ba49?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Ironluca",
      "link" : "https://stackoverflow.com/users/3883475/ironluca"
    },
    "creation_date" : 1763910380,
    "last_activity_date" : 1763910380,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140304282,
    "post_id" : 79537466,
    "body" : "@EdSabol, it depends on how <code>Log4JAccessLogValve</code> is implemented. What properties will the <code>&lt;Valve&gt;</code> element accept depends on the getters/setters of the implementation. <b>Note</b>: Log4j 2 Core looks for a file named <code>log4j2.xml</code> on the classpath. A <code>log4j.xml</code> file will be ignored.",
    "score" : 0,
    "owner" : {
      "account_id" : 16269349,
      "reputation" : 16729,
      "user_id" : 11748454,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qyBNp.jpg?s=256",
      "display_name" : "Piotr P. Karwasz",
      "link" : "https://stackoverflow.com/users/11748454/piotr-p-karwasz"
    },
    "creation_date" : 1743929587,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140286111,
    "post_id" : 79537466,
    "body" : "@PiotrP.Karwasz OK. That&#39;s still hard to believe based of the number of questions about this that I have found on the Internet, but regardless... Let&#39;s say I have a jar file with a <code>Log4JAccessLogValve</code> class. What do I put in the <code>server.xml</code> and <code>log4j.xml</code>?",
    "score" : 0,
    "owner" : {
      "account_id" : 6680358,
      "reputation" : 504,
      "user_id" : 5153779,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/rvNh9.png?s=256",
      "display_name" : "Ed Sabol",
      "link" : "https://stackoverflow.com/users/5153779/ed-sabol"
    },
    "creation_date" : 1743499451,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140281431,
    "post_id" : 79537466,
    "body" : "&quot;I find it hard to believe a <code>Log4JAccessLogValve</code> wasn&#39;t added to some logj42 jar file in all these years.&quot;â€”features are only added to the Log4j project if the are of general interest to users. In all these years no user reported the need to replace the Tomcat access log. Note that access logs are an entirely separate system than normal application logs.",
    "score" : 0,
    "owner" : {
      "account_id" : 16269349,
      "reputation" : 16729,
      "user_id" : 11748454,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qyBNp.jpg?s=256",
      "display_name" : "Piotr P. Karwasz",
      "link" : "https://stackoverflow.com/users/11748454/piotr-p-karwasz"
    },
    "creation_date" : 1743409498,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140267884,
    "post_id" : 79537466,
    "body" : "@user207421 : And the Java class implementation hasn&#39;t changed in the past 9 years? I find it hard to believe a <code>Log4JAccessLogValve</code> wasn&#39;t added to some logj42 jar file in all these years. Also, that answer doesn&#39;t show what to put in the <code>log4j.xml</code> and <code>server.xml</code> files at all, so it seems very incomplete in that regard.",
    "score" : 0,
    "owner" : {
      "account_id" : 6680358,
      "reputation" : 504,
      "user_id" : 5153779,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/rvNh9.png?s=256",
      "display_name" : "Ed Sabol",
      "link" : "https://stackoverflow.com/users/5153779/ed-sabol"
    },
    "creation_date" : 1743053348,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140267340,
    "post_id" : 79537466,
    "body" : "An implementation is given <a href=\"https://stackoverflow.com/q/40172395/207421\">here</a>.",
    "score" : 0,
    "owner" : {
      "account_id" : 71739,
      "reputation" : 311869,
      "user_id" : 207421,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=256&d=identicon&r=PG",
      "display_name" : "user207421",
      "link" : "https://stackoverflow.com/users/207421/user207421"
    },
    "creation_date" : 1743033530,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}