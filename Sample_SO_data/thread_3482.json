{
  "question" : {
    "question_id" : 79546719,
    "title" : "Multiple bean definition error after updating to Spring Boot 3.4",
    "body" : "<p>I can't post real code but this is a modified version of what I'm seeing, with fake class names. On startup of my Spring application, I see this log:</p>\n<pre><code>***************************\nAPPLICATION FAILED TO START\n***************************\n\nDescription:\n\nParameter 1 of constructor in com.package.MyClass required a single bean, but 2 were found:\n    - MyClass: defined in URL [jar:file:/var/lib/jenkins/workspace/.../com/package/MyClass.class]\n    - fop.factory.pool-com.package.MyClass: defined in unknown location\n\nThis may be due to missing parameter name information\n\nAction:\n\nConsider marking one of the beans as @Primary, updating the consumer to accept multiple beans, or using @Qualifier to identify the bean that should be consumed\n\nEnsure that your compiler is configured to use the '-parameters' flag.\nYou may need to update both your build tool settings as well as your IDE.\n[See https://github.com/spring-projects/spring-framework/wiki/Upgrading-to-Spring-Framework-6.x~ILparameter-name-retention]\n</code></pre>\n<p>Was looking at 3.4 release notes (<a href=\"https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.4-Release-Notes\" rel=\"nofollow noreferrer\">https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.4-Release-Notes</a>) and it looks like this is the offending change: <code>Registered @ConfigurationProperties beans now respect @DependsOn, @Description, @Fallback, @Lazy, @Primary, @Scope and @Role annotations.</code>. Below is the failing class, which is using <code>@Primary</code> and <code>@ConfigurationProperties</code> in tandem:</p>\n<pre><code>@Component\n@Primary\n@ConfigurationProperties(prefix = &quot;fop.factory.pool&quot;)\npublic class MyClass {\n    ...\n}\n</code></pre>\n<p>From my - limited - understanding, @Primary is marking a MyClass as higher priority for being injected as a bean and @ConfigurationProperties is defining a prefix for accessing MyClass (e.g. via application.properties files and the like?). What's lost on me is how <code>@ConfigurationProperties</code> and <code>@Primary</code> working together is causing multiple bean definitions? How do I fix this? I retried with removing only the <code>@Primary</code>/<code>@ConfigurationProperties</code> but this caused runtime issues later on.</p>\n",
    "tags" : [ "java", "spring-boot", "spring-bean", "configurationproperties" ],
    "owner" : {
      "account_id" : 29607724,
      "reputation" : 25,
      "user_id" : 22691744,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/6xqCD.jpg?s=256",
      "display_name" : "Shi Lilian",
      "link" : "https://stackoverflow.com/users/22691744/shi-lilian"
    },
    "is_answered" : false,
    "view_count" : 532,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1743437351,
    "creation_date" : 1743437351,
    "link" : "https://stackoverflow.com/questions/79546719/multiple-bean-definition-error-after-updating-to-spring-boot-3-4",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140285378,
    "post_id" : 79546719,
    "body" : "Your class is in limbo, what is it an <code>@ConfigurationProperties</code> or an <code>@Component</code> it shouldn&#39;t be both. If it is used for properties remove the component and use <code>@EnableConfigurationProperties</code> or use <code>@ConfigurationPropertiesScan</code>. The class is being detected by 2 different mechanisms leading to 2 instances.",
    "score" : 1,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126800,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1743486397,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}