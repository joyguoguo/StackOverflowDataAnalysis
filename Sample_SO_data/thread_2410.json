{
  "question" : {
    "question_id" : 79622298,
    "title" : "WebFlux with WebFilter - correctly starting a long running task inside of a WebFilter without blocking response",
    "body" : "<p>Given a org.springframework.web.server.WebFilter - what are some best ways to start a &quot;longer running&quot; thread without blocking the REST response coming back to the consumer. The long running process in my case will be an IO operation persisting some data in a database. It wont really take &quot;very long&quot; but I do not want to impact the response time.</p>\n<p>Ive tried two different approaches and they seem to both work, not sure which one is considered &quot;correct&quot;.</p>\n<pre><code>  // approach #1\n  @Override\n  @NonNull\n  public Mono&lt;Void&gt; filter(ServerWebExchange exchange, WebFilterChain chain) {\n\n    String requestId = UUID.randomUUID().toString();\n    String correlationId = UUID.randomUUID().toString();\n\n    return chain.filter(exchange)\n        .doAfterTerminate(()-&gt;{\n              Mono.fromRunnable(new LongRunningTask(requestId, 10000L))\n                  .subscribeOn(Schedulers.boundedElastic())\n                  .subscribe();\n        })\n        .contextWrite(Context.of(\n            KEY_REQUEST_ID, requestId,\n            KEY_CORRELATION_ID, correlationId\n        ));\n\n  }\n</code></pre>\n<pre><code>// approach #2\n\n  @Override\n  @NonNull\n  public Mono&lt;Void&gt; filter(ServerWebExchange exchange, WebFilterChain chain) {\n\n    String requestId = UUID.randomUUID().toString();\n    String correlationId = UUID.randomUUID().toString();\n    \n    return chain.filter(exchange)\n        .publishOn(Schedulers.boundedElastic())\n        .then(Mono.fromRunnable(new LongRunningTask(requestId, 10000L)).then())\n        .contextWrite(Context.of(\n            KEY_REQUEST_ID, requestId,\n            KEY_CORRELATION_ID, correlationId\n        ));\n    \n  }\n\n\n\n\n\n</code></pre>\n",
    "tags" : [ "java", "spring", "spring-webflux", "reactive-programming", "project-reactor" ],
    "owner" : {
      "account_id" : 3237003,
      "reputation" : 1460,
      "user_id" : 2730950,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ab02acd1306770a482a2e0b2f8b5d189?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Vladimir",
      "link" : "https://stackoverflow.com/users/2730950/vladimir"
    },
    "is_answered" : false,
    "view_count" : 39,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1747258778,
    "creation_date" : 1747257303,
    "link" : "https://stackoverflow.com/questions/79622298/webflux-with-webfilter-correctly-starting-a-long-running-task-inside-of-a-webf",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}