{
  "question" : {
    "question_id" : 79574822,
    "title" : "Child class entity is not deleting in many to many relationship",
    "body" : "<pre><code>@Entity\n@Table(name = &quot;product&quot;)\npublic class Product implements Serializable {\n    private static final long serialVersionUID = 1L;\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Integer productId;\n\n\n    @ManyToMany(\n                 cascade = {CascadeType.PERSIST, CascadeType.MERGE}, \n                 fetch = FetchType.LAZY\n    )\n    @JoinTable(\n        name = &quot;product_tag_join_table&quot;, \n        joinColumns = @JoinColumn(name = &quot;productId&quot;), \n        inverseJoinColumns = @JoinColumn(name = &quot;tagId&quot;)\n    )\n    private List&lt;SearchTags&gt; tags;\n    \n}\n\n\n@Table(name = &quot;product_tags&quot;)\n@Entity\npublic class SearchTags {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Integer tagId;\n\n    @ManyToMany(\n        cascade = { CascadeType.PERSIST, CascadeType.MERGE }, \n        fetch = FetchType.EAGER, mappedBy = &quot;tags&quot;\n    )\n    private List&lt;Product&gt; products;\n\n}\n\nsearchTagRepository.deleteById(oldTag.getTagId());\n\n</code></pre>\n<p>This above line is not deleting the tag objects, at the time of debugging the code is executed but the deletion is not taking place and neither it is present in logs,\nwhat is the issue here?</p>\n",
    "tags" : [ "java", "spring-boot", "spring-data-jpa" ],
    "owner" : {
      "account_id" : 30822992,
      "reputation" : 1,
      "user_id" : 23645475,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/ACg8ocLJOFoO6I2mhDHmkcEcjrSN0rEUQ5_gt930KyCgaQzWsg=k-s256",
      "display_name" : "Neeraj Kumar",
      "link" : "https://stackoverflow.com/users/23645475/neeraj-kumar"
    },
    "is_answered" : true,
    "view_count" : 58,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1754406638,
    "creation_date" : 1744710042,
    "link" : "https://stackoverflow.com/questions/79574822/child-class-entity-is-not-deleting-in-many-to-many-relationship",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79574902,
    "question_id" : 79574822,
    "body" : "<p>You're attempting to delete a SearchTags entity that is still referenced by the Product entities in the join table (product_tag_join_table). JPA will not delete an entity if itâ€™s still linked in a <code>@ManyToMany</code> relationship and the <code>CascadeType.REMOVE</code> is not defined.</p>\n<p>Solution:</p>\n<p>1. You need to manually remove the association from both sides of the relationship before deleting the tag:</p>\n<pre class=\"lang-java prettyprint-override\"><code>SearchTags tag = searchTagRepository.findById(oldTag.getTagId()).orElseThrow();\n\n// Remove the tag from each product\nfor (Product product : tag.getProducts()) {\n    product.getTags().remove(tag);\n}\n\n// Save updated product list to update the join table\nproductRepository.saveAll(tag.getProducts());\n\n// Now you can delete the tag safely\nsearchTagRepository.delete(tag);\n</code></pre>\n<p>2. Add <code>CascadeType.REMOVE</code> (only if you want deletion to cascade):</p>\n<pre class=\"lang-java prettyprint-override\"><code>@ManyToMany(cascade = {CascadeType.PERSIST, CascadeType.MERGE, CascadeType.REMOVE},fetch =FetchType.LAZY)\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 20283848,
      "reputation" : 21,
      "user_id" : 14876952,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-ILBViw8PSkc/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucl1IDNdcrrlwkD2DuaX4o5aOBxDFg/s96-c/s256-rj/photo.jpg",
      "display_name" : "Pooja Gupta",
      "link" : "https://stackoverflow.com/users/14876952/pooja-gupta"
    },
    "creation_date" : 1744712129,
    "last_activity_date" : 1754406638,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79574900,
    "question_id" : 79574822,
    "body" : "<p>You're missing <code>CascadeType.REMOVE</code> in annotation property <code>cascade</code></p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 6740288,
      "reputation" : 2395,
      "user_id" : 5193747,
      "user_type" : "registered",
      "accept_rate" : 47,
      "profile_image" : "https://i.sstatic.net/bc7P6.png?s=256",
      "display_name" : "Kamil W",
      "link" : "https://stackoverflow.com/users/5193747/kamil-w"
    },
    "creation_date" : 1744712088,
    "last_activity_date" : 1744712088,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}