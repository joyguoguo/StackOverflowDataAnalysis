{
  "question" : {
    "question_id" : 79538850,
    "title" : "Spark giving error when writing a limited length Column of type Varbinary for Synapse database",
    "body" : "<p>I am writing output to a Azure Synapse table where the table contains a varbinary(8000) column. When writing using spark it gives error that UNSUPORTED_DATATYPE as I am trying to limit length from default MAX to 8000 as MAX is not supported by Azure Synapse.\nBelow is the error</p>\n<p>org.apache.spark.sql.catalyst.parser.ParseException:\n[UNSUPPORTED_DATATYPE] Unsupported data type &quot;VARBINARY(8000)&quot;</p>\n<pre><code>ds.write()\n            .format(FORMAT_JDBC)\n            .option(&quot;url&quot;, JDBC_URL)\n            .option(&quot;user&quot;, USER_VALUE)\n            .option(&quot;password&quot;, PASSWORD_VALUE)\n            .option(DRIVER_CLASS_NAME, &quot;com.microsoft.sqlserver.jdbc.SQLServerDriver&quot;)\n            .option(DB_TABLE, &quot;\\&quot;ImageStore\\&quot;&quot;)\n            .option(&quot;createTableColumnTypes&quot;,&quot;ImageName varchar(8000),ImageData VARBINARY(8000)&quot;)\n            .mode(SaveMode.Overwrite)\n            .save();\n</code></pre>\n<p>Note : I don't need append to an pre-existing table and need to create a new Table. Also I don't want to create a Table of Heap type in Synapse but the default CCI table.</p>\n",
    "tags" : [ "java", "apache-spark", "apache-spark-sql", "azure-synapse", "azure-synapse-analytics" ],
    "owner" : {
      "account_id" : 8861236,
      "reputation" : 11,
      "user_id" : 6617418,
      "user_type" : "registered",
      "profile_image" : "https://graph.facebook.com/1013431655391860/picture?type=large",
      "display_name" : "Nitish Sharma",
      "link" : "https://stackoverflow.com/users/6617418/nitish-sharma"
    },
    "is_answered" : false,
    "view_count" : 112,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1743162920,
    "creation_date" : 1743078406,
    "link" : "https://stackoverflow.com/questions/79538850/spark-giving-error-when-writing-a-limited-length-column-of-type-varbinary-for-sy",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79541361,
    "question_id" : 79538850,
    "body" : "<p>Regarding the ERROR when using the spark it is because spark <strong>does not directly define table schema</strong>. However, you can create the table first using SQL and then write data into it using Spark.</p>\n<blockquote>\n<p>ERROR: org.apache.spark.sql.catalyst.parser.ParseException:\n[UNSUPPORTED_DATATYPE] Unsupported data type &quot;VARBINARY(8000)</p>\n</blockquote>\n<p>As you mentioned that you are using the Synapse table and you want to limit the Varbinary(8000)</p>\n<p>I have tried the below in the dedicated sql pool</p>\n<pre><code>CREATE TABLE dbo.ImageStore2 (\n    ImageName VARCHAR(8000),\n    ImageData VARBINARY(8000)\n)\nWITH (DISTRIBUTION = ROUND_ROBIN, HEAP);\n</code></pre>\n<p><strong>Results:</strong></p>\n<p><img src=\"https://i.imgur.com/qqYoKia.png\" alt=\"enter image description here\" /></p>\n<p>As you are trying to create the table from spark and you mentioned that you</p>\n<blockquote>\n<p>Note : I don't need append to an pre-existing table and need to create a new Table.</p>\n</blockquote>\n<p>Write to Azure Synapse Dedicated SQL Pool:<br />\nIngest large volumes of data into both <strong>Internal</strong> and <strong>External</strong> tables.<br />\nSupports the following DataFrame save modes:</p>\n<ul>\n<li><strong>Append</strong></li>\n<li><strong>ErrorIfExists</strong></li>\n<li><strong>Ignore</strong></li>\n<li><strong>Overwrite</strong></li>\n</ul>\n<p><strong>Reference:</strong> <a href=\"https://learn.microsoft.com/en-us/azure/synapse-analytics/spark/synapse-spark-sql-pool-import-export?tabs=scala,scala1,scala2,python3,python4,scala5\" rel=\"nofollow noreferrer\">Azure Synapse Dedicated SQL Pool Connector for Apache Spark</a></p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 28240346,
      "reputation" : 3681,
      "user_id" : 21588212,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/7f73C.png?s=256",
      "display_name" : "Dileep Raj Narayan Thumula",
      "link" : "https://stackoverflow.com/users/21588212/dileep-raj-narayan-thumula"
    },
    "creation_date" : 1743162920,
    "last_activity_date" : 1743162920,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140272538,
    "post_id" : 79538850,
    "body" : "Tried with Binary(8000) also but it gives similar error that [UNSUPPORTED_DATATYPE] Binary(8000)",
    "score" : 0,
    "owner" : {
      "account_id" : 8861236,
      "reputation" : 11,
      "user_id" : 6617418,
      "user_type" : "registered",
      "profile_image" : "https://graph.facebook.com/1013431655391860/picture?type=large",
      "display_name" : "Nitish Sharma",
      "link" : "https://stackoverflow.com/users/6617418/nitish-sharma"
    },
    "creation_date" : 1743144652,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140270195,
    "post_id" : 79538850,
    "body" : "What is a a Synapse table?  Databricks does not have a <code>varbinary</code> data type, far as I know, just <code>binary</code>.",
    "score" : 0,
    "owner" : {
      "account_id" : 3267339,
      "reputation" : 8893,
      "user_id" : 2751573,
      "user_type" : "registered",
      "accept_rate" : 52,
      "profile_image" : "https://i.sstatic.net/GsKBw.jpg?s=256",
      "display_name" : "Andrew",
      "link" : "https://stackoverflow.com/users/2751573/andrew"
    },
    "creation_date" : 1743088355,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140269867,
    "post_id" : 79538850,
    "body" : "can you use BINARY(8000) Instead",
    "score" : 0,
    "owner" : {
      "account_id" : 28240346,
      "reputation" : 3681,
      "user_id" : 21588212,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/7f73C.png?s=256",
      "display_name" : "Dileep Raj Narayan Thumula",
      "link" : "https://stackoverflow.com/users/21588212/dileep-raj-narayan-thumula"
    },
    "creation_date" : 1743084321,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140269859,
    "post_id" : 79538850,
    "body" : "No these links do not help as we need to define schema using spark sql and not cast/convert data here.",
    "score" : 0,
    "owner" : {
      "account_id" : 8861236,
      "reputation" : 11,
      "user_id" : 6617418,
      "user_type" : "registered",
      "profile_image" : "https://graph.facebook.com/1013431655391860/picture?type=large",
      "display_name" : "Nitish Sharma",
      "link" : "https://stackoverflow.com/users/6617418/nitish-sharma"
    },
    "creation_date" : 1743084208,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140269535,
    "post_id" : 79538850,
    "body" : "<a href=\"https://learn.microsoft.com/en-us/sql/t-sql/functions/cast-and-convert-transact-sql?view=sql-server-ver16&amp;redirectedfrom=MSDN\" rel=\"nofollow noreferrer\">learn.microsoft.com/en-us/sql/t-sql/functions/&hellip;</a>  Can you check the above?",
    "score" : 0,
    "owner" : {
      "account_id" : 28240346,
      "reputation" : 3681,
      "user_id" : 21588212,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/7f73C.png?s=256",
      "display_name" : "Dileep Raj Narayan Thumula",
      "link" : "https://stackoverflow.com/users/21588212/dileep-raj-narayan-thumula"
    },
    "creation_date" : 1743080503,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140269529,
    "post_id" : 79538850,
    "body" : "<a href=\"https://learn.microsoft.com/en-us/sql/t-sql/data-types/binary-and-varbinary-transact-sql?view=sql-server-ver16\" rel=\"nofollow noreferrer\">learn.microsoft.com/en-us/sql/t-sql/data-types/&hellip;</a> Can you check the above link if it helps you?",
    "score" : 0,
    "owner" : {
      "account_id" : 28240346,
      "reputation" : 3681,
      "user_id" : 21588212,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/7f73C.png?s=256",
      "display_name" : "Dileep Raj Narayan Thumula",
      "link" : "https://stackoverflow.com/users/21588212/dileep-raj-narayan-thumula"
    },
    "creation_date" : 1743080406,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}