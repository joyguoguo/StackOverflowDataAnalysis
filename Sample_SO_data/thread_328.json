{
  "question" : {
    "question_id" : 79810188,
    "title" : "Certificate issue while sending emails with Graph API",
    "body" : "<p>When I try to send emails with Graph, I sometimes get an error as if we don't have the certificate. But the certificates are there, because otherwise emails wouldn't be sent. The error is in the Graph dependencies and not in the code. I am using JavaSDK 11.</p>\n<p>Has anyone else encountered the same problem?</p>\n<p>Dependencies:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>\n&lt;dependency&gt;\n    &lt;groupId&gt;com.microsoft.graph&lt;/groupId&gt;\n    &lt;artifactId&gt;microsoft-graph&lt;/artifactId&gt;\n    &lt;version&gt;5.54.0&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;com.microsoft.graph&lt;/groupId&gt;\n    &lt;artifactId&gt;microsoft-graph-core&lt;/artifactId&gt;\n    &lt;version&gt;2.0.18&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>Error:</p>\n<pre class=\"lang-none prettyprint-override\"><code>sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target\n    at sun.security.provider.certpath.SunCertPathBuilder.build(SunCertPathBuilder.java:148)\n    at sun.security.provider.certpath.SunCertPathBuilder.engineBuild(SunCertPathBuilder.java:129)\n    at java.security.cert.CertPathBuilder.build(CertPathBuilder.java:297)\n    at sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:434)\n    ... 38 common frames omitted\nWrapped by: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target\n    at sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:439)\n    at sun.security.validator.PKIXValidator.engineValidate(PKIXValidator.java:306)\n    at sun.security.validator.Validator.validate(Validator.java:264)\n    at sun.security.ssl.X509TrustManagerImpl.validate(X509TrustManagerImpl.java:313)\n    at sun.security.ssl.X509TrustManagerImpl.checkTrusted(X509TrustManagerImpl.java:276)\n    at sun.security.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:141)\n    at io.netty.handler.ssl.EnhancingX509ExtendedTrustManager.checkServerTrusted(EnhancingX509ExtendedTrustManager.java:69)\n    at io.netty.handler.ssl.ReferenceCountedOpenSslClientContext$ExtendedTrustManagerVerifyCallback.verify(ReferenceCountedOpenSslClientContext.java:235)\n    at io.netty.handler.ssl.ReferenceCountedOpenSslContext$AbstractCertificateVerifier.verify(ReferenceCountedOpenSslContext.java:790)\n    at io.netty.internal.tcnative.CertificateVerifierTask.runTask(CertificateVerifierTask.java:36)\n    at io.netty.internal.tcnative.SSLTask.run(SSLTask.java:48)\n    at io.netty.internal.tcnative.SSLTask.run(SSLTask.java:42)\n    at io.netty.handler.ssl.ReferenceCountedOpenSslEngine.runAndResetNeedTask(ReferenceCountedOpenSslEngine.java:1534)\n    at io.netty.handler.ssl.ReferenceCountedOpenSslEngine.access$700(ReferenceCountedOpenSslEngine.java:96)\n    at io.netty.handler.ssl.ReferenceCountedOpenSslEngine$TaskDecorator.run(ReferenceCountedOpenSslEngine.java:1509)\n    at io.netty.handler.ssl.SslHandler.runDelegatedTasks(SslHandler.java:1647)\n    at io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1493)\n    ... 22 common frames omitted\nWrapped by: javax.net.ssl.SSLHandshakeException: General OpenSslEngine problem\n    at io.netty.handler.ssl.ReferenceCountedOpenSslEngine.handshakeException(ReferenceCountedOpenSslEngine.java:1945)\n    at io.netty.handler.ssl.ReferenceCountedOpenSslEngine.wrap(ReferenceCountedOpenSslEngine.java:852)\n    at javax.net.ssl.SSLEngine.wrap(SSLEngine.java:522)\n    at io.netty.handler.ssl.SslHandler.wrap(SslHandler.java:1130)\n    at io.netty.handler.ssl.SslHandler.wrapNonAppData(SslHandler.java:974)\n    at io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1507)\n    at io.netty.handler.ssl.SslHandler.decodeNonJdkCompatible(SslHandler.java:1345)\n    at io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1385)\n    at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:529)\n    at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:468)\n    at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n    at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n    at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n    at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n    at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:800)\n    at io.netty.channel.epoll.AbstractEpollChannel$AbstractEpollUnsafe$1.run(AbstractEpollChannel.java:425)\n    at io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:173)\n    at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:166)\n    at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:470)\n    at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:413)\n    at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\n    at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n    at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n    ... 1 common frames omitted\nWrapped by: java.io.UncheckedIOException: javax.net.ssl.SSLHandshakeException: General OpenSslEngine problem\n    at com.azure.core.http.netty.NettyAsyncHttpClient.sendSync(NettyAsyncHttpClient.java:199)\n    at com.azure.core.http.HttpPipelineNextSyncPolicy.processSync(HttpPipelineNextSyncPolicy.java:38)\n    at com.azure.core.http.policy.HttpLoggingPolicy.processSync(HttpLoggingPolicy.java:134)\n    at com.azure.core.http.HttpPipelineNextSyncPolicy.processSync(HttpPipelineNextSyncPolicy.java:41)\n    at com.azure.core.implementation.http.policy.InstrumentationPolicy.processSync(InstrumentationPolicy.java:85)\n    at com.azure.core.http.HttpPipelineNextSyncPolicy.processSync(HttpPipelineNextSyncPolicy.java:41)\n    at com.azure.core.http.policy.RetryPolicy.attemptSync(RetryPolicy.java:176)\n    at com.azure.core.http.policy.RetryPolicy.attemptSync(RetryPolicy.java:188)\n    at com.azure.core.http.policy.RetryPolicy.attemptSync(RetryPolicy.java:188)\n    at com.azure.core.http.policy.RetryPolicy.attemptSync(RetryPolicy.java:188)\n    at com.azure.core.http.policy.RetryPolicy.processSync(RetryPolicy.java:126)\n    at com.azure.core.http.HttpPipelineNextSyncPolicy.processSync(HttpPipelineNextSyncPolicy.java:41)\n    at com.azure.core.http.policy.HttpPipelineSyncPolicy.processSync(HttpPipelineSyncPolicy.java:42)\n    at com.azure.core.http.policy.UserAgentPolicy.processSync(UserAgentPolicy.java:153)\n    at com.azure.core.http.HttpPipelineNextSyncPolicy.processSync(HttpPipelineNextSyncPolicy.java:41)\n    at com.azure.core.http.HttpPipeline.sendSync(HttpPipeline.java:131)\n    at com.azure.identity.implementation.HttpPipelineAdapter.send(HttpPipelineAdapter.java:67)\n    at com.microsoft.aad.msal4j.HttpHelper.executeHttpRequestWithRetries(HttpHelper.java:96)\n    at com.microsoft.aad.msal4j.HttpHelper.executeHttpRequest(HttpHelper.java:49)\n    at com.microsoft.aad.msal4j.AadInstanceDiscoveryProvider.executeRequest(AadInstanceDiscoveryProvider.java:278)\n    at com.microsoft.aad.msal4j.AadInstanceDiscoveryProvider.sendInstanceDiscoveryRequest(AadInstanceDiscoveryProvider.java:235)\n    at com.microsoft.aad.msal4j.AadInstanceDiscoveryProvider.doInstanceDiscoveryAndCache(AadInstanceDiscoveryProvider.java:339)\n    at com.microsoft.aad.msal4j.AadInstanceDiscoveryProvider.getMetadataEntry(AadInstanceDiscoveryProvider.java:88)\n    at com.microsoft.aad.msal4j.AuthenticationResultSupplier.getAuthorityWithPrefNetworkHost(AuthenticationResultSupplier.java:39)\n    at com.microsoft.aad.msal4j.AcquireTokenSilentSupplier.execute(AcquireTokenSilentSupplier.java:23)\n    at com.microsoft.aad.msal4j.AcquireTokenByClientCredentialSupplier.execute(AcquireTokenByClientCredentialSupplier.java:46)\n    at com.microsoft.aad.msal4j.AuthenticationResultSupplier.get(AuthenticationResultSupplier.java:69)\n    at com.microsoft.aad.msal4j.AuthenticationResultSupplier.get(AuthenticationResultSupplier.java:18)\n    at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1700)\n    at java.lang.Thread.run(Thread.java:829)\n</code></pre>\n",
    "tags" : [ "java", "ssl", "microsoft-graph-api" ],
    "owner" : {
      "account_id" : 44569435,
      "reputation" : 1,
      "user_id" : 31821160,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/7e46959a501aa29ea340e5babe347a27?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Giuly",
      "link" : "https://stackoverflow.com/users/31821160/giuly"
    },
    "is_answered" : false,
    "view_count" : 39,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1762385635,
    "creation_date" : 1762352255,
    "link" : "https://stackoverflow.com/questions/79810188/certificate-issue-while-sending-emails-with-graph-api",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79810704,
    "question_id" : 79810188,
    "body" : "<p>Older versions of <code>azure-core</code> or <code>azure-identity</code> had SSL context bugs when used with Netty.</p>\n<p>Add or update:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;dependency&gt;\n  &lt;groupId&gt;com.azure&lt;/groupId&gt;\n  &lt;artifactId&gt;azure-identity&lt;/artifactId&gt;\n  &lt;version&gt;1.13.1&lt;/version&gt; &lt;!-- or latest --&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n  &lt;groupId&gt;com.azure&lt;/groupId&gt;\n  &lt;artifactId&gt;azure-core-http-netty&lt;/artifactId&gt;\n  &lt;version&gt;1.15.3&lt;/version&gt; &lt;!-- or latest --&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>You can use the <code>azure-core-http-okhttp</code> client instead of Netty to avoid this class of issues entirely.</p>\n<p>If your corporate proxy intercepts HTTPS traffic, the proxyâ€™s root cert must be <strong>imported into your JDK truststore</strong>:</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 2508750,
      "reputation" : 4547,
      "user_id" : 2181703,
      "user_type" : "registered",
      "accept_rate" : 20,
      "profile_image" : "https://www.gravatar.com/avatar/f0782a6f7690b5109552cb3fe4193a72?s=256&d=identicon&r=PG",
      "display_name" : "Optional",
      "link" : "https://stackoverflow.com/users/2181703/optional"
    },
    "creation_date" : 1762385635,
    "last_activity_date" : 1762385635,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}