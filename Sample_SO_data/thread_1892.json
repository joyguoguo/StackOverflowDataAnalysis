{
  "question" : {
    "question_id" : 79667081,
    "title" : "Retrieve all pages iteratively using completablefuture",
    "body" : "<p>DAO has methods that return completableFuture. To avoid fetching huge result at once, I want to fetch it in pages from DB.\nThe recursive solution stops when result size &lt; pageSize\nHowever, to avoid possible stackoverlow error, I want to convert it to iterative solution.\nProblem is how to chain completable futures iteratively and how to stop chaining when fetched page has less than pageSize rows?</p>\n<pre><code>  public CompletionStage&lt;List&lt;Entity&gt;&gt; getAll(List&lt;String&gt; codes) {\n    return getAllBatch(codes, 1L, PAGE_SIZE);\n  }\n\n  private CompletionStage&lt;List&lt;Entity&gt;&gt; getAllBatch(List&lt;String&gt; codes, Long pageNumber, Long pageSize) {\n    return get(codes, pageSize, pageNumber)\n        .thenCompose(results -&gt; {\n          if (results.size() &lt; pageSize) {\n            return completedFuture(results);\n          }\n          else {\n            return getAllBatch(codes, pageNumber + 1, pageSize)\n                .thenApply(\n                    nextPageResults -&gt; Stream.concat(results.stream(), nextPageResults.stream())\n                        .toList());\n          }\n        });\n  }\n</code></pre>\n",
    "tags" : [ "java", "asynchronous", "recursion", "completable-future" ],
    "owner" : {
      "account_id" : 2855454,
      "reputation" : 99,
      "user_id" : 2451814,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/93d41c43fd373f615dc602425f3d8b14?s=256&d=identicon&r=PG",
      "display_name" : "bhosleviraj",
      "link" : "https://stackoverflow.com/users/2451814/bhosleviraj"
    },
    "is_answered" : false,
    "view_count" : 59,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1750050922,
    "creation_date" : 1750050922,
    "link" : "https://stackoverflow.com/questions/79667081/retrieve-all-pages-iteratively-using-completablefuture",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140535359,
    "post_id" : 79667081,
    "body" : "But <code>getAllBatch</code> doesn&#39;t call <code>getAllBatch</code>. It calls <code>thenCompose</code> and pass lambda that calls <code>getAllBatch</code> to it. It depends on implementation of <code>thenCompose</code> weither it is recursive call or not and I guess that <code>thenCompose</code> doesn&#39;t invoke said lambda but pass it to other thread.",
    "score" : 0,
    "owner" : {
      "account_id" : 4497436,
      "reputation" : 20786,
      "user_id" : 3656904,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/8bdbd1f89f8907e8e8b15ab88c084c65?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "talex",
      "link" : "https://stackoverflow.com/users/3656904/talex"
    },
    "creation_date" : 1750687545,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140535337,
    "post_id" : 79667081,
    "body" : "@talex getAllBatch calling getAllBatch is recursive",
    "score" : 0,
    "owner" : {
      "account_id" : 2855454,
      "reputation" : 99,
      "user_id" : 2451814,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/93d41c43fd373f615dc602425f3d8b14?s=256&d=identicon&r=PG",
      "display_name" : "bhosleviraj",
      "link" : "https://stackoverflow.com/users/2451814/bhosleviraj"
    },
    "creation_date" : 1750687168,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140516190,
    "post_id" : 79667081,
    "body" : "Your current code is not recursive.",
    "score" : 0,
    "owner" : {
      "account_id" : 4497436,
      "reputation" : 20786,
      "user_id" : 3656904,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/8bdbd1f89f8907e8e8b15ab88c084c65?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "talex",
      "link" : "https://stackoverflow.com/users/3656904/talex"
    },
    "creation_date" : 1750055833,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140516098,
    "post_id" : 79667081,
    "body" : "Why do you need to chain it though? Cant you use a while true loop to iteratively fetch pages, append it to a list, then break and return when the results.size() &lt; pageSize?",
    "score" : 0,
    "owner" : {
      "account_id" : 21724606,
      "reputation" : 1431,
      "user_id" : 16034206,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/MRBdT.jpg?s=256",
      "display_name" : "pebble unit",
      "link" : "https://stackoverflow.com/users/16034206/pebble-unit"
    },
    "creation_date" : 1750052070,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}