{
  "question" : {
    "question_id" : 79779722,
    "title" : "Getting (java.sql.SQLRecoverableException: IO Error: Socket read interrupted, Authentication lapse 0 ms.) when using Kafka sink with Apache Flink",
    "body" : "<p>I am currently running a small application that periodically polls data from my DB and then puts it in a Kafka topic. While running the application code independently, when I comment my Kafka sink, the application runs correctly:</p>\n<pre class=\"lang-java prettyprint-override\"><code>KafkaSink&lt;String&gt; stringSink =\n                    KafkaSinkFactory.createStringKafkaSink(props, kafkaProps, props.getProperty(&quot;asset.sync.kafka.sink.topic.name&quot;));\n\n            dbStream\n                    .map(Object::toString)   // or map your custom object to String\n                    .sinkTo(stringSink)\n                    .name(&quot;String Kafka Sink&quot;);\n</code></pre>\n<p>But running both the sink and the source together gives the exception:</p>\n<pre class=\"lang-none prettyprint-override\"><code>java.sql.SQLRecoverableException: IO Error: Socket read interrupted, Authentication lapse 0 ms.\n    at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:874)\n    at oracle.jdbc.driver.PhysicalConnection.connect(PhysicalConnection.java:793)\n    at oracle.jdbc.driver.T4CDriverExtension.getConnection(T4CDriverExtension.java:57)\n    at oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:747)\n    at oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:562)\n    at com.zaxxer.hikari.util.DriverDataSource.getConnection(DriverDataSource.java:138)\n    at com.zaxxer.hikari.pool.PoolBase.newConnection(PoolBase.java:364)\n    at com.zaxxer.hikari.pool.PoolBase.newPoolEntry(PoolBase.java:206)\n    at com.zaxxer.hikari.pool.HikariPool.createPoolEntry(HikariPool.java:476)\n    at com.zaxxer.hikari.pool.HikariPool.checkFailFast(HikariPool.java:561)\n    at com.zaxxer.hikari.pool.HikariPool.&lt;init&gt;(HikariPool.java:115)\n    at com.zaxxer.hikari.HikariDataSource.&lt;init&gt;(HikariDataSource.java:81)\n    at ***.***.hcmp.config.DBConfig.getDataSource(DBConfig.java:22)\n    at ***.***.hcmp.source.assetMaster.DBPollingSource.open(DBPollingSource.java:62)\n    at org.apache.flink.api.common.functions.util.FunctionUtils.openFunction(FunctionUtils.java:34)\n    at org.apache.flink.streaming.api.operators.AbstractUdfStreamOperator.open(AbstractUdfStreamOperator.java:101)\n    at org.apache.flink.streaming.runtime.tasks.RegularOperatorChain.initializeStateAndOpenOperators(RegularOperatorChain.java:107)\n    at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreGates(StreamTask.java:753)\n    at org.apache.flink.streaming.runtime.tasks.StreamTaskActionExecutor$SynchronizedStreamTaskActionExecutor.call(StreamTaskActionExecutor.java:100)\n    at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreInternal(StreamTask.java:728)\n    at org.apache.flink.streaming.runtime.tasks.StreamTask.restore(StreamTask.java:693)\n    at org.apache.flink.runtime.taskmanager.Task.runWithSystemExitMonitoring(Task.java:953)\n    at org.apache.flink.runtime.taskmanager.Task.restoreAndInvoke(Task.java:922)\n    at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:746)\n    at org.apache.flink.runtime.taskmanager.Task.run(Task.java:562)\n    at java.base/java.lang.Thread.run(Thread.java:829)\nCaused by: java.io.IOException: Socket read interrupted, Authentication lapse 0 ms.\n    at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:870)\n    ... 25 common frames omitted\nCaused by: java.io.InterruptedIOException: Socket read interrupted\n    at oracle.net.nt.TimeoutSocketChannel.handleInterrupt(TimeoutSocketChannel.java:258)\n    at oracle.net.nt.TimeoutSocketChannel.read(TimeoutSocketChannel.java:180)\n    at oracle.net.ns.NSProtocolNIO.doSocketRead(NSProtocolNIO.java:555)\n    at oracle.net.ns.NIOPacket.readNIOPacket(NIOPacket.java:403)\n    at oracle.net.ns.NSProtocolNIO.negotiateConnection(NSProtocolNIO.java:127)\n    at oracle.net.ns.NSProtocol.connect(NSProtocol.java:340)\n    at oracle.jdbc.driver.T4CConnection.connect(T4CConnection.java:1596)\n    at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:588)\n</code></pre>\n<p>Here is the application code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class RefreshPollingApplication {\n\n    private static final Logger log = LoggerFactory.getLogger(RefreshPollingApplication.class);\n\n    public static void main(String[] args) throws Exception {\n        ParameterTool params = ParameterTool.fromPropertiesFile(\n                RefreshPollingApplication.class.getClassLoader().getResourceAsStream(&quot;application-local.properties&quot;)\n        );\n        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n        env.getConfig().setGlobalJobParameters(params);\n        env.setParallelism(1);\n        env.setRestartStrategy(RestartStrategies.fixedDelayRestart(\n                3, \n                Time.of(10, TimeUnit.SECONDS)\n        ));\n        try{\n            Properties props = ConfigLoader.load(&quot;application-local.properties&quot;);\n            Properties kafkaProps = getKafkaProperties(props);\n            log.info(&quot;@@@@@@@@@@@@@ Properties loaded&quot;);\n\n            SimpleDBConfig dbConfig = new SimpleDBConfig(params.get(&quot;flink.jdbc.url&quot;), params.get(&quot;flink.jdbc.username&quot;), params.get(&quot;flink.jdbc.password&quot;));\n            Connection connection = dbConfig.getConnection();\n            DataStream&lt;String&gt; dbStream = env.addSource(\n                    new JdbcPollingSource()\n            ).setParallelism(1).name(&quot;DB Polling Source&quot;);\n            KafkaSink&lt;String&gt; stringSink =\n                    KafkaSinkFactory.createStringKafkaSink(props, kafkaProps, props.getProperty(&quot;****.***.kafka.sink.topic.name&quot;));\n\n            dbStream\n                    .map(Object::toString)  \n                    .sinkTo(stringSink)\n                    .name(&quot;String Kafka Sink&quot;);\n            env.execute(&quot;Refresh polling job.&quot;);\n        }catch (Exception e){\n            log.error(&quot;@@@@@@@@ERROR OCCURRED ON POLLING TASK, REASON: {}&quot;, e.getMessage());\n            throw e;\n        }\n    }\n    \n}\n</code></pre>\n<p>Source function class:</p>\n<pre><code>public class JdbcPollingSource extends RichSourceFunction&lt;String&gt; {\n\n    private volatile boolean isRunning = true;\n    private transient Connection connection;\n    private transient PreparedStatement stmt;\n\n    private String url;\n    private String userName;\n    private String password;\n\n    @Override\n    public void open(Configuration parameters) throws Exception {\n        Class.forName(&quot;oracle.jdbc.OracleDriver&quot;);\n        super.open(parameters);\n        Map&lt;String, String&gt; globalParams = getRuntimeContext()\n                .getExecutionConfig()\n                .getGlobalJobParameters()\n                .toMap();\n        ParameterTool params = ParameterTool.fromMap(globalParams);\n        this.url = params.get(&quot;flink.jdbc.url&quot;);\n        userName = params.get(&quot;flink.jdbc.username&quot;);\n        password = params.get(&quot;flink.jdbc.password&quot;);\n        reconnect();\n    }\n\n    private void reconnect() throws Exception {\n\n        if (connection != null &amp;&amp; !connection.isClosed()) {\n            try { connection.close(); } catch (Exception ignored) {}\n        }\n        try {\n            connection = DriverManager.getConnection(\n                    url, userName, password\n            );\n            stmt = connection.prepareStatement(\n                    &quot;*******&quot;\n            );\n        }catch (Exception e){\n            System.out.println(&quot;Error connecting to data source, exception -&gt; &quot; + e.getMessage());\n        }\n    }\n\n    @Override\n    public void run(SourceContext&lt;String&gt; ctx) throws Exception {\n        while (isRunning) {\n            try {\n                ResultSet rs = stmt.executeQuery();\n                while (rs.next()) {\n                    String record = rs.getLong(&quot;***&quot;) + &quot;,&quot; + rs.getString(&quot;***&quot;);\n                    ctx.collect(record);\n                }\n            } catch (SQLException e) {\n                reconnect();\n            }\n            Thread.sleep(120_000);\n        }\n    }\n\n    @Override\n    public void cancel() {\n        isRunning = false;\n        try { if (stmt != null) stmt.close(); } catch (Exception ignore) {}\n        try { if (connection != null) connection.close(); } catch (Exception ignore) {}\n    }\n}\n</code></pre>\n<p>Is it possible that a background thread is interfering with the DB connection here?</p>\n",
    "tags" : [ "java", "oracle-database", "apache-flink" ],
    "owner" : {
      "account_id" : 29947652,
      "reputation" : 23,
      "user_id" : 22950548,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/ACg8ocIq76vWRTJKY6h5-X3BOl0A0CdSMDf_SIYsXuJcJr4F=k-s256",
      "display_name" : "Parth Vyas",
      "link" : "https://stackoverflow.com/users/22950548/parth-vyas"
    },
    "is_answered" : false,
    "view_count" : 55,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1759378559,
    "creation_date" : 1759301289,
    "link" : "https://stackoverflow.com/questions/79779722/getting-java-sql-sqlrecoverableexception-io-error-socket-read-interrupted-au",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}