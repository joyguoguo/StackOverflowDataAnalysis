{
  "question" : {
    "question_id" : 79733732,
    "title" : "Spring JPA insertion order for a List",
    "body" : "<p>I seem to get mixed answers with this, so I just wanted to clarify the behavior of JpaRepository. Given a JPA entity such as:</p>\n<pre><code>public class ItemEntity {\n  @Id\n  @SequenceGenerator(name = &quot;i_seq&quot;, sequenceName = &quot;i_seq, allocationSize = 1)\n  @@GeneratedValue(stragegy = GenerationType.SEQUENCE, generator = &quot;i_seq&quot;)\n  @Column(name = &quot;id&quot;, columnDefinition = &quot;bigint&quot;)\n  private Long id;\n\n  ...\n}\n</code></pre>\n<p>The id is generated by a sequence on the database side. My goal is to insert the items in the order of the List.</p>\n<pre><code>public void saveAll(List&lt;ItemEntity&gt; items) {\n  ...\n}\n</code></pre>\n<p>The problem is, I don't believe that JpaRepository.saveAll actually enforces the insertion order. My question is, can I &quot;force&quot; JPA to insert the items in the order of the List by flushing every ItemEntity after the call to save?</p>\n<pre><code>public void saveAll(List&lt;ItemEntity&gt; items) {\n  for (ItemEntity item : items) {\n    jpaRepository.save(item);\n    jpaRepository.flush();\n  }\n}\n</code></pre>\n<p>Or is the flush not required?</p>\n",
    "tags" : [ "java", "sql", "spring", "spring-boot", "jpa" ],
    "owner" : {
      "account_id" : 2177275,
      "reputation" : 1227,
      "user_id" : 1927638,
      "user_type" : "registered",
      "accept_rate" : 50,
      "profile_image" : "https://www.gravatar.com/avatar/d3e829ec9e4b689837b878e923f23254?s=256&d=identicon&r=PG",
      "display_name" : "user1927638",
      "link" : "https://stackoverflow.com/users/1927638/user1927638"
    },
    "is_answered" : true,
    "view_count" : 152,
    "answer_count" : 1,
    "score" : 3,
    "last_activity_date" : 1755047954,
    "creation_date" : 1755042709,
    "link" : "https://stackoverflow.com/questions/79733732/spring-jpa-insertion-order-for-a-list",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79733775,
    "question_id" : 79733732,
    "body" : "<p><strong>Short answer:</strong> No, flushing after each save is not required for insertion order — <code>JpaRepository.saveAll</code> already processes entities in the same order as your input <code>List</code>.</p>\n<p><strong>Explanation:</strong><br />\nSpring Data JPA’s default <code>saveAll</code> implementation (in <code>SimpleJpaRepository</code>) iterates over the provided collection and calls <code>save</code> for each element in sequence:</p>\n<p><a href=\"https://i.sstatic.net/rUKy3AUk.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/rUKy3AUk.png\" alt=\"spring-jpa-saveAll\" /></a></p>\n<p>JPA itself doesn’t reorder these inserts — the SQL insert statements will be generated in the same sequence unless batching, flush modes, or database-level optimizations alter execution timing.</p>\n<p>If you specifically need to persist and commit immediately, you can use:</p>\n<pre class=\"lang-java prettyprint-override\"><code>repository.saveAllAndFlush(entities);\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 3563147,
      "reputation" : 3034,
      "user_id" : 2975478,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/8MVwk.jpg?s=256",
      "display_name" : "ChandraBhan Singh",
      "link" : "https://stackoverflow.com/users/2975478/chandrabhan-singh"
    },
    "creation_date" : 1755047954,
    "last_activity_date" : 1755047954,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140664491,
    "post_id" : 79733732,
    "body" : "There is no guarantee that sequence is strictly ascending, only that it is unique.",
    "score" : 1,
    "owner" : {
      "account_id" : 4497436,
      "reputation" : 20786,
      "user_id" : 3656904,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/8bdbd1f89f8907e8e8b15ab88c084c65?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "talex",
      "link" : "https://stackoverflow.com/users/3656904/talex"
    },
    "creation_date" : 1755152571,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140663345,
    "post_id" : 79733732,
    "body" : "Yes, the corresponding select statements will order by item.id. Since the id is generated by a sequence, it would be used to indicate the order of insertion.",
    "score" : 0,
    "owner" : {
      "account_id" : 2177275,
      "reputation" : 1227,
      "user_id" : 1927638,
      "user_type" : "registered",
      "accept_rate" : 50,
      "profile_image" : "https://www.gravatar.com/avatar/d3e829ec9e4b689837b878e923f23254?s=256&d=identicon&r=PG",
      "display_name" : "user1927638",
      "link" : "https://stackoverflow.com/users/1927638/user1927638"
    },
    "creation_date" : 1755102008,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140661852,
    "post_id" : 79733732,
    "body" : "Are you aware that database does not return data in order you save it? Why do you even need it to be saved in order?",
    "score" : 0,
    "owner" : {
      "account_id" : 4497436,
      "reputation" : 20786,
      "user_id" : 3656904,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/8bdbd1f89f8907e8e8b15ab88c084c65?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "talex",
      "link" : "https://stackoverflow.com/users/3656904/talex"
    },
    "creation_date" : 1755067915,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79733775" : [ {
      "comment_id" : 140676847,
      "post_id" : 79733775,
      "body" : "@user1927638 Flush after a save (JPA persist/merge call under the covers) is the only way to ensure the JPA provider issues a statement to the database, and only loosely will give you control over insert orders. JPA is required to reorder things for constraint management after all. Also note thought that doing so forces JPA to check the entire context for changes on each flush call - this can get more expensive as more is added depending on implementation details (like change tracking). You may want to call flush if you need to go this route, but are likely better off using a date/timestamp fo",
      "score" : 0,
      "owner" : {
        "account_id" : 231721,
        "reputation" : 21335,
        "user_id" : 496099,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/efa7510cf47d7bd79e80486246e7e39e?s=256&d=identicon&r=PG",
        "display_name" : "Chris",
        "link" : "https://stackoverflow.com/users/496099/chris"
      },
      "creation_date" : 1755618701,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140663331,
      "post_id" : 79733775,
      "body" : "Thanks for the feedback. In that case, wouldn&#39;t a &quot;flush&quot; guarantee the order of insertion since it will immediately propagate the changes to the DB (even though it seems like the current saveAll behavior is to generate the SQL inserts in the List order)? Not sure if this makes a difference, but we are using Hibernate. We also don&#39;t have order_insert or batch_size set.",
      "score" : 0,
      "owner" : {
        "account_id" : 2177275,
        "reputation" : 1227,
        "user_id" : 1927638,
        "user_type" : "registered",
        "accept_rate" : 50,
        "profile_image" : "https://www.gravatar.com/avatar/d3e829ec9e4b689837b878e923f23254?s=256&d=identicon&r=PG",
        "display_name" : "user1927638",
        "link" : "https://stackoverflow.com/users/1927638/user1927638"
      },
      "creation_date" : 1755101663,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140662087,
      "post_id" : 79733775,
      "body" : "But that is an implementation detail. It is very likely that one would implement it this way and since the implementation is currently like that it is probably going to stay so. But copying the entities to a new list and shuffling that also wouldn&#39;t violate the contract specified in the javadoc of <code>saveAll</code>. So you either should have tests that specifically test this or to use an extended <code>SimpleJpaRepository</code> where that method is overriden with an implementation suiting the OPs needs.",
      "score" : 1,
      "owner" : {
        "account_id" : 1580843,
        "reputation" : 13706,
        "user_id" : 1466267,
        "user_type" : "registered",
        "accept_rate" : 91,
        "profile_image" : "https://www.gravatar.com/avatar/c47d1f7544a8c4a1bb7a41d511f53604?s=256&d=identicon&r=PG",
        "display_name" : "SpaceTrucker",
        "link" : "https://stackoverflow.com/users/1466267/spacetrucker"
      },
      "creation_date" : 1755073543,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}