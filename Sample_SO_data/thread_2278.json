{
  "question" : {
    "question_id" : 79633651,
    "title" : "Why is my Spring Boot app creating 10+ sleeping MariaDB connections per database? Is this a problem?",
    "body" : "<p>I'm using a Spring Boot application that connects to two MariaDB databases. When I run the app, I notice that there are about 10 connections per database shown in the SHOW PROCESSLIST; output â€” all in Sleep state\n<a href=\"https://i.sstatic.net/oxVzZpA4.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/oxVzZpA4.png\" alt=\"enter image description here\" /></a></p>\n<p>I suspect this is related to the connection pooling mechanism (possibly HikariCP), but I have a few concerns:</p>\n<ul>\n<li>Is this normal behavior for Spring Boot with connection pooling?\n-Can having 20+ sleeping connections cause any issues like resource exhaustion or deadlocks?</li>\n<li>Will it cause problems under load or degrade performance over time?</li>\n<li>How can I configure or reduce the number of idle connections if needed?\nHere is a snippet of my application.properties:</li>\n</ul>\n<p>Any insights or best practices for managing these idle connections or connection pool sizes would be appreciated.</p>\n",
    "tags" : [ "java", "spring", "spring-boot", "hikaricp" ],
    "owner" : {
      "account_id" : 29676247,
      "reputation" : 21,
      "user_id" : 22744123,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/ACg8ocI5KBFbuMSOFqYw6EWg1Nw7vBX6y-kmFtwq1Gc4-6QzZbc=k-s256",
      "display_name" : "RAHUL BINU",
      "link" : "https://stackoverflow.com/users/22744123/rahul-binu"
    },
    "is_answered" : false,
    "view_count" : 141,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1747942405,
    "creation_date" : 1747913611,
    "link" : "https://stackoverflow.com/questions/79633651/why-is-my-spring-boot-app-creating-10-sleeping-mariadb-connections-per-database",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79633738,
    "question_id" : 79633651,
    "body" : "<p>Yes, this will be done by HikariCP. To change the number of connections update your <code>application.properties</code> and set <code>spring.datasource.hikari.maximum-pool-size=100</code>.</p>\n<p>This is normal and offers some performance-improvement because tear up/down a database-connection costs time.</p>\n<p>To your questions:</p>\n<blockquote>\n<p>Is this normal behavior for Spring Boot with connection pooling? -Can having 20+ sleeping connections cause any issues like resource exhaustion or deadlocks?</p>\n</blockquote>\n<p>No, there are no risks for resource exhaustion or deadlocks.</p>\n<blockquote>\n<p>Will it cause problems under load or degrade performance over time?</p>\n</blockquote>\n<p>The connections are limited. If you have 1k threads and only 20 connections, then your threads will wait to obtain a connection. It's a good idea to orient the max connections to your thread-count to avoid that situation. It depends on you application, but normally you need far less connections than threads.</p>\n<blockquote>\n<p>How can I configure or reduce the number of idle connections if needed? Here is a snippet of my application.properties:</p>\n</blockquote>\n<p>Set <code>spring.datasource.hikari.maximum-pool-size=X</code>.</p>\n",
    "score" : -1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 8739741,
      "reputation" : 8119,
      "user_id" : 6537157,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://i.sstatic.net/DtMI6.jpg?s=256",
      "display_name" : "akop",
      "link" : "https://stackoverflow.com/users/6537157/akop"
    },
    "creation_date" : 1747916940,
    "last_activity_date" : 1747942405,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140449205,
    "post_id" : 79633651,
    "body" : "Connection pooling set based on DB server CPU/connection limits if you are deploying on production. If you are still on local, it&#39;s ok.",
    "score" : 0,
    "owner" : {
      "account_id" : 10177913,
      "reputation" : 126,
      "user_id" : 7515870,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/24fcb138b565419729af23838f4da38f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Djamware",
      "link" : "https://stackoverflow.com/users/7515870/djamware"
    },
    "creation_date" : 1747915234,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140449161,
    "post_id" : 79633651,
    "body" : "What you are seeing is absolutely normal behavior for connection pooling. You didn&#39;t include your <code>application.properties</code>. If you want us to tell you how to configure it, you need to show what your current configuration is.",
    "score" : 0,
    "owner" : {
      "account_id" : 7501,
      "reputation" : 203309,
      "user_id" : 13070,
      "user_type" : "registered",
      "accept_rate" : 90,
      "profile_image" : "https://i.sstatic.net/G3J7P8QE.jpg?s=256",
      "display_name" : "Mark B",
      "link" : "https://stackoverflow.com/users/13070/mark-b"
    },
    "creation_date" : 1747914105,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79633738" : [ {
      "comment_id" : 140454303,
      "post_id" : 79633738,
      "body" : "At the downvoter without a comment: How can I improve it?",
      "score" : 0,
      "owner" : {
        "account_id" : 8739741,
        "reputation" : 8119,
        "user_id" : 6537157,
        "user_type" : "registered",
        "accept_rate" : 100,
        "profile_image" : "https://i.sstatic.net/DtMI6.jpg?s=256",
        "display_name" : "akop",
        "link" : "https://stackoverflow.com/users/6537157/akop"
      },
      "creation_date" : 1748043537,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140449970,
      "post_id" : 79633738,
      "body" : "@duffymo I didn&#39;t wrote one connection per thread. :P But I can clarify it a bit.",
      "score" : 0,
      "owner" : {
        "account_id" : 8739741,
        "reputation" : 8119,
        "user_id" : 6537157,
        "user_type" : "registered",
        "accept_rate" : 100,
        "profile_image" : "https://i.sstatic.net/DtMI6.jpg?s=256",
        "display_name" : "akop",
        "link" : "https://stackoverflow.com/users/6537157/akop"
      },
      "creation_date" : 1747928770,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140449807,
      "post_id" : 79633738,
      "body" : "Please read this: <a href=\"https://github.com/brettwooldridge/HikariCP/wiki/About-Pool-Sizing\" rel=\"nofollow noreferrer\">github.com/brettwooldridge/HikariCP/wiki/About-Pool-Sizing</a>",
      "score" : 1,
      "owner" : {
        "account_id" : 16878,
        "reputation" : 309594,
        "user_id" : 37213,
        "user_type" : "registered",
        "accept_rate" : 81,
        "profile_image" : "https://www.gravatar.com/avatar/eeec80237213c91e5bab56b77ac5b8ca?s=256&d=identicon&r=PG",
        "display_name" : "duffymo",
        "link" : "https://stackoverflow.com/users/37213/duffymo"
      },
      "creation_date" : 1747926081,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140449785,
      "post_id" : 79633738,
      "body" : "I don&#39;t agree with the advice of one DB connection per thread.   A single connection will be able to handle multiple threads, as long as the queries are fast.   Better to spend your time optimizing indexes and making sure you don&#39;t have long-running transactions.",
      "score" : 0,
      "owner" : {
        "account_id" : 16878,
        "reputation" : 309594,
        "user_id" : 37213,
        "user_type" : "registered",
        "accept_rate" : 81,
        "profile_image" : "https://www.gravatar.com/avatar/eeec80237213c91e5bab56b77ac5b8ca?s=256&d=identicon&r=PG",
        "display_name" : "duffymo",
        "link" : "https://stackoverflow.com/users/37213/duffymo"
      },
      "creation_date" : 1747925856,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}