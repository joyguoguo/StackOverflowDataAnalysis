{
  "question" : {
    "question_id" : 79735022,
    "title" : "How to get the new Maven 4 Dependency Injection API to work the same in a Maven plugin between tests and production?",
    "body" : "<p>I've been experimenting with Maven 4's new <a href=\"https://maven.apache.org/ref/4.0.0-rc-4/api/maven-api-di/index.html\" rel=\"nofollow noreferrer\">Dependency Injection API</a>. This API replaces the Plexus and\nJSR 330 annotations, according to <a href=\"https://maven.apache.org/maven-di.html\" rel=\"nofollow noreferrer\">this guide</a>:</p>\n<blockquote>\n<p>Maven DI is the dependency injection framework of Maven, that is introduced in Maven 4.</p>\n<p>It is the successor for Plexus IoC (used in Maven 2) and JSR 330/Eclipse Sisu (used in Maven 3) in Maven.</p>\n</blockquote>\n<p>From what I can tell, with the new APIs there are two ways to get services:</p>\n<ol>\n<li>Dependency injection with the new <a href=\"https://maven.apache.org/ref/4.0.0-rc-4/api/maven-api-di/apidocs/org/apache/maven/api/di/Inject.html\" rel=\"nofollow noreferrer\"><code>@org.apache.maven.api.di.Inject</code></a> annotation.</li>\n<li>Inject a <code>Session</code> and then call <a href=\"https://maven.apache.org/ref/4.0.0-rc-4/api/maven-api-core/apidocs/org/apache/maven/api/Session.html#getService(java.lang.Class)\" rel=\"nofollow noreferrer\"><code>Session::getService(Class)</code></a>.</li>\n</ol>\n<p>However, I'm seeing different behavior between unit testing my Maven plugin and using the plugin in a separate project.\nDuring unit tests, all the services are successfully injected using <code>@Inject</code>. But the plugin then fails to inject\nthose same services when used in a project. Conversely, getting the services via <code>Session::getService</code> fails during\nunit tests but succeeds when used in a project. So, not only does obtaining services seem to have different behavior\nbetween tests and &quot;production&quot;, but different APIs that &quot;do the same thing&quot; fail at opposite points. I find this rather\nstrange. I would have expected either <code>getService</code>to be much more reliable than DI, or that <code>getService</code> and <code>@Inject</code>\nultimately use the same implementation under-the-hood (meaning they should behave the same).</p>\n<p>What am I doing wrong? Am I even supposed to unit test Mojos in this way?</p>\n<p>I assume it's likely my fault given I'm testing with <strong>Maven 4.0.0-rc-4</strong>, the fourth release\ncandidate (instead of a beta or an even less stable version). Plus, wanting to inject services must be a common\ndesire, so I assume this is a well tested feature.</p>\n<p>My guess is the problem is with how the unit tests are &quot;wired up&quot;.</p>\n<hr />\n<h1>Minimal Example</h1>\n<p>Used Maven 4.0.0-rc-4 and Java 24.0.1. I don't believe the Java version matters, so long as it's Java 17+.</p>\n<h2>GitLab Repo</h2>\n<p>To help with reproducing the problem, here is a GitLab repo of the below example: <a href=\"https://gitlab.com/tkslaw/maven4-di-tests\" rel=\"nofollow noreferrer\">https://gitlab.com/tkslaw/maven4-di-tests</a>.</p>\n<h2>Results</h2>\n<div class=\"s-table-container\"><table class=\"s-table\">\n<thead>\n<tr>\n<th>Mojo</th>\n<th style=\"text-align: center;\">Unit Test</th>\n<th style=\"text-align: center;\">Integration Test (&quot;production&quot;)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>GetServiceMojo</code></td>\n<td style=\"text-align: center;\">Fails</td>\n<td style=\"text-align: center;\">Succeeds</td>\n</tr>\n<tr>\n<td><code>InjectServiceMojo</code></td>\n<td style=\"text-align: center;\">Succeeds</td>\n<td style=\"text-align: center;\">Fails</td>\n</tr>\n</tbody>\n</table></div>\n<h2>Source Code</h2>\n<h3>POM</h3>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.1.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.1.0 http://maven.apache.org/xsd/maven-4.1.0.xsd&quot;\n         root=&quot;true&quot;&gt;\n  &lt;modelVersion&gt;4.1.0&lt;/modelVersion&gt;\n\n  &lt;groupId&gt;com.gitlab.tkslaw&lt;/groupId&gt;\n  &lt;artifactId&gt;ditests-maven-plugin&lt;/artifactId&gt;\n  &lt;version&gt;0.1.0-SNAPSHOT&lt;/version&gt;\n  &lt;packaging&gt;maven-plugin&lt;/packaging&gt;\n\n  &lt;properties&gt;\n    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;\n    &lt;maven.compiler.release&gt;17&lt;/maven.compiler.release&gt;\n\n    &lt;requiredMavenVersion&gt;[4.0.0-rc-4]&lt;/requiredMavenVersion&gt;\n\n    &lt;mavenVersion&gt;4.0.0-rc-4&lt;/mavenVersion&gt;\n    &lt;junitVersion&gt;5.13.4&lt;/junitVersion&gt;\n    &lt;guiceVersion&gt;7.0.0&lt;/guiceVersion&gt;\n  &lt;/properties&gt;\n\n  &lt;dependencies&gt;\n    &lt;!-- ### Maven Plugin APIs ### --&gt;\n\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.apache.maven&lt;/groupId&gt;\n      &lt;artifactId&gt;maven-api-core&lt;/artifactId&gt;\n      &lt;version&gt;${mavenVersion}&lt;/version&gt;\n      &lt;scope&gt;provided&lt;/scope&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.apache.maven&lt;/groupId&gt;\n      &lt;artifactId&gt;maven-api-di&lt;/artifactId&gt;\n      &lt;version&gt;${mavenVersion}&lt;/version&gt;\n      &lt;scope&gt;provided&lt;/scope&gt;\n    &lt;/dependency&gt;\n\n    &lt;!-- ### JUnit Jupiter ### --&gt;\n\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;\n      &lt;artifactId&gt;junit-jupiter&lt;/artifactId&gt;\n      &lt;version&gt;${junitVersion}&lt;/version&gt;\n      &lt;scope&gt;test&lt;/scope&gt;\n    &lt;/dependency&gt;\n\n    &lt;!-- ### Maven Testing Dependencies ### --&gt;\n\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.apache.maven&lt;/groupId&gt;\n      &lt;artifactId&gt;maven-testing&lt;/artifactId&gt;\n      &lt;version&gt;${mavenVersion}&lt;/version&gt;\n      &lt;scope&gt;test&lt;/scope&gt;\n    &lt;/dependency&gt;\n\n    &lt;!--\n     The unit tests fail with a ClassNotFoundException if Guice is not\n     declared here. However, it feels wrong to have a direct dependency\n     on Guice. Shouldn't maven-testing, or perhaps some other Maven\n     dependency, have Guice as a transitive dependency?\n    --&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;com.google.inject&lt;/groupId&gt;\n      &lt;artifactId&gt;guice&lt;/artifactId&gt;\n      &lt;version&gt;${guiceVersion}&lt;/version&gt;\n      &lt;scope&gt;test&lt;/scope&gt;\n    &lt;/dependency&gt;\n  &lt;/dependencies&gt;\n\n  &lt;build&gt;\n    &lt;!-- Lock plugin versions --&gt;\n    &lt;pluginManagement&gt;\n      &lt;plugins&gt;\n        &lt;plugin&gt;\n          &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n          &lt;artifactId&gt;maven-clean-plugin&lt;/artifactId&gt;\n          &lt;version&gt;3.5.0&lt;/version&gt;\n        &lt;/plugin&gt;\n        &lt;plugin&gt;\n          &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n          &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n          &lt;version&gt;3.14.0&lt;/version&gt;\n        &lt;/plugin&gt;\n        &lt;plugin&gt;\n          &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n          &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;\n          &lt;version&gt;3.3.1&lt;/version&gt;\n        &lt;/plugin&gt;\n        &lt;plugin&gt;\n          &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n          &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;\n          &lt;version&gt;3.5.3&lt;/version&gt;\n        &lt;/plugin&gt;\n        &lt;plugin&gt;\n          &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n          &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;\n          &lt;version&gt;3.4.2&lt;/version&gt;\n        &lt;/plugin&gt;\n        &lt;plugin&gt;\n          &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n          &lt;artifactId&gt;maven-plugin-plugin&lt;/artifactId&gt;\n          &lt;version&gt;4.0.0-beta-1&lt;/version&gt;\n        &lt;/plugin&gt;\n        &lt;plugin&gt;\n          &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n          &lt;artifactId&gt;maven-invoker-plugin&lt;/artifactId&gt;\n          &lt;version&gt;3.9.1&lt;/version&gt;\n        &lt;/plugin&gt;\n        &lt;plugin&gt;\n          &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n          &lt;artifactId&gt;maven-enforcer-plugin&lt;/artifactId&gt;\n          &lt;version&gt;3.6.1&lt;/version&gt;\n        &lt;/plugin&gt;\n      &lt;/plugins&gt;\n    &lt;/pluginManagement&gt;\n\n    &lt;plugins&gt;\n      &lt;plugin&gt;\n        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n        &lt;artifactId&gt;maven-enforcer-plugin&lt;/artifactId&gt;\n        &lt;configuration&gt;\n          &lt;rules&gt;\n            &lt;requireMavenVersion&gt;\n              &lt;version&gt;${requiredMavenVersion}&lt;/version&gt;\n            &lt;/requireMavenVersion&gt;\n          &lt;/rules&gt;\n        &lt;/configuration&gt;\n        &lt;executions&gt;\n          &lt;execution&gt;\n            &lt;id&gt;enforce&lt;/id&gt;\n            &lt;phase&gt;validate&lt;/phase&gt;\n            &lt;goals&gt;\n              &lt;goal&gt;enforce&lt;/goal&gt;\n            &lt;/goals&gt;\n          &lt;/execution&gt;\n        &lt;/executions&gt;\n      &lt;/plugin&gt;\n\n      &lt;plugin&gt;\n        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n        &lt;artifactId&gt;maven-plugin-plugin&lt;/artifactId&gt;\n        &lt;configuration&gt;\n          &lt;extractors&gt;\n            &lt;extractor&gt;java-annotations&lt;/extractor&gt;\n          &lt;/extractors&gt;\n        &lt;/configuration&gt;\n      &lt;/plugin&gt;\n\n      &lt;plugin&gt;\n        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n        &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;\n        &lt;configuration&gt;\n          &lt;argLine&gt;-XX:+EnableDynamicAgentLoading&lt;/argLine&gt;\n          &lt;testFailureIgnore&gt;true&lt;/testFailureIgnore&gt;\n        &lt;/configuration&gt;\n      &lt;/plugin&gt;\n\n      &lt;plugin&gt;\n        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n        &lt;artifactId&gt;maven-invoker-plugin&lt;/artifactId&gt;\n        &lt;configuration&gt;\n          &lt;cloneProjectsTo&gt;${project.build.directory}/it&lt;/cloneProjectsTo&gt;\n          &lt;!-- &lt;settingsFile&gt;${project.basedir}/src/it/settings.xml&lt;/settingsFile&gt; --&gt;\n          &lt;localRepositoryPath&gt;${project.build.directory}/local-repo&lt;/localRepositoryPath&gt;\n          &lt;goals&gt;\n            &lt;goal&gt;validate&lt;/goal&gt;\n          &lt;/goals&gt;\n        &lt;/configuration&gt;\n        &lt;executions&gt;\n          &lt;execution&gt;\n            &lt;id&gt;integration-test&lt;/id&gt;\n            &lt;goals&gt;\n              &lt;goal&gt;install&lt;/goal&gt;\n              &lt;goal&gt;run&lt;/goal&gt;\n            &lt;/goals&gt;\n          &lt;/execution&gt;\n        &lt;/executions&gt;\n      &lt;/plugin&gt;\n    &lt;/plugins&gt;\n  &lt;/build&gt;\n&lt;/project&gt;\n</code></pre>\n<h3>Main code</h3>\n<p><strong>DITestsMojoBase.java</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.gitlab.tkslaw.ditests;\n\nimport org.apache.maven.api.Project;\nimport org.apache.maven.api.Session;\nimport org.apache.maven.api.di.Inject;\nimport org.apache.maven.api.plugin.Log;\nimport org.apache.maven.api.plugin.Mojo;\n\npublic class DITestsMojoBase implements Mojo {\n\n  @Inject protected Log log;\n  @Inject protected Session session;\n  @Inject protected Project project;\n\n  @Override\n  public void execute() {\n    log.info(() -&gt; &quot;log = &quot; + log);\n    log.info(() -&gt; &quot;session = &quot; + session);\n    log.info(() -&gt; &quot;project = &quot; + project);\n  }\n\n  protected void logService(String name, Object service) {\n    log.info(() -&gt; &quot;   | %s = %s&quot;.formatted(name, service));\n  }\n}\n</code></pre>\n<p><strong>GetServiceMojo.java</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.gitlab.tkslaw.ditests;\n\nimport org.apache.maven.api.plugin.annotations.Mojo;\nimport org.apache.maven.api.services.ArtifactManager;\nimport org.apache.maven.api.services.DependencyResolver;\nimport org.apache.maven.api.services.OsService;\nimport org.apache.maven.api.services.ToolchainManager;\n\n@Mojo(name = &quot;get-service&quot;)\npublic class GetServiceMojo extends DITestsMojoBase {\n\n  protected ArtifactManager artifactManager;\n  protected DependencyResolver dependencyResolver;\n  protected ToolchainManager toolchainManager;\n  protected OsService osService;\n\n  @Override\n  public void execute() {\n    super.execute();\n\n    artifactManager = session.getService(ArtifactManager.class);\n    dependencyResolver = session.getService(DependencyResolver.class);\n    toolchainManager = session.getService(ToolchainManager.class);\n    osService = session.getService(OsService.class);\n\n    log.info(&quot;Logging services obtained via Session::getService&quot;);\n    logService(&quot;artifactManager&quot;, artifactManager);\n    logService(&quot;dependencyResolver&quot;, dependencyResolver);\n    logService(&quot;toolchainManager&quot;, toolchainManager);\n    logService(&quot;osService&quot;, osService);\n  }\n}\n</code></pre>\n<p><strong>InjectServiceMojo.java</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.gitlab.tkslaw.ditests;\n\nimport org.apache.maven.api.di.Inject;\nimport org.apache.maven.api.plugin.annotations.Mojo;\nimport org.apache.maven.api.services.ArtifactManager;\nimport org.apache.maven.api.services.DependencyResolver;\nimport org.apache.maven.api.services.OsService;\nimport org.apache.maven.api.services.ToolchainManager;\n\n@Mojo(name = &quot;inject-service&quot;)\npublic class InjectServiceMojo extends DITestsMojoBase {\n\n  @Inject protected ArtifactManager artifactManager;\n  @Inject protected DependencyResolver dependencyResolver;\n  @Inject protected ToolchainManager toolchainManager;\n  @Inject protected OsService osService;\n\n  @Override\n  public void execute() {\n    super.execute();\n\n    log.info(&quot;Logging services injected via @Inject&quot;);\n    logService(&quot;artifactManager&quot;, artifactManager);\n    logService(&quot;dependencyResolver&quot;, dependencyResolver);\n    logService(&quot;toolchainManager&quot;, toolchainManager);\n    logService(&quot;osService&quot;, osService);\n  }\n}\n</code></pre>\n<h3>Test code</h3>\n<p><strong>GetServiceMojoTests.java</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.gitlab.tkslaw.ditests;\n\nimport org.apache.maven.api.plugin.testing.InjectMojo;\nimport org.apache.maven.api.plugin.testing.MojoTest;\nimport org.junit.jupiter.api.DisplayName;\nimport org.junit.jupiter.api.Test;\n\nimport static org.junit.jupiter.api.Assertions.assertAll;\nimport static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\nimport static org.junit.jupiter.api.Assertions.assertNotNull;\n\n@MojoTest\n@DisplayName(&quot;Test GetServiceMojo&quot;)\nclass GetServiceMojoTests {\n\n  @Test\n  @InjectMojo(goal = &quot;get-service&quot;)\n  @DisplayName(&quot;initialized its services via Session::getService&quot;)\n  void testServicesNotNull(GetServiceMojo mojo) {\n    // Preconditions\n    assertAll(\n        &quot;Log, Session, and/or Project were not injected. This should not happen!&quot;,\n        () -&gt; assertNotNull(mojo.log, &quot;log&quot;),\n        () -&gt; assertNotNull(mojo.session, &quot;session&quot;),\n        () -&gt; assertNotNull(mojo.project, &quot;project&quot;));\n\n    // Actual test\n    assertDoesNotThrow(mojo::execute, &quot;GetServiceMojo::execute&quot;);\n    assertAll(\n        &quot;Services not obtained from Session::getService&quot;,\n        () -&gt; assertNotNull(mojo.artifactManager, &quot;artifactManager&quot;),\n        () -&gt; assertNotNull(mojo.dependencyResolver, &quot;dependencyResolver&quot;),\n        () -&gt; assertNotNull(mojo.toolchainManager, &quot;toolchainManager&quot;),\n        () -&gt; assertNotNull(mojo.osService, &quot;osService&quot;));\n  }\n}\n</code></pre>\n<p><strong>InjectServiceMojoTests.java</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.gitlab.tkslaw.ditests;\n\nimport org.apache.maven.api.plugin.testing.InjectMojo;\nimport org.apache.maven.api.plugin.testing.MojoTest;\nimport org.junit.jupiter.api.DisplayName;\nimport org.junit.jupiter.api.Test;\n\nimport static org.junit.jupiter.api.Assertions.assertAll;\nimport static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\nimport static org.junit.jupiter.api.Assertions.assertNotNull;\n\n@MojoTest\n@DisplayName(&quot;Test InjectServiceMojo&quot;)\nclass InjectServiceMojoTests {\n\n  @Test\n  @InjectMojo(goal = &quot;inject-service&quot;)\n  @DisplayName(&quot;had its services injected by the DI container&quot;)\n  void testServicesNotNull(InjectServiceMojo mojo) {\n    // Preconditions\n    assertAll(\n        &quot;Log, Session, and/or Project were not injected. This should not happen!&quot;,\n        () -&gt; assertNotNull(mojo.log, &quot;log&quot;),\n        () -&gt; assertNotNull(mojo.session, &quot;session&quot;),\n        () -&gt; assertNotNull(mojo.project, &quot;project&quot;));\n\n    // Actual test\n    assertDoesNotThrow(mojo::execute, &quot;InjectServiceMojo::execute&quot;);\n    assertAll(\n        &quot;Services not injected by DI container&quot;,\n        () -&gt; assertNotNull(mojo.artifactManager, &quot;artifactManager&quot;),\n        () -&gt; assertNotNull(mojo.dependencyResolver, &quot;dependencyResolver&quot;),\n        () -&gt; assertNotNull(mojo.toolchainManager, &quot;toolchainManager&quot;),\n        () -&gt; assertNotNull(mojo.osService, &quot;osService&quot;));\n  }\n}\n</code></pre>\n<h3>Integration test code</h3>\n<p><strong>src/it/get-service/pom.xml</strong></p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.1.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.1.0 http://maven.apache.org/xsd/maven-4.1.0.xsd&quot;\n         root=&quot;true&quot;&gt;\n  &lt;modelVersion&gt;4.1.0&lt;/modelVersion&gt;\n\n  &lt;groupId&gt;com.gitlab.tkslaw&lt;/groupId&gt;\n  &lt;artifactId&gt;get-service&lt;/artifactId&gt;\n  &lt;version&gt;0.1.0-SNAPSHOT&lt;/version&gt;\n\n  &lt;build&gt;\n    &lt;plugins&gt;\n      &lt;plugin&gt;\n        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n        &lt;artifactId&gt;maven-enforcer-plugin&lt;/artifactId&gt;\n        &lt;version&gt;3.6.1&lt;/version&gt;\n        &lt;configuration&gt;\n          &lt;rules&gt;\n            &lt;requireMavenVersion&gt;\n              &lt;version&gt;@requiredMavenVersion@&lt;/version&gt;\n            &lt;/requireMavenVersion&gt;\n          &lt;/rules&gt;\n        &lt;/configuration&gt;\n        &lt;executions&gt;\n          &lt;execution&gt;\n            &lt;id&gt;enforce&lt;/id&gt;\n            &lt;phase&gt;validate&lt;/phase&gt;\n            &lt;goals&gt;\n              &lt;goal&gt;enforce&lt;/goal&gt;\n            &lt;/goals&gt;\n          &lt;/execution&gt;\n        &lt;/executions&gt;\n      &lt;/plugin&gt;\n\n      &lt;plugin&gt;\n        &lt;groupId&gt;com.gitlab.tkslaw&lt;/groupId&gt;\n        &lt;artifactId&gt;ditests-maven-plugin&lt;/artifactId&gt;\n        &lt;version&gt;@project.version@&lt;/version&gt;\n        &lt;executions&gt;\n          &lt;execution&gt;\n            &lt;id&gt;get-service&lt;/id&gt;\n            &lt;phase&gt;validate&lt;/phase&gt;\n            &lt;goals&gt;\n              &lt;goal&gt;get-service&lt;/goal&gt;\n            &lt;/goals&gt;\n          &lt;/execution&gt;\n        &lt;/executions&gt;\n      &lt;/plugin&gt;\n    &lt;/plugins&gt;\n  &lt;/build&gt;\n\n&lt;/project&gt;\n</code></pre>\n<p><strong>src/it/inject-service/pom.xml</strong></p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.1.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.1.0 http://maven.apache.org/xsd/maven-4.1.0.xsd&quot;\n         root=&quot;true&quot;&gt;\n  &lt;modelVersion&gt;4.1.0&lt;/modelVersion&gt;\n\n  &lt;groupId&gt;com.gitlab.tkslaw&lt;/groupId&gt;\n  &lt;artifactId&gt;inject-service&lt;/artifactId&gt;\n  &lt;version&gt;0.1.0-SNAPSHOT&lt;/version&gt;\n\n  &lt;build&gt;\n    &lt;plugins&gt;\n      &lt;plugin&gt;\n        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n        &lt;artifactId&gt;maven-enforcer-plugin&lt;/artifactId&gt;\n        &lt;version&gt;3.6.1&lt;/version&gt;\n        &lt;configuration&gt;\n          &lt;rules&gt;\n            &lt;requireMavenVersion&gt;\n              &lt;version&gt;@requiredMavenVersion@&lt;/version&gt;\n            &lt;/requireMavenVersion&gt;\n          &lt;/rules&gt;\n        &lt;/configuration&gt;\n        &lt;executions&gt;\n          &lt;execution&gt;\n            &lt;id&gt;enforce&lt;/id&gt;\n            &lt;phase&gt;validate&lt;/phase&gt;\n            &lt;goals&gt;\n              &lt;goal&gt;enforce&lt;/goal&gt;\n            &lt;/goals&gt;\n          &lt;/execution&gt;\n        &lt;/executions&gt;\n      &lt;/plugin&gt;\n\n      &lt;plugin&gt;\n        &lt;groupId&gt;com.gitlab.tkslaw&lt;/groupId&gt;\n        &lt;artifactId&gt;ditests-maven-plugin&lt;/artifactId&gt;\n        &lt;version&gt;@project.version@&lt;/version&gt;\n        &lt;executions&gt;\n          &lt;execution&gt;\n            &lt;id&gt;inject-service&lt;/id&gt;\n            &lt;phase&gt;validate&lt;/phase&gt;\n            &lt;goals&gt;\n              &lt;goal&gt;inject-service&lt;/goal&gt;\n            &lt;/goals&gt;\n          &lt;/execution&gt;\n        &lt;/executions&gt;\n      &lt;/plugin&gt;\n    &lt;/plugins&gt;\n  &lt;/build&gt;\n\n&lt;/project&gt;\n</code></pre>\n<h2>Output</h2>\n<p>Here's the output of <code>mvn clean verify</code>.</p>\n<h3>Console</h3>\n<p>The output of the unit tests:</p>\n<pre class=\"lang-none prettyprint-override\"><code>[INFO] -------------------------------------------------------\n[INFO]  T E S T S\n[INFO] -------------------------------------------------------\n[INFO] Running com.gitlab.tkslaw.ditests.GetServiceMojoTests\n[WARNING] [stderr] OpenJDK 64-Bit Server VM warning: Sharing is only supported for boot loader classes because bootstrap classpath has been appended\n[WARNING] [stderr] [main] INFO anonymous - log = org.apache.maven.internal.impl.DefaultLog@6296474f\n[WARNING] [stderr] [main] INFO anonymous - session = Mock for InternalSession, hashCode: 1390430007\n[WARNING] [stderr] [main] INFO anonymous - project = org.apache.maven.api.plugin.testing.stubs.ProjectStub@767f6ee7\n[WARNING] [stderr] [main] INFO anonymous - Logging services obtained via Session::getService\n[WARNING] [stderr] [main] INFO anonymous -    | artifactManager = Mock for ArtifactManager, hashCode: 954928973\n[WARNING] [stderr] [main] INFO anonymous -    | dependencyResolver = null\n[WARNING] [stderr] [main] INFO anonymous -    | toolchainManager = null\n[WARNING] [stderr] [main] INFO anonymous -    | osService = null\n[ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 2.174 s &lt;&lt;&lt; FAILURE! -- in com.gitlab.tkslaw.ditests.GetServiceMojoTests\n[ERROR] com.gitlab.tkslaw.ditests.GetServiceMojoTests.testServicesNotNull(GetServiceMojo) -- Time elapsed: 2.123 s &lt;&lt;&lt; FAILURE!\norg.opentest4j.MultipleFailuresError:\nServices not obtained from Session::getService (3 failures)\n        org.opentest4j.AssertionFailedError: dependencyResolver ==&gt; expected: not &lt;null&gt;\n        org.opentest4j.AssertionFailedError: toolchainManager ==&gt; expected: not &lt;null&gt;\n        org.opentest4j.AssertionFailedError: osService ==&gt; expected: not &lt;null&gt;\n        &lt;stack trace omitted&gt;\n        Suppressed: org.opentest4j.AssertionFailedError: dependencyResolver ==&gt; expected: not &lt;null&gt;\n                &lt;stack trace omitted&gt;\n        Suppressed: org.opentest4j.AssertionFailedError: toolchainManager ==&gt; expected: not &lt;null&gt;\n                &lt;stack trace omitted&gt;\n        Suppressed: org.opentest4j.AssertionFailedError: osService ==&gt; expected: not &lt;null&gt;\n                &lt;stack trace omitted&gt;\n\n[INFO] Running com.gitlab.tkslaw.ditests.InjectServiceMojoTests\n[WARNING] [stderr] [main] INFO anonymous - log = org.apache.maven.internal.impl.DefaultLog@3762c4fc\n[WARNING] [stderr] [main] INFO anonymous - session = Mock for InternalSession, hashCode: 236055802\n[WARNING] [stderr] [main] INFO anonymous - project = org.apache.maven.api.plugin.testing.stubs.ProjectStub@77ab22be\n[WARNING] [stderr] [main] INFO anonymous - Logging services injected via @Inject\n[WARNING] [stderr] [main] INFO anonymous -    | artifactManager = Mock for ArtifactManager, hashCode: 997219303\n[WARNING] [stderr] [main] INFO anonymous -    | dependencyResolver = org.apache.maven.impl.DefaultDependencyResolver@59fbb34\n[WARNING] [stderr] [main] INFO anonymous -    | toolchainManager = org.apache.maven.impl.DefaultToolchainManager@1b6924cb\n[WARNING] [stderr] [main] INFO anonymous -    | osService = org.apache.maven.impl.model.DefaultOsService@3a8d467e\n[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.084 s -- in com.gitlab.tkslaw.ditests.InjectServiceMojoTests\n[INFO] \n[INFO] Results:\n[INFO]\n[ERROR] Failures: \n[ERROR]   GetServiceMojoTests.testServicesNotNull:29 Services not obtained from Session::getService (3 failures)\n        org.opentest4j.AssertionFailedError: dependencyResolver ==&gt; expected: not &lt;null&gt;                                                                                                                                     \n        org.opentest4j.AssertionFailedError: toolchainManager ==&gt; expected: not &lt;null&gt;                                                                                                                                       \n        org.opentest4j.AssertionFailedError: osService ==&gt; expected: not &lt;null&gt;                                                                                                                                              \n[INFO]\n[ERROR] Tests run: 2, Failures: 1, Errors: 0, Skipped: 0\n[INFO]\n[ERROR] There are test failures.\n</code></pre>\n<h3>it/get-service/build.log</h3>\n<p>Just the <code>ditests:get-service</code> output:</p>\n<pre class=\"lang-none prettyprint-override\"><code>[INFO] --- ditests:0.1.0-SNAPSHOT:get-service (get-service) @ get-service ---\n[INFO] log = org.apache.maven.internal.impl.DefaultLog@22a6d75c\n[INFO] session = org.apache.maven.internal.impl.DefaultSession@2e43c38d\n[INFO] project = org.apache.maven.internal.impl.DefaultProject@382d71c7\n[INFO] Logging services obtained via Session::getService\n[INFO]    | artifactManager = org.apache.maven.internal.impl.DefaultArtifactManager@50598a1a\n[INFO]    | dependencyResolver = org.apache.maven.impl.DefaultDependencyResolver@14de1901\n[INFO]    | toolchainManager = org.apache.maven.impl.DefaultToolchainManager@437ed416\n[INFO]    | osService = org.apache.maven.impl.model.DefaultOsService@11f23038\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n</code></pre>\n<h3>it/inject-service/build.log</h3>\n<p>Use the <code>ditests:inject-service</code> output:</p>\n<pre class=\"lang-none prettyprint-override\"><code>[INFO] --- ditests:0.1.0-SNAPSHOT:inject-service (inject-service) @ inject-service ---\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  1.110 s\n[INFO] Finished at: 2025-08-14T11:47:23-06:00\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal com.gitlab.tkslaw:ditests-maven-plugin:0.1.0-SNAPSHOT:inject-service (inject-service) on project inject-service: Execution inject-service of goal com.gitlab.tkslaw:ditests-maven-plugin:0.1.0-SNAPSHOT:inject-service failed: Unable to lookup Mojo: Error while initializing binding BindingToConstructor[@Named(&quot;com.gitlab.tkslaw:ditests-maven-plugin:0.1.0-SNAPSHOT:inject-service&quot;) InjectServiceMojoFactory][]: No binding to construct an instance for key ArtifactManager.  Existing bindings:\n[ERROR]  - @Named(&quot;com.gitlab.tkslaw:ditests-maven-plugin:0.1.0-SNAPSHOT:get-service&quot;) DITestsMojoBase\n[ERROR]  - @Named(&quot;com.gitlab.tkslaw:ditests-maven-plugin:0.1.0-SNAPSHOT:get-service&quot;) GetServiceMojo\n[ERROR]  - @Named(&quot;com.gitlab.tkslaw:ditests-maven-plugin:0.1.0-SNAPSHOT:get-service&quot;) GetServiceMojoFactory\n[ERROR]  - @Named(&quot;com.gitlab.tkslaw:ditests-maven-plugin:0.1.0-SNAPSHOT:get-service&quot;) Mojo\n[ERROR]  - @Named(&quot;com.gitlab.tkslaw:ditests-maven-plugin:0.1.0-SNAPSHOT:get-service&quot;) Object\n[ERROR]  - @Named(&quot;com.gitlab.tkslaw:ditests-maven-plugin:0.1.0-SNAPSHOT:inject-service&quot;) DITestsMojoBase\n[ERROR]  - @Named(&quot;com.gitlab.tkslaw:ditests-maven-plugin:0.1.0-SNAPSHOT:inject-service&quot;) InjectServiceMojo\n[ERROR]  - @Named(&quot;com.gitlab.tkslaw:ditests-maven-plugin:0.1.0-SNAPSHOT:inject-service&quot;) InjectServiceMojoFactory\n[ERROR]  - @Named(&quot;com.gitlab.tkslaw:ditests-maven-plugin:0.1.0-SNAPSHOT:inject-service&quot;) Mojo\n[ERROR]  - @Named(&quot;com.gitlab.tkslaw:ditests-maven-plugin:0.1.0-SNAPSHOT:inject-service&quot;) Object\n[ERROR]  - DITestsMojoBase\n[ERROR]  - GetServiceMojo\n[ERROR]  - GetServiceMojoFactory\n[ERROR]  - InjectServiceMojo\n[ERROR]  - InjectServiceMojoFactory\n[ERROR]  - Log\n[ERROR]  - Mojo\n[ERROR]  - MojoExecution\n[ERROR]  - Object\n[ERROR]  - Project\n[ERROR]  - ProtoSession\n[ERROR]  - Session\n</code></pre>\n",
    "tags" : [ "java", "maven", "maven-plugin", "maven-4" ],
    "owner" : {
      "account_id" : 8532578,
      "reputation" : 49884,
      "user_id" : 6395627,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Slaw",
      "link" : "https://stackoverflow.com/users/6395627/slaw"
    },
    "is_answered" : false,
    "view_count" : 168,
    "answer_count" : 0,
    "score" : 3,
    "last_activity_date" : 1755276849,
    "creation_date" : 1755153018,
    "link" : "https://stackoverflow.com/questions/79735022/how-to-get-the-new-maven-4-dependency-injection-api-to-work-the-same-in-a-maven",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140666464,
    "post_id" : 79735022,
    "body" : "@khmarbaise Added GitLab link: <a href=\"https://gitlab.com/tkslaw/maven4-di-tests\" rel=\"nofollow noreferrer\">gitlab.com/tkslaw/maven4-di-tests</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 8532578,
      "reputation" : 49884,
      "user_id" : 6395627,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Slaw",
      "link" : "https://stackoverflow.com/users/6395627/slaw"
    },
    "creation_date" : 1755200396,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140665672,
    "post_id" : 79735022,
    "body" : "Is this project somewhere on Github or a like available?",
    "score" : 0,
    "owner" : {
      "account_id" : 112317,
      "reputation" : 98425,
      "user_id" : 296328,
      "user_type" : "registered",
      "accept_rate" : 60,
      "profile_image" : "https://i.sstatic.net/DSpH6.jpg?s=256",
      "display_name" : "khmarbaise",
      "link" : "https://stackoverflow.com/users/296328/khmarbaise"
    },
    "creation_date" : 1755181664,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140665654,
    "post_id" : 79735022,
    "body" : "You may be right. Though I&#39;m hesitant to think this is a bug in Maven simply because (1) I&#39;m not overly familiar with implementing Maven plugins to begin with and (2) this is the 4th release candidate, not a beta or earlier version. The second point leads me to assume I must be doing something wrong, because surely it&#39;s common to want to inject services (and thus a well-tested feature, yes?). So, I decided to ask here to see if anyone more knowledgeable can point out any obvious mistakes. I will probably ask in other places if I don&#39;t get an answer here relatively soon.",
    "score" : 0,
    "owner" : {
      "account_id" : 8532578,
      "reputation" : 49884,
      "user_id" : 6395627,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Slaw",
      "link" : "https://stackoverflow.com/users/6395627/slaw"
    },
    "creation_date" : 1755181405,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140665606,
    "post_id" : 79735022,
    "body" : "Awesome question, but I don&#39;t expect this to be answered on Stack Overflow. This seems to be more for a forum or mailing list for Maven itself. For all you know, you&#39;ve found a bug.",
    "score" : 0,
    "owner" : {
      "account_id" : 187094,
      "reputation" : 5301,
      "user_id" : 424903,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/8oHZF.png?s=256",
      "display_name" : "Gimby",
      "link" : "https://stackoverflow.com/users/424903/gimby"
    },
    "creation_date" : 1755180834,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}