{
  "question" : {
    "question_id" : 79829598,
    "title" : "Group and process unordered records in a CSV file with Spring Batch",
    "body" : "<p>A CSV file needs to be processed using Spring Batch where multiple rows could be grouped based on a field value. In the below sample, two lines in the CSV have the same <code>GROUP_NAME</code> with the value <code>group_1</code>. It is also to be noted that the records are not necessarily ordered.</p>\n<pre><code>GROUP_NAME,ENTITY_NAME,DATA,ADDITIONAL_DATA\ngroup_1,Foo book,&quot;{&quot;&quot;paperback&quot;&quot; : true}&quot;,&quot;{&quot;&quot;digital&quot;&quot;:false}&quot;\ngroup_999,Bar book,,\ngroup_1,Foo book,&quot;{&quot;&quot;edition&quot;&quot;:5}&quot;\n</code></pre>\n<p>The end goal is to create one database row from the two lines for <code>group_1</code> as:</p>\n<div class=\"s-table-container\"><table class=\"s-table\">\n<thead>\n<tr>\n<th>ID</th>\n<th>ENTITY_NAME</th>\n<th>DATA</th>\n<th>ADDITIONAL_DATA</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>Foo book</td>\n<td>{&quot;paperback&quot; : true, &quot;edition&quot; : 5}</td>\n<td>{&quot;digital&quot; : false}</td>\n</tr>\n</tbody>\n</table></div>\n<p>Spring Batch does provide a way to split the input into partitions before the job starts and then process them in chunks but it cannot be applied to this use case as the records belonging to the same GROUP_NAME are dynamic and partitioning cannot be used. Further, records belonging to the same <code>GROUP_NAME</code> could span multiple chunks and chunks are processed independently.</p>\n<p>As per <a href=\"https://stackoverflow.com/questions/76366440/how-to-group-the-records-in-spring-batch-5-x-so-that-every-thread-execution-is-d\">How to group the records in Spring Batch 5.x so that every thread/execution is dedicated for one group of records</a>, chunk based processing is not suitable for this use case and I also have a limitation that a staging database table cannot be used(to which the CSV contents could have been loaded and then a <code>GROUP BY</code> clause would have helped).</p>\n<p>One way to solve this would be to:</p>\n<ul>\n<li><p>Sort the lines in the CSV file based on the <code>GROUP_NAME</code> field(yes, this is going to be expensive and sorting at Operating System level seems to be performant)</p>\n</li>\n<li><p>Use <a href=\"https://docs.spring.io/spring-batch/docs/current/api/org/springframework/batch/item/support/SingleItemPeekableItemReader.html\" rel=\"nofollow noreferrer\">SingleItemPeekableItemReader</a> to read the lines, collect the records(lines) until a change is identified in <code>GROUP_NAME</code></p>\n</li>\n</ul>\n<p>Given that Spring Batch is designed to process records independently, is there a better way compared to sorting the file content and grouping the records using <code>SingleItemPeekableItemReader</code> in order to implement this use case with Spring Batch?</p>\n",
    "tags" : [ "java", "spring", "spring-boot", "spring-batch" ],
    "owner" : {
      "account_id" : 8561217,
      "reputation" : 43,
      "user_id" : 6415207,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9bcdd71971efd39d07d7ebca85be3be2?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "pradhan",
      "link" : "https://stackoverflow.com/users/6415207/pradhan"
    },
    "is_answered" : false,
    "view_count" : 44,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1764086449,
    "creation_date" : 1764068372,
    "link" : "https://stackoverflow.com/questions/79829598/group-and-process-unordered-records-in-a-csv-file-with-spring-batch",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}