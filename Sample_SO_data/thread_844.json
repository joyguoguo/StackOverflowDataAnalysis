{
  "question" : {
    "question_id" : 79767541,
    "title" : "Difference in character-set reading from command line",
    "body" : "<p>I am trying to compile/convert a Java program that I wrote from using the &quot;normal&quot; JDK (Java v24) to natively compiled code using the GraalVM (v25). The &quot;classic&quot; version runs fine. The native version starts up OK but then it has an issue with program arguments read-in from the command-line which are apparently in a different character set than the ones being used by the original Java application (or the filename are being dealt with differently).</p>\n<p>The issue is triggerend by passing a filename-argument to the application (via drag-and-drop) that contains Umlauts. Both program variants echo the passed-in filename (actually the full file-path) as:</p>\n<pre><code>U:\\Documents\\Kontoauszï¿½ge\\...\\Umsatzï¿½bersicht_20250401-20250831.csv\n</code></pre>\n<p>i.e. also in the classic version the filename echoed on the console seems &quot;garbled&quot; (the <code>ï¿½</code> is actually an <code>ü</code> in the file system), but the classic Java version finds, opens and processes that file without any issue. The GraalVM's compiled native executable echoes the very same filename also &quot;garbled&quot; but then throws a FileNotFound-Exception:</p>\n<pre><code>java.io.FileNotFoundException: U:\\Documents\\Kontoauszï¿½ge\\...\\Umsatzï¿½bersicht_20250401-20250831_AT221600000100586916.csv (The system cannot find the path specified)\n</code></pre>\n<p>(Note: I left out irrelevant fractions of the path here for privacy reason and replaced them with <code>...</code>).</p>\n<p>Why is this name/path handling behavior is different? Is there an option to align the command-line character set used by the GraalVM generated native's code's with the character set being used by the JDK-based &quot;vanilla&quot; Java code?</p>\n<p><strong>Later addition - answering misc. questions:</strong></p>\n<p>This is on Windows 10 (all current fixes/patches/updates installed).\nNo &quot;VM&quot; other than the Java VM is involved here. The actual filename/path is <code>U:\\Documents\\Kontoauszüge\\...\\Umsatzübersicht_20250401-20250831.csv</code>\n(the <code>...</code>-part of the path does not contain any Umlauts or other special characters).</p>\n<pre><code>C:\\&gt;chcp\nActive code page: 437\n</code></pre>\n<p>My Windows system region settings are &quot;English (Switzerland)&quot; (yes - that exists). The system's display language is &quot;English (US)&quot;.</p>\n<p>The drag-and-drop I mentioned is via the Windwos Explorer, the &quot;GUI&quot; that some respondents wanted to know about is the Windows desktop. I drag the file that I want to be processed over a command-file which then calls the java application passing the argument via <code>%1</code> to the command line calling the java application (or the .exe in the GraalVM case).</p>\n",
    "tags" : [ "java", "graalvm" ],
    "owner" : {
      "account_id" : 186200,
      "reputation" : 4396,
      "user_id" : 423411,
      "user_type" : "registered",
      "accept_rate" : 25,
      "profile_image" : "https://www.gravatar.com/avatar/c10c9233ec4dc1174a22150f3c76c792?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "mmo",
      "link" : "https://stackoverflow.com/users/423411/mmo"
    },
    "is_answered" : true,
    "view_count" : 185,
    "answer_count" : 1,
    "score" : 2,
    "last_activity_date" : 1758420636,
    "creation_date" : 1758123369,
    "link" : "https://stackoverflow.com/questions/79767541/difference-in-character-set-reading-from-command-line",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79769049,
    "question_id" : 79767541,
    "body" : "<h1>Known Issue on Windows</h1>\n<p>This is a known issue on Windows: <a href=\"https://github.com/oracle/graal/issues/8593\" rel=\"nofollow noreferrer\">[GR-52826] Non-ASCII characters in command line arguments are replaced by U+FFFD in Windows (native-image) #8593</a>. In short, the problem is that the command-line arguments are not being decoded correctly, which means your program is not receiving the correct file path. Hence a file-not-found exception. Unfortunately, this issue doesn't seem to be a priority. See <a href=\"https://github.com/oracle/graal/issues/8593#issuecomment-2012276626\" rel=\"nofollow noreferrer\">this comment</a> (March 2024):</p>\n<blockquote>\n<p>Ok, so I have discussed this internally: The JDK seems to convert arguments in their app launchers: <a href=\"https://github.com/openjdk/jdk/blob/700d2b91defd421a2818f53830c24f70d11ba4f6/src/jdk.jpackage/windows/native/common/WinSysInfo.cpp#L137\" rel=\"nofollow noreferrer\">https://github.com/openjdk/jdk/blob/700d2b91defd421a2818f53830c24f70d11ba4f6/src/jdk.jpackage/windows/native/common/WinSysInfo.cpp#L137</a></p>\n<p>Instead of doing this, we can avoid the additional overhead (and potential for errors) by switching to <a href=\"https://learn.microsoft.com/en-us/cpp/c-language/using-wmain\" rel=\"nofollow noreferrer\">wmain</a> on Windows. This will also allow us to provide other features on Windows such as a javaw.exe like entry point that allows running an app without a command prompt.</p>\n<p><strong>We currently have no ETA for this but we will update this ticket when we do</strong> <em>[emphasis added]</em>.</p>\n</blockquote>\n<p>And <a href=\"https://github.com/oracle/graal/issues/8593#issuecomment-2059671080\" rel=\"nofollow noreferrer\">this comment</a> (April 2024):</p>\n<blockquote>\n<p>I would be surprised if this bug gets a fix this year. It just can't be a priority: it's only in Windows while the majority of Java apps run on Linux + it's in command line parsing and the majority of Java apps don't do much of it.</p>\n</blockquote>\n<h2>Possible Solution - Custom Manifest</h2>\n<p>The <a href=\"https://github.com/oracle/graal/issues/8593#issuecomment-2163855269\" rel=\"nofollow noreferrer\">last comment</a> (June 2024) on the issue, as of this answer, says:</p>\n<blockquote>\n<p>Apparently Microsoft does a U-turn with their encodings zoo and now promotes using UTF-8 for new applications <a href=\"https://learn.microsoft.com/en-us/windows/apps/design/globalizing/use-utf8-code-page\" rel=\"nofollow noreferrer\">using a dedicated manifest property</a>. The introduced <code>activeCodePage</code> manifest property was introduced in Windows 10 Version 1903.</p>\n<blockquote>\n<p>Until recently, Windows has emphasized &quot;Unicode&quot; -W variants over -A APIs. However, recent releases have used the ANSI code page and -A APIs as a means to introduce UTF-8 support to apps. If the ANSI code page is configured for UTF-8, then -A APIs typically operate in UTF-8. This model has the benefit of supporting existing code built with -A APIs without any code changes.</p>\n</blockquote>\n<p>The articles goes so far as to call &quot;Win32 API [that] might only understand WCHAR&quot; <em>legacy</em>.</p>\n<p>It's also possible to slap this manifest onto an existing exe. I'll try it in the meantime.</p>\n<p>See also a <a href=\"https://devblogs.microsoft.com/oldnewthing/20220531-00/?p=106697\" rel=\"nofollow noreferrer\">blog post</a> from Raymond Chen about this feature.</p>\n</blockquote>\n<p>The end of the comment mentions <a href=\"https://learn.microsoft.com/en-us/windows/win32/sbscs/manifests\" rel=\"nofollow noreferrer\">manifests</a> and suggests you can modify an existing executable's manifest. This would allow you to set the <code>activeCodePage</code> to UTF-8. Modifying manifests can be done with the <a href=\"https://learn.microsoft.com/en-us/windows/win32/sbscs/mt-exe\" rel=\"nofollow noreferrer\">mt.exe</a> tool, which is obtained by installing the Windows SDK.</p>\n<p>From some testing, GraalVM's <code>native-image</code> does not add a manifest to the executable. At least for simple applications. So, you should be able to simply insert your own without worrying about overriding anything. Though as I understand it, the <code>mt.exe</code> tool does provide a way to merge multiple manifests together. I don't know how well that works as I've never tried it. Regardless, once you have your manifest you can insert it with the following command:</p>\n<pre class=\"lang-none prettyprint-override\"><code>mt -manifest &lt;manifest-file&gt; -outputresource:&lt;exe-file&gt;;#1\n</code></pre>\n<p>If an executable already has a manifest then you can extract it with:</p>\n<pre class=\"lang-none prettyprint-override\"><code>mt -inputresource:&lt;exe-file&gt;#1 -out:original.manifest\n</code></pre>\n<p>From some trial and error, the following manifest seems sufficient to set the active code page of the executable to UTF-8:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;\n\n&lt;assembly xmlns=&quot;urn:schemas-microsoft-com:asm.v1&quot; manifestVersion=&quot;1.0&quot; xmlns:asmv3=&quot;urn:schemas-microsoft-com:asm.v3&quot;&gt;\n  &lt;assemblyIdentity type=&quot;win32&quot; name=&quot;Organization.Division.Name&quot; version=&quot;1.0.0.0&quot;/&gt;\n  &lt;asmv3:application&gt;\n    &lt;asmv3:windowsSettings xmlns=&quot;http://schemas.microsoft.com/SMI/2019/WindowsSettings&quot;&gt; \n      &lt;activeCodePage&gt;UTF-8&lt;/activeCodePage&gt; \n    &lt;/asmv3:windowsSettings&gt;\n  &lt;/asmv3:application&gt;\n&lt;/assembly&gt;\n</code></pre>\n<p>There may be a more appropriate manifest for this, such as including other elements like compatibility and security information. But I have very little experience with these manifests so I don't know what the best practices are. Note you will probably want to put your own values for the <code>name</code> and <code>version</code> attributes. For an example, the <code>jpackage</code> tool sets the <code>name</code> attribute to <code>jpackageapplauncher.exe</code> and the <code>version</code> attribute to the version of the JDK (e.g., <code>25.0.0.0</code> for JDK 25).</p>\n<p>The <code>mt.exe</code> tool also provides a way to validate manifests:</p>\n<pre class=\"lang-none prettyprint-override\"><code>mt -manifest &lt;manifest-file&gt; -validate_manifest\n</code></pre>\n<p>Which is likely easier than inserting the manifest, getting a so-called &quot;side-by-side configuration&quot; error, and then using <code>sxstrace</code> to debug the problem; I didn't notice the <code>-validate_manifest</code> option until after getting it to work \uD83E\uDD26.</p>\n<hr />\n<h1>Example</h1>\n<p>Here's an example using the manifest solution. Note you'll need <code>mt.exe</code> on the path for the <code>run-tests.ps1</code> PowerShell script to work.</p>\n<p>The example includes a test of a <code>jpackage</code> application image to show that it works without needing the patch (as suggested by the first comment I quoted from the issue linked earlier).</p>\n<h2>Versions</h2>\n<ul>\n<li>Windows 10/11 (English language, United States)</li>\n<li>GraalVM JDK 25+37.1</li>\n<li>PowerShell Core 7.5.3</li>\n</ul>\n<h2>Project Structure</h2>\n<pre class=\"lang-none prettyprint-override\"><code>D:\\GRAALVM-ENCODING-TESTS\n|   run-tests.ps1\n|   test.manifest\n|   Umsatzübersicht.txt\n|\n\\---src\n    |   module-info.java\n    |\n    \\---com\n        \\---example\n                Main.java\n</code></pre>\n<h2>Source Code</h2>\n<p><strong>module-info.java</strong>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>module test {}\n</code></pre>\n<p><strong>Main.java</strong>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.example;\n\nimport java.nio.file.Files;\nimport java.nio.file.Path;\n\npublic class Main {\n  \n  public static void main(String[] args) {\n    if (args.length != 1) {\n      System.err.println(&quot;Expected a single file argument.&quot;);\n      System.err.flush();\n      System.exit(1);\n    }\n\n    System.out.println();\n    printProperty(&quot;stdout.encoding&quot;);\n    printProperty(&quot;stderr.encoding&quot;);\n    printProperty(&quot;file.encoding&quot;);\n    System.out.println();\n\n    boolean success;\n    try {\n      var path = Path.of(args[0]).toAbsolutePath().normalize();\n      System.out.printf(&quot;Path: %s%n%n&quot;, path);\n\n      var contents = Files.readString(path);\n      System.out.printf(&quot;Contents:%n%s%n&quot;, contents.indent(2));\n      \n      success = true;\n    } catch (Exception ex) {\n      ex.printStackTrace();\n      success = false;\n    }\n\n    System.out.flush();\n    System.err.flush();\n    System.exit(success ? 0 : 2);\n  }\n\n  static void printProperty(String key) {\n    System.out.printf(&quot;%-15s = %s%n&quot;, key, System.getProperty(key));\n  }\n}\n\n</code></pre>\n<p><strong>Umsatzübersicht.txt</strong></p>\n<pre class=\"lang-none prettyprint-override\"><code>This is a test file whose name contains Unicode characters. If you're seeing\nthis text, then that means the program successfully found and read this file.\n\nHurray!\n\n</code></pre>\n<p><strong>test.manifest</strong></p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;\n\n&lt;assembly xmlns=&quot;urn:schemas-microsoft-com:asm.v1&quot; manifestVersion=&quot;1.0&quot; xmlns:asmv3=&quot;urn:schemas-microsoft-com:asm.v3&quot;&gt;\n  &lt;assemblyIdentity type=&quot;win32&quot; name=&quot;Organization.Division.Name&quot; version=&quot;1.0.0.0&quot;/&gt;\n  &lt;asmv3:application&gt;\n    &lt;asmv3:windowsSettings xmlns=&quot;http://schemas.microsoft.com/SMI/2019/WindowsSettings&quot;&gt; \n      &lt;activeCodePage&gt;UTF-8&lt;/activeCodePage&gt; \n    &lt;/asmv3:windowsSettings&gt;\n  &lt;/asmv3:application&gt;\n&lt;/assembly&gt;\n</code></pre>\n<p><strong>run-tests.ps1</strong></p>\n<pre class=\"lang-bash prettyprint-override\"><code>&lt;#\n.SYNOPSIS\n  Builds the project, runs tests on each executable, then report the results.\n\n.DESCRIPTION\n  Runs tests of various Java-based executables to see if they correctly interpret command-line\n  arguments that contain Unicode characters. This script is designed to only work on Windows.\n\n  This script requires a GraalVM JDK to work. Which GraalVM JDK to use can be specified via the\n  -GraalVMHome parameter or the 'GRAALVM_HOME' environment variable. The parameter takes\n  precedence. If neither the parameter nor the environment variable are set to a valid GraalVM JDK\n  installation then this script will fail.\n\n  The Windows manifest tool ('mt.exe') must be on the path for this script to work. That tool can\n  be obtained by installing the Windows SDK.\n\n  When building the project, five things happen in the following order:\n\n    1) The Java source files under 'src\\' are compiled and output to 'out\\modules\\test'.\n    2) The Java class files are packaged into a JAR file at 'out\\test-1.0.jar'.\n    3) An application image is created via 'jpackage' and output to 'out\\test'.\n    4) A native image is created and output to 'out\\test-1.0.exe'\n    5) A copy of the native image is created and output to 'out\\test-patched-1.0.exe'. The 'mt.exe'\n       tool is then used to insert 'test.manifest' into the copy.\n\n  The build step will be skipped if the 'out' directory already exists. To force a build, either\n  delete the 'out' directory or pass -Rebuild.\n\n  If the build succeeds, or the project was already built, then four tests are executed:\n\n    1) JAR file:\n        java -p out -m test .\\Umsatzübersicht.txt\n    2) Application image:\n        .\\out\\test\\test.exe .\\Umsatzübersicht.txt\n    3) Native image:\n        .\\out\\test-1.0.exe .\\Umsatzübersicht.txt\n    4) Patched native image:\n        .\\out\\test-patched-1.0.exe .\\Umsatzübersicht.txt\n\n  The result of each test will be reported at the end.\n\n.PARAMETER GraalVMHome\n  Path to the GraalVM JDK to use. If this parameter is not set then the 'GRAALVM_HOME' environment\n  variable is used. This parameter and/or the aforementioned environment variable must be set to a\n  valid GraalVM JDK installation.\n\n.PARAMETER Rebuild\n  Forces a build of the project even if previous build output still exists.\n\n.INPUTS\n  None\n\n.OUTPUTS\n  None\n#&gt;\nparam(\n  [Parameter(Position=0)]\n  [string]$GraalVMHome,\n\n  [switch]$Rebuild\n)\n\n###############################################################################\n#                                                                             #\n# Setup                                                                       #\n#                                                                             #\n###############################################################################\n$ErrorActionPreference = 'Stop'\n$ProgressPreference = 'Ignore'\n\n# Ensure operating system is Windows.\nif (!$IsWindows) {\n  Write-Host 'Operating system is not Windows.' -ForegroundColor Red\n  Exit\n}\n\n# Ensure GraalVM home has been configured, either via parameter or environment variable.\nif (!$GraalVMHome) {\n  $GraalVMHome = $env:GRAALVM_HOME\n  if (!$GraalVMHome) {\n    Write-Host 'GraalVM location not specified.' -ForegroundColor Red\n    Exit\n  }\n}\n$GraalVMHome = Resolve-Path $GraalVMHome\nWrite-Host &quot;GraalVM home: &quot; -ForegroundColor Yellow -NoNewline\nWrite-Host $GraalVMHome -ForegroundColor Cyan\n\n# Resolve tools. Will fail script if they can't be resolved.\n$java        = Resolve-Path (Join-Path $GraalVMHome 'bin\\java.exe')\n$javac       = Resolve-Path (Join-Path $GraalVMHome 'bin\\javac.exe')\n$jar         = Resolve-Path (Join-Path $GraalVMHome 'bin\\jar.exe')\n$jpackage    = Resolve-Path (Join-Path $GraalVMHome 'bin\\jpackage.exe')\n$nativeImage = Resolve-Path (Join-Path $GraalVMHome 'bin\\native-image.cmd')\n\n&lt;#\nEnsure console output is UTF-8.\n\nWARNING: This setting will be permanently changed for the current session. If needed, the session\n         will need to be restarted or the encoding will need to be manually set to the original\n         encoding to undo the change.\n#&gt;\nWrite-Host\nWrite-Host &quot;Setting console output to UTF-8. This will not be undone!&quot; -ForegroundColor Yellow -BackgroundColor DarkRed -NoNewline\nWrite-Host\n&amp; chcp 65001 &gt; NUL\n[System.Console]::OutputEncoding = [System.Text.Encoding]::UTF8\n\n###############################################################################\n#                                                                             #\n# Helper Functions                                                            #\n#                                                                             #\n###############################################################################\n$HEADER_FOOTER_WIDTH = 80 # Assumed to be even\n$HEADER_FOOTER_COLOR = 'DarkYellow'\n$RESULT_TEST_NAME_WIDTH = 50\n\nfunction _PrintHeader {\n  param([string]$Label)\n\n  $pad = ($HEADER_FOOTER_WIDTH / 2) - ($Label.Length / 2) - 1\n\n  Write-Host\n  Write-Host ('#' * $HEADER_FOOTER_WIDTH) -ForegroundColor $HEADER_FOOTER_COLOR\n  Write-Host ('#' + (' ' * ($HEADER_FOOTER_WIDTH - 2)) + '#') -ForegroundColor $HEADER_FOOTER_COLOR\n  Write-Host ('#' + (' ' * $pad) + $Label + (' ' * $pad) + '#') -ForegroundColor $HEADER_FOOTER_COLOR\n  Write-Host ('#' + (' ' * ($HEADER_FOOTER_WIDTH - 2)) + '#') -ForegroundColor $HEADER_FOOTER_COLOR\n  Write-Host ('#' * $HEADER_FOOTER_WIDTH) -ForegroundColor $HEADER_FOOTER_COLOR\n  Write-Host\n}\n\nfunction _PrintFooter {\n  Write-Host\n  Write-Host ('*' * $HEADER_FOOTER_WIDTH) -ForegroundColor $HEADER_FOOTER_COLOR\n  Write-Host\n}\n\nfunction _PrintResult {\n  param([string]$TestName, [bool]$Successful)\n\n  $width = $RESULT_TEST_NAME_WIDTH\n\n  Write-Host $TestName -ForegroundColor Cyan -NoNewline\n  Write-Host ('.' * ($width - $TestName.Length)) -NoNewline\n  if ($Successful) {\n    Write-Host &quot;SUCCESS&quot; -ForegroundColor Green\n  } else {\n    Write-Host &quot;FAILURE&quot; -ForegroundColor Red\n  }\n}\n\nfunction _RunCommand {\n  param([string]$Executable, [string[]]$Arguments, [switch]$NoExitOnFailure, [switch]$DiscardOutput)\n\n  # log command and arguments\n  Write-Host &quot;Running command: &quot; -ForegroundColor Yellow -NoNewline\n  if ($Executable.StartsWith($GraalVMHome)) {\n    Write-Host &quot;$(Split-Path $Executable -Leaf) &quot; -ForegroundColor Blue -NoNewline\n  } else {\n    Write-Host &quot;$Executable &quot; -ForegroundColor Blue -NoNewline\n  }\n  foreach ($Argument in $Arguments) {\n    $FgColor = $Argument.StartsWith('-') ? 'Magenta' : 'Cyan'\n    Write-host &quot;$Argument &quot; -ForegroundColor $FgColor -NoNewline\n  }\n  Write-Host\n\n  # execute command\n  if ($DiscardOutput) {\n    $proc = Start-Process $Executable $Arguments -NoNewWindow -Wait -PassThru -RedirectStandardOutput 'NUL'\n  } else {\n    $proc = Start-Process $Executable $Arguments -NoNewWindow -Wait -PassThru\n  }\n\n  # handle command result\n  if ($proc.ExitCode -ne 0) {\n    if ($NoExitOnFailure) {\n      return $false\n    } else {\n      Write-Host &quot;Command failed!&quot; -ForegroundColor Red\n      Exit\n    }\n  } elseif ($NoExitOnFailure) {\n    return $true\n  }\n}\n\n###############################################################################\n#                                                                             #\n# Build &amp; Test Implementation                                                 #\n#                                                                             #\n###############################################################################\n\n# Build project if requested or previous output does not exist.\n$outputExists = Test-Path 'out' -PathType Container\nif ($Rebuild -or !$outputExists) {\n  _PrintHeader 'Building Project'\n\n  # Delete previous output if it exists.\n  if ($outputExists) {\n    Write-Host 'Deleting previous output.' -ForegroundColor Yellow\n    Remove-Item 'out' -Recurse\n  } else {\n    Write-Host &quot;No previous output.&quot; -ForegroundColor Yellow\n  }\n\n  # Compile Java source files.\n  _RunCommand $javac @('--module-source-path', 'test=src', '-m', 'test', '--module-version', '1.0', '-d', 'out\\modules')\n\n  # Package Java class files in JAR file.\n  _RunCommand $jar @('-c', '-f', 'out\\test-1.0.jar', '-e', 'com.example.Main', '-C', 'out\\modules\\test', '.')\n\n  # Create application image.\n  _RunCommand $jpackage @(\n    '-t', 'app-image',\n    '-n', 'test',\n    '--app-version', '1.0',\n    '-p', 'out',\n    '-m', 'test',\n    '-d', 'out',\n    '--jlink-options', '&quot;--no-header-files --no-man-pages --strip-native-commands --compress zip-0&quot;'\n    '--win-console')\n  Set-ItemProperty -Path 'out\\test\\test.exe' -Name 'IsReadOnly' -Value $false\n\n  # Create GraalVM native image.\n  _RunCommand $nativeImage @('-p', 'out', '-m', 'test', '-Ob', '-o', 'out\\test-1.0', '--silent')\n\n  # Copy GraalVM native image then patch the copy with the new manifest file.\n  Copy-Item 'out\\test-1.0.exe' 'out\\test-patched-1.0.exe'\n  _RunCommand 'mt.exe' @('-manifest', 'test.manifest', '-outputresource:out\\test-patched-1.0.exe;#1') -DiscardOutput\n\n  Write-Host &quot;Build successful!&quot; -ForegroundColor Green\n  _PrintFooter\n}\n\n# Build done. Now run tests.\n\n_PrintHeader 'Testing JAR File'\n$jarTest = _RunCommand $java @('-p', 'out', '-m', 'test', '.\\Umsatzübersicht.txt') -NoExitOnFailure\n_PrintFooter\n\n_PrintHeader 'Testing Application Image (jpackage)'\n$appTest = _RunCommand '.\\out\\test\\test.exe' @('.\\Umsatzübersicht.txt') -NoExitOnFailure\n_PrintFooter\n\n_PrintHeader 'Testing Native Image'\n$nativeTest = _RunCommand '.\\out\\test-1.0.exe' @('.\\Umsatzübersicht.txt') -NoExitOnFailure\n_PrintFooter\n\n_PrintHeader 'Testing Native Image (Patched)'\n$patchedNativeTest = _RunCommand '.\\out\\test-patched-1.0.exe' @('.\\Umsatzübersicht.txt') -NoExitOnFailure\n_PrintFooter\n\nWrite-Host &quot;Results:&quot; -ForegroundColor Yellow\n_PrintResult 'JAR File' $jarTest\n_PrintResult 'Application Image (jpackage)' $appTest\n_PrintResult 'Native Image' $nativeTest\n_PrintResult 'Patched Native Image' $patchedNativeTest\nWrite-Host\n\nWrite-Host &quot;TESTING COMPLETE&quot; -ForegroundColor Green\n</code></pre>\n<h2>Output</h2>\n<pre class=\"lang-none prettyprint-override\"><code>PS D:\\graalvm-encoding-tests&gt; ./run-tests\nGraalVM home: D:\\Program Files\\GraalVM\\graalvm-jdk-25+37.1\n\nSetting console output to UTF-8. This will not be undone!\n\n################################################################################\n#                                                                              #\n#                               Building Project                               #\n#                                                                              #\n################################################################################\n\nNo previous output.\nRunning command: javac.exe --module-source-path test=src -m test --module-version 1.0 -d out\\modules\nRunning command: jar.exe -c -f out\\test-1.0.jar -e com.example.Main -C out\\modules\\test .\nRunning command: jpackage.exe -t app-image -n test --app-version 1.0 -p out -m test -d out --jlink-options &quot;--no-header-files --no-man-pages --strip-native-commands --compress zip-0&quot; --win-console\nRunning command: native-image.cmd -p out -m test -Ob -o out\\test-1.0 --silent\nRunning command: mt.exe -manifest test.manifest -outputresource:out\\test-patched-1.0.exe;#1\nBuild successful!\n\n********************************************************************************\n\n\n################################################################################\n#                                                                              #\n#                               Testing JAR File                               #\n#                                                                              #\n################################################################################\n\nRunning command: java.exe -p out -m test .\\Umsatzübersicht.txt\n\nstdout.encoding = UTF-8\nstderr.encoding = UTF-8\nfile.encoding   = UTF-8\n\nPath: D:\\graalvm-encoding-tests\\Umsatzübersicht.txt\n\nContents:\n  This is a test file whose name contains Unicode characters. If you're seeing\n  this text, then that means the program successfully found and read this file.\n\n  Hurray!\n\n\n********************************************************************************\n\n\n################################################################################\n#                                                                              #\n#                     Testing Application Image (jpackage)                     #\n#                                                                              #\n################################################################################\n\nRunning command: .\\out\\test\\test.exe .\\Umsatzübersicht.txt\n\nstdout.encoding = UTF-8\nstderr.encoding = UTF-8\nfile.encoding   = UTF-8\n\nPath: D:\\graalvm-encoding-tests\\Umsatzübersicht.txt\n\nContents:\n  This is a test file whose name contains Unicode characters. If you're seeing\n  this text, then that means the program successfully found and read this file.\n\n  Hurray!\n\n\n********************************************************************************\n\n\n################################################################################\n#                                                                              #\n#                             Testing Native Image                             #\n#                                                                              #\n################################################################################\n\nRunning command: .\\out\\test-1.0.exe .\\Umsatzübersicht.txt\n\nstdout.encoding = UTF-8\nstderr.encoding = UTF-8\nfile.encoding   = UTF-8\n\nPath: D:\\graalvm-encoding-tests\\Umsatz�bersicht.txt\n\njava.nio.file.NoSuchFileException: D:\\graalvm-encoding-tests\\Umsatz�bersicht.txt\n        at java.base@25/sun.nio.fs.WindowsFileSystemProvider.newByteChannel(WindowsFileSystemProvider.java:231)\n        at java.base@25/java.nio.file.Files.newByteChannel(Files.java:357)\n        at java.base@25/java.nio.file.Files.newByteChannel(Files.java:399)\n        at java.base@25/java.nio.file.Files.readAllBytes(Files.java:2973)\n        at java.base@25/java.nio.file.Files.readString(Files.java:3043)\n        at java.base@25/java.nio.file.Files.readString(Files.java:3006)\n        at test@1.0/com.example.Main.main(Main.java:26)\n        at java.base@25/java.lang.invoke.LambdaForm$DMH/sa346b79c.invokeStaticInit(LambdaForm$DMH)\n\n********************************************************************************\n\n\n################################################################################\n#                                                                              #\n#                        Testing Native Image (Patched)                        #\n#                                                                              #\n################################################################################\n\nRunning command: .\\out\\test-patched-1.0.exe .\\Umsatzübersicht.txt\n\nstdout.encoding = UTF-8\nstderr.encoding = UTF-8\nfile.encoding   = UTF-8\n\nPath: D:\\graalvm-encoding-tests\\Umsatzübersicht.txt\n\nContents:\n  This is a test file whose name contains Unicode characters. If you're seeing\n  this text, then that means the program successfully found and read this file.\n\n  Hurray!\n\n\n********************************************************************************\n\nResults:\nJAR File..........................................SUCCESS\nApplication Image (jpackage)......................SUCCESS\nNative Image......................................FAILURE\nPatched Native Image..............................SUCCESS\n\nTESTING COMPLETE\n</code></pre>\n<h2>Results</h2>\n<div class=\"s-table-container\"><table class=\"s-table\">\n<thead>\n<tr>\n<th>Test</th>\n<th>Executable</th>\n<th style=\"text-align: center;\">Successful</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>JAR File</td>\n<td><code>out/test-1.0.jar</code></td>\n<td style=\"text-align: center;\">✔️</td>\n</tr>\n<tr>\n<td>App Image (jpackage)</td>\n<td><code>out/test/test.exe</code></td>\n<td style=\"text-align: center;\">✔️</td>\n</tr>\n<tr>\n<td>Native Image</td>\n<td><code>out/test-1.0.exe</code></td>\n<td style=\"text-align: center;\">❌</td>\n</tr>\n<tr>\n<td>Patched Native Image</td>\n<td><code>out/test-patched-1.0.exe</code></td>\n<td style=\"text-align: center;\">✔️</td>\n</tr>\n</tbody>\n</table></div>\n<p>Note <code>sdout.encoding</code>, <code>stderr.encoding</code>, and <code>file.encoding</code> are UTF-8 in all cases.</p>\n<p>Also note <code>out/test-1.0.exe</code> (the <em>unpatched</em> native image) prints <code>...\\Umsatz�bersicht.txt</code>. That contains a replacement character even though the output is UTF-8. This, along with the &quot;patched&quot; executable working, strongly indicates argument decoding was the primary issue.</p>\n",
    "score" : 3,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 8532578,
      "reputation" : 49884,
      "user_id" : 6395627,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Slaw",
      "link" : "https://stackoverflow.com/users/6395627/slaw"
    },
    "creation_date" : 1758247391,
    "last_activity_date" : 1758420636,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140753076,
    "post_id" : 79767541,
    "body" : "@user85421 <a href=\"https://github.com/oracle/graal/issues/8593#issuecomment-2009163353\" rel=\"nofollow noreferrer\">A comment</a> on the referenced issue also says checking that option solved the problem. Only problem with that is it puts the onus on the individual users instead of the application.",
    "score" : 0,
    "owner" : {
      "account_id" : 8532578,
      "reputation" : 49884,
      "user_id" : 6395627,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Slaw",
      "link" : "https://stackoverflow.com/users/6395627/slaw"
    },
    "creation_date" : 1758574513,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140750153,
    "post_id" : 79767541,
    "body" : "I cannot reproduce the problem, maybe because I have checked <code>Beta: Use Unicode UTF-8 for worldwide language support</code> in the Region Settings (the option discussed in this <a href=\"https://stackoverflow.com/q/56419639/85421\">question</a>) or missing the relevant code",
    "score" : 0,
    "owner" : {
      "account_id" : 31180,
      "reputation" : 29752,
      "user_id" : 85421,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/kKvXH.gif?s=256",
      "display_name" : "user85421",
      "link" : "https://stackoverflow.com/users/85421/user85421"
    },
    "creation_date" : 1758444258,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140746251,
    "post_id" : 79767541,
    "body" : "this is a issue: [GR-52826] Non-ASCII characters in command line arguments are replaced by U+FFFD in Windows (native-image) (<a href=\"https://github.com/oracle/graal/issues/8593\" rel=\"nofollow noreferrer\">github.com/oracle/graal/issues/8593</a>)",
    "score" : 0,
    "owner" : {
      "account_id" : 26698569,
      "reputation" : 4070,
      "user_id" : 20306007,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/98bbc403493aee3681b71dae7abef66e?s=256&d=identicon&r=PG",
      "display_name" : "life888888",
      "link" : "https://stackoverflow.com/users/20306007/life888888"
    },
    "creation_date" : 1758253688,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140744618,
    "post_id" : 79767541,
    "body" : "I added answers to misc. questions above to my initial question. Please see above.",
    "score" : 0,
    "owner" : {
      "account_id" : 186200,
      "reputation" : 4396,
      "user_id" : 423411,
      "user_type" : "registered",
      "accept_rate" : 25,
      "profile_image" : "https://www.gravatar.com/avatar/c10c9233ec4dc1174a22150f3c76c792?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "mmo",
      "link" : "https://stackoverflow.com/users/423411/mmo"
    },
    "creation_date" : 1758193035,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140744120,
    "post_id" : 79767541,
    "body" : "While you&#39;re diagnosing this, be aware that <code>ü</code> can consist of <i>two</i> codepoints owing to Unicode composition. Look at the Javadocs for <code>Normalizer</code> if you need more info.",
    "score" : 0,
    "owner" : {
      "account_id" : 22124137,
      "reputation" : 4243,
      "user_id" : 16376827,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/1ImPw.png?s=256",
      "display_name" : "g00se",
      "link" : "https://stackoverflow.com/users/16376827/g00se"
    },
    "creation_date" : 1758179520,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140743813,
    "post_id" : 79767541,
    "body" : "May I ask what your Windows language setting is? German? Or something else? When you run <b>chcp</b> in <code>cmd.exe</code>, what value does it return?",
    "score" : 0,
    "owner" : {
      "account_id" : 26698569,
      "reputation" : 4070,
      "user_id" : 20306007,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/98bbc403493aee3681b71dae7abef66e?s=256&d=identicon&r=PG",
      "display_name" : "life888888",
      "link" : "https://stackoverflow.com/users/20306007/life888888"
    },
    "creation_date" : 1758168934,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140743368,
    "post_id" : 79767541,
    "body" : "Yes, there seems to be an ambiguity about whether arguments are coming from the command line, or via drag-and-drop ...",
    "score" : 0,
    "owner" : {
      "account_id" : 22124137,
      "reputation" : 4243,
      "user_id" : 16376827,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/1ImPw.png?s=256",
      "display_name" : "g00se",
      "link" : "https://stackoverflow.com/users/16376827/g00se"
    },
    "creation_date" : 1758140700,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140743125,
    "post_id" : 79767541,
    "body" : "Can you provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>, including an example file name and contents? You mention drag-and-drop, so I assume your real application involves a GUI. If you can reproduce the problem without a GUI, that would be ideal.",
    "score" : 2,
    "owner" : {
      "account_id" : 8532578,
      "reputation" : 49884,
      "user_id" : 6395627,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Slaw",
      "link" : "https://stackoverflow.com/users/6395627/slaw"
    },
    "creation_date" : 1758132864,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140743028,
    "post_id" : 79767541,
    "body" : "&quot;<i>Why is this name/path handling behavior is different?</i>&quot; -- possibly because one is buggy (or both are buggy in different ways).  Or possibly because your program&#39;s behavior is not well defined under the circumstances in the first place, leaving both results consistent with the language and API specifications.",
    "score" : 0,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1758130460,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140742957,
    "post_id" : 79767541,
    "body" : "So it looks like there&#39;s a character encoding mismatch somewhere.  What does each VM, launched as you presently are doing, report for the <code>native.encoding</code> <a href=\"https://docs.oracle.com/en/java/javase/24/docs/api/java.base/java/lang/System.html#getProperties()\" rel=\"nofollow noreferrer\">system property</a>?  And for good measure, how about the <code>stdout.encoding</code> and <code>stderr.encoding</code> properties?  And what encoding is your shell (PowerShell or cmd.exe, I guess) using?",
    "score" : 1,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1758128326,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140742936,
    "post_id" : 79767541,
    "body" : "Post the actual string, before it is garbled. And post the code doing the text-reading. And name the host OS as well as its character-encoding.",
    "score" : 1,
    "owner" : {
      "account_id" : 322981,
      "reputation" : 346951,
      "user_id" : 642706,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://i.sstatic.net/ZWEI3.jpg?s=256",
      "display_name" : "Basil Bourque",
      "link" : "https://stackoverflow.com/users/642706/basil-bourque"
    },
    "creation_date" : 1758127935,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79769049" : [ {
      "comment_id" : 140751439,
      "post_id" : 79769049,
      "body" : "Thanks again for your efforts. Superb job!",
      "score" : 0,
      "owner" : {
        "account_id" : 186200,
        "reputation" : 4396,
        "user_id" : 423411,
        "user_type" : "registered",
        "accept_rate" : 25,
        "profile_image" : "https://www.gravatar.com/avatar/c10c9233ec4dc1174a22150f3c76c792?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "mmo",
        "link" : "https://stackoverflow.com/users/423411/mmo"
      },
      "creation_date" : 1758527572,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140749851,
      "post_id" : 79769049,
      "body" : "Also, I added a test with <code>jpackage</code> to my answer (along with other changes). Argument decoding works with the executable created by <code>jpackage</code>, so that may be an alternative deployment strategy if one doesn&#39;t strictly need a native image.",
      "score" : 1,
      "owner" : {
        "account_id" : 8532578,
        "reputation" : 49884,
        "user_id" : 6395627,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Slaw",
        "link" : "https://stackoverflow.com/users/6395627/slaw"
      },
      "creation_date" : 1758421240,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140749850,
      "post_id" : 79769049,
      "body" : "In case anyone else can&#39;t find that tool, it comes with the <a href=\"https://developer.microsoft.com/en-us/windows/downloads/windows-sdk/\" rel=\"nofollow noreferrer\">Windows SDK</a>. If you have Visual Studio installed then it should have added <a href=\"https://learn.microsoft.com/en-us/visualstudio/ide/reference/command-prompt-powershell?view=vs-2022\" rel=\"nofollow noreferrer\">some Windows Terminal profiles</a> that will automatically set/modify environment variables for you, which should put <code>mt.exe</code> on the path without having to search for it. There may be non-VS ways as well.",
      "score" : 0,
      "owner" : {
        "account_id" : 8532578,
        "reputation" : 49884,
        "user_id" : 6395627,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Slaw",
        "link" : "https://stackoverflow.com/users/6395627/slaw"
      },
      "creation_date" : 1758421075,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140747139,
      "post_id" : 79769049,
      "body" : "Thanks a lot for your research and this detailed explanation! I very much appreciate your effort in analyzing and explaining the entire issue. Using your manifest and then calling <code>mt ...</code> as described (I first had to dig deep to locate that utility - found it in <code>C:\\Program Files (x86)\\Windows Kits\\10\\bin\\10.0.26100.0\\x64</code> which was not on my path - just for the benefit of anyone trying to reproduced this) I was then indeed able to get this working. :-)",
      "score" : 1,
      "owner" : {
        "account_id" : 186200,
        "reputation" : 4396,
        "user_id" : 423411,
        "user_type" : "registered",
        "accept_rate" : 25,
        "profile_image" : "https://www.gravatar.com/avatar/c10c9233ec4dc1174a22150f3c76c792?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "mmo",
        "link" : "https://stackoverflow.com/users/423411/mmo"
      },
      "creation_date" : 1758283592,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}