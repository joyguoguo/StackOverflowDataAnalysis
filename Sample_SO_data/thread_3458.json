{
  "question" : {
    "question_id" : 79548163,
    "title" : "org.springframework.orm.ObjectOptimisticLockingFailureException While Saving in Kotlin",
    "body" : "<p>While trying to save the entity i am getting the following Exception</p>\n<pre><code>org.springframework.orm.ObjectOptimisticLockingFailureException: Row was updated or deleted by another transaction\n</code></pre>\n<p>These are my Entity and i don't have version field and we cannot add it</p>\n<pre><code>@Entity\n@Table(name = &quot;customer&quot;)\nclass Customer (\n\n    @Id\n    @GeneratedValue\n    @Column(name = &quot;uuid&quot;, updatable = false)\n    val uuid: UUID,\n\n    @Column(name = &quot;first_name&quot;, nullable = false)\n    var firstName: String\n)\n</code></pre>\n<p>and i create entity Object like this</p>\n<pre><code>return Customer(\n            uuid = UUID.randomUUID(),\n            firstName = validatedCreationRequest.firstName?.value?: &quot;&quot;,\n)\n</code></pre>\n<pre><code>val createdCustomer = customerRepository.save(Object)\n</code></pre>\n<p>Starting hibernate 6.6 their were come changes but which says not to set the @id field but how to set the UUID to null, should i make it null able ? <code>UUID?</code></p>\n",
    "tags" : [ "java", "spring-boot", "kotlin", "hibernate", "spring-data-jpa" ],
    "owner" : {
      "account_id" : 4638791,
      "reputation" : 679,
      "user_id" : 3759227,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/01ecc68c1567f2d1af7d20c8e63c8da2?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Kuldeep",
      "link" : "https://stackoverflow.com/users/3759227/kuldeep"
    },
    "is_answered" : false,
    "view_count" : 64,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1743501612,
    "creation_date" : 1743498276,
    "link" : "https://stackoverflow.com/questions/79548163/org-springframework-orm-objectoptimisticlockingfailureexception-while-saving-in",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79548295,
    "question_id" : 79548163,
    "body" : "<h2>Problem Explaination:</h2>\n<p><code>org.springframework.orm.ObjectOptimisticLockingFailureException:</code> Row was updated or deleted by another transaction occurs in a Spring application when using Optimistic Locking with JPA/Hibernate.<br />\nThis exception is thrown when two or more transactions try to update the same entity concurrently, and one of the transactions detects that the entity has been modified or deleted by another transaction before it could complete its own update.</p>\n<h2>Solution:</h2>\n<p>Use a <code>@Version</code> at Field in Your Entity<br />\nEnsure that your entity has a <code>@Version</code> field. This field is used by JPA/Hibernate to track changes to the entity and detect concurrent modifications.</p>\n<p><strong>Example:</strong></p>\n<pre><code>\n\nimport jakarta.persistence.Entity;\nimport jakarta.persistence.Id;\nimport jakarta.persistence.Version;\n\n@Entity\npublic class MyEntity {\n\n    @Id\n    private Long id;\n\n    private String name;\n\n    @Version\n    private Integer version; // Version field for optimistic locking\n\n    \n}\n</code></pre>\n<ul>\n<li><p>The <code>@Version</code> field is automatically incremented by Hibernate each time the entity is updated.</p>\n</li>\n<li><p>When a transaction tries to update the entity, Hibernate checks if the version in the database matches the version in the entity. If they doesn't match, an <code>ObjectOptimisticLockingFailureException</code> will thrown.</p>\n</li>\n</ul>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 10927511,
      "reputation" : 3218,
      "user_id" : 8031784,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/ikcJL.png?s=256",
      "display_name" : "Aniruddh Parihar",
      "link" : "https://stackoverflow.com/users/8031784/aniruddh-parihar"
    },
    "creation_date" : 1743501612,
    "last_activity_date" : 1743501612,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79548295" : [ {
      "comment_id" : 140286379,
      "post_id" : 79548295,
      "body" : "catch exception is not a good solution  but if i set UUID as optional like this UUID? it work, not sure if its a good solution",
      "score" : 0,
      "owner" : {
        "account_id" : 4638791,
        "reputation" : 679,
        "user_id" : 3759227,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/01ecc68c1567f2d1af7d20c8e63c8da2?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Kuldeep",
        "link" : "https://stackoverflow.com/users/3759227/kuldeep"
      },
      "creation_date" : 1743503823,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140286342,
      "post_id" : 79548295,
      "body" : "@Kuldeep : Then you need to Catch the ObjectOptimisticLockingFailureException and handle it appropriately. Under the catch block retry the transaction or notify the user.",
      "score" : 0,
      "owner" : {
        "account_id" : 10927511,
        "reputation" : 3218,
        "user_id" : 8031784,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/ikcJL.png?s=256",
        "display_name" : "Aniruddh Parihar",
        "link" : "https://stackoverflow.com/users/8031784/aniruddh-parihar"
      },
      "creation_date" : 1743503219,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140286318,
      "post_id" : 79548295,
      "body" : "We cannot add Version field in DB, any other way ?",
      "score" : 0,
      "owner" : {
        "account_id" : 4638791,
        "reputation" : 679,
        "user_id" : 3759227,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/01ecc68c1567f2d1af7d20c8e63c8da2?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Kuldeep",
        "link" : "https://stackoverflow.com/users/3759227/kuldeep"
      },
      "creation_date" : 1743502704,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}