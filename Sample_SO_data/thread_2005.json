{
  "question" : {
    "question_id" : 79656131,
    "title" : "JSchException: Authentication failure",
    "body" : "<p>I am getting an error when trying to establish connection to a remote server using jcraft.</p>\n<pre><code>com.jcraft.jsch.JSchException: Auth fail\n        at com.jcraft.jsch.Session.connect(Session.java:519)\n        at com.jcraft.jsch.Session.connect(Session.java:183)\n        at com.evry.extraction.transfer.SFTPTransfer.connect(SFTPTransfer.java:62)\n        at com.evry.extraction.transfer.SFTPTransfer.transferAll(SFTPTransfer.java:107)\n        at com.evry.extraction.transfer.TransferHandler.run(TransferHandler.java:47)\n</code></pre>\n<p>The part of the code where the exception happens:</p>\n<pre><code>        try {\n\n            JSch ssh = new JSch();\n            String privatekey = PropertiesUtil.getProperty(PropertiesUtil.Constant.SSH_PRIVATEKEY.getValue());\n            this.LOG.info(&quot;Private key found: &quot; + privatekey);\n            ssh.addIdentity(privatekey);\n\n            String username = PropertiesUtil.getProperty(PropertiesUtil.Constant.FTP_USERNAME.getValue());\n            String host = PropertiesUtil.getProperty(PropertiesUtil.Constant.FTP_SERVER.getValue());\n            this.LOG.info(&quot;Username: &quot; + username);\n            this.LOG.info(&quot;Host: &quot; + host);\n\n            session = ssh.getSession(username, host, 22);\n            this.LOG.info(&quot;Got jcraft session&quot;);\n\n            session.setConfig(&quot;StrictHostKeyChecking&quot;, &quot;no&quot;);\n            this.LOG.info(&quot;Set strictHostKeyChecking to -&gt; no&quot;);\n\n            session.connect(); &lt;- Fails here\n            this.LOG.info(&quot;Connected successfully&quot;);\n\n            sftp = (ChannelSftp) session.openChannel(&quot;sftp&quot;);\n            sftp.connect();\n\n            this.LOG.info(&quot;sftp channel opened and connected&quot;);\n            this.LOG.info(&quot;Exit connect&quot;);\n        } catch (JSchException e) {\n            this.LOG.error(&quot;Connection failed: &quot; + e.getMessage());\n            this.LOG.info(&quot;SFTP connection failed: {}&quot;, e.toString(), e);\n            // Re-throw as unchecked exception\n            throw new RuntimeException(&quot;Failed to establish SFTP connection&quot;, e);\n        }\n</code></pre>\n<p>I am able to sftp like this, even without explicitly providing the key, or password:</p>\n<pre><code>sftp user@host\n</code></pre>\n<p>So the public key key is distributed to the remote server.</p>\n<p>Some more logs here for reference:</p>\n<pre><code>2025-06-06 16:40:09,458 [Thread-0] INFO tx.transfer.SFTPTransfer - Private key found: keys/id_rsa\n2025-06-06 16:40:09,467 [Thread-0] INFO tx.transfer.SFTPTransfer - Username: xxxxx\n2025-06-06 16:40:09,467 [Thread-0] INFO tx.transfer.SFTPTransfer - Host: 111.111.111.11\n2025-06-06 16:40:09,472 [Thread-0] INFO tx.transfer.SFTPTransfer - Got jcraft session\n2025-06-06 16:40:09,472 [Thread-0] INFO tx.transfer.SFTPTransfer - Set strictHostKeyChecking to -&gt; no\n2025-06-06 16:40:09,489 [Thread-0] INFO tx.logger.SftpLog - Connecting to 111.111.111.11 port 11\n2025-06-06 16:40:09,497 [Thread-0] INFO tx.logger.SftpLog - Connection established\n2025-06-06 16:40:09,516 [Thread-0] INFO tx.logger.SftpLog - Remote version string: SSH-2.0-OpenSSH_9.9_P2\n2025-06-06 16:40:09,517 [Thread-0] INFO tx.logger.SftpLog - Local version string: SSH-2.0-JSCH-0.1.54\n2025-06-06 16:40:09,517 [Thread-0] INFO tx.logger.SftpLog - CheckCiphers: aes256-ctr,aes192-ctr,aes128-ctr,aes256-cbc,aes192-cbc,aes128-cbc,3des-ctr,arcfour,arcfour128,arcfour256\n2025-06-06 16:40:09,542 [Thread-0] INFO tx.logger.SftpLog - CheckKexes: diffie-hellman-group14-sha1,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521\n2025-06-06 16:40:09,647 [Thread-0] INFO tx.logger.SftpLog - CheckSignatures: ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521\n2025-06-06 16:40:09,650 [Thread-0] INFO tx.logger.SftpLog - SSH_MSG_KEXINIT sent\n2025-06-06 16:40:09,650 [Thread-0] INFO tx.logger.SftpLog - SSH_MSG_KEXINIT received\n2025-06-06 16:40:09,650 [Thread-0] INFO tx.logger.SftpLog - kex: server: sntrup761x25519-sha512,sntrup761x25519-sha512@openssh.com,mlkem768x25519-sha256,curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group14-sha256,ext-info-s,kex-strict-s-v00@openssh.com\n2025-06-06 16:40:09,650 [Thread-0] INFO tx.logger.SftpLog - kex: server: rsa-sha2-512,rsa-sha2-256,ecdsa-sha2-nistp256,ssh-ed25519\n2025-06-06 16:40:09,651 [Thread-0] INFO tx.logger.SftpLog - kex: server: aes128-ctr,aes192-ctr,aes256-ctr,chacha20-poly1305@openssh.com,aes128-gcm@openssh.com,aes256-gcm@openssh.com\n2025-06-06 16:40:09,651 [Thread-0] INFO tx.logger.SftpLog - kex: server: umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1\n2025-06-06 16:40:09,651 [Thread-0] INFO tx.logger.SftpLog - kex: server: none,zlib@openssh.com\n2025-06-06 16:40:09,651 [Thread-0] INFO tx.logger.SftpLog - kex: server:\n2025-06-06 16:40:09,651 [Thread-0] INFO tx.logger.SftpLog - kex: client: ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group14-sha1,diffie-hellman-group-exchange-sha256,diffie-hellman-group-exchange-sha1,diffie-hellman-group1-sha1\n2025-06-06 16:40:09,651 [Thread-0] INFO tx.logger.SftpLog - kex: client: ssh-rsa,ssh-dss,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521\n2025-06-06 16:40:09,651 [Thread-0] INFO tx.logger.SftpLog - kex: client: aes128-ctr,aes128-cbc,3des-ctr,3des-cbc,blowfish-cbc,aes192-ctr,aes192-cbc,aes256-ctr,aes256-cbc\n2025-06-06 16:40:09,651 [Thread-0] INFO tx.logger.SftpLog - kex: client: hmac-md5,hmac-sha1,hmac-sha2-256,hmac-sha1-96,hmac-md5-96\n2025-06-06 16:40:09,651 [Thread-0] INFO tx.logger.SftpLog - kex: client: none\n2025-06-06 16:40:09,651 [Thread-0] INFO tx.logger.SftpLog - kex: client:\n2025-06-06 16:40:09,651 [Thread-0] INFO tx.logger.SftpLog - kex: client-&gt;server aes128-ctr hmac-sha1 none\n2025-06-06 16:40:09,655 [Thread-0] INFO tx.logger.SftpLog - SSH_MSG_KEX_ECDH_INIT sent\n2025-06-06 16:40:09,655 [Thread-0] INFO tx.logger.SftpLog - expecting SSH_MSG_KEX_ECDH_REPLY\n2025-06-06 16:40:09,672 [Thread-0] INFO tx.logger.SftpLog - Permanently added '111.111.111.11' (ECDSA) to the list of known hosts.\n2025-06-06 16:40:09,672 [Thread-0] INFO tx.logger.SftpLog - SSH_MSG_NEWKEYS sent\n2025-06-06 16:40:09,672 [Thread-0] INFO tx.logger.SftpLog - SSH_MSG_NEWKEYS received\n2025-06-06 16:40:09,674 [Thread-0] INFO tx.logger.SftpLog - SSH_MSG_SERVICE_REQUEST sent\n2025-06-06 16:40:09,675 [Thread-0] INFO tx.logger.SftpLog - SSH_MSG_SERVICE_ACCEPT received\n2025-06-06 16:40:09,686 [Thread-0] INFO tx.logger.SftpLog - Authentications that can continue: publickey,keyboard-interactive,password\n2025-06-06 16:40:09,686 [Thread-0] INFO tx.logger.SftpLog - Next authentication method: publickey\n2025-06-06 16:40:09,696 [Thread-0] INFO tx.logger.SftpLog - Authentications that can continue: keyboard-interactive,password\n2025-06-06 16:40:09,696 [Thread-0] INFO tx.logger.SftpLog - Next authentication method: keyboard-interactive\n2025-06-06 16:40:09,707 [Thread-0] INFO tx.logger.SftpLog - Authentications that can continue: password\n2025-06-06 16:40:09,707 [Thread-0] INFO tx.logger.SftpLog - Next authentication method: password\n2025-06-06 16:40:09,708 [Thread-0] INFO tx.logger.SftpLog - Disconnecting from 111.111.111.11 port 11\n2025-06-06 16:40:09,713 [Thread-0] ERROR tx.transfer.SFTPTransfer - Connection failed: Auth fail\n2025-06-06 16:40:09,713 [Thread-0] INFO tx.transfer.SFTPTransfer - SFTP connection failed: com.jcraft.jsch.JSchException: Auth fail\ncom.jcraft.jsch.JSchException: Auth fail\n\n                     \n\n                                                                                                                                                                                                                                                                           \n</code></pre>\n<p>I thought that maybe the key is of wrong format, but that also seems to be correct.</p>\n<pre><code>----BEGIN RSA PRIVATE KEY-----\n...\n-----END RSA PRIVATE KEY-----\n</code></pre>\n<p>Permissions also seem to be in order:</p>\n<pre><code>-rwxrwxrwx 1 adms1   adms1     2080 Jun  6 16:40 prop.properties\ndrwxrwsrwx 2 adms1   adms1     4096 Jun  6 14:03 keys\n-rwxr-xr-x 1 adms1   adms1 39101594 May 22 14:57 job.jar\n</code></pre>\n<p>I run the job like this:</p>\n<pre><code>/efs/jdk-21.0.7+6/bin/java -Xms1024m -Xmx2024m -jar job.jar --startup-time ${FILEDATE} |tee -a logs/${LOGFILENAME}\n</code></pre>\n<p>JCRAFT Dependency used is:</p>\n<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.jcraft&lt;/groupId&gt;\n    &lt;artifactId&gt;jsch&lt;/artifactId&gt;\n    &lt;version&gt;0.1.55&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n",
    "tags" : [ "java", "ssh", "jar", "sftp", "jsch" ],
    "owner" : {
      "account_id" : 14049933,
      "reputation" : 305,
      "user_id" : 10149027,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-ZAGHhniaTdI/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rXesiWbt03kTFDiYQYfNwMOSIkeQ/mo/s256-rj/photo.jpg",
      "display_name" : "JavaGeek",
      "link" : "https://stackoverflow.com/users/10149027/javageek"
    },
    "is_answered" : false,
    "view_count" : 74,
    "closed_date" : 1749790359,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1749738152,
    "creation_date" : 1749223153,
    "link" : "https://stackoverflow.com/questions/79656131/jschexception-authentication-failure",
    "closed_reason" : "Duplicate"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140508914,
    "post_id" : 79656131,
    "body" : "@MatthiasWiedemann no, I had not given the jar file the required permissions, after I did it actually worked. Thank you. I think your suggestion qualifies for the answer to this issue.",
    "score" : 0,
    "owner" : {
      "account_id" : 14049933,
      "reputation" : 305,
      "user_id" : 10149027,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-ZAGHhniaTdI/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rXesiWbt03kTFDiYQYfNwMOSIkeQ/mo/s256-rj/photo.jpg",
      "display_name" : "JavaGeek",
      "link" : "https://stackoverflow.com/users/10149027/javageek"
    },
    "creation_date" : 1749738383,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140508897,
    "post_id" : 79656131,
    "body" : "@MatthiasWiedemann after I updated the dependency I got a similar error message :com.jcraft.jsch.JSchException: Auth fail for methods &#39;publickey,password,keyboard-interactive&#39;",
    "score" : 0,
    "owner" : {
      "account_id" : 14049933,
      "reputation" : 305,
      "user_id" : 10149027,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-ZAGHhniaTdI/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rXesiWbt03kTFDiYQYfNwMOSIkeQ/mo/s256-rj/photo.jpg",
      "display_name" : "JavaGeek",
      "link" : "https://stackoverflow.com/users/10149027/javageek"
    },
    "creation_date" : 1749738084,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140508876,
    "post_id" : 79656131,
    "body" : "@RobSpoor yes the path is correct, when the key is not found it used to fail at ssh.addIdentity(privatekey); setting the identity, because private key would be essentially null",
    "score" : 0,
    "owner" : {
      "account_id" : 14049933,
      "reputation" : 305,
      "user_id" : 10149027,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-ZAGHhniaTdI/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rXesiWbt03kTFDiYQYfNwMOSIkeQ/mo/s256-rj/photo.jpg",
      "display_name" : "JavaGeek",
      "link" : "https://stackoverflow.com/users/10149027/javageek"
    },
    "creation_date" : 1749737628,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140496902,
    "post_id" : 79656131,
    "body" : "@MatthiasWiedemann I haven&#39;t tried that yet, but will give it a shot, thanks",
    "score" : 0,
    "owner" : {
      "account_id" : 14049933,
      "reputation" : 305,
      "user_id" : 10149027,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-ZAGHhniaTdI/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rXesiWbt03kTFDiYQYfNwMOSIkeQ/mo/s256-rj/photo.jpg",
      "display_name" : "JavaGeek",
      "link" : "https://stackoverflow.com/users/10149027/javageek"
    },
    "creation_date" : 1749379987,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140494955,
    "post_id" : 79656131,
    "body" : "Is the path to the key correct, relative to the directory from where you start the application? If you print the result of <code>new File(privatekey).getAbsolutePath()</code>, does that show the correct path?",
    "score" : 1,
    "owner" : {
      "account_id" : 1211967,
      "reputation" : 9964,
      "user_id" : 1180351,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/pKB8y.png?s=256",
      "display_name" : "Rob Spoor",
      "link" : "https://stackoverflow.com/users/1180351/rob-spoor"
    },
    "creation_date" : 1749285703,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140493792,
    "post_id" : 79656131,
    "body" : "did you try the csch fork &lt;dependency&gt;   &lt;groupId&gt;com.github.mwiede&lt;/groupId&gt;   &lt;artifactId&gt;jsch&lt;/artifactId&gt;   &lt;version&gt;2.27.0&lt;/version&gt; &lt;/dependency&gt;?",
    "score" : 3,
    "owner" : {
      "account_id" : 2647801,
      "reputation" : 1647,
      "user_id" : 2290153,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c955f5131d114701ed4a44fb36d15013?s=256&d=identicon&r=PG",
      "display_name" : "Matthias Wiedemann",
      "link" : "https://stackoverflow.com/users/2290153/matthias-wiedemann"
    },
    "creation_date" : 1749225275,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}