{
  "question" : {
    "question_id" : 79573259,
    "title" : "gradlew clean task failed after upgrading build gradle tools to 8.1.4",
    "body" : "<p>I have a problem: <code>gradlew clean</code> task on my android library module failed every time after upgrading <code>android.tools.build:gradle</code> from <code>7.3.1</code> to <code>8.1.4</code>. It gives error:</p>\n<pre><code>&gt; java.io.IOException: Unable to delete directory 'C:\\my_project\\android\\build'\n    Failed to delete some children. This might happen because a process has files open or has its working directory set in the target directory.\n    - C:\\my_project\\android\\build\\tmp\\.cache\\expanded\\expanded.lock\n    - C:\\my_project\\android\\build\\tmp\\.cache\\expanded\n    - C:\\my_project\\android\\build\\tmp\\.cache\n    - C:\\my_project\\android\\build\\tmp\n</code></pre>\n<p>I can manually delete <code>build</code> directory but after this I still get the same error. Clean task fails only on android library named <code>android</code>. Other modules clean tasks runs without errors. I can run both &quot;final&quot; modules (<code>google</code> and <code>huawei</code>) without problems.</p>\n<p>My project structure looks like this:</p>\n<pre><code>project(&quot;:core&quot;) {\n    apply plugin: &quot;java-library&quot;\n    dependencies {\n        api &quot;com.badlogicgames.gdx:gdx:$gdxVersion&quot;\n        api &quot;com.badlogicgames.gdx:gdx-ai:$gdxAIVersion&quot;\n    }\n}\n\nproject(&quot;:game&quot;) {\n    apply plugin: &quot;java-library&quot;\n    dependencies {\n        api project(&quot;:core&quot;)\n    }\n}\n\nproject(&quot;:mobile&quot;) {\n    apply plugin: &quot;java-library&quot;\n    dependencies {\n        api project(&quot;:game&quot;)\n    }\n}\n\nproject(&quot;:android&quot;) {\n    apply plugin: &quot;com.android.library&quot;\n    configurations { natives }\n    dependencies {\n        api project(&quot;:mobile&quot;)\n        api &quot;androidx.core:core:$androidxCoreVersion&quot;\n        api &quot;com.badlogicgames.gdx:gdx-backend-android:$gdxVersion&quot;\n        natives &quot;com.badlogicgames.gdx:gdx-platform:$gdxVersion:natives-armeabi-v7a&quot;\n        natives &quot;com.badlogicgames.gdx:gdx-platform:$gdxVersion:natives-x86&quot;\n        natives &quot;com.badlogicgames.gdx:gdx-platform:$gdxVersion:natives-arm64-v8a&quot;\n        natives &quot;com.badlogicgames.gdx:gdx-platform:$gdxVersion:natives-x86_64&quot;\n        natives &quot;com.badlogicgames.gdx:gdx-freetype-platform:$gdxVersion:natives-armeabi-v7a&quot;\n        natives &quot;com.badlogicgames.gdx:gdx-freetype-platform:$gdxVersion:natives-x86&quot;\n        natives &quot;com.badlogicgames.gdx:gdx-freetype-platform:$gdxVersion:natives-arm64-v8a&quot;\n        natives &quot;com.badlogicgames.gdx:gdx-freetype-platform:$gdxVersion:natives-x86_64&quot;\n    }\n}\n\nproject(&quot;:google&quot;) {\n    apply plugin: &quot;com.android.application&quot;\n    dependencies {\n        implementation project(&quot;:android&quot;)\n        implementation &quot;com.android.support:multidex:$multidexVersion&quot;\n        constraints {\n            implementation('androidx.fragment:fragment') {\n                version {\n                    strictly &quot;$androidxCoreVersion&quot;\n                }\n            }\n        }\n    }\n}\n\nproject(&quot;:huawei&quot;) {\n    apply plugin: &quot;com.android.application&quot;\n    dependencies {\n        implementation project(&quot;:android&quot;)\n        implementation &quot;com.android.support:multidex:$multidexVersion&quot;\n    }\n}\n</code></pre>\n<p>Here is my <code>build.gradle</code> for android module:</p>\n<pre><code>apply plugin: 'com.android.library'\n\nandroid {\n    compileSdk 34\n    buildToolsVersion = '34.0.0'\n    namespace &quot;my.package.name.android&quot;\n\n    defaultConfig {\n        minSdkVersion 19\n        targetSdkVersion 34\n    }\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n        }\n    }\n}\n\ntask copyAndroidNatives() {\n    file(&quot;libs/armeabi/&quot;).mkdirs();\n    file(&quot;libs/armeabi-v7a/&quot;).mkdirs();\n    file(&quot;libs/x86/&quot;).mkdirs();\n    file(&quot;libs/arm64-v8a/&quot;).mkdirs()\n    file(&quot;libs/x86_64/&quot;).mkdirs()\n\n    configurations.natives.files.each { jar -&gt;\n        def outputDir = null\n        if (jar.name.endsWith(&quot;natives-armeabi-v7a.jar&quot;)) outputDir = file(&quot;libs/armeabi-v7a&quot;)\n        if (jar.name.endsWith(&quot;natives-x86.jar&quot;)) outputDir = file(&quot;libs/x86&quot;)\n        if (jar.name.endsWith(&quot;natives-arm64-v8a.jar&quot;)) outputDir = file(&quot;libs/arm64-v8a&quot;)\n        if (jar.name.endsWith(&quot;natives-x86_64.jar&quot;)) outputDir = file(&quot;libs/x86_64&quot;)\n        if (outputDir != null) {\n            copy {\n                from zipTree(jar)\n                into outputDir\n                include &quot;*.so&quot;\n            }\n        }\n    }\n}\n\ntasks.whenTaskAdded { packageTask -&gt;\n    if (packageTask.name.contains(&quot;package&quot;)) {\n        packageTask.dependsOn 'copyAndroidNatives'\n    }\n}\n</code></pre>\n<p>Error disappears when I remove <code>copyAndroidNatives()</code> task from <code>build.gradle</code> but this is not the solution because it has to be executed. <code>copyAndroidNatives() is a task needed by </code>libGdx` - here is a template: <a href=\"https://github.com/libgdx/libgdx-gradle-template/blob/master/android/build.gradle\" rel=\"nofollow noreferrer\">https://github.com/libgdx/libgdx-gradle-template/blob/master/android/build.gradle</a></p>\n<p>Any idea how to resolve this issue?</p>\n",
    "tags" : [ "java", "android", "gradle", "libgdx" ],
    "owner" : {
      "account_id" : 1540427,
      "reputation" : 1070,
      "user_id" : 1435238,
      "user_type" : "registered",
      "accept_rate" : 75,
      "profile_image" : "https://www.gravatar.com/avatar/636dc81493b172a286bd0ed38e382df5?s=256&d=identicon&r=PG",
      "display_name" : "Bero",
      "link" : "https://stackoverflow.com/users/1435238/bero"
    },
    "is_answered" : false,
    "view_count" : 72,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1744713084,
    "creation_date" : 1744637302,
    "link" : "https://stackoverflow.com/questions/79573259/gradlew-clean-task-failed-after-upgrading-build-gradle-tools-to-8-1-4",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79574935,
    "question_id" : 79573259,
    "body" : "<p>It turns out that it was bug in Gradle. I used <code>8.0</code> version and after updating to <code>8.13</code> it works without problems. Gradle version is set in <code>gradle-wrapper.properties</code> file. So to sum it up: it works ok with Android Gradle Plugin version <code>8.1.4</code> and Gradle version <code>8.13</code></p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1540427,
      "reputation" : 1070,
      "user_id" : 1435238,
      "user_type" : "registered",
      "accept_rate" : 75,
      "profile_image" : "https://www.gravatar.com/avatar/636dc81493b172a286bd0ed38e382df5?s=256&d=identicon&r=PG",
      "display_name" : "Bero",
      "link" : "https://stackoverflow.com/users/1435238/bero"
    },
    "creation_date" : 1744713084,
    "last_activity_date" : 1744713084,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}