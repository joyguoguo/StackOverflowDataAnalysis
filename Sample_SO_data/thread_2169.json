{
  "question" : {
    "question_id" : 79641190,
    "title" : "Apache Drill fails to start: NoClassDefFoundError - org.apache.hadoop.security.SecurityUtil",
    "body" : "<p>I'm currently trying to set up Apache Drill with S3 (MinIO) storage plugin support, but Drill crashes during startup or plugin usage with the following error:</p>\n<pre><code>Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: Could not initialize class org.apache.hadoop.security.SecurityUtil\n    at org.apache.hadoop.security.UserGroupInformation.initialize(UserGroupInformation.java:316)\n    at org.apache.hadoop.security.UserGroupInformation.ensureInitialized(UserGroupInformation.java:304)\n    ...\n</code></pre>\n<p>The error message &quot;JSON ain't no thang.&quot; also appears right before the crash, which seems to be Drill’s internal logging, but unrelated to the root cause.</p>\n<p><strong>What I'm doing / Setup:</strong></p>\n<ul>\n<li>Apache Drill version: 1.21.1</li>\n<li>Running on: Linux VM (Docker container for Drill and MinIO)</li>\n<li>Java version: openjdk version &quot;11.0.27&quot; 2025-04-15</li>\n<li>Storage plugin configured for: s3a:// with MinIO backend</li>\n<li>Relevant change: I added a custom storage plugin JSON with type: file and connection s3a:// (bucket via workspace)</li>\n</ul>\n<p><strong>What I tried:</strong></p>\n<ul>\n<li>Verified that MinIO endpoint works (curl http://:9000 returns 403 AccessDenied, which is expected without credentials)</li>\n<li>Created the bucket manually and pointed location to it</li>\n<li>Ensured access and secret keys are correct</li>\n<li>Removed formats section to rule out JSON plugin issues</li>\n<li>Drillbit logs don’t give much more information than the Java stacktrace</li>\n</ul>\n<p><strong>Suspicions / Debug Clues:</strong>\nIt seems related to a Hadoop dependency or class loading issue. Based on the error, the class org.apache.hadoop.security.SecurityUtil is not being initialized. I found some hints online that this could be:</p>\n<ul>\n<li>A missing Hadoop JAR</li>\n<li>A classpath conflict (e.g., mixing incompatible Hadoop versions)</li>\n<li>A Java compatibility problem?</li>\n</ul>\n<p><strong>Questions:</strong></p>\n<ul>\n<li>Do I need to add extra Hadoop libraries manually to Drill (for S3A)?</li>\n<li>Which versions of Hadoop are compatible with Drill for S3A support?</li>\n<li>Is this error common when using MinIO or non-HDFS backends?</li>\n<li>Can I force Drill to skip SecurityUtil (I'm not using Kerberos)?</li>\n<li>Would using fs.s3a.impl config help here?</li>\n</ul>\n<p><strong>Related Plugin JSON (for reference):</strong></p>\n<pre><code>{\n  &quot;type&quot;: &quot;file&quot;,\n  &quot;enabled&quot;: true,\n  &quot;connection&quot;: &quot;s3a://&quot;,\n  &quot;config&quot;: {\n    &quot;fs.s3a.access.key&quot;: &quot;...&quot;,\n    &quot;fs.s3a.secret.key&quot;: &quot;...&quot;,\n    &quot;fs.s3a.endpoint&quot;: &quot;...&quot;,\n    &quot;fs.s3a.path.style.access&quot;: &quot;true&quot;,\n    &quot;fs.s3a.connection.ssl.enabled&quot;: &quot;false&quot;\n  },\n  &quot;workspaces&quot;: {\n    &quot;root&quot;: {\n      &quot;location&quot;: &quot;...&quot;,\n      &quot;writable&quot;: false\n    }\n  }\n}\n</code></pre>\n<p>Happy to provide more logs or try suggested solutions. Thanks in advance!</p>\n",
    "tags" : [ "java", "hadoop", "apache-drill" ],
    "owner" : {
      "user_type" : "does_not_exist",
      "display_name" : "user30652712"
    },
    "is_answered" : false,
    "view_count" : 55,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1748935290,
    "creation_date" : 1748379777,
    "link" : "https://stackoverflow.com/questions/79641190/apache-drill-fails-to-start-noclassdeffounderror-org-apache-hadoop-security-s",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79650785,
    "question_id" : 79641190,
    "body" : "<p>Seems like you need to install the hadoop package from Dockers github:</p>\n<p>1. create dir hadoop</p>\n<p>2. cd hadoop</p>\n<p>3. clone the repository from git into your directory &quot;git clone <a href=\"https://github.com/big-data-europe/docker-hadoop.git%22\" rel=\"nofollow noreferrer\">https://github.com/big-data-europe/docker-hadoop.git&quot;</a></p>\n<p>check that your directory holds the docker hadoop dir. Then run docker compose up -d</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 42217297,
      "reputation" : 1,
      "user_id" : 30646186,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/30ce9b511ab500ef1c04e778443f4d09?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Simon ",
      "link" : "https://stackoverflow.com/users/30646186/simon"
    },
    "creation_date" : 1748935290,
    "last_activity_date" : 1748935290,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}