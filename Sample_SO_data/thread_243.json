{
  "question" : {
    "question_id" : 79823431,
    "title" : "JDK 21 What is the point of wrapping a FileReader/InputStreamReader in a BufferedReader?",
    "body" : "<p><a href=\"https://docs.oracle.com/javase/tutorial/essential/io/charstreams.html\" rel=\"nofollow noreferrer\">Java Tutorials site</a> shows this example when discussing character streams:</p>\n<pre><code>//The CopyLines example invokes BufferedReader.readLine and PrintWriter.println to do input and output one line at a time.\n\nimport java.io.FileReader;\nimport java.io.FileWriter;\nimport java.io.BufferedReader;\nimport java.io.PrintWriter;\nimport java.io.IOException;\n\npublic class CopyLines {\n    public static void main(String[] args) throws IOException {\n\n        BufferedReader inputStream = null;\n        PrintWriter outputStream = null;\n\n        try {\n            inputStream = new BufferedReader(new FileReader(&quot;xanadu.txt&quot;));\n            outputStream = new PrintWriter(new FileWriter(&quot;characteroutput.txt&quot;));\n\n            String l;\n            while ((l = inputStream.readLine()) != null) {\n                outputStream.println(l);\n            }\n        } finally {\n            if (inputStream != null) {\n                inputStream.close();\n            }\n            if (outputStream != null) {\n                outputStream.close();\n            }\n        }\n    }\n}\n</code></pre>\n<p>Now, what is the point of wrapping a FileReader class (or InputStreamReader) in a BufferedReader if they already implement internal buffering mechanism? Their internal buffer is also of the same size (8192 bytes). Is the example provided not relevant anymore in JDK 21?</p>\n",
    "tags" : [ "java", "performance", "stream" ],
    "owner" : {
      "account_id" : 20205266,
      "reputation" : 19,
      "user_id" : 14819876,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5498b2fe60e758c7f44020b3d78b4e3e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "sebkaminski16",
      "link" : "https://stackoverflow.com/users/14819876/sebkaminski16"
    },
    "is_answered" : true,
    "view_count" : 233,
    "answer_count" : 13,
    "score" : 0,
    "last_activity_date" : 1763501118,
    "creation_date" : 1763473722,
    "link" : "https://stackoverflow.com/questions/79823431/jdk-21-what-is-the-point-of-wrapping-a-filereader-inputstreamreader-in-a-buffere",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79823466,
    "question_id" : 79823431,
    "body" : "<p>The point is not just <code>readLine()</code>.</p>\n<p>The <code>Reader</code> (and <code>InputStream</code>) abstractions allow both 'one-at-a-time' and 'bulk' operations. You can call <code>read()</code> on one which gets you a single character or byte, or you can call <code>read(byteArray)</code> to get as many as are available.</p>\n<p><strong>The fundamental issue is that underlying data streams are usually block based</strong>.</p>\n<p>Take an SSD for example. It is <strong>not possible</strong> to read a single byte from an SSD. You always get a whole block's worth (usually around 8k or so worth).</p>\n<p>Thus, when you ask for a single character from a <code>FileReader</code>, and the file is on an SSD, the FileReader implementation has two options:</p>\n<ul>\n<li>Reserve 8k worth of memory. Read and save the entire 8k. Return 1 byte. If another <code>read()</code> call comes, serve it from this cached value.</li>\n<li>Read the entire 8k. Get the one byte that is needed. Discard the remaining 8191 bytes.</li>\n</ul>\n<p>The second one seems utterly daft. If you do that and you write:</p>\n<pre class=\"lang-java prettyprint-override\"><code>try (var fr = new FileReader(file)) {\n  while (true) {\n    int c = fr.read();\n    if (c == -1) break;\n    System.out.print((char) c);\n  }\n}\n</code></pre>\n<p>Then reading a single file sized 8192 bytes would read 67108864 bytes from disk (the same 8192 chunk, 8192 times).</p>\n<p>A humongous waste of time.</p>\n<p>But the first one means the impl takes 8k, and conflates separate concerns: That 'caching' stuff is completely different code from 'talk to the SSD device'.</p>\n<p>In java, <strong>it works like the second one</strong>. And <code>BufferedReader</code> <em>adds</em> the caching functionality.</p>\n<p>So, whereas the above snippet makes 8192 calls to the SSD device and causes a total of 67108864 bytes to fly over the wire between SSD and CPU, this code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>try (var fr = new BufferedReader(new FileReader(file))) {\n  while (true) {\n    int c = fr.read();\n    if (c == -1) break;\n    System.out.print((char) c);\n  }\n}\n</code></pre>\n<p>Makes only 1 call to the SSD device and only 8192 bytes fly over the wire.</p>\n<p>That's why you pretty much always want to add the BufferedReader!</p>\n<p>Of course, if you write it like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>try (var fr = new FileReader(file)) {\n  byte[] data = fr.readFully();\n}\n</code></pre>\n<p>Then you don't need the bufferedReader; <code>readFully</code> internally uses something along the lines of:</p>\n<pre class=\"lang-java prettyprint-override\"><code>byte[] b = new byte[8192];\nfr.read(b);\n</code></pre>\n<p>In other words, it uses the bulk version.</p>\n<p>The overhead of <code>BufferedReader</code> is low. You should still just use them even if you suspect the underlying stream isn't a block-based concept (or already buffers internally), and even if you think all users of that stream only use the bulk operations.</p>\n<p>Only if a profiler says the overhead is actively affecting things, reconsider.</p>\n",
    "score" : 3,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 401843,
      "reputation" : 107186,
      "user_id" : 768644,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/b13bedc5215730fbce5edff6c130988a?s=256&d=identicon&r=PG",
      "display_name" : "rzwitserloot",
      "link" : "https://stackoverflow.com/users/768644/rzwitserloot"
    },
    "creation_date" : 1763476062,
    "last_activity_date" : 1763476062,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79823439,
    "question_id" : 79823431,
    "body" : "<p>Probably to provide you with readLine()...</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 40465623,
      "reputation" : 36,
      "user_id" : 29794068,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9bbc16563107b7cd93c9a8a46ff0f99a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Valentin Matev",
      "link" : "https://stackoverflow.com/users/29794068/valentin-matev"
    },
    "creation_date" : 1763474243,
    "last_activity_date" : 1763474243,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79823447,
    "question_id" : 79823431,
    "body" : "<p>The code in your post looks like Java 6 code. Can you post a link to the webpage containing that code? Note that Oracle's Java tutorials stopped being updated since Java 8. Nonetheless, I believe that, at least, the code would use &quot;try-with-resources&quot;.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 2485939,
      "reputation" : 20969,
      "user_id" : 2164365,
      "user_type" : "registered",
      "accept_rate" : 40,
      "profile_image" : "https://i.sstatic.net/RKSgV.png?s=256",
      "display_name" : "Abra",
      "link" : "https://stackoverflow.com/users/2164365/abra"
    },
    "creation_date" : 1763474947,
    "last_activity_date" : 1763474947,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79823559,
    "question_id" : 79823431,
    "body" : "<p>The tutorial, you provided the link to, states: &quot;<em>Let's modify the CopyCharacters example to use line-oriented I/O. To do this, we have to use two classes we haven't seen before, <code>BufferedReader</code> and <code>PrintWriter</code>. ... Right now, we're just interested in their <strong>support for line-oriented I/O</strong>.</em>&quot;\n(my emphasis added)</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 31180,
      "reputation" : 29752,
      "user_id" : 85421,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/kKvXH.gif?s=256",
      "display_name" : "user85421",
      "link" : "https://stackoverflow.com/users/85421/user85421"
    },
    "creation_date" : 1763480538,
    "last_activity_date" : 1763481330,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79823674,
    "question_id" : 79823431,
    "body" : "<p>There doesn't seem to be any specifically related to JDK 21. It seems like code that would in really ancient versions of Java.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1763487870,
    "last_activity_date" : 1763487870,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79823707,
    "question_id" : 79823431,
    "body" : "<p>I would just note that timing it may not reveal the difference since there will also be buffering at the operating system level. Even if the Java process is requesting the same bytes from the file multiple times, the OS is very likely going to be returning them from its buffer of the file data.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 318670,
      "reputation" : 16467,
      "user_id" : 636009,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/IIQJV.jpg?s=256",
      "display_name" : "David Conrad",
      "link" : "https://stackoverflow.com/users/636009/david-conrad"
    },
    "creation_date" : 1763490155,
    "last_activity_date" : 1763490155,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79823856,
    "question_id" : 79823431,
    "body" : "<p>Don't forget <code>BufferedReader::mark</code>/<code>BufferedReader::reset</code>. Also useful, and uncommon, and of course relying on the buffer.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 22124137,
      "reputation" : 4243,
      "user_id" : 16376827,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/1ImPw.png?s=256",
      "display_name" : "g00se",
      "link" : "https://stackoverflow.com/users/16376827/g00se"
    },
    "creation_date" : 1763501118,
    "last_activity_date" : 1763501118,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79823441,
    "question_id" : 79823431,
    "body" : "<p>Ah, yes. Right, that seems like the only reason. Thank you for your reply.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 20205266,
      "reputation" : 19,
      "user_id" : 14819876,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5498b2fe60e758c7f44020b3d78b4e3e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "sebkaminski16",
      "link" : "https://stackoverflow.com/users/14819876/sebkaminski16"
    },
    "creation_date" : 1763474369,
    "last_activity_date" : 1763474369,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79823461,
    "question_id" : 79823431,
    "body" : "<p><a href=\"https://docs.oracle.com/javase/tutorial/essential/io/charstreams.html\" rel=\"nofollow noreferrer\"><em>The Java Tutorials have been written for JDK 8.</em></a></p>\n<p>Slightly artificial examples, which could of course be better implemented with <code>Files::copy</code> or its Java 8 equivalent. The idea is really to demonstrate the methods of those classes of course, but this needs saying as I've frequently seen beginners doing precisely that to copy a file</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 22124137,
      "reputation" : 4243,
      "user_id" : 16376827,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/1ImPw.png?s=256",
      "display_name" : "g00se",
      "link" : "https://stackoverflow.com/users/16376827/g00se"
    },
    "creation_date" : 1763475957,
    "last_activity_date" : 1763475957,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79823489,
    "question_id" : 79823431,
    "body" : "<p>@<a href=\"https://stackoverflow.com/users/768644/rzwitserloot\">rzwitserloot</a>, I really appreciate your answer. I'm just not really sure if I fully understood it. I've checked both of your snippets calling the `read()` method (the ones with FileReader and with BufferedReader) with a text file which has a size of around 160MB. The time difference in completing both of these operation is only of +-0.5s.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 20205266,
      "reputation" : 19,
      "user_id" : 14819876,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5498b2fe60e758c7f44020b3d78b4e3e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "sebkaminski16",
      "link" : "https://stackoverflow.com/users/14819876/sebkaminski16"
    },
    "creation_date" : 1763477404,
    "last_activity_date" : 1763478101,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79823666,
    "question_id" : 79823431,
    "body" : "<p>To put it simply:  accessing a disk is <em>very slow.</em>  Accessing memory is very fast.  (Anyone whose system has run out of physical RAM and has had to resort to page swapping can attest to the difference.)  When you don't use a BufferedReader, every read operation will access the disk directly.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44936,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1763487262,
    "last_activity_date" : 1763491540,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79823808,
    "question_id" : 79823431,
    "body" : "<p>BufferedReading is for doing inefficient reading (for instance, reading a stream of text line by line). This improves performance by lowering the number of calls to the file system. But if you are just greedily grabbing bytes with a big byte[], then having a separate buffer as well doesn't really do anything.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1352170,
      "reputation" : 35259,
      "user_id" : 1291492,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/f914cd02166793195d9d950503f8f739?s=256&d=identicon&r=PG",
      "display_name" : "ControlAltDel",
      "link" : "https://stackoverflow.com/users/1291492/controlaltdel"
    },
    "creation_date" : 1763498396,
    "last_activity_date" : 1763498396,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79823814,
    "question_id" : 79823431,
    "body" : "<p>Not really sure why the number of syscalls would matter in that discussion if both FileReader, InputStreamReader having an internal buffering mechanism perform the same number of syscalls as the BufferedReader.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 20205266,
      "reputation" : 19,
      "user_id" : 14819876,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5498b2fe60e758c7f44020b3d78b4e3e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "sebkaminski16",
      "link" : "https://stackoverflow.com/users/14819876/sebkaminski16"
    },
    "creation_date" : 1763498662,
    "last_activity_date" : 1763498662,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79823489" : [ {
      "comment_id" : 140860576,
      "post_id" : 79823489,
      "body" : "I can add comments but not see them on the main post, weird",
      "score" : 1,
      "owner" : {
        "account_id" : 7497774,
        "reputation" : 877,
        "user_id" : 5697347,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/kWIKwub8.png?s=256",
        "display_name" : "Marsroverr",
        "link" : "https://stackoverflow.com/users/5697347/marsroverr"
      },
      "creation_date" : 1763479941,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140860574,
      "post_id" : 79823489,
      "body" : "As itâ€™s currently written, your answer is unclear. Please <a href=\"https://stackoverflow.com/posts/79823489/edit\">edit</a> to add additional details that will help others understand how this addresses the question asked. You can find more information on how to write good answers <a href=\"/help/how-to-answer\">in the help center</a>.",
      "score" : 1,
      "owner" : {
        "account_id" : -1,
        "reputation" : 1,
        "user_id" : -1,
        "user_type" : "moderator",
        "profile_image" : "https://www.gravatar.com/avatar/a007be5a61f6aa8f3e85ae2fc18dd66e?s=256&d=identicon&r=PG",
        "display_name" : "Community",
        "link" : "https://stackoverflow.com/users/-1/community"
      },
      "creation_date" : 1763479840,
      "content_license" : "CC BY-SA 4.0"
    } ],
    "79823814" : [ {
      "comment_id" : 140861166,
      "post_id" : 79823814,
      "body" : "Your answer could be improved with additional supporting information. Please <a href=\"https://stackoverflow.com/posts/79823814/edit\">edit</a> to add further details, such as citations or documentation, so that others can confirm that your answer is correct. You can find more information on how to write good answers <a href=\"/help/how-to-answer\">in the help center</a>.",
      "score" : 0,
      "owner" : {
        "account_id" : -1,
        "reputation" : 1,
        "user_id" : -1,
        "user_type" : "moderator",
        "profile_image" : "https://www.gravatar.com/avatar/a007be5a61f6aa8f3e85ae2fc18dd66e?s=256&d=identicon&r=PG",
        "display_name" : "Community",
        "link" : "https://stackoverflow.com/users/-1/community"
      },
      "creation_date" : 1763501550,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}