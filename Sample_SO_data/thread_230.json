{
  "question" : {
    "question_id" : 79819691,
    "title" : "Maven Dependency Plugin 3.4.0 fails with &quot;Text file busy&quot; when unpacking Linux ZIP dependencies",
    "body" : "<p>I recently upgraded the Maven Dependency Plugin from 3.3.0 to 3.4.0, and now my build fails during the unpack phase with the following error:</p>\n<pre><code>Failed to execute goal org.apache.maven.plugins:maven-dependency-plugin:3.4.0:unpack (unpack-dependencies) on project my-project: Error unpacking file: &lt;file-path&gt; Text file busy\n</code></pre>\n<p>Observations:</p>\n<ul>\n<li>The error occurs when multiple threads or builds try to access the same file concurrently.</li>\n<li>The goal is executed during the generate-test-resources phase, and the unpacked files are used immediately in later phases.</li>\n<li>Downgrading back to 3.3.0 resolves the issue.</li>\n</ul>\n<p>Question:</p>\n<ul>\n<li>Has anyone encountered this &quot;Text file busy&quot; issue with Maven Dependency Plugin 3.4.0?</li>\n<li>Is there a known workaround for safely unpacking dependencies in parallel builds without hitting this error?</li>\n</ul>\n<p>Example Configuration:</p>\n<pre><code>&lt;plugin&gt;\n    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n    &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;\n    &lt;version&gt;3.4.0&lt;/version&gt;\n    &lt;executions&gt;\n        &lt;execution&gt;\n            &lt;id&gt;unpack-dependencies&lt;/id&gt;\n            &lt;phase&gt;generate-test-resources&lt;/phase&gt;\n            &lt;goals&gt;\n                &lt;goal&gt;unpack&lt;/goal&gt;\n            &lt;/goals&gt;\n            &lt;configuration&gt;\n                &lt;artifactItems&gt;\n                    &lt;artifactItem&gt;\n                        &lt;groupId&gt;com.example&lt;/groupId&gt;\n                        &lt;artifactId&gt;my-artifact&lt;/artifactId&gt;\n                        &lt;version&gt;1.0.0&lt;/version&gt;\n                        &lt;classifier&gt;linux&lt;/classifier&gt;\n                        &lt;type&gt;zip&lt;/type&gt;\n                        &lt;outputDirectory&gt;${project.build.directory}/libs&lt;/outputDirectory&gt;\n                    &lt;/artifactItem&gt;\n                &lt;/artifactItems&gt;\n            &lt;/configuration&gt;\n        &lt;/execution&gt;\n    &lt;/executions&gt;\n&lt;/plugin&gt;\n</code></pre>\n",
    "tags" : [ "java", "maven", "maven-dependency-plugin" ],
    "owner" : {
      "account_id" : 44232335,
      "reputation" : 11,
      "user_id" : 31646099,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/fe910a4536d221e3b874e877f97fd888?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "stupidheadlol",
      "link" : "https://stackoverflow.com/users/31646099/stupidheadlol"
    },
    "is_answered" : false,
    "view_count" : 81,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1763100621,
    "creation_date" : 1763100621,
    "link" : "https://stackoverflow.com/questions/79819691/maven-dependency-plugin-3-4-0-fails-with-text-file-busy-when-unpacking-linux-z",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140857394,
    "post_id" : 79819691,
    "body" : "@khmarbaise quick question for you. How does overwriteIfNewer work in the Maven Dependency Plugin unpack goal? I’ve read the documentation, but I’m still a bit confused. My understanding is: if overwriteIfNewer is set to false, then Maven will not unpack the artifact if it has already been unpacked, regardless of whether the artifact is newer or not. It will only unpack if the artifact has never been unpacked before. Is this correct?",
    "score" : 0,
    "owner" : {
      "account_id" : 44232335,
      "reputation" : 11,
      "user_id" : 31646099,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/fe910a4536d221e3b874e877f97fd888?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "stupidheadlol",
      "link" : "https://stackoverflow.com/users/31646099/stupidheadlol"
    },
    "creation_date" : 1763347719,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140856179,
    "post_id" : 79819691,
    "body" : "But at the same time, it is still useful to understand what exactly changed in 3.4.0 that altered the timing. When multiple modules are unpacking to the same directory, that’s already a flawed setup - agreed. But if a plugin upgrade made the unpack operation faster/slower or changed when file handles are released, that can explain why the race condition only started appearing now.",
    "score" : 0,
    "owner" : {
      "account_id" : 44232335,
      "reputation" : 11,
      "user_id" : 31646099,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/fe910a4536d221e3b874e877f97fd888?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "stupidheadlol",
      "link" : "https://stackoverflow.com/users/31646099/stupidheadlol"
    },
    "creation_date" : 1763246932,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140856178,
    "post_id" : 79819691,
    "body" : "I understand that saying “this never occurred before in an older version” isn’t a sufficient argument by itself. Concurrency issues can absolutely surface just from subtle timing differences - even something as small as a dependency bump or an internal refactor can shift execution order enough to expose a race condition that was always there.",
    "score" : 0,
    "owner" : {
      "account_id" : 44232335,
      "reputation" : 11,
      "user_id" : 31646099,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/fe910a4536d221e3b874e877f97fd888?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "stupidheadlol",
      "link" : "https://stackoverflow.com/users/31646099/stupidheadlol"
    },
    "creation_date" : 1763246910,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140855577,
    "post_id" : 79819691,
    "body" : "Alternatively, if I just want to make a simple fix, wouldn’t setting overWrite, overWriteIfNewer, etc be a possible solution? This way, it’ll prevent race conditions as seen.",
    "score" : 0,
    "owner" : {
      "account_id" : 44232335,
      "reputation" : 11,
      "user_id" : 31646099,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/fe910a4536d221e3b874e877f97fd888?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "stupidheadlol",
      "link" : "https://stackoverflow.com/users/31646099/stupidheadlol"
    },
    "creation_date" : 1763208973,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140855560,
    "post_id" : 79819691,
    "body" : "So having several modules unpacking to the same directory is by definition wrong.. you need to use something like a semaphore or alike to handle that... I strongly recommend to have only a single module which does the unpacking and other module just define a dependency to that.. and The part &quot;never caused&quot; issues is saying in the end nothing because it can be caused by timing change etc. just a very small upgrade of a dependency which changes timing etc. can cause that... but the root cause is having multiple unpacking using the same directory....",
    "score" : 0,
    "owner" : {
      "account_id" : 112317,
      "reputation" : 98405,
      "user_id" : 296328,
      "user_type" : "registered",
      "accept_rate" : 60,
      "profile_image" : "https://i.sstatic.net/DSpH6.jpg?s=256",
      "display_name" : "khmarbaise",
      "link" : "https://stackoverflow.com/users/296328/khmarbaise"
    },
    "creation_date" : 1763207704,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140855528,
    "post_id" : 79819691,
    "body" : "I couldn&#39;t find anything in the release notes, so I’m trying to identify what changed in 3.4.0 that now triggers this race condition where 3.3.0 did not.",
    "score" : 0,
    "owner" : {
      "account_id" : 44232335,
      "reputation" : 11,
      "user_id" : 31646099,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/fe910a4536d221e3b874e877f97fd888?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "stupidheadlol",
      "link" : "https://stackoverflow.com/users/31646099/stupidheadlol"
    },
    "creation_date" : 1763205830,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140855525,
    "post_id" : 79819691,
    "body" : "Thanks for the clarification - yes, I meant multiple modules are unpacking concurrently and they all write to the same unpack directory. That’s probably why I’m seeing the race condition (“Text file busy”).  What I’m still trying to understand is why upgrading from maven-dependency-plugin 3.3.0 → 3.4.0 suddenly exposed this issue. The same setup (parallel build + shared unpack dir) never caused conflicts on 3.3.0 - everything unpacked silently, even when multiple modules hit the same zip.  @khmarbaise Was there a behavioral change in the unpack goal between these versions?",
    "score" : 0,
    "owner" : {
      "account_id" : 44232335,
      "reputation" : 11,
      "user_id" : 31646099,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/fe910a4536d221e3b874e877f97fd888?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "stupidheadlol",
      "link" : "https://stackoverflow.com/users/31646099/stupidheadlol"
    },
    "creation_date" : 1763205790,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140855459,
    "post_id" : 79819691,
    "body" : "Sharing an upack directory how exactly are you doing that? Single module is unpackging and other modules using that? If so, have you correctly defined the dependency to the unpacking module? If not that&#39;s the reason...",
    "score" : 0,
    "owner" : {
      "account_id" : 112317,
      "reputation" : 98405,
      "user_id" : 296328,
      "user_type" : "registered",
      "accept_rate" : 60,
      "profile_image" : "https://i.sstatic.net/DSpH6.jpg?s=256",
      "display_name" : "khmarbaise",
      "link" : "https://stackoverflow.com/users/296328/khmarbaise"
    },
    "creation_date" : 1763201321,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140855458,
    "post_id" : 79819691,
    "body" : "<code>In my setup, I have multiple threads running in parallel, and they share the same unpack output directory.</code> that is not the reason...  The unpack goal is executed during the life cycle... which means within the module.. it. would be helpful to have the full pom file and an example project setup to see the whole thing because i don&#39;t understand where you have &quot;multiple thread&quot; ? Do you mean by using &quot;mvn -T XX&quot; or what are we talking about... furthermore why you are using an old version of Maven as well old version of the plugins <a href=\"https://maven.apache.org/plugins/\" rel=\"nofollow noreferrer\">maven.apache.org/plugins</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 112317,
      "reputation" : 98405,
      "user_id" : 296328,
      "user_type" : "registered",
      "accept_rate" : 60,
      "profile_image" : "https://i.sstatic.net/DSpH6.jpg?s=256",
      "display_name" : "khmarbaise",
      "link" : "https://stackoverflow.com/users/296328/khmarbaise"
    },
    "creation_date" : 1763201277,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140854848,
    "post_id" : 79819691,
    "body" : "What’s puzzling is that this only started happening after upgrading maven-dependency-plugin from 3.3.0 to 3.4.0. I couldn’t find any release notes explaining this change, so I’m reaching out to see if anyone has more details or context on what changed between these versions.  For reference, I’m using Maven 3.8.8 and JDK 17.",
    "score" : 0,
    "owner" : {
      "account_id" : 44232335,
      "reputation" : 11,
      "user_id" : 31646099,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/fe910a4536d221e3b874e877f97fd888?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "stupidheadlol",
      "link" : "https://stackoverflow.com/users/31646099/stupidheadlol"
    },
    "creation_date" : 1763146610,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140854847,
    "post_id" : 79819691,
    "body" : "Thanks for your feedback! You’re right - if everything runs sequentially within a single module, this issue shouldn’t occur. In my setup, I have multiple threads running in parallel, and they share the same unpack output directory. That’s why I’m seeing the “Text file busy” error: one module starts using the unpacked binary while another is still trying to unpack (overwrite) it.",
    "score" : 0,
    "owner" : {
      "account_id" : 44232335,
      "reputation" : 11,
      "user_id" : 31646099,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/fe910a4536d221e3b874e877f97fd888?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "stupidheadlol",
      "link" : "https://stackoverflow.com/users/31646099/stupidheadlol"
    },
    "creation_date" : 1763146607,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140854465,
    "post_id" : 79819691,
    "body" : "Based on <code>The goal is executed during the generate-test-resources phase, and the unpacked files are used immediately in later phases.</code> the later phase runs in sequence not parallel... only in such cases where the usage is done in a separate module/sub-project within a parallelized build this can happen which would imply having wrong/missing dependencies given... also would it be helpful to see the full log output, Maven version and the full pom file etc. and how you called Maven ? Which JDK etc. would also very helpful....",
    "score" : 0,
    "owner" : {
      "account_id" : 112317,
      "reputation" : 98405,
      "user_id" : 296328,
      "user_type" : "registered",
      "accept_rate" : 60,
      "profile_image" : "https://i.sstatic.net/DSpH6.jpg?s=256",
      "display_name" : "khmarbaise",
      "link" : "https://stackoverflow.com/users/296328/khmarbaise"
    },
    "creation_date" : 1763134036,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140853871,
    "post_id" : 79819691,
    "body" : "I&#39;ve tried using the latest version of the plugin, but that introduces another issue. I&#39;m attempting to unpack ChromeDriver, but occasionally, in some threads, I encounter SessionNotCreatedException. That&#39;s why I&#39;m upgrading incrementally - to determine whether regressions were introduced in earlier versions.",
    "score" : 0,
    "owner" : {
      "account_id" : 44232335,
      "reputation" : 11,
      "user_id" : 31646099,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/fe910a4536d221e3b874e877f97fd888?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "stupidheadlol",
      "link" : "https://stackoverflow.com/users/31646099/stupidheadlol"
    },
    "creation_date" : 1763113320,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140853833,
    "post_id" : 79819691,
    "body" : "Have you tried with the last version plugin? <a href=\"https://mvnrepository.com/artifact/org.apache.maven.plugins/maven-dependency-plugin/3.9.0\" rel=\"nofollow noreferrer\">mvnrepository.com/artifact/org.apache.maven.plugins/&hellip;</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 17553626,
      "reputation" : 508,
      "user_id" : 12733532,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-EAww28wDCxk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcgKS9dXdmUh-hOQPlZYZygBUfLwQ/s256-rj/photo.jpg",
      "display_name" : "Max",
      "link" : "https://stackoverflow.com/users/12733532/max"
    },
    "creation_date" : 1763111731,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}