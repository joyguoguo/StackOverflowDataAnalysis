{
  "question" : {
    "question_id" : 79541175,
    "title" : "Why quarkus-keycloak-admin-client does not add attributes to user?",
    "body" : "<p>In a Quarkus application I'm trying to automate tests with Keycloak dev service integration with these props:</p>\n<pre><code>%test.quarkus.oidc.enabled=true\n%test.quarkus.keycloak.devservices.enabled=true\n%test.quarkus.keycloak.devservices.realm-path=quarkus-realm.json\n</code></pre>\n<p>and these dependencies:</p>\n<pre><code>implementation 'io.quarkus:quarkus-oidc'\nimplementation 'io.quarkus:quarkus-oidc-client'\nimplementation(&quot;io.quarkus:quarkus-keycloak-admin-client&quot;)\n</code></pre>\n<p>where the <code>quarkus-realm.json</code> is this:</p>\n<pre><code>{\n  &quot;realm&quot;: &quot;quarkus&quot;,\n  &quot;enabled&quot;: true,\n  &quot;groups&quot;: [\n    {\n      &quot;name&quot;: &quot;AziendaXXX&quot;\n    },\n    {\n      &quot;name&quot;: &quot;AziendaYYY&quot;\n    }\n  ],\n  &quot;users&quot;: [\n    {\n      &quot;username&quot;: &quot;alice&quot;,\n      &quot;enabled&quot;: true,\n      &quot;emailVerified&quot;: true,\n      &quot;firstName&quot;: &quot;Alice&quot;,\n      &quot;lastName&quot;: &quot;Wonderland&quot;,\n      &quot;credentials&quot;: [\n        {\n          &quot;type&quot;: &quot;password&quot;,\n          &quot;value&quot;: &quot;alice&quot;\n        }\n      ],\n      &quot;clientRoles&quot;: {\n        &quot;realm-management&quot;: [\n          &quot;view-clients&quot;,\n          &quot;manage-users&quot;,\n          &quot;view-users&quot;\n        ],\n        &quot;front-end&quot;: [\n          &quot;ADMIN&quot;\n        ]\n      },\n      &quot;groups&quot;: [\n        &quot;/AziendaXXX&quot;,\n        &quot;/AziendaYYY&quot;\n      ],\n      &quot;attributes&quot;: {\n        &quot;phoneNumber&quot;: &quot;1234567890&quot;,\n        &quot;profilePic&quot;: &quot;alice-pic-base64&quot;,\n        &quot;authType&quot;: &quot;keycloak&quot;\n      }\n    },\n    {\n      &quot;username&quot;: &quot;bob&quot;,\n      &quot;enabled&quot;: true,\n      &quot;emailVerified&quot;: true,\n      &quot;firstName&quot;: &quot;Bob&quot;,\n      &quot;lastName&quot;: &quot;Builder&quot;,\n      &quot;credentials&quot;: [\n        {\n          &quot;type&quot;: &quot;password&quot;,\n          &quot;value&quot;: &quot;bob&quot;\n        }\n      ],\n      &quot;clientRoles&quot;: {\n        &quot;realm-management&quot;: [\n          &quot;view-clients&quot;,\n          &quot;manage-users&quot;,\n          &quot;view-users&quot;\n        ],\n        &quot;front-end&quot;: [\n          &quot;ADMIN&quot;\n        ]\n      },\n      &quot;groups&quot;: [\n        &quot;/AziendaXXX&quot;\n      ],\n      &quot;attributes&quot;: {\n        &quot;phoneNumber&quot;: &quot;0987654321&quot;,\n        &quot;profilePic&quot;: &quot;bob-pic-base64&quot;,\n        &quot;authType&quot;: &quot;keycloak&quot;\n      }\n    }\n  ],\n  &quot;clients&quot;: [\n    {\n      &quot;clientId&quot;: &quot;back-end&quot;,\n      &quot;enabled&quot;: true,\n      &quot;secret&quot;: &quot;xxx&quot;,\n      &quot;clientAuthenticatorType&quot;: &quot;client-secret&quot;,\n      &quot;redirectUris&quot;: [\n        &quot;*&quot;\n      ],\n      &quot;webOrigins&quot;: [\n        &quot;*&quot;\n      ],\n      &quot;publicClient&quot;: false,\n      &quot;protocol&quot;: &quot;openid-connect&quot;,\n      &quot;serviceAccountsEnabled&quot;: true,\n      &quot;directAccessGrantsEnabled&quot;: true\n    },\n    {\n      &quot;clientId&quot;: &quot;front-end&quot;,\n      &quot;enabled&quot;: true,\n      &quot;publicClient&quot;: true,\n      &quot;protocol&quot;: &quot;openid-connect&quot;,\n      &quot;redirectUris&quot;: [\n        &quot;*&quot;\n      ],\n      &quot;webOrigins&quot;: [\n        &quot;*&quot;\n      ],\n      &quot;directAccessGrantsEnabled&quot;: true,\n      &quot;standardFlowEnabled&quot;: true,\n      &quot;implicitFlowEnabled&quot;: false,\n      &quot;serviceAccountsEnabled&quot;: false,\n      &quot;protocolMappers&quot;: [\n        {\n          &quot;name&quot;: &quot;roles&quot;,\n          &quot;protocol&quot;: &quot;openid-connect&quot;,\n          &quot;protocolMapper&quot;: &quot;oidc-usermodel-client-role-mapper&quot;,\n          &quot;consentRequired&quot;: false,\n          &quot;config&quot;: {\n            &quot;multivalued&quot;: &quot;true&quot;,\n            &quot;userinfo.token.claim&quot;: &quot;true&quot;,\n            &quot;id.token.claim&quot;: &quot;true&quot;,\n            &quot;access.token.claim&quot;: &quot;true&quot;,\n            &quot;claim.name&quot;: &quot;roles&quot;,\n            &quot;jsonType.label&quot;: &quot;String&quot;,\n            &quot;client.id&quot;: &quot;front-end&quot;\n          }\n        },\n        {\n          &quot;name&quot;: &quot;groups-to-aziende&quot;,\n          &quot;protocol&quot;: &quot;openid-connect&quot;,\n          &quot;protocolMapper&quot;: &quot;oidc-group-membership-mapper&quot;,\n          &quot;consentRequired&quot;: false,\n          &quot;config&quot;: {\n            &quot;claim.name&quot;: &quot;aziende&quot;,\n            &quot;full.path&quot;: &quot;false&quot;,\n            &quot;id.token.claim&quot;: &quot;true&quot;,\n            &quot;access.token.claim&quot;: &quot;true&quot;,\n            &quot;userinfo.token.claim&quot;: &quot;true&quot;\n          }\n        }\n      ]\n    }\n  ],\n  &quot;roles&quot;: {\n    &quot;client&quot;: {\n      &quot;front-end&quot;: [\n        {\n          &quot;name&quot;: &quot;ADMIN&quot;,\n          &quot;description&quot;: &quot;&quot;,\n          &quot;composite&quot;: false,\n          &quot;clientRole&quot;: true\n        }\n      ]\n    }\n  }\n}\n</code></pre>\n<p>If I get an existing user (alice or bob) the attributes are correctly showed, but when I try to create a new user and update the attributes with this method:</p>\n<pre><code>    private void setUserAttributes(String userId, Map&lt;String, List&lt;String&gt;&gt; attributes) {\n\n        UserResource userResource = keycloak.realm(realm).users().get(userId);\n        UserRepresentation user = userResource.toRepresentation();\n\n        if (attributes != null &amp;&amp; !attributes.isEmpty()) {\n            user.setAttributes(attributes);\n            userResource.update(user);\n        }\n    }\n</code></pre>\n<p>The attributes of the new user are null.</p>\n<p>Like the <code>user.setAttributes(attributes);</code> and <code>userResource.update(user);</code> does nothing.</p>\n<p>Why?</p>\n",
    "tags" : [ "java", "keycloak", "quarkus" ],
    "owner" : {
      "account_id" : 5666154,
      "reputation" : 653,
      "user_id" : 11621071,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/cTL3v.jpg?s=256",
      "display_name" : "Kambei",
      "link" : "https://stackoverflow.com/users/11621071/kambei"
    },
    "is_answered" : false,
    "view_count" : 65,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1743157542,
    "creation_date" : 1743157542,
    "link" : "https://stackoverflow.com/questions/79541175/why-quarkus-keycloak-admin-client-does-not-add-attributes-to-user",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140274302,
    "post_id" : 79541175,
    "body" : "In that case please open a Keycloak project issue, thanks",
    "score" : 0,
    "owner" : {
      "account_id" : 1152519,
      "reputation" : 878,
      "user_id" : 1133928,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0fd2feecf2570851c3cadd0bf9b814b9?s=256&d=identicon&r=PG",
      "display_name" : "Sergey Beryozkin",
      "link" : "https://stackoverflow.com/users/1133928/sergey-beryozkin"
    },
    "creation_date" : 1743174161,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140273889,
    "post_id" : 79541175,
    "body" : "with Keycloak Admin Client directly, same result. :(",
    "score" : 0,
    "owner" : {
      "account_id" : 5666154,
      "reputation" : 653,
      "user_id" : 11621071,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/cTL3v.jpg?s=256",
      "display_name" : "Kambei",
      "link" : "https://stackoverflow.com/users/11621071/kambei"
    },
    "creation_date" : 1743168147,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140273771,
    "post_id" : 79541175,
    "body" : "This is likely to be a Keycloak restriction. Can you try to use Keycloak Admin Client directly, without using the Quarkus extension, to see if it works ? If it does not, then please report it in the Keycloak project",
    "score" : 1,
    "owner" : {
      "account_id" : 1152519,
      "reputation" : 878,
      "user_id" : 1133928,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0fd2feecf2570851c3cadd0bf9b814b9?s=256&d=identicon&r=PG",
      "display_name" : "Sergey Beryozkin",
      "link" : "https://stackoverflow.com/users/1133928/sergey-beryozkin"
    },
    "creation_date" : 1743166061,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}