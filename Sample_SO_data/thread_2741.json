{
  "question" : {
    "question_id" : 79598424,
    "title" : "How to resolve TopicExistsException in kafkaCompanion",
    "body" : "<p>I'm currently working on migrating from KafkaBroker to KafkaCompanion in the unit tests. During this process, I encountered an issue: for each test, I receive the error:</p>\n<blockquote>\n<p>TopicExists — Topic <code>my-topic-events</code> already exists.</p>\n</blockquote>\n<p>To work around this, I created the following method, which I call in the <code>@BeforeEach</code> section to ensure a clean state:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@SneakyThrows\n  private void recreateTopic(String topicName) {\n     try {\n    companion.topics().createAndWait(topicName, 1);\n     } catch (TopicExistsException e) {\n     log.info(&quot;Topic [{}] already exists. Deleting and recreating...&quot;, topicnName);\n     companion.topics().delete(topicName);\n     companion.topics().createAndWait(topicName, 1);\n     }\n  }\n</code></pre>\n<p>In my test, I produce messages to my-topic-2 using companion.produce and consume messages from my-topic-events using companion.consume.</p>\n<p>How to resolve TopicExistsException?\nThank you in advance</p>\n",
    "tags" : [ "java", "apache-kafka", "quarkus", "quarkus-kafka" ],
    "owner" : {
      "account_id" : 18069969,
      "reputation" : 61,
      "user_id" : 13134866,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GiWjb3bsSQeksr7nHWyw5snK1uMRnrFg10fT703QQ=k-s256",
      "display_name" : "sonia belhadj",
      "link" : "https://stackoverflow.com/users/13134866/sonia-belhadj"
    },
    "is_answered" : false,
    "view_count" : 67,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1745933732,
    "creation_date" : 1745931538,
    "link" : "https://stackoverflow.com/questions/79598424/how-to-resolve-topicexistsexception-in-kafkacompanion",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140383437,
    "post_id" : 79598424,
    "body" : "Here’s another alternative I found, replacing recursive deletion in the <b>@AfterEach</b> method for the sample test class:  <code>@AfterEach public void tearDown() {     companion.topics().clear(&quot;topicName&quot;); }</code>.  However, for more complex tests, the recursive deletion method is still needed.",
    "score" : 0,
    "owner" : {
      "account_id" : 18069969,
      "reputation" : 61,
      "user_id" : 13134866,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GiWjb3bsSQeksr7nHWyw5snK1uMRnrFg10fT703QQ=k-s256",
      "display_name" : "sonia belhadj",
      "link" : "https://stackoverflow.com/users/13134866/sonia-belhadj"
    },
    "creation_date" : 1746005362,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140383254,
    "post_id" : 79598424,
    "body" : "Hi @aran, I&#39;m using <code>Quarkus DevService</code> and couldn&#39;t find the <code>delete.topic.enable=true</code> configuration. I’ve searched for an alternative, but the issue remains the same.",
    "score" : 0,
    "owner" : {
      "account_id" : 18069969,
      "reputation" : 61,
      "user_id" : 13134866,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GiWjb3bsSQeksr7nHWyw5snK1uMRnrFg10fT703QQ=k-s256",
      "display_name" : "sonia belhadj",
      "link" : "https://stackoverflow.com/users/13134866/sonia-belhadj"
    },
    "creation_date" : 1746002595,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140381258,
    "post_id" : 79598424,
    "body" : "is delete.topic.enable=true set in your config?",
    "score" : 0,
    "owner" : {
      "account_id" : 2465829,
      "reputation" : 13577,
      "user_id" : 2148953,
      "user_type" : "registered",
      "accept_rate" : 96,
      "profile_image" : "https://i.sstatic.net/DVHoP84E.jpg?s=256",
      "display_name" : "aran",
      "link" : "https://stackoverflow.com/users/2148953/aran"
    },
    "creation_date" : 1745949089,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140380603,
    "post_id" : 79598424,
    "body" : "Hi @OzanG&#252;nalp I had already tried to check if the topic exists, but the issue is that the delete operation takes time, so I couldn&#39;t measure how long it takes. However, by calling the method recursively, it works until we find a better solution . I agree with changing method naming",
    "score" : 0,
    "owner" : {
      "account_id" : 18069969,
      "reputation" : 61,
      "user_id" : 13134866,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GiWjb3bsSQeksr7nHWyw5snK1uMRnrFg10fT703QQ=k-s256",
      "display_name" : "sonia belhadj",
      "link" : "https://stackoverflow.com/users/13134866/sonia-belhadj"
    },
    "creation_date" : 1745938070,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140380436,
    "post_id" : 79598424,
    "body" : "You can call <code>companion.topics().list()</code> and check whether the topic exists before creating it. I agree that having a shortcut method like createIfExistsAndAwait would be handy.",
    "score" : 0,
    "owner" : {
      "account_id" : 18144706,
      "reputation" : 504,
      "user_id" : 13198160,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GjxcyseTw2l0BvFqUdly451wl_O3t_TK9Xwgfvww64=k-s256",
      "display_name" : "Ozan G&#252;nalp",
      "link" : "https://stackoverflow.com/users/13198160/ozan-g%c3%bcnalp"
    },
    "creation_date" : 1745935898,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}