{
  "question" : {
    "question_id" : 79534947,
    "title" : "Problem with Mockito and Junit when fulfilling coverage in Jacoco",
    "body" : "<p>Good afternoon, I'm testing a microservice with Junit and Mockito in Quarkus (a Java framework). I'm also using Jacobo for Covegare. However, the EventRepositoryImplTest class, which simulates database searches, isn't included. The main class is as follows:</p>\n<p><strong>EventRepository</strong></p>\n<pre><code>package com.tmve.customer.oracle.repository;\n\nimport java.util.HashMap;\n\npublic interface EventRepository {\n\n    HashMap&lt;String, String&gt; findValidateNumberStatus(com.cies.grpc.proto.ValidateNumberActivationRequest request);\n}\n</code></pre>\n<p><strong>EventRepositoryImpl</strong></p>\n<pre><code>package com.tmve.customer.oracle.repository.impl;\n\nimport com.tmve.customer.config.TimeoutConfig;\nimport com.tmve.customer.oracle.repository.EventRepository;\nimport com.tmve.customer.util.CustomLogger;\nimport com.tmve.customer.util.LogMessage;\nimport com.tmve.customer.exceptions.DatabaseUnavailableException;\nimport com.tmve.customer.exceptions.NotFound;\nimport jakarta.enterprise.context.ApplicationScoped;\nimport jakarta.inject.Inject;\nimport jakarta.persistence.EntityManager;\nimport jakarta.persistence.ParameterMode;\nimport jakarta.persistence.StoredProcedureQuery;\nimport jakarta.transaction.Transactional;\n\nimport java.sql.SQLException;\nimport java.util.HashMap;\n\n@ApplicationScoped\npublic class EventRepositoryImpl implements EventRepository {\n\n    @Inject\n    public EntityManager entityManager;\n\n    @Inject\n    public TimeoutConfig timeoutConfig;\n\n    @Inject\n    public CustomLogger logger;\n\n    @Override\n    @Transactional\n    public HashMap&lt;String, String&gt; findValidateNumberStatus(com.cies.grpc.proto.ValidateNumberActivationRequest request) {\n        HashMap&lt;String, String&gt; resMap = new HashMap&lt;&gt;();\n        String msisdn = request.getMsisdn().isBlank() ? &quot;0&quot; : request.getMsisdn();\n        /*logger.logInfo(this, LogMessage.DATABASE_OPERATION_STARTED.getMessage());*/\n        /*try {*/\n        try {\n            return timeoutConfig.executeWithTimeout(() -&gt; {\n\n                logger.logInfo(this, LogMessage.DATABASE_OPERATION_STARTED.getMessage());\n                StoredProcedureQuery query = entityManager.createStoredProcedureQuery(&quot;CES_PACK_ADMIN_NUMEROS.validarnumeroactivacion&quot;);\n                logger.logInfo(this, LogMessage.MAPPING_REQUEST_STARTED.getMessage());\n                query.registerStoredProcedureParameter(1, Integer.class, ParameterMode.IN);\n                query.registerStoredProcedureParameter(2, String.class, ParameterMode.OUT);\n                query.registerStoredProcedureParameter(3, String.class, ParameterMode.OUT);\n                query.registerStoredProcedureParameter(4, String.class, ParameterMode.OUT);\n                query.registerStoredProcedureParameter(5, String.class, ParameterMode.OUT);\n                query.setParameter(1, Long.parseLong(msisdn));\n                logger.logInfo(this, LogMessage.MAPPING_REQUEST_COMPLETED.getMessage());\n                query.execute();\n                resMap.put(&quot;status&quot;, (String) query.getOutputParameterValue(2));\n                resMap.put(&quot;statusDate&quot;, (String) query.getOutputParameterValue(3));\n                resMap.put(&quot;registerDate&quot;, (String) query.getOutputParameterValue(4));\n                resMap.put(&quot;reason&quot;, (String) query.getOutputParameterValue(5));\n                if (resMap.get(&quot;reason&quot;).equals(&quot;El numero no existe&quot;)) {\n                    logger.logInfo(this, LogMessage.MAPPING_ERROR.getMessage(), request);\n                    throw new NotFound(&quot;No existe el número en BD CIES&quot;);\n                }\n                logger.logInfo(this, LogMessage.DATABASE_OPERATION_COMPLETED.getMessage(), resMap);\n                return resMap;\n            });\n        }\n        catch (NotFound e) {\n            throw e;\n        }\n        catch (org.eclipse.microprofile.faulttolerance.exceptions.TimeoutException e) {\n            logger.logError(this, LogMessage.DATABASE_OPERATION_ERROR.getMessage(), e);\n            throw new DatabaseUnavailableException(&quot;Timeout alcanzado durante la operación de base de datos&quot;, e);\n        }\n        catch (SQLException e) {\n            logger.logError(this, LogMessage.DATABASE_OPERATION_ERROR.getMessage(), e);\n            throw new DatabaseUnavailableException(&quot;El backend de la base de datos no está disponible&quot;,e);\n        }\n        catch (Exception e) {\n            logger.logError(this, LogMessage.DATABASE_OPERATION_ERROR.getMessage(), e);\n            throw new DatabaseUnavailableException(&quot;Error inesperado al procesar la consulta: &quot; + e.getMessage(), e);\n        }\n    }\n}\n</code></pre>\n<p>The class I am using to simulate Junit/Jacoco tests is the following:</p>\n<p><strong>EventRepositoryImplTest</strong></p>\n<pre><code>package com.tmve.customer.oracle;\n\n\nimport com.cies.grpc.proto.ValidateNumberActivationRequest;\nimport com.tmve.customer.config.TimeoutConfig;\nimport com.tmve.customer.exceptions.DatabaseUnavailableException;\nimport com.tmve.customer.exceptions.NotFound;\nimport com.tmve.customer.oracle.repository.impl.EventRepositoryImpl;\nimport com.tmve.customer.util.CustomLogger;\nimport com.tmve.customer.util.LogMessage;\nimport io.quarkus.test.junit.QuarkusTest;\nimport jakarta.persistence.EntityManager;\nimport jakarta.persistence.ParameterMode;\nimport jakarta.persistence.StoredProcedureQuery;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.DisplayName;\nimport org.junit.jupiter.api.Test;\nimport org.mockito.InjectMocks;\nimport org.mockito.Mock;\n\nimport java.sql.SQLException;\nimport java.util.HashMap;\nimport java.util.concurrent.Callable;\n\nimport static org.junit.jupiter.api.Assertions.*;\nimport static org.mockito.ArgumentMatchers.anyString;\nimport static org.mockito.ArgumentMatchers.eq;\nimport static org.mockito.Mockito.*;\n\n@QuarkusTest\nclass EventRepositoryImplTest {\n\n    @Mock\n    private EntityManager entityManager;\n\n    @Mock\n    private StoredProcedureQuery query;\n\n    @InjectMocks\n    private EventRepositoryImpl eventRepository;\n\n    @Mock\n    private CustomLogger logger;\n\n    @Mock\n    private TimeoutConfig timeoutConfig;\n\n    @BeforeEach\n    void setUp() {\n\n        entityManager = mock(EntityManager.class);\n        query = mock(StoredProcedureQuery.class);\n        logger = mock(CustomLogger.class);\n        timeoutConfig = mock(TimeoutConfig.class);\n\n        eventRepository = new EventRepositoryImpl();\n        eventRepository.entityManager = entityManager;\n        eventRepository.logger = logger;\n        eventRepository.timeoutConfig = timeoutConfig;\n    }\n\n    @Test\n    @DisplayName(&quot;Test FindNumberValidation in BD within EventRepositoryImpl&quot;)\n    void testFindNumberValidationInBD_SuccessfulExecution() throws Exception {\n        HashMap&lt;String,String&gt; resMap = mock(HashMap.class);\n        ValidateNumberActivationRequest request = buildValidateNumberActivationRequest();\n\n        when(entityManager.createStoredProcedureQuery(anyString())).thenReturn(query);\n        query.registerStoredProcedureParameter(1,Integer.class, ParameterMode.OUT);\n        query.registerStoredProcedureParameter(2,String.class, ParameterMode.OUT);\n        query.registerStoredProcedureParameter(3,String.class, ParameterMode.OUT);\n        query.registerStoredProcedureParameter(4,String.class, ParameterMode.OUT);\n        query.registerStoredProcedureParameter(5,String.class, ParameterMode.OUT);\n        query.setParameter(1, Long.parseLong(request.getMsisdn()));\n        query.execute();\n        verify(query).registerStoredProcedureParameter(1,Integer.class, ParameterMode.OUT);\n        verify(query).registerStoredProcedureParameter(2,String.class, ParameterMode.OUT);\n        verify(query).registerStoredProcedureParameter(3,String.class, ParameterMode.OUT);\n        verify(query).registerStoredProcedureParameter(4,String.class, ParameterMode.OUT);\n        verify(query).registerStoredProcedureParameter(5,String.class, ParameterMode.OUT);\n        verify(query).setParameter(1, Long.parseLong(request.getMsisdn()));\n\n        verify(query).execute();\n\n        when(query.getOutputParameterValue(2)).thenReturn(&quot;OC&quot;);\n        when(query.getOutputParameterValue(3)).thenReturn(&quot;25/12/24&quot;);\n        when(query.getOutputParameterValue(4)).thenReturn(&quot;21/09/06&quot;);\n        when(query.getOutputParameterValue(4)).thenReturn(&quot;El numero tiene estado de validaciÃ³n&quot;);\n        when(resMap.get(&quot;status&quot;)).thenReturn(&quot;OC&quot;);\n        when(resMap.get(&quot;statusDate&quot;)).thenReturn(&quot;25/12/24&quot;);\n        when(resMap.get(&quot;registerDate&quot;)).thenReturn(&quot;21/09/06&quot;);\n        when(resMap.get(&quot;reason&quot;)).thenReturn(&quot;El numero tiene estado de validaciÃ³n&quot;);\n        assertEquals(&quot;OC&quot;, resMap.get(&quot;status&quot;));\n        assertEquals(&quot;25/12/24&quot;, resMap.get(&quot;statusDate&quot;));\n        assertEquals(&quot;21/09/06&quot;, resMap.get(&quot;registerDate&quot;));\n        assertEquals(&quot;El numero tiene estado de validaciÃ³n&quot;, resMap.get(&quot;reason&quot;));\n    }\n\n    @Test\n    void testFindNumberValidation_DatabaseTimeout() throws Exception {\n        ValidateNumberActivationRequest request = ValidateNumberActivationRequest.newBuilder()\n                .setMsisdn(&quot;145869997&quot;)\n                .build();\n\n        doThrow(new org.eclipse.microprofile.faulttolerance.exceptions.TimeoutException(&quot;Timeout alcanzado&quot;))\n                .when(timeoutConfig).executeWithTimeout(any());\n\n        DatabaseUnavailableException exception = assertThrows(DatabaseUnavailableException.class, () -&gt;\n                eventRepository.findValidateNumberStatus(request)\n        );\n\n        assertEquals(&quot;Timeout alcanzado durante la operación de base de datos&quot;, exception.getMessage());\n        verify(logger).logError(eq(eventRepository), eq(LogMessage.DATABASE_OPERATION_ERROR.getMessage()), any(Exception.class));\n    }\n\n    @Test\n    void testFindNumberValidation_DatabaseUnavailable() throws Exception {\n        ValidateNumberActivationRequest request = ValidateNumberActivationRequest.newBuilder()\n                .setMsisdn(&quot;146480755&quot;)\n                .build();\n\n        when(entityManager.createStoredProcedureQuery(anyString())).thenAnswer(i -&gt; {throw new SQLException(&quot;Exception SQL&quot;);});\n\n        doAnswer(invocation -&gt; {\n            ((Callable&lt;Void&gt;) invocation.getArgument(0)).call();\n            return null;\n        }).when(timeoutConfig).executeWithTimeout(any());\n\n        DatabaseUnavailableException exception = assertThrows(DatabaseUnavailableException.class, () -&gt; {\n            eventRepository.findValidateNumberStatus(request);\n        });\n\n        assertTrue(exception.getMessage().contains(&quot;El backend de la base de datos no está disponible&quot;));\n        verify(logger).logError(eq(eventRepository), eq(LogMessage.DATABASE_OPERATION_ERROR.getMessage()), any(SQLException.class));\n    }\n\n    @Test\n    void testFindNumberValidation_UnaVailable() throws Exception {\n        ValidateNumberActivationRequest request = ValidateNumberActivationRequest.newBuilder()\n                .setMsisdn(&quot;146480755&quot;)\n                .build();\n\n        when(entityManager.createStoredProcedureQuery(anyString())).thenAnswer(i -&gt; {throw new Exception(&quot;Custom test exception&quot;);});\n\n        doAnswer(invocation -&gt; {\n            ((Callable&lt;Void&gt;) invocation.getArgument(0)).call();\n            return null;\n        }).when(timeoutConfig).executeWithTimeout(any());\n\n        DatabaseUnavailableException exception = assertThrows(DatabaseUnavailableException.class, () -&gt; {\n            eventRepository.findValidateNumberStatus(request);\n        });\n\n        assertTrue(exception.getMessage().contains(&quot;Error inesperado al procesar la consulta&quot;));\n        verify(logger).logError(eq(eventRepository), eq(LogMessage.DATABASE_OPERATION_ERROR.getMessage()), any(Exception.class));\n    }\n\n    @Test\n    void testFindNumberValidation_NotFound() throws Exception {\n        ValidateNumberActivationRequest request = ValidateNumberActivationRequest.newBuilder()\n                .setMsisdn(&quot;1464807&quot;)\n                .build();\n\n        when(entityManager.createStoredProcedureQuery(anyString())).thenAnswer(i -&gt; {throw new NotFound(&quot;No existe el número en BD CIES&quot;);});\n\n        doAnswer(invocation -&gt; {\n            ((Callable&lt;Void&gt;) invocation.getArgument(0)).call();\n            return null;\n        }).when(timeoutConfig).executeWithTimeout(any());\n\n        NotFound exception = assertThrows(NotFound.class, () -&gt; {\n            eventRepository.findValidateNumberStatus(request);\n        });\n\n        assertTrue(exception.getMessage().contains(&quot;No existe el número en BD CIES&quot;));\n    }\n\n    private ValidateNumberActivationRequest buildValidateNumberActivationRequest() {\n        return ValidateNumberActivationRequest.newBuilder().setMsisdn(&quot;145869997&quot;).build();\n    }\n}\n</code></pre>\n<p>When I run the tests, I see that the EventRepositoryImplTest test class runs without any problems:</p>\n<p><a href=\"https://i.sstatic.net/MJtewEpB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/MJtewEpB.png\" alt=\"enter image description here\" /></a></p>\n<p>This is how I have my pom.xml configured:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;groupId&gt;org.tmve.customer&lt;/groupId&gt;\n    &lt;artifactId&gt;validate-number-activation-grpc&lt;/artifactId&gt;\n    &lt;version&gt;1.0.4-DEV&lt;/version&gt;\n\n    &lt;properties&gt;\n        &lt;compiler-plugin.version&gt;3.13.0&lt;/compiler-plugin.version&gt;\n        &lt;maven.compiler.release&gt;17&lt;/maven.compiler.release&gt;\n        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;\n        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;\n        &lt;quarkus.platform.artifact-id&gt;quarkus-bom&lt;/quarkus.platform.artifact-id&gt;\n        &lt;quarkus.platform.group-id&gt;io.quarkus.platform&lt;/quarkus.platform.group-id&gt;\n        &lt;quarkus.platform.version&gt;3.19.2&lt;/quarkus.platform.version&gt;\n        &lt;skipITs&gt;true&lt;/skipITs&gt;\n        &lt;surefire-plugin.version&gt;3.5.2&lt;/surefire-plugin.version&gt;\n\n        &lt;!-- sonar --&gt;\n        &lt;sonar.projectKey&gt;validate-number-activation&lt;/sonar.projectKey&gt;\n        &lt;sonar.projectName&gt;validate-number-activation&lt;/sonar.projectName&gt;\n        &lt;sonar.sources&gt;src/main/java&lt;/sonar.sources&gt;\n        &lt;sonar.tests&gt;src/test/java&lt;/sonar.tests&gt;\n        &lt;sonar.java.binaries&gt;target/classes&lt;/sonar.java.binaries&gt;\n        &lt;sonar.java.test.binaries&gt;target/test-classes&lt;/sonar.java.test.binaries&gt;\n        &lt;sonar.coverage.jacoco.xmlReportPaths&gt;target/jacoco-report/jacoco.xml&lt;/sonar.coverage.jacoco.xmlReportPaths&gt;\n    &lt;/properties&gt;\n\n    &lt;dependencyManagement&gt;\n        &lt;dependencies&gt;\n            &lt;dependency&gt;\n                &lt;groupId&gt;${quarkus.platform.group-id}&lt;/groupId&gt;\n                &lt;artifactId&gt;${quarkus.platform.artifact-id}&lt;/artifactId&gt;\n                &lt;version&gt;${quarkus.platform.version}&lt;/version&gt;\n                &lt;type&gt;pom&lt;/type&gt;\n                &lt;scope&gt;import&lt;/scope&gt;\n            &lt;/dependency&gt;\n        &lt;/dependencies&gt;\n    &lt;/dependencyManagement&gt;\n\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;\n            &lt;artifactId&gt;quarkus-grpc&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;\n            &lt;artifactId&gt;quarkus-rest&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;\n            &lt;artifactId&gt;quarkus-jdbc-oracle&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;\n            &lt;artifactId&gt;quarkus-arc&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;\n            &lt;artifactId&gt;quarkus-rest-jackson&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;\n            &lt;artifactId&gt;quarkus-junit5&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.rest-assured&lt;/groupId&gt;\n            &lt;artifactId&gt;rest-assured&lt;/artifactId&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;\n            &lt;artifactId&gt;quarkus-hibernate-orm&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;\n            &lt;artifactId&gt;quarkus-opentelemetry&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.opentelemetry.instrumentation&lt;/groupId&gt;\n            &lt;artifactId&gt;opentelemetry-jdbc&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;\n            &lt;artifactId&gt;quarkus-grpc-common&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;\n            &lt;artifactId&gt;quarkus-jacoco&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n            &lt;version&gt;1.18.34&lt;/version&gt;\n            &lt;scope&gt;provided&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;\n            &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;\n            &lt;version&gt;2.1&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.google.code.gson&lt;/groupId&gt;\n            &lt;artifactId&gt;gson&lt;/artifactId&gt;\n            &lt;version&gt;2.11.0&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.mockito&lt;/groupId&gt;\n            &lt;artifactId&gt;mockito-core&lt;/artifactId&gt;\n            &lt;version&gt;5.4.0&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.mockito&lt;/groupId&gt;\n            &lt;artifactId&gt;mockito-junit-jupiter&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.mockito&lt;/groupId&gt;\n            &lt;artifactId&gt;mockito-inline&lt;/artifactId&gt;\n            &lt;version&gt;5.2.0&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;\n            &lt;artifactId&gt;quarkus-smallrye-openapi&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;\n            &lt;artifactId&gt;quarkus-swagger-ui&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;\n            &lt;artifactId&gt;quarkus-smallrye-fault-tolerance&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;\n            &lt;artifactId&gt;quarkus-smallrye-health&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;${quarkus.platform.group-id}&lt;/groupId&gt;\n                &lt;artifactId&gt;quarkus-maven-plugin&lt;/artifactId&gt;\n                &lt;version&gt;${quarkus.platform.version}&lt;/version&gt;\n                &lt;extensions&gt;true&lt;/extensions&gt;\n                &lt;executions&gt;\n                    &lt;execution&gt;\n                        &lt;goals&gt;\n                            &lt;goal&gt;build&lt;/goal&gt;\n                            &lt;goal&gt;generate-code&lt;/goal&gt;\n                            &lt;goal&gt;generate-code-tests&lt;/goal&gt;\n                            &lt;goal&gt;native-image-agent&lt;/goal&gt;\n                        &lt;/goals&gt;\n                    &lt;/execution&gt;\n                &lt;/executions&gt;\n            &lt;/plugin&gt;\n            &lt;plugin&gt;\n                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n                &lt;version&gt;${compiler-plugin.version}&lt;/version&gt;\n                &lt;configuration&gt;\n                    &lt;parameters&gt;true&lt;/parameters&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n            &lt;plugin&gt;\n                &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;\n                &lt;version&gt;${surefire-plugin.version}&lt;/version&gt;\n                &lt;configuration&gt;\n                    &lt;systemPropertyVariables&gt;\n                        &lt;java.util.logging.manager&gt;org.jboss.logmanager.LogManager&lt;/java.util.logging.manager&gt;\n                        &lt;maven.home&gt;${maven.home}&lt;/maven.home&gt;\n                    &lt;/systemPropertyVariables&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n            &lt;plugin&gt;\n                &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;\n                &lt;version&gt;${surefire-plugin.version}&lt;/version&gt;\n                &lt;executions&gt;\n                    &lt;execution&gt;\n                        &lt;goals&gt;\n                            &lt;goal&gt;integration-test&lt;/goal&gt;\n                            &lt;goal&gt;verify&lt;/goal&gt;\n                        &lt;/goals&gt;\n                    &lt;/execution&gt;\n                &lt;/executions&gt;\n                &lt;configuration&gt;\n                    &lt;systemPropertyVariables&gt;\n                        &lt;native.image.path&gt;${project.build.directory}/${project.build.finalName}-runner&lt;/native.image.path&gt;\n                        &lt;java.util.logging.manager&gt;org.jboss.logmanager.LogManager&lt;/java.util.logging.manager&gt;\n                        &lt;maven.home&gt;${maven.home}&lt;/maven.home&gt;\n                    &lt;/systemPropertyVariables&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.sonarsource.scanner.maven&lt;/groupId&gt;\n                &lt;artifactId&gt;sonar-maven-plugin&lt;/artifactId&gt;\n                &lt;version&gt;4.0.0.4121&lt;/version&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n\n    &lt;profiles&gt;\n        &lt;profile&gt;\n            &lt;id&gt;native&lt;/id&gt;\n            &lt;activation&gt;\n                &lt;property&gt;\n                    &lt;name&gt;native&lt;/name&gt;\n                &lt;/property&gt;\n            &lt;/activation&gt;\n            &lt;properties&gt;\n                &lt;skipITs&gt;false&lt;/skipITs&gt;\n                &lt;quarkus.native.enabled&gt;true&lt;/quarkus.native.enabled&gt;\n            &lt;/properties&gt;\n        &lt;/profile&gt;\n    &lt;/profiles&gt;\n&lt;/project&gt;\n</code></pre>\n<p><strong>application.properties</strong></p>\n<pre><code>quarkus.application.name=validate-number-activation-grpc\npath=/\n##---------------------\n##grpc configurations\n##---------------------\nquarkus.grpc.server.port=${PORT:9001}\nquarkus.http.port=8080\n##---------------------\n#open telemetry configurations\n##---------------------\nquarkus.otel.enabled=true\nquarkus.otel.metrics.enabled=true\nquarkus.otel.traces.eusp.enabled=true\nquarkus.otel.exporter.otlp.endpoint=${QUARKUS_OTEL_EXPORTER_OTLP_ENDPOINT:http://xxxxxxxxx}\nquarkus.otel.exporter.otlp.traces.protocol=grpc\nquarkus.otel.exporter.otlp.metrics.protocol=grpc\nquarkus.otel.exporter.otlp.protocol=grpc\nquarkus.log.console.format=%d{HH:mm:ss} %-5p traceId=%X{traceId}, parentId=%X{parentId}, spanId=%X{spanId}, sampled=%X{sampled} [%c{2.}] (%t) %s%e%n\n\n##---------------------\n##jacoco configurations\n##---------------------\nquarkus.jacoco.enabled=true\nquarkus.jacoco.report=true\nquarkus.jacoco.report-location=target/jacoco-report\nquarkus.jacoco.excludes=/com/cies/grpc/proto/\n\n##---------------------\n##database configurations\n##---------------------\nquarkus.datasource.db-kind=oracle\nquarkus.datasource.jdbc.url=${QUARKUS_DATASOURCE_JDBC_URL:jdbc:oracle:thin:@xxxxxxxxxx/IVR}\nquarkus.datasource.jdbc.acquisition-timeout=${QUARKUS_DATASOURCE_JDBC_ACQUISITION_TIMEOUT:500}\nquarkus.datasource.jdbc.driver=oracle.jdbc.driver.OracleDriver\nquarkus.hibernate-orm.dialect=org.hibernate.dialect.OracleDialect\nquarkus.datasource.db-version=${QUARKUS_DATASOURCE_DB_VERSION:11.2.0}\nquarkus.datasource.jdbc.min-size=10\nquarkus.datasource.jdbc.max-size=50\ntimeout.connection-config=${CONFIG_TIMEOUT_DB:10000}\nquarkus.live-reload.instrumentation=true\n\n\nquarkus.hibernate-orm.log.sql=false\nquarkus.hibernate-orm.database.generation=none\n\n# ---------\n# QUARKUS CONFIGURATION\n# ---------\nquarkus.native.add-all-charsets=true\nquarkus.hibernate-orm.validate-in-dev-mode=false\nquarkus.log.console.format=%d{HH:mm:ss} %-5p traceId=%X{traceId}, parentId=%X{parentId}, spanId=%X{spanId}, sampled=%X{sampled} [%c{2.}] (%t) %s%e%n\nquarkus.native.additional-build-args=-march=compatibility,-H:IncludeResources=.*\\\\.jks\nquarkus.native.container-build=true\n</code></pre>\n<p>This is how it shows up in the jacoco report:</p>\n<p><strong>\\target\\jacoco-report</strong></p>\n<p><strong>index.html</strong></p>\n<p><a href=\"https://i.sstatic.net/v8vRSG3o.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/v8vRSG3o.png\" alt=\"enter image description here\" /></a></p>\n<p><a href=\"https://i.sstatic.net/YjddvdSx.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/YjddvdSx.png\" alt=\"enter image description here\" /></a></p>\n<p>The TimeoutConfig class is added, which is a modification of the FaulTolererance and will be called within the execution of the EventRepositoryImpl and the findValidateNumberStatus method, which if a certain time has passed (which is configured from the application.properties) throws a TimeoutException type exception:</p>\n<p><strong>TimeoutConfig</strong></p>\n<pre><code>package com.tmve.customer.config;\nimport io.smallrye.faulttolerance.api.FaultTolerance;\nimport jakarta.enterprise.context.ApplicationScoped;\nimport org.eclipse.microprofile.config.inject.ConfigProperty;\nimport java.time.temporal.ChronoUnit;\nimport java.util.concurrent.Callable;\n\n@ApplicationScoped\npublic class TimeoutConfig {\n\n    @ConfigProperty(name = &quot;timeout.connection-config&quot;)\n    long timeout;\n\n    public &lt;T&gt; T executeWithTimeout(Callable&lt;T&gt; task) throws Exception {\n        FaultTolerance&lt;T&gt; faultTolerance = FaultTolerance.&lt;T&gt;create()\n                .withTimeout()\n                .duration(timeout, ChronoUnit.MILLIS)\n                .done()\n                .build();\n\n        return faultTolerance.call(task);\n    }\n\n}\n</code></pre>\n<p>What could be happening? Why isn't my coverage covering me?</p>\n",
    "tags" : [ "java", "junit", "mockito", "quarkus", "jacoco" ],
    "owner" : {
      "account_id" : 16016597,
      "reputation" : 813,
      "user_id" : 11559150,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-QtOBYMy4xpY/AAAAAAAAAAI/AAAAAAAAFnU/kMW7Gabqodw/s256-rj/photo.jpg",
      "display_name" : "Cesar Justo",
      "link" : "https://stackoverflow.com/users/11559150/cesar-justo"
    },
    "is_answered" : false,
    "view_count" : 116,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1743091527,
    "creation_date" : 1742939512,
    "link" : "https://stackoverflow.com/questions/79534947/problem-with-mockito-and-junit-when-fulfilling-coverage-in-jacoco",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140271685,
    "post_id" : 79534947,
    "body" : "timeout is a mock in your test, you are not using the real timeout class. Anything that the real class might do is irrelevant, you are not using it.",
    "score" : 0,
    "owner" : {
      "account_id" : 39208,
      "reputation" : 269387,
      "user_id" : 112968,
      "user_type" : "registered",
      "accept_rate" : 68,
      "profile_image" : "https://i.sstatic.net/zHTaT.png?s=256",
      "display_name" : "knittl",
      "link" : "https://stackoverflow.com/users/112968/knittl"
    },
    "creation_date" : 1743113506,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140270444,
    "post_id" : 79534947,
    "body" : "No, from what I see when running the tests, when calling the EventRepositoryImpl class from the EventRepositoryImplTest class, when it enters the code that has the try with the timeoutConfig.executeWithTimeout, it is jumping directly to the TimeoutException exception, however, in normal execution this does not happen, could it be because the timeoutconfig class has a timeout configured in the application properties?",
    "score" : 0,
    "owner" : {
      "account_id" : 16016597,
      "reputation" : 813,
      "user_id" : 11559150,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-QtOBYMy4xpY/AAAAAAAAAAI/AAAAAAAAFnU/kMW7Gabqodw/s256-rj/photo.jpg",
      "display_name" : "Cesar Justo",
      "link" : "https://stackoverflow.com/users/11559150/cesar-justo"
    },
    "creation_date" : 1743091332,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140263169,
    "post_id" : 79534947,
    "body" : "if you add a debug point and run the test in debug mode does it hit the red lines that are not covered?",
    "score" : 3,
    "owner" : {
      "account_id" : 5083689,
      "reputation" : 1141,
      "user_id" : 4079056,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/LfAQ3.jpg?s=256",
      "display_name" : "sanurah",
      "link" : "https://stackoverflow.com/users/4079056/sanurah"
    },
    "creation_date" : 1742943390,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}