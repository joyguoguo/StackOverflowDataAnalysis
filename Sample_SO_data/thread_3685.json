{
  "question" : {
    "question_id" : 79531525,
    "title" : "solr custom plugin",
    "body" : "<p>I want to figure out how to use my custom plugin for Solr.</p>\n<p>I found the following relevant article:</p>\n<p><a href=\"https://medium.com/@akshayt030/developing-custom-filter-plugin-in-lucene-solr-8-63cb099036cc\" rel=\"nofollow noreferrer\">https://medium.com/@akshayt030/developing-custom-filter-plugin-in-lucene-solr-8-63cb099036cc</a></p>\n<p>After reading the instructions, I wrote my plugin.</p>\n<p>I use the following libraries:</p>\n<pre><code>&lt;dependencies&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;junit&lt;/groupId&gt;\n        &lt;artifactId&gt;junit&lt;/artifactId&gt;\n        &lt;version&gt;4.4&lt;/version&gt;\n        &lt;scope&gt;test&lt;/scope&gt;\n    &lt;/dependency&gt;\n\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.apache.lucene&lt;/groupId&gt;\n        &lt;artifactId&gt;lucene-core&lt;/artifactId&gt;\n        &lt;version&gt;5.0.0&lt;/version&gt;\n    &lt;/dependency&gt;\n\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.apache.lucene&lt;/groupId&gt;\n        &lt;artifactId&gt;lucene-queryparser&lt;/artifactId&gt;\n        &lt;version&gt;5.0.0&lt;/version&gt;\n    &lt;/dependency&gt;\n\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.apache.lucene&lt;/groupId&gt;\n        &lt;artifactId&gt;lucene-analyzers-common&lt;/artifactId&gt;\n        &lt;version&gt;5.0.0&lt;/version&gt;\n    &lt;/dependency&gt;\n\n   &lt;dependency&gt;\n        &lt;groupId&gt;org.apache.lucene&lt;/groupId&gt;\n        &lt;artifactId&gt;lucene-test-framework&lt;/artifactId&gt;\n        &lt;version&gt;5.0.0&lt;/version&gt;\n        &lt;scope&gt;test&lt;/scope&gt;\n    &lt;/dependency&gt;\n&lt;/dependencies&gt;\n</code></pre>\n<p>Filter code:</p>\n<pre><code>import java.io.IOException;\nimport java.util.Arrays;\n\nimport org.apache.lucene.analysis.TokenFilter;\nimport org.apache.lucene.analysis.TokenStream;\nimport org.apache.lucene.analysis.tokenattributes.CharTermAttribute;\nimport org.apache.lucene.analysis.tokenattributes.OffsetAttribute;\nimport org.apache.lucene.analysis.tokenattributes.PayloadAttribute;\nimport org.apache.lucene.analysis.tokenattributes.PositionIncrementAttribute;\nimport org.apache.lucene.analysis.tokenattributes.TypeAttribute;\n\nimport org.apache.logging.log4j.LogManager;\nimport org.apache.logging.log4j.Logger;\n\npublic final class DebugTokenFilter extends TokenFilter {\n\n    private static final Logger logger = LogManager.getLogger(DebugTokenFilter.class);\n\n    private final CharTermAttribute charTerm = getAttribute(CharTermAttribute.class);\n    private final OffsetAttribute offset = getAttribute(OffsetAttribute.class);\n    private final PositionIncrementAttribute posInc = getAttribute(PositionIncrementAttribute.class);\n    private final TypeAttribute type = getAttribute(TypeAttribute.class);\n    private final PayloadAttribute payload = getAttribute(PayloadAttribute.class);\n\n    private final String name;\n\n    public DebugTokenFilter(TokenStream input, String name) {\n        super(input);\n        this.name = name;\n    }\n\n    @Override\n    public boolean incrementToken() throws IOException {\n\n        boolean hasNext = input.incrementToken();\n\n        if (hasNext) {\n\n            String term =  new String(charTerm.buffer(), 0, charTerm.length());\n            logger.info(&quot;{}, term = {}, type = {}, payload =, offset = , length = , increment = &quot;,\n                    name,\n                    term,\n                    type.type().toString(),\n                    getPayloadString(),\n                    String.valueOf(offset.startOffset()),\n                    String.valueOf(offset.endOffset() - offset.startOffset()),\n                    String.valueOf(posInc.getPositionIncrement()));\n        }\n\n        return hasNext;\n    }\n\n    private String getPayloadString() {\n        if (payload == null || payload.getPayload() == null) {\n            return &quot;(no payload)&quot;;\n        }\n        return Arrays.toString(payload.getPayload().bytes);\n    }\n}\n</code></pre>\n<p>The factory code:</p>\n<pre><code>import java.util.Map;\n\nimport org.apache.lucene.analysis.TokenStream;\nimport org.apache.lucene.analysis.util.TokenFilterFactory;\n\npublic class DebugTokenFilterFactory extends TokenFilterFactory {\n\n    private final String name;\n\n    public DebugTokenFilterFactory(Map&lt;String, String&gt; args) {\n        super(args);\n        this.name = args.containsKey(&quot;name&quot;) ? args.get(&quot;name&quot;) : &quot;debug&quot;;\n    }\n\n    @Override\n    public TokenStream create(TokenStream input) {\n        return new DebugTokenFilter(input, name);\n    }\n}\n</code></pre>\n<p>I use solr version <strong>9.7.0</strong> to check the functionality.\nCompiled jar I put to the following lib:</p>\n<pre><code>${SOLR_HOME}\\lib\\custom\n</code></pre>\n<p>and included in <strong>solrconfig.xml</strong> file</p>\n<pre><code>    &lt;lib dir=&quot;${solr.install.dir:../../../..}/custom_lib&quot; regex=&quot;.*\\.jar&quot; /&gt;\n</code></pre>\n<p>I included my filter to <strong>text_general</strong> field type in <strong>management_schema.xml</strong></p>\n<pre><code>  &lt;fieldType name=&quot;text_general&quot; class=&quot;solr.TextField&quot; positionIncrementGap=&quot;100&quot; multiValued=&quot;true&quot;&gt;\n    &lt;analyzer type=&quot;index&quot;&gt;\n      &lt;tokenizer name=&quot;standard&quot;/&gt;\n      &lt;filter name=&quot;stop&quot; ignoreCase=&quot;true&quot; words=&quot;stopwords.txt&quot;/&gt;\n      &lt;filter name=&quot;lowercase&quot;/&gt;\n      &lt;filter class=&quot;abc.example.ReverseFilterFactory”/&gt;\n   &lt;/analyzer&gt;\n    &lt;analyzer type=&quot;query&quot;&gt;\n      &lt;tokenizer name=&quot;standard&quot;/&gt;\n      &lt;filter name=&quot;stop&quot; ignoreCase=&quot;true&quot; words=&quot;stopwords.txt&quot;/&gt;\n      &lt;filter expand=&quot;true&quot; ignoreCase=&quot;true&quot; synonyms=&quot;synonyms.txt&quot; name=&quot;synonymGraph&quot;/&gt;\n      &lt;filter name=&quot;lowercase&quot;/&gt;\n    &lt;/analyzer&gt; \n  &lt;/fieldType&gt;\n</code></pre>\n<p>After Solr restarted I saw an initialization error and none core was loaded.</p>\n<p>[![enter image description here][1]][1]</p>\n<p>There aren't any error in logs:</p>\n<pre><code>5-03-24 15:55:39.328 INFO  (main) [c: s: r: x: t:] o.e.j.s.Server jetty-10.0.22; built: 2024-06-27T16:03:51.502Z; git: 5c8471e852d377fd726ad9b1692c35ffc5febb09; jvm 11+28\n2025-03-24 15:55:39.675 WARN  (main) [c: s: r: x: t:] o.e.j.u.DeprecationWarning Using @Deprecated Class org.eclipse.jetty.servlet.listener.ELContextCleaner\n2025-03-24 15:55:39.691 INFO  (main) [c: s: r: x: t:] o.a.s.s.CoreContainerProvider Using logger factory org.apache.logging.slf4j.Log4jLoggerFactory\n2025-03-24 15:55:39.707 INFO  (main) [c: s: r: x: t:] o.a.s.s.CoreContainerProvider  ___      _       Welcome to Apache Solr™ version 9.7.0\n2025-03-24 15:55:39.707 INFO  (main) [c: s: r: x: t:] o.a.s.s.CoreContainerProvider / __| ___| |_ _   Starting in standalone mode on port 8983\n2025-03-24 15:55:39.707 INFO  (main) [c: s: r: x: t:] o.a.s.s.CoreContainerProvider \\__ \\/ _ \\ | '_|  Install dir: C:\\software\\solr-9.7.0\n2025-03-24 15:55:39.707 INFO  (main) [c: s: r: x: t:] o.a.s.s.CoreContainerProvider |___/\\___/_|_|    Start time: 2025-03-24T15:55:39.707195900Z\n2025-03-24 15:55:39.707 INFO  (main) [c: s: r: x: t:] o.a.s.s.CoreContainerProvider Solr started with &quot;-XX:+CrashOnOutOfMemoryError&quot; that will crash on any OutOfMemoryError exception. The cause of the OOME will be logged in the crash file at the following path: C:\\software\\solr-9.7.0\\server\\logs\\jvm_crash_12756.log\n2025-03-24 15:55:39.729 INFO  (main) [c: s: r: x: t:] o.a.s.s.CoreContainerProvider Solr Home: C:\\software\\solr-9.7.0\\server\\solr (source: system property: solr.solr.home)\n2025-03-24 15:55:39.744 INFO  (main) [c: s: r: x: t:] o.a.s.c.SolrXmlConfig Loading solr.xml from C:\\software\\solr-9.7.0\\server\\solr\\solr.xml\n2025-03-24 15:55:39.776 INFO  (main) [c: s: r: x: t:] o.a.s.c.SolrResourceLoader Added 3 libs to classloader, from paths: [/C:/software/solr-9.7.0/lib, /C:/software/solr-9.7.0/lib/custom]\n</code></pre>\n<p>What could I have missed for the filter to work correctly?</p>\n",
    "tags" : [ "java", "search", "solr", "lucene" ],
    "owner" : {
      "account_id" : 23427829,
      "reputation" : 47,
      "user_id" : 17487087,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GixB4zPtUpo1vGKqeQdXsANzdhCjbfejb7Vm1Y=k-s256",
      "display_name" : "Evgeniy Skiba",
      "link" : "https://stackoverflow.com/users/17487087/evgeniy-skiba"
    },
    "is_answered" : false,
    "view_count" : 61,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1742912034,
    "creation_date" : 1742831158,
    "link" : "https://stackoverflow.com/questions/79531525/solr-custom-plugin",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}