{
  "question" : {
    "question_id" : 79810750,
    "title" : "Keycloak: how to connect custom validator?",
    "body" : "<p>Hello I have a project in which I need to validate some code if chosen role is Scientist. I have written my validator (current validation logic is irrelevant)</p>\n<pre><code>package com.example.keycloak;\n\nimport org.keycloak.validate.Validator;\nimport org.keycloak.validate.ValidationContext;\nimport org.keycloak.validate.ValidationError;\nimport org.keycloak.validate.ValidatorConfig;\n\nimport java.util.Map;\n\npublic class ScientistCodeValidator implements Validator {\n    public static final String ID = &quot;scientist-code-validator&quot;;\n\n    public String getId() {\n        return ID;\n    }\n\n    @Override\n    public ValidationContext validate(\n            Object value,\n            String inputHint,\n            ValidationContext context,\n            ValidatorConfig config\n    ) {\n        Map&lt;String, ?&gt; attributes = context.getAttributes();\n        String role = attributes.get(&quot;Role&quot;) != null ? attributes.get(&quot;Role&quot;).toString() : null;\n        String code = value != null ? value.toString() : null;\n        if (&quot;Scientist&quot;.equals(role)) {\n            if (code == null || code.length() &lt; 4 || code.length() &gt; 12) {\n                context.addError(new ValidationError(inputHint, getId(), &quot;Invalid Scientist code (must be 4-12 chars)&quot;));\n            }\n        }\n        return context;\n    }\n\n}\n</code></pre>\n<p>this is my resources/META-INF/services/org.keycloak.validate.Validator</p>\n<pre><code>com.example.keycloak.ScientistCodeValidator\n</code></pre>\n<p>i then compile my validator to jar using mvn clean package. after that i put it in <code>keycloak/providers</code> directory and copy it into my docker like this</p>\n<pre><code>keycloak:\n  image: quay.io/keycloak/keycloak:24.0\n  container_name: keycloak\n  environment:\n    KC_DB: postgres\n    KC_DB_URL: ${KEYCLOAK_DB_URL}\n    KC_DB_USERNAME: ${PGSQL_USER}\n    KC_DB_PASSWORD: ${PGSQL_PASSWORD}\n    KC_HOSTNAME: ${KEYCLOAK_HOSTNAME}\n    KEYCLOAK_ADMIN: ${KEYCLOAK_ADMIN}\n    KEYCLOAK_ADMIN_PASSWORD: ${KEYCLOAK_ADMIN_PASSWORD}\n    KC_FEATURES: scripts\n  ports:\n    - &quot;${KEYCLOAK_PORT}:8080&quot;\n  networks:\n    - mynetwork\n  depends_on:\n    db:\n      condition: service_healthy\n  command: start-dev --import-realm\n  volumes:\n    - ./keycloak/data:/opt/keycloak/data\n    - ./keycloak/themes:/opt/keycloak/themes\n    - ./keycloak/providers:/opt/keycloak/providers\n</code></pre>\n<p>then i have read somewhere that you can add your validator to your user profile json editor like this</p>\n<pre><code>    {\n      &quot;name&quot;: &quot;code&quot;,\n      &quot;displayName&quot;: &quot;Access Code&quot;,\n      &quot;validations&quot;: {\n        &quot;scientist-code-validator&quot;: {}\n      },\n      &quot;permissions&quot;: {\n        &quot;view&quot;: [\n          &quot;admin&quot;,\n          &quot;user&quot;\n        ],\n        &quot;edit&quot;: [\n          &quot;admin&quot;,\n          &quot;user&quot;\n        ]\n      },\n      &quot;multivalued&quot;: false\n    }\n</code></pre>\n<p>but i keep getting the following error in the keycloak admin panel</p>\n<ul>\n<li><strong>Could not update user profile settings: [Validator 'scientist-code-validator' defined for attribute 'code' doesn't exist]</strong></li>\n</ul>\n<p>is there some way to add the validation logic so that it works correctly?</p>\n<p>this is my <code>pom.xml</code> if that changes anything</p>\n<pre><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;\n         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0\n         http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;groupId&gt;com.example&lt;/groupId&gt;\n    &lt;artifactId&gt;keycloak-custom-spi&lt;/artifactId&gt;\n    &lt;version&gt;1.0.0&lt;/version&gt;\n    &lt;packaging&gt;jar&lt;/packaging&gt;\n\n    &lt;properties&gt;\n        &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;\n        &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;\n        &lt;keycloak.version&gt;24.0.0&lt;/keycloak.version&gt;\n    &lt;/properties&gt;\n\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.keycloak&lt;/groupId&gt;\n            &lt;artifactId&gt;keycloak-core&lt;/artifactId&gt;\n            &lt;version&gt;${keycloak.version}&lt;/version&gt;\n            &lt;scope&gt;provided&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.keycloak&lt;/groupId&gt;\n            &lt;artifactId&gt;keycloak-server-spi&lt;/artifactId&gt;\n            &lt;version&gt;${keycloak.version}&lt;/version&gt;\n            &lt;scope&gt;provided&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.keycloak&lt;/groupId&gt;\n            &lt;artifactId&gt;keycloak-server-spi-private&lt;/artifactId&gt;\n            &lt;version&gt;${keycloak.version}&lt;/version&gt;\n            &lt;scope&gt;provided&lt;/scope&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n&lt;/project&gt;\n</code></pre>\n",
    "tags" : [ "java", "validation", "keycloak", "keycloak-services" ],
    "owner" : {
      "account_id" : 31098977,
      "reputation" : 1,
      "user_id" : 23908903,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ba206fb0adb575d78e40bc6b84b571bc?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "adab",
      "link" : "https://stackoverflow.com/users/23908903/adab"
    },
    "is_answered" : false,
    "view_count" : 69,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1762391203,
    "creation_date" : 1762391203,
    "link" : "https://stackoverflow.com/questions/79810750/keycloak-how-to-connect-custom-validator",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140839124,
    "post_id" : 79810750,
    "body" : "does this help <a href=\"https://stackoverflow.com/questions/72463813/in-keycloak-how-to-deploy-a-custom-validator-for-custom-user-attribute-within-de\" title=\"in keycloak how to deploy a custom validator for custom user attribute within de\">stackoverflow.com/questions/72463813/&hellip;</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 951981,
      "reputation" : 15334,
      "user_id" : 977919,
      "user_type" : "registered",
      "accept_rate" : 92,
      "profile_image" : "https://i.sstatic.net/eT2FU.jpg?s=256",
      "display_name" : "sidgate",
      "link" : "https://stackoverflow.com/users/977919/sidgate"
    },
    "creation_date" : 1762398124,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}