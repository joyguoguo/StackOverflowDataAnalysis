{
  "question" : {
    "question_id" : 79809969,
    "title" : "ClassCastException when comparing elements in custom ArrayOrderedList using Comparator",
    "body" : "<p>I am implementing an ordered list that automatically inserts elements in the correct sorted position using a Comparator. The list is built from scratch (not using java.util.ArrayList) and uses an internal raw array.</p>\n<p>Here is the base list implementation:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class ArrayList&lt;T&gt; implements ListADT&lt;T&gt; {\n    protected T[] array;\n    protected int count;\n    private static final int DEFAULT_CAPACITY = 10;\n\n    @SuppressWarnings(&quot;unchecked&quot;)\n    public ArrayList() {\n        array = (T[]) (new Object[DEFAULT_CAPACITY]); // internal storage\n        count = 0;\n    }\n\n    protected void expandCapacity() {\n        array = java.util.Arrays.copyOf(array, array.length * 2);\n    }\n}\n\n</code></pre>\n<p>And here is the ordered version:</p>\n<pre class=\"lang-java prettyprint-override\"><code>\npublic class ArrayOrderedList&lt;T&gt; extends ArrayList&lt;T&gt; implements OrderedListADT&lt;T&gt; {\n\n    private Comparator&lt;T&gt; comparator;\n\n    public ArrayOrderedList(Comparator&lt;T&gt; comparator) {\n        this.comparator = comparator;\n    }\n\n    @Override\n    public void add(T element) {\n        if (count == array.length)\n            expandCapacity();\n\n        int i = 0;\n\n        // The error occurs here:\n        while (i &lt; count &amp;&amp; comparator.compare(element, array[i]) &gt; 0) {\n            i++;\n        }\n\n        for (int j = count; j &gt; i; j--) {\n            array[j] = array[j - 1];\n        }\n\n        array[i] = element;\n        count++;\n    }\n}\n\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>public interface OrderedListADT&lt;T&gt; extends ListADT&lt;T&gt; {\n\npublic void add(T element);\n\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>public interface ListADT&lt;T&gt;  extends Iterable&lt;T&gt;{\n\n    public T removeFirst();\n\n    public T removeLast();\n\n    public T remove( T Object);\n    public T first();\n\n    public T last();\n\n    public boolean contains(T target);\n\n    public boolean isEmpty();\n\n    public int size();\n\n    public Iterator&lt;T&gt; iterator();\n\n    public String toString();\n\n\n}\n</code></pre>\n<p>Demo code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class ArrayOrderedListDemo {\n    public static void main(String[] args) {\n        ArrayOrderedList&lt;Integer&gt; array1 = new ArrayOrderedList&lt;&gt;(Comparator.naturalOrder());\n        array1.add(2);\n        array1.add(5);\n        array1.add(4);\n        array1.add(1);\n    }\n}\n\n\n\n</code></pre>\n<p>Expected behavior</p>\n<p>I expect the elements to be inserted in sorted ascending order, for example:</p>\n<p>[1, 2, 4, 5]</p>\n<p>Actual Runtime Error</p>\n<pre><code>Exception in thread &quot;main&quot; java.lang.ClassCastException:\nclass [Ljava.lang.Object; cannot be cast to class [Ljava.lang.Comparable;\n([Ljava.lang.Object; and [Ljava.lang.Comparable; are in module java.base of loader 'bootstrap')\n    at OrderedList.ArrayOrderedList.add(ArrayOrderedList.java:14)\n    at OrderedList.ArrayOrderedListDemo.main(ArrayOrderedListDemo.java:10)\n</code></pre>\n<p>What I understand so far</p>\n<p>This happens because the internal array is actually an Object[] but the comparison operation indirectly expects the stored elements to be in a Comparable[] (even though I am using a Comparator).</p>\n<p>Constraints</p>\n<p>This is an academic exercise where:</p>\n<p>The list must be implemented from scratch.</p>\n<p>I cannot use java.util.ArrayList.</p>\n<p>I cannot use reflection or Array.newInstance(...).</p>\n<p>I must store elements in a generic array like this:</p>\n<p>array = (T[]) new Object[n];</p>\n<p>My Question</p>\n<p>How can I safely compare elements using a Comparator when they are stored in an Object[], without converting the internal array into a Comparable[], and without using reflection?</p>\n",
    "tags" : [ "java", "arrays", "generics", "comparator", "classcastexception" ],
    "owner" : {
      "account_id" : 23597695,
      "reputation" : 11,
      "user_id" : 17634642,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/OVsQC.jpg?s=256",
      "display_name" : "Raam",
      "link" : "https://stackoverflow.com/users/17634642/raam"
    },
    "is_answered" : false,
    "view_count" : 119,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1762424015,
    "creation_date" : 1762342036,
    "link" : "https://stackoverflow.com/questions/79809969/classcastexception-when-comparing-elements-in-custom-arrayorderedlist-using-comp",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140840988,
    "post_id" : 79809969,
    "body" : "The problem is that you&#39;re storing Integers which implements Comparable&lt;Integer&gt; while NaturalOrderComparator expects an object which implements Comparable&lt;Object&gt;, so when Integer.compareTo is called with Object it fails with a class cast because Integer.compareTo doesn&#39;t expect Object. Yeah, these comparators suck :D",
    "score" : 0,
    "owner" : {
      "account_id" : 17972905,
      "reputation" : 10131,
      "user_id" : 13061224,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/GyOMS.jpg?s=256",
      "display_name" : "siggemannen",
      "link" : "https://stackoverflow.com/users/13061224/siggemannen"
    },
    "creation_date" : 1762474949,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140839647,
    "post_id" : 79809969,
    "body" : "The code you’ve shown does not match the exception. The exception indicates that you used something like <code>ArrayOrderedList&lt;T extends Comparable&gt;</code> instead of <code>ArrayOrderedList&lt;T&gt;</code>. If you changed that at some point of time, you haven’t recompiled your code since then.",
    "score" : 2,
    "owner" : {
      "account_id" : 3211603,
      "reputation" : 300981,
      "user_id" : 2711488,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/t2hoD.jpg?s=256",
      "display_name" : "Holger",
      "link" : "https://stackoverflow.com/users/2711488/holger"
    },
    "creation_date" : 1762423928,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140838933,
    "post_id" : 79809969,
    "body" : "@Raam You appear to have posted the wrong code, as call <code>comparator.compare</code> isn&#39;t a cause of  cast exception to <code>Comparable</code>",
    "score" : 0,
    "owner" : {
      "account_id" : 5998820,
      "reputation" : 16283,
      "user_id" : 4712734,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f6e922a2cb7e2da59286f27b162aaca5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "DuncG",
      "link" : "https://stackoverflow.com/users/4712734/duncg"
    },
    "creation_date" : 1762382679,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140838585,
    "post_id" : 79809969,
    "body" : "The issue is already resolved. The class you&#39;re asking about, ArrayIterator, is just a standard iterator that implements Java’s Iterator interface. The code for creating the iterator follows the usual pattern, because that&#39;s exactly the purpose: to provide a standardized way to traverse the data structure. @JannikS.",
    "score" : 0,
    "owner" : {
      "account_id" : 23597695,
      "reputation" : 11,
      "user_id" : 17634642,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/OVsQC.jpg?s=256",
      "display_name" : "Raam",
      "link" : "https://stackoverflow.com/users/17634642/raam"
    },
    "creation_date" : 1762369622,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140838403,
    "post_id" : 79809969,
    "body" : "I disagree with closing the post, for at least 2 good reasons. (1) It&#39;s 1st time user of SO, and (2) he provided as much input as he could, and there are many circumstances where questions can&#39;t provide <i>&quot;compilable code&quot;</i>. If this was a SO rule, we&#39;d have to shut down SO completely, as most code posted in questions are just snippets.",
    "score" : 0,
    "owner" : {
      "account_id" : 1170362,
      "reputation" : 17697,
      "user_id" : 1147688,
      "user_type" : "registered",
      "accept_rate" : 53,
      "profile_image" : "https://www.gravatar.com/avatar/c76a3f29c105a73c4060b3d1934ccd9a?s=256&d=identicon&r=PG",
      "display_name" : "not2qubit",
      "link" : "https://stackoverflow.com/users/1147688/not2qubit"
    },
    "creation_date" : 1762364800,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140838243,
    "post_id" : 79809969,
    "body" : "Also, your proposed solution is nonsense - if <code>element</code> previously was something that didn&#39;t implement <code>Comparable</code>, your new code should&#39;ve thrown too. You didn&#39;t per chance forgot to recompile?",
    "score" : 1,
    "owner" : {
      "account_id" : 30223964,
      "reputation" : 252,
      "user_id" : 23162960,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2451acfac254a6fc75757ecf89d75f9a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jannik S.",
      "link" : "https://stackoverflow.com/users/23162960/jannik-s"
    },
    "creation_date" : 1762360502,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140838234,
    "post_id" : 79809969,
    "body" : "Welp - Please read <a href=\"//stackoverflow.com/help/mcve\">Our Help article on creating an MCVE</a> and <a href=\"https://ericlippert.com/2014/03/05/how-to-debug-small-programs/\" rel=\"nofollow noreferrer\">How to debug small programms</a>. Your code as currently in the question still fails it - I get a compiler error relating to a missing class <code>ArrayIterator</code>, and a &quot;cannot infer type arguments&quot; in the main method. If I fix both, the program works as intended.",
    "score" : 0,
    "owner" : {
      "account_id" : 30223964,
      "reputation" : 252,
      "user_id" : 23162960,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2451acfac254a6fc75757ecf89d75f9a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jannik S.",
      "link" : "https://stackoverflow.com/users/23162960/jannik-s"
    },
    "creation_date" : 1762360361,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140838224,
    "post_id" : 79809969,
    "body" : "i solve the problem. the solution was implementing ths code : ``` java Comparable&lt;T&gt; comparableElement = (Comparable&lt;T&gt;) element;                while (i &lt; count &amp;&amp; comparableElement.compareTo(array[i]) &gt; 0) {             i++;         } ```",
    "score" : 0,
    "owner" : {
      "account_id" : 23597695,
      "reputation" : 11,
      "user_id" : 17634642,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/OVsQC.jpg?s=256",
      "display_name" : "Raam",
      "link" : "https://stackoverflow.com/users/17634642/raam"
    },
    "creation_date" : 1762360097,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140838184,
    "post_id" : 79809969,
    "body" : "@JannikS. i updated ant put the ADT interfaces",
    "score" : 0,
    "owner" : {
      "account_id" : 23597695,
      "reputation" : 11,
      "user_id" : 17634642,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/OVsQC.jpg?s=256",
      "display_name" : "Raam",
      "link" : "https://stackoverflow.com/users/17634642/raam"
    },
    "creation_date" : 1762359392,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140837811,
    "post_id" : 79809969,
    "body" : "That being said, the only way that code can throw a CCE is if somehow a Non-Integer found its way into the backing array. Have you tried looking into the backing array of <code>ArrayOrderedList</code> immedately before that throws with a debugger?",
    "score" : 0,
    "owner" : {
      "account_id" : 30223964,
      "reputation" : 252,
      "user_id" : 23162960,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2451acfac254a6fc75757ecf89d75f9a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jannik S.",
      "link" : "https://stackoverflow.com/users/23162960/jannik-s"
    },
    "creation_date" : 1762347708,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140837805,
    "post_id" : 79809969,
    "body" : "At a minimum we need the actual definitions of <code>OrderedListADT</code> and <code>ListADT</code> that you&#39;re using, plus what your main method actually looks like (As stated it will throw generics-related compiler errors with the passed comparator).",
    "score" : 1,
    "owner" : {
      "account_id" : 30223964,
      "reputation" : 252,
      "user_id" : 23162960,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2451acfac254a6fc75757ecf89d75f9a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jannik S.",
      "link" : "https://stackoverflow.com/users/23162960/jannik-s"
    },
    "creation_date" : 1762347557,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140837797,
    "post_id" : 79809969,
    "body" : "What assumptions u make to s&#243; i can correct, please be explicit. And the exception is caused by the lime off code who have this comment // The error occurs here.",
    "score" : 0,
    "owner" : {
      "account_id" : 23597695,
      "reputation" : 11,
      "user_id" : 17634642,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/OVsQC.jpg?s=256",
      "display_name" : "Raam",
      "link" : "https://stackoverflow.com/users/17634642/raam"
    },
    "creation_date" : 1762347391,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140837766,
    "post_id" : 79809969,
    "body" : "@Raam Sweeper does not get the exception because the posted code does <b>not</b> compile and he is forced to make assumptions to make it runnable. Same for me by the way, no exception after assumptions to compile and run.",
    "score" : 1,
    "owner" : {
      "account_id" : 23783500,
      "reputation" : 7109,
      "user_id" : 17795888,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Xay1V.jpg?s=256",
      "display_name" : "Chaosfire",
      "link" : "https://stackoverflow.com/users/17795888/chaosfire"
    },
    "creation_date" : 1762346501,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140837747,
    "post_id" : 79809969,
    "body" : "When searching <a href=\"https://faculty.washington.edu/moishe/javademos/jss2/ListADT.java\" rel=\"nofollow noreferrer\">ListADT</a> and <a href=\"https://faculty.washington.edu/moishe/javademos/jss2/OrderedListADT.java\" rel=\"nofollow noreferrer\">OrderedListADT</a>, I find those interfaces hosted by various universities. These should have been included in the question, please verify whether or not these match your version of <code>ListADT</code> and <code>OrderedListADT</code>.",
    "score" : 0,
    "owner" : {
      "account_id" : 14914414,
      "reputation" : 1185,
      "user_id" : 10808904,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Ts8fIsJj.png?s=256",
      "display_name" : "Xavier Pedraza",
      "link" : "https://stackoverflow.com/users/10808904/xavier-pedraza"
    },
    "creation_date" : 1762345811,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140837742,
    "post_id" : 79809969,
    "body" : "i put all the ArrayList code @Sweeper.  IDK how u dont get the exception.",
    "score" : 0,
    "owner" : {
      "account_id" : 23597695,
      "reputation" : 11,
      "user_id" : 17634642,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/OVsQC.jpg?s=256",
      "display_name" : "Raam",
      "link" : "https://stackoverflow.com/users/17634642/raam"
    },
    "creation_date" : 1762345524,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140837680,
    "post_id" : 79809969,
    "body" : "@XavierPedraza No, <code>T</code> doesn&#39;t have to be comparable. The array itself takes a <code>Comparator&lt;T&gt;</code> to compare the elements.",
    "score" : 0,
    "owner" : {
      "account_id" : 6651855,
      "reputation" : 292025,
      "user_id" : 5133585,
      "user_type" : "registered",
      "accept_rate" : 96,
      "profile_image" : "https://i.sstatic.net/dfqcw.png?s=256",
      "display_name" : "Sweeper",
      "link" : "https://stackoverflow.com/users/5133585/sweeper"
    },
    "creation_date" : 1762343632,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140837678,
    "post_id" : 79809969,
    "body" : "The code you showed does not compile. Even if we ignore undeclared things like <code>ListADT</code> and <code>expandCapacity</code>, and assume you meant to say <code>new ArrayOrderedList&lt;&gt;(Integer::compare);</code> in your main method, there are still no exceptions when I run the code.",
    "score" : 3,
    "owner" : {
      "account_id" : 6651855,
      "reputation" : 292025,
      "user_id" : 5133585,
      "user_type" : "registered",
      "accept_rate" : 96,
      "profile_image" : "https://i.sstatic.net/dfqcw.png?s=256",
      "display_name" : "Sweeper",
      "link" : "https://stackoverflow.com/users/5133585/sweeper"
    },
    "creation_date" : 1762343578,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140837668,
    "post_id" : 79809969,
    "body" : "This is a great application for some kind of <code>SortedSet</code> like a <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/TreeSet.html\" rel=\"nofollow noreferrer\">TreeSet</a>. I do not believe this is a well motivated exercise. Specifically, you are violating the contract of <code>List</code> which specifies that <code>add(T)</code> should add the element to the <i>end</i> of the list. Sets, on the other hand, do not give numerical indices to their elements and therefore do not have this issue.",
    "score" : 0,
    "owner" : {
      "account_id" : 14914414,
      "reputation" : 1185,
      "user_id" : 10808904,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Ts8fIsJj.png?s=256",
      "display_name" : "Xavier Pedraza",
      "link" : "https://stackoverflow.com/users/10808904/xavier-pedraza"
    },
    "creation_date" : 1762343343,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140837661,
    "post_id" : 79809969,
    "body" : "already done, thanks.",
    "score" : 0,
    "owner" : {
      "account_id" : 23597695,
      "reputation" : 11,
      "user_id" : 17634642,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/OVsQC.jpg?s=256",
      "display_name" : "Raam",
      "link" : "https://stackoverflow.com/users/17634642/raam"
    },
    "creation_date" : 1762343013,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140837652,
    "post_id" : 79809969,
    "body" : "Please show a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> demonstrating the <code>ClassCastException</code>.",
    "score" : 1,
    "owner" : {
      "account_id" : 6651855,
      "reputation" : 292025,
      "user_id" : 5133585,
      "user_type" : "registered",
      "accept_rate" : 96,
      "profile_image" : "https://i.sstatic.net/dfqcw.png?s=256",
      "display_name" : "Sweeper",
      "link" : "https://stackoverflow.com/users/5133585/sweeper"
    },
    "creation_date" : 1762342336,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}