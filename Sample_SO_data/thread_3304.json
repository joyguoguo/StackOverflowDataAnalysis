{
  "question" : {
    "question_id" : 79557444,
    "title" : "AspectJ @around a static initializer",
    "body" : "<p>I'm attempting to use a point cut of</p>\n<pre><code>@Around(&quot;staticinitialization(*)&quot;)\n</code></pre>\n<p>but when applying i get this error:</p>\n<p>[iajc] [error   4]: error at /home/dave/dev/coyote/projects/aspects/debug_src/com/acme/aspects/exceptions/StaticInitializerExceptions.java:15::443 around on staticinitialization of interface 'com.acme.intgservices.discussions.DiscussionListener' not supported (compiler limitation)</p>\n<p>Which of course makes sense. But is there a way to tell aspectj not to select interfaces? That seems like something it should do on its own?</p>\n",
    "tags" : [ "java", "annotations", "aspectj", "initializer", "pointcut" ],
    "owner" : {
      "account_id" : 35502,
      "reputation" : 28679,
      "user_id" : 100565,
      "user_type" : "registered",
      "accept_rate" : 59,
      "profile_image" : "https://www.gravatar.com/avatar/c35777e0d2751654391d03ccdf67edc4?s=256&d=identicon&r=PG",
      "display_name" : "MeBigFatGuy",
      "link" : "https://stackoverflow.com/users/100565/mebigfatguy"
    },
    "is_answered" : true,
    "view_count" : 68,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1743908204,
    "creation_date" : 1743882171,
    "link" : "https://stackoverflow.com/questions/79557444/aspectj-around-a-static-initializer",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79557755,
    "question_id" : 79557444,
    "body" : "<p>You need to use so-called <strong>type category type patterns</strong>. Unfortunately, they are undocumented in the regular <a href=\"https://eclipse.dev/aspectj/doc/latest/index.html\" rel=\"nofollow noreferrer\">AspectJ docs</a> such as Programming Guide, AspectJ 5 Developer's Notebook or the Quick Reference PDFs. But they are described in the <a href=\"https://eclipse.dev/aspectj/doc/latest/release/README-1.6.9.html#_type_category_type_patterns\" rel=\"nofollow noreferrer\">1.6.9 release notes</a> and an extension by one more category is mentioned in the <a href=\"https://eclipse.dev/aspectj/doc/latest/release/README-1.8.4.html#_support_for_isfinaltype\" rel=\"nofollow noreferrer\">1.8.4 release notes</a>.</p>\n<pre class=\"lang-java prettyprint-override\"><code>package de.scrum_master.stackoverflow.q79557444.app;\n\npublic interface Shape {\n  double getArea();\n  double getCircumference();\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>package de.scrum_master.stackoverflow.q79557444.app;\n\npublic class Circle implements Shape {\n  private double radius;\n\n  public Circle(double radius) {\n    this.radius = radius;\n  }\n\n  @Override\n  public double getArea() {\n    return Math.PI * radius * radius;\n  }\n\n  @Override\n  public double getCircumference() {\n    return 2 * Math.PI * radius;\n  }\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>package de.scrum_master.stackoverflow.q79557444.app;\n\npublic class Application {\n  public static void main(String[] args) {\n    Circle circle = new Circle(5);\n    System.out.println(circle.getArea());\n    System.out.println(circle.getCircumference());\n  }\n}\n</code></pre>\n<p>In your aspect, you need to exclude both interface types by <code>!is(InterfaceType))</code> and the aspect itself by <code>!within(MyAspect)</code> to avoid the aspect trying to weave into its own static initialiser, which would lead to a runtime error during aspect bootstrapping.</p>\n<pre class=\"lang-java prettyprint-override\"><code>package de.scrum_master.stackoverflow.q79557444.aspect;\n\nimport org.aspectj.lang.ProceedingJoinPoint;\nimport org.aspectj.lang.annotation.Around;\nimport org.aspectj.lang.annotation.Aspect;\n\n@Aspect\npublic class MyAspect {\n  @Around(&quot;staticinitialization(!is(InterfaceType)) &amp;&amp; !within(MyAspect)&quot;)\n  public Object myAdvice(ProceedingJoinPoint joinPoint) throws Throwable {\n    System.out.println(joinPoint);\n    return joinPoint.proceed();\n  }\n}\n</code></pre>\n<p>Console log:</p>\n<pre class=\"lang-none prettyprint-override\"><code>staticinitialization(de.scrum_master.stackoverflow.q79557444.app.Application.&lt;clinit&gt;)\nstaticinitialization(de.scrum_master.stackoverflow.q79557444.app.Circle.&lt;clinit&gt;)\n78.53981633974483\n31.41592653589793\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 1087271,
      "reputation" : 68569,
      "user_id" : 1082681,
      "user_type" : "registered",
      "accept_rate" : 90,
      "profile_image" : "https://i.sstatic.net/lDK9h.png?s=256",
      "display_name" : "kriegaex",
      "link" : "https://stackoverflow.com/users/1082681/kriegaex"
    },
    "creation_date" : 1743908204,
    "last_activity_date" : 1743908204,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140303643,
    "post_id" : 79557444,
    "body" : "there are thousands of interfaces across 100s of packages. Enumeration doesn&#39;t work in my case",
    "score" : 0,
    "owner" : {
      "account_id" : 35502,
      "reputation" : 28679,
      "user_id" : 100565,
      "user_type" : "registered",
      "accept_rate" : 59,
      "profile_image" : "https://www.gravatar.com/avatar/c35777e0d2751654391d03ccdf67edc4?s=256&d=identicon&r=PG",
      "display_name" : "MeBigFatGuy",
      "link" : "https://stackoverflow.com/users/100565/mebigfatguy"
    },
    "creation_date" : 1743894900,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140303554,
    "post_id" : 79557444,
    "body" : "If you know all your interfaces are in a certain package, you can exclude them with : @Around(&quot;staticinitialization(<i>) &amp;&amp; !within(com.your.interface.package..)&quot;)  You can also write multiple exclusions like: @Around(&quot;staticinitialization(</i>) &amp;&amp;           !within(com.your.interface.package.YourInterface1) &amp;&amp;           !within(com.your.interface2.package2.YourInterface2)&quot;)",
    "score" : 0,
    "owner" : {
      "account_id" : 7645025,
      "reputation" : 440,
      "user_id" : 5795975,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-6KwPUS4RnyA/AAAAAAAAAAI/AAAAAAAAC8w/auZqreI45x0/s256-rj/photo.jpg",
      "display_name" : "Vijay",
      "link" : "https://stackoverflow.com/users/5795975/vijay"
    },
    "creation_date" : 1743890392,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79557755" : [ {
      "comment_id" : 140304066,
      "post_id" : 79557755,
      "body" : "No, at least until JDK 24 no <code>static {}</code> blocks are permitted in interfaces. I think, an error message is instructive here, telling the user explicitly what is wrong. Then, she needs to fix it by excluding interfaced from matching as shown here.",
      "score" : 1,
      "owner" : {
        "account_id" : 1087271,
        "reputation" : 68569,
        "user_id" : 1082681,
        "user_type" : "registered",
        "accept_rate" : 90,
        "profile_image" : "https://i.sstatic.net/lDK9h.png?s=256",
        "display_name" : "kriegaex",
        "link" : "https://stackoverflow.com/users/1082681/kriegaex"
      },
      "creation_date" : 1743920523,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140303869,
      "post_id" : 79557755,
      "body" : "thanks that did work. Does a later jdk allow you to put class initializers on interfaces? Otherwise why not just not consider interfaces?",
      "score" : 0,
      "owner" : {
        "account_id" : 35502,
        "reputation" : 28679,
        "user_id" : 100565,
        "user_type" : "registered",
        "accept_rate" : 59,
        "profile_image" : "https://www.gravatar.com/avatar/c35777e0d2751654391d03ccdf67edc4?s=256&d=identicon&r=PG",
        "display_name" : "MeBigFatGuy",
        "link" : "https://stackoverflow.com/users/100565/mebigfatguy"
      },
      "creation_date" : 1743910603,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}