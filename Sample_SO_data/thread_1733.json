{
  "question" : {
    "question_id" : 79679787,
    "title" : "Xerces2-J error location accuracy: library vs Oxygen Editor",
    "body" : "<p>I am trying to determine if Oxygen XML Editor is using a customized version of Xerces-J parser or if there is a feature of the Xerces-J library I am not aware of.  The discrepancy is the location of a validation error, where Oxygen is spot-on on the location, while Xerces-J is giving a not-so exact location.</p>\n<p>Example XSD:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;xs:schema xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;\n  &lt;xs:element name=&quot;shiporder&quot;&gt;\n    &lt;xs:complexType&gt;\n      &lt;xs:sequence&gt;\n        &lt;xs:element name=&quot;orderperson&quot; type=&quot;xs:string&quot;/&gt;\n        &lt;xs:element name=&quot;shipto&quot;&gt;\n          &lt;xs:complexType&gt;\n            &lt;xs:sequence&gt;\n              &lt;xs:element name=&quot;name&quot; type=&quot;xs:string&quot;/&gt;\n              &lt;xs:element name=&quot;address&quot; type=&quot;xs:string&quot;/&gt;\n              &lt;xs:element name=&quot;city&quot; type=&quot;xs:string&quot;/&gt;\n              &lt;xs:element name=&quot;country&quot; type=&quot;xs:string&quot;/&gt;\n            &lt;/xs:sequence&gt;\n          &lt;/xs:complexType&gt;\n        &lt;/xs:element&gt;\n        &lt;xs:element name=&quot;item&quot; maxOccurs=&quot;unbounded&quot;&gt;\n          &lt;xs:complexType&gt;\n            &lt;xs:sequence&gt;\n              &lt;xs:element name=&quot;title&quot; type=&quot;xs:string&quot;/&gt;\n              &lt;xs:element name=&quot;note&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot;/&gt;\n              &lt;xs:element name=&quot;quantity&quot; type=&quot;xs:positiveInteger&quot;/&gt;\n              &lt;xs:element name=&quot;price&quot; type=&quot;xs:decimal&quot;/&gt;\n            &lt;/xs:sequence&gt;\n          &lt;/xs:complexType&gt;\n        &lt;/xs:element&gt;\n      &lt;/xs:sequence&gt;\n      &lt;xs:attribute name=&quot;orderid&quot; type=&quot;xs:string&quot; use=&quot;required&quot;/&gt;\n    &lt;/xs:complexType&gt;\n  &lt;/xs:element&gt;\n&lt;/xs:schema&gt;\n</code></pre>\n<p>XML Document:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;shiporder xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; orderid=&quot;889923&quot; xsi:noNamespaceSchemaLocation=&quot;shiporder.xsd&quot;&gt;\n  &lt;orderperson&gt;John Smith&lt;/orderperson&gt;\n  &lt;shipto&gt;--- Bogus Text ---\n    &lt;name&gt;Ola Nordmann&lt;/name&gt;\n    &lt;address&gt;Langgt 23&lt;/address&gt;\n    &lt;city&gt;4000 Stavanger&lt;/city&gt;\n    &lt;country&gt;Norway&lt;/country&gt;\n  &lt;/shipto&gt;\n  &lt;item&gt;\n    &lt;title&gt;Empire Burlesque&lt;/title&gt;\n    &lt;note&gt;Special Edition&lt;/note&gt;\n    &lt;quantity&gt;1&lt;/quantity&gt;\n    &lt;price&gt;10.90&lt;/price&gt;\n  &lt;/item&gt;\n  &lt;item&gt;\n    &lt;title&gt;Hide your heart&lt;/title&gt;\n    &lt;quantity&gt;1&lt;/quantity&gt;\n    &lt;price&gt;9.90&lt;/price&gt;\n  &lt;/item&gt;\n&lt;/shiporder&gt;\n</code></pre>\n<p>When I execute schema validation using jaxp.SourceValidator sample of the Xerces-J 2.12.2 distribution, I get the following:</p>\n<pre><code>[Error] doc.xml:9:12: cvc-complex-type.2.3: Element 'shipto' cannot have character [children], because the type's content type is element-only.\n</code></pre>\n<p>The type of failure is correct, but the location is on the end tag of 'shipto', line 9, column 12.</p>\n<p>When I load the same document in Oxygen Editor, I get the following location information (copied from their error dialog):</p>\n<pre><code>Start location: line: 4, column: 11\nEnd location:   line: 4, column: 29\n</code></pre>\n<p>Where the engine is identified by Oxygen as Xerces.  The location information is spot-on, and I would like to get such information from the Xerces-J library.  Is this possible, or is Oxygen using a customized version of &quot;Xerces&quot;, where such granular location information is not possible with the stock Xerces-J library?</p>\n",
    "tags" : [ "java", "xml", "oxygenxml", "xerces2-j" ],
    "owner" : {
      "account_id" : 42124569,
      "reputation" : 105,
      "user_id" : 30604023,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e748f39a58e540552038c612ad0245f1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "ewh.eps",
      "link" : "https://stackoverflow.com/users/30604023/ewh-eps"
    },
    "is_answered" : true,
    "view_count" : 58,
    "answer_count" : 2,
    "score" : 1,
    "last_activity_date" : 1751034221,
    "creation_date" : 1750897506,
    "link" : "https://stackoverflow.com/questions/79679787/xerces2-j-error-location-accuracy-library-vs-oxygen-editor",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79681770,
    "question_id" : 79679787,
    "body" : "<p>I work for Oxygen and I confirm we worked in time to change and refine the ways in which we highlight problems based on the Xerces validation.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1111287,
      "reputation" : 1934,
      "user_id" : 1101698,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/OPo9gN18.jpg?s=256",
      "display_name" : "Radu Coravu",
      "link" : "https://stackoverflow.com/users/1101698/radu-coravu"
    },
    "creation_date" : 1751019390,
    "last_activity_date" : 1751019390,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79682075,
    "question_id" : 79679787,
    "body" : "<p>Oxygen uses a customized patched version of Xerces and you can't get the same pinpoint error location from the standard Xerces-J library easily. The precise error location is a result of Oxygen's own architecture which builds a more rich location-aware model of the document than a standard parser does by default.</p>\n<p><strong>Xerces</strong> parser with standart SAX-based pipeline reads your file as a stream. It only confirms the <code>&lt;shipto&gt;</code> element is invalid when it reaches the end tag <code>&lt;/shipto&gt;</code>. So it reports the error at its current location: the end tag (line 9, column 12).</p>\n<p>But <strong>Oxygen</strong> first builds its own much more detailed internal data model of your document, including recording the exact start/end position of every single element. This internal model is far than a standard DOM tree. Oxygen catches Xerces's <code>SAXParseException</code> and instead of just printing its limited Locator data, Oxygen uses its own pre-built map to find and shows the precise location of the illegal text. (It knows it starts at line 4, column 11 and ends at line 4, column 29).</p>\n<h3>Replicating Oxygen's behavior with stock Xerces</h3>\n<p>It requires more work than simply calling a validator. You'd essentially have to use Oxygen's approach but on a smaller scale.</p>\n<p>The standard <code>ErrorHandler</code> interface in JAXP gives you a <code>SAXParseException</code> which contains the <code>getLineNumber()</code> and <code>getColumnNumber()</code> methods. But this's not enough for this type of error. To get more precise locations you'd need to:</p>\n<ol>\n<li><p><strong>Build a location-aware DOM:</strong> first parse the XML into a DOM tree. While parsing use a mechanism to attach location information to each DOM node with <code>setUserData</code> method on DOM nodes. And you can create a simple <code>LocationData</code> class to store start/end line/column numbers</p>\n</li>\n<li><p><strong>Validate the DOM:</strong> once you have your location-annotated DOM tree you validate it using a <code>javax.xml.validation.Validator</code> and a <code>javax.xml.transform.dom.DOMSource</code></p>\n</li>\n<li><p><strong>Correlate errors:</strong> in your custom <code>ErrorHandler</code> when you catch a <code>SAXParseException</code>, the error message will still tell you which element is at fault (<code>&quot;shipto&quot;</code>). You can then find that node in your annotated DOM tree and retrieve the precise location data for the offending child (in this case, the <code>Node.TEXT_NODE</code> child of the <code>&lt;shipto&gt;</code> element)</p>\n</li>\n</ol>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 1207862,
      "reputation" : 4210,
      "user_id" : 1177031,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/79eaae35b3331731ecfb9e360bb8380b?s=256&d=identicon&r=PG",
      "display_name" : "kapandron",
      "link" : "https://stackoverflow.com/users/1177031/kapandron"
    },
    "creation_date" : 1751032850,
    "last_activity_date" : 1751034221,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140546814,
    "post_id" : 79679787,
    "body" : "They wouldn&#39;t necessarily need to &quot;modify core parsing code&quot;, only to filter the input stream that Xerces uses to keep track of the current position.",
    "score" : 0,
    "owner" : {
      "account_id" : 529122,
      "reputation" : 164963,
      "user_id" : 415448,
      "user_type" : "registered",
      "accept_rate" : 33,
      "profile_image" : "https://i.sstatic.net/P2vVZ.png?s=256",
      "display_name" : "Michael Kay",
      "link" : "https://stackoverflow.com/users/415448/michael-kay"
    },
    "creation_date" : 1751017800,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140545079,
    "post_id" : 79679787,
    "body" : "I speculated that Oxygen likely has a modified version of Xerces due to the existence of a &quot;patch&quot; jar in its installation files.  They would have had to modify core parsing code to inject more robust location information, so when the editor says &quot;Xerces&quot; as the engine, it is customized and not the original distribution provided by Apache.",
    "score" : 0,
    "owner" : {
      "account_id" : 42124569,
      "reputation" : 105,
      "user_id" : 30604023,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e748f39a58e540552038c612ad0245f1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "ewh.eps",
      "link" : "https://stackoverflow.com/users/30604023/ewh-eps"
    },
    "creation_date" : 1750956144,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140544921,
    "post_id" : 79679787,
    "body" : "I can&#39;t give you a definitive answer, but I believe that Oxygen has additional location information beyond what Xerces provides. It needs this to render the document accurately, for example with newlines between attributes.",
    "score" : 1,
    "owner" : {
      "account_id" : 529122,
      "reputation" : 164963,
      "user_id" : 415448,
      "user_type" : "registered",
      "accept_rate" : 33,
      "profile_image" : "https://i.sstatic.net/P2vVZ.png?s=256",
      "display_name" : "Michael Kay",
      "link" : "https://stackoverflow.com/users/415448/michael-kay"
    },
    "creation_date" : 1750952976,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79682075" : [ {
      "comment_id" : 140548905,
      "post_id" : 79682075,
      "body" : "Great response.  I already attach location information on the initial SAX parse for each element and text node using Xerces XMLLocator.  This allows me to have access to line, column, and character offset of each node, but it looks like more can be done based on your response.  Will need to take some to digest things and see if I can achieve something similar to what Oxygen does.",
      "score" : 0,
      "owner" : {
        "account_id" : 42124569,
        "reputation" : 105,
        "user_id" : 30604023,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/e748f39a58e540552038c612ad0245f1?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "ewh.eps",
        "link" : "https://stackoverflow.com/users/30604023/ewh-eps"
      },
      "creation_date" : 1751090685,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}