{
  "question" : {
    "question_id" : 79772182,
    "title" : "Difference between -XX:MaxPermSize=size and -XX:MaxMetaspaceSize=size options in terms of memory settings",
    "body" : "<p>Initially, I got an error:</p>\n<blockquote>\n<p>Unrecognized VM option 'MaxPermSize=1024m'</p>\n</blockquote>\n<p>From <code>gradle.properties</code>:</p>\n<pre><code>org.gradle.jvmargs=-Xmx4096m -XX:MaxPermSize=1024m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8\n</code></pre>\n<p>I defined this configuration a long time ago to suppress out-of-memory issues.</p>\n<hr />\n<p>Because I was confused and found this strange, I decided to research it. Then, I came across this thread:</p>\n<ul>\n<li><a href=\"https://stackoverflow.com/q/47112412/14041392\">Unrecognized VM option 'MaxPermSize=512m' when running Zeppelin</a></li>\n</ul>\n<p>Although it's somewhat different from my case, it's still relevant.</p>\n<hr />\n<p>According to the highest-scoring answer (as of this writing):</p>\n<blockquote>\n<p>If anyone still getting this renaming MaxPermSize to MaxMetaspaceSize fixed the issue on my part, migrated from gradle7.2 to gradle8 with jdk11 previously, now on jdk17</p>\n</blockquote>\n<p>Of course, I didn't immediately apply the suggestion; I read further until I found a credible source to confirm it.</p>\n<p>Then I found this other question thread:</p>\n<ul>\n<li><a href=\"https://forums.oracle.com/ords/apexds/post/getting-the-error-message-unrecognized-vm-option-maxpermsiz-8238\" rel=\"nofollow noreferrer\">getting the error message &quot;Unrecognized VM option 'MaxPermSize=512m'&quot;</a></li>\n</ul>\n<p>With an answer, which I'll also quote:</p>\n<blockquote>\n<p>Starting OpenJDK17 these java options ‘-XX:MaxPermSize=256m' have been\nremoved and using them results in an error. need to removed\n‘-XX:MaxPermSize=512m' in java option and replace with\n'-XX:MaxMetaspaceSize=512m’.</p>\n<p>Sources: <a href=\"https://docs.oracle.com/en/java/javase/17/docs/specs/man/java.html#removed-java-options\" rel=\"nofollow noreferrer\">Removed Java\nOptions</a></p>\n</blockquote>\n<p>I've decided to make this transparent due to its critical details:</p>\n<blockquote>\n<p>These java options have been removed in JDK 17 and using them results in an error of:</p>\n<p><code>-XX:MaxPermSize=size</code></p>\n<p>Sets the maximum permanent generation space size (in bytes). This option was deprecated in JDK 8 and superseded by the <code>-XX:MaxMetaspaceSize</code> option.</p>\n</blockquote>\n",
    "tags" : [ "java", "android" ],
    "owner" : {
      "account_id" : 19216794,
      "reputation" : 1924,
      "user_id" : 14041392,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/cyAcxGgY.jpg?s=256",
      "display_name" : "DevQt",
      "link" : "https://stackoverflow.com/users/14041392/devqt"
    },
    "is_answered" : true,
    "view_count" : 199,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1758651382,
    "creation_date" : 1758597522,
    "link" : "https://stackoverflow.com/questions/79772182/difference-between-xxmaxpermsize-size-and-xxmaxmetaspacesize-size-options-in",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79772475,
    "question_id" : 79772182,
    "body" : "<blockquote>\n<p>What is the difference between <code>-XX:MaxPermSize</code> and <code>-XX:MaxMetaspaceSize</code> options in terms of memory settings?</p>\n</blockquote>\n<p>The difference between <code>-XX:MaxPermSize</code> and <code>-XX:MaxMetaspaceSize</code> is largely moot.</p>\n<ul>\n<li><code>-XX:MaxPermSize</code> was for sizing the old &quot;permanent generation&quot; (PermGen) heap. This was removed in Java 8.</li>\n<li><code>XX:MaxMetaspaceSize</code> is for sizing the new &quot;Metaspace&quot; off-heap memory space that is used by the JVM to hold class metadata and other things.</li>\n<li>These are / were different memory management systems with <em>partially</em> overlapping use.  For example, &quot;interned&quot; strings were held in PermGen but they are NOT held in Metaspace.</li>\n</ul>\n<p>There is no direct conversion from a <code>-XX:MaxPermSize</code> value to a <code>-XX:MaxMetaspaceSize</code> value.</p>\n<p>However, as a rule of thumb it is reasonable to simply remove the old option and see what happens.  The default for <code>-XX:MaxMetaspaceSize</code> is effectively unlimited. You should only use this option if you need to <em>restrict</em> your JVM's off-heap memory usage.</p>\n<hr />\n<p>If you are getting error messages saying &quot;Unrecognized VM option 'MaxPermSize'&quot; that is because you (or the application that you are running) is attempting to configure the PermGen heap on JVM that doesn't support this anymore.  The fix will depend on what is setting the options.  For example:</p>\n<ul>\n<li>change the JVM options (e.g. in configs, scripts, etc), or</li>\n<li>make sure that you are using compatible versions of the relevant tools.</li>\n</ul>\n<p>For example, if this occurs in a build, check that the version of Maven or Gradle you are using is compatible with the version of Java that is being used to <em>run</em> the build.</p>\n<hr />\n<p>You commented:</p>\n<blockquote>\n<p>I defined it a long time ago to suppress out-of-memory issues.</p>\n</blockquote>\n<p>Well it depends on what those OOM issues <em>were actually due to</em>, and whether it is still an issue.  Setting <code>-XX:MaxMetaspaceSize</code> is unlikely to help for OOME's, but it might help if the problem is that your JVM is being killed by the OS's OOM killer ... cos' it is triggering excessive virtual memory paging.</p>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 47283,
      "reputation" : 723428,
      "user_id" : 139985,
      "user_type" : "registered",
      "accept_rate" : 69,
      "profile_image" : "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=256&d=identicon&r=PG",
      "display_name" : "Stephen C",
      "link" : "https://stackoverflow.com/users/139985/stephen-c"
    },
    "creation_date" : 1758623502,
    "last_activity_date" : 1758632935,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79772183,
    "question_id" : 79772182,
    "body" : "<p>Right after this <a href=\"https://docs.oracle.com/en/java/javase/17/docs/specs/man/java.html#removed-java-options\" rel=\"nofollow noreferrer\">documentation section</a>:</p>\n<h3><code>-XX:MaxMetaspaceSize=size</code> option</h3>\n<h4>Advanced Garbage Collection Options for Java</h4>\n<blockquote>\n<p><code>-XX:MaxMetaspaceSize=size</code></p>\n<p>Sets the maximum amount of native memory that can be allocated for class metadata. By default, the size isn't limited. The amount of metadata for an application depends on the application itself, other running applications, and the amount of memory available on the system.</p>\n<p>The following example shows how to set the maximum class metadata size to 256 MB:</p>\n<p><code>-XX:MaxMetaspaceSize=256m</code></p>\n</blockquote>\n<hr />\n<p>In contrast, according to this <a href=\"https://docs.oracle.com/cd/E74363_01/ohi_vbp_-_installation_guide--20160224-094432-html-chunked/s66.html\" rel=\"nofollow noreferrer\">documentation</a>:</p>\n<h3><code>-XX:MaxPermSize=size</code> option</h3>\n<div class=\"s-table-container\"><table class=\"s-table\">\n<thead>\n<tr>\n<th>Setting</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>-XX:MaxPermSize</td>\n<td>Maximum size of the permanent generation.</td>\n</tr>\n</tbody>\n</table></div>\n<blockquote>\n<p>The maximum perm size should be set to 1024 Megabytes.</p>\n</blockquote>\n<p>In addition, according to this documentation: <a href=\"https://www.oracle.com/java/technologies/javase/gc-tuning-6.html\" rel=\"nofollow noreferrer\">Java SE 6 HotSpot[tm] Virtual Machine Garbage Collection Tuning</a></p>\n<blockquote>\n<p>Permanent Generation Size</p>\n<p>The permanent generation does not have a noticeable impact on garbage collector performance for most applications. However, some applications dynamically generate and load many classes; for example, some implementations of JavaServer Pages (JSP) pages. These applications may need a larger permanent generation to hold the additional classes. If so, the maximum permanent generation size can be increased with the command-line option <code>-XX:MaxPermSize=&lt;N&gt;</code>.</p>\n</blockquote>\n<p>For a relevant read, see: <a href=\"https://stackoverflow.com/q/12114174/14041392\">What does -XX:MaxPermSize do?</a></p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 19216794,
      "reputation" : 1924,
      "user_id" : 14041392,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/cyAcxGgY.jpg?s=256",
      "display_name" : "DevQt",
      "link" : "https://stackoverflow.com/users/14041392/devqt"
    },
    "creation_date" : 1758597522,
    "last_activity_date" : 1758598779,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140754088,
    "post_id" : 79772182,
    "body" : "@StephenC, for clarity, see my latest updates on my question.",
    "score" : 0,
    "owner" : {
      "account_id" : 19216794,
      "reputation" : 1924,
      "user_id" : 14041392,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/cyAcxGgY.jpg?s=256",
      "display_name" : "DevQt",
      "link" : "https://stackoverflow.com/users/14041392/devqt"
    },
    "creation_date" : 1758621606,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140754079,
    "post_id" : 79772182,
    "body" : "@StephenC, I defined it a long time ago to suppress out-of-memory issues.",
    "score" : 0,
    "owner" : {
      "account_id" : 19216794,
      "reputation" : 1924,
      "user_id" : 14041392,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/cyAcxGgY.jpg?s=256",
      "display_name" : "DevQt",
      "link" : "https://stackoverflow.com/users/14041392/devqt"
    },
    "creation_date" : 1758621427,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140754063,
    "post_id" : 79772182,
    "body" : "@StephenC, my intention is just to share the difference between <code>-XX:MaxPermSize=size</code> and <code>-XX:MaxMetaspaceSize=size</code> options in terms of memory settings. I answered this by quoting from the documentation. Feel free to include your own clarification if you find it necessary to add to this thread. In terms of actual application and implementation of the two, I have no established knowledge about them.",
    "score" : 0,
    "owner" : {
      "account_id" : 19216794,
      "reputation" : 1924,
      "user_id" : 14041392,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/cyAcxGgY.jpg?s=256",
      "display_name" : "DevQt",
      "link" : "https://stackoverflow.com/users/14041392/devqt"
    },
    "creation_date" : 1758621202,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140754045,
    "post_id" : 79772182,
    "body" : "You haven&#39;t explained what you are doing ... so we can&#39;t explain how fix the options ... for your use-case.",
    "score" : 0,
    "owner" : {
      "account_id" : 47283,
      "reputation" : 723428,
      "user_id" : 139985,
      "user_type" : "registered",
      "accept_rate" : 69,
      "profile_image" : "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=256&d=identicon&r=PG",
      "display_name" : "Stephen C",
      "link" : "https://stackoverflow.com/users/139985/stephen-c"
    },
    "creation_date" : 1758620734,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79772475" : [ {
      "comment_id" : 140756415,
      "post_id" : 79772475,
      "body" : "I&#39;ll conduct some research on that in the future, including a demo with visuals and testing to see how it handles garbage collection. I mean, I&#39;ll look for any relevant ways for me to completely understand that matter. To be honest, I need to re-learn the fundamentals of Java garbage collection to fully understand it, as I can&#39;t relate to some of the other concepts.",
      "score" : 0,
      "owner" : {
        "account_id" : 19216794,
        "reputation" : 1924,
        "user_id" : 14041392,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/cyAcxGgY.jpg?s=256",
        "display_name" : "DevQt",
        "link" : "https://stackoverflow.com/users/14041392/devqt"
      },
      "creation_date" : 1758704363,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140756381,
      "post_id" : 79772475,
      "body" : "@DevQt Depending on what the <b>specific</b> problem was before (i.e. that caused you to set MaxPermSize) you may <i>never</i> observe the the effect of setting MaxMetaspaceSize.  Some things that used to go into the permgen heap don&#39;t go into metaspace.",
      "score" : 0,
      "owner" : {
        "account_id" : 47283,
        "reputation" : 723428,
        "user_id" : 139985,
        "user_type" : "registered",
        "accept_rate" : 69,
        "profile_image" : "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=256&d=identicon&r=PG",
        "display_name" : "Stephen C",
        "link" : "https://stackoverflow.com/users/139985/stephen-c"
      },
      "creation_date" : 1758703406,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140755830,
      "post_id" : 79772475,
      "body" : "Please give me enough time to validate your answer through an actual interaction of this case. I&#39;ll get back to you once I&#39;ve evaluated this thing. However, it&#39;s interesting that you&#39;ve answered it so well, just as the documentation describes. The only thing I was concerned about is that I cannot see it in action yet.",
      "score" : 0,
      "owner" : {
        "account_id" : 19216794,
        "reputation" : 1924,
        "user_id" : 14041392,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/cyAcxGgY.jpg?s=256",
        "display_name" : "DevQt",
        "link" : "https://stackoverflow.com/users/14041392/devqt"
      },
      "creation_date" : 1758677563,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}