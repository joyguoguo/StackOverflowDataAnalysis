{
  "question" : {
    "question_id" : 79541326,
    "title" : "Confusing behavior of a capturing group in a positive lookbehind in a Java regex with Pattern.matcher",
    "body" : "<p>The following issue is observed only on Java and not on other regex flavors (e.g PCRE).</p>\n<p>I have the following regex: <code>(?:(?&lt;=([A-Za-z\\d]))|\\b)(MyString)</code>. There's a capturing group on <code>[A-Za-z\\d]</code> in the lookbehind.</p>\n<p>And I'm trying to match (through <code>Pattern.matcher(regex)</code>; to be precise, I'm calling <code>replaceAll</code>) the following string: <code>string.MyString</code>.</p>\n<p>On PCRE, I will match <code>MyString</code>, and it will be the second group in the match. On Java, however, I will match the <code>g</code> in <code>string</code> as group 1, and <code>MyString</code> as group 2.</p>\n<ol>\n<li>Why does Java do that? To me this regex implies that a character matching <code>[A-Za-z\\d]</code> should only be matched if it directly precedes <code>MyString</code>, which is not the case here.</li>\n<li>How can I avoid that and not match this <code>g</code>? I want to keep the capturing group in case I have to match a string like <code>stringMyString</code>, in which case I do need that <code>g</code> as group 1.</li>\n</ol>\n",
    "tags" : [ "java", "regex", "regex-lookarounds" ],
    "owner" : {
      "account_id" : 10494313,
      "reputation" : 335,
      "user_id" : 7735110,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/005af1f6060f1fe3bc3a87298329ff9f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "wouldnotliketo",
      "link" : "https://stackoverflow.com/users/7735110/wouldnotliketo"
    },
    "is_answered" : true,
    "view_count" : 66,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1743167062,
    "creation_date" : 1743162005,
    "link" : "https://stackoverflow.com/questions/79541326/confusing-behavior-of-a-capturing-group-in-a-positive-lookbehind-in-a-java-regex",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79541424,
    "question_id" : 79541326,
    "body" : "<p>There is a line on the <a href=\"https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/regex/Pattern.html\" rel=\"nofollow noreferrer\">java.util.regex.Pattern docs</a></p>\n<blockquote>\n<p>The captured input associated with a group is always the subsequence that the group most recently matched. If a group is evaluated a second time because of quantification then its previously-captured value, if any, will be retained if the second evaluation fails. Matching the string &quot;aba&quot; against the expression (a(b)?)+, for example, leaves group two set to &quot;b&quot;. All captured input is discarded at the beginning of each match.</p>\n</blockquote>\n<p>I think this line explains the behavior:</p>\n<ul>\n<li>If a group is evaluated a second time because of quantification then its previously-captured value, if any, will be retained if the second evaluation fails.</li>\n</ul>\n<p>The last line:</p>\n<ul>\n<li>All captured input is discarded at the beginning of each match.</li>\n</ul>\n<p>So if you have this string:</p>\n<pre><code>string.MyString.srting.MyString\n</code></pre>\n<p>And this regex:</p>\n<pre><code>(?:(?&lt;=([tr]))|\\b)(MyString)\n</code></pre>\n<p>You can see that the group 1 value is different in both matches as all captured input is discarded.</p>\n<p>See an example on <a href=\"https://regex101.com/r/sUsT9Y/1\" rel=\"nofollow noreferrer\">regex101</a></p>\n",
    "score" : 5,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 7089168,
      "reputation" : 164755,
      "user_id" : 5424988,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/26fnQYyM.webp?s=256",
      "display_name" : "The fourth bird",
      "link" : "https://stackoverflow.com/users/5424988/the-fourth-bird"
    },
    "creation_date" : 1743164827,
    "last_activity_date" : 1743167062,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140273578,
    "post_id" : 79541326,
    "body" : "Looks like the Java regex engine does not reset Group 1 contents upon a failed match and once the match is found, the submatch is returned with the match. Looks like a bug to me, but it is probably related to regex specific Java functions.",
    "score" : 0,
    "owner" : {
      "account_id" : 4739783,
      "reputation" : 630987,
      "user_id" : 3832970,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/IFOp5.jpg?s=256",
      "display_name" : "Wiktor Stribi≈ºew",
      "link" : "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"
    },
    "creation_date" : 1743162861,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}