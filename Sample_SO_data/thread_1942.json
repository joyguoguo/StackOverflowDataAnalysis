{
  "question" : {
    "question_id" : 79661941,
    "title" : "Serialising OpenAPI examples loses the type information of the request",
    "body" : "<p>I have a polymorphic request type, <code>CreateRequest</code>:</p>\n<pre><code>@JsonTypeInfo(\n        use = JsonTypeInfo.Id.CUSTOM,\n        include = JsonTypeInfo.As.PROPERTY,\n        property = &quot;@type&quot;)\n@JsonTypeIdResolver(SimpleNameIdResolver.class)\npublic abstract class CreateRequest {\n    ...\n}\n</code></pre>\n<p>It has two subtypes, <code>CreateFooRequest</code> and <code>CreateBarRequest</code>. <code>SimpleNameIdResolver</code> is effectively implementing <code>JsonTypeInfo.Id.SIMPLE_NAME</code> (I'm unable to upgrade the jackson version right now).</p>\n<p>I'm writing examples of these request types to an OpenAPI specification using springdoc (<code>org.springdoc:springdoc-openapi-ui:1.8.0</code>):</p>\n<pre><code>    @Override\n    public void customise(OpenAPI openApi) {\n        openApi.getComponents()\n                .addExamples(&quot;createFooRequestExample&quot;, createFooRequestExample())\n    ...\n\n\n    private Example createFooRequestExample() {\n        return new Example()\n                .summary(&quot;Create a Foo&quot;)\n                .value(fooExample());\n    }\n</code></pre>\n<p>I configure the examples in code because I want them 'strongly typed', i.e. I don't want to have to manage JSON myself.</p>\n<p>However, If I autowire the ObjectMapper into this customiser, and serialise</p>\n<ul>\n<li>the Example (returned by <code>createFooRequestExample()</code>)</li>\n<li>the CreateFooRequest (returned by <code>fooExample()</code>)</li>\n</ul>\n<p>I get different output from serialisation.</p>\n<p>From the first:</p>\n<pre><code>{\n  &quot;summary&quot; : &quot;Create a Foo&quot;,\n  &quot;value&quot; : {\n    &quot;name&quot; : &quot;New year's resolutions&quot;,\n    ...\n</code></pre>\n<p>from the second:</p>\n<pre><code>{\n  &quot;@type&quot; : &quot;CreateFooRequest&quot;,\n  &quot;name&quot; : &quot;New year's resolutions&quot;,\n  ...\n</code></pre>\n<p>Why am I losing the <code>@type</code> when serialising the Example that wraps the request? I thought it might be because <code>io.swagger.v3.oas.models.examples.Example#value</code> is declared as <code>java.lang.Object</code>, but if I try to replicate that by casting <code>fooExample()</code> to Object (which shouldn't <em>do</em> anything):</p>\n<pre><code>objectMapper.writerWithDefaultPrettyPrinter().writeValueAsString((Object) fooExample())\n</code></pre>\n<p>I still get the <code>@type</code> in the JSON. But once it's wrapped in an <code>Example</code>, it stops working.</p>\n<p>This is doubly confusing because the <code>FooRequest</code> itself has a polymorphic field, whose polymorphism is managed the same way:</p>\n<pre><code>private List&lt;Rule&gt; rules;\n\n...\n\n@JsonTypeInfo(\n        use = JsonTypeInfo.Id.CUSTOM,\n        include = JsonTypeInfo.As.PROPERTY,\n        property = &quot;@type&quot;)\n@JsonTypeIdResolver(SimpleNameIdResolver.class)\npublic abstract class Rule {\n}\n</code></pre>\n<p>and each item in the array is correctly serialised to include its own <code>@type</code>, irrespective which of the above calls is made.</p>\n<pre><code>  &quot;rules&quot; : [ {\n    &quot;@type&quot; : &quot;BarRule&quot;,\n    ...\n  } ],\n</code></pre>\n",
    "tags" : [ "java", "jackson", "springdoc" ],
    "owner" : {
      "account_id" : 4360446,
      "reputation" : 1980,
      "user_id" : 3557714,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/dca1b60d2a69bc389eac206a844b448d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Ben R.",
      "link" : "https://stackoverflow.com/users/3557714/ben-r"
    },
    "is_answered" : false,
    "view_count" : 46,
    "answer_count" : 0,
    "score" : 3,
    "last_activity_date" : 1749643217,
    "creation_date" : 1749643217,
    "link" : "https://stackoverflow.com/questions/79661941/serialising-openapi-examples-loses-the-type-information-of-the-request",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}