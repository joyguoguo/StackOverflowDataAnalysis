{
  "question" : {
    "question_id" : 79567159,
    "title" : "How Jakarta Priority Annotation works when using Mappers and ContextFilters in Quarkus 3?",
    "body" : "<p>I have a Quarkus 3 application that has a few endpoints. Every endpoint receive a request and return the response of a rest client service. I have an ResponseExceptionMapper that handles the responses with status code higher or equal 400.\nNow I implemented a kafka filter that implements ClientRequestFilter and ClientResponseFilter to send the rest client request information to a kafka topic.</p>\n<p>So the rest client service is annotated with two @RegisterProvider() annotation. One for the Mapper and one for the filter.</p>\n<p>Initially, to be certain the filter would be called before the handler, I used the Priority jakarta annotation in both of them with the filter being lower and the mapper higher, as stated in quarkus documentation:</p>\n<blockquote>\n<p>ResponseExceptionMapper also defines the getPriority method which is used in order to determine the priority with which ResponseExceptionMapper implementations will be called (implementations with a lower value for getPriority will be invoked first).</p>\n</blockquote>\n<p>Unexpectedly, when the rest client request returns a status code higher than 400, the handler now is called every time while the filter is never called. When I inverted and set the mapper to have the lower priority, it actually didn't change anything and the filter was never called. When I removed the priority annotation from them it worked.</p>\n<p>I ran some other tests and could note that even when I set both of the priorities to be the same, it doesn't call the filter anymore. Actually, the only thing that worked when using priorities was to set the mapper to have a very high value of priority such as 10.000.000 and the filter to something small like 1.</p>\n<p>So I was wondering why does Priority messes up with the order call independent of the scenario. How does it actually work?</p>\n",
    "tags" : [ "java", "jakarta-ee", "quarkus", "priority-queue", "quarkus-rest-client" ],
    "owner" : {
      "account_id" : 15628968,
      "reputation" : 1,
      "user_id" : 11275778,
      "user_type" : "registered",
      "profile_image" : "https://lh5.googleusercontent.com/-TDBaSAyi-I4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfeV-ZsO5ot52xanxzSCqOQieIapA/mo/s256-rj/photo.jpg",
      "display_name" : "Pedro Henrique",
      "link" : "https://stackoverflow.com/users/11275778/pedro-henrique"
    },
    "is_answered" : false,
    "view_count" : 167,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1744306002,
    "creation_date" : 1744302299,
    "link" : "https://stackoverflow.com/questions/79567159/how-jakarta-priority-annotation-works-when-using-mappers-and-contextfilters-in-q",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}