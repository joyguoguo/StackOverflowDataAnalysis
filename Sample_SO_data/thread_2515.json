{
  "question" : {
    "question_id" : 79615252,
    "title" : "Spring Data Redis Repository Function delete...By not working?",
    "body" : "<p>I am using spring-data-redis (version 3.5.0-M2).</p>\n<p>This is my entity class:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@RedisHash(&quot;Embedding&quot;)\n@Data\n@NoArgsConstructor\n@AllArgsConstructor\npublic class Embedding {\n\n    @Id\n    private String id;\n\n    private byte[] embedding;\n    private String text;\n    private int segmentIndex;\n\n    @Indexed\n    private String fileName;\n\n    private Instant createTs;\n\n    @Transient\n    private Double score;\n\n    public Embedding(float[] embedding, String text, int segmentIndex, String fileName) {\n        this.embedding = RedisConversionUtil.floatsToBytes(embedding);\n        this.text = text;\n        this.segmentIndex = segmentIndex;\n        this.fileName = fileName;\n        this.createTs = Instant.now();\n    }\n\n    public float[] getEmbedding() {\n        return RedisConversionUtil.bytesToFloats(embedding);\n    }\n\n    public byte[] getRawEmbedding() {\n        return embedding;\n    }\n}\n</code></pre>\n<p>This is my repository class:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public interface EmbeddingRepository extends ListCrudRepository&lt;Embedding, String&gt;, CustomEmbeddingRepository {\n    \n    void deleteAllByFileName(String fileName);\n}\n</code></pre>\n<p>The problem is that <code>deleteAllByFileName()</code> method is not doing anything when executed (<code>deleteAll()</code> works although). I referred to the spring documentation <a href=\"https://docs.spring.io/spring-data/redis/reference/repositories/query-keywords-reference.html\" rel=\"nofollow noreferrer\">here</a>. In table 1, <code>delete…By()</code> is mentioned to be supported. What am I missing here?</p>\n",
    "tags" : [ "java", "spring", "spring-boot", "redis", "spring-data-redis" ],
    "owner" : {
      "account_id" : 11897765,
      "reputation" : 127,
      "user_id" : 11590978,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-IJJbvC55vIM/AAAAAAAAAAI/AAAAAAAAAWo/5Nc8QuNpkbU/s256-rj/photo.jpg",
      "display_name" : "Akshit Bansal",
      "link" : "https://stackoverflow.com/users/11590978/akshit-bansal"
    },
    "is_answered" : false,
    "view_count" : 98,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1747027534,
    "creation_date" : 1746861320,
    "link" : "https://stackoverflow.com/questions/79615252/spring-data-redis-repository-function-delete-by-not-working",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79615274,
    "question_id" : 79615252,
    "body" : "<p>Try replacing the call with an explicit <code>find</code> + <code>deleteAll</code>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>List&lt;Embedding&gt; embeddings = repository.findAllByFileName(fileName);\nlog.info(&quot;Deleting {} Embedding objects with fileName={}&quot;, embeddings.size(), fileName);\nrepository.deleteAll(embeddings);\n</code></pre>\n<p><strong>Why?</strong></p>\n<p><em>Spring Data Redis</em> retrieves IDs via the <code>@Indexed</code> field and then deletes by those IDs — if the index is broken, outdated, or <em>Redis</em> fails to deserialize the objects, the deletion may silently do nothing. An explicit <code>find</code> → <code>deleteAll</code> is <strong>easier</strong> to debug and log.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 41826862,
      "reputation" : 1,
      "user_id" : 30467325,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/6HKsSPDB.jpg?s=256",
      "display_name" : "tsusahi",
      "link" : "https://stackoverflow.com/users/30467325/tsusahi"
    },
    "creation_date" : 1746863209,
    "last_activity_date" : 1746863209,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140413677,
    "post_id" : 79615252,
    "body" : "Can you please provide a sample repository where the same thing happens?",
    "score" : 0,
    "owner" : {
      "account_id" : 14614685,
      "reputation" : 91,
      "user_id" : 10555123,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/QXlF8.jpg?s=256",
      "display_name" : "bidulgi69",
      "link" : "https://stackoverflow.com/users/10555123/bidulgi69"
    },
    "creation_date" : 1746887670,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79615274" : [ {
      "comment_id" : 140413135,
      "post_id" : 79615274,
      "body" : "Hey thanks for giving the answer, this method does work perfectly. But really I have no idea why the deleteBy isn&#39;t doing anything.",
      "score" : 0,
      "owner" : {
        "account_id" : 11897765,
        "reputation" : 127,
        "user_id" : 11590978,
        "user_type" : "registered",
        "profile_image" : "https://lh6.googleusercontent.com/-IJJbvC55vIM/AAAAAAAAAAI/AAAAAAAAAWo/5Nc8QuNpkbU/s256-rj/photo.jpg",
        "display_name" : "Akshit Bansal",
        "link" : "https://stackoverflow.com/users/11590978/akshit-bansal"
      },
      "creation_date" : 1746864359,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}