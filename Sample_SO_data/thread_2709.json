{
  "question" : {
    "question_id" : 79600154,
    "title" : "Why I am getting the List is null on my phone and not on the virtual devices?",
    "body" : "<p>I've implemented a search functionality in custom list view to my application. My problem is that I am getting this error (just on the real phones, not the virtuals):</p>\n<blockquote>\n<p>java.lang.NullPointerException: Attempt to invoke interface method 'int java.util.List.size()' on a null object reference</p>\n</blockquote>\n<p>I don't understand why on virtual devices the search functionality works like a charm. Where does the problem lie?</p>\n<p>This is my code:</p>\n<p><code>CustomAdapterShoppingList</code> class:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class CustomAdapterShoppingList extends BaseAdapter implements Filterable {\n\n    List&lt;Product&gt; list;\n    List&lt;Product&gt; listFiltered;\n    Context mContext;\n\n    public CustomAdapterShoppingList(@NonNull Context context, List&lt;Product&gt; products) {\n        this.list = products;\n        this.listFiltered = products;\n        this.mContext = context;\n    }\n\n    @Override\n    public int getCount() {\n        return listFiltered.size();  &lt;---- THE ERROR mentioned above\n    }\n\n    @Override\n    public Product getItem(int position) {\n        return listFiltered.get(position);\n    }\n\n    @Override\n    public long getItemId(int position) {\n        return position;\n    }\n\n    private int lastPosition = -1;\n\n    @Override\n    public View getView(int position, View convertView, ViewGroup parent) {\n        if (convertView == null) {\n            convertView = LayoutInflater.from(mContext).inflate(R.layout.shoplist_row, parent,\n                    false);\n        }\n        Animation animation = AnimationUtils.loadAnimation(mContext, (position &gt; lastPosition)\n                ? R.anim.up_from_bottom : R.anim.down_from_top);\n        convertView.startAnimation(animation);\n        lastPosition = position;\n\n            TextView number = convertView.findViewById(R.id.number);\n            number.setText(position + 1 + &quot;.&quot;);\n\n            TextView name = convertView.findViewById(R.id.name);\n            name.setText(listFiltered.get(position).getProduktName());\n            \n        return convertView;\n    }\n\n    @Override\n    public Filter getFilter() {\n        Filter filter = new Filter() {\n            @Override\n            protected FilterResults performFiltering(CharSequence charSequence) {\n                FilterResults filterResults = new FilterResults();\n                if (list == null) {\n                    list = new ArrayList&lt;&gt;(listFiltered);\n                }\n\n                if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.VANILLA_ICE_CREAM) {\n                    if (charSequence == null || charSequence.isEmpty()) {\n                        filterResults.count = list.size();\n                        filterResults.values = list;\n                    } else {\n                        List&lt;Product&gt; resultPrd = new ArrayList&lt;&gt;();\n                        String searchStr = charSequence.toString().toLowerCase();\n\n                        for (Product prd:list) {\n                            if(prd.getProduktName().contains(searchStr)) {\n                                resultPrd.add(prd);\n                            }\n                            filterResults.count = resultPrd.size();\n                            filterResults.values = resultPrd;\n                        }\n                    }\n                }\n                return filterResults;\n            }\n\n            @SuppressWarnings(&quot;unchecked&quot;)\n            @Override\n            protected void publishResults(CharSequence charSequence, FilterResults filterResults) {\n\n                listFiltered = (List&lt;Product&gt;) filterResults.values;\n                notifyDataSetChanged();\n            }\n        };\n        return filter;\n    }\n}\n</code></pre>\n<p>Then, calling the search functionality in <code>ShoppinglistActivity</code> class with this code:</p>\n<pre><code>adapter = new CustomAdapterShoppingList(getApplicationContext(), products);\n                shoppingList.setAdapter(adapter);\n                adapter.notifyDataSetChanged();\n                sv.setOnQueryTextListener(new SearchView.OnQueryTextListener() {\n                    @Override\n                    public boolean onQueryTextSubmit(String query) {\n                        return false;\n                    }\n                    @Override\n                    public boolean onQueryTextChange(String newText) {\n                        adapter.getFilter().filter(newText);\n                        return false;\n                    }\n                });\n</code></pre>\n",
    "tags" : [ "java", "android", "search" ],
    "owner" : {
      "account_id" : 6142015,
      "reputation" : 406,
      "user_id" : 4789141,
      "user_type" : "registered",
      "accept_rate" : 70,
      "profile_image" : "https://www.gravatar.com/avatar/ab2a734e0b15c1655c9bb107f574de8c?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "carl",
      "link" : "https://stackoverflow.com/users/4789141/carl"
    },
    "is_answered" : false,
    "view_count" : 103,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1746122164,
    "creation_date" : 1746009739,
    "link" : "https://stackoverflow.com/questions/79600154/why-i-am-getting-the-list-is-null-on-my-phone-and-not-on-the-virtual-devices",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79600178,
    "question_id" : 79600154,
    "body" : "<p>The crash happens because <code>ListFiltered</code> is <code>null</code> when <code>getCount()</code> is called. Fix it by changing <code>getCount()</code> to:<br />\n<code>return listFiltered != null ? listFiltered.size() : 0;</code></p>\n<p>Also, move <code>filterResults.count</code> and <code>filterResults.values</code> outside the loop in <code>performFiltering()</code> to avoid inconsistent behavior.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 40942301,
      "reputation" : 31,
      "user_id" : 30039244,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/b95e813d6c3f3b9b671bf21a305f2e67?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "user30039244",
      "link" : "https://stackoverflow.com/users/30039244/user30039244"
    },
    "creation_date" : 1746010619,
    "last_activity_date" : 1746122164,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140383929,
    "post_id" : 79600154,
    "body" : "@Ken Wolf, Why its works well on virtual devices? On virtual devices the <code>products</code> is <code>null</code> when I instantiate the adapter.",
    "score" : 0,
    "owner" : {
      "account_id" : 6142015,
      "reputation" : 406,
      "user_id" : 4789141,
      "user_type" : "registered",
      "accept_rate" : 70,
      "profile_image" : "https://www.gravatar.com/avatar/ab2a734e0b15c1655c9bb107f574de8c?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "carl",
      "link" : "https://stackoverflow.com/users/4789141/carl"
    },
    "creation_date" : 1746014004,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140383902,
    "post_id" : 79600154,
    "body" : "<code>products</code> is null when you instantiate the adapter",
    "score" : 2,
    "owner" : {
      "account_id" : 442814,
      "reputation" : 23299,
      "user_id" : 833647,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Jpy2l.jpg?s=256",
      "display_name" : "Ken Wolf",
      "link" : "https://stackoverflow.com/users/833647/ken-wolf"
    },
    "creation_date" : 1746013280,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140383727,
    "post_id" : 79600154,
    "body" : "@jonrsharpe, Thanks for editing my question. I&#39;m a little stressed!",
    "score" : 1,
    "owner" : {
      "account_id" : 6142015,
      "reputation" : 406,
      "user_id" : 4789141,
      "user_type" : "registered",
      "accept_rate" : 70,
      "profile_image" : "https://www.gravatar.com/avatar/ab2a734e0b15c1655c9bb107f574de8c?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "carl",
      "link" : "https://stackoverflow.com/users/4789141/carl"
    },
    "creation_date" : 1746010136,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79600178" : [ {
      "comment_id" : 140383808,
      "post_id" : 79600178,
      "body" : "it doesn&#39;t work. I changed the <code>getCount()</code>, now the list view becomes empty when I type a letter! - On virtual devices everything works nice.",
      "score" : 0,
      "owner" : {
        "account_id" : 6142015,
        "reputation" : 406,
        "user_id" : 4789141,
        "user_type" : "registered",
        "accept_rate" : 70,
        "profile_image" : "https://www.gravatar.com/avatar/ab2a734e0b15c1655c9bb107f574de8c?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "carl",
        "link" : "https://stackoverflow.com/users/4789141/carl"
      },
      "creation_date" : 1746011372,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}