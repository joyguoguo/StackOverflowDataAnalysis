{
  "question" : {
    "question_id" : 79642305,
    "title" : "Cannot add a folder to a net.lingala.zip4j.ZipFile",
    "body" : "<p>I'm trying to add a single folder to a Zip file in Windows. I have written this code, which works on Linux:</p>\n<pre class=\"lang-java prettyprint-override\"><code>class ZipIt {\n    public void buildZip(String fn, String targetPath)\n    {\n        final File FILE_PATH = new File( fn );\n        final File TEMP_PATH = File.createTempFile( FILE_PATH.toString(), &quot;zip&quot; );\n\n        // Create the zip file\n        try (var zf = new net.lingala.zip4j.ZipFile( TEMP_PATH.getCanonicalPath() ))\n        {\n            zf.addFolder( new File( targetPath ) );    // Offending line\n        } catch(net.lingala.zip4j.exception.ZipException exc) {\n            throw new IOException( exc.getMessage() );\n        }\n\n        Files.copy(\n                TEMP_PATH.toPath(),\n                FILE_PATH.toPath(),\n                StandardCopyOption.REPLACE_EXISTING );\n    }\n}\n</code></pre>\n<p>As I said, it works in Linux. But, when executed in Windows, the following exception is thrown:</p>\n<p>net.lingala.zip4j.exception.ZipException,\ncause: IOException: the process cannot access the file because it is being used by another process</p>\n<p>It does not matter if I create the file directly in its target directory, or create it through a temporary, like above.</p>\n<p>I'm completely lost here. Any help?</p>\n",
    "tags" : [ "java", "windows", "zip" ],
    "owner" : {
      "account_id" : 98681,
      "reputation" : 12372,
      "user_id" : 266978,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/936f8c28b401a914224af1e0e9891633?s=256&d=identicon&r=PG",
      "display_name" : "Baltasarq",
      "link" : "https://stackoverflow.com/users/266978/baltasarq"
    },
    "is_answered" : true,
    "view_count" : 92,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1748590882,
    "creation_date" : 1748438433,
    "link" : "https://stackoverflow.com/questions/79642305/cannot-add-a-folder-to-a-net-lingala-zip4j-zipfile",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79642707,
    "question_id" : 79642305,
    "body" : "<p>Okay, the problem was that I intended to write a log in the same directory that it was being compressed. As soon as the &quot;lock file&quot; (a simple file owned by the Java Runtime) was copied (or tried to), then that sharing error raised. Strange, since it did not involve modifying or deleting it... (again, in Linux worked.)</p>\n<p>Moved the log somewhere else and the error disappeared.</p>\n<p>In the process, I removed the dependency on <em>net.lingala.zip4j</em>, and used instead the Zip utilities inside the JDK. I had to copy <strong>ZipOutputStreams</strong> though, actually not very comfortable.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 98681,
      "reputation" : 12372,
      "user_id" : 266978,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/936f8c28b401a914224af1e0e9891633?s=256&d=identicon&r=PG",
      "display_name" : "Baltasarq",
      "link" : "https://stackoverflow.com/users/266978/baltasarq"
    },
    "creation_date" : 1748452216,
    "last_activity_date" : 1748590882,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140466949,
    "post_id" : 79642305,
    "body" : "I answered my own question. Had to get rid of net.lingala.zip4j though, in order to get to the exact &quot;offending&quot; file.",
    "score" : 0,
    "owner" : {
      "account_id" : 98681,
      "reputation" : 12372,
      "user_id" : 266978,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/936f8c28b401a914224af1e0e9891633?s=256&d=identicon&r=PG",
      "display_name" : "Baltasarq",
      "link" : "https://stackoverflow.com/users/266978/baltasarq"
    },
    "creation_date" : 1748452270,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140466408,
    "post_id" : 79642305,
    "body" : "Post full stacktrace. It may contain name of the problematic file. If not, you need to debug your app and find what file cause the trouble.",
    "score" : 1,
    "owner" : {
      "account_id" : 4497436,
      "reputation" : 20786,
      "user_id" : 3656904,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/8bdbd1f89f8907e8e8b15ab88c084c65?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "talex",
      "link" : "https://stackoverflow.com/users/3656904/talex"
    },
    "creation_date" : 1748442509,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140466402,
    "post_id" : 79642305,
    "body" : "Are you sure you don&#39;t have any opened document on your desktop?",
    "score" : 1,
    "owner" : {
      "account_id" : 4497436,
      "reputation" : 20786,
      "user_id" : 3656904,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/8bdbd1f89f8907e8e8b15ab88c084c65?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "talex",
      "link" : "https://stackoverflow.com/users/3656904/talex"
    },
    "creation_date" : 1748442404,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140466279,
    "post_id" : 79642305,
    "body" : "I don&#39;t think so. It&#39;s invoked with <code>ZipIt(&quot;c:\\users\\usr1\\output.zip&quot;, &quot;c:\\users\\usr1\\Desktop&quot;)</code>.",
    "score" : 0,
    "owner" : {
      "account_id" : 98681,
      "reputation" : 12372,
      "user_id" : 266978,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/936f8c28b401a914224af1e0e9891633?s=256&d=identicon&r=PG",
      "display_name" : "Baltasarq",
      "link" : "https://stackoverflow.com/users/266978/baltasarq"
    },
    "creation_date" : 1748440645,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140466237,
    "post_id" : 79642305,
    "body" : "I guess it is one of files in <code>targetPath</code>. Do you create them in your app?",
    "score" : 0,
    "owner" : {
      "account_id" : 4497436,
      "reputation" : 20786,
      "user_id" : 3656904,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/8bdbd1f89f8907e8e8b15ab88c084c65?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "talex",
      "link" : "https://stackoverflow.com/users/3656904/talex"
    },
    "creation_date" : 1748440021,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79642707" : [ {
      "comment_id" : 140468573,
      "post_id" : 79642707,
      "body" : "Yeah, Windows quirks.",
      "score" : 0,
      "owner" : {
        "account_id" : 98681,
        "reputation" : 12372,
        "user_id" : 266978,
        "user_type" : "registered",
        "accept_rate" : 100,
        "profile_image" : "https://www.gravatar.com/avatar/936f8c28b401a914224af1e0e9891633?s=256&d=identicon&r=PG",
        "display_name" : "Baltasarq",
        "link" : "https://stackoverflow.com/users/266978/baltasarq"
      },
      "creation_date" : 1748505495,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140468230,
      "post_id" : 79642707,
      "body" : "Linux allow to read files open for writing, Windows doesn&#39;t.",
      "score" : 2,
      "owner" : {
        "account_id" : 4497436,
        "reputation" : 20786,
        "user_id" : 3656904,
        "user_type" : "registered",
        "accept_rate" : 67,
        "profile_image" : "https://www.gravatar.com/avatar/8bdbd1f89f8907e8e8b15ab88c084c65?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "talex",
        "link" : "https://stackoverflow.com/users/3656904/talex"
      },
      "creation_date" : 1748495618,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}