{
  "question" : {
    "question_id" : 79682767,
    "title" : "Error in a flink job `No FileSystem for scheme &quot;s3&quot;`",
    "body" : "<p>I get this error <code>No FileSystem for scheme &quot;s3&quot;</code> when I run my test.</p>\n<pre><code>Container.ExecResult(exitCode=1, stdout=, stderr=WARNING: An illegal reflective access operation has occurred\nWARNING: Illegal reflective access by org.apache.flink.streaming.runtime.translators.DataStreamV2SinkTransformationTranslator (file:/opt/flink/lib/flink-dist-1.20.1.jar) to field java.util.Collections$UnmodifiableMap.m\nWARNING: Please consider reporting this to the maintainers of org.apache.flink.streaming.runtime.translators.DataStreamV2SinkTransformationTranslator\nWARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations\nWARNING: All illegal access operations will be denied in a future release\n\n------------------------------------------------------------\n The program finished with the following exception:\n\norg.apache.flink.client.program.ProgramInvocationException: The main method caused an error: No FileSystem for scheme &quot;s3&quot;\n    at org.apache.flink.client.program.PackagedProgram.callMainMethod(PackagedProgram.java:373)\n    at org.apache.flink.client.program.PackagedProgram.invokeInteractiveModeForExecution(PackagedProgram.java:223)\n    at org.apache.flink.client.ClientUtils.executeProgram(ClientUtils.java:113)\n    at org.apache.flink.client.cli.CliFrontend.executeProgram(CliFrontend.java:1026)\n    at org.apache.flink.client.cli.CliFrontend.run(CliFrontend.java:247)\n    at org.apache.flink.client.cli.CliFrontend.parseAndRun(CliFrontend.java:1270)\n    at org.apache.flink.client.cli.CliFrontend.lambda$mainInternal$10(CliFrontend.java:1367)\n    at org.apache.flink.runtime.security.contexts.NoOpSecurityContext.runSecured(NoOpSecurityContext.java:28)\n    at org.apache.flink.client.cli.CliFrontend.mainInternal(CliFrontend.java:1367)\n    at org.apache.flink.client.cli.CliFrontend.main(CliFrontend.java:1335)\nCaused by: org.apache.hadoop.fs.UnsupportedFileSystemException: No FileSystem for scheme &quot;s3&quot;\n    at org.apache.hadoop.fs.FileSystem.getFileSystemClass(FileSystem.java:3443)\n    at org.apache.hadoop.fs.FileSystem.createFileSystem(FileSystem.java:3466)\n    at org.apache.hadoop.fs.FileSystem.access$300(FileSystem.java:174)\n    at org.apache.hadoop.fs.FileSystem$Cache.getInternal(FileSystem.java:3574)\n    at org.apache.hadoop.fs.FileSystem$Cache.get(FileSystem.java:3521)\n    at org.apache.hadoop.fs.FileSystem.get(FileSystem.java:540)\n    at org.apache.hadoop.fs.Path.getFileSystem(Path.java:365)\n    at org.apache.parquet.hadoop.ParquetReader$Builder.build(ParquetReader.java:391)\n    at com.xyz.odl.util.parquet.JsonParquetReader.readParquetFileAsCollection(JsonParquetReader.java:53)\n    at com.xyz.odl.BackfillDynamoJob.main(BackfillDynamoJob.java:47)\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n    at java.base/java.lang.reflect.Method.invoke(Unknown Source)\n    at org.apache.flink.client.program.PackagedProgram.callMainMethod(PackagedProgram.java:356)\n    ... 9 more\n)\n</code></pre>\n<p>Here's my test setup:</p>\n<pre><code>private GenericContainer&lt;?&gt; constructAndStartFlinkJobManager() {\n    String flinkConfYamlPath =\n        Paths.get(&quot;src/test/resources/flink-conf.yaml&quot;).toAbsolutePath().toString();\n    String flinkS3FsPrestoJar =\n        Paths.get(&quot;src/test/resources/plugins/flink-s3-fs-presto-1.20.1.jar&quot;)\n            .toAbsolutePath()\n            .toString();\n\n    try  {\n      GenericContainer&lt;?&gt; flinkJobManagerContainer =\n        new GenericContainer&lt;&gt;(DockerImageName.parse(&quot;arm64v8/flink:1.20.1-java11&quot;))\n          .withCopyFileToContainer(\n            MountableFile.forHostPath(propertiesJsonFile.getAbsolutePath()),\n            &quot;/opt/flink/conf/application-properties.json&quot;)\n          .withCopyFileToContainer(\n            MountableFile.forHostPath(flinkConfYamlPath), &quot;/opt/flink/conf/flink-conf.yaml&quot;)\n          .withNetwork(network)\n          .withNetworkAliases(&quot;jobmanager&quot;)\n          .withCommand(&quot;jobmanager&quot;)\n          .withExposedPorts(8081)\n          .withEnv(&quot;JOB_MANAGER_RPC_ADDRESS&quot;, &quot;jobmanager&quot;)\n          .withEnv(\n            Map.of(\n              &quot;AWS_ACCESS_KEY_ID&quot;, &quot;test-access-key&quot;,\n              &quot;AWS_SECRET_ACCESS_KEY&quot;, &quot;test-secret-key&quot;,\n              &quot;AWS_REGION&quot;, &quot;us-east-1&quot;,\n              &quot;AWS_ENDPOINT_URL_S3&quot;, &quot;http://localstack:4566&quot;))\n          .waitingFor(\n            Wait.forHttp(&quot;/&quot;).forPort(8081).withStartupTimeout(Duration.ofSeconds(120)));\n      flinkJobManagerContainer.start();\n\n      ExecResult mkdirResult = flinkJobManagerContainer.execInContainer(\n        &quot;mkdir&quot;, &quot;-p&quot;, &quot;/opt/flink/plugins/s3-fs-presto&quot;);\n\n      if (mkdirResult.getExitCode() != 0) {\n        throw new RuntimeException(&quot;Failed to create directory: &quot; + mkdirResult.getStderr());\n      }\n\n      ExecResult execResult = flinkJobManagerContainer.execInContainer(\n        &quot;cp&quot;,\n        &quot;/opt/flink/opt/flink-s3-fs-presto-1.20.1.jar&quot;,\n        &quot;/opt/flink/plugins/s3-fs-presto/&quot;);\n\n      if (execResult.getExitCode() != 0) {\n        throw new RuntimeException(&quot;Failed to copy plugin JAR: &quot; + execResult.getStderr());\n      }\n\n      return flinkJobManagerContainer;\n    } catch (Exception e) {\n      throw new RuntimeException(e);\n    }\n  }\n\nprivate void constructAndStartTaskJobManager(GenericContainer&lt;?&gt; flinkJobManagerContainer) {\n    String flinkConfYamlPath =\n        Paths.get(&quot;src/test/resources/flink-conf.yaml&quot;).toAbsolutePath().toString();\n    String flinkS3FsPrestoJar =\n      Paths.get(&quot;src/test/resources/plugins/flink-s3-fs-presto-1.20.1.jar&quot;)\n        .toAbsolutePath()\n        .toString();\n    try {\n      new GenericContainer&lt;&gt;(DockerImageName.parse(&quot;arm64v8/flink:1.20.1-java11&quot;))\n          .withCopyFileToContainer(\n              MountableFile.forHostPath(propertiesJsonFile.getAbsolutePath()),\n              &quot;/opt/flink/conf/application-properties.json&quot;)\n          .withCopyFileToContainer(\n              MountableFile.forHostPath(flinkConfYamlPath), &quot;/opt/flink/conf/flink-conf.yaml&quot;)\n        .withCopyFileToContainer(\n          MountableFile.forHostPath(flinkS3FsPrestoJar),\n          &quot;/opt/flink/plugins/s3-fs-presto/flink-s3-fs-presto-1.20.1.jar&quot;)\n          .withNetwork(network)\n          .dependsOn(flinkJobManagerContainer)\n          .withNetworkAliases(&quot;taskmanager&quot;)\n          .withCommand(&quot;taskmanager&quot;)\n          .withEnv(&quot;JOB_MANAGER_RPC_ADDRESS&quot;, &quot;jobmanager&quot;)\n          .withEnv(\n              Map.of(\n                  &quot;AWS_ACCESS_KEY_ID&quot;, &quot;test-access-key&quot;,\n                  &quot;AWS_SECRET_ACCESS_KEY&quot;, &quot;test-secret-key&quot;,\n                  &quot;AWS_REGION&quot;, &quot;us-east-1&quot;,\n                  &quot;AWS_ENDPOINT_URL_S3&quot;, &quot;http://localstack:4566&quot;))\n          .waitingFor(\n              Wait.forLogMessage(&quot;.*Successful registration at resource manager.*&quot;, 1)\n                  .withStartupTimeout(Duration.ofSeconds(120)))\n          .start();\n    } catch (Exception e) {\n      throw new RuntimeException(e);\n    }\n  }\n\n</code></pre>\n<p>The flink-presto-s3 jar is in the plugins as mentioned <a href=\"https://nightlies.apache.org/flink/flink-docs-master/docs/deployment/filesystems/s3/#hadooppresto-s3-file-systems-plugins\" rel=\"nofollow noreferrer\">here</a></p>\n<p>All I'm trying to do in my project is - have an s3 bucket which contains a parquet file, read it and convert each record to a json string in my project, sink it.</p>\n<p>Have written a unit test that spins up all the necessary containers.</p>\n<p>My flink-conf yaml is this</p>\n<pre><code>taskmanager.numberOfTaskSlots: 2\ntaskmanager.memory.flink.size: 1024mb\njobmanager.memory.flink.size: 1024mb\njobmanager.rpc.address: jobmanager\n\ns3.fs.s3a.impl: org.apache.hadoop.fs.s3a.S3AFileSystem\ns3.fs.s3a.access.key: test\ns3.fs.s3a.secret.key: test\ns3.fs.s3a.endpoint: http://localstack:4566\n</code></pre>\n",
    "tags" : [ "java", "amazon-s3", "apache-flink" ],
    "owner" : {
      "account_id" : 4940923,
      "reputation" : 1145,
      "user_id" : 3977629,
      "user_type" : "registered",
      "accept_rate" : 77,
      "profile_image" : "https://i.sstatic.net/SiLLc.jpg?s=256",
      "display_name" : "Pavanraotk",
      "link" : "https://stackoverflow.com/users/3977629/pavanraotk"
    },
    "is_answered" : false,
    "view_count" : 94,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1751540841,
    "creation_date" : 1751090219,
    "link" : "https://stackoverflow.com/questions/79682767/error-in-a-flink-job-no-filesystem-for-scheme-s3",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79688734,
    "question_id" : 79682767,
    "body" : "<p>I got a solution working for this. Had to do these</p>\n<p>I had to start flink manager with few jars</p>\n<pre><code>private static GenericContainer&lt;?&gt; constructAndStartFlinkJobManager() {\n  try {\n    GenericContainer&lt;?&gt; flinkJobManagerContainer =\n        new GenericContainer&lt;&gt;(DockerImageName.parse(&quot;arm64v8/flink:1.20.1-java11&quot;))\n            .withCopyFileToContainer(\n                MountableFile.forHostPath(propertiesJsonFile.getAbsolutePath()),\n                &quot;/opt/flink/conf/application-properties.json&quot;)\n            .withCopyFileToContainer(\n                MountableFile.forHostPath(flinkConfYamlPath), &quot;/opt/flink/conf/flink-conf.yaml&quot;)\n            .withCopyFileToContainer(\n                MountableFile.forHostPath(flinkS3FsPrestoJar),\n                &quot;/opt/flink/plugins/s3-fs-presto/flink-s3-fs-presto-1.20.1.jar&quot;)\n            .withCopyFileToContainer(\n                MountableFile.forHostPath(hadoopMapReduceClientCoreJar),\n                &quot;/opt/flink/lib/hadoop-mapreduce-client-core-3.4.0.jar&quot;)\n            .withCopyFileToContainer(\n                MountableFile.forHostPath(hadoopCommonJar),\n                &quot;/opt/flink/lib/hadoop-common-3.4.0.jar&quot;)\n            .withCopyFileToContainer(\n                MountableFile.forHostPath(woodStoxCoreJar),\n                &quot;/opt/flink/lib/woodstox-core-5.4.0.jar&quot;)\n            .withCopyFileToContainer(\n                MountableFile.forHostPath(stax2ApiJar), &quot;/opt/flink/lib/stax2-api-4.2.1.jar&quot;)\n            .withCopyFileToContainer(\n                MountableFile.forHostPath(hadoopShadedGuavaJar),\n                &quot;/opt/flink/lib/hadoop-shaded-guava-1.2.0.jar&quot;)\n            .withCopyFileToContainer(\n                MountableFile.forHostPath(awsSdkCoreJar),\n                &quot;/opt/flink/lib/aws-sdk-core-2.31.41.jar&quot;)\n            .withNetwork(network)\n            .withNetworkAliases(&quot;jobmanager&quot;)\n            .withCommand(&quot;jobmanager&quot;)\n            .withExposedPorts(8081)\n            .withEnv(&quot;JOB_MANAGER_RPC_ADDRESS&quot;, &quot;jobmanager&quot;)\n            .withEnv(\n                Map.of(\n                    &quot;AWS_ACCESS_KEY_ID&quot;, &quot;test-access-key&quot;,\n                    &quot;AWS_SECRET_ACCESS_KEY&quot;, &quot;test-secret-key&quot;,\n                    &quot;AWS_REGION&quot;, &quot;us-east-1&quot;,\n                    &quot;AWS_ENDPOINT_URL_S3&quot;, &quot;http://localstack:4566&quot;))\n            .waitingFor(\n                Wait.forHttp(&quot;/&quot;).forPort(8081).withStartupTimeout(Duration.ofSeconds(120)));\n    flinkJobManagerContainer.start();\n    return flinkJobManagerContainer;\n  } catch (Exception e) {\n    throw new RuntimeException(e);\n  }\n}\n</code></pre>\n<p>This is my task manager</p>\n<pre><code>private static void constructAndStartTaskJobManager(\n    GenericContainer&lt;?&gt; flinkJobManagerContainer) {\n  try {\n    GenericContainer&lt;?&gt; flinkTaskManagerContainer =\n        new GenericContainer&lt;&gt;(DockerImageName.parse(&quot;arm64v8/flink:1.20.1-java11&quot;))\n            .withCopyFileToContainer(\n                MountableFile.forHostPath(propertiesJsonFile.getAbsolutePath()),\n                &quot;/opt/flink/conf/application-properties.json&quot;)\n            .withCopyFileToContainer(\n                MountableFile.forHostPath(flinkConfYamlPath), &quot;/opt/flink/conf/flink-conf.yaml&quot;)\n            .withCopyFileToContainer(\n                MountableFile.forHostPath(flinkS3FsPrestoJar),\n                &quot;/opt/flink/plugins/s3-fs-presto/flink-s3-fs-presto-1.20.1.jar&quot;)\n            .withCopyFileToContainer(\n                MountableFile.forHostPath(hadoopMapReduceClientCoreJar),\n                &quot;/opt/flink/lib/hadoop-mapreduce-client-core-3.4.0.jar&quot;)\n            .withCopyFileToContainer(\n                MountableFile.forHostPath(hadoopCommonJar),\n                &quot;/opt/flink/lib/hadoop-common-3.4.0.jar&quot;)\n            .withCopyFileToContainer(\n                MountableFile.forHostPath(woodStoxCoreJar),\n                &quot;/opt/flink/lib/woodstox-core-5.4.0.jar&quot;)\n            .withCopyFileToContainer(\n                MountableFile.forHostPath(stax2ApiJar), &quot;/opt/flink/lib/stax2-api-4.2.1.jar&quot;)\n            .withCopyFileToContainer(\n                MountableFile.forHostPath(hadoopShadedGuavaJar),\n                &quot;/opt/flink/lib/hadoop-shaded-guava-1.2.0.jar&quot;)\n            .withCopyFileToContainer(\n                MountableFile.forHostPath(awsSdkCoreJar),\n                &quot;/opt/flink/lib/aws-sdk-core-2.31.41.jar&quot;)\n            .withCommand(&quot;taskmanager&quot;)\n            .withNetwork(network)\n            .dependsOn(flinkJobManagerContainer)\n            .withNetworkAliases(&quot;taskmanager&quot;)\n            .withEnv(&quot;JOB_MANAGER_RPC_ADDRESS&quot;, &quot;jobmanager&quot;)\n            .withEnv(\n                Map.of(\n                    &quot;AWS_ACCESS_KEY_ID&quot;, &quot;test-access-key&quot;,\n                    &quot;AWS_SECRET_ACCESS_KEY&quot;, &quot;test-secret-key&quot;,\n                    &quot;AWS_REGION&quot;, &quot;us-east-1&quot;,\n                    &quot;AWS_ENDPOINT_URL_S3&quot;, &quot;http://localstack:4566&quot;))\n            .waitingFor(\n                Wait.forLogMessage(&quot;.*Successful registration at resource manager.*&quot;, 1)\n                    .withStartupTimeout(Duration.ofSeconds(120)));\n    flinkTaskManagerContainer.start();\n  } catch (Exception e) {\n    throw new RuntimeException(e);\n  }\n}\n</code></pre>\n<p>This is my flink-conf.yaml</p>\n<pre><code>taskmanager.numberOfTaskSlots: 2\ntaskmanager.memory.flink.size: 1024mb\njobmanager.memory.flink.size: 1024mb\njobmanager.rpc.address: jobmanager\n\ns3.endpoint: http://localstack:4566\ns3.fs.impl: org.apache.flink.fs.s3presto.S3FileSystemFactory\ns3.path.style.access: true\ns3.access-key: test\ns3.secret-key: test\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 4940923,
      "reputation" : 1145,
      "user_id" : 3977629,
      "user_type" : "registered",
      "accept_rate" : 77,
      "profile_image" : "https://i.sstatic.net/SiLLc.jpg?s=256",
      "display_name" : "Pavanraotk",
      "link" : "https://stackoverflow.com/users/3977629/pavanraotk"
    },
    "creation_date" : 1751540841,
    "last_activity_date" : 1751540841,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140554446,
    "post_id" : 79682767,
    "body" : "When your code executes, there&#39;s no src directory after it&#39;s compiled to find, so I don&#39;t think your mounts and copies are correct",
    "score" : 0,
    "owner" : {
      "account_id" : 2671330,
      "reputation" : 192983,
      "user_id" : 2308683,
      "user_type" : "registered",
      "accept_rate" : 90,
      "profile_image" : "https://www.gravatar.com/avatar/fb8f5877d244f223b4b6d29e0afb3a4e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "OneCricketeer",
      "link" : "https://stackoverflow.com/users/2308683/onecricketeer"
    },
    "creation_date" : 1751328191,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}