{
  "question" : {
    "question_id" : 79636084,
    "title" : "Spring Batch JdbcCursorItemReader not able to query data from SQL DB where as JDBCTemplate able to fetch",
    "body" : "<p>JdbcCursorItemReader not able to query data from SQL DB, so it is not going to RowMappper mapRow method, and no error is coming in the console. Where as JDBCTemplate able to fetch data from DB using same query\nConfig Class</p>\n<pre><code>@EnableBatchProcessing\n@Configuration\npublic class config {\n\n    @Autowired\n    DataSource datasource;\n    \n    @Bean\n    public Job job(JobRepository jobRepository, Step step) {\n        return new JobBuilder(&quot;employeeData&quot;, jobRepository)\n        .start(step)\n        .build();\n    }\n    \n    @Bean\n    public Step step(JobRepository jobRepository, PlatformTransactionManager manager) throws Exception {\n        return new StepBuilder(&quot;data_import&quot;,jobRepository)\n        .&lt;EmpPojo,EmpPojo &gt;chunk(100, manager)\n        .reader (readItemt)\n//      .processor (null)\n        .writer(writeItem()).build();\n    }\n    \n    @Bean\n    public JdbcCursorItemReader&lt;EmpPojo&gt; readItem() throws Exception{\n//      JdbcTemplate jdbcTemplate = new JdbcTemplate(datasource);\n//      List&lt;EmpPojo&gt; customerCredits = jdbcTemplate.query(&quot;SELECT * FROM testdb.employee&quot;,new EmpRowMapper());\n//      System.out.println(&quot;2nd value &quot; +customerCredits.get(0).getEmpName());\n        \n        JdbcCursorItemReader&lt;EmpPojo&gt; reader = new JdbcCursorItemReader&lt;&gt;();\n        ExecutionContext executionContext = new ExecutionContext();\n        reader.setDataSource(datasource);\n        reader.setRowMapper(new EmpRowMapper());\n        reader.setSql(&quot;SELECT * FROM testdb.employee&quot;);\n        reader.open(executionContext);\n        reader.setFetchSize(10);\n        System.out.println(reader.read());\n        System.out.println(datasource.getClass().getName());\n        com.zaxxer.hikari.HikariDataSource ds = (com.zaxxer.hikari.HikariDataSource) datasource;\n        System.out.print1n(&quot;JDBC URL:&quot;+ ds.getJdbcUrl());\n        System.out.println(&quot;Username:&quot; + ds.getUsername());\n        System.out.print1n(&quot;Username:&quot; + ds.getPassword());\n//      ds.setConnectionTestQuery(&quot;SELECT empid FROM testdb.employee;&quot;);\n        System.out.println(&quot;Username: &quot; + ds.isRunning());\n        reader.close();\n        return reader;\n    }\n    \n    //@Bean\n    //public JdbcCursorItemReader&lt;EmpPojo&gt; readItem() {\n    //  return new JdbcCursorItemReaderBuilder&lt;EmpPojo&gt;()\n    //  dataSource(datasource)\n    //  .sql(&quot;SELECT * FROM testdb.employee&quot;)\n    //  .rowMapper(new EmpRowMapper())\n    //  .build();\n    //}\n        \n    @Bean\n    public FlatFileItemWriter&lt;EmpPojo&gt; writeItem(){\n        FlatFileItemWriter&lt;EmpPojo&gt; writer = new FlatFileItemWriter&lt;&gt;();\n        writer.setResource(new FileSystemResource(&quot;Downloads/CSV File/output.csv&quot;));\n        writer.setHeaderCallback(writer1 -&gt; writer1.write(&quot;EmpId, EmpName,EmpRole,EmpSalary&quot;));\n        DelimitedLineAggregator&lt;EmpPojo&gt; aggregator = new DelimitedLineAggregator&lt;&gt;();\n        aggregator.setDelimiter(&quot;,&quot;);\n        BeanWrapperFieldExtractor&lt;EmpPojo&gt; extractor = new BeanWrapperFieldExtractor&lt;&gt;();\n        extractor.setNames(new String[] {&quot;empId&quot;, &quot;empName&quot;, &quot;empRole&quot;, &quot;empSalary&quot;});\n        aggregator.setFieldExtractor(extractor);\n        writer.setLineAggregator(aggregator);\n        System.out.println(&quot;Item writer&quot;);\n        return writer;\n    }\n}\n</code></pre>\n<p>Repository Interface</p>\n<pre><code>\n\n@Repository\npublic interface EmpRepository extends JpaRepository&lt;EmpPojo, Integer&gt;{\n\n}\n</code></pre>\n<p>Rowmapper class</p>\n<pre><code>\n@Component\npublic class EmpRowMapper implements RowMapper&lt;EmpPojo&gt;{\n\n    @Override\n    public EmpPojo mapRow(ResultSet rs, int rowNum) throws SQLException {\n        System.out.println(&quot;Mapping row: &quot; + rs);\n        EmpPojo emp = new EmpPojo();\n        emp.setEmpId(rs.getInt(&quot;EmpId&quot;));\n        emp.setEmpName(rs.getString(&quot;EmpName&quot;));\n        emp.setEmpRole(rs.getString(&quot;EmpRole&quot;))\n        emp.setEmpSalary(rs.getInt(&quot;EmpSalary&quot;));\n        System.out.println(&quot;row: &quot;+ rs.getString(&quot;EmpName&quot;));\n        return emp;\n    }\n}\n</code></pre>\n<p>application.properties</p>\n<pre><code>spring.application.name employeeTest\nspring.jpa.hibernate.ddl-auto=update\nspring.datasource.url=jdbc:mysq1://localhost:3306/testdb\nspring.datasource.username=root\nspring.datasource.password=password\nspring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver\nspring.jpa.show-sql: true\nspring.data.jdbc.repositories.enabled=false\n\nspring.batch.jdbc.initialize-schema=always\nserver.port:8085\n</code></pre>\n<p>Database connection is fine, checked.\nQuery is correct, checked in DB.<br />\nUsing JDBCTemplate able to fetch data, i have commented out the code in readitem method\nRowMapper also working fine, checked with JDBCTemplate.\nTried with JdbcCursorItemReaderBuilder also, commented out the method</p>\n<p>1 interesting fact is that, if i call the read method from JdbcCursorItemReader, then i see its fetching the 1st data form the table</p>\n",
    "tags" : [ "java", "mysql", "spring-boot", "jdbc", "spring-batch" ],
    "owner" : {
      "account_id" : 33052407,
      "reputation" : 1,
      "user_id" : 25635645,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/b199331714e3a77111cdff7e17b21208?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "ABHIJIT BISWAS",
      "link" : "https://stackoverflow.com/users/25635645/abhijit-biswas"
    },
    "is_answered" : true,
    "view_count" : 124,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1749283567,
    "creation_date" : 1748027614,
    "link" : "https://stackoverflow.com/questions/79636084/spring-batch-jdbccursoritemreader-not-able-to-query-data-from-sql-db-where-as-jd",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79641684,
    "question_id" : 79636084,
    "body" : "<p>Why do you call <code>reader.open(executionContext)</code> and <code>reader.close()</code> in the bean definition method? This is not correct and is the cause of your issue. It is Spring Batch that will manage the lifecycle of the reader as needed.</p>\n<p>Here is how the reader should be defined:</p>\n<pre><code>@Bean\npublic JdbcCursorItemReader&lt;EmpPojo&gt; itemReader() throws Exception {        \n   JdbcCursorItemReader&lt;EmpPojo&gt; reader = new JdbcCursorItemReader&lt;&gt;();\n   reader.setDataSource(datasource);\n   reader.setRowMapper(new EmpRowMapper());\n   reader.setSql(&quot;SELECT * FROM testdb.employee&quot;);\n   reader.setFetchSize(10);\n   return reader;\n}\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 6482932,
      "reputation" : 32093,
      "user_id" : 5019386,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/18b9001fd20c1e089d19f4a1e994bcdc?s=256&d=identicon&r=PG",
      "display_name" : "Mahmoud Ben Hassine",
      "link" : "https://stackoverflow.com/users/5019386/mahmoud-ben-hassine"
    },
    "creation_date" : 1748416309,
    "last_activity_date" : 1748416309,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140467350,
    "post_id" : 79636084,
    "body" : "JdbcCursorItemReader item reader not fetching any data from table. But JdbcTemplate  was fetching. I verified it by putting log in RowMapper.",
    "score" : 0,
    "owner" : {
      "account_id" : 33052407,
      "reputation" : 1,
      "user_id" : 25635645,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/b199331714e3a77111cdff7e17b21208?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "ABHIJIT BISWAS",
      "link" : "https://stackoverflow.com/users/25635645/abhijit-biswas"
    },
    "creation_date" : 1748461771,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140464968,
    "post_id" : 79636084,
    "body" : "Define &#39;not able&#39;.",
    "score" : 0,
    "owner" : {
      "account_id" : 71739,
      "reputation" : 311869,
      "user_id" : 207421,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=256&d=identicon&r=PG",
      "display_name" : "user207421",
      "link" : "https://stackoverflow.com/users/207421/user207421"
    },
    "creation_date" : 1748417128,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79641684" : [ {
      "comment_id" : 140467334,
      "post_id" : 79641684,
      "body" : "Initially i did not call open and close method. I was debugging and print read method. There a error came &quot; Reader must be open before it can be read&quot; So i call those to open and close method explicitly. Even without those methods its not working. 1 interesting fact is that, if i call the read method, then i see its fetching the 1st data form the table.",
      "score" : 0,
      "owner" : {
        "account_id" : 33052407,
        "reputation" : 1,
        "user_id" : 25635645,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/b199331714e3a77111cdff7e17b21208?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "ABHIJIT BISWAS",
        "link" : "https://stackoverflow.com/users/25635645/abhijit-biswas"
      },
      "creation_date" : 1748461392,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}