{
  "question" : {
    "question_id" : 79747585,
    "title" : "MapStruct generated classes compile with errors in multi-module Maven project",
    "body" : "<p>I have a Maven multi-module project (<a href=\"https://github.com/flowrapp/flowrapp_backend\" rel=\"nofollow noreferrer\">repo</a>), following hexagonal arquitecture, with the following structure:</p>\n<pre><code>parent\n ├─ domain              (Lombok)\n ├─ app                 (Lombok)\n └─ infra               (aggregator POM)\n     ├─ output-adapters (MapStruct + Lombok) – depends on rest-api, bbdd and domain\n     ├─ rest-api        (OpenAPI generator + MapStruct + Lombok) - depends on domain\n     └─ bbdd            (QueryDSL + Lombok).\n\n</code></pre>\n<p>In the output-adapters module, MapStruct generates the implementation classes, but the generated .class files often contain compilation errors.</p>\n<p>For example, the generated *Impl files look correct at first, but then I get errors like:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Component\npublic class WorklogEntityMapperImpl {\n    @Autowired\n    private UserEntityMapper userEntityMapper;\n    @Autowired\n    private BusinessEntityMapper businessEntityMapper;\n\n \n\n   public WorklogEntityMapperImpl() {\n        throw new Error(&quot;Unresolved compilation problems: \\n\\tWorklogEntityMapper cannot be resolved to a type\\n\\tUserEntityMapper cannot be resolved to a type\\n\\tBusinessEntityMapper cannot be resolved to a type\\n\\tThe method domain2Infra(Worklog) of type WorklogEntityMapperImpl must override or implement a supertype method\\n\\tUserEntityMapper cannot be resolved to a type\\n\\tBusinessEntityMapper cannot be resolved to a type\\n\\tThe method infra2domain(WorklogEntity) of type WorklogEntityMapperImpl must override or implement a supertype method\\n\\tUserEntityMapper cannot be resolved to a type\\n\\tBusinessEntityMapper cannot be resolved to a type\\n\\tThe method finaMapping(WorklogEntity, Worklog.WorklogBuilder) is undefined for the type WorklogEntityMapperImpl\\n\\tThe method infra2domain(Iterable&lt;WorklogEntity&gt;) of type WorklogEntityMapperImpl must override or implement a supertype method\\n\\tThe method domain2Infra(WorklogFilteredRequest) of type WorklogEntityMapperImpl must override or implement a supertype method\\n&quot;);\n   }\n....\n}\n\n</code></pre>\n<p>The module bbdd and rest-api always correctly generate their classes, the only problem seems to be the module output-adapters.</p>\n<p>I have included maven-compiler-plugin with the following configuration, on the parent pom as a plugin, so every module inherits it:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;plugin&gt;\n          &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n          &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n          &lt;version&gt;${maven.compiler.plugin.version}&lt;/version&gt;\n          &lt;configuration&gt;\n            &lt;useIncrementalCompilation&gt;false&lt;/useIncrementalCompilation&gt;\n            &lt;compilerArgs&gt;\n              &lt;!-- This arg ensures that mapstruct generate a Spring --&gt;\n              &lt;!-- Bean out of every mapper implementation --&gt;\n              &lt;compilerArg&gt;-Amapstruct.defaultComponentModel=spring&lt;/compilerArg&gt;\n              &lt;compilerArg&gt;-Amapstruct.verbose=true&lt;/compilerArg&gt;\n            &lt;/compilerArgs&gt;\n            &lt;annotationProcessorPaths&gt;\n              &lt;path&gt;\n                &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;\n                &lt;artifactId&gt;mapstruct-processor&lt;/artifactId&gt;\n                &lt;version&gt;${org.mapstruct.version}&lt;/version&gt;\n              &lt;/path&gt;\n              &lt;path&gt;\n                &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n                &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n                &lt;version&gt;${lombok.version}&lt;/version&gt;\n              &lt;/path&gt;\n              &lt;!-- This is needed when using Lombok 1.8.16 and above --&gt;\n              &lt;path&gt;\n                &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n                &lt;artifactId&gt;lombok-mapstruct-binding&lt;/artifactId&gt;\n                &lt;version&gt;${lombok-mapstruct-binding.version}&lt;/version&gt;\n              &lt;/path&gt;\n            &lt;/annotationProcessorPaths&gt;\n          &lt;/configuration&gt;\n        &lt;/plugin&gt;\n</code></pre>\n<p>and finally for bbdd module alone:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;build&gt;\n    &lt;plugins&gt;\n      &lt;plugin&gt;\n        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n        &lt;configuration&gt;\n          &lt;annotationProcessorPaths&gt;\n            &lt;!-- QueryDSL --&gt;\n            &lt;path&gt;\n              &lt;groupId&gt;com.querydsl&lt;/groupId&gt;\n              &lt;artifactId&gt;querydsl-apt&lt;/artifactId&gt;\n              &lt;version&gt;${querydsl.version}&lt;/version&gt;\n              &lt;classifier&gt;jakarta&lt;/classifier&gt;\n            &lt;/path&gt;\n            &lt;!-- JPA meta-models --&gt;\n            &lt;path&gt;\n              &lt;groupId&gt;jakarta.persistence&lt;/groupId&gt;\n              &lt;artifactId&gt;jakarta.persistence-api&lt;/artifactId&gt;\n              &lt;version&gt;${jakarta-persistence.version}&lt;/version&gt;\n            &lt;/path&gt;\n            &lt;!-- Lombok --&gt;\n            &lt;path&gt;\n              &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n              &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n              &lt;version&gt;${lombok.version}&lt;/version&gt;\n            &lt;/path&gt;\n          &lt;/annotationProcessorPaths&gt;\n\n        &lt;/configuration&gt;\n      &lt;/plugin&gt;\n    &lt;/plugins&gt;\n  &lt;/build&gt;\n</code></pre>\n<p>This issue happens both when building with IntelliJ and when running Maven from the CLI. What’s most confusing is that it feels random: sometimes a mvn clean verify run completes successfully, but other times the exact same command fails with the compilation errors described above. When it gets into this broken state, I can’t seem to fix it without lots of trial and error, and I end up unable to launch the application locally.</p>\n<p>Also, the github actions pipelines that run the test/integration and sonar never fails. The same with deploying the dockerized app to cloud, it never fails and runs as expected. It seems to be a problem on local.</p>\n<hr />\n<p><strong>Environment</strong></p>\n<ul>\n<li>Maven 3.x</li>\n<li>JDK 21</li>\n<li>MapStruct 1.5.5.Final</li>\n<li>Lombok 1.18.38</li>\n<li>QueryDSL 5.1.0</li>\n</ul>\n<hr />\n<p><strong>Questions</strong></p>\n<ol>\n<li>Why is MapStruct sometimes generating broken implementations?</li>\n<li>Do I need to configure something special in the output-adapters pom.xml because it uses Q-classes from another module (bbdd)?</li>\n<li>Could this be related to incremental compilation or annotation processor ordering (Lombok + MapStruct + QueryDSL)?</li>\n<li>What is the correct way to configure annotation processors in a multi-module Maven project so MapStruct always sees the right types?</li>\n</ol>\n<p>I pretty much tried everything. Moving away from queryDls, disabling incremental compilation, trying lots different maven configurations... but mapstruct .classes always starts to fail at some point</p>\n",
    "tags" : [ "java", "spring", "maven", "lombok", "mapstruct" ],
    "owner" : {
      "account_id" : 14704546,
      "reputation" : 19,
      "user_id" : 31358116,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-CxN6HILjBnM/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbCQ4CgFppcdlMMud1n1ilkCN2PHpg/mo/s256-rj/photo.jpg",
      "display_name" : "Sergio Bernal",
      "link" : "https://stackoverflow.com/users/31358116/sergio-bernal"
    },
    "is_answered" : false,
    "view_count" : 102,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1756287665,
    "creation_date" : 1756274240,
    "link" : "https://stackoverflow.com/questions/79747585/mapstruct-generated-classes-compile-with-errors-in-multi-module-maven-project",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}