{
  "question" : {
    "question_id" : 79767953,
    "title" : "Duplicating clickable icon on pdf while using PdfFileAttachmentAnnotation from Itext7",
    "body" : "<p><a href=\"https://i.sstatic.net/JgP8PT2C.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/JgP8PT2C.png\" alt=\"enter image description here\" /></a></p>\n<p>this is method where a new icon is being inserted into pdf using rectangle cordinates. But it creates two icons one with clickable to download the document and other just an image.</p>\n<pre><code>private boolean attachExcelSheet1(Order order, PdfDocument pdfDocument, PdfPage pdfPage, ByteArrayOutputStream excelFile, String detailLink) {\n        int y = order.getMajorVersion().getValue() &gt; 0 ? 283 : 330;\n        Rectangle rect = new Rectangle(574, 204, 5, 5);\n        byte[] embeddedFileContentBytes = excelFile.toByteArray();\n        String fileName = detailLink + order.getOrderRevision() + &quot;.xlsx&quot;;\n        PdfFileSpec fs = PdfFileSpec.createEmbeddedFileSpec(pdfDocument, embeddedFileContentBytes, null, fileName, null, null);\n        PdfAnnotation attachment = new PdfFileAttachmentAnnotation(rect, fs)\n                .setContents(String.format(&quot;%s %s&quot;, detailLink, order.getOrderRevision()));\n        pdfPage.addAnnotation(attachment);\n        return true;\n    }\n</code></pre>\n<p><a href=\"https://i.sstatic.net/cwe4wAlg.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/cwe4wAlg.png\" alt=\"enter image description here\" /></a></p>\n",
    "tags" : [ "java", "html", "css", "pdf", "itext" ],
    "owner" : {
      "account_id" : 14628298,
      "reputation" : 25,
      "user_id" : 10564972,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-XTBxuH8oGJQ/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbBrxl3HWsilFN1ahAePE0SxSlam_Q/mo/s256-rj/photo.jpg",
      "display_name" : "raj",
      "link" : "https://stackoverflow.com/users/10564972/raj"
    },
    "is_answered" : true,
    "view_count" : 73,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1758172759,
    "creation_date" : 1758165266,
    "link" : "https://stackoverflow.com/questions/79767953/duplicating-clickable-icon-on-pdf-while-using-pdffileattachmentannotation-from-i",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79768001,
    "question_id" : 79767953,
    "body" : "<p>This is a common issue when using <code>PdfFileAttachmentAnnotation</code> from iText7. The duplicate icons occur because iText7 can create both a visual representation and the actual clickable annotation. Here's how to fix it:</p>\n<pre><code>private boolean attachExcelSheet1(Order order, PdfDocument pdfDocument, PdfPage pdfPage, ByteArrayOutputStream excelFile, String detailLink) {\n    int y = order.getMajorVersion().getValue() &gt; 0 ? 283 : 330;\n    Rectangle rect = new Rectangle(574, 204, 20, 20);\n    \n    byte[] embeddedFileContentBytes = excelFile.toByteArray();\n    String fileName = detailLink + order.getOrderRevision() + &quot;.xlsx&quot;;\n    \n    PdfFileSpec fs = PdfFileSpec.createEmbeddedFileSpec(\n        pdfDocument, \n        embeddedFileContentBytes, \n        null, \n        fileName, \n        PdfName.ApplicationVndOpenxmlformatsOfficedocumentSpreadsheetmlSheet,\n        null\n    );\n    \n    PdfFileAttachmentAnnotation attachment = new PdfFileAttachmentAnnotation(rect, fs)\n            .setContents(String.format(&quot;%s %s&quot;, detailLink, order.getOrderRevision()))\n            .setName(PdfName.Paperclip)           \n            .setIconName(PdfName.Paperclip);     \n    \n    attachment.getPdfObject().remove(PdfName.AP);\n   \n    attachment.setFlag(PdfAnnotation.PRINT);\n    attachment.setFlag(PdfAnnotation.NO_ZOOM);\n    \n    pdfPage.addAnnotation(attachment);\n    return true;\n}\n</code></pre>\n<p><strong>Larger Rectangle</strong>: Changed from <code>5x5</code> to <code>20x20</code> for better visibility and proper rendering</p>\n<p><strong>Explicit Icon Setting</strong>: Added <code>.setName()</code> and <code>.setIconName()</code> to avoid default behavior</p>\n<p><strong>Remove Appearance Dictionary</strong>: <code>attachment.getPdfObject().remove(PdfName.AP)</code> prevents visual conflicts</p>\n<p><strong>Annotation Flags</strong>: Added <code>PRINT</code> and <code>NO_ZOOM</code> flags for consistent behavior</p>\n<p><strong>MIME Type</strong>: Added proper MIME type for Excel files</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 25321798,
      "reputation" : 179,
      "user_id" : 19142963,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GjTLGdUh41yKLfMg2IlVESBOTd9IfcS65KcMD0rYQ=k-s256",
      "display_name" : "Mohsin Raza",
      "link" : "https://stackoverflow.com/users/19142963/mohsin-raza"
    },
    "creation_date" : 1758172759,
    "last_activity_date" : 1758172759,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79768001" : [ {
      "comment_id" : 140744150,
      "post_id" : 79768001,
      "body" : "<i>&quot;Remove Appearance Dictionary&quot;</i> - Beware, if you are creating a PDF 2.0 document, annotation appearances are required.",
      "score" : 2,
      "owner" : {
        "account_id" : 1916831,
        "reputation" : 96983,
        "user_id" : 1729265,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/VMMeP.jpg?s=256",
        "display_name" : "mkl",
        "link" : "https://stackoverflow.com/users/1729265/mkl"
      },
      "creation_date" : 1758180167,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}