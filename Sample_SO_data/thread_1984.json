{
  "question" : {
    "question_id" : 79658400,
    "title" : "how to return Flux&lt;T&gt; as ResponseEntity in Spring Web Flux",
    "body" : "<p>I am unable to return <code>Flux&lt;T&gt;</code> in <code>ResponseEntity</code>. In my repository I return <code>Flux&lt;Student&gt;</code>. Now I want to handle this response in controller with <code>switchIfEmpty</code> to handle <code>404</code> error code using <code>switchIfEmpty</code>. Below is what I tried:</p>\n<p><strong>repository</strong></p>\n<pre><code>public interface StudentRepository extends R2dbcRepository&lt;Student, Integer&gt;{\n\n    Flux&lt;Student&gt; findByFirstName(String firstName);\n    \n}\n</code></pre>\n<p><strong>service</strong></p>\n<pre><code>public Flux&lt;Student&gt; getStudentByName(String name){\n        return repo.findByFirstName(name);\n    }\n</code></pre>\n<p><strong>Controller</strong> (this is where I am not able produce response)</p>\n<pre><code>@GetMapping(value=&quot;student/name/{name}&quot;)\n    public Flux&lt;ResponseEntity&lt;Student&gt;&gt; getStudentByName(@PathVariable(name = &quot;name&quot;,required = true)String name) {\n        Flux&lt;ResponseEntity&lt;Student&gt;&gt; map = service.getStudentByName(name)\n                .switchIfEmpty(Mono.error(new NoSuchElementException(&quot;student not found&quot;))) \n                .map(stu-&gt;new ResponseEntity&lt;&gt;(Mono.just(stu),HttpStatus.OK));\n    return map;\n    }\n</code></pre>\n<p>As I was getting <code>Only a single ResponseEntity supported</code> I tried with below code:</p>\n<pre><code>@GetMapping(value=&quot;student/name/{name}&quot;)\n    public Flux&lt;ResponseEntity&lt;Student&gt;&gt; getStudentByName(@PathVariable(name = &quot;name&quot;,required = true)String name) {\n         Flux&lt;ResponseEntity&lt;Student&gt;&gt; flatMap = service.getStudentByName(name)\n        .switchIfEmpty(Mono.error(new NoSuchElementException(&quot;student not found&quot;))) \n        .flatMap(stu-&gt;Flux.just(new ResponseEntity&lt;Student&gt;(stu,HttpStatus.OK)));\n        return flatMap;\n    }\n</code></pre>\n<p>I am still getting same exception i.e. <code>Only a single ResponseEntity supported</code></p>\n<p>I have handled <code>NoSuchElementException</code> as global exception.</p>\n<p>How do I return <code>Flux&lt;Student&gt;</code> wrapped inside <code>ResponseEntity</code>.. or vice versa as <code>ResponseEntity</code> wrapped inside <code>Flux</code>. What approach should I go with to return Flux object.</p>\n",
    "tags" : [ "java", "spring-boot", "spring-webflux", "spring-boot-reactive" ],
    "owner" : {
      "account_id" : 4176295,
      "reputation" : 1273,
      "user_id" : 3422726,
      "user_type" : "registered",
      "accept_rate" : 55,
      "profile_image" : "https://i.sstatic.net/L35fT.jpg?s=256",
      "display_name" : "JPG",
      "link" : "https://stackoverflow.com/users/3422726/jpg"
    },
    "is_answered" : false,
    "view_count" : 93,
    "answer_count" : 2,
    "score" : 1,
    "last_activity_date" : 1749455228,
    "creation_date" : 1749448467,
    "link" : "https://stackoverflow.com/questions/79658400/how-to-return-fluxt-as-responseentity-in-spring-web-flux",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79658510,
    "question_id" : 79658400,
    "body" : "<p>below code resolved my problem.</p>\n<pre><code>    @GetMapping(value=&quot;student/name/{name}&quot;,produces = &quot;text/event-stream&quot;)\n    public ResponseEntity&lt;Flux&lt;Student&gt;&gt; getStudentByName(@PathVariable(name = &quot;name&quot;,required = true)String name) {\n        Flux&lt;Student&gt; flatMap2 = service.getStudentByName(name)\n                .switchIfEmpty(Mono.error(new NoSuchElementException(&quot;student not found&quot;))) \n                .flatMap(stu-&gt;Flux.just(stu));\n\n        return new ResponseEntity&lt;Flux&lt;Student&gt;&gt;(flatMap2,HttpStatus.OK);\n    }\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 4176295,
      "reputation" : 1273,
      "user_id" : 3422726,
      "user_type" : "registered",
      "accept_rate" : 55,
      "profile_image" : "https://i.sstatic.net/L35fT.jpg?s=256",
      "display_name" : "JPG",
      "link" : "https://stackoverflow.com/users/3422726/jpg"
    },
    "creation_date" : 1749454444,
    "last_activity_date" : 1749454444,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79658529,
    "question_id" : 79658400,
    "body" : "<p>You should be able to return a <code>Flux&lt;Student&gt;</code> directly just as you did in the service, without wrapping it in a <code>ResponseEntity</code>, more so because you hardcoded the status code. That said, returning HTTP 200 when the resource is not found is a fly in the face of REST.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 446597,
      "reputation" : 25249,
      "user_id" : 839733,
      "user_type" : "registered",
      "accept_rate" : 69,
      "profile_image" : "https://i.sstatic.net/2s6lO.jpg?s=256",
      "display_name" : "Abhijit Sarkar",
      "link" : "https://stackoverflow.com/users/839733/abhijit-sarkar"
    },
    "creation_date" : 1749455228,
    "last_activity_date" : 1749455228,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140499566,
    "post_id" : 79658400,
    "body" : "A <code>Flux&lt;ResponseEntity&lt;Student&gt;</code> doesn&#39;t really make sense a http response can only have a single status not multiple. You should have a <code>ResponseEntity&lt;Flux&lt;Student&gt;&gt;</code>. Next to that what you are returning isn&#39;t a <code>Flux&lt;ResponseEntity&lt;Student&gt;&gt;</code> either, looking at your mapping it is more of a <code>Flux&lt;ResponseEntity&lt;Mono&lt;Student&gt;&gt;&gt;</code>. Which is even more illogical.",
    "score" : 1,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126800,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1749482369,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140498963,
    "post_id" : 79658400,
    "body" : "Best to avoid using spring webflux.",
    "score" : 0,
    "owner" : {
      "account_id" : 4688171,
      "reputation" : 11611,
      "user_id" : 3795036,
      "user_type" : "registered",
      "accept_rate" : 88,
      "profile_image" : "https://i.sstatic.net/eM2E2.png?s=256",
      "display_name" : "K.Nicholas",
      "link" : "https://stackoverflow.com/users/3795036/k-nicholas"
    },
    "creation_date" : 1749468941,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79658529" : [ {
      "comment_id" : 140501522,
      "post_id" : 79658529,
      "body" : "ok @Toerktumlare I noted your both points. Also I am seeing some more approaches of handling exceptions discussed here <a href=\"https://stackoverflow.com/a/53596358/3422726\">stackoverflow.com/a/53596358/3422726</a>",
      "score" : 0,
      "owner" : {
        "account_id" : 4176295,
        "reputation" : 1273,
        "user_id" : 3422726,
        "user_type" : "registered",
        "accept_rate" : 55,
        "profile_image" : "https://i.sstatic.net/L35fT.jpg?s=256",
        "display_name" : "JPG",
        "link" : "https://stackoverflow.com/users/3422726/jpg"
      },
      "creation_date" : 1749541640,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140500256,
      "post_id" : 79658529,
      "body" : "@jpg Returning 404 tells the calling client that the endpoint called does not exist. Meaning, If you insist on return a flux with students, you should returning a empty list if someone asks for students that dont exist. Not 404",
      "score" : 1,
      "owner" : {
        "account_id" : 2064278,
        "reputation" : 15073,
        "user_id" : 1840146,
        "user_type" : "registered",
        "accept_rate" : 86,
        "profile_image" : "https://i.sstatic.net/JXdxm.png?s=256",
        "display_name" : "Toerktumlare",
        "link" : "https://stackoverflow.com/users/1840146/toerktumlare"
      },
      "creation_date" : 1749496395,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140500254,
      "post_id" : 79658529,
      "body" : "@jpg if you are returning a Flux&lt;Student&gt; you are implicitly stating that there could be multiple Students returned. Depending on the mediatype set. if mediatype header is set to <code>application&#47;json</code> webflux will buffer the returned students and when all are buffered it will return a list of students. if set to <code>text&#47;event-stream</code> server will return students on by one as a server sent event (SSE stream). And if <code>application&#47;stream+json</code> it will stream new line delimited json objects.",
      "score" : 1,
      "owner" : {
        "account_id" : 2064278,
        "reputation" : 15073,
        "user_id" : 1840146,
        "user_type" : "registered",
        "accept_rate" : 86,
        "profile_image" : "https://i.sstatic.net/JXdxm.png?s=256",
        "display_name" : "Toerktumlare",
        "link" : "https://stackoverflow.com/users/1840146/toerktumlare"
      },
      "creation_date" : 1749496381,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140498622,
      "post_id" : 79658529,
      "body" : "Mr. Sarkar, actually when the resource is not found, I am checking it inside <code>switchIfEmpty</code> and redirecting it to global exception handling for 404 status. Also if any other exception occurs. But you have raised a good question on how to handle errors in reactive, means there is something <code>onError</code>. How to use that with REST.",
      "score" : 0,
      "owner" : {
        "account_id" : 4176295,
        "reputation" : 1273,
        "user_id" : 3422726,
        "user_type" : "registered",
        "accept_rate" : 55,
        "profile_image" : "https://i.sstatic.net/L35fT.jpg?s=256",
        "display_name" : "JPG",
        "link" : "https://stackoverflow.com/users/3422726/jpg"
      },
      "creation_date" : 1749458992,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}