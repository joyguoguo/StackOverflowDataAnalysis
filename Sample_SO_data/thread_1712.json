{
  "question" : {
    "question_id" : 79681720,
    "title" : "Spring Boot on Azure Service Fabric: Application Parameters not resolving in Environment Variables",
    "body" : "<p>I'm deploying a Spring Boot application to an Azure Service Fabric cluster (running locally). My goal is to pass Azure Key Vault access credentials (Tenant ID, Client ID, Client Secret, Key Vault URI) as application parameters during deployment, and have my Spring Boot application pick them up as environment variables.</p>\n<p>However, despite defining the parameters in my ApplicationManifest.xml and referencing them in ServiceManifest.xml's EnvironmentVariables section, the Spring Boot application starts and logs the placeholder strings (e.g., [AZURE_CLIENT_SECRET]) instead of the actual values, leading to a java.lang.ExceptionInInitializerError: null during startup (likely due to failed Key Vault initialization).</p>\n<p>Here is my ApplicationManifest.xml,</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;ApplicationManifest  ApplicationTypeName=&quot;ebxml-demoType&quot; ApplicationTypeVersion=&quot;1.0.0&quot;\n                      xmlns=&quot;http://schemas.microsoft.com/2011/01/fabric&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;\n   \n   &lt;Parameters&gt;\n      &lt;Parameter Name=&quot;DataEnciphermentCertThumbprint&quot; DefaultValue=&quot;&quot; /&gt;\n      &lt;Parameter Name=&quot;AzureTenantId&quot; DefaultValue=&quot;&quot; /&gt;\n      &lt;Parameter Name=&quot;AzureClientId&quot; DefaultValue=&quot;&quot; /&gt;\n      &lt;Parameter Name=&quot;AzureClientSecret&quot; DefaultValue=&quot;&quot;/&gt;\n      &lt;Parameter Name=&quot;AzureKeyVaultUri&quot; DefaultValue=&quot;&quot; /&gt;\n      &lt;Parameter Name=&quot;ServerPort&quot; DefaultValue=&quot;&quot; /&gt;\n   &lt;/Parameters&gt;\n\n   &lt;ServiceManifestImport&gt;\n      &lt;ServiceManifestRef ServiceManifestName=&quot;ebxml-servicePkg&quot; ServiceManifestVersion=&quot;1.0.0&quot; /&gt;\n      &lt;ConfigOverrides&gt;\n        &lt;ConfigOverride Name=&quot;Config&quot;&gt;\n          &lt;Settings&gt;\n            &lt;Section Name=&quot;EnvironmentVariablesSection&quot;&gt; \n              &lt;Parameter Name=&quot;AZURE_TENANT_ID&quot; Value=&quot;[AzureTenantId]&quot; /&gt;\n              &lt;Parameter Name=&quot;AZURE_CLIENT_ID&quot; Value=&quot;[AzureClientId]&quot; /&gt;\n              &lt;Parameter Name=&quot;AZURE_CLIENT_SECRET&quot; Value=&quot;[AzureClientSecret]&quot; /&gt;\n              &lt;Parameter Name=&quot;AZURE_KEYVAULT_ENDPOINT&quot; Value=&quot;[AzureKeyVaultUri]&quot; /&gt;\n              &lt;Parameter Name=&quot;SERVER_PORT&quot; Value=&quot;[ServerPort]&quot; /&gt;\n            &lt;/Section&gt;\n          &lt;/Settings&gt;\n        &lt;/ConfigOverride&gt;\n      &lt;/ConfigOverrides&gt;\n   &lt;/ServiceManifestImport&gt;\n   \n   &lt;DefaultServices&gt;\n      &lt;Service Name=&quot;ebxml-service&quot;&gt;\n         &lt;StatelessService ServiceTypeName=&quot;ebxml-serviceType&quot; InstanceCount=&quot;1&quot;&gt;\n            &lt;SingletonPartition /&gt;\n         &lt;/StatelessService&gt;\n      &lt;/Service&gt;\n   &lt;/DefaultServices&gt;\n   \n&lt;/ApplicationManifest&gt;\n</code></pre>\n<p>Here is the ServiceManifest.xml,</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;ServiceManifest Name=&quot;ebxml-servicePkg&quot; Version=&quot;1.0.0&quot;\n                 xmlns=&quot;http://schemas.microsoft.com/2011/01/fabric&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; &gt;\n\n   &lt;ServiceTypes&gt;\n      &lt;StatelessServiceType ServiceTypeName=&quot;ebxml-serviceType&quot; UseImplicitHost=&quot;true&quot;&gt;\n   &lt;/StatelessServiceType&gt;\n   &lt;/ServiceTypes&gt;\n   \n   &lt;CodePackage Name=&quot;code&quot; Version=&quot;1.0.0&quot;&gt;\n      &lt;EntryPoint&gt;\n         &lt;ExeHost&gt;\n            &lt;Program&gt;jre/bin/java&lt;/Program&gt;\n            &lt;Arguments&gt;-jar service-fab-deployment-0.0.1-SNAPSHOT.jar&lt;/Arguments&gt;\n            &lt;WorkingFolder&gt;CodePackage&lt;/WorkingFolder&gt;\n            &lt;ConsoleRedirection FileRetentionCount=&quot;5&quot; FileMaxSizeInKb=&quot;2048&quot; /&gt;\n         &lt;/ExeHost&gt;\n      &lt;/EntryPoint&gt;\n      \n      &lt;EnvironmentVariables&gt;\n          &lt;EnvironmentVariable Name=&quot;AZURE_TENANT_ID&quot; Value=&quot;[AZURE_TENANT_ID]&quot; /&gt;\n          &lt;EnvironmentVariable Name=&quot;AZURE_CLIENT_ID&quot; Value=&quot;[AZURE_CLIENT_ID]&quot; /&gt;\n          &lt;EnvironmentVariable Name=&quot;AZURE_CLIENT_SECRET&quot; Value=&quot;[AZURE_CLIENT_SECRET]&quot; /&gt;\n          &lt;EnvironmentVariable Name=&quot;AZURE_KEYVAULT_ENDPOINT&quot; Value=&quot;[AZURE_KEYVAULT_ENDPOINT]&quot; /&gt;\n          &lt;EnvironmentVariable Name=&quot;SERVER_PORT&quot; Value=&quot;[SERVER_PORT]&quot; /&gt;\n      &lt;/EnvironmentVariables&gt;\n   &lt;/CodePackage&gt;\n\n   &lt;ConfigPackage Name=&quot;Config&quot; Version=&quot;1.0.0&quot; /&gt;\n &lt;/ServiceManifest&gt;\n</code></pre>\n<p>The Settings.xml looks like,</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;Settings xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://schemas.microsoft.com/2011/01/fabric&quot;&gt;\n  &lt;Section Name=&quot;EnvironmentVariablesSection&quot;&gt;\n    &lt;Parameter Name=&quot;AZURE_TENANT_ID&quot; Value=&quot;&quot; /&gt;\n    &lt;Parameter Name=&quot;AZURE_CLIENT_ID&quot; Value=&quot;&quot; /&gt;\n    &lt;Parameter Name=&quot;AZURE_CLIENT_SECRET&quot; Value=&quot;&quot; /&gt;\n    &lt;Parameter Name=&quot;AZURE_KEYVAULT_ENDPOINT&quot; Value=&quot;&quot; /&gt;\n    &lt;Parameter Name=&quot;SERVER_PORT&quot; Value=&quot;&quot; /&gt;\n  &lt;/Section&gt;\n&lt;/Settings&gt;\n</code></pre>\n<p>I'm starting the app using this command,</p>\n<pre><code>New-ServiceFabricApplication -ApplicationName &quot;fabric:/ebxml-demo&quot; -ApplicationTypeName &quot;ebxml-demoType&quot; -ApplicationTypeVersion &quot;1.0.0&quot; `\n          -ApplicationParameter @{\n            &quot;AzureTenantId&quot; = &quot;xxx&quot;;\n            &quot;AzureClientId&quot; = &quot;xxx&quot;;\n            &quot;AzureClientSecret&quot; = &quot;xxx&quot;;\n            &quot;AzureKeyVaultUri&quot; = &quot;https://xxx.vault.azure.net/&quot;;\n            &quot;ServerPort&quot; = &quot;8080&quot;;\n          }\n</code></pre>\n<p>In application.properties i have these, which are pass through with the command,</p>\n<pre><code>server.port=${SERVER_PORT}\nspring.cloud.azure.keyvault.secret.property-sources[0].endpoint=${AZURE_KEYVAULT_ENDPOINT}\nspring.cloud.azure.credential.client-id=${AZURE_CLIENT_ID}\nspring.cloud.azure.credential.client-secret=${AZURE_CLIENT_SECRET}\nspring.cloud.azure.profile.tenant-id=${AZURE_TENANT_ID}\n</code></pre>\n<p>And also these,</p>\n<pre><code>spring.datasource.url=${DatabaseURL}\nspring.datasource.username=${DBUsername}\nspring.datasource.password=${DBPassword}\n</code></pre>\n<p>Defined in Azure Key Vault in azure cloud,</p>\n<p>The spring boot app working when i pass secret as shown bellow in the ServiceManifest</p>\n<pre><code>EnvironmentVariables&gt; with this working\n         &lt;EnvironmentVariable Name=&quot;AZURE_TENANT_ID&quot; Value=&quot;a643a9bc-5060-4ef7-aee5-1590c466b2f3&quot; /&gt;\n         &lt;EnvironmentVariable Name=&quot;AZURE_CLIENT_ID&quot; Value=&quot;14713b12-de9e-4ede-8734-d29087674498&quot; /&gt;  \n         &lt;EnvironmentVariable Name=&quot;AZURE_CLIENT_SECRET&quot; Value=&quot;kaf8Q~uisnf_HpQkHJyreySZYCcZgZ53POt7AcKF&quot; /&gt;\n         &lt;EnvironmentVariable Name=&quot;AZURE_KEYVAULT_ENDPOINT&quot; Value=&quot;https://ebxml-sf-kv.vault.azure.net/&quot; /&gt;\n         &lt;EnvironmentVariable Name=&quot;SERVER_PORT&quot; Value=&quot;8080&quot; /&gt;\n      &lt;/EnvironmentVariables&gt;\n</code></pre>\n<p>Could you please guide me through this pointing what is I'm doing wring here ?</p>\n",
    "tags" : [ "java", "spring-boot", "azure", "environment-variables", "azure-service-fabric" ],
    "owner" : {
      "account_id" : 12157512,
      "reputation" : 35,
      "user_id" : 8876087,
      "user_type" : "registered",
      "profile_image" : "https://graph.facebook.com/1113630512102835/picture?type=large",
      "display_name" : "Saddeep Mihiranga",
      "link" : "https://stackoverflow.com/users/8876087/saddeep-mihiranga"
    },
    "is_answered" : true,
    "view_count" : 50,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1751162131,
    "creation_date" : 1751016838,
    "link" : "https://stackoverflow.com/questions/79681720/spring-boot-on-azure-service-fabric-application-parameters-not-resolving-in-env",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79683434,
    "question_id" : 79681720,
    "body" : "<p>I'm away from my work PC, so I believe this is correct, but you must set the default values in the Application Manifest and/or pass them in via the ApplicationParameters or StatupServiceParameters.<br />\nYou need to add the Environment Variables into the application Manifest with the ServiceManifestImport in order to tell it where to get the values from,.<br />\nYou seem to want to have them dynamically input via the application parameters, so that is what I've proposed as a fix.</p>\n<p>You are not trying this, but I could see you trying it, so fair warning: you cannot pass environmental variables or application parameters in the &lt;Arguments&gt; element; they will not be evaluated, and it's really dumb.</p>\n<p><strong>FIXED Service Manifest</strong></p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;ServiceManifest Name=&quot;ebxml-servicePkg&quot; Version=&quot;1.0.0&quot;\n                 xmlns=&quot;http://schemas.microsoft.com/2011/01/fabric&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; &gt;\n\n   &lt;ServiceTypes&gt;\n      &lt;StatelessServiceType ServiceTypeName=&quot;ebxml-serviceType&quot; UseImplicitHost=&quot;true&quot;&gt;\n   &lt;/StatelessServiceType&gt;\n   &lt;/ServiceTypes&gt;\n   \n   &lt;CodePackage Name=&quot;code&quot; Version=&quot;1.0.0&quot;&gt;\n      &lt;EntryPoint&gt;\n         &lt;ExeHost&gt;\n            &lt;Program&gt;jre/bin/java&lt;/Program&gt;\n            &lt;Arguments&gt;-jar service-fab-deployment-0.0.1-SNAPSHOT.jar&lt;/Arguments&gt;\n            &lt;WorkingFolder&gt;CodePackage&lt;/WorkingFolder&gt;\n            &lt;ConsoleRedirection FileRetentionCount=&quot;5&quot; FileMaxSizeInKb=&quot;2048&quot; /&gt;\n         &lt;/ExeHost&gt;\n      &lt;/EntryPoint&gt;\n   \n      &lt;EnvironmentVariables&gt;\n          &lt;EnvironmentVariable Name=&quot;AZURE_TENANT_ID&quot; Value=&quot;&quot; /&gt;\n          &lt;EnvironmentVariable Name=&quot;AZURE_CLIENT_ID&quot; Value=&quot;&quot; /&gt;\n          &lt;EnvironmentVariable Name=&quot;AZURE_CLIENT_SECRET&quot; Value=&quot;&quot; /&gt;\n          &lt;EnvironmentVariable Name=&quot;AZURE_KEYVAULT_ENDPOINT&quot; Value=&quot;&quot; /&gt;\n          &lt;EnvironmentVariable Name=&quot;SERVER_PORT&quot; Value=&quot;&quot; /&gt;\n      &lt;/EnvironmentVariables&gt;\n   &lt;/CodePackage&gt;\n   &lt;ConfigPackage Name=&quot;Config&quot; Version=&quot;1.0.0&quot; /&gt;\n &lt;/ServiceManifest&gt;\n</code></pre>\n<p><strong>FIXED Application Manifest</strong></p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;ApplicationManifest  ApplicationTypeName=&quot;ebxml-demoType&quot; ApplicationTypeVersion=&quot;1.0.0&quot;\n                      xmlns=&quot;http://schemas.microsoft.com/2011/01/fabric&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;\n   \n   &lt;Parameters&gt;\n      &lt;Parameter Name=&quot;DataEnciphermentCertThumbprint&quot; DefaultValue=&quot;&quot; /&gt;\n      &lt;Parameter Name=&quot;AzureTenantId&quot; DefaultValue=&quot;&quot; /&gt;\n      &lt;Parameter Name=&quot;AzureClientId&quot; DefaultValue=&quot;&quot; /&gt;\n      &lt;Parameter Name=&quot;AzureClientSecret&quot; DefaultValue=&quot;&quot;/&gt;\n      &lt;Parameter Name=&quot;AzureKeyVaultUri&quot; DefaultValue=&quot;&quot; /&gt;\n      &lt;Parameter Name=&quot;ServerPort&quot; DefaultValue=&quot;&quot; /&gt;\n   &lt;/Parameters&gt;\n\n   &lt;ServiceManifestImport&gt;\n      &lt;ServiceManifestRef ServiceManifestName=&quot;ebxml-servicePkg&quot; ServiceManifestVersion=&quot;1.0.0&quot; /&gt;\n        &lt;EnvironmentOverrides CodePackageRef=&quot;Code&quot;&gt;\n          &lt;EnvironmentVariable Name=&quot;AZURE_TENANT_ID&quot; Value=&quot;[AZURE_TENANT_ID]&quot; /&gt;\n         &lt;EnvironmentVariable Name=&quot;AZURE_CLIENT_ID&quot; Value=&quot;[AZURE_CLIENT_ID]&quot; /&gt;  \n         &lt;EnvironmentVariable Name=&quot;AZURE_CLIENT_SECRET&quot; Value=&quot;[AZURE_CLIENT_SECRET]&quot; /&gt;\n         &lt;EnvironmentVariable Name=&quot;AZURE_KEYVAULT_ENDPOINT&quot; Value=&quot;[AZURE_KEYVAULT_ENDPOINT]&quot; /&gt;\n         &lt;EnvironmentVariable Name=&quot;SERVER_PORT&quot; Value=&quot;[ServerPort]&quot; /&gt;\n        &lt;/EnvironmentOverrides&gt;\n      &lt;ConfigOverrides&gt;\n        &lt;ConfigOverride Name=&quot;Config&quot;&gt;\n          &lt;!-- Dont need this unless you are using the ServiceFabric SDK from within your app to access the configuration. --&gt;\n        &lt;/ConfigOverride&gt;\n      &lt;/ConfigOverrides&gt;\n   &lt;/ServiceManifestImport&gt;\n   &lt;DefaultServices&gt;\n      &lt;Service Name=&quot;ebxml-service&quot;&gt;\n         &lt;StatelessService ServiceTypeName=&quot;ebxml-serviceType&quot; InstanceCount=&quot;1&quot;&gt;\n            &lt;SingletonPartition /&gt;\n         &lt;/StatelessService&gt;\n      &lt;/Service&gt;\n   &lt;/DefaultServices&gt;\n   \n&lt;/ApplicationManifest&gt;\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 36784749,
      "reputation" : 26,
      "user_id" : 28846398,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/dbaac66ee1e695a4058a2cbf5b3a12a6?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jonathan Bland",
      "link" : "https://stackoverflow.com/users/28846398/jonathan-bland"
    },
    "creation_date" : 1751162018,
    "last_activity_date" : 1751162131,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}