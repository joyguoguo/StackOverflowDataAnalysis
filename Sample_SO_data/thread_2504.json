{
  "question" : {
    "question_id" : 79616076,
    "title" : "How to find which java.base runtime dependencies are being used by an application?",
    "body" : "<h3>Question</h3>\n<p>What are ways to systematically find all modules of the JDK that will be/have been used during the runtime of a Java application through reflection and the service provider model?</p>\n<h3>Clarifications</h3>\n<ul>\n<li>I am, to my understanding, not looking for the jdeps command unless someone has a particular set of arguments that can resolve reflected runtime-only dynamic dependencies, which does not seem to be its purpose.</li>\n<li>I already understand there is the <code>jlinks --suggest-providers</code> option, but this requires knowledge of each provider that is lacking.</li>\n</ul>\n<h3>Problem Summary</h3>\n<p>I've been working with a self-contained jar (for our current example code, the Paper Minecraft server, which has requirements to download a jar, the Minecraft jar, and patch it while running it). When I go to build a minimal Docker container for running the application using a runtime like Eclipse Temurin it is recommended:</p>\n<blockquote>\n<p>JRE images are available for all versions of Eclipse Temurin, but it is recommended that you produce a custom JRE-like runtime using jlink (see usage below).</p>\n</blockquote>\n<p>Their code sample:</p>\n<pre class=\"lang-none prettyprint-override\"><code># Example of custom Java runtime using jlink in a multi-stage container build\nFROM eclipse-temurin:21 as jre-build\n\n# Create a custom Java runtime\nRUN $JAVA_HOME/bin/jlink \\\n         --add-modules java.base \\\n         --strip-debug \\\n         --no-man-pages \\\n         --no-header-files \\\n         --compress=2 \\\n         --output /javaruntime\n\n# Define your base image\nFROM debian:buster-slim\nENV JAVA_HOME=/opt/java/openjdk\nENV PATH &quot;${JAVA_HOME}/bin:${PATH}&quot;\nCOPY --from=jre-build /javaruntime $JAVA_HOME\n\n# Continue with your application deployment\nRUN mkdir /opt/app\nCOPY japp.jar /opt/app\nCMD [&quot;java&quot;, &quot;-jar&quot;, &quot;/opt/app/japp.jar&quot;]\n</code></pre>\n<p>From: <a href=\"https://hub.docker.com/_/eclipse-temurin\" rel=\"nofollow noreferrer\">https://hub.docker.com/_/eclipse-temurin</a></p>\n<p>This build command in particular does not include any required service providers and runs into the common problem of searching for a laundry list of service providers from other modules such as <code>jdk.crypto.cryptoki</code> and <code>jdk.crypto.ec</code>, which are common requirements to complete even a basic HTTPS handshake for web requests.</p>\n<p>There is the option to simply use <code>--bind-services</code> to include every single module that could provide a service for java.base module, but as discussed <a href=\"https://stackoverflow.com/questions/48468111/jlink-service-binding-links-many-unnecessary-modules\">here</a>, this defeats the purpose of creating a slimmed-down JRE in the first place, as it includes everything.</p>\n<p>This introduces a weird and frustrating dance of running and breaking your application endlessly until you've found the exact 8-20 piece <code>--add-modules</code> argument to provide just enough services to run your application.</p>\n<p>I feel like there should be some form of profiler command or tool shipped with the jdk or potentially otherwise runnable alongside your application that can answer the question &quot;What jdk modules were used during your applications execution?&quot; not just <code>java.base</code> but &quot;<code>java.base</code> leveraged <code>jdk.crypto.cryptoki</code> during this execution&quot; to speed up the process of tracing all required modules for a slimmed down runtime.</p>\n<h3>Resources Already used</h3>\n<ul>\n<li><a href=\"https://docs.oracle.com/en/java/javase/21/docs/specs/man/jlink.html\" rel=\"nofollow noreferrer\">https://docs.oracle.com/en/java/javase/21/docs/specs/man/jlink.html</a></li>\n<li><a href=\"https://docs.oracle.com/en/java/javase/21/docs/specs/man/jdeps.html\" rel=\"nofollow noreferrer\">https://docs.oracle.com/en/java/javase/21/docs/specs/man/jdeps.html</a></li>\n<li><a href=\"https://hub.docker.com/_/eclipse-temurin\" rel=\"nofollow noreferrer\">https://hub.docker.com/_/eclipse-temurin</a></li>\n<li><a href=\"https://jaehong21.com/posts/java/java-jdeps-jlink/\" rel=\"nofollow noreferrer\">https://jaehong21.com/posts/java/java-jdeps-jlink/</a>\n<ul>\n<li>This blog is probably the most briefly summarized but also the most depth I've seen on the topic, all other guides/any AI slop (of which for this there is unfortunately much relative to the niche topic) pretty much says the same or similar and follows only the basic usage of the command as seen from it's documentation.</li>\n</ul>\n</li>\n<li><a href=\"https://stackoverflow.com/questions/48468111/jlink-service-binding-links-many-unnecessary-modules\">jlink: service binding links many unnecessary modules</a>\n<ul>\n<li>There were additional stack overflow questions but all summarized essentially the same usage.</li>\n</ul>\n</li>\n</ul>\n<h3>Disclaimer</h3>\n<p>I have searched through Stack Overflow questions, blogs, and JDK 21 documentation about JLinks and jdeps for about 6-7ish hours. I am happy to mark an answer correct if I have simply missed a crucial option referenced in another answer either but I have not managed to turn up an answer as of yet. Happy to add additional clarifications if needed. I may eventually write essentially a profiler to handle this, but I want to see if that already exists.</p>\n",
    "tags" : [ "java", "reflection", "jlink" ],
    "owner" : {
      "account_id" : 12407085,
      "reputation" : 61,
      "user_id" : 9041460,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-bsJ7rxh1PjU/AAAAAAAAAAI/AAAAAAAABRc/1d_dIHxhi5k/s256-rj/photo.jpg",
      "display_name" : "Matthew Fallon",
      "link" : "https://stackoverflow.com/users/9041460/matthew-fallon"
    },
    "is_answered" : true,
    "view_count" : 168,
    "answer_count" : 1,
    "score" : 4,
    "last_activity_date" : 1746961427,
    "creation_date" : 1746927280,
    "link" : "https://stackoverflow.com/questions/79616076/how-to-find-which-java-base-runtime-dependencies-are-being-used-by-an-applicatio",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79616114,
    "question_id" : 79616076,
    "body" : "<p>For Java 21,</p>\n<pre class=\"lang-java prettyprint-override\"><code>java -Xlog:class+load=info -cp your-app.jar com.myapp.Main\n</code></pre>\n<p>to show all modules attempted to be loaded.</p>\n<p>Filter from there for Java packages as needed.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 41904743,
      "reputation" : 11,
      "user_id" : 30503350,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/44c6eb6ea45ada93a2a74a7af01a5ba7?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Brandon Murry",
      "link" : "https://stackoverflow.com/users/30503350/brandon-murry"
    },
    "creation_date" : 1746931541,
    "last_activity_date" : 1746931541,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}