{
  "question" : {
    "question_id" : 79805146,
    "title" : "Issue using subquery .limit() with OpenFeign/QueryDSL 7.1 (Spring Boot 3.4.4) — LIMIT ignored in generated SQL",
    "body" : "<p>I’m using OpenFeign/QueryDSL 7.1 with Spring Boot 3.4.4, which should include the fix from this pull request:\n<a href=\"https://github.com/OpenFeign/querydsl/pull/1304\" rel=\"nofollow noreferrer\">Add support for subquery modifiers (LIMIT/OFFSET) in Hibernate by @DongGunYoon in #1304</a></p>\n<p>However, I’m still facing the same issue — the LIMIT clause in subqueries seems to be ignored. I’d appreciate any help understanding what I might be doing wrong or how to use it correctly.\nHere’s the setup and example:\nDependencies:</p>\n<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;io.github.openfeign.querydsl&lt;/groupId&gt;\n    &lt;artifactId&gt;querydsl-jpa&lt;/artifactId&gt;\n    &lt;version&gt;7.1&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n    &lt;groupId&gt;io.github.openfeign.querydsl&lt;/groupId&gt;\n    &lt;artifactId&gt;querydsl-apt&lt;/artifactId&gt;\n    &lt;version&gt;7.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>APT Plugin:</p>\n<pre><code>&lt;plugin&gt;\n    &lt;groupId&gt;com.mysema.maven&lt;/groupId&gt;\n    &lt;artifactId&gt;apt-maven-plugin&lt;/artifactId&gt;\n    &lt;version&gt;1.1.3&lt;/version&gt;\n    &lt;executions&gt;\n        &lt;execution&gt;\n            &lt;goals&gt;\n                &lt;goal&gt;process&lt;/goal&gt;\n            &lt;/goals&gt;\n            &lt;configuration&gt;\n                &lt;outputDirectory&gt;target/generated-sources/java&lt;/outputDirectory&gt;\n                &lt;processor&gt;com.querydsl.apt.jpa.JPAAnnotationProcessor&lt;/processor&gt;\n            &lt;/configuration&gt;\n        &lt;/execution&gt;\n    &lt;/executions&gt;\n&lt;/plugin&gt;\n</code></pre>\n<p>Example Query:</p>\n<pre><code>jpaQueryFactory.selectFrom(qVehicleLocation)\n    .innerJoin(qVehicleLocation.vehicle).fetchJoin()\n    .where(\n        qVehicleLocation.id.eq(\n            JPAExpressions.select(sub.id)\n                .from(sub)\n                .where(sub.vehicle.id.eq(qVehicleLocation.vehicle.id))\n                .orderBy(sub.createdAt.desc(), sub.id.desc())\n                .limit(1)\n        )\n    )\n    .fetch();\n</code></pre>\n<p>Generated sub_query SQL:</p>\n<pre><code>select vl2_0.id \nfrom vehicle_location vl2_0 \nwhere vl2_0.vehicle_id = vl1_0.vehicle_id \norder by vl2_0.created_at desc, vl2_0.id desc\n</code></pre>\n<p>As you can see, the LIMIT 1 is missing from the generated SQL.</p>\n<p>Could you please advise how to correctly apply LIMIT in a subquery with QueryDSL 7.1 and Hibernate?</p>\n<p>Thanks in advance for your help!</p>\n",
    "tags" : [ "java", "spring-boot", "querydsl", "feign", "openfeign" ],
    "owner" : {
      "account_id" : 44503430,
      "reputation" : 23,
      "user_id" : 31786889,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/8b429a2d44d9fd7a32b01eceb77e4496?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "user31786889",
      "link" : "https://stackoverflow.com/users/31786889/user31786889"
    },
    "is_answered" : true,
    "view_count" : 70,
    "answer_count" : 1,
    "score" : 2,
    "last_activity_date" : 1761853072,
    "creation_date" : 1761852211,
    "link" : "https://stackoverflow.com/questions/79805146/issue-using-subquery-limit-with-openfeign-querydsl-7-1-spring-boot-3-4-4",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79805156,
    "question_id" : 79805146,
    "body" : "<p>Have you tried notExists() instead of id.eq(JPAExpressions.select(...).limit(1)) ?</p>\n<pre><code>jpaQueryFactory\n    .selectFrom(qVehicleLocation)\n    .innerJoin(qVehicleLocation.vehicle).fetchJoin()\n    .where(\n        JPAExpressions.selectOne()\n            .from(subLocation)\n            .where(\n                subLocation.vehicle.eq(qVehicleLocation.vehicle),\n                subLocation.createdAt.gt(qVehicleLocation.createdAt)\n                .or(\n                    subLocation.createdAt.eq(qVehicleLocation.createdAt)\n                    .and(subLocation.id.gt(qVehicleLocation.id)) \n                )\n            )\n            .notExists()\n    )\n    .fetch();\n</code></pre>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 17553626,
      "reputation" : 523,
      "user_id" : 12733532,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-EAww28wDCxk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcgKS9dXdmUh-hOQPlZYZygBUfLwQ/s256-rj/photo.jpg",
      "display_name" : "Max",
      "link" : "https://stackoverflow.com/users/12733532/max"
    },
    "creation_date" : 1761853072,
    "last_activity_date" : 1761853072,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}