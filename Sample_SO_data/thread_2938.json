{
  "question" : {
    "question_id" : 79584320,
    "title" : "Unable to use SSL with RMI due to ConnectionException",
    "body" : "<p>I am unable to SSL with RMI due to a <code>ConnectException</code>. This is the error message:</p>\n<pre><code>Unexpected error: Connection refused to host: 10.101.37.128; nested exception is:\n        java.net.ConnectException: Connection refused\n</code></pre>\n<p>I created a keystore and truststore from a <a href=\"https://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html#CreateKeystore\" rel=\"nofollow noreferrer\">guide</a> and <a href=\"https://stackoverflow.com/a/19832475/13447006\">this</a> by Oracle. I copied the code and made changes based on my needs. Which resulted in the above error. The code at this point looks like this:</p>\n<p><strong>Register.java</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>import java.rmi.registry.LocateRegistry;\nimport java.rmi.registry.Registry;\n\nimport javax.rmi.ssl.SslRMIClientSocketFactory;\nimport javax.rmi.ssl.SslRMIServerSocketFactory;\n\npublic class Register {\n    public static void main(String[] args) throws Exception {\n        int port = 1040;\n        System.setProperty(&quot;javax.net.ssl.trustStore&quot;, &quot;client.truststore&quot;);\n        System.setProperty(&quot;javax.net.ssl.trustStorePassword&quot;, &quot;123123&quot;);\n\n        System.setProperty(&quot;javax.net.ssl.keyStore&quot;, &quot;server.keystore&quot;);\n        System.setProperty(&quot;javax.net.ssl.keyStorePassword&quot;, &quot;123123&quot;);\n\n        Registry reg = LocateRegistry.createRegistry(port, new SslRMIClientSocketFactory(),\n                new SslRMIServerSocketFactory());\n\n        Server server = new Server();\n        reg.rebind(&quot;orderingsystem&quot;, server);\n\n        System.out.println(&quot;Server running&quot;);\n    }\n}\n</code></pre>\n<p><strong>RemoteInterface.java</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>import java.rmi.*;\nimport java.sql.SQLException;\n\npublic interface RemoteInterface extends Remote {\n    public boolean loginUser() throws RemoteException, SQLException;\n}\n</code></pre>\n<p><strong>Server.java</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>import java.rmi.RemoteException;\nimport java.rmi.server.UnicastRemoteObject;\n\nimport java.sql.SQLException;\n\nimport javax.rmi.ssl.SslRMIClientSocketFactory;\nimport javax.rmi.ssl.SslRMIServerSocketFactory;\n\npublic class Server extends UnicastRemoteObject implements RemoteInterface {\n    public Server() throws RemoteException {\n        super(0, new SslRMIClientSocketFactory(), new SslRMIServerSocketFactory());\n    }\n\n    @Override\n    public boolean loginUser() throws RemoteException, SQLException {\n        return true;\n    }\n}\n</code></pre>\n<p><strong>App.java</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>import java.rmi.registry.LocateRegistry;\nimport java.rmi.registry.Registry;\n\npublic class App {\n    public static void main(String[] args) {\n        try {\n            Registry registry = LocateRegistry.getRegistry(&quot;orderingsystem&quot;, 1040);\n            RemoteInterface obj = (RemoteInterface) registry.lookup(&quot;orderingsystem&quot;);\n            obj.loginUser();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n\n</code></pre>\n<p>I did some more searching and I found <a href=\"https://stackoverflow.com/questions/21586660/simple-rmi-server-with-ssl\">this</a> question and I updated my code accordingly. However, I get the same error just the hostname is different.</p>\n<pre><code>Unexpected error: Unknown host: orderingsystem; nested exception is:\njava.net.UnknownHostException: orderingsystem\n\n</code></pre>\n<p>Then I thought, it may be this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>super(0, new SslRMIClientSocketFactory(), new SslRMIServerSocketFactory(null, null, true));\n</code></pre>\n<p>So I updated it to just</p>\n<pre class=\"lang-java prettyprint-override\"><code>super(0, new SslRMIClientSocketFactory(), new SslRMIServerSocketFactory());\n</code></pre>\n<p>But it didn't matter. The other resources I found is:</p>\n<p><a href=\"https://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/samples/index.html\" rel=\"nofollow noreferrer\">this</a> document by Oracle. Specifically I followed the Hello.java, HelloClient.java and HelloImpl.java files. Which lead me to a different error.</p>\n<pre><code>java.rmi.ConnectIOException: non-JRMP server at remote endpoint\n        at java.rmi/sun.rmi.transport.tcp.TCPChannel.createConnection(TCPChannel.java:252)\n        at java.rmi/sun.rmi.transport.tcp.TCPChannel.newConnection(TCPChannel.java:204)\n        at java.rmi/sun.rmi.server.UnicastRef.newCall(UnicastRef.java:344)\n        at java.rmi/sun.rmi.registry.RegistryImpl_Stub.lookup(RegistryImpl_Stub.java:116)\n        at dcoms.App.main(App.java:13)\n</code></pre>\n<p>So, I followed <a href=\"https://stackoverflow.com/a/19832475/13447006\">this</a> answer but didn't apply because in the <strong>App.java</strong> file I'm using the method in my <code>getReigstry</code> method to supply the hostname, I also updated the port number so that it doesn't use 1040 just in case it was occupied. So here is the updated <strong>App.java</strong> and <strong>Registry.java</strong>.</p>\n<p><strong>App.java</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>import java.net.InetAddress;\nimport java.rmi.registry.LocateRegistry;\nimport java.rmi.registry.Registry;\n\npublic class App {\n    public static void main(String[] args) {\n        try {\n            Registry registry = LocateRegistry.getRegistry(InetAddress.getLocalHost().getHostName(), 9999);\n            RemoteInterface obj = (RemoteInterface) registry.lookup(&quot;OrderSystem&quot;);\n            obj.loginUser();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre>\n<p><strong>App.java</strong> is based on <a href=\"https://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/samples/rmi/HelloClient.java\" rel=\"nofollow noreferrer\">HelloClient.java</a> also by Oracle.</p>\n<p><strong>Register.java</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>package dcoms.remote;\n\nimport java.rmi.registry.LocateRegistry;\nimport java.rmi.registry.Registry;\n\nimport javax.rmi.ssl.SslRMIClientSocketFactory;\nimport javax.rmi.ssl.SslRMIServerSocketFactory;\n\npublic class Register {\n    public static void main(String[] args) throws Exception {\n        int port = 9999;\n\n        System.setProperty(&quot;javax.net.ssl.keyStore&quot;, &quot;keystore&quot;);\n        System.setProperty(&quot;javax.net.ssl.keyStorePassword&quot;, &quot;123123&quot;);\n\n        System.setProperty(&quot;javax.net.ssl.trustStore&quot;, &quot;truststore&quot;);\n        System.setProperty(&quot;javax.net.ssl.trustStorePassword&quot;, &quot;123123&quot;);\n\n        Registry reg = LocateRegistry.createRegistry(port, new SslRMIClientSocketFactory(),\n                new SslRMIServerSocketFactory());\n\n        Server server = new Server();\n        reg.rebind(&quot;OrderSystem&quot;, server);\n\n        System.out.println(&quot;Server running&quot;);\n    }\n}\n</code></pre>\n<p>Other solutions I've found don't do much for me.</p>\n<ul>\n<li><a href=\"https://developer.jboss.org/thread/30629\" rel=\"nofollow noreferrer\">https://developer.jboss.org/thread/30629</a> - The asker also has the same problem but it ends up talking about JBoss, not sure what that is even after looking at its wikipedia.</li>\n<li><a href=\"https://groups.google.com/g/prometheus-users/c/Z5SncOuRKeQ?pli=1\" rel=\"nofollow noreferrer\">https://groups.google.com/g/prometheus-users/c/Z5SncOuRKeQ?pli=1</a> - Same problem but for something called JMX exporter. The asker edited some config file, likely doesn't apply because I'm not using JMX exporter.</li>\n<li><a href=\"https://access.redhat.com/solutions/1436233\" rel=\"nofollow noreferrer\">https://access.redhat.com/solutions/1436233</a> - RedHat gave a solution on how to solve the error and is related to JBoss so doesn't apply since my project doesn't even use it.</li>\n<li><a href=\"https://stackoverflow.com/a/3580314/13447006\">https://stackoverflow.com/a/3580314/13447006</a> - Which is turning on SSL but I have no idea what that means. I ended up searching for &quot;Turn on SSL Java RMI&quot; and its about creating a keystore, truststore and certificate. But I already have these files and have been using them so I'm not sure what's going on.</li>\n<li><a href=\"https://stackoverflow.com/questions/35378293/root-exception-is-java-rmi-connectioexception-non-jrmp-server-at-remote-endpoin\">Root exception is java.rmi.ConnectIOException: non-JRMP server at remote endpoint</a> - This is about something called JMS.</li>\n</ul>\n<p>At this point, I'm pretty lost. I even tried recreating the keystore, truststore and cert but same problem. If it matters I made the keystore, truststore and cert like this:</p>\n<pre><code>keytool -genkeypair \\\n  -alias server \\\n  -keyalg RSA \\\n  -keysize 2048 \\\n  -keystore server.keystore \\\n  -validity 365\n\nkeytool -exportcert \\\n  -alias server \\\n  -keystore server.keystore \\\n  -file server.crt\n\nkeytool -importcert \\\n  -alias server \\\n  -file server.crt \\\n  -keystore client.truststore\n</code></pre>\n<p>These are the four files in the project in their final form for your convenience.</p>\n<p><strong>Register.java</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>import java.rmi.registry.LocateRegistry;\nimport java.rmi.registry.Registry;\n\nimport javax.rmi.ssl.SslRMIClientSocketFactory;\nimport javax.rmi.ssl.SslRMIServerSocketFactory;\n\npublic class Register {\n    public static void main(String[] args) throws Exception {\n        int port = 9999;\n\n        System.setProperty(&quot;javax.net.ssl.keyStore&quot;, &quot;server.keystore&quot;);\n        System.setProperty(&quot;javax.net.ssl.keyStorePassword&quot;, &quot;123123&quot;);\n\n        System.setProperty(&quot;javax.net.ssl.trustStore&quot;, &quot;client.truststore&quot;);\n        System.setProperty(&quot;javax.net.ssl.trustStorePassword&quot;, &quot;123123&quot;);\n\n        Registry reg = LocateRegistry.createRegistry(port, new SslRMIClientSocketFactory(),\n                new SslRMIServerSocketFactory());\n\n        Server server = new Server();\n        reg.rebind(&quot;OrderSystem&quot;, server);\n\n        System.out.println(&quot;Server running&quot;);\n    }\n}\n</code></pre>\n<p><strong>RemoteInterface.java</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>import java.rmi.*;\nimport java.sql.SQLException;\n\npublic interface RemoteInterface extends Remote {\n    public boolean loginUser() throws RemoteException, SQLException;\n}\n</code></pre>\n<p><strong>Server.java</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>import java.rmi.RemoteException;\nimport java.rmi.server.UnicastRemoteObject;\n\nimport java.sql.SQLException;\n\nimport javax.rmi.ssl.SslRMIClientSocketFactory;\nimport javax.rmi.ssl.SslRMIServerSocketFactory;\n\npublic class Server extends UnicastRemoteObject implements RemoteInterface {\n    public Server() throws RemoteException {\n        super(0, new SslRMIClientSocketFactory(), new SslRMIServerSocketFactory());\n    }\n\n    @Override\n    public boolean loginUser() throws RemoteException, SQLException {\n        return true;\n    }\n}\n</code></pre>\n<p><strong>App.java</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>package dcoms;\n\nimport java.net.InetAddress;\nimport java.rmi.registry.LocateRegistry;\nimport java.rmi.registry.Registry;\n\nimport dcoms.remote.RemoteInterface;\n\npublic class App {\n    public static void main(String[] args) {\n        System.out.println(&quot;Starting&quot;);\n        try {\n            Registry registry = LocateRegistry.getRegistry(InetAddress.getLocalHost().getHostName(), 9999);\n            RemoteInterface obj = (RemoteInterface) registry.lookup(&quot;OrderSystem&quot;);\n            System.out.println(obj.loginUser());\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n\n        System.out.println(&quot;Ended&quot;);\n    }\n}\n</code></pre>\n<p>I appreciate the time you've taken to read through all of this.</p>\n",
    "tags" : [ "java", "ssl", "rmi" ],
    "owner" : {
      "account_id" : 18459021,
      "reputation" : 575,
      "user_id" : 13447006,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/12566e823b05f84cbb04e959e298dfc1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "AlphabetsAlphabets",
      "link" : "https://stackoverflow.com/users/13447006/alphabetsalphabets"
    },
    "is_answered" : false,
    "view_count" : 60,
    "closed_date" : 1745984536,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1745226405,
    "creation_date" : 1745226405,
    "link" : "https://stackoverflow.com/questions/79584320/unable-to-use-ssl-with-rmi-due-to-connectionexception",
    "closed_reason" : "Duplicate"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140375208,
    "post_id" : 79584320,
    "body" : "Well one obvious error is that when you use <code>LocateRegistry.createRegistry(port, new SslRMIClientSocketFactory(), new SslRMIServerSocketFactory())</code> you must also provide the SSL client socket factory when you use <code>LocateRegistry.getRegistry()</code>. But connection refusals are temporally prior to any SSL being invoked.",
    "score" : 0,
    "owner" : {
      "account_id" : 71739,
      "reputation" : 311869,
      "user_id" : 207421,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=256&d=identicon&r=PG",
      "display_name" : "user207421",
      "link" : "https://stackoverflow.com/users/207421/user207421"
    },
    "creation_date" : 1745818613,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140356281,
    "post_id" : 79584320,
    "body" : "@user207421 I have removed the SSL stuff and I didn&#39;t get that error. It actually worked just fine.",
    "score" : 0,
    "owner" : {
      "account_id" : 18459021,
      "reputation" : 575,
      "user_id" : 13447006,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/12566e823b05f84cbb04e959e298dfc1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "AlphabetsAlphabets",
      "link" : "https://stackoverflow.com/users/13447006/alphabetsalphabets"
    },
    "creation_date" : 1745287926,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140354043,
    "post_id" : 79584320,
    "body" : "This has exactly nothing to do with SSL. If you remove all the SSL stuff you will get exactly the same problem. <code>Connection refused</code> has one and only one meaning: nothing was listening at the IP:port you tried to connect to. And <code>UnknownHostException</code> is <i>not</i> the same as <code>ConnectException</code>.",
    "score" : 0,
    "owner" : {
      "account_id" : 71739,
      "reputation" : 311869,
      "user_id" : 207421,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=256&d=identicon&r=PG",
      "display_name" : "user207421",
      "link" : "https://stackoverflow.com/users/207421/user207421"
    },
    "creation_date" : 1745230629,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}