{
  "question" : {
    "question_id" : 79794051,
    "title" : "Unable to Connect to Azure Blob Storage from Java Using Managed Identity",
    "body" : "<p>I am trying to connect to an Azure Blob Storage account from my VM using Managed Identity in Java. Below is the code I have implemented to establish the connection. I have made all the required configurations between the VM and the Blob Storage account, including assigning the &quot;Storage Blob Data Contributor&quot; role to the VM. Despite this, I am still unable to connect to Blob Storage and receiving the following error details.</p>\n<p>Java Class:</p>\n<pre><code>package com.function;\n\nimport com.azure.identity.DefaultAzureCredentialBuilder;\nimport com.azure.core.credential.TokenCredential;\nimport com.azure.storage.blob.*;\nimport com.azure.storage.blob.models.*;\n\npublic class AzureBlobStorageTest {\n    public static void main(String[] args) {\n        String endpoint = &quot;https://s*****ev01.blob.core.windows.net&quot;;\n        String containerName = &quot;test&quot;;\n        String blobName = &quot;sample.csv&quot;;\n        String clientId = &quot;619515b1-****-4437-8c09-9eca28338716&quot;; // User-assigned Managed Identity Client ID\n\n        try {\n            // Build credential with client ID\n            TokenCredential credential = new DefaultAzureCredentialBuilder()\n                    .managedIdentityClientId(clientId)\n                    .build();\n\n            BlobServiceClient blobServiceClient = new BlobServiceClientBuilder()\n                    .endpoint(endpoint)\n                    .credential(credential)\n                    .buildClient();\n\n            BlobContainerClient containerClient = blobServiceClient.getBlobContainerClient(containerName);\n            BlobClient blobClient = containerClient.getBlobClient(blobName);\n\n            System.out.println(&quot;Connected to Blob: &quot; + blobClient.getBlobUrl());\n\n            // Check if blob exists\n            if (blobClient.exists()) {\n                System.out.println(&quot;Blob exists&quot;);\n            }\n        } catch (Exception e) {\n            System.err.println(&quot;Error accessing blob storage: &quot; + e.getMessage());\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre>\n<p>ERRORS:</p>\n<pre><code>03:52:25.652 [main] INFO com.azure.core.http.netty.implementation.NettyUtility -- {&quot;az.sdk.message&quot;:&quot;The following Netty versions were found on the classpath and have a mismatch with the versions used by azure-core-http-netty. If your application runs without issue this message can be ignored, otherwise please align \nthe Netty versions used in your application. For more information, see https://aka.ms/azsdk/java/dependency/troubleshoot.&quot;,&quot;azure-netty-version&quot;:&quot;4.1.126.Final&quot;,&quot;azure-netty-native-version&quot;:&quot;2.0.73.Final&quot;,&quot;classpath-netty-version-io.netty:netty-common&quot;:&quot;4.2.6.Final&quot;,&quot;classpath-netty-version-io.netty:netty-handler&quot;:&quot;4.2.6.Final&quot;,&quot;classpath-netty-version-io.netty:netty-handler-proxy&quot;:&quot;4.2.6.Final&quot;,&quot;classpath-netty-version-io.netty:netty-buffer&quot;:&quot;4.2.6.Final&quot;,&quot;classpath-netty-version-io.netty:netty-codec&quot;:&quot;4.2.6.Final&quot;,&quot;classpath-netty-version-io.netty:netty-codec-http&quot;:&quot;4.2.6.Final&quot;,&quot;classpath-netty-version-io.netty:netty-codec-http2&quot;:&quot;4.2.6.Final&quot;,&quot;classpath-netty-version-io.netty:netty-transport-native-unix-common&quot;:&quot;4.2.6.Final&quot;,&quot;classpath-netty-version-io.netty:netty-transport-native-epoll&quot;:&quot;4.2.6.Final&quot;,&quot;classpath-netty-version-io.netty:netty-transport-native-kqueue&quot;:&quot;4.2.6.Final&quot;,&quot;classpath-native-netty-version-io.netty:netty-tcnative-boringssl-static&quot;:&quot;2.0.73.Final&quot;}\nConnected to Blob: https://s*****ev01.blob.core.windows.net/test/sample.csv\n03:52:27.415 [main] INFO com.azure.identity.ChainedTokenCredential -- Azure Identity =&gt; Attempted credential EnvironmentCredential is unavailable.\n03:52:27.419 [main] INFO com.azure.identity.ChainedTokenCredential -- Azure Identity =&gt; Attempted credential WorkloadIdentityCredential is unavailable.\n03:52:27.486 [main] INFO com.azure.identity.ManagedIdentityCredential -- User-assigned Managed Identity ID: 619515b1-7a16-****-8c09-9eca28338716\n03:52:27.554 [main] INFO com.azure.identity.ChainedTokenCredential -- Azure Identity =&gt; Attempted credential ManagedIdentityCredential is unavailable.\n03:52:27.572 [main] INFO com.azure.identity.ChainedTokenCredential -- Azure Identity =&gt; Attempted credential IntelliJCredential is unavailable.\n03:52:27.575 [main] INFO com.azure.identity.ChainedTokenCredential -- Azure Identity =&gt; Attempted credential VisualStudioCodeCredential is unavailable.\n03:52:27.668 [main] INFO com.azure.identity.ChainedTokenCredential -- Azure Identity =&gt; Attempted credential AzureCliCredential is unavailable.\n03:52:27.696 [main] ERROR com.azure.identity.implementation.PowershellManager -- PowerShell command failure.\n</code></pre>\n<p>Managed Identity Cofiguration: <a href=\"https://i.sstatic.net/rU7C63Ik.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/rU7C63Ik.png\" alt=\"Screenshot\" /></a></p>\n<p>Dependencies:</p>\n<pre><code>        &lt;!-- https://mvnrepository.com/artifact/com.azure/azure-storage-blob --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.azure&lt;/groupId&gt;\n            &lt;artifactId&gt;azure-storage-blob&lt;/artifactId&gt;\n            &lt;version&gt;12.31.3&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;!-- https://mvnrepository.com/artifact/com.azure/azure-identity --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.azure&lt;/groupId&gt;\n            &lt;artifactId&gt;azure-identity&lt;/artifactId&gt;\n            &lt;version&gt;1.18.1&lt;/version&gt;\n            &lt;scope&gt;compile&lt;/scope&gt;\n        &lt;/dependency&gt;\n</code></pre>\n<p>FYI, I have successfully tested the Managed Identity configuration between the VM and the Storage Account using PowerShell scripts, where I'm able to download files. However, I am facing issues specifically when trying to perform this operation in Java using this calss: BlobServiceClient.</p>\n<p>Can anyone help me identify what might be wrong with the Java implementation that is preventing the connection to Azure Blob Storage using Managed Identity?</p>\n<p>Thankyou!</p>\n",
    "tags" : [ "java", "azure", "azure-blob-storage", "azure-managed-identity", "azure-java-sdk" ],
    "owner" : {
      "account_id" : 25813452,
      "reputation" : 29,
      "user_id" : 19553779,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/54f780b6f65f35d5c1e929f7c64749e0?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Venkatesh",
      "link" : "https://stackoverflow.com/users/19553779/venkatesh"
    },
    "is_answered" : false,
    "view_count" : 96,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1760838955,
    "creation_date" : 1760837338,
    "link" : "https://stackoverflow.com/questions/79794051/unable-to-connect-to-azure-blob-storage-from-java-using-managed-identity",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140806924,
    "post_id" : 79794051,
    "body" : "Have you tried using <a href=\"https://learn.microsoft.com/en-us/java/api/com.azure.identity.managedidentitycredential?view=azure-java-stable\" rel=\"nofollow noreferrer\">ManagedIdentityCredential</a> directly instead of DefaultAzureCredential?",
    "score" : 0,
    "owner" : {
      "account_id" : 1826174,
      "reputation" : 59610,
      "user_id" : 1658906,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/4e4748ed2fb97e8a8d4dd6d439625135?s=256&d=identicon&r=PG",
      "display_name" : "juunas",
      "link" : "https://stackoverflow.com/users/1658906/juunas"
    },
    "creation_date" : 1760982547,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}