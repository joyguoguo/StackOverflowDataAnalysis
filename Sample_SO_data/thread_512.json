{
  "question" : {
    "question_id" : 79792164,
    "title" : "How do GWT RPC transactions work with JPA/Hibernate on a database?",
    "body" : "<p>Working on this huge DAQ project made with GWT(mariaDB as db) , my main purpose is to replace some UI components and with them, their functionalities(for this case, users management , where you can add/edit/move around), to be straight , right now i am making islands on this project , where i detach from GWT ,and use for UI the framework Flutter(this framework is chose because later we want to have mobile compatibility and one single architecture). The communication so far between Flutter and the server is realized by API calls. I try to use with little to no modifications the functions that GWT use , i just take them and try to implement for my code. Now the problem is that , there is this one function that saves/edit users(yes it does both), and for some reasons when is triggered by an endpoint (@PostMapping , @Transactional) , behaves weirdly , what I mean is that when you try to change an user organization, this user has some area of interest on him (foreign key, eager fetch declared on sites variable inside class User), and when is moved to another organization , he will have he's sites moved with him also (sites has a  foreign key to organization). When the function (saveAndmoveSites) that is made (with @Transactional) , to fetch the sites of the edited user and move them in the new organization, is called by saveUser function (that is called by flutter) for some reasons will not find anything at all, not a single site. But when all this is requested by GWT, everything is fine , will find and move all the sites of the user. Before the function saveAndMoveSites , there is this mapper where it will map the DTO received from request to user(using MappedFacade), and at sites(area of interest) field is empty (GWT sends empty field, flutter sends empty field). I see if this mapper is called by flutter before saveAndMoveSites makes the backend to clear the user sites and so will not find a single site when called by saveAndMoveSites, but if is called by GWT the mapper will clear the sites of user but then will find them somehow. I am very surprised by this weird behaviour, and i want to know how GWT (RPC) sessions and hibernate state management works , and why is behaving this function differently in Flutter.</p>\n<p>At the beginning of the function, made this debug print to see exactly the DTO received , to see the differences between what i send from flutter and what is send by GWT. I can say matches 1:1, not a single thing different from one to another.<br />\nTo fix this issue , i made a boolean variable that will check if the function is called by flutter, if so , will not call the mapper before saveAndMoveSites, but will call after that function. And everything so far is working as intended.</p>\n",
    "tags" : [ "java", "flutter", "hibernate", "gwt", "rpc" ],
    "owner" : {
      "account_id" : 24005590,
      "reputation" : 27,
      "user_id" : 19104819,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AATXAJzmmrxB12Bt9hoY_622zfCuZLaCUgxcMIhZ2n0g=k-s256",
      "display_name" : "Gigea Nicusor",
      "link" : "https://stackoverflow.com/users/19104819/gigea-nicusor"
    },
    "is_answered" : true,
    "view_count" : 42,
    "closed_date" : 1760874635,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1760622615,
    "creation_date" : 1760619008,
    "link" : "https://stackoverflow.com/questions/79792164/how-do-gwt-rpc-transactions-work-with-jpa-hibernate-on-a-database",
    "closed_reason" : "Needs details or clarity"
  },
  "answers" : [ {
    "answer_id" : 79792223,
    "question_id" : 79792164,
    "body" : "<p>Your REST path maps an <strong>empty</strong> <code>sites</code> collection onto a <strong>managed</strong> entity, Hibernate marks it dirty, and <strong>auto-flushes</strong> those deletes <strong>before</strong> your move query — so no sites are found. GWT’s path sidesteps the timing in some way, but it’s incidental. The durable fix is to <strong>never map <code>sites</code> from the DTO</strong> for this endpoint and/or <strong>move sites via a bulk update before any mapping</strong>. That removes the timing hazard and makes both GWT and Flutter behave identically.</p>\n<p>If you want, share your entity mappings (<code>User</code>, <code>Site</code>) and the mapper config you use (MapStruct/Orika/ModelMapper), and I’ll tailor the exact snippet to your stack.</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 5072607,
      "reputation" : 578,
      "user_id" : 4070966,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/jtTw20PF.jpg?s=256",
      "display_name" : "Tino",
      "link" : "https://stackoverflow.com/users/4070966/tino"
    },
    "creation_date" : 1760622615,
    "last_activity_date" : 1760622615,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79792223" : [ {
      "comment_id" : 140800031,
      "post_id" : 79792223,
      "body" : "Ty for your comment , and you are right that i was mapping the empty site&#39;s list onto the managed entity, but so does the GWT, why on me will affect the db , but for some reasons on GWT side this will not happen?  And for the mapper config, i thought about to not map anymore the empty site list, so for the flutter call i made a config for the mapper (inside the saveUser function, dont want to be globally to affect the legacy code.).  This is the link with the part of the code where i modified the mapper to not include sites (<a href=\"https://pastebin.com/f4VKmuP8\" rel=\"nofollow noreferrer\">pastebin.com/f4VKmuP8</a>)",
      "score" : 0,
      "owner" : {
        "account_id" : 24005590,
        "reputation" : 27,
        "user_id" : 19104819,
        "user_type" : "registered",
        "profile_image" : "https://lh3.googleusercontent.com/a/AATXAJzmmrxB12Bt9hoY_622zfCuZLaCUgxcMIhZ2n0g=k-s256",
        "display_name" : "Gigea Nicusor",
        "link" : "https://stackoverflow.com/users/19104819/gigea-nicusor"
      },
      "creation_date" : 1760627540,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}