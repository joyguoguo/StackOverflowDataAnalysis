{
  "question" : {
    "question_id" : 79823092,
    "title" : "Invisible caret shoves text to the left, obscuring text",
    "body" : "<p>I have a non-editable <code>JFormattedTextField</code>. It's enabled.</p>\n<p>Once the user focuses the field (by clicking it or traversing focus with Tab), the caret is repositioned.</p>\n<p>While the caret is invisible, it shoves the text to the left which is problematic for small fields as the text may get partially hidden. It's a small yet annoying bug.</p>\n<p>How do I change this behavior? Maybe, there are some clever properties that I'm unaware of? I want the text to stay where it is.</p>\n<p>Keep in mind, the field <em>must</em> stay focusable and traversable since navigating between form fields with Tab is part of our expected functionality. While the field in the demo below is not editable manually, it <em>is</em> editable indirectly. In the real app, the user may press Enter and choose between available options displayed in a modal dialog.</p>\n<p>MRE:</p>\n<pre class=\"lang-java prettyprint-override\"><code>import javax.swing.BorderFactory;\nimport javax.swing.JButton;\nimport javax.swing.JFormattedTextField;\nimport javax.swing.JFrame;\nimport javax.swing.JLabel;\nimport javax.swing.JPanel;\nimport javax.swing.WindowConstants;\nimport javax.swing.border.Border;\nimport javax.swing.border.CompoundBorder;\nimport javax.swing.text.DefaultFormatterFactory;\nimport java.awt.Color;\nimport java.awt.Component;\nimport java.awt.Container;\nimport java.awt.event.ActionEvent;\n\npublic class TextFieldDemo {\n\n    static JFormattedTextField textField;\n    static JButton button;\n\n    public static void main(String[] args) {\n        Container mainPanel = createMainPanel();\n        JFrame frame = new JFrame(&quot;Text field demo&quot;);\n        frame.setContentPane(mainPanel);\n        frame.setLocationRelativeTo(null);\n        frame.pack();\n        frame.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);\n        frame.setVisible(true);\n    }\n\n    private static Container createMainPanel() {\n        JPanel panel = new JPanel();\n        /* there should be at least one focusable component before the text field\n        so that the latter doesn't grab focus right away */\n        panel.add(createButton());\n        panel.add(createNameLabel());\n        panel.add(createNameField());\n        return panel;\n    }\n\n    private static JButton createButton() {\n        button = new JButton();\n        button.setText(&quot;Insert&quot;);\n        button.addActionListener(TextFieldDemo::onButtonClick);\n        button.setBorder(createButtonBorder()); // smaller\n        return button;\n    }\n\n    private static void onButtonClick(ActionEvent e) {\n        Object value = isEmpty() ? &quot;Alex&quot; : null; // in the real app, it's a domain object\n        String text = isEmpty() ? &quot;Clear&quot; : &quot;Insert&quot;;\n        textField.setValue(value);\n        button.setText(text);\n    }\n\n    private static boolean isEmpty() {\n        return textField.getText().isEmpty();\n    }\n\n    private static CompoundBorder createButtonBorder() {\n        Border outer = BorderFactory.createLineBorder(Color.BLACK);\n        Border inner = BorderFactory.createEmptyBorder(2, 2, 2, 2);\n        return BorderFactory.createCompoundBorder(outer, inner);\n    }\n\n    private static Component createNameLabel() {\n        return new JLabel(&quot;Name&quot;);\n    }\n\n    private static Component createNameField() {\n        textField = new JFormattedTextField();\n        textField.setFormatterFactory(createFormatterFactory()); // setting a formatter factory is important\n        textField.setColumns(2); // let's limit the width\n        // so that the field displays the beginning, not the end of the string, if it's long\n        textField.addPropertyChangeListener(&quot;value&quot;, e -&gt; textField.setCaretPosition(0));\n        textField.setEditable(false);\n        return textField;\n    }\n\n    private static DefaultFormatterFactory createFormatterFactory() {\n        DefaultFormatterFactory formatterFactory = new DefaultFormatterFactory();\n        formatterFactory.setDefaultFormatter(createFormatter());\n        return formatterFactory;\n    }\n\n    private static JFormattedTextField.AbstractFormatter createFormatter() {\n        return new JFormattedTextField.AbstractFormatter() {\n            @Override\n            public Object stringToValue(String text) {\n                return text;\n            }\n\n            @Override\n            public String valueToString(Object value) {\n                return value == null ? null : value.toString();\n            }\n        };\n    }\n}\n</code></pre>\n<p>Before clicking on the field:</p>\n<p><a href=\"https://i.sstatic.net/oTPeeWiA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/oTPeeWiA.png\" alt=\"enter image description here\" /></a></p>\n<p>After clicking on the field (&quot;A&quot; is obscured):</p>\n<p><a href=\"https://i.sstatic.net/MjdEnqpB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/MjdEnqpB.png\" alt=\"enter image description here\" /></a></p>\n<p>Java 8.</p>\n",
    "tags" : [ "java", "swing" ],
    "owner" : {
      "account_id" : 10187542,
      "reputation" : 2667,
      "user_id" : 20692967,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
      "display_name" : "Sergey Zolotarev",
      "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
    },
    "is_answered" : false,
    "view_count" : 59,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1763454142,
    "creation_date" : 1763451086,
    "link" : "https://stackoverflow.com/questions/79823092/invisible-caret-shoves-text-to-the-left-obscuring-text",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79823134,
    "question_id" : 79823092,
    "body" : "<p>You may set a custom caret that takes the <code>editable</code> property into account.</p>\n<pre class=\"lang-java prettyprint-override\"><code>        textField.setCaret(new EditableAwareCaret());\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>public class EditableAwareCaret extends DefaultCaret {\n\n    @Override\n    public void setDot(int dot, Position.Bias dotBias) {\n        if (textField.isEditable() || dot == 0) super.setDot(dot, dotBias);\n    }\n\n    @Override\n    public void moveDot(int dot, Position.Bias dotBias) {\n        if (textField.isEditable() || dot == 0) super.moveDot(dot, dotBias);\n    }\n}\n</code></pre>\n<p>However, keep in mind it will disable text selection.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 10187542,
      "reputation" : 2667,
      "user_id" : 20692967,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
      "display_name" : "Sergey Zolotarev",
      "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
    },
    "creation_date" : 1763454142,
    "last_activity_date" : 1763454142,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}