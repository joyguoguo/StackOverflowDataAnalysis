{
  "question" : {
    "question_id" : 79532572,
    "title" : "SSFR From Fortify when writing to Socket",
    "body" : "<p><strong>Summary of the Issue:</strong></p>\n<p>I'm working on a Java application where Fortify flagged a <strong>Server-Side Request Forgery (SSRF)</strong> vulnerability in a method that sends a message over a socket connection.</p>\n<h3><strong>Code snippet:</strong></h3>\n<pre class=\"lang-java prettyprint-override\"><code>public synchronized void sendMessage(String msg, long id) {\n    try {\n        msg = utils.sanitizeInput(msg);\n        OutputStream osb = clientSocket.getOutputStream();\n        byte[] dataBytes = msg.getBytes();\n        osb.write(1);\n        osb.write(224);\n        osb.write(dataBytes);\n        osb.flush();\n    } catch (Exception e) {\n        // Handle exception\n    }\n}\n</code></pre>\n<h3><strong>Context:</strong></h3>\n<ul>\n<li>The <code>msg</code> value comes from a input stream in another socket connection, is validated and transformed multiple times by other services so it meets the protocol of the recipient.</li>\n<li>The input is sanitized using <code>utils.sanitizeInput(msg)</code>, but Fortify still flags the <code>osb.write(dataBytes)</code> line as vulnerable.</li>\n</ul>\n<h3><strong>Why Fortify Marks It as a Vulnerability:</strong></h3>\n<ul>\n<li>Fortify likely detects that <code>msg</code> is user-controlled and could potentially be manipulated to perform a SSRF attack or other malicious activity.</li>\n<li>Even though <code>sanitizeInput()</code> is applied, Fortify may not recognize it as an effective sanitization method.</li>\n</ul>\n<h3><strong>Question:</strong></h3>\n<ul>\n<li>Whatâ€™s the best way to address this type of warning in a socket communication context?</li>\n<li>Would using a library like <code>org.owasp</code> for input sanitization help resolve this?</li>\n<li>Are there any recommended patterns for securely handling user input in socket-based communication?</li>\n</ul>\n<p>Any insights or suggestions would be highly appreciated!</p>\n",
    "tags" : [ "java", "sockets", "ssrf" ],
    "owner" : {
      "account_id" : 24148270,
      "reputation" : 1,
      "user_id" : 18113502,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/bea0395a30fb7c3601ed88c273efd05d?s=256&d=identicon&r=PG",
      "display_name" : "GustavoP",
      "link" : "https://stackoverflow.com/users/18113502/gustavop"
    },
    "is_answered" : false,
    "view_count" : 45,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1743041062,
    "creation_date" : 1742869679,
    "link" : "https://stackoverflow.com/questions/79532572/ssfr-from-fortify-when-writing-to-socket",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79537665,
    "question_id" : 79532572,
    "body" : "<p>The issue was resolved by using ESAPI from org.owasp like so:</p>\n<pre><code>import org.owasp.esapi.Validator;\n\nimport org.owasp.esapi.reference.DefaultValidator;\n\nValidator validator = DefaultValidator.getInstance();\n// Before converting to bytes\nmsg = validator.getValidInput(&quot;SocketMessage&quot;, msg, &quot;SafeString&quot;, 100, false);\n\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 24148270,
      "reputation" : 1,
      "user_id" : 18113502,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/bea0395a30fb7c3601ed88c273efd05d?s=256&d=identicon&r=PG",
      "display_name" : "GustavoP",
      "link" : "https://stackoverflow.com/users/18113502/gustavop"
    },
    "creation_date" : 1743041062,
    "last_activity_date" : 1743041062,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}