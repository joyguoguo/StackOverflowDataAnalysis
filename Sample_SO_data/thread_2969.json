{
  "question" : {
    "question_id" : 79581584,
    "title" : "Vaadin 24 Dynamic CSS With Flow",
    "body" : "<p>Is there a way to apply dynamic CSS with selectors via Vaadin Flow? Obviously, you can set CSS pretty easily in most circumstances. My specific problem is that I have dynamic background colors for elements that I want users to define themselves. And even then, it would be easy except for the colors differ between light and dark mode.</p>\n<p>For example, I previously had this CSS in my styles.css:</p>\n<pre><code>html {\n    --section-background-color-01: #fc7c7c;\n    --section-background-color-02: #fcb67c;\n    --section-background-color-03: #fced7c;\n    --section-background-color-04: #dafc7c;\n    --section-background-color-05: #8bfc7c;\n    --section-background-color-06: #7cfce9;\n    --section-background-color-07: #7cc9fc;\n    --section-background-color-08: #7c7efc;\n    --section-background-color-09: #b37cfc;\n    --section-background-color-10: #fc7cfa;\n    --section-background-color-11: #fc7cd2;\n    --section-background-color-12: #fc7c9e;\n}\nhtml[theme~=&quot;dark&quot;] {\n    --section-background-color-01: #420000;\n    --section-background-color-02: #422300;\n    --section-background-color-03: #414200;\n    --section-background-color-04: #174200;\n    --section-background-color-05: #004203;\n    --section-background-color-06: #004238;\n    --section-background-color-07: #001f42;\n    --section-background-color-08: #000042;\n    --section-background-color-09: #200042;\n    --section-background-color-10: #320042;\n    --section-background-color-11: #42003d;\n    --section-background-color-12: #42001e;\n}\n</code></pre>\n<p>I was then applying it in my code as such:</p>\n<pre><code>VerticalLayout section1 = new VerticalLayout();\nsection1.getStyle().setBackgroundColor(&quot;var(--section-background-color-01)&quot;);\n</code></pre>\n<p>The problem is trying to address this dynamically whilst also accounting for the dark theme.</p>\n<p>I can do the following:</p>\n<pre><code>String userSelectedColor = &quot;#ffffff&quot;;\nUI.getCurrent().getStyle().set(&quot;--section-background-color-01&quot;, userSelectedColor);\n...\n\nsection1.getStyle().setBackgroundColor(&quot;var(--section-background-color-01)&quot;);\n</code></pre>\n<p>This does work, but the color is the same no matter what the theme is. This is not what I'm looking for. I need to have the color change between instances.</p>\n<p>I should probably clarify, I don't have access to the light/dark mode server-side to be able to react dynamically. It's handled with a component from the directory, Theme Select - <a href=\"https://vaadin.com/directory/component/theme-select\" rel=\"nofollow noreferrer\">https://vaadin.com/directory/component/theme-select</a></p>\n<p>This component is pure browser and I don't know if there even is a way to get the value from it. It's otherwise been completely ideal for our purposes.</p>\n<p>I had a thought and tried the following CSS:</p>\n<pre><code>\nhtml {\n    --section-background-light-color-01: #fc7c7c;\n    --section-background-light-color-02: #fcb67c;\n    --section-background-light-color-03: #fced7c;\n    --section-background-light-color-04: #dafc7c;\n    --section-background-light-color-05: #8bfc7c;\n    --section-background-light-color-06: #7cfce9;\n    --section-background-light-color-07: #7cc9fc;\n    --section-background-light-color-08: #7c7efc;\n    --section-background-light-color-09: #b37cfc;\n    --section-background-light-color-10: #fc7cfa;\n    --section-background-light-color-11: #fc7cd2;\n    --section-background-light-color-12: #fc7c9e;\n    --section-background-dark-color-01: #420000;\n    --section-background-dark-color-02: #422300;\n    --section-background-dark-color-03: #414200;\n    --section-background-dark-color-04: #174200;\n    --section-background-dark-color-05: #004203;\n    --section-background-dark-color-06: #004238;\n    --section-background-dark-color-07: #001f42;\n    --section-background-dark-color-08: #000042;\n    --section-background-dark-color-09: #200042;\n    --section-background-dark-color-10: #320042;\n    --section-background-dark-color-11: #42003d;\n    --section-background-dark-color-12: #42001e;\n}\n\nhtml {\n    --section-background-color-01: var(--section-background-light-color-01);\n    --section-background-color-02: var(--section-background-light-color-02);\n    --section-background-color-03: var(--section-background-light-color-03);\n    --section-background-color-04: var(--section-background-light-color-04);\n    --section-background-color-05: var(--section-background-light-color-05);\n    --section-background-color-06: var(--section-background-light-color-06);\n    --section-background-color-07: var(--section-background-light-color-07);\n    --section-background-color-08: var(--section-background-light-color-08);\n    --section-background-color-09: var(--section-background-light-color-09);\n    --section-background-color-10: var(--section-background-light-color-10);\n    --section-background-color-11: var(--section-background-light-color-11);\n    --section-background-color-12: var(--section-background-light-color-12);\n}\nhtml[theme~=&quot;dark&quot;] {\n    --section-background-color-01: var(--section-background-dark-color-01);\n    --section-background-color-02: var(--section-background-dark-color-02);\n    --section-background-color-03: var(--section-background-dark-color-03);\n    --section-background-color-04: var(--section-background-dark-color-04);\n    --section-background-color-05: var(--section-background-dark-color-05);\n    --section-background-color-06: var(--section-background-dark-color-06);\n    --section-background-color-07: var(--section-background-dark-color-07);\n    --section-background-color-08: var(--section-background-dark-color-08);\n    --section-background-color-09: var(--section-background-dark-color-09);\n    --section-background-color-10: var(--section-background-dark-color-10);\n    --section-background-color-11: var(--section-background-dark-color-11);\n    --section-background-color-12: var(--section-background-dark-color-12);\n}\n</code></pre>\n<p>That works by itself. But my problem now is that my colors applied through Java are not working at all.</p>\n<pre><code>String userSelectedColorLight = &quot;#ffffff&quot;;\nString userSelectedColorDark = &quot;#000000&quot;;\nUI.getCurrent().getStyle().set(&quot;--section-background-light-color-01&quot;, userSelectedColorLight);\nUI.getCurrent().getStyle().set(&quot;--section-background-dark-color-01&quot;, userSelectedColorDark);\n...\n\nsection1.getStyle().setBackgroundColor(&quot;var(--section-background-color-01)&quot;);\n</code></pre>\n<p>The light/dark colors from above are not being applied. At best, only my default colors from the CSS are being applied. It would seem that I can't chain CSS variables through flow. At least, not as I'm currently doing it.</p>\n<p>What is really frustrating me at this point is that I did find this bit of older Vaadin documentation - <a href=\"https://vaadin.com/docs/v8/framework/articles/DynamicallyInjectingCSS\" rel=\"nofollow noreferrer\">https://vaadin.com/docs/v8/framework/articles/DynamicallyInjectingCSS</a></p>\n<p>It shows this example of doing exactly what I want:</p>\n<pre><code>  select.addValueChangeListener(new ValueChangeListener() {\n    @Override\n    public void valueChange( ValueChangeEvent event ) {\n      // Get the new font family\n      String fontFamily = select.getValue().toString();\n      // Get the stylesheet of the page\n      Styles styles = Page.getCurrent().getStyles();\n      // inject the new font size as a style. We need .v-app to override Vaadin's default styles here\n      styles.add(&quot;.v-app .v-textarea.text-label { font-family:&quot; + fontFamily + &quot;; }&quot;);\n    }\n  });\n</code></pre>\n<p>A full CSS definition with the selector is able to be applied. That code, however, is for Vaadin 8, and does not seem to have an equivalent in Vaadin 24.</p>\n<p>I need to have custom CSS that will dynamically react to the theme of the page (ie, dark/light mode). Is there a way that I can chain together CSS variable definitions globally for my current view (ala my '--section-background-light-color' and '--section-background-dark-color' attempt above), or is there a way that I can push a full CSS definition that includes the selectors?</p>\n<hr />\n<p>UPDATE:</p>\n<p>I got a workaround by simply injecting my desired result as raw HTML into my page:</p>\n<pre><code>{\n    ColorSettings sectionColors = getCurrentUser().getSectionColorSettings();\n\n    StringBuilder sb = new StringBuilder();\n\n    sb.append(&quot;&lt;style&gt;&quot;);\n    sb.append(&quot;html {&quot;);\n    sb.append(&quot;--section-background-color-01: &quot;).append(sectionColors.getLightModeBackgroundColor01()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-02: &quot;).append(sectionColors.getLightModeBackgroundColor02()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-03: &quot;).append(sectionColors.getLightModeBackgroundColor03()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-04: &quot;).append(sectionColors.getLightModeBackgroundColor04()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-05: &quot;).append(sectionColors.getLightModeBackgroundColor05()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-06: &quot;).append(sectionColors.getLightModeBackgroundColor06()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-07: &quot;).append(sectionColors.getLightModeBackgroundColor07()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-08: &quot;).append(sectionColors.getLightModeBackgroundColor08()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-09: &quot;).append(sectionColors.getLightModeBackgroundColor09()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-10: &quot;).append(sectionColors.getLightModeBackgroundColor10()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-11: &quot;).append(sectionColors.getLightModeBackgroundColor11()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-12: &quot;).append(sectionColors.getLightModeBackgroundColor12()).append(&quot;;&quot;);\n    sb.append(&quot;}&quot;);\n\n    sb.append(&quot;html[theme~=\\&quot;dark\\&quot;] {&quot;);\n    sb.append(&quot;--section-background-color-01: &quot;).append(sectionColors.getDarkModeBackgroundColor01()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-02: &quot;).append(sectionColors.getDarkModeBackgroundColor02()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-03: &quot;).append(sectionColors.getDarkModeBackgroundColor03()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-04: &quot;).append(sectionColors.getDarkModeBackgroundColor04()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-05: &quot;).append(sectionColors.getDarkModeBackgroundColor05()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-06: &quot;).append(sectionColors.getDarkModeBackgroundColor06()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-07: &quot;).append(sectionColors.getDarkModeBackgroundColor07()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-08: &quot;).append(sectionColors.getDarkModeBackgroundColor08()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-09: &quot;).append(sectionColors.getDarkModeBackgroundColor09()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-10: &quot;).append(sectionColors.getDarkModeBackgroundColor10()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-11: &quot;).append(sectionColors.getDarkModeBackgroundColor11()).append(&quot;;&quot;);\n    sb.append(&quot;--section-background-color-12: &quot;).append(sectionColors.getDarkModeBackgroundColor12()).append(&quot;;&quot;);\n    sb.append(&quot;}&quot;);\n    sb.append(&quot;&lt;/style&gt;&quot;);\n\n    Html style = new Html(sb.toString());\n    UI.getCurrent().addComponentAsFirst(style);\n}\n</code></pre>\n<p>This works, but there has to be a better way to do this, right? Something proper via Vaadin?</p>\n",
    "tags" : [ "java", "css", "vaadin", "vaadin-flow", "vaadin24" ],
    "owner" : {
      "account_id" : 2215372,
      "reputation" : 523,
      "user_id" : 1956139,
      "user_type" : "registered",
      "accept_rate" : 57,
      "profile_image" : "https://www.gravatar.com/avatar/42da8eb051d7f61b89e1e551b4152ecc?s=256&d=identicon&r=PG",
      "display_name" : "Curtis Snowden",
      "link" : "https://stackoverflow.com/users/1956139/curtis-snowden"
    },
    "is_answered" : true,
    "view_count" : 111,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1745302138,
    "creation_date" : 1745003346,
    "link" : "https://stackoverflow.com/questions/79581584/vaadin-24-dynamic-css-with-flow",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79585788,
    "question_id" : 79581584,
    "body" : "<p>Your second solution – the one where you dynamically assign a value to a mode-specific custom property – is actually correct, but with one small mistake:</p>\n<p>You're defining the non-mode-specific properties on the doc root level (<code>html</code> selector):</p>\n<pre><code>html {\n    --section-background-color-01: var(--section-background-light-color-01);\n    ...\n</code></pre>\n<p>But your Flow code assigns a new value to the mode-specific property on doc <code>body</code> level:</p>\n<pre><code>UI.getCurrent().getStyle().set(&quot;--section-background-light-color-01&quot;, something);\n</code></pre>\n<p>because <code>UI.getCurrent()</code> maps to the <code>body</code>, not the <code>html</code> root.</p>\n<p>So the assignment to <code>--section-background-light-color-01</code> happens on a lower level than the declaration of <code>--section-background-color-01</code>, and css custom properties don't reactively update if another custom property assigned as their value is updated.</p>\n<p>So the solution is simply to replace the <code>html</code> selector with <code>body</code>.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 113115,
      "reputation" : 2448,
      "user_id" : 298103,
      "user_type" : "registered",
      "accept_rate" : 91,
      "profile_image" : "https://i.sstatic.net/huWyP.jpg?s=256",
      "display_name" : "Rolf",
      "link" : "https://stackoverflow.com/users/298103/rolf"
    },
    "creation_date" : 1745302138,
    "last_activity_date" : 1745302138,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140350142,
    "post_id" : 79581584,
    "body" : "your solution is the best one i can guess. You should add it as an answer and accept it. There&#39;s no better way in my mind.",
    "score" : 0,
    "owner" : {
      "account_id" : 2465829,
      "reputation" : 13577,
      "user_id" : 2148953,
      "user_type" : "registered",
      "accept_rate" : 96,
      "profile_image" : "https://i.sstatic.net/DVHoP84E.jpg?s=256",
      "display_name" : "aran",
      "link" : "https://stackoverflow.com/users/2148953/aran"
    },
    "creation_date" : 1745057421,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79585788" : [ {
      "comment_id" : 140368395,
      "post_id" : 79585788,
      "body" : "yes, that&#39;s right, the dark theme attribute is applied to the html element, so the selector for the dark mode colors should be e.g. <code>[theme~=&quot;dark&quot;] &gt; body {...}</code>",
      "score" : 0,
      "owner" : {
        "account_id" : 113115,
        "reputation" : 2448,
        "user_id" : 298103,
        "user_type" : "registered",
        "accept_rate" : 91,
        "profile_image" : "https://i.sstatic.net/huWyP.jpg?s=256",
        "display_name" : "Rolf",
        "link" : "https://stackoverflow.com/users/298103/rolf"
      },
      "creation_date" : 1745571865,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140363259,
      "post_id" : 79585788,
      "body" : "Unfortunately, that didn&#39;t work completely. I do think you&#39;re on to something as it did PARTIALLY work. Unfortunately, only the &quot;--section-background-color-01: var(--section-background-light-color-01);&quot; is being utilized. It doesn&#39;t actually switch to the &quot;--section-background-color-01: var(--section-background-dark-color-01);&quot; I would assume that the selector &quot;body[theme~=&quot;dark&quot;]&quot; is not valid, as the theme attribute is not applied to the body tag.",
      "score" : 0,
      "owner" : {
        "account_id" : 2215372,
        "reputation" : 523,
        "user_id" : 1956139,
        "user_type" : "registered",
        "accept_rate" : 57,
        "profile_image" : "https://www.gravatar.com/avatar/42da8eb051d7f61b89e1e551b4152ecc?s=256&d=identicon&r=PG",
        "display_name" : "Curtis Snowden",
        "link" : "https://stackoverflow.com/users/1956139/curtis-snowden"
      },
      "creation_date" : 1745445828,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}