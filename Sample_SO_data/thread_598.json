{
  "question" : {
    "question_id" : 79785489,
    "title" : "How to skip unsupported syntax/commercial features with JOOQ parser?",
    "body" : "<p>I am using JOOQ SQL parser to process some CREATE TABLE statements on DDL files, which I cannot modify myself. These files contain various statements, such as CREATE FUNCTION, which I don't need.</p>\n<p>I tried using an H2 database to execute said DDL files and then get the information via <code>Meta</code> / information schema, but some of these DDL files use unsupported syntax for H2.</p>\n<p>I am currently using the parser like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>String sql = &quot;&quot;&quot;\ncreate function fn_1(\n  param1 text,\n  param2 text\n) returns boolean as $$\n  select true\n$$ language sql immutable;\n\ncreate table if not exists example (\n  id bigint not null\n);\n\ncreate or replace function fn_2(\n  param1 numeric,\n  param2 numeric\n) returns boolean as $$\n  select true\n$$ language sql immutable;\n&quot;&quot;&quot;\nSettings settings = new Settings();\nsettings.setParseIgnoreCommercialOnlyFeatures(true);\nsettings.setParseUnsupportedSyntax(ParseUnsupportedSyntax.IGNORE);\nParser parser = DSL.using(dialect, settings).parser();\nparser.parse(sql);\n</code></pre>\n<p>I understand that <code>create function</code> parsing is a commercial feature, which is why I set <code>ParseIgnoreCommercialOnlyFeatures</code> to true, but <code>parser.parse(sql)</code> still throws an error, saying it cannot parse fn_1:</p>\n<pre><code>org.jooq.impl.ParserException: ALIAS, FUNCTION, GENERATOR, GLOBAL TEMPORARY TABLE, INDEX, OR ALTER, OR REPLACE, PRIVATE SYNONYM, PROCEDURE, PUBLIC ALIAS, PUBLIC SYNONYM, SCHEMA, SEQUENCE, SYNONYM, TABLE, TEMPORARY TABLE, TRIGGER, TYPE, UNIQUE INDEX, or VIEW expected: [1:8] create [*]function fn_1(\n  param1 text,\n  param2 text\n) returns boolean as $$\n  select tru...\n</code></pre>\n<p>I would like to ask if there is a way to use the parser to extract only <code>create table</code> statements, ignoring everything else. I read the <code>DDLDatabase</code> documentation <a href=\"https://www.jooq.org/doc/latest/manual/code-generation/codegen-meta-sources/codegen-ddl/#ignoring-unsupported-content\" rel=\"nofollow noreferrer\">here</a>, which mentions skipping unsupported content via comments, but I would need a different mechanism for skipping unsupported content, because as said, I cannot modify these DDL files.</p>\n<p>Thanks in advance</p>\n",
    "tags" : [ "java", "jooq" ],
    "owner" : {
      "account_id" : 29865068,
      "reputation" : 13,
      "user_id" : 22887900,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9beb6f32dc45334c082fc2a44e1df709?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Cidos",
      "link" : "https://stackoverflow.com/users/22887900/cidos"
    },
    "is_answered" : true,
    "view_count" : 93,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1759957124,
    "creation_date" : 1759928794,
    "link" : "https://stackoverflow.com/questions/79785489/how-to-skip-unsupported-syntax-commercial-features-with-jooq-parser",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79785815,
    "question_id" : 79785489,
    "body" : "<p>The <code>ParseIgnoreCommercialOnlyFeatures</code> flag tells the parser to ignore statements, functions, etc. that aren't supported in the jOOQ Open Source Edition. But ignoring them simply means that they're not known to the parser, so you get the same exception that you would get if the parser encountered unsupported syntax (e.g. vendor specific storage clauses, etc.)</p>\n<blockquote>\n<p>because as said, I cannot modify these DDL files</p>\n</blockquote>\n<p>But you can! After reading the files, do some heuristics where you remove any <code>create function</code> or similar statement. Luckily, you don't have to parse the entirety of PL/pgSQL since PostgreSQL function bodies are contained in string literals, usually delimited by dollar quoted literals (<code>$$ .. $$</code>). That makes it easy to match them with a regex. A pragmatic solution here is to match <code>create( or replace)? function.*?\\\\$\\\\$.*?\\\\$\\\\$.*?;</code> or similar.</p>\n<p>Alternatively, you can try upgrading, of course.</p>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 247217,
      "reputation" : 223472,
      "user_id" : 521799,
      "user_type" : "registered",
      "accept_rate" : 89,
      "profile_image" : "https://www.gravatar.com/avatar/eb96efa7a5664ba1c4ebf586abd4121f?s=256&d=identicon&r=PG",
      "display_name" : "Lukas Eder",
      "link" : "https://stackoverflow.com/users/521799/lukas-eder"
    },
    "creation_date" : 1759952514,
    "last_activity_date" : 1759957124,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140784377,
    "post_id" : 79785489,
    "body" : "Yes, it requires parsing but it is a possible approach.",
    "score" : 0,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26502,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1759937793,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140784370,
    "post_id" : 79785489,
    "body" : "@aled Sorry I should&#39;ve been clearer: I mean that cannot change the files in the sense that they will come from other systems that are unaware of the &quot;ignore comment&quot; syntax. I tried filtering the content, finding where a <code>create function</code> statement starts is the easy part, but finding where it ends is non-trivial, it would require its own parsing logic or something similar.",
    "score" : 0,
    "owner" : {
      "account_id" : 29865068,
      "reputation" : 13,
      "user_id" : 22887900,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9beb6f32dc45334c082fc2a44e1df709?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Cidos",
      "link" : "https://stackoverflow.com/users/22887900/cidos"
    },
    "creation_date" : 1759937607,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140784296,
    "post_id" : 79785489,
    "body" : "Why you can not change the DDL files? What about filtering the content of the files without changing the original files?",
    "score" : 0,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26502,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1759936290,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}