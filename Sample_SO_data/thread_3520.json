{
  "question" : {
    "question_id" : 79543723,
    "title" : "How to add delivery fee in Stripe payment?",
    "body" : "<p>I need to add delivery fee in stripe payment. currently I have add the delivery fee as order item with 1 qunatity. Is there possibilty to add it as seperate fee?\nbelow you can see the current implementation stripe payment ui\n<a href=\"https://i.sstatic.net/fdhjAW6t.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/fdhjAW6t.png\" alt=\"enter image description here\" /></a></p>\n<p>I am using springboot for the stripe implementation</p>\n<p>below you can see the current implementation code</p>\n<pre><code>package com.gmart.gmart_api.service.impl;\n\nimport com.gmart.gmart_api.dto.paymentDto.PaymentResponseDto;\nimport com.gmart.gmart_api.exceptions.paymentExceptions.StripeSessionException;\nimport com.gmart.gmart_api.model.Order;\nimport com.gmart.gmart_api.model.OrderItem;\nimport com.gmart.gmart_api.repository.OrderRepository;\nimport com.gmart.gmart_api.service.ProductService;\nimport com.gmart.gmart_api.service.StripeService;\nimport com.stripe.Stripe;\nimport com.stripe.exception.StripeException;\nimport com.stripe.model.Customer;\nimport com.stripe.model.checkout.Session;\nimport com.stripe.param.CustomerCreateParams;\nimport com.stripe.param.checkout.SessionCreateParams;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Service;\n\nimport java.math.BigDecimal;\nimport java.util.*;\n\n@Service\npublic class StripeServiceImpl implements StripeService {\n    private final ProductService productService;\n    private final OrderRepository orderRepository;\n\n    @Autowired\n    public StripeServiceImpl(ProductService productService, OrderRepository orderRepository) {\n        this.productService = productService;\n        this.orderRepository =orderRepository;\n    }\n\n    @Value(&quot;${stripe.secretKey}&quot;)\n    private String secretKey;\n\n    public PaymentResponseDto checkoutProducts(BigDecimal amount, Order order) {\n        Stripe.apiKey = secretKey;\n\n        List&lt;SessionCreateParams.LineItem&gt; lineItems = new ArrayList&lt;&gt;();\n\n        List&lt;OrderItem&gt; orderItems = order.getOrderItems();\n\n        for (OrderItem item : orderItems) {\n\n            SessionCreateParams.LineItem.PriceData.ProductData productData =\n                    SessionCreateParams.LineItem.PriceData.ProductData.builder()\n                            .setName(item.getProduct().getProductName())\n                            .build();\n\n\n            SessionCreateParams.LineItem.PriceData priceData =\n                    SessionCreateParams.LineItem.PriceData.builder()\n                            .setCurrency(&quot;LKR&quot;)\n                            .setUnitAmount(item.getUnitPrice().multiply(BigDecimal.valueOf(100)).longValue())\n                            .setProductData(productData)\n                            .build();\n\n            SessionCreateParams.LineItem lineItem =\n                    SessionCreateParams.LineItem.builder()\n                            .setQuantity((long) item.getQuantity())\n                            .setPriceData(priceData)\n                            .build();\n\n            lineItems.add(lineItem);\n        }\n\n\n        BigDecimal shippingFee = BigDecimal.valueOf(123);\n        SessionCreateParams.LineItem.PriceData.ProductData shippingProductData =\n                SessionCreateParams.LineItem.PriceData.ProductData.builder()\n                        .setName(&quot;Delivery Charges&quot;)\n                        .build();\n\n        SessionCreateParams.LineItem.PriceData shippingPriceData =\n                SessionCreateParams.LineItem.PriceData.builder()\n                        .setCurrency(&quot;LKR&quot;)\n                        .setUnitAmount(shippingFee.multiply(BigDecimal.valueOf(100)).longValue()) // Convert LKR to cents\n                        .setProductData(shippingProductData)\n                        .build();\n\n        SessionCreateParams.LineItem shippingLineItem =\n                SessionCreateParams.LineItem.builder()\n                        .setQuantity(1L)\n                        .setPriceData(shippingPriceData)\n                        .build();\n\n        // Add shipping fee to line items\n        lineItems.add(shippingLineItem);\n\n        Map&lt;String, String&gt; metadata = new HashMap&lt;&gt;();\n        //metadata.put(&quot;orderId&quot;, order.getOrderId());\n        //metadata.put(&quot;userId&quot;, order.getSeller().getId());\n        //metadata.put(&quot;amount&quot;, amount.toString());\n\n\n        SessionCreateParams params = SessionCreateParams.builder()\n                                        .setMode(SessionCreateParams.Mode.PAYMENT)\n                                        .setCustomerEmail(order.getSeller().getEmail())\n                                        .setSuccessUrl(&quot;http://localhost:3000/seller/orders/success&quot;)\n                                        .setCancelUrl(&quot;http://localhost:3000/seller/orders/cancel&quot;)\n                                        .addAllLineItem(lineItems)\n                                        //.putMetadata(&quot;orderId&quot;, &quot;order_test&quot;)\n                                        //.putMetadata(&quot;userId&quot;, order.getSeller().getId())\n                                        //.putAllMetadata(metadata)\n                                        .build();\n\n        CustomerCreateParams params1 =\n                CustomerCreateParams.builder().putMetadata(&quot;order_id&quot;, &quot;6735&quot;).build();\n\n        try {\n            Session session = Session.create(params);\n\n            Customer customer = Customer.create(params1);\n\n            return PaymentResponseDto.builder()\n                    .status(&quot;success&quot;)\n                    .message(&quot;Session created successfully&quot;)\n                    .sessionId(session.getId())\n                    .sessionUrl(session.getUrl())\n                    .build();\n\n        } catch (StripeException e) {\n            throw new StripeSessionException(e.getMessage());\n        }\n    }\n}\n</code></pre>\n",
    "tags" : [ "java", "spring-boot", "stripe-payments", "payment" ],
    "owner" : {
      "account_id" : 24687279,
      "reputation" : 25,
      "user_id" : 18580290,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/abaf281e6e9bf135f36375b16f77113b?s=256&d=identicon&r=PG",
      "display_name" : "salinda yasas",
      "link" : "https://stackoverflow.com/users/18580290/salinda-yasas"
    },
    "is_answered" : false,
    "view_count" : 52,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1743488613,
    "creation_date" : 1743273233,
    "link" : "https://stackoverflow.com/questions/79543723/how-to-add-delivery-fee-in-stripe-payment",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79545455,
    "question_id" : 79543723,
    "body" : "<p>As another comment, you would want to look at the <a href=\"https://stackoverflow.com/questions/79543723/how-to-add-delivery-fee-in-stripe-payment\">Charge for shipping</a> section, where you can create a Shipping Rate and display it as separated line.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 4463600,
      "reputation" : 2021,
      "user_id" : 3631795,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/AR3ou.png?s=256",
      "display_name" : "orakaro",
      "link" : "https://stackoverflow.com/users/3631795/orakaro"
    },
    "creation_date" : 1743392473,
    "last_activity_date" : 1743392473,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140279581,
    "post_id" : 79543723,
    "body" : "please refer the &quot;Charge for shipping&quot;, <a href=\"https://docs.stripe.com/payments/during-payment/charge-shipping?dashboard-or-api=api&amp;lang=java\" rel=\"nofollow noreferrer\">docs.stripe.com/payments/during-payment/&hellip;</a>",
    "score" : 2,
    "owner" : {
      "account_id" : 11889649,
      "reputation" : 1461,
      "user_id" : 8700934,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/9pBl6.jpg?s=256",
      "display_name" : "Lakshan",
      "link" : "https://stackoverflow.com/users/8700934/lakshan"
    },
    "creation_date" : 1743349591,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}