{
  "question" : {
    "question_id" : 79564166,
    "title" : "Unable to Inject traceId and spanId in OpenTelemetry Java SDK Log Exporter",
    "body" : "<p>I'm creating a Java Exporter to send logs to the Collector. I want to inject the traceId and spanId, but there is no direct API available in <code>LogRecordBuilder</code>. How can I inject them? Using setAttribute puts them into the LogAttributes field in Clickhouse.</p>\n<h3>Source Code</h3>\n<p>ex) <a href=\"https://github.com/ddakker/test-otel-exporter\" rel=\"nofollow noreferrer\">https://github.com/ddakker/test-otel-exporter</a></p>\n<pre><code>public static SdkLoggerProvider create(Resource resource) {\n    return SdkLoggerProvider.builder()\n        .setResource(resource)\n        .addLogRecordProcessor(            LogRecordProcessorConfig.batchLogRecordProcessor(LogRecordExporterConfig.otlpHttpLogRecordExporter(&quot;http://localhost:4318/v1/logs&quot;)))\n        .setLogLimits(LogLimitsConfig::logLimits)\n        .build();\n  }\n\n...\n\npublic static OpenTelemetrySdk create() {\n    Resource resource = ResourceConfig.create();\n\n    return OpenTelemetrySdk.builder()\n        .setLoggerProvider(SdkLoggerProviderConfig.create(resource))\n        .setPropagators(ContextPropagatorsConfig.create())\n        .build();\n  }\n\n...\n\n        Severity severity = convertToCustomSeverity(level);\n        Logger otelLogger = otel.getLogsBridge().get(&quot;test&quot;);\n\n        LogRecordBuilder logRecordBuilder = otelLogger.logRecordBuilder();\n\n        logRecordBuilder.setTimestamp(instant)\n                .setSeverity(severity)\n                .setSeverityText(level)\n                .setBody(message);\n\n        logRecordBuilder.setAttribute(AttributeKey.stringKey(&quot;traceId&quot;), otelTraceId);\n        logRecordBuilder.setAttribute(AttributeKey.stringKey(&quot;trace_id&quot;), otelTraceId);\n        logRecordBuilder.setAttribute(AttributeKey.stringKey(&quot;trace-id&quot;), otelTraceId);\n        logRecordBuilder.setAttribute(AttributeKey.stringKey(&quot;trace.id&quot;), otelTraceId);\n        if (throwable != null) {\n            logRecordBuilder.setAttribute(&quot;exception.message&quot;, throwable.getMessage())\n                    .setAttribute(&quot;exception.stacktrace&quot;, StackTraceUtil.getContentsOfStackTrace(throwable.getStackTrace()));\n        }\n\n        logRecordBuilder.emit();\n</code></pre>\n<h3>Data stored in Clickhouse</h3>\n<pre><code>[\n  {\n    &quot;Timestamp&quot;: &quot;2025-04-09 19:38:39.670644000&quot;,\n    &quot;TimestampDate&quot;: &quot;2025-04-09&quot;,\n    &quot;TimestampTime&quot;: &quot;2025-04-09 19:38:39&quot;,\n    &quot;TraceId&quot;: &quot;&quot;,\n    &quot;SpanId&quot;: &quot;&quot;,\n    &quot;TraceFlags&quot;: 0,\n    &quot;SeverityText&quot;: &quot;INFO&quot;,\n    &quot;SeverityNumber&quot;: 9,\n    &quot;ServiceName&quot;: &quot;my-service&quot;,\n    &quot;Body&quot;: &quot;error~~~~~~~~~&quot;,\n    &quot;ResourceSchemaUrl&quot;: &quot;&quot;,\n    &quot;ResourceAttributes&quot;: {\n      &quot;telemetry.sdk.name&quot;: &quot;opentelemetry&quot;,\n      &quot;telemetry.sdk.version&quot;: &quot;1.49.0&quot;,\n      &quot;trace.id&quot;: &quot;traceId333&quot;,\n      &quot;traceId&quot;: &quot;traceId222&quot;,\n      &quot;service.name&quot;: &quot;my-service&quot;,\n      &quot;telemetry.sdk.language&quot;: &quot;java&quot;\n    },\n    &quot;ScopeSchemaUrl&quot;: &quot;&quot;,\n    &quot;ScopeName&quot;: &quot;test&quot;,\n    &quot;ScopeVersion&quot;: &quot;&quot;,\n    &quot;ScopeAttributes&quot;: {\n    },\n    &quot;LogAttributes&quot;: {\n      &quot;SpanId&quot;: &quot;ac9ac80fd7ab426fb87f0e0b9acb29ad&quot;,\n      &quot;trace-id&quot;: &quot;ac9ac80fd7ab426fb87f0e0b9acb29ad&quot;,\n      &quot;traceId&quot;: &quot;ac9ac80fd7ab426fb87f0e0b9acb29ad&quot;,\n      &quot;trace_id&quot;: &quot;ac9ac80fd7ab426fb87f0e0b9acb29ad&quot;\n    }\n  }\n]\n</code></pre>\n",
    "tags" : [ "java", "open-telemetry" ],
    "owner" : {
      "account_id" : 4814352,
      "reputation" : 55,
      "user_id" : 3886878,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ce3dbade7728570f55167d9103d49011?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "ddakker",
      "link" : "https://stackoverflow.com/users/3886878/ddakker"
    },
    "is_answered" : false,
    "view_count" : 87,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1744249645,
    "creation_date" : 1744196209,
    "link" : "https://stackoverflow.com/questions/79564166/unable-to-inject-traceid-and-spanid-in-opentelemetry-java-sdk-log-exporter",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79565597,
    "question_id" : 79564166,
    "body" : "<p>In case this helps someone, I'm posting a direct answer.</p>\n<pre><code>SpanContext spanContext =\n  SpanContext.create(\n    IdGenerator.random().generateTraceId(),\n    IdGenerator.random().generateSpanId(),\n    TraceFlags.getDefault(),\n    TraceState.getDefault());\n\n\n...\n\nlogRecordBuilder.setContext(Context.current().with(Span.wrap(spanContext)));\nlogRecordBuilder.emit();\n...\n</code></pre>\n<p><a href=\"https://github.com/open-telemetry/opentelemetry-java-instrumentation\" rel=\"nofollow noreferrer\">https://github.com/open-telemetry/opentelemetry-java-instrumentation</a></p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 4814352,
      "reputation" : 55,
      "user_id" : 3886878,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ce3dbade7728570f55167d9103d49011?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "ddakker",
      "link" : "https://stackoverflow.com/users/3886878/ddakker"
    },
    "creation_date" : 1744249645,
    "last_activity_date" : 1744249645,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}