{
  "question" : {
    "question_id" : 79832040,
    "title" : "Using Pagination &amp; Sorting in Spring Boot 4 with CrudRepository &amp; PagingAndSortingRepository on JDBC",
    "body" : "<p>I am doing the learning on Broadcom's Spring Academy to be up to date with the latest best practices. I bumped Spring Boot to 4.0.0 instead of the 3.0.0 on Spring Academy. But I am having some issues with PagingAndSortingRepository interface. I can succesfully use pagination <code>/demo?page=0&amp;size=1</code> and sorting <code>/demo?sort=amount,desc</code> but I cannot use the combination <code>/demo?page=0&amp;size=1&amp;sort=amount,desc</code>. And I cannot figure out how to fix it with JDBC.</p>\n<p>build.gradle</p>\n<pre class=\"lang-none prettyprint-override\"><code>plugins {\n    id 'java'\n    id 'org.springframework.boot' version '4.0.0'\n    id 'io.spring.dependency-management' version '1.1.7'\n}\n\ngroup = 'com.example'\nversion = '0.0.1-SNAPSHOT'\ndescription = 'Demo project for Spring Boot'\n\njava {\n    sourceCompatibility = '17'\n}\n\nrepositories {\n    mavenCentral()\n}\n\ndependencies {\n    // Rest API\n    implementation 'org.springframework.boot:spring-boot-starter-webmvc'\n    testImplementation 'org.springframework.boot:spring-boot-starter-webmvc-test'\n\n    // Database\n    implementation 'org.springframework.boot:spring-boot-starter-data-jdbc'\n    runtimeOnly 'com.h2database:h2'\n\n    // Security\n    implementation 'org.springframework.boot:spring-boot-starter-security'\n    implementation 'org.thymeleaf.extras:thymeleaf-extras-springsecurity6'\n    testImplementation 'org.springframework.security:spring-security-test'\n\n    // Test\n    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'\n}\n\ntasks.named('test') {\n    useJUnitPlatform()\n}\n\ntest {\n    testLogging {\n        events &quot;passed&quot;, &quot;skipped&quot;, &quot;failed&quot; //, &quot;standardOut&quot;, &quot;standardError&quot;\n\n        showExceptions true\n        exceptionFormat &quot;full&quot;\n        showCauses true\n        showStackTraces true\n\n        // Change from false to true\n        showStandardStreams = true\n    }\n}\n</code></pre>\n<p>DemoRepository.java</p>\n<pre class=\"lang-java prettyprint-override\"><code>interface DemoRepository extends CrudRepository&lt;Demo, Long&gt;, PagingAndSortingRepository&lt;Demo, Long&gt; {\n    boolean existsByIdAndOwner(Long id, String owner);\n\n    Demo findByIdAndOwner(Long id, String owner);\n\n    Page&lt;Demo&gt; findByOwner(String owner, Pageable pageable);\n}\n</code></pre>\n<p>DemoController.java\n(I commented the problematic line proposed on Spring Academy and replaced it by the simpler one above.)</p>\n<pre class=\"lang-java prettyprint-override\"><code>    @GetMapping\n    private ResponseEntity&lt;List&lt;Demo&gt;&gt; readDemos(Pageable pageable, Principal principal) {\n        Page&lt;Demo&gt; page = demoRepository.findByOwner(principal.getName(),\n                PageRequest.of(\n                        pageable.getPageNumber(),\n                        pageable.getPageSize(),\n                        pageable.getSort()\n                        // pageable.getSortOr(Sort.by(Sort.Direction.ASC, &quot;amount&quot;))\n                ));\n\n        return ResponseEntity.ok(page.getContent());\n    }\n</code></pre>\n<p>DemoApplicationTests.java\n(If I use the previous code, it works fine. But if I use the commented out line, it breaks.)</p>\n<pre class=\"lang-java prettyprint-override\"><code> @Test\n    void readDemos_sorting() {\n        EntityExchangeResult&lt;String&gt; result = client.get()\n                .uri(&quot;/demo?page=0&amp;size=1&amp;sort=amount,desc&quot;)\n                .header(HttpHeaders.AUTHORIZATION, authHeader)\n                .exchange()\n                .expectStatus()\n                .isOk()\n                .expectHeader()\n                .contentTypeCompatibleWith(MediaType.APPLICATION_JSON)\n                .expectBody(String.class)\n                .returnResult();\n\n        String responseBody = result.getResponseBody();\n\n        DocumentContext documentContext = JsonPath.parse(responseBody);\n        JSONArray read = documentContext.read(&quot;$[*]&quot;);\n        assertThat(read.size()).isEqualTo(3);\n\n        double amount = documentContext.read(&quot;$[0].amount&quot;);\n        assertThat(amount).isEqualTo(150.00);\n    }\n</code></pre>\n<p>Error when using the commented out line:</p>\n<pre class=\"lang-none prettyprint-override\"><code>org.h2.jdbc.JdbcSQLSyntaxErrorException: Column &quot;DEMO.AMOUNT&quot; must be in the GROUP BY list; SQL statement:\nSELECT COUNT(*) FROM &quot;DEMO&quot; WHERE &quot;DEMO&quot;.&quot;OWNER&quot; = ? ORDER BY &quot;DEMO&quot;.&quot;AMOUNT&quot; ASC [90016-240]\n</code></pre>\n<p>Also, other tests testing the sorting logic fail, whereas they work when I use <code>pageable.getSort()</code>.</p>\n<p>One one hand, I can use <code>pageable.getSort()</code> to support a default call without any sorting params; it also supports sort params; but I cannot combine those sort params with the pagination params or it fails.</p>\n<p>On the other hand, if I use <code>pageable.getSortOr(Sort.by(Sort.Direction.ASC, &quot;amount&quot;))</code>, all sorting fails, and if I use pagination params without sorting params, I get that SQL error.</p>\n<p>View the full code on <a href=\"https://github.com/jlanssie/spring-boot\" rel=\"nofollow noreferrer\">GitHub</a></p>\n",
    "tags" : [ "java", "spring-boot", "spring-mvc", "spring-jdbc", "spring-4" ],
    "owner" : {
      "account_id" : 9189818,
      "reputation" : 127,
      "user_id" : 6830765,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/8ac19c14b8b885b548afa6eb06104560?s=256&d=identicon&r=PG",
      "display_name" : "Jeremy Lanssiers",
      "link" : "https://stackoverflow.com/users/6830765/jeremy-lanssiers"
    },
    "is_answered" : true,
    "view_count" : 150,
    "answer_count" : 3,
    "score" : 1,
    "last_activity_date" : 1764394891,
    "creation_date" : 1764273188,
    "link" : "https://stackoverflow.com/questions/79832040/using-pagination-sorting-in-spring-boot-4-with-crudrepository-pagingandsorti",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}