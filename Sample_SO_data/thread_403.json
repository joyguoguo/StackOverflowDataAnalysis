{
  "question" : {
    "question_id" : 79803804,
    "title" : "Updating JFormattedTextField content on new value",
    "body" : "<p><code>JFormattedTextField</code>, surprisingly, does not automatically update the field text content upon value commit — unless I refocus the component (focus something else and then click the field again). One would think there are OOB listeners that already do that.</p>\n<p>How do (should) I make the field reflect its value right after it is set (even if the field still holds focus)?</p>\n<ol>\n<li><p><code>repaint()</code>, <code>revalidate()</code> in the property listener code have no effect.</p>\n</li>\n<li><p>I can set the text manually, but it triggers an unnecessary invocation of <code>stringToValue()</code>, essentially computing the same value all over again. It is not acceptable.</p>\n</li>\n<li><p>I also discovered resetting the value works but looks very ugly to my eye. It is far from obvious to any reader of the code that such an unusual line repaints the value in the field (or what it does at all). Besides, it sets the caret at zero — I, on the other hand, would prefer it to stay where it is (see the stack trace at the bottom). I am sure I'm supposed to do it another way.</p>\n</li>\n</ol>\n<p>Java 8.</p>\n<pre class=\"lang-java prettyprint-override\"><code>import javax.swing.JFormattedTextField;\nimport javax.swing.JFormattedTextField.AbstractFormatter;\nimport javax.swing.JFormattedTextField.AbstractFormatterFactory;\nimport javax.swing.JFrame;\nimport javax.swing.JPanel;\nimport javax.swing.WindowConstants;\nimport javax.swing.text.DefaultFormatter;\nimport javax.swing.text.DefaultFormatterFactory;\nimport java.awt.Component;\nimport java.awt.Container;\n\npublic class FormattedTextFieldDemo {\n\n    public static void main(String[] args) {\n        JFrame frame = new JFrame(&quot;Formatted Text Field Demo&quot;);\n        frame.setContentPane(createMainPanel());\n        frame.setLocationRelativeTo(null);\n        frame.pack();\n        frame.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);\n        frame.setVisible(true);\n    }\n\n    private static Container createMainPanel() {\n        JPanel panel = new JPanel();\n        panel.add(createTextField());\n        return panel;\n    }\n\n    private static Component createTextField() {\n        JFormattedTextField field = new JFormattedTextField();\n        field.setColumns(10);\n        field.setFormatterFactory(createFormatterFactory());\n        field.addPropertyChangeListener(&quot;value&quot;, e -&gt; {\n//            1. useless\n//            field.repaint();\n\n//            2. works but triggers superfluous value computation\n//            field.setText(toString((Person) e.getNewValue()));\n\n//            3. works but ugly (the equals() check is to avoid StackOverflowError)\n//            if (!Objects.equals(e.getOldValue(), e.getNewValue())) field.setValue(field.getValue());\n            System.out.printf(&quot;Value changed. New value: %s\\n&quot;, e.getNewValue());\n        });\n        return field;\n    }\n\n    private static AbstractFormatterFactory createFormatterFactory() {\n        DefaultFormatterFactory formatterFactory = new DefaultFormatterFactory();\n        formatterFactory.setDefaultFormatter(createFormatter());\n        return formatterFactory;\n    }\n\n    private static AbstractFormatter createFormatter() {\n        AbstractFormatter formatter = new DefaultFormatter() {\n            @Override\n            public Object stringToValue(String string) {\n                return (string == null) ? null : new Person(string);\n            }\n\n            @Override\n            public String valueToString(Object value) {\n                return (value instanceof Person) ? FormattedTextFieldDemo.toString((Person) value) : null;\n            }\n        };\n        return formatter;\n    }\n\n    private static String toString(Person value) {\n        if (value == null) return null;\n        return String.format(&quot;Person %s&quot;, value.getName());\n    }\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>public class Person {\n\n    private String name;\n\n    public Person(String name) {\n        this.name = name;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    public String getName() {\n        return name;\n    }\n\n    @Override\n    public String toString() {\n        return &quot;Person &quot; + name;\n    }\n}\n</code></pre>\n<p>After typing &quot;Alex&quot; and pressing Enter:</p>\n<pre><code>Value changed. New value: null\nValue changed. New value: Person Alex\n</code></pre>\n<p><a href=\"https://i.sstatic.net/nSvbprmP.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/nSvbprmP.png\" alt=\"frame with a field with &quot;Alex&quot; typed in it\" /></a></p>\n<p>The caret stack trace for item 3:</p>\n<pre><code>    at javax.swing.text.DefaultCaret.setDot(DefaultCaret.java:1051)\n    at javax.swing.text.JTextComponent.setCaretPosition(JTextComponent.java:1631)\n    at javax.swing.text.DefaultFormatter.positionCursorAtInitialLocation(DefaultFormatter.java:333)\n    at javax.swing.text.DefaultFormatter.install(DefaultFormatter.java:126)\n    at javax.swing.JFormattedTextField.setFormatter(JFormattedTextField.java:464)\n    at javax.swing.JFormattedTextField.setValue(JFormattedTextField.java:788)\n    at javax.swing.JFormattedTextField.setValue(JFormattedTextField.java:501)\n    at demos.text.field.FormattedTextFieldDemo.lambda$createTextField$0(FormattedTextFieldDemo.java:39)\n</code></pre>\n",
    "tags" : [ "java", "swing" ],
    "owner" : {
      "account_id" : 10187542,
      "reputation" : 2667,
      "user_id" : 20692967,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
      "display_name" : "Sergey Zolotarev",
      "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
    },
    "is_answered" : true,
    "view_count" : 99,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1761747925,
    "creation_date" : 1761741823,
    "link" : "https://stackoverflow.com/questions/79803804/updating-jformattedtextfield-content-on-new-value",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79803900,
    "question_id" : 79803804,
    "body" : "<blockquote>\n<p>Besides, it sets the caret at zero — I, on the other hand, would prefer it to stay where it is</p>\n</blockquote>\n<p>While this doesn't address the ugliness problem (you still need the line in item 3), you can extend <code>AbstractFormatter</code> directly.</p>\n<p>Resetting the caret at zero on value setting is the behavior of <code>DefaultFormatter</code>.</p>\n<pre class=\"lang-java prettyprint-override\"><code>    private static AbstractFormatter createFormatter() {\n        AbstractFormatter formatter = new AbstractFormatter() {\n            // the rest of the code\n        };\n        return formatter;\n    }\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 10187542,
      "reputation" : 2667,
      "user_id" : 20692967,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
      "display_name" : "Sergey Zolotarev",
      "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
    },
    "creation_date" : 1761747925,
    "last_activity_date" : 1761747925,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140836145,
    "post_id" : 79803804,
    "body" : "@Holger <i>&quot;maintain an always correctly written appended disease name or remove it again by hand&quot;</i> the text is interpreted as code, so if no disease code matches (because they didn&#39;t remove &quot;Malaria&quot;), the aforementioned dialog appears. Generally, however, this functionality exists for creating new sick leave forms (where the fields are empty anyway) rather that editing existing forms",
    "score" : 0,
    "owner" : {
      "account_id" : 10187542,
      "reputation" : 2667,
      "user_id" : 20692967,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
      "display_name" : "Sergey Zolotarev",
      "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
    },
    "creation_date" : 1762273487,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140836139,
    "post_id" : 79803804,
    "body" : "@Holger <i>&quot;There is no need to update the text.&quot;</i> And yet it <i>does</i> update the text on refocus",
    "score" : 0,
    "owner" : {
      "account_id" : 10187542,
      "reputation" : 2667,
      "user_id" : 20692967,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
      "display_name" : "Sergey Zolotarev",
      "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
    },
    "creation_date" : 1762273319,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140835286,
    "post_id" : 79803804,
    "body" : "…and in case the user continues editing, are they expected to either, maintain an always correctly written appended disease name or remove it again by hand? It looks like the appended part should rather be a non-editable part of the textfield and not participate in the conversion between the editable part and the application specific object. The <code>JFormattedTextField</code> framework can do that but it’s more involved. I suggest to look at the source code of <code>MaskFormatter</code> and <code>InternationalFormatter</code> for inspiration.",
    "score" : 1,
    "owner" : {
      "account_id" : 3211603,
      "reputation" : 300941,
      "user_id" : 2711488,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/t2hoD.jpg?s=256",
      "display_name" : "Holger",
      "link" : "https://stackoverflow.com/users/2711488/holger"
    },
    "creation_date" : 1762248088,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140834280,
    "post_id" : 79803804,
    "body" : "@Holger the conversion is indeed asymmetric in our app. The user may enter, for example, &quot;B50&quot;, press Enter and expect &quot;B50 Malaria&quot; in the field. Note it doesn&#39;t automatically create a new disease for any string they type. If it doesn&#39;t match exactly one disease entity, a dialog with a disease tree pops app. Then whatever they select gets stored in the field",
    "score" : 0,
    "owner" : {
      "account_id" : 10187542,
      "reputation" : 2667,
      "user_id" : 20692967,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
      "display_name" : "Sergey Zolotarev",
      "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
    },
    "creation_date" : 1762194422,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140833929,
    "post_id" : 79803804,
    "body" : "There is no surprise in that behavior of the formatted textfield. The conversion is supposed to be symmetric and consistent, therefore, the texfield already has the right content when committing the value. There is no need to update the text. Your asymmetric conversion would cause the creation of <code>Person</code> instances with the name <code>&quot;Person name&quot;</code> (and then <code>&quot;Person Person name&quot;</code> and so on) if an update of the text happened your way.",
    "score" : 1,
    "owner" : {
      "account_id" : 3211603,
      "reputation" : 300941,
      "user_id" : 2711488,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/t2hoD.jpg?s=256",
      "display_name" : "Holger",
      "link" : "https://stackoverflow.com/users/2711488/holger"
    },
    "creation_date" : 1762185238,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140827393,
    "post_id" : 79803804,
    "body" : "I didn&#39;t understand your question all that well, initially.  But now, I think it is a valid question.  That said, I really think just setting the text is acceptable.  Calling valueToString a second time is not <i>that</i> costly.  As for the caret... what if the uncommitted text is a different length?  I don&#39;t think there is an easy or reasonable way to preserve the caret position.  Personally, I would not even try.",
    "score" : 0,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44936,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1761836211,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140826559,
    "post_id" : 79803804,
    "body" : "@МПК it does. See <code>javax.swing.JFormattedTextField.CommitAction</code>",
    "score" : 0,
    "owner" : {
      "account_id" : 10187542,
      "reputation" : 2667,
      "user_id" : 20692967,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
      "display_name" : "Sergey Zolotarev",
      "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
    },
    "creation_date" : 1761813009,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140825208,
    "post_id" : 79803804,
    "body" : "Did you try adding <code>field.addActionListener(e -&gt; field.commitEdit());</code>?  I don&#39;t think pressing Enter commits the value normally.",
    "score" : 0,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44936,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1761751181,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}