{
  "question" : {
    "question_id" : 79717183,
    "title" : "How to sanitize input of the Spring Boot Rest controller as per snyk",
    "body" : "<p>I have a microservice with Spring Boot which has a lot of API endpoints. My devops team recently applied Snyk scan for the Jenkins build which is preventing API deployment due to following error:</p>\n<p><em>Unsanitized input from the HTTP request body flows into here, where it is used to render an HTML page returned to the user. This may result in a Cross-Site Scripting attack (XSS).</em></p>\n<p>I understand that the snyk is warning me to not directly use input to the API as it might contains some unwanted character which can cause issue.</p>\n<p>I am not returning any user input directly in my API response. Also I am performing due compliance on the data (in terms of regex, data types, size, length, extensions etc). Therefore, to the best of my knowledge there is no possible cause of XSS here.</p>\n<p>My question is how do I make snyk understand this. I have tried these 2 solutions so far, which obviously didnt work</p>\n<ol>\n<li><p>As suggested by Snyk itself, I tried setting the Content type header explictly to application json. I assumed this way snyk would think its not a script that is being returned.</p>\n</li>\n<li><p>I also used the <strong>produces</strong> parameter in the Request mapping and set it to application json.</p>\n</li>\n</ol>\n<p>Can someone explain what is the way to resolve this.</p>\n<p>Sample code for reference -</p>\n<pre><code>@PostMapping\npublic Mono&lt;ResponseEntity&lt;XYZResponse&lt;ABCResponse&gt;&gt;&gt; xyzmethod(@RequestPart List&lt;String&gt; strings) {\n    return Mono.deferContextual(contextView -&gt; {\n        String correlationId = contextView.getOrDefault(CORRELATION_ID, &quot;&quot;);\n        log.info(&quot;correlationId: {} [Start]-Controller-POST /v1/&quot;, correlationId);\n        return abcService.updateString(strings) // snyk complains about using it directly without sanitizing\n                .map(response -&gt; {\n                    HttpStatus httpStatus = Constants.SUCCESS.equals(response.getStatus()) ? HttpStatus.OK : HttpStatus.BAD_REQUEST;\n                    return ResponseEntity.status(httpStatus).body(response);\n                });\n    });\n}\n</code></pre>\n",
    "tags" : [ "java", "spring-boot", "xss", "sanitization", "snyk" ],
    "owner" : {
      "account_id" : 6924911,
      "reputation" : 5309,
      "user_id" : 5316255,
      "user_type" : "registered",
      "accept_rate" : 55,
      "profile_image" : "https://i.sstatic.net/BYJ8v.jpg?s=256",
      "display_name" : "Saurabh Tiwari",
      "link" : "https://stackoverflow.com/users/5316255/saurabh-tiwari"
    },
    "is_answered" : false,
    "view_count" : 383,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1753778215,
    "creation_date" : 1753698248,
    "link" : "https://stackoverflow.com/questions/79717183/how-to-sanitize-input-of-the-spring-boot-rest-controller-as-per-snyk",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79718317,
    "question_id" : 79717183,
    "body" : "<p>I had a similar situation and creating a <strong>DTO</strong> with validation and <strong>explicit sanitization</strong> helped us:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Data\n@Builder\npublic class RequestDTO {\n\n    @NotNull\n    @Size(...)\n    private List&lt;@NotBlank @Size(...) @Pattern(...) String&gt; strings;\n\n}\n\npublic class StringSanitizer {\n    // Patterns for detecting potentially dangerous content\n    // String sanitization method\n}\n</code></pre>\n<p>If that doesn't help write to me and we'll try to figure it out!</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 42933091,
      "reputation" : 66,
      "user_id" : 30993234,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/XIoZZLIc.jpg?s=256",
      "display_name" : "banitm",
      "link" : "https://stackoverflow.com/users/30993234/banitm"
    },
    "creation_date" : 1753778215,
    "last_activity_date" : 1753778215,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140624853,
    "post_id" : 79717183,
    "body" : "Looks like the violation is caused by passing the input to your service layer, and neither of the things you’ve tried addresses that.",
    "score" : 0,
    "owner" : {
      "account_id" : 446597,
      "reputation" : 25249,
      "user_id" : 839733,
      "user_type" : "registered",
      "accept_rate" : 69,
      "profile_image" : "https://i.sstatic.net/2s6lO.jpg?s=256",
      "display_name" : "Abhijit Sarkar",
      "link" : "https://stackoverflow.com/users/839733/abhijit-sarkar"
    },
    "creation_date" : 1753729195,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79718317" : [ {
      "comment_id" : 140626718,
      "post_id" : 79718317,
      "body" : "Sure..some code would definietely help",
      "score" : 0,
      "owner" : {
        "account_id" : 6924911,
        "reputation" : 5309,
        "user_id" : 5316255,
        "user_type" : "registered",
        "accept_rate" : 55,
        "profile_image" : "https://i.sstatic.net/BYJ8v.jpg?s=256",
        "display_name" : "Saurabh Tiwari",
        "link" : "https://stackoverflow.com/users/5316255/saurabh-tiwari"
      },
      "creation_date" : 1753791993,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140626402,
      "post_id" : 79718317,
      "body" : "What if we try using a wrapper? Wrap it in Wrapper —&gt; sanitize it. I can try to throw some code together if it would be more informative.",
      "score" : 0,
      "owner" : {
        "account_id" : 42933091,
        "reputation" : 66,
        "user_id" : 30993234,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/XIoZZLIc.jpg?s=256",
        "display_name" : "banitm",
        "link" : "https://stackoverflow.com/users/30993234/banitm"
      },
      "creation_date" : 1753784948,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140626346,
      "post_id" : 79718317,
      "body" : "I did. But since file upload works as a form request, RequestBody is not wrking for it. It has to come directly in controller as <code>@RequestPart List&lt;FilePart&gt; mediaFiles</code>",
      "score" : 0,
      "owner" : {
        "account_id" : 6924911,
        "reputation" : 5309,
        "user_id" : 5316255,
        "user_type" : "registered",
        "accept_rate" : 55,
        "profile_image" : "https://i.sstatic.net/BYJ8v.jpg?s=256",
        "display_name" : "Saurabh Tiwari",
        "link" : "https://stackoverflow.com/users/5316255/saurabh-tiwari"
      },
      "creation_date" : 1753783326,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140626303,
      "post_id" : 79718317,
      "body" : "@SaurabhTiwari Oh I see! Try a similar approach with file names as well as with their extensions.",
      "score" : 0,
      "owner" : {
        "account_id" : 42933091,
        "reputation" : 66,
        "user_id" : 30993234,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/XIoZZLIc.jpg?s=256",
        "display_name" : "banitm",
        "link" : "https://stackoverflow.com/users/30993234/banitm"
      },
      "creation_date" : 1753782362,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140626163,
      "post_id" : 79718317,
      "body" : "Thanks banitm. I also tried something like this and it seems to be working in some cases where the API expected RequestBody. However, I have few APIs where I am expecting files object from UI as <code>@RequestPart List&lt;FilePart&gt; mediaFiles</code>. I am looking for a solution of such APIs as well. Can you point to some solution.",
      "score" : 0,
      "owner" : {
        "account_id" : 6924911,
        "reputation" : 5309,
        "user_id" : 5316255,
        "user_type" : "registered",
        "accept_rate" : 55,
        "profile_image" : "https://i.sstatic.net/BYJ8v.jpg?s=256",
        "display_name" : "Saurabh Tiwari",
        "link" : "https://stackoverflow.com/users/5316255/saurabh-tiwari"
      },
      "creation_date" : 1753778677,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}