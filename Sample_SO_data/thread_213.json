{
  "question" : {
    "question_id" : 79825389,
    "title" : "How to retry sending a message to AWS SQS in Spring Boot, and then send it to a DLQ if all retries fail?",
    "body" : "<p>I am working on a Spring Boot 3.5.0 application that publishes messages to an AWS SQS FIFO queue.</p>\n<p>My requirement is:</p>\n<ol>\n<li><p>When sending a message to SQS:</p>\n<ul>\n<li><p>If it fails (network error, AWS error etc.), the application should retry <strong>X times</strong> with <strong>Y seconds delay</strong>.</p>\n</li>\n<li><p>If all retries fail, the message should be automatically sent to another SQS queue which acts as a <strong>DLQ</strong>.</p>\n</li>\n</ul>\n</li>\n<li><p><strong>(Phase 2)</strong> – When the DLQ accumulates <strong>10 messages</strong>, I want to send an email notification about the messages currently sitting in the DLQ.<br />\nBut this is secondary; my main concern is the retry + DLQ logic in Spring Boot.</p>\n</li>\n</ol>\n<hr />\n<h3>What I have tried so far</h3>\n<p>I am using Spring Retry and have something like:</p>\n<pre><code>@Retryable(\n    value = Exception.class,\n    maxAttempts = 4,\n    backoff = @Backoff(delay = 1000, multiplier = 2)\n)\npublic void sendEventToOrderInformationQueue(OrderInformationDto dto, String groupId) {\n    sqsTemplate.send(...);  // simplified\n}\n\n@Recover\npublic void recover(Exception ex, OrderInformationDto dto, String groupId) {\n    // send to DLQ\n}\n</code></pre>\n<p>This works when I test locally, but I want to confirm:</p>\n<ol>\n<li><p>Is this a recommended/idiomatic way to implement retry + DLQ forwarding in Spring Boot?</p>\n</li>\n<li><p>Should the retry logic live inside the SQS client bean, or should it be in a separate service layer?</p>\n</li>\n<li><p>Is @Retryable the right approach for production workloads, or should I use RetryTemplate / AWS SDK retry mechanisms instead?</p>\n</li>\n</ol>\n<p>For phase 2 (email when DLQ has 10 messages), I am thinking of a scheduled job that polls DLQ count and triggers an alert — is this the right direction?</p>\n<hr />\n<h3>What is the best practice for implementing:</h3>\n<ul>\n<li><p>Retry sending SQS messages</p>\n</li>\n<li><p>Forward to a custom DLQ after all retries fail</p>\n</li>\n<li><p>Future extension for DLQ notifications</p>\n</li>\n</ul>\n<p>Thanks for any guidance!</p>\n",
    "tags" : [ "java", "spring", "spring-boot", "amazon-sqs" ],
    "owner" : {
      "account_id" : 26766832,
      "reputation" : 49,
      "user_id" : 20363840,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/ALm5wu2gflM13ggtSis8mjefOe9Wee4-QEe5s5grwDwW=k-s256",
      "display_name" : "IronMan",
      "link" : "https://stackoverflow.com/users/20363840/ironman"
    },
    "is_answered" : false,
    "view_count" : 52,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1763718818,
    "creation_date" : 1763634551,
    "link" : "https://stackoverflow.com/questions/79825389/how-to-retry-sending-a-message-to-aws-sqs-in-spring-boot-and-then-send-it-to-a",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79825736,
    "question_id" : 79825389,
    "body" : "<p>Where is this application running? On Amazon? The sla for sqs is so high that you're never going to use the retry.</p>\n<p>Putting the message on a queue is only that. It what takes it off that can fail.</p>\n<p>Dead Letter Queues are queues that link to other queues where messages are sent where messages are polled for but not deleted (because some process failed).</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 40662,
      "reputation" : 21374,
      "user_id" : 117839,
      "user_type" : "registered",
      "accept_rate" : 74,
      "profile_image" : "https://www.gravatar.com/avatar/826b0d5f2ae42a48261b1bfe780596d6?s=256&d=identicon&r=PG",
      "display_name" : "Michael Wiles",
      "link" : "https://stackoverflow.com/users/117839/michael-wiles"
    },
    "creation_date" : 1763656533,
    "last_activity_date" : 1763656533,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79826363,
    "question_id" : 79825389,
    "body" : "<p>&quot;Is this a recommended/idiomatic way to implement retry + DLQ forwarding in Spring Boot?&quot; - there is no such thing. This is Java land, not .NET land. There is no recommended way to tackle this because you have no recommended way to implement the feature to begin with. I would say most would probably go for <a href=\"https://www.baeldung.com/java-spring-cloud-aws-v3-intro\" rel=\"nofollow noreferrer\">Spring Integration</a> when dealing with external message brokers, as an example. Yet you are here rolling your own, which means you are also on your own. The best I could say is that this is &quot;a&quot; way to do it.</p>\n<p>I do wonder if you considered all the implications. I am not familiar with SQS but generally a retry mechanism means that other messages on the queue are blocked from being processed until the message being retried succeeds to be delivered. If this is a problem, it might be prudent to actually requeue failing messages to some kind of retry queue first.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 187094,
      "reputation" : 5301,
      "user_id" : 424903,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/8oHZF.png?s=256",
      "display_name" : "Gimby",
      "link" : "https://stackoverflow.com/users/424903/gimby"
    },
    "creation_date" : 1763718818,
    "last_activity_date" : 1763718818,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}