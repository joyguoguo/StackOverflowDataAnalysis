{
  "question" : {
    "question_id" : 79540171,
    "title" : "Why is my response already committed in my lowest precedence filter in spring when using ContentCachingResponseWrapper?",
    "body" : "<p>I have a <code>OncePerRequestFilter</code>:</p>\n<pre><code>@Component\npublic class RestrictedSettingsFilter extends OncePerRequestFilter {\n  @Override\n    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException {\n        ContentCachingResponseWrapper responseWrapper = new ContentCachingResponseWrapper(response);\n        try {\n            filterChain.doFilter(request, responseWrapper);\n            if (responseWrapper.isCommitted()) {\n                log.warn(&quot;The response has already been committed, cannot modify it&quot;);\n                return;\n            }\n            // ...\n        } finally { responseWrapper.copyBodyToResponse(); }\n}\n</code></pre>\n<p>and I manually register it (probably should be done by annotations, but the project is a bit old):</p>\n<pre><code>@Bean\npublic FilterRegistrationBean&lt;Filter&gt; restrictedSettingsFilter(RestrictedSettingsFilter restrictedSettingsFilter) {\n        FilterRegistrationBean&lt;Filter&gt; filterRegistrationBean = new FilterRegistrationBean&lt;&gt;();\n        filterRegistrationBean.setFilter(restrictedSettingsFilter);\n        filterRegistrationBean.setOrder(Ordered.LOWEST_PRECEDENCE); \n        return filterRegistrationBean;\n}\n</code></pre>\n<p>From what I understand, when I set its order to <code>LOWEST_PRECEDENCE</code>, it should be resolved last in pre-processing and first in post-processing. Therefore, the response should not be committed yet. But I get <code>The response has already been committed, cannot modify it</code> message. On the other hand, when I set the order to <code>HIGHEST_PRECEDENCE</code>, it started working again. How is it possible?</p>\n",
    "tags" : [ "java", "spring", "spring-boot", "spring-mvc" ],
    "owner" : {
      "account_id" : 15917371,
      "reputation" : 301,
      "user_id" : 11485546,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Kbwzo.png?s=256",
      "display_name" : "Wiktor",
      "link" : "https://stackoverflow.com/users/11485546/wiktor"
    },
    "is_answered" : false,
    "view_count" : 39,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1743115609,
    "creation_date" : 1743115609,
    "link" : "https://stackoverflow.com/questions/79540171/why-is-my-response-already-committed-in-my-lowest-precedence-filter-in-spring-wh",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}