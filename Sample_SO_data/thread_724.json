{
  "question" : {
    "question_id" : 79772406,
    "title" : "I get an IllegalStateException error after updating a ListView",
    "body" : "<p>I'm using a ListView and a BaseAdapter. In a separate thread, I download data from the network and add it to the ArrayList. After updating, I use adapter.notifyDataSetChanged(); and I get an error. How to fix the IllegalStateException error?</p>\n<blockquote>\n<p>Exception in MessageQueue callback: handleReceiveCallback 2025-09-23\n11:19:15.648 17308-17308 MessageQueue-JNI E\njava.lang.IllegalStateException: The content of the adapter has\nchanged but ListView did not receive a notification. Make sure the\ncontent of your adapter is not modified from a background thread, but\nonly from the UI thread. Make sure your adapter calls\nnotifyDataSetChanged() when its content changes. [in\nListView(2131296554, class android.widget.ListView) with Adapter(class\nru.app.vksearch.LevelAdapter)] at\nandroid.widget.ListView.layoutChildren(ListView.java:1721) at\nandroid.widget.AbsListView.onTouchUp(AbsListView.java:4094) at\nandroid.widget.AbsListView.onTouchEvent(AbsListView.java:3886) at\nandroid.view.View.dispatchTouchEvent(View.java:13415) at\nandroid.view.ViewGroup.dispatchTransformedTouchEvent(ViewGroup.java:3054)\nat android.view.ViewGroup.dispatchTouchEvent(ViewGroup.java:2741)</p>\n</blockquote>\n<pre><code> ArrayList&lt;String&gt; title_ = new ArrayList&lt;&gt;();\n    ArrayList&lt;String&gt; photo_ = new ArrayList&lt;&gt;();\n    ArrayList&lt;String&gt; date_ = new ArrayList&lt;&gt;();\n    ArrayList&lt;String&gt; time_ = new ArrayList&lt;&gt;();\n    ArrayList&lt;String&gt; count_ = new ArrayList&lt;&gt;();\n    LevelAdapterFavor adapter;\n    ListView listView;\n   offset\n@Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n\n        listView = (ListView) findViewById(R.id.listView);\n        adapter = new  LevelAdapterFavor(this, title_, photo_, time_, count_, date_);\n        listView.setAdapter(adapter);\n        video();\n\n}\n\n\n\n\npublic void video() {\n\n           VKRequest  r = new VKRequest(&quot;video.search&quot;,VK.getApiVersion());\n                    r.addParam(&quot;q&quot;,&quot;google&quot;);\n                    r.addParam(&quot;offset&quot;, 0);\n                    r.addParam(&quot;count&quot;,200);\n\n            VK.execute(r, new VKApiCallback&lt;JSONObject&gt;() {\n                @Override\n                public void fail(@NonNull Exception e) {\n                }\n\n                @Override\n                public void success(JSONObject response) {\n\n                    ExecutorService service = Executors.newSingleThreadExecutor();\n                    service.execute(new Runnable() {\n                        public void run() {\n\n                            try {\n\n                               JSONObject  responseObject = response.getJSONObject(&quot;response&quot;);\n                               JSONArray responseArray = responseObject.getJSONArray(&quot;items&quot;);\n\n                               offset = offset + responseArray.length();\n\n\n                                for(int i = 0; i &lt; responseArray.length(); i++) {\n\n                                    JSONObject item = responseArray.getJSONObject(i);\n                                    String title = item.getString(&quot;title&quot;);\n                                    String photo = item.getString(&quot;photo_320&quot;);\n                                    long duration = item.getLong(&quot;duration&quot;);\n                                    long date = item.getLong(&quot;date&quot;);\n                                    String count = item.getString(&quot;views&quot;);\n                                    Date date_1 = new Date(date*1000L);\n                                    SimpleDateFormat sdf = new SimpleDateFormat(&quot;dd-MM-yyyy&quot;);\n                                    sdf.setTimeZone(TimeZone.getTimeZone(&quot;GMT-4&quot;));\n                                    String formattedDate = sdf.format(date_1);\n                                    String time = 989999999999;\n\n                                    title_.add(title);\n                                    photo_.add(photo);\n                                    date_.add(formattedDate);\n                                    time_.add(time);\n                                    count_.add(count);\n                                    \n                                }\n\n                            } catch (Exception ignored) {\n\n                            }\n                        }});\n\n                    Future&lt;?&gt; future = service.submit(new Runnable() {\n                        public void run() {\n\n                       if(String.valueOf(responseArray).contains(&quot;[]&quot;)){\n\n                                 offset = 0;\n                                 handler_lenta.sendEmptyMessage(1);\n\n                             }else{\n\n                                 handler_lenta.sendEmptyMessage(2);\n                             }\n                        }\n                    });\n\n                    try{\n                        future.get();\n                    } catch (InterruptedException ignored) {\n                    } catch (ExecutionException e) {\n                        throw new RuntimeException(e);\n                    }\n                }\n            });\n\n\nHandler handler_lenta = new Handler(Looper.getMainLooper()) {\n        @Override\n        public void handleMessage(Message msg) {\n           \n            if(msg.what == 1){\n\n                poisk.setVisibility(View.VISIBLE);\n               adapter.notifyDataSetChanged();\n\n            }\n\n           \n            if(msg.what == 2){\n                video();\n                adapter.notifyDataSetChanged();\n            }\n\n        }\n    };\n}\n</code></pre>\n",
    "tags" : [ "java", "android" ],
    "owner" : {
      "account_id" : 6245327,
      "reputation" : 6,
      "user_id" : 4857470,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/dfb580cb2fd7410b496a78e349acea7c?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Enjo Flash",
      "link" : "https://stackoverflow.com/users/4857470/enjo-flash"
    },
    "is_answered" : false,
    "view_count" : 79,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1758618945,
    "creation_date" : 1758618005,
    "link" : "https://stackoverflow.com/questions/79772406/i-get-an-illegalstateexception-error-after-updating-a-listview",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140754455,
    "post_id" : 79772406,
    "body" : "Why are you using a ListView? It has long been considered deprecated. I would recommend moving to a RecyclerView at the very least.",
    "score" : 1,
    "owner" : {
      "account_id" : 14722107,
      "reputation" : 6861,
      "user_id" : 10632369,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/541566093e9d34a3858f5446d06a7a6e?s=256&d=identicon&r=PG",
      "display_name" : "tomerpacific",
      "link" : "https://stackoverflow.com/users/10632369/tomerpacific"
    },
    "creation_date" : 1758631102,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140754371,
    "post_id" : 79772406,
    "body" : "The crash (IllegalStateException: The content of the adapter has changed but ListView did not receive a notification) happens because the adapter&#39;s data was modified from a background thread. Recommendation: perform network or JSON parsing in the background, but update the adapter&#39;s lists and call notifyDataSetChanged() on the main thread.",
    "score" : 2,
    "owner" : {
      "account_id" : 25113755,
      "reputation" : 228,
      "user_id" : 19801993,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Fgtbc.jpg?s=256",
      "display_name" : "SamPaul Isaac",
      "link" : "https://stackoverflow.com/users/19801993/sampaul-isaac"
    },
    "creation_date" : 1758628902,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}