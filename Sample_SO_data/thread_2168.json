{
  "question" : {
    "question_id" : 79641233,
    "title" : "Inject settings into an immutable object in both SpringBoot 2 and 3",
    "body" : "<p>I'd like to use SpringBoot @ConfigurationProperties to inject settings into immutable objects using the constructor.</p>\n<p>I'd like to do this for a library that supports both SpringBoot 2 and SpringBoot3.</p>\n<p>The usual recommendation is @ConstructorBinding, but unfortunately</p>\n<ul>\n<li>SB2: <code>org.springframework.boot.context.properties.ConstructorBinding</code></li>\n<li>SB3: <code>org.springframework.boot.context.properties.bind.ConstructorBinding</code></li>\n</ul>\n<p>So I can't add <code>@ConstructorBinding</code> to the constructor and have it work with both SB2 and SB3.</p>\n<p>Is there another way to do this that is compatible across 2 and 3?</p>\n<pre><code>@Data\n@ConfigurationProperties(prefix = &quot;myprefix&quot;)\npublic class MyConfig {\n    private Foo foo = new Foo(1, 2, 3);\n    private Bar bar = new Bar(4, 5, 6);\n}\n@Getter\npublic class Foo {\n    private final int a;\n    private final int b;\n    private final int c;\n\n    @ConstructorBinding\n    public Foo(int a, int b, int c) {\n        this.a = a;\n        this.b = b;\n        this.c = c;\n    }\n}\n@Getter\npublic class Bar {\n    private final int d;\n    private final int e;\n    private final int f;\n\n    @ConstructorBinding\n    public Bar(int d, int e, int f) {\n        this.d = d;\n        this.e = e;\n        this.f = f;\n    }\n}\n\n</code></pre>\n<pre><code>myprefix:\n    foo:\n        a: 11\n        b: 22\n        c: 33\n    bar:\n        d: 44\n        e: 55\n        f: 66\n</code></pre>\n<p>It works under SB2 but when I run under SB3 I get</p>\n<pre><code>Failed to bind properties under 'myprefix.foo' to com.disney.misc.Foo:\n\n    Property: myprefix.foo.a\n    Value: &quot;11&quot;\n    Origin: class path resource [application.yml] - 43:12\n    Reason: java.lang.IllegalStateException: No setter found for property: a\n</code></pre>\n<p>And I assume if I change the package name to the SB3 version it will work under 3 and not 2.</p>\n",
    "tags" : [ "java", "spring-boot" ],
    "owner" : {
      "account_id" : 926419,
      "reputation" : 421,
      "user_id" : 957136,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/531fb75e7f195cde6e6bfda81c680ec3?s=256&d=identicon&r=PG",
      "display_name" : "dlipofsky",
      "link" : "https://stackoverflow.com/users/957136/dlipofsky"
    },
    "is_answered" : false,
    "view_count" : 81,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1748616752,
    "creation_date" : 1748382321,
    "link" : "https://stackoverflow.com/questions/79641233/inject-settings-into-an-immutable-object-in-both-springboot-2-and-3",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79645676,
    "question_id" : 79641233,
    "body" : "<p>After many days of beating my head against the wall, I have determined this is just not possible. My solution was to create copies of all the objects as a mutable version, then spring injects the settings into a mutable object using setters, which works for both 2 and 3. The I copy settings from the mutable object to the immutable objects at startup</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 926419,
      "reputation" : 421,
      "user_id" : 957136,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/531fb75e7f195cde6e6bfda81c680ec3?s=256&d=identicon&r=PG",
      "display_name" : "dlipofsky",
      "link" : "https://stackoverflow.com/users/957136/dlipofsky"
    },
    "creation_date" : 1748616752,
    "last_activity_date" : 1748616752,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140466121,
    "post_id" : 79641233,
    "body" : "We want the objects to be immutable, which is why there are no setters, so the question is how to send the values in through the constructor. You can that in either SpringBoot 2 or SpringBoot 3, but I haven&#39;t found a way to do it in a library that will work with both 2 and 3.",
    "score" : 0,
    "owner" : {
      "account_id" : 926419,
      "reputation" : 421,
      "user_id" : 957136,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/531fb75e7f195cde6e6bfda81c680ec3?s=256&d=identicon&r=PG",
      "display_name" : "dlipofsky",
      "link" : "https://stackoverflow.com/users/957136/dlipofsky"
    },
    "creation_date" : 1748438237,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140464362,
    "post_id" : 79641233,
    "body" : "There is no setter methods in <code>Foo</code> and <code>Bar</code>, neither <code>@Setter</code> is present on your  classes, are you sure about that will not cause <code>IllegalStateException</code>?",
    "score" : 0,
    "owner" : {
      "account_id" : 14331879,
      "reputation" : 346,
      "user_id" : 10352428,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/619aa63a0625944a2aa2fd0fdacb95cb?s=256&d=identicon&r=PG",
      "display_name" : "萝莉w",
      "link" : "https://stackoverflow.com/users/10352428/%e8%90%9d%e8%8e%89w"
    },
    "creation_date" : 1748391352,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140464196,
    "post_id" : 79641233,
    "body" : "I see that spring-boot 3.1 has ConstructorBinding under both package names, and will work with the library compiled for SB2, but in spring-boot 3.2 they removed the older deprecated name. Unfortunately I don&#39;t think I can forced all the apps that will use this library onto 3.1, it&#39;s probably a backward step for some of them, and it&#39;s just too old.",
    "score" : 0,
    "owner" : {
      "account_id" : 926419,
      "reputation" : 421,
      "user_id" : 957136,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/531fb75e7f195cde6e6bfda81c680ec3?s=256&d=identicon&r=PG",
      "display_name" : "dlipofsky",
      "link" : "https://stackoverflow.com/users/957136/dlipofsky"
    },
    "creation_date" : 1748383577,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}