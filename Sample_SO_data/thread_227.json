{
  "question" : {
    "question_id" : 79824849,
    "title" : "Using CheckerFramework (or something else) for detecting easily-swappable-parameters on methods?",
    "body" : "<p>I'm having a method that accepts, for example, two long primitives. How can I add checks to prevent the accidental swapping of parameters?</p>\n<p>Something like this should be detected.</p>\n<pre><code>    public void startSomethingElse(@AccountIdParam long accountId, @BalanceParam long balance) {\n        System.out.println(&quot;Account &quot; + accountId + &quot; balance &quot; + balance);\n    }\n\n    public void startOfSomething() {\n        @AccountIdParam long accountId = 1;\n        @BalanceParam long balance = 100;\n        startSomethingElse(balance, accountId);\n    }\n</code></pre>\n<p>Using CheckerFramework, I could create custom qualifiers like this:</p>\n<pre><code>@SubtypeOf({})\n@Target({ElementType.TYPE_USE, ElementType.TYPE_PARAMETER})\npublic @interface AccountIdParam {}\n\n@SubtypeOf({})\n@Target({ElementType.TYPE_USE, ElementType.TYPE_PARAMETER})\npublic @interface BalanceParam {}\n</code></pre>\n<p>But that won't work without creating hierarchy so I need to do something like this which also wouldn't work because of two leaf nodes:</p>\n<pre><code>@SubtypeOf({Unqualified.class})\n@Target({ElementType.TYPE_USE, ElementType.TYPE_PARAMETER})\npublic @interface AccountIdParam {}\n\n@SubtypeOf({Unqualified.class})\n@Target({ElementType.TYPE_USE, ElementType.TYPE_PARAMETER})\npublic @interface BalanceParam {}\n\n@DefaultQualifierInHierarchy\n@Target({ElementType.TYPE_USE, ElementType.TYPE_PARAMETER})\n@SubtypeOf({})\npublic @interface Unqualified {}\n</code></pre>\n<p>How would you do it?</p>\n<p>Couple of constraints:</p>\n<ul>\n<li><p>I need to use primitives so subclassing Java objects isn't a option.</p>\n</li>\n<li><p>I need to have compile time check, not run time.</p>\n</li>\n</ul>\n",
    "tags" : [ "java", "checker-framework" ],
    "owner" : {
      "account_id" : 357456,
      "reputation" : 111,
      "user_id" : 697635,
      "user_type" : "registered",
      "accept_rate" : 50,
      "profile_image" : "https://www.gravatar.com/avatar/0e5a7ca295e5822a87131b0a966c7482?s=256&d=identicon&r=PG",
      "display_name" : "fritz",
      "link" : "https://stackoverflow.com/users/697635/fritz"
    },
    "is_answered" : true,
    "view_count" : 53,
    "answer_count" : 5,
    "score" : 0,
    "last_activity_date" : 1763647642,
    "creation_date" : 1763579613,
    "link" : "https://stackoverflow.com/questions/79824849/using-checkerframework-or-something-else-for-detecting-easily-swappable-parame",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79824865,
    "question_id" : 79824849,
    "body" : "<p><a href=\"https://checkerframework.org/manual/#creating-bottom-and-top-qualifier\" rel=\"nofollow noreferrer\">https://checkerframework.org/manual/#creating-bottom-and-top-qualifier</a> says, &quot;there must be a top qualifier that is a supertype of all other qualifiers, and there must be a bottom qualifier that is a subtype of all other qualifiers&quot;.</p>\n<p>You can add a <code>@ParamBottom</code> qualifier:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Target({ElementType.TYPE_USE, ElementType.TYPE_PARAMETER})\n@SubtypeOf({AccountIdParam.class, BalanceParam.class})\npublic @interface FormatBottom {}\n</code></pre>\n<p>By the way, it is better style to name your top qualifier something like <code>@ParamUnknown</code> rather than just <code>@Unqualified</code>, which doesn't indicate what hierarchy it belongs to.\nYou will also want to set default, restrict the qualifier to ints, etc.; all of these things can be done with meta-annotations written on your <code>@interface</code> declarations.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 58050,
      "reputation" : 8245,
      "user_id" : 173852,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/bbe9bdaaab5367044ba1e72bc4f247e9?s=256&d=identicon&r=PG",
      "display_name" : "mernst",
      "link" : "https://stackoverflow.com/users/173852/mernst"
    },
    "creation_date" : 1763581240,
    "last_activity_date" : 1763581240,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79825038,
    "question_id" : 79824849,
    "body" : "<p>Sounds like you're looking for Error Prone's <a href=\"https://errorprone.info/bugpattern/ArgumentSelectionDefectChecker\" rel=\"nofollow noreferrer\">https://errorprone.info/bugpattern/ArgumentSelectionDefectChecker</a>, which would be much simpler than the approaches you seem to be looking at.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 465573,
      "reputation" : 200423,
      "user_id" : 869736,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/ae7bb06b9a23a4dd7eea69e853d47d12?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Louis Wasserman",
      "link" : "https://stackoverflow.com/users/869736/louis-wasserman"
    },
    "creation_date" : 1763605292,
    "last_activity_date" : 1763605292,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79825230,
    "question_id" : 79824849,
    "body" : "<p>Another alternative is to wrap your primitives in a class, i.e. AccountNumber. Then you will be using a type instead and the whole problem of order of parameters is gone.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 8362430,
      "reputation" : 856,
      "user_id" : 6280255,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/579e86ed5089abcb535b4e05ead3f6f6?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Just another Java programmer",
      "link" : "https://stackoverflow.com/users/6280255/just-another-java-programmer"
    },
    "creation_date" : 1763624893,
    "last_activity_date" : 1763624893,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79825483,
    "question_id" : 79824849,
    "body" : "<p>Thank you @mernst!</p>\n<p>I got this to work:</p>\n<pre><code>void startSomethingElse(@AccountIdParam long accountId, @BalanceParam long balance) {\n    System.out.println(&quot;Account &quot; + accountId + &quot; balance &quot; + balance);\n}\n\nvoid startOfSomething() {\n    /*\n     * either use:\n     * @AccountIdParam long accountId = (@AccountIdParam long) 1;\n     * or\n     * @SuppressWarnings(&quot;assignment&quot;)\n     */\n    @SuppressWarnings(&quot;assignment&quot;)\n    @AccountIdParam long accountId = 1;\n    @SuppressWarnings(&quot;assignment&quot;)\n    @BalanceParam long balance = 100;\n    startSomethingElse(balance, accountId);\n}\n</code></pre>\n<p>And now I have these qualifiers:</p>\n<pre><code>@SubtypeOf({ParamUnknown.class})\n@Target({ElementType.TYPE_USE, ElementType.TYPE_PARAMETER})\npublic @interface AccountIdParam {}\n\n@SubtypeOf({ParamUnknown.class})\n@Target({ElementType.TYPE_USE, ElementType.TYPE_PARAMETER})\npublic @interface BalanceParam {}\n\n@Target({ElementType.TYPE_USE, ElementType.TYPE_PARAMETER})\n@SubtypeOf({AccountIdParam.class, BalanceParam.class})\npublic @interface ParamBottom {}\n\n@DefaultQualifierInHierarchy\n@Target({ElementType.TYPE_USE, ElementType.TYPE_PARAMETER})\n@SubtypeOf({})\npublic @interface ParamUnknown {}\n</code></pre>\n<p>If my number of qualifiers grows, this line on ParamBottom where I list them will become cumbersome. Any advice on that?</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 357456,
      "reputation" : 111,
      "user_id" : 697635,
      "user_type" : "registered",
      "accept_rate" : 50,
      "profile_image" : "https://www.gravatar.com/avatar/0e5a7ca295e5822a87131b0a966c7482?s=256&d=identicon&r=PG",
      "display_name" : "fritz",
      "link" : "https://stackoverflow.com/users/697635/fritz"
    },
    "creation_date" : 1763639659,
    "last_activity_date" : 1763647642,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79825487,
    "question_id" : 79824849,
    "body" : "<p>@Louis Wasserman</p>\n<p>I've looked at ErrorProne ArgumentSelectionDefectChecker, but it does not give me any warning for this.</p>\n<pre><code>void startSomethingElse(long accountId, long balance) {\n    System.out.println(&quot;Account &quot; + accountId + &quot; balance &quot; + balance);\n}\n\nvoid startOfSomething() {\n    long accountId = 1;\n    long balance = 100;\n    startSomethingElse(balance, accountId);\n}\n</code></pre>\n<p>However, it works for this. I guess it needs custom annotations for its heuristic. These are my CheckerFramework annotations :)</p>\n<pre><code>void startSomethingElse(@AccountIdParam long accountId, @BalanceParam long balance) {\n    System.out.println(&quot;Account &quot; + accountId + &quot; balance &quot; + balance);\n}\n\nvoid startOfSomething() {\n    long accountId = 1;\n    long balance = 100;\n    startSomethingElse(balance, accountId);\n}\n</code></pre>\n<p>What am I doing wrong? Thanks!</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 357456,
      "reputation" : 111,
      "user_id" : 697635,
      "user_type" : "registered",
      "accept_rate" : 50,
      "profile_image" : "https://www.gravatar.com/avatar/0e5a7ca295e5822a87131b0a966c7482?s=256&d=identicon&r=PG",
      "display_name" : "fritz",
      "link" : "https://stackoverflow.com/users/697635/fritz"
    },
    "creation_date" : 1763639893,
    "last_activity_date" : 1763640494,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}