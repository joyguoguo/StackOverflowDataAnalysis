{
  "question" : {
    "question_id" : 79819761,
    "title" : "java-cup sends &quot;Syntax error @ Symbol: PARSER&quot; and NullPointerException when compiling a .cup",
    "body" : "<p>I’m working on a DSL parser using <strong>Java CUP</strong>, and I’m getting this error when trying to compile my <code>.cup</code> grammar:</p>\n<pre><code>Error: Syntax error @ Symbol: PARSER (unknown:19/-5(-1) - unknown:19/1(-1))\nError : Internal error: Unexpected exception\nException in thread &quot;main&quot; java.lang.NullPointerException\n        at java_cup.runtime.lr_parser.symbl_name_from_id(lr_parser.java:456)\n        at java_cup.runtime.lr_parser.report_expected_token_ids(lr_parser.java:446)\n        at java_cup.runtime.lr_parser.syntax_error(lr_parser.java:433)\n        at java_cup.runtime.lr_parser.parse(lr_parser.java:725)\n        at java_cup.Main.parse_grammar_spec(Main.java:496)\n        at java_cup.Main.main(Main.java:196)\n</code></pre>\n<p>This happens <strong>during grammar compilation</strong>, not at runtime.<br />\nCUP fails to report the real syntax error and triggers an NPE inside <code>symbl_name_from_id</code>, which makes it harder to locate the issue.</p>\n<p>Below is the exact <code>.cup</code> grammar I’m compiling:</p>\n<pre><code>package edu.uelbosque.dsl.parser;\n\nimport java_cup.runtime.*;\nimport edu.uelbosque.dsl.ast.*;\n\nterminal KW_PROTOCOLO, KW_META, KW_INCLUSION, KW_EXCLUSION, KW_OBJETIVOS, KW_PASOS,\n         KW_NOMBRE, KW_CUANDO, KW_ACCIONES, KW_MEDIDA, KW_EDUCACION, KW_TAREA,\n         KW_ORDEN_MED, KW_SEGURIDAD, KW_SEGUIMIENTO, KW_AJUSTE_DOSIS, KW_AGREGAR_MED,\n         KW_LABS, KW_ALERTAS_GLOBALES, KW_AUTOR, KW_VERSION, KW_VIGENCIA, KW_EVIDENCIA, KW_INTERACCION,\n         LBRACE, RBRACE, LSQUARE, RSQUARE, OPEN_BRACKET, CLOSE_BRACKET, COLON, COMMA,\n         DOT, ARROW, EQ, LT, GT, LE, GE, AND, OR, STRING, NUMBER, BOOLEAN, IDENT;\n\nnon terminal Document, Protocol, ProtocolBody, ProtocolItem, Meta, Inclusion, Exclusion, Objectives, Steps,\n             StepList, Step, StepBody, StepTail, ActionList, Actions, Action, Measure, Education, Task,\n             OrderMed, OrderMedTail, FollowUp, AdjustDose, AddMed, Labs, GlobalAlerts, AlertList, Alert,\n             Obj, Pairs, Pair, Key, Value, List, Values, StringList, Strings, CondList, Exprs, Expr,\n             OrExpr, AndExpr, RelExpr, Primary, CallOrIdent, CallTail, IdentChain, ArgList;\n\nparser code {:\n  SymbolTable st = new SymbolTable();\n:};\n\n\nstart with Document;\n\nDocument ::= Protocol EOF {: RESULT = new Document($1); :} ;\n\nProtocol ::= KW_PROTOCOLO STRING LBRACE ProtocolBody RBRACE {: RESULT = new Protocol($2, $4); :} ;\n\nProtocolBody ::= ProtocolItem ProtocolBody {: RESULT = $2.prepend($1); :}\n               | /* empty */ {: RESULT = new ProtocolBody(); :} ;\n\nProtocolItem ::= Meta | Inclusion | Exclusion | Objectives | Steps | GlobalAlerts ;\n\nMeta ::= KW_META COLON Obj {: RESULT = new Meta($3); :} ;\n\nInclusion ::= KW_INCLUSION COLON CondList {: RESULT = new Inclusion($3); :} ;\n\nExclusion ::= KW_EXCLUSION COLON CondList {: RESULT = new Exclusion($3); :} ;\n\nObjectives ::= KW_OBJETIVOS COLON StringList {: RESULT = new Objectives($3); :} ;\n\nSteps ::= KW_PASOS COLON LSQUARE StepList RSQUARE {: RESULT = new Steps($4); :}\n        | KW_PASOS COLON LSQUARE RSQUARE {: RESULT = new Steps(null); :} ;\n\nStepList ::= Step {: RESULT = new StepList($1); :}\n           | Step COMMA StepList {: RESULT = $3.prepend($1); :} ;\n\nStep ::= LBRACE StepBody RBRACE {: RESULT = new Step($2); :} ;\n\nStepBody ::= KW_NOMBRE COLON STRING StepTail {: RESULT = new StepBody($3, $4); :} ;\n\nStepTail ::= COMMA KW_CUANDO COLON CondList COMMA KW_ACCIONES COLON ActionList {: RESULT = new StepTail($4, $8); :}\n           | COMMA KW_ACCIONES COLON ActionList {: RESULT = new StepTail(null, $4); :} ;\n\nActionList ::= LSQUARE Actions RSQUARE {: RESULT = new ActionList($2); :}\n             | LSQUARE RSQUARE {: RESULT = new ActionList(null); :} ;\n\nActions ::= Action {: RESULT = new Actions($1); :}\n          | Action COMMA Actions {: RESULT = $3.prepend($1); :} ;\n\nAction ::= Measure | Education | Task | OrderMed | FollowUp | AdjustDose | AddMed | Labs ;\n\nMeasure ::= LBRACE KW_MEDIDA COLON STRING RBRACE {: RESULT = new Measure($4); :} ;\n\nEducation ::= LBRACE KW_EDUCACION COLON STRING RBRACE {: RESULT = new Education($4); :} ;\n\nTask ::= LBRACE KW_TAREA COLON STRING RBRACE {: RESULT = new Task($4); :} ;\n\nOrderMed ::= LBRACE KW_ORDEN_MED COLON Obj OrderMedTail RBRACE {: RESULT = new OrderMed($4, $5); :}\n           | LBRACE KW_ORDEN_MED COLON Obj RBRACE {: RESULT = new OrderMed($4, null); :} ;\n\nOrderMedTail ::= COMMA KW_SEGURIDAD COLON CondList {: RESULT = new OrderMedTail($4); :} ;\n\nFollowUp ::= LBRACE KW_SEGUIMIENTO COLON Obj RBRACE {: RESULT = new FollowUp($4); :} ;\n\nAdjustDose ::= LBRACE KW_AJUSTE_DOSIS COLON Obj RBRACE {: RESULT = new AdjustDose($4); :} ;\n\nAddMed ::= LBRACE KW_AGREGAR_MED COLON Obj RBRACE {: RESULT = new AddMed($4); :} ;\n\nLabs ::= LBRACE KW_LABS COLON StringList RBRACE {: RESULT = new Labs($4); :} ;\n\nGlobalAlerts ::= KW_ALERTAS_GLOBALES COLON LSQUARE AlertList RSQUARE {: RESULT = new GlobalAlerts($4); :}\n               | KW_ALERTAS_GLOBALES COLON LSQUARE RSQUARE {: RESULT = new GlobalAlerts(null); :} ;\n\nAlertList ::= Alert {: RESULT = new AlertList($1); :}\n            | Alert COMMA AlertList {: RESULT = $3.prepend($1); :} ;\n\nAlert ::= Expr ARROW STRING {: RESULT = new Alert($1, $3); :}\n        | KW_INTERACCION COLON STRING ARROW STRING {: RESULT = new AlertInteraction($3, $5); :} ;\n\nObj ::= LBRACE Pairs RBRACE {: RESULT = new Obj($2); :}\n     | LBRACE RBRACE {: RESULT = new Obj(null); :} ;\n\nPairs ::= Pair {: RESULT = new Pairs($1); :}\n       | Pair COMMA Pairs {: RESULT = $3.prepend($1); :} ;\n\nPair ::= Key COLON Value {: RESULT = new Pair($1, $3); :} ;\n\nKey ::= IDENT {: RESULT = new Key($1); :}\n     | KW_AUTOR {: RESULT = new Key($1); :}\n     | KW_VERSION {: RESULT = new Key($1); :}\n     | KW_VIGENCIA {: RESULT = new Key($1); :}\n     | KW_EVIDENCIA {: RESULT = new Key($1); :} ;\n\nValue ::= STRING {: RESULT = new Value($1); :}\n       | NUMBER {: RESULT = new Value($1); :}\n       | BOOLEAN {: RESULT = new Value($1); :}\n       | Obj {: RESULT = new Value($1); :}\n       | List {: RESULT = new Value($1); :} ;\n\nList ::= LSQUARE Values RSQUARE {: RESULT = new List($2); :}\n      | LSQUARE RSQUARE {: RESULT = new List(null); :} ;\n\nValues ::= Value {: RESULT = new Values($1); :}\n        | Value COMMA Values {: RESULT = $3.prepend($1); :} ;\n\nStringList ::= LSQUARE Strings RSQUARE {: RESULT = new StringList($2); :}\n            | LSQUARE RSQUARE {: RESULT = new StringList(null); :} ;\n\nStrings ::= STRING {: RESULT = new Strings($1); :}\n         | STRING COMMA Strings {: RESULT = $3.prepend($1); :} ;\n\nCondList ::= LSQUARE Exprs RSQUARE {: RESULT = new CondList($2); :}\n           | LSQUARE RSQUARE {: RESULT = new CondList(null); :} ;\n\nExprs ::= Expr {: RESULT = new Exprs($1); :}\n       | Expr COMMA Exprs {: RESULT = $3.prepend($1); :} ;\n\nExpr ::= OrExpr {: RESULT = $1; :} ;\n\nOrExpr ::= AndExpr {: RESULT = $1; :}\n        | AndExpr OR OrExpr {: RESULT = new OrExpr($1, $3); :} ;\n\nAndExpr ::= RelExpr {: RESULT = $1; :}\n         | RelExpr AND AndExpr {: RESULT = new AndExpr($1, $3); :} ;\n\nRelExpr ::= Primary {: RESULT = $1; :}\n         | Primary EQ Primary {: RESULT = new RelExpr($1, &quot;==&quot;, $3); :}\n         | Primary LT Primary {: RESULT = new RelExpr($1, &quot;&lt;&quot;, $3); :}\n         | Primary GT Primary {: RESULT = new RelExpr($1, &quot;&gt;&quot;, $3); :}\n         | Primary LE Primary {: RESULT = new RelExpr($1, &quot;&lt;=&quot;, $3); :}\n         | Primary GE Primary {: RESULT = new RelExpr($1, &quot;&gt;=&quot;, $3); :} ;\n\nPrimary ::= NUMBER {: RESULT = new Primary($1); :}\n         | STRING {: RESULT = new Primary($1); :}\n         | BOOLEAN {: RESULT = new Primary($1); :}\n         | CallOrIdent {: RESULT = $1; :}\n         | OPEN_BRACKET Expr CLOSE_BRACKET {: RESULT = $2; :} ;\n\nCallOrIdent ::= IdentChain CallTail {: RESULT = new CallOrIdent($1, $2); :}\n             | IdentChain {: RESULT = new CallOrIdent($1, null); :} ;\n\nCallTail ::= OPEN_BRACKET ArgList CLOSE_BRACKET {: RESULT = new CallTail($2); :}\n          | OPEN_BRACKET CLOSE_BRACKET {: RESULT = new CallTail(null); :} ;\n\nIdentChain ::= IDENT {: RESULT = new IdentChain($1); :}\n            | IDENT DOT IdentChain {: RESULT = $3.prepend($1); :} ;\n\nArgList ::= Expr {: RESULT = new ArgList($1); :}\n         | Expr COMMA ArgList {: RESULT = $3.prepend($1); :} ;\n\n</code></pre>\n<p>What I’ve tried:</p>\n<ol>\n<li><p>Verified that all terminals and non-terminals are declared.</p>\n</li>\n<li><p>Checked that all <code>{:</code> <code>:}</code> action blocks are balanced.</p>\n</li>\n<li><p>Checked for missing semicolons or commas in production lists.</p>\n</li>\n<li><p>Tried running CUP with <code>-expect 1</code> to get better messages.</p>\n</li>\n<li><p>Renamed some nonterminals (e.g., <code>List</code>, <code>Document</code>) to avoid collisions, but the error persists.</p>\n</li>\n</ol>\n<p>What kind of grammar issue causes CUP to emit:</p>\n<ul>\n<li><p><code>Syntax error @ Symbol: PARSER</code></p>\n</li>\n<li><p>followed by a <code>NullPointerException</code> in <code>symbl_name_from_id</code>?</p>\n</li>\n</ul>\n<p>How can I locate the real syntax problem inside this grammar?</p>\n<p>Any guidance on how to debug or a pointer to the likely broken production would be greatly appreciated.</p>\n",
    "tags" : [ "java", "parsing", "dsl", "cup" ],
    "owner" : {
      "account_id" : 16569345,
      "reputation" : 13,
      "user_id" : 11972960,
      "user_type" : "registered",
      "profile_image" : "https://graph.facebook.com/2900248633324049/picture?type=large",
      "display_name" : "Sergio Andr&#233;s Valderrama V&#233;lez",
      "link" : "https://stackoverflow.com/users/11972960/sergio-andr%c3%a9s-valderrama-v%c3%a9lez"
    },
    "is_answered" : true,
    "view_count" : 67,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1763114845,
    "creation_date" : 1763106278,
    "link" : "https://stackoverflow.com/questions/79819761/java-cup-sends-syntax-error-symbol-parser-and-nullpointerexception-when-com",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79819893,
    "question_id" : 79819761,
    "body" : "<p>You have a code part (<code>parser code {: ... :};</code>) after the lists of terminal and non-terminal symbols. Try moving it to before the list of terminal and non-terminal symbols.</p>\n<p>The Java CUP grammar is itself parsed by a parser generated using Java CUP. I found a copy of the grammar at <a href=\"https://github.com/ultimate-pa/javacup/blob/master/cup/parser.cup\" rel=\"nofollow noreferrer\">https://github.com/ultimate-pa/javacup/blob/master/cup/parser.cup</a> , although this may be for a later version of CUP, but at <a href=\"https://github.com/ultimate-pa/javacup/blob/master/cup/parser.cup#L231\" rel=\"nofollow noreferrer\">line 231</a>, you can see the top-level production rule lists code parts before symbols.</p>\n<p>Java CUP is very old: I'm not sure what version you are using, but I used version 10k, the only version of it I could find from Maven (<a href=\"https://central.sonatype.com/artifact/edu.princeton.cup/java-cup\" rel=\"nofollow noreferrer\">here</a>), and that's 15 years old. I didn't get an NPE, and I can't explain why you did, but CUP version 10k did at least reject your grammar with a message that was similar to yours. After moving the code part before the lists of symbols (and also removing <code>EOF</code> from one of your production rules, although I'm not sure why I needed to do that), CUP generated the parser.</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 20338,
      "reputation" : 65322,
      "user_id" : 48503,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/672f798341250dd228b286738e8d6309?s=256&d=identicon&r=PG",
      "display_name" : "Luke Woodward",
      "link" : "https://stackoverflow.com/users/48503/luke-woodward"
    },
    "creation_date" : 1763114845,
    "last_activity_date" : 1763114845,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79819893" : [ {
      "comment_id" : 140855694,
      "post_id" : 79819893,
      "body" : "I doubt I&#39;ll bother looking into fixing the NPE. As I&#39;ve already written, CUP is very old. The NPE is thrown from code added to 11b that isn&#39;t in 10k, in what appears to be an incomplete attempt to list what tokens the parser was expecting at the point it encountered a syntax error.",
      "score" : 1,
      "owner" : {
        "account_id" : 20338,
        "reputation" : 65322,
        "user_id" : 48503,
        "user_type" : "registered",
        "accept_rate" : 100,
        "profile_image" : "https://www.gravatar.com/avatar/672f798341250dd228b286738e8d6309?s=256&d=identicon&r=PG",
        "display_name" : "Luke Woodward",
        "link" : "https://stackoverflow.com/users/48503/luke-woodward"
      },
      "creation_date" : 1763217204,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140855653,
      "post_id" : 79819893,
      "body" : "@SergioAndr&#233;sValderramaV&#233;lez The 10k version of CUP did complain about a missing <code>Main-Class</code> attribute in the <code>MANIFEST.MF</code> file, but I worked around that by running the CUP main class directly, using <code>java -cp java-cup-10k.jar java_cup.Main grammar.cup</code>. I wasn&#39;t too sure about the <code>EOF</code> thing: CUP complained that the symbol EOF wasn&#39;t declared, but when I tried to declare it, it complained about a duplicate terminal. Anyway, I&#39;ve been able to reproduce the NPE with version 11b, so maybe I&#39;ll look into fixing it.",
      "score" : 1,
      "owner" : {
        "account_id" : 20338,
        "reputation" : 65322,
        "user_id" : 48503,
        "user_type" : "registered",
        "accept_rate" : 100,
        "profile_image" : "https://www.gravatar.com/avatar/672f798341250dd228b286738e8d6309?s=256&d=identicon&r=PG",
        "display_name" : "Luke Woodward",
        "link" : "https://stackoverflow.com/users/48503/luke-woodward"
      },
      "creation_date" : 1763214492,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140855153,
      "post_id" : 79819893,
      "body" : "Yay, just figured it out!    Thank you so so much! As you said it weird that this little changes made it work, but hey it what I needed!",
      "score" : 0,
      "owner" : {
        "account_id" : 16569345,
        "reputation" : 13,
        "user_id" : 11972960,
        "user_type" : "registered",
        "profile_image" : "https://graph.facebook.com/2900248633324049/picture?type=large",
        "display_name" : "Sergio Andr&#233;s Valderrama V&#233;lez",
        "link" : "https://stackoverflow.com/users/11972960/sergio-andr%c3%a9s-valderrama-v%c3%a9lez"
      },
      "creation_date" : 1763168235,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140855147,
      "post_id" : 79819893,
      "body" : "Appreciate the time you took for this!!  I&#39;m using 11b which is the last one that&#39;s on the website, rarely it works for an example that I have from a friend and I literally tried to copy it for my grammar, but it doesn&#39;t seem to work I don&#39;t know why.  The EOF appears to be like an automatic production rule generated by CUP, so it appears like it&#39;s duplicated.  I tried to use the version you left on the answer but I&#39;m not really sure in how to use this, should I use the same command that I used for 11b?   This is just showing that there&#39;s no attribute of manifest into java-cup-10k.jar",
      "score" : 0,
      "owner" : {
        "account_id" : 16569345,
        "reputation" : 13,
        "user_id" : 11972960,
        "user_type" : "registered",
        "profile_image" : "https://graph.facebook.com/2900248633324049/picture?type=large",
        "display_name" : "Sergio Andr&#233;s Valderrama V&#233;lez",
        "link" : "https://stackoverflow.com/users/11972960/sergio-andr%c3%a9s-valderrama-v%c3%a9lez"
      },
      "creation_date" : 1763167432,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}