{
  "question" : {
    "question_id" : 79688355,
    "title" : "Java: Calculating text width for different fonts on different operating systems with FontMetrics",
    "body" : "<p>I am generating OpenXML (OOXML) Word files with Java. I want to avoid starting chapters or tables at the bottom of a page which would cause them to be split to the next page. So I need to know where my current position on the page is, and add pagebreaks when neccessary.</p>\n<p>To achieve this, I need to know the height space usage of my dynamic texts - depending on the  used font, size and styles.</p>\n<p>I get more or less acceptable results when invoking java.awt FontMetrics like this:</p>\n<pre><code>Graphics2D graphics2D = (Graphics2D) new BufferedImage(1, 1, BufferedImage.TYPE_INT_ARGB).getGraphics();\ngraphics2D.setRenderingHint(RenderingHints.KEY_FRACTIONALMETRICS,\n                    RenderingHints.VALUE_FRACTIONALMETRICS_ON);\ngraphics2D.setFont(new java.awt.Font(&quot;Calibri&quot;, java.awt.Font.PLAIN, 12));\nFontMetrics fontMetrics = graphics2D.getFontMetrics();\n\nSystem.out.println(&quot;Leading: &quot; + fontMetrics.getLeading());\nSystem.out.println(&quot;Height: &quot; + fontMetrics.getHeight());\nSystem.out.println(&quot;Text length: &quot; + fontMetrics.stringWidth(&quot;This is a test text&quot;));\n\n</code></pre>\n<p>Depending on the text length I could calculate the required rows and finally the required total height of my text.</p>\n<p>The problem is now, that the results differ extremly between Windows (development system) and Linux (production system).</p>\n<p>Output on Windows:</p>\n<pre><code>Leading: 3\nHeight: 15\nText length: 82\n</code></pre>\n<p>Output on Linux:</p>\n<pre><code>Leading: 0\nHeight: 15\nText length: 104\n</code></pre>\n<p>I am using OpenJDK 22.0 on both systems.\nMy target is to have equal results on both systems, since the generated OOXML will be opened only on Windows systems.</p>\n<p>Is there a better/working way of measuring text sizes (OS independent) on Java ?</p>\n<p>I already tried using a custom .ttf Font file that is packaged within the jar. Unfortunately this also resulted in different values.</p>\n",
    "tags" : [ "java", "awt", "openxml" ],
    "owner" : {
      "account_id" : 26165701,
      "reputation" : 21,
      "user_id" : 19851565,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3d70c12c6ac0470ec11a6eadfaa4bfe3?s=256&d=identicon&r=PG",
      "display_name" : "Mark Us",
      "link" : "https://stackoverflow.com/users/19851565/mark-us"
    },
    "is_answered" : false,
    "view_count" : 94,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1751542671,
    "creation_date" : 1751522460,
    "link" : "https://stackoverflow.com/questions/79688355/java-calculating-text-width-for-different-fonts-on-different-operating-systems",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79688773,
    "question_id" : 79688355,
    "body" : "<p>To get the width occupied by a text, you can use the following:</p>\n<pre><code>public void showWidth() {\n\n     // if we do not have a *Font* object we define it\n   Font font = new Font( &quot;Arial&quot;, Font.PLAIN, 14 );\n   Canvas canvas = new Canvas();\n   FontMetrics fontMetrics = canvas.getFontMetrics( font );\n\n     // if you prefer a single line\n     // FontMetrics fontMetrics = new Canvas().getFontMetrics( new Font( &quot;Arial&quot;, Font.PLAIN, 14 ) );\n\n   int width = fontMetrics.stringWidth( &quot;Popotolimeco&quot; );\n   System.out.println( width );\n}\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 10843443,
      "reputation" : 916,
      "user_id" : 20882864,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/CCQCy.jpg?s=256",
      "display_name" : "Marce Puente",
      "link" : "https://stackoverflow.com/users/20882864/marce-puente"
    },
    "creation_date" : 1751542671,
    "last_activity_date" : 1751542671,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140564820,
    "post_id" : 79688355,
    "body" : "While I would not want to try to navigate the OpenXML “specification,” don’t Word files have keep/widow/orphan format settings for individual paragraphs?  If they do, wouldn’t using those settings be easier than calculating it yourself?",
    "score" : 0,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44936,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1751628669,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140561776,
    "post_id" : 79688355,
    "body" : "May be also the DPI must be taken into account and is not the same on your platforms ? In BoUML because the size of the font impacts the default size of the elements in the diagrams, I allow to force it to help to have similar diagrams when using the tool  for the same projects on different platforms. I used Qt and the default DPI was 96 for Windows and Linux, and 72 for MacOS.  I don&#39;t know if for you the DPI is the same on your platforms and a possible difference has an impact even you use a common font.",
    "score" : 0,
    "owner" : {
      "account_id" : 2864397,
      "reputation" : 34338,
      "user_id" : 2458991,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/WWDzI.jpg?s=256",
      "display_name" : "bruno",
      "link" : "https://stackoverflow.com/users/2458991/bruno"
    },
    "creation_date" : 1751542773,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140561121,
    "post_id" : 79688355,
    "body" : "Try using an other font. Like Courier",
    "score" : 0,
    "owner" : {
      "account_id" : 40864244,
      "reputation" : 632,
      "user_id" : 30001713,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f59ea01a76709335047f0cee269d788e?s=256&d=identicon&r=PG",
      "display_name" : "biggujo",
      "link" : "https://stackoverflow.com/users/30001713/biggujo"
    },
    "creation_date" : 1751529488,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140560901,
    "post_id" : 79688355,
    "body" : "You seem to have omitted a word in phrase: “where my current position on the is”.",
    "score" : 0,
    "owner" : {
      "account_id" : 322981,
      "reputation" : 346951,
      "user_id" : 642706,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://i.sstatic.net/ZWEI3.jpg?s=256",
      "display_name" : "Basil Bourque",
      "link" : "https://stackoverflow.com/users/642706/basil-bourque"
    },
    "creation_date" : 1751524872,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140560896,
    "post_id" : 79688355,
    "body" : "Every OS, and some apps, has its own technology for font rendering. Apple’s technology has always been the most sophisticated, with some others being quite crude. So you will see differences across platforms, and even across different versions of the same app/platform.",
    "score" : 0,
    "owner" : {
      "account_id" : 322981,
      "reputation" : 346951,
      "user_id" : 642706,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://i.sstatic.net/ZWEI3.jpg?s=256",
      "display_name" : "Basil Bourque",
      "link" : "https://stackoverflow.com/users/642706/basil-bourque"
    },
    "creation_date" : 1751524675,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140560882,
    "post_id" : 79688355,
    "body" : "I checked this. Calibri is not installed on the system. I would assume awt brings its own font familiy metrics ? I also don&#39;t think that it has to to with such, as using a (packaged) ttf file for the Metrics also results in different values.",
    "score" : 0,
    "owner" : {
      "account_id" : 26165701,
      "reputation" : 21,
      "user_id" : 19851565,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3d70c12c6ac0470ec11a6eadfaa4bfe3?s=256&d=identicon&r=PG",
      "display_name" : "Mark Us",
      "link" : "https://stackoverflow.com/users/19851565/mark-us"
    },
    "creation_date" : 1751524290,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140560876,
    "post_id" : 79688355,
    "body" : "Calibri is a commercial Microsoft product. Not likely present on a Linux machine, as mentioned above. If not present, some other font is used instead, hence the difference you see.  Perhaps you should consider using Google’s freely-licensed font Carlito that is metric-compatible to Calibri. <a href=\"https://en.m.wikipedia.org/wiki/Calibri\" rel=\"nofollow noreferrer\">en.m.wikipedia.org/wiki/Calibri</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 322981,
      "reputation" : 346951,
      "user_id" : 642706,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://i.sstatic.net/ZWEI3.jpg?s=256",
      "display_name" : "Basil Bourque",
      "link" : "https://stackoverflow.com/users/642706/basil-bourque"
    },
    "creation_date" : 1751524207,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140560848,
    "post_id" : 79688355,
    "body" : "Under LInux the calibri font is generally not installed by default, except if you installed it may be it was replaced by an other, explaining the different results ? You can do <code>fc-list  | grep -i calibri</code> or <code>fc-match calibri</code> to check it is installed.",
    "score" : 1,
    "owner" : {
      "account_id" : 2864397,
      "reputation" : 34338,
      "user_id" : 2458991,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/WWDzI.jpg?s=256",
      "display_name" : "bruno",
      "link" : "https://stackoverflow.com/users/2458991/bruno"
    },
    "creation_date" : 1751523342,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}