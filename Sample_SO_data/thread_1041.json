{
  "question" : {
    "question_id" : 79749366,
    "title" : "Anonymous SecurityContext initiated when using SpringSecurity with permitted patterns",
    "body" : "<p>I am using Spring Security 6.4.8.\nI need to allow an endpoint for initiation of the login, say <code>/fun</code>, in which I need to have certain logic (e.g. do something with a passed parameter).</p>\n<p>Therefore, I need unauthenticated call to this controller.</p>\n<pre><code>@RestController\npublic class FunController {\n\n    @GetMapping(&quot;/fun&quot;)\n    public ResponseEntity&lt;String&gt; fun() {\n        return ResponseEntity.ok(&quot;FUN!&quot;);\n    }\n}\n</code></pre>\n<p>I can't find a way to get a call to it (in reality it will be another service calling mine), that would not trigger the anonymous <code>SecurityContext</code> which will joyfully initiate the login process before my controller has done its job.</p>\n<p>More specifically, I get</p>\n<pre><code>o.s.security.web.FilterChainProxy        : Securing GET /fun\no.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext\n</code></pre>\n<p>My filter chain looks like this:</p>\n<pre><code> public SecurityFilterChain filterChain(HttpSecurity http, RestClient restClient) throws Exception {\n\n        http\n                .authorizeHttpRequests(\n                        requests -&gt;\n                                requests\n                                        .requestMatchers(&quot;/&quot;, &quot;/fun&quot;, &quot;/login&quot;, &quot;/login?error&quot;)\n                                        .permitAll()\n                                        .anyRequest()\n                                        .authenticated())\n                .oauth2Login(\n                        oauth -&gt;\n                                oauth\n                                        .defaultSuccessUrl(&quot;/authorized&quot;)\n                                        ...)\n                //.oauth2Client(Customizer.withDefaults());\n\n        return http.build();\n</code></pre>\n<p>I read that Spring will at least start the anonymous security filter.\nI there a way I can allow <code>/fun</code> be reached by services within my network?</p>\n",
    "tags" : [ "java", "spring", "spring-security" ],
    "owner" : {
      "account_id" : 2396647,
      "reputation" : 852,
      "user_id" : 2095321,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/10edf94efbce074c543fa0993e882135?s=256&d=identicon&r=PG",
      "display_name" : "Mateva",
      "link" : "https://stackoverflow.com/users/2095321/mateva"
    },
    "is_answered" : true,
    "view_count" : 40,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1756714235,
    "creation_date" : 1756397856,
    "link" : "https://stackoverflow.com/questions/79749366/anonymous-securitycontext-initiated-when-using-springsecurity-with-permitted-pat",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79752292,
    "question_id" : 79749366,
    "body" : "<p>So, this was a very unexpected problem, quite a goofy one.</p>\n<p>In my application I had</p>\n<pre><code>@ComponentScan(basePackages = {&quot;path.to.a.package.from.external.module.with.generic.spring.auth.components&quot;,\n &quot;path.to.a.package.with.local.spring.security.customizations.with.typo&quot;})\n</code></pre>\n<p>Note the part <code>with.typo</code> - I was completely shadowing my custom implementation, including my custom security chain from above.\nInterestingly, Spring did not complain about this problem. Maybe this is expected because the package might exist, but providing no components?\nI switched to Idea Ultimate in the meantime and now it shows me such packages, but I just wonder if this is fair tradeoff, given the fact it might cover bugs extremely well.</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 2396647,
      "reputation" : 852,
      "user_id" : 2095321,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/10edf94efbce074c543fa0993e882135?s=256&d=identicon&r=PG",
      "display_name" : "Mateva",
      "link" : "https://stackoverflow.com/users/2095321/mateva"
    },
    "creation_date" : 1756714235,
    "last_activity_date" : 1756714235,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140705670,
    "post_id" : 79749366,
    "body" : "Why is Spring setting it to the anonymous SecurityContext an issue? That part shouldn&#39;t prevent the endooint from being called.",
    "score" : 1,
    "owner" : {
      "account_id" : 15064163,
      "reputation" : 17100,
      "user_id" : 10871900,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/720202b6e19abc330dcd92e6a1254562?s=256&d=identicon&r=PG",
      "display_name" : "dan1st",
      "link" : "https://stackoverflow.com/users/10871900/dan1st"
    },
    "creation_date" : 1756674740,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140703733,
    "post_id" : 79749366,
    "body" : "Please enable spring security debug logs and edit your question to include them in full",
    "score" : 0,
    "owner" : {
      "account_id" : 2064278,
      "reputation" : 15073,
      "user_id" : 1840146,
      "user_type" : "registered",
      "accept_rate" : 86,
      "profile_image" : "https://i.sstatic.net/JXdxm.png?s=256",
      "display_name" : "Toerktumlare",
      "link" : "https://stackoverflow.com/users/1840146/toerktumlare"
    },
    "creation_date" : 1756565213,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}