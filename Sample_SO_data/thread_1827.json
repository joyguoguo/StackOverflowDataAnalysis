{
  "question" : {
    "question_id" : 79671982,
    "title" : "How can I use ONNX-based trackers in OpenCV Android?",
    "body" : "<p>I'm building an app for android that uses OpenCV, written in Kotlin.</p>\n<p>I want to use OpenCV's Trackers. And I actually achieved to use <code>TrackerMIL</code></p>\n<p>To install opencv I use this in my <code>gradle/libs.versions.toml</code>:</p>\n<pre><code>...\nopencv-android = &quot;4.10.0&quot;\nopencv-android = { module = &quot;org.opencv:opencv&quot;, version.ref = &quot;opencv-android&quot; }\n...\n</code></pre>\n<p>And in my <code>build.gradle.kts</code>:</p>\n<pre><code>        androidMain.dependencies {\n            implementation(libs.kotlinx.coroutines.play.services)\n            implementation(libs.opencv.android) // !\n            implementation(libs.mlkit.textRecognition)\n            implementation(libs.commons.text)\n            implementation(libs.litert)\n            implementation(libs.litert.support.api)\n            implementation(libs.litert.metadata)\n        }\n</code></pre>\n<p>Like this I can properly:</p>\n<pre><code>import org.opencv.video.TrackerMIL\npublic typealias TrackerType = TrackerMIL\n...\nval tracker = TrackerType.create()\ntracker.init(mat, rect)\n\n...\n\nval located = tracker.update(mat, rect)\n\n...\n\n</code></pre>\n<p>However if I change the tracker to <code>TrackerNano</code> or <code>TrackerVit</code></p>\n<pre><code>import org.opencv.video.TrackerNano // ONNX\nimport org.opencv.video.TrackerVit  // ONNX\n\npublic typealias TrackerType = TrackerVit\n...\n</code></pre>\n<p>I get this error:</p>\n<pre><code>06-19 12:09:51.221 12721 12742 E TestRunner: ----- begin exception -----\n06-19 12:09:51.221 12721 12742 E TestRunner: CvException [org.opencv.core.CvException: cv::Exception: OpenCV(4.10.0) /home/ci/opencv/modules/dnn/src/onnx/onnx_importer.cpp:277: error: (-5:Bad argument) Can't read ONNX file: vitTracker.onnx in function 'ONNXImporter'\n06-19 12:09:51.221 12721 12742 E TestRunner: ]\n06-19 12:09:51.221 12721 12742 E TestRunner:    at org.opencv.video.TrackerVit.create_1(Native Method)\n06-19 12:09:51.221 12721 12742 E TestRunner:    at org.opencv.video.TrackerVit.create(TrackerVit.java:43)\n06-19 12:09:51.221 12721 12742 E TestRunner:    at com.ltu.ibsa.analysis.MultiObjectTrackingModel$detectAndTrack$2.invokeSuspend(MultiObjectTrackingModel.kt:168)\n06-19 12:09:51.221 12721 12742 E TestRunner:    at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:33)\n06-19 12:09:51.221 12721 12742 E TestRunner:    at kotlinx.coroutines.DispatchedTask.run(DispatchedTask.kt:100)\n06-19 12:09:51.221 12721 12742 E TestRunner:    at kotlinx.coroutines.scheduling.CoroutineScheduler.runSafely(CoroutineScheduler.kt:586)\n06-19 12:09:51.221 12721 12742 E TestRunner:    at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.executeTask(CoroutineScheduler.kt:829)\n06-19 12:09:51.221 12721 12742 E TestRunner:    at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.runWorker(CoroutineScheduler.kt:717)\n06-19 12:09:51.221 12721 12742 E TestRunner:    at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.run(CoroutineScheduler.kt:704)\n06-19 12:09:51.221 12721 12742 E TestRunner: ----- end exception -----\n06-19 12:09:51.226 12721 12742 I TestRunner: finished: testMultiObjectTracking(com.ltu.ibsa.LiteRTIntegrationTest)\n\nCvException [org.opencv.core.CvException: cv::Exception: OpenCV(4.10.0) /home/ci/opencv/modules/dnn/src/onnx/onnx_importer.cpp:277: error: (-5:Bad argument) Can't read ONNX file: vitTracker.onnx in function 'ONNXImporter'\n]\nat org.opencv.video.TrackerVit.create_1(Native Method)\nat org.opencv.video.TrackerVit.create(TrackerVit.java:43)\nat com.ltu.ibsa.analysis.MultiObjectTrackingModel$detectAndTrack$2.invokeSuspend(MultiObjectTrackingModel.kt:168)\nat kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:33)\nat kotlinx.coroutines.DispatchedTask.run(DispatchedTask.kt:100)\nat kotlinx.coroutines.scheduling.CoroutineScheduler.runSafely(CoroutineScheduler.kt:586)\nat kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.executeTask(CoroutineScheduler.kt:829)\nat kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.runWorker(CoroutineScheduler.kt:717)\nat kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.run(CoroutineScheduler.kt:704)\n\n</code></pre>\n<p>It seems like the <code>&quot;vitTracker.onnx&quot;</code> file is missing. So I downloaded it, put it into the <code>assets</code> folder and:</p>\n<pre><code>// Load the ONNX file from assets\nval assetManager = context.assets\nval inputStream = assetManager.open(&quot;vitTracker.onnx&quot;)\nval file = File(context.cacheDir, &quot;vitTracker.onnx&quot;)\nfile.outputStream().use { inputStream.copyTo(it) }\nval filePath = file.absolutePath\n\nval params = TrackerVit_Params()\nparams.set_net(filePath)\n...\ntracker.init(mat, rect)\n</code></pre>\n<p>But I got the same error.</p>\n<p>Question: What's the right way to use the ONNX base trackers? Do I have missing dependencies? Is this the right way to set the model file?</p>\n",
    "tags" : [ "java", "android", "kotlin", "opencv", "onnx" ],
    "owner" : {
      "account_id" : 5663357,
      "reputation" : 1551,
      "user_id" : 11261546,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/xHAUw.jpg?s=256",
      "display_name" : "Ivan",
      "link" : "https://stackoverflow.com/users/11261546/ivan"
    },
    "is_answered" : false,
    "view_count" : 93,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1750335164,
    "creation_date" : 1750332022,
    "link" : "https://stackoverflow.com/questions/79671982/how-can-i-use-onnx-based-trackers-in-opencv-android",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}