{
  "question" : {
    "question_id" : 79708929,
    "title" : "Defining Log4j loggers in both the main `.xml` file and through `XInclude`",
    "body" : "<p>I'm having trouble understanding the priority of Log4j loggers when they are defined both in the main <code>.xml</code> file and in files included via the <code>xi:include</code> element. All the XInclude examples I've seen so far use the following approach:</p>\n<pre><code>&lt;Configuration&gt;\n  &lt;!-- other fields --&gt;\n\n  &lt;xi:include href=&quot;xinclude-loggers.xml&quot;/&gt;\n&lt;/Configuration&gt;\n</code></pre>\n<p>So there is a main file that includes another file containing specific logger definitions via the <code>xi:include</code> element.</p>\n<p>In contrast, I'm referring to a situation where one set of logger definitions is specified in the main file and another in the included file. For example:</p>\n<pre><code>\nlog4j.xml:\n\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;Configuration&gt;\n\n    &lt;xi:include href=&quot;xinclude-loggers.xml&quot;/&gt;\n    &lt;Loggers&gt;\n        &lt;Logger name=&quot;myLogger1&quot; level=&quot;DEBUG&quot;&gt;\n        &lt;/Logger&gt;\n    &lt;/Loggers&gt;\n&lt;/Configuration&gt;\n</code></pre>\n<p>xinclude-loggers.xml:</p>\n<pre><code>\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;Loggers&gt;\n    &lt;Logger name=&quot;myLogger1&quot; level=&quot;INFO&quot;&gt;\n       &lt;AppenderRef ref=&quot;CONSOLE&quot;/&gt;\n    &lt;/Logger&gt;\n&lt;/Loggers&gt;\n</code></pre>\n<p>The <a href=\"https://logging.apache.org/log4j/2.x/manual/configuration.html#property-substitution\" rel=\"nofollow noreferrer\">documentation</a> says the following:</p>\n<blockquote>\n<p>CompositeConfiguration merges multiple configurations into a single one using a MergeStrategy, which can be customized using the log4j2.mergeStrategy configuration property. The default merge strategy works as follows:</p>\n</blockquote>\n<blockquote>\n<p>Loggers are aggregated. Logger attributes are individually merged, and those in later configurations replace duplicates. Appender references on a logger are aggregated, and those in later configurations replace duplicates. The strategy merges filters on loggers using the rule above.</p>\n</blockquote>\n<p>Consider now the following scenario (s1).<br />\nIn the <code>main.xml</code> file, we have:</p>\n<pre><code>&lt;Configuration&gt;\n    &lt;xi:include href=&quot;log4j-s1-loggers.xml&quot;/&gt;\n    &lt;Loggers&gt;\n        &lt;Root level=&quot;INFO&quot;&gt;&lt;/Root&gt;\n    &lt;/Loggers&gt;\n&lt;/Configuration&gt;\n</code></pre>\n<p>and in the <code>log4j-s1-loggers.xml</code>:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;Loggers&gt;    \n    &lt;Logger name=&quot;myLogger1&quot; level=&quot;DEBUG&quot;/&gt;\n    &lt;Logger name=&quot;myLogger2&quot; level=&quot;DEBUG&quot;/&gt;\n&lt;/Loggers&gt;\n</code></pre>\n<p>When I debug my Java code, I can see that both <code>myLogger1</code> and <code>myLogger2</code> have their debugging level set to <code>INFO</code>.\nSo even though these loggers are not explicitly declared within the <code>&lt;Loggers&gt;</code> element of the <code>main.xml</code>, their debug levels have been overridden by the root level, changing from <code>DEBUG</code> to <code>INFO</code>. This is not something I'd have expected after reading the quoted section of the docs.<br />\nOk, so let's now consider the second scenario (s2) where the <code>XInclude</code> is placed after the <code>Loggers</code> element in the main file, giving us <code>main2.xml</code></p>\n<pre><code>&lt;Configuration&gt;\n    \n    &lt;Loggers&gt;\n        &lt;Root level=&quot;INFO&quot;&gt;&lt;/Root&gt;\n    &lt;/Loggers&gt;\n    &lt;xi:include href=&quot;log4j-s2-loggers.xml&quot;/&gt;\n&lt;/Configuration&gt;\n</code></pre>\n<p>After the initial surprise, I now expect that any (implicit) information about the loggers in the main file will be overridden by the contents of <code>log4j-s2-loggers</code>.\nThis turns out to be correct, checking the Java code, both loggers now have the <code>DEBUG</code> level.</p>\n<p>It appears that only one definition of the <code>&lt;Loggers&gt;</code> element can be active at a time.\nIf two are present, one will completely overwrite the other, even if a specific logger's definition is not explicitly defined in one of them (as we saw in scenario s1).</p>\n<hr />\n<p>Could someone clarify how Log4j2 handles merging in this context (only one `&lt;Loggers&gt;` element possible?), and ideally point to the relevant section in the documentation?</p>\n",
    "tags" : [ "java", "xml", "logging", "log4j2", "xinclude" ],
    "owner" : {
      "account_id" : 32393154,
      "reputation" : 21,
      "user_id" : 25161686,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d5c483fc3bd6e06e954f72a5f822d507?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Walter Butze",
      "link" : "https://stackoverflow.com/users/25161686/walter-butze"
    },
    "is_answered" : true,
    "view_count" : 74,
    "answer_count" : 1,
    "score" : 2,
    "last_activity_date" : 1753128361,
    "creation_date" : 1753094093,
    "link" : "https://stackoverflow.com/questions/79708929/defining-log4j-loggers-in-both-the-main-xml-file-and-through-xinclude",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79709586,
    "question_id" : 79708929,
    "body" : "<p>You're mixing up two separate concepts in Log4j Core configuration:</p>\n<h3><a href=\"https://logging.apache.org/log4j/2.x/manual/configuration.html#xinclude\" rel=\"nofollow noreferrer\">XInclude</a></h3>\n<p>This is <strong>a feature of the XML parser</strong>, not of Log4j Core itself. It allows one XML document to include another, or a part of another, <strong>at parse time</strong>, before Log4j Core even sees it.</p>\n<p>However, Java’s default XML parser has <strong>limited support for XInclude</strong>, particularly for XPointer schemes (like <code>xpointer(/Loggers/Logger)</code>). In practice, you're mostly limited to the basic <code>element()</code> scheme, which uses numeric positions in the tree.</p>\n<p>Here’s a working example using what the default Java parser supports:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;Configuration xmlns:xi=&quot;http://www.w3.org/2001/XInclude&quot;&gt;\n  &lt;Loggers&gt;\n    &lt;Root level=&quot;INFO&quot;/&gt;\n\n    &lt;!-- Include the first and second child of the root element in log4j-s1-logger.xml --&gt;\n    &lt;xi:include href=&quot;log4j-s1-logger.xml&quot; xpointer=&quot;element(/1/1)&quot;/&gt;\n    &lt;xi:include href=&quot;log4j-s1-logger.xml&quot; xpointer=&quot;element(/1/2)&quot;/&gt;\n  &lt;/Loggers&gt;\n&lt;/Configuration&gt;\n</code></pre>\n<h3><a href=\"https://logging.apache.org/log4j/2.x/manual/configuration.html#CompositeConfiguration\" rel=\"nofollow noreferrer\">Composite Configuration</a></h3>\n<p>This is a <strong>Log4j Core feature</strong>, not part of the XML parsing system. It allows you to <strong>merge multiple complete Log4j configuration files</strong>, even if they are in different formats (e.g., XML, JSON, YAML).</p>\n<p>To use this, each file must be a valid <strong>standalone Log4j configuration</strong>. So you'd need to rewrite <code>log4j-s1-logger.xml</code> like this:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;Configuration&gt;\n  &lt;Loggers&gt;\n    &lt;Logger name=&quot;myLogger1&quot; level=&quot;DEBUG&quot;/&gt;\n    &lt;Logger name=&quot;myLogger2&quot; level=&quot;DEBUG&quot;/&gt;\n  &lt;/Loggers&gt;\n&lt;/Configuration&gt;\n</code></pre>\n<p>Then you can load both files by setting the system property:</p>\n<pre class=\"lang-bash prettyprint-override\"><code>-Dlog4j2.configurationFile=log4j2.xml,log4j-s1-logger.xml\n</code></pre>\n<p>Log4j will treat both as full configurations and merge them according to its <strong>composite configuration rules</strong>.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 16269349,
      "reputation" : 16729,
      "user_id" : 11748454,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qyBNp.jpg?s=256",
      "display_name" : "Piotr P. Karwasz",
      "link" : "https://stackoverflow.com/users/11748454/piotr-p-karwasz"
    },
    "creation_date" : 1753128361,
    "last_activity_date" : 1753128361,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79709586" : [ {
      "comment_id" : 140612942,
      "post_id" : 79709586,
      "body" : "@WalterButze We publish an <a href=\"https://logging.apache.org/xml/ns/\" rel=\"nofollow noreferrer\">XML Schema</a> that recognizes the standard Log4j Plugins. Some constructs, like property substitution or arbiters are either currently not supported by the schema or can not be reasonably expressed by an XML schema.",
      "score" : 0,
      "owner" : {
        "account_id" : 16269349,
        "reputation" : 16729,
        "user_id" : 11748454,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/qyBNp.jpg?s=256",
        "display_name" : "Piotr P. Karwasz",
        "link" : "https://stackoverflow.com/users/11748454/piotr-p-karwasz"
      },
      "creation_date" : 1753294945,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140612540,
      "post_id" : 79709586,
      "body" : "@WalterButze You can have repeated elements (e.g. <code>Logger</code>), but the <code>Loggers</code> container must be unique. Log4j Core is extensible, but for the standard Log4j Plugins you can see, which elements they accept in the Plugin reference (e.g. the <a href=\"https://logging.apache.org/log4j/2.x/plugin-reference.html#org-apache-logging-log4j_log4j-core_org-apache-logging-log4j-core-config-Configuration\" rel=\"nofollow noreferrer\">reference entry for <code>&lt;Configuration&gt;</code></a>).",
      "score" : 1,
      "owner" : {
        "account_id" : 16269349,
        "reputation" : 16729,
        "user_id" : 11748454,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/qyBNp.jpg?s=256",
        "display_name" : "Piotr P. Karwasz",
        "link" : "https://stackoverflow.com/users/11748454/piotr-p-karwasz"
      },
      "creation_date" : 1753286103,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140609131,
      "post_id" : 79709586,
      "body" : "@WalterButze In other words, is there a Java XML DOM Parser specification that clearly states that a particular element cannot be duplicated?",
      "score" : 0,
      "owner" : {
        "account_id" : 32393154,
        "reputation" : 21,
        "user_id" : 25161686,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/d5c483fc3bd6e06e954f72a5f822d507?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Walter Butze",
        "link" : "https://stackoverflow.com/users/25161686/walter-butze"
      },
      "creation_date" : 1753191668,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140609071,
      "post_id" : 79709586,
      "body" : "Ok, so leaving the composite configuration aside, it is not possible to have two identical tags, specifically &lt;Loggers&gt;, regardless of their location (main file or included), because one will overwrite the other. This means repeated tags will be merged, with the later one taking precedence. But where is this documented? Ideally, I&#39;d like to be able to point to a specific source and be able to say: &quot;See, it&#39;s written down here, it won&#39;t work, if &lt;Loggers&gt; is duplicated&quot;.",
      "score" : 0,
      "owner" : {
        "account_id" : 32393154,
        "reputation" : 21,
        "user_id" : 25161686,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/d5c483fc3bd6e06e954f72a5f822d507?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Walter Butze",
        "link" : "https://stackoverflow.com/users/25161686/walter-butze"
      },
      "creation_date" : 1753190519,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}