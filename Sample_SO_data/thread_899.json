{
  "question" : {
    "question_id" : 79762083,
    "title" : "Spring changed converters order prefering XML",
    "body" : "<p>I'm on:</p>\n<pre><code>&lt;parent&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n    &lt;version&gt;3.5.3&lt;/version&gt;\n    &lt;relativePath/&gt;\n&lt;/parent&gt;\n</code></pre>\n<p>When I check the registered message converters, I see:</p>\n<pre><code>org.springframework.http.converter.ByteArrayHttpMessageConverter\norg.springframework.http.converter.StringHttpMessageConverter\norg.springframework.http.converter.ResourceHttpMessageConverter\norg.springframework.http.converter.support.AllEncompassingFormHttpMessageConverter\norg.springframework.http.converter.xml.MappingJackson2XmlHttpMessageConverter\norg.springframework.http.converter.json.MappingJackson2HttpMessageConverter\n</code></pre>\n<p>Because the XML converter is listed before JSON, the default behavior ends up preferring XML over JSON when the request does not explicitly specify a Content Type header.</p>\n<p>This causes some unexpected behavior, for example:</p>\n<ul>\n<li>Default error pages are returned in XML</li>\n<li>@ControllerAdvice responses are serialized as XML</li>\n<li>RestTemplate post uses XML instead of JSON by default</li>\n</ul>\n<p>(Coming from 3.2.2 without the issue)</p>\n",
    "tags" : [ "java", "spring" ],
    "owner" : {
      "account_id" : 11845933,
      "reputation" : 51,
      "user_id" : 8668467,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/041a22963a94cc64c8db207e3e2cacd4?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Ixiodor",
      "link" : "https://stackoverflow.com/users/8668467/ixiodor"
    },
    "is_answered" : true,
    "view_count" : 179,
    "answer_count" : 2,
    "score" : 3,
    "last_activity_date" : 1758969309,
    "creation_date" : 1757602794,
    "link" : "https://stackoverflow.com/questions/79762083/spring-changed-converters-order-prefering-xml",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79762116,
    "question_id" : 79762083,
    "body" : "<p>I had a look at Spring Framework 6.2 and Spring Boot 3.3, 3.4 and 3.5 release notes and couldn't spot a change that would explain this.</p>\n<p>If your application is not meant to support XML at all, this could be that some updated dependency is bringing <code>&quot;com.fasterxml.jackson.dataformat:jackson-dataformat-xml&quot;</code> on the classpath and you didn't have that in the past. In this case, you should track down this dependency and exclude it.</p>\n<p>On the server side, you can lock down which Content-Type should be used when none has been provided by clients; you can use <code>spring.mvc.contentnegotiation.default-content-types=application/json</code> (see <a href=\"https://docs.spring.io/spring-boot/appendix/application-properties/index.html#application-properties.web.spring.mvc.contentnegotiation.default-content-types\" rel=\"nofollow noreferrer\">this property</a>).</p>\n<p>On the client side, without a <code>Content-Type</code> provided, there isn't much you can do which makes me think that the jackson dependency is probably at fault here. You could configure  a custom <code>ClientHttpRequestInterceptor</code> on the <code>RestTemplate</code> that enforces a default content-type when none was provided. But that requires extra steps which were not needed before.</p>\n<p>If your application is using a <code>RestTemplate</code> created from the <code>RestTemplateBuilder</code> bean auto-configured by Spring Boot, you can also contribute your own <a href=\"https://docs.spring.io/spring-boot/api/java/org/springframework/boot/autoconfigure/http/HttpMessageConverters.html\" rel=\"nofollow noreferrer\"><code>HttpMessageConverters</code></a> bean and there reorder the message converters to put the JSON one ahead of the XML one.</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 11818,
      "reputation" : 59674,
      "user_id" : 22982,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/9d1d5b668ad4b1fccb1a80e6789d11b5?s=256&d=identicon&r=PG",
      "display_name" : "Brian Clozel",
      "link" : "https://stackoverflow.com/users/22982/brian-clozel"
    },
    "creation_date" : 1757604253,
    "last_activity_date" : 1757604253,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79776703,
    "question_id" : 79762083,
    "body" : "<p>If you are using RestClient, the issue occurs from Spring Boot 3.4.4, or more specifically Spring Framework 6.2.4, due to the following fix:</p>\n<p><a href=\"https://github.com/spring-projects/spring-framework/issues/34439\" rel=\"nofollow noreferrer\">https://github.com/spring-projects/spring-framework/issues/34439</a></p>\n<p>MappingJackson2XmlHttpMessageConverter is added, and added before MappingJackson2HttpMessageConverter, so even if jackson-dataformat-xml was already in your dependencies, the default content type changes from json to XML.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 8609684,
      "reputation" : 1246,
      "user_id" : 6448518,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qUcQX.png?s=256",
      "display_name" : "rougou",
      "link" : "https://stackoverflow.com/users/6448518/rougou"
    },
    "creation_date" : 1758969309,
    "last_activity_date" : 1758969309,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79762116" : [ {
      "comment_id" : 140729744,
      "post_id" : 79762116,
      "body" : "Seems you found the issue, we introduced JasperReports, which brought in jackson-dataformat-xml, and Spring started using it.",
      "score" : 1,
      "owner" : {
        "account_id" : 11845933,
        "reputation" : 51,
        "user_id" : 8668467,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/041a22963a94cc64c8db207e3e2cacd4?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Ixiodor",
        "link" : "https://stackoverflow.com/users/8668467/ixiodor"
      },
      "creation_date" : 1757607186,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}