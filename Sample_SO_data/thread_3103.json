{
  "question" : {
    "question_id" : 79571923,
    "title" : "Where is the second Kafka listener coming from?",
    "body" : "<p>I'm trying to setup a project using Spring Boot, Spring Kafka &amp; TestContainers. My TestContainer setup looks like below:</p>\n<pre><code>  private static final Network NETWORK = Network.newNetwork();\n\n  @Bean\n  @ServiceConnection\n  public ConfluentKafkaContainer kafkaContainer() {\n    return new ConfluentKafkaContainer(\n            DockerImageName.parse(&quot;confluentinc/cp-kafka:7.9.0&quot;)\n                .asCompatibleSubstituteFor(&quot;apache/kafka&quot;))\n        .withNetwork(NETWORK)\n        .withNetworkAliases(&quot;kafka&quot;)\n        .withEnv(&quot;KAFKA_KRAFT_MODE&quot;, &quot;true&quot;)\n        .withEnv(&quot;KAFKA_PROCESS_ROLES&quot;, &quot;broker,controller&quot;)\n        .withEnv(&quot;KAFKA_CONTROLLER_QUORUM_VOTERS&quot;, &quot;1@kafka:9093&quot;)\n        .withEnv(&quot;KAFKA_NODE_ID&quot;, &quot;1&quot;)\n        .withEnv(&quot;KAFKA_LISTENERS&quot;, &quot;BROKER://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093&quot;)\n        .withEnv(&quot;KAFKA_ADVERTISED_LISTENERS&quot;, &quot;BROKER://kafka:9092&quot;)\n        .withEnv(&quot;KAFKA_LISTENER_SECURITY_PROTOCOL_MAP&quot;, &quot;BROKER:PLAINTEXT,CONTROLLER&quot;)\n        .withEnv(&quot;KAFKA_INTER_BROKER_LISTENER_NAME&quot;, &quot;BROKER&quot;)\n        .withEnv(&quot;KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR&quot;, &quot;1&quot;)\n        .withEnv(&quot;KAFKA_TRANSACTION_STATE_LOG_MIN_ISR&quot;, &quot;1&quot;)\n        .withEnv(&quot;KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR&quot;, &quot;1&quot;)\n        .withEnv(&quot;KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS&quot;, &quot;0&quot;)\n        .withEnv(&quot;KAFKA_CONTROLLER_LISTENER_NAMES&quot;, &quot;CONTROLLER&quot;)\n        .withEnv(&quot;KAFKA_AUTO_CREATE_TOPICS_ENABLE&quot;, &quot;true&quot;)\n        .withLogConsumer(new Slf4jLogConsumer(LoggerFactory.getLogger(&quot;KafkaContainer&quot;)));\n  }\n</code></pre>\n<p>But when I attempt to run a test, I get the message along the lines of:</p>\n<pre><code>STDOUT: Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Error creating broker listeners from 'PLAINTEXT://localhost:59694,BROKER://c958fa04fe68:9093': No security protocol defined for listener BROKER at kafka.utils.CoreUtils$.listenerListToEndPoints(CoreUtils.scala:216)...\n</code></pre>\n<p>BUt I have no idea where the PLAINTEXT listener is coming from.</p>\n<p>Does anyone know what I'm getting wrong? I can update the description with further details (e.g. dependencies etc.) if I need to. Doing a search in my project for <code>PLAINTEXT</code> and I only get the line above setting the security.</p>\n",
    "tags" : [ "java", "spring-boot", "spring-kafka", "testcontainers" ],
    "owner" : {
      "account_id" : 1425,
      "reputation" : 8627,
      "user_id" : 1900,
      "user_type" : "registered",
      "accept_rate" : 84,
      "profile_image" : "https://i.sstatic.net/VZ4ge.jpg?s=256",
      "display_name" : "Lee Theobald",
      "link" : "https://stackoverflow.com/users/1900/lee-theobald"
    },
    "is_answered" : false,
    "view_count" : 63,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1748313594,
    "creation_date" : 1744570638,
    "link" : "https://stackoverflow.com/questions/79571923/where-is-the-second-kafka-listener-coming-from",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140461347,
    "post_id" : 79571923,
    "body" : "The error message complains about <code>BROKER</code>, not <code>PLAINTEXT</code>: &quot;No security protocol defined for listener BROKER&quot;. Also, you have <code>PLAINTEXT</code> here: <code>withEnv(&quot;KAFKA_LISTENER_SECURITY_PROTOCOL_MAP&quot;, &quot;BROKER:PLAINTEXT,CONTROLLER&quot;)</code>",
    "score" : 0,
    "owner" : {
      "account_id" : 39208,
      "reputation" : 269387,
      "user_id" : 112968,
      "user_type" : "registered",
      "accept_rate" : 68,
      "profile_image" : "https://i.sstatic.net/zHTaT.png?s=256",
      "display_name" : "knittl",
      "link" : "https://stackoverflow.com/users/112968/knittl"
    },
    "creation_date" : 1748325807,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140422480,
    "post_id" : 79571923,
    "body" : "ConfluentKafkaContainer starts in kraft mode without any additional configuration. Can you remove all withEnv?",
    "score" : 0,
    "owner" : {
      "account_id" : 2537085,
      "reputation" : 6619,
      "user_id" : 2203890,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/cf9e8d46103d66657d9c6817a5aa35d3?s=256&d=identicon&r=PG",
      "display_name" : "Edd&#250; Mel&#233;ndez",
      "link" : "https://stackoverflow.com/users/2203890/edd%c3%ba-mel%c3%a9ndez"
    },
    "creation_date" : 1747158586,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}