{
  "question" : {
    "question_id" : 79682630,
    "title" : "Quarkus @QuarkusTest fails when running isolated JAR outside project directory",
    "body" : "<p>I have a Quarkus 3.16.3 + Gradle project that runs Cucumber tests using @QuarkusTest. I've created an isolated test runner JAR to run tests independently, but it only works from within the original project directory.\nWhat Works:\nRunning the JAR from the main project folder works perfectly:</p>\n<pre><code>java -jar build/libs/test-1.0.0-SNAPSHOT-test-runner.jar\n</code></pre>\n<p>This is the log output before to run the tests. Docker is starting, gradleAppModel is working and the tests run perfect.</p>\n<pre><code>Running Cucumber tests with HTTP server disabled...\nUsing profile: stg\nFeatures location: classpath:features\n\uD83D\uDC9A Thanks for using JUnit! Support its development at https://junit.org/sponsoring\n\nJun 27, 2025 7:28:50 PM io.quarkus.bootstrap.utils.BuildToolHelper enableGradleAppModel\nINFO: Loading Quarkus Gradle application model for /MRepos/build-verification-test\n2025-06-27 19:30:26 INFO  [or.te.DockerClientFactory] (build-84) Testcontainers version: 1.20.2\n2025-06-27 19:30:27 INFO  [or.te.do.DockerClientProviderStrategy] (build-84) Loaded org.testcontainers.dockerclient.UnixSocketClientProviderStrategy from ~/.testcontainers.properties, will try it first\n2025-06-27 19:30:28 INFO  [or.te.do.DockerClientProviderStrategy] (build-84) Found Docker environment with local Unix socket (unix:///var/run/docker.sock)\n2025-06-27 19:30:28 INFO  [or.te.DockerClientFactory] (build-84) Docker host IP address is localhost\n2025-06-27 19:30:28 INFO  [or.te.DockerClientFactory] (build-84) Connected to docker: \n  Server Version: 27.5.1\n  API Version: 1.47\n  Operating System: Docker Desktop\n  Total Memory: 7836 MB\n  Labels: \n2025-06-27 19:30:28 INFO  [or.te.im.PullPolicy] (build-84) Image pull policy will be performed by: DefaultPullPolicy()\n2025-06-27 19:30:28 INFO  [or.te.ut.ImageNameSubstitutor] (build-84) Image name substitution will be performed by: DefaultImageNameSubstitutor (composite of 'ConfigurationFileImageNameSubstitutor' and 'PrefixingImageNameSubstitutor')\n2025-06-27 19:30:29 INFO  [tc.lo.7.2] (build-84) LOCALSTACK_HOST environment variable set to localstack-d4udd (to match last network alias on container with non-default network)\n2025-06-27 19:30:29 INFO  [tc.lo.7.2] (build-84) Creating container for image: localstack/localstack:3.7.2\n2025-06-27 19:30:30 INFO  [or.te.ut.RegistryAuthLocator] (build-84) Credential helper/store (docker-credential-desktop) does not have credentials for https://index.docker.io/v1/\n2025-06-27 19:30:30 INFO  [tc.te.9.0] (build-84) Creating container for image: testcontainers/ryuk:0.9.0\nJun 27, 2025 7:30:30 PM io.quarkus.deployment.steps.ClassTransformingBuildStep handleClassTransformation\nWARN: Cannot transform java.lang.String as its containing application archive could not be found.\n2025-06-27 19:30:34 INFO  [tc.te.9.0] (build-84) Container testcontainers/ryuk:0.9.0 is starting: 03aa4b2d2895d81d2966c00de87bbb2bd4cc2045dd2ee74bfb3753d142a7bd3c\n2025-06-27 19:30:35 INFO  [tc.te.9.0] (build-84) Container testcontainers/ryuk:0.9.0 started in PT5.309733S\n2025-06-27 19:30:36 INFO  [tc.lo.7.2] (build-84) Container localstack/localstack:3.7.2 is starting: 29eb386e7b7880028f3412e39c45ebb9388829d7242359248c2f89cba471236e\n2025-06-27 19:30:40 INFO  [tc.lo.7.2] (build-84) Container localstack/localstack:3.7.2 started in PT11.100043S\nJun 27, 2025 7:30:40 PM io.quarkus.amazon.common.deployment.DevServicesLocalStackProcessor lambda$startLocalStack$28\nINFO: Amazon Dev Services for localstack (dynamodb) started. Other Quarkus applications in dev mode will find the LocalStack automatically.\nJun 27, 2025 7:30:41 PM io.quarkus.runtime.configuration.ConfigDiagnostic unknown\nINFO: Profile stg activated. \nJun 27, 2025 7:30:42 PM io.quarkus.bootstrap.runner.Timing printStartupTime\nINFO: Installed features: [amazon-dynamodb, amazon-dynamodb-enhanced, cdi, config-yaml, cucumber, rest, rest-client, rest-client-jackson, smallrye-context-propagation, vertx]\n</code></pre>\n<p>What Fails:\nRunning the same JAR from any other directory fails: For example if I go to the downloads folder or I move my terminal to another folder different than the main root of my project folder and I run exactly the same command I have an error. This is the log errors:</p>\n<pre><code>Running Cucumber tests with HTTP server disabled...\nUsing profile: stg\nFeatures location: classpath:features\nJun 27, 2025 7:32:38 PM org.jboss.logmanager.JBossLoggerFinder getLogger\nERROR: The LogManager accessed before the &quot;java.util.logging.manager&quot; system property was set to &quot;org.jboss.logmanager.LogManager&quot;. Results may be unexpected.\n\n\uD83D\uDC9A Thanks for using JUnit! Support its development at https://junit.org/sponsoring\n\nBasicLoggingEnabler failed to enable basic logging: java.lang.RuntimeException: java.lang.reflect.InvocationTargetException\nJun 27, 2025 7:32:39 PM io.quarkus.bootstrap.utils.BuildToolHelper findBuildTool\nWARN: Unable to find a build tool in /Users/user/Downloads or in any parent.\nJun 27, 2025 7:32:39 PM io.quarkus.bootstrap.BootstrapAppModelFactory resolveAppModel\nWARN: Unable to locate the maven project on the filesystem\n╷\n└─ JUnit Jupiter ✔\n   └─ Test ✔\n      └─ getTests() ✘ java.lang.RuntimeException: java.lang.reflect.InvocationTargetException\n\nFailures (1):\n  JUnit Jupiter:Test:getTests()\n    MethodSource [className = 'com.Test', methodName = 'getTests', methodParameterTypes = '']\n    =&gt; java.lang.RuntimeException: java.lang.RuntimeException: java.lang.reflect.InvocationTargetException\n     Caused by: java.lang.RuntimeException: java.lang.reflect.InvocationTargetException\n       io.quarkus.test.junit.IntegrationTestUtil.activateLogging(IntegrationTestUtil.java:347)\n     Caused by: java.lang.reflect.InvocationTargetException\n       java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:118)\n     Caused by: java.lang.RuntimeException: java.lang.RuntimeException: java.lang.IllegalArgumentException: SRCFG00013: No Converter registered for class java.nio.charset.Charset\n       io.quarkus.runtime.configuration.ConfigInstantiator.handleObject(ConfigInstantiator.java:57)\n     Caused by: java.lang.RuntimeException: java.lang.IllegalArgumentException: SRCFG00013: No Converter registered for class java.nio.charset.Charset\n       io.quarkus.runtime.configuration.ConfigInstantiator.handleObject(ConfigInstantiator.java:139)\n     Caused by: java.lang.IllegalArgumentException: SRCFG00013: No Converter registered for class java.nio.charset.Charset\n       io.smallrye.config.SmallRyeConfig.requireConverter(SmallRyeConfig.java:717)\n       io.quarkus.runtime.configuration.ConfigInstantiator.getConverterFor(ConfigInstantiator.java:203)\n       io.quarkus.runtime.configuration.ConfigInstantiator.handleObject(ConfigInstantiator.java:124)\n</code></pre>\n<p>This is how my classes looks:\n<strong>class</strong> to create the isolated Jar and run my tests without start the quarkus server:</p>\n<pre><code>public class CucumberTestRunner {\n    \n    public static void main(String[] args) {\n        // Set system properties to disable HTTP server\n        System.setProperty(&quot;quarkus.http.port&quot;, &quot;-1&quot;);\n        System.setProperty(&quot;quarkus.http.ssl-port&quot;, &quot;-1&quot;);\n        System.setProperty(&quot;quarkus.http.test-port&quot;, &quot;-1&quot;);\n        System.setProperty(&quot;quarkus.http.host&quot;, &quot;localhost&quot;);\n        \n        // Set the profile to staging\n        System.setProperty(&quot;quarkus.profile&quot;, &quot;stg&quot;);\n        \n        // Set the correct features location for JAR execution\n        System.setProperty(&quot;cucumber.features&quot;, &quot;classpath:features&quot;);\n                \n        // Run the existing Test main method which already has all the right setup\n        Test.main(args);\n    }\n}\n</code></pre>\n<p><strong>build.gradle file:</strong></p>\n<pre><code>task testShadowJar(type: com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar) {\n    duplicatesStrategy = DuplicatesStrategy.EXCLUDE\n    archiveClassifier = 'test-runner'\n    \n    from sourceSets.main.output\n    from sourceSets.main.resources\n    \n    // Include all runtime dependencies\n    configurations = [project.configurations.runtimeClasspath]\n\n    manifest {\n        attributes 'Main-Class': 'com.CucumberTestRunner'\n    }\n}\n</code></pre>\n<p><strong>Main class:</strong></p>\n<pre><code>package com.test;\n\nimport com.profile.CustomTestProfile;\nimport io.quarkiverse.cucumber.CucumberQuarkusTest;\nimport io.quarkus.test.junit.QuarkusTest;\nimport io.quarkus.test.junit.TestProfile;\n\n@QuarkusTest\n@TestProfile(CustomTestProfile.class)\npublic class MainTest extends CucumberQuarkusTest {\n    public static void main(String[] args) {\n        String featuresLocation = System.getProperty(&quot;cucumber.features&quot;, &quot;features&quot;);\n        System.setProperty(&quot;cucumber.features&quot;, featuresLocation);\n        System.setProperty(&quot;cucumber.glue&quot;, &quot;com.test&quot;);\n        runMain(MainTest.class, args);\n    }\n}\n</code></pre>\n<p>What I've Tried:</p>\n<ul>\n<li>Various system properties to disable project discovery</li>\n<li>Creating minimal project structure in container</li>\n<li>Different Quarkus application modes (@QuarkusMain, production mode)</li>\n<li>Containerization with Docker (same issue persists)</li>\n</ul>\n<p>How can I make a Quarkus test JAR with @QuarkusTest work independently of the original project directory? Is there a way to package all necessary project metadata into the JAR, or should I use a different approach for portable test execution?</p>\n",
    "tags" : [ "java", "docker", "gradle", "cucumber", "quarkus" ],
    "owner" : {
      "account_id" : 4784964,
      "reputation" : 545,
      "user_id" : 3865734,
      "user_type" : "registered",
      "accept_rate" : 20,
      "profile_image" : "https://www.gravatar.com/avatar/2f0d879e8e637eb9de599871aebedad5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Allanh",
      "link" : "https://stackoverflow.com/users/3865734/allanh"
    },
    "is_answered" : true,
    "view_count" : 82,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1751100745,
    "creation_date" : 1751071792,
    "link" : "https://stackoverflow.com/questions/79682630/quarkus-quarkustest-fails-when-running-isolated-jar-outside-project-directory",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79682859,
    "question_id" : 79682630,
    "body" : "<p>If your goal is to run Quarkus-based tests (e.g., Cucumber, REST, etc.) independently of the original project directory, you can decouple test execution from Quarkus' build tool discovery by switching to <strong><code>fast-jar</code></strong> packaging format and treating your tests as external consumers of a running application.</p>\n<p><a href=\"https://developers.redhat.com/blog/2021/04/08/build-even-faster-quarkus-applications-with-fast-jar\" rel=\"nofollow noreferrer\">https://developers.redhat.com/blog/2021/04/08/build-even-faster-quarkus-applications-with-fast-jar</a></p>\n<ul>\n<li>Package the application in <code>fast-jar</code> format:</li>\n</ul>\n<pre><code>./gradlew build -Dquarkus.package.type=fast-jar \n</code></pre>\n<ul>\n<li>Run the application independently from any directory:</li>\n</ul>\n<pre><code>java -jar build/quarkus-app/quarkus-run.jar\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 2465829,
      "reputation" : 13577,
      "user_id" : 2148953,
      "user_type" : "registered",
      "accept_rate" : 96,
      "profile_image" : "https://i.sstatic.net/DVHoP84E.jpg?s=256",
      "display_name" : "aran",
      "link" : "https://stackoverflow.com/users/2148953/aran"
    },
    "creation_date" : 1751100745,
    "last_activity_date" : 1751100745,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}