{
  "question" : {
    "question_id" : 79617806,
    "title" : "RestTemplate.postForEntity() is throwing Exception while sending request having a Mutlipart file and a Json both",
    "body" : "<p>I am trying to execute a <code>RestTemplate.postForEntity()</code> which is having a <code>Mutlipart</code> file and a JSON object/string. But always getting <code>Exception/RestClientException</code> that</p>\n<blockquote>\n<p>&quot;no suitable <code>HttpMessageConverter</code> found&quot;.</p>\n</blockquote>\n<p>The code I am using :</p>\n<pre class=\"lang-java prettyprint-override\"><code>try {\n  // Setting headers for the file part\n  HttpHeaders fileHeaders = new HttpHeaders();\n  fileHeaders.setContentType(MediaType.MULTIPART_FORM_DATA);\n  fileHeaders.setBearerAuth(&quot;auth_token&quot;);\n  MultiValueMap&lt;String, Object&gt; map = new LinkedMultiValueMap&lt;&gt;();\n  map.add(&quot;file&quot;, new File(path));\n  HttpEntity&lt;MultiValueMap&lt;String, Object&gt;&gt; fileEntity = new HttpEntity&lt;&gt;(map, fileHeaders);\n\n  // Setting headers for the JSON part\n  HttpHeaders jsonHeaders = new HttpHeaders();\n  jsonHeaders.setContentType(MediaType.APPLICATION_JSON);\n  jsonHeaders.setBearerAuth(&quot;auth_token&quot;);\n  String jsonString = new ObjectMapper().writeValueAsString(jsonObject);\n  HttpEntity&lt;String&gt; jsonEntity = new HttpEntity&lt;&gt;(jsonString, jsonHeaders);\n\n  // Creating the multipart request\n  MultiValueMap&lt;String, Object&gt; requestBody = new LinkedMultiValueMap&lt;&gt;();\n  requestBody.add(&quot;file&quot;, fileEntity);\n  requestBody.add(&quot;metadatak&quot;, jsonEntity);\n  HttpHeaders headers = new HttpHeaders();\n  headers.setContentType(MediaType.MULTIPART_FORM_DATA);\n  headers.setBearerAuth(&quot;auth_token&quot;);\n  HttpEntity&lt;MultiValueMap&lt;String, Object&gt;&gt; requestEntity = new HttpEntity&lt;&gt;(requestBody, headers);\n\n  ResponseEntity&lt;String&gt; responseResult = template.postForEntity(url, requestEntity, String.class);\n  return ResponseEntity.ok(responseResult);\n\n} catch (RestClientException rex) {\n    logger.error(&quot;RestClientException occurred: {}&quot;, rex.getMessage());\n    rex.printStackTrace();\n    return ResponseEntity.badRequest().build();\n} catch (Exception ex) {\n    logger.error(&quot;Exception occured : &quot; + ex);\n    ex.printStackTrace();\n    return ResponseEntity.status(400).build();\n}\n</code></pre>\n<p>But every time I'm getting <code>Exception</code> like this :</p>\n<blockquote>\n<p>org.springframework.http.converter.HttpMessageNotWritableException:\nCould not write request: no suitable HttpMessageConverter found for\nrequest type [org.springframework.util.LinkedMultiValueMap]</p>\n</blockquote>\n<p>I am not able to go forward, as this error is really obstructing me to obtain the 200 (OK) response. Can anyone please suggest, where I am wrong to fetch a 200 (OK) response back from the <code>PostMapping</code>? Or, is there any other approach to achieve the scenario above?</p>\n<p><strong>Note</strong>: When I hit the same <code>POST</code>-request directly using the Postman, mentioning the above JSON <code>Bearer</code> authentication token, then it is working absolutely fine and returning the 200 (OK) response correctly.</p>\n<p>You can see the screenshot of the postman below :</p>\n<p><a href=\"https://i.sstatic.net/YjkCce7x.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/YjkCce7x.png\" alt=\"enter image description here\" /></a></p>\n",
    "tags" : [ "java", "spring-boot", "rest" ],
    "owner" : {
      "account_id" : 15682947,
      "reputation" : 385,
      "user_id" : 11316422,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/1d73e9a80933179e8f00db24c473bd69?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jerry",
      "link" : "https://stackoverflow.com/users/11316422/jerry"
    },
    "is_answered" : true,
    "view_count" : 88,
    "answer_count" : 1,
    "score" : 2,
    "last_activity_date" : 1747103089,
    "creation_date" : 1747051657,
    "link" : "https://stackoverflow.com/questions/79617806/resttemplate-postforentity-is-throwing-exception-while-sending-request-having",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79617840,
    "question_id" : 79617806,
    "body" : "<p>You are making things overly complex, you should use 1 <code>LinkedMultiValueMap</code> as the body not multiple. You should also create the <code>RestTemplate</code> only once in your constructor or config, same for the <code>ObjectMapper</code>.</p>\n<pre><code>try {\n  var body = new LinkedMultiValueMap&lt;String, Object&gt;();\n\n  // Setting headers for the file part\n  var fileHeaders = new HttpHeaders();\n  fileHeaders.setContentType(MediaType.MULTIPART_FORM_DATA);\n  fileHeaders.setBearerAuth(&quot;auth_token&quot;);\n  body.add(&quot;file&quot;, new HttpEntity(new FileSystemResource(path), fileHeaders);\n\n  // Setting headers for the JSON part\n  var jsonHeaders = new HttpHeaders();\n  jsonHeaders.setContentType(MediaType.APPLICATION_JSON);\n  jsonHeaders.setBearerAuth(&quot;auth_token&quot;);\n  var jsonString = new ObjectMapper().writeValueAsString(jsonObject);\n  body.add(&quot;metadata&quot;, new HttpEntity&lt;&gt;(jsonString, jsonHeaders)); \n\n  // Creating the multipart request\n  var headers = new HttpHeaders();\n  headers.setContentType(MediaType.MULTIPART_FORM_DATA);\n  headers.setBearerAuth(&quot;auth_token&quot;);\n  var requestEntity = new HttpEntity&lt;MultiValueMap&lt;String, Object&gt;&gt;(body, headers);\n\n  var responseResult = template.postForEntity(url, requestEntity, String.class);\n  return ResponseEntity.ok(responseResult);\n\n} catch (RestClientException rex) {\n    logger.error(&quot;RestClientException occurred: {}&quot;, rex.getMessage(), rex);\n    return ResponseEntity.badRequest().build();\n} catch (Exception ex) {\n    logger.error(&quot;Exception occured : {}&quot;, ex.getMessage(), ex);\n    return ResponseEntity.status(400).build();\n}\n</code></pre>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126800,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1747052976,
    "last_activity_date" : 1747058673,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140417885,
    "post_id" : 79617806,
    "body" : "I tried once with a single object of  <code>LinkedMultiValueMap</code> and setting up the &quot;file&quot; and the &quot;Json&quot; both in that. But I got error like :  <code>HttpClientErrorException$UnsupportedMediaType: 415  on POST request</code>",
    "score" : 0,
    "owner" : {
      "account_id" : 15682947,
      "reputation" : 385,
      "user_id" : 11316422,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/1d73e9a80933179e8f00db24c473bd69?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jerry",
      "link" : "https://stackoverflow.com/users/11316422/jerry"
    },
    "creation_date" : 1747053227,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140417847,
    "post_id" : 79617806,
    "body" : "Can you please provide the code snippet please ?? so that I can get a clear picture of it.",
    "score" : 0,
    "owner" : {
      "account_id" : 15682947,
      "reputation" : 385,
      "user_id" : 11316422,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/1d73e9a80933179e8f00db24c473bd69?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jerry",
      "link" : "https://stackoverflow.com/users/11316422/jerry"
    },
    "creation_date" : 1747052616,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140417842,
    "post_id" : 79617806,
    "body" : "You are making things overly complex. What is up with all the <code>LinkedMultiValueMap</code> instances, you should use one. Also don&#39;t create a <code>RestTemplate</code> because you need it, use the <code>RestTemplateBuilder</code> from Spring Boot to construct one either as config and inject it or in your constructor. Same for the <code>ObjectMapper</code>.",
    "score" : 1,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126800,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1747052494,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79617840" : [ {
      "comment_id" : 140417998,
      "post_id" : 79617840,
      "body" : "Finally it is resolved, instead of <code>new File(path)</code> i used <code>new FileSystemResource(path)</code> and it your worked just fine!! I got <b>200(OK)</b> response back now. Thank you so much for your help.",
      "score" : 0,
      "owner" : {
        "account_id" : 15682947,
        "reputation" : 385,
        "user_id" : 11316422,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/1d73e9a80933179e8f00db24c473bd69?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Jerry",
        "link" : "https://stackoverflow.com/users/11316422/jerry"
      },
      "creation_date" : 1747055535,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140417941,
      "post_id" : 79617840,
      "body" : "Okay i resolved the errors mentioned above, and ran it,, but after that i got the exception in the console like :   <code>org.springframework.http.converter.HttpMessageNotWritableExc&zwnj;&#8203;eption: Could not write request: no suitable HttpMessageConverter found for request type [java.io.File]</code>",
      "score" : 0,
      "owner" : {
        "account_id" : 15682947,
        "reputation" : 385,
        "user_id" : 11316422,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/1d73e9a80933179e8f00db24c473bd69?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Jerry",
        "link" : "https://stackoverflow.com/users/11316422/jerry"
      },
      "creation_date" : 1747054401,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140417925,
      "post_id" : 79617840,
      "body" : "I didn&#39;t compile the code (I don&#39;t have all the code you have) just typed it from the top of my head. <code>put</code> should be <code>add</code> and I re-used part of your code so <code>requestBody</code> should be <code>body</code>.",
      "score" : 0,
      "owner" : {
        "account_id" : 3192259,
        "reputation" : 126800,
        "user_id" : 2696260,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
        "display_name" : "M. Deinum",
        "link" : "https://stackoverflow.com/users/2696260/m-deinum"
      },
      "creation_date" : 1747054071,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140417917,
      "post_id" : 79617840,
      "body" : "I just used your code snippet, but getting one compilation error at <code>body.put()</code> like : <code>The method put(String, List&lt;Object&gt;) in the type MultiValueMapAdapter&lt;String,Object&gt; is not applicable for the arguments (String, HttpEntity)</code> Also where did you set the variable <code>body</code> after putting the values ?",
      "score" : 0,
      "owner" : {
        "account_id" : 15682947,
        "reputation" : 385,
        "user_id" : 11316422,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/1d73e9a80933179e8f00db24c473bd69?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Jerry",
        "link" : "https://stackoverflow.com/users/11316422/jerry"
      },
      "creation_date" : 1747053897,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}