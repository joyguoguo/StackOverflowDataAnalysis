{
  "question" : {
    "question_id" : 79774822,
    "title" : "Android software module checksum for integrity validation",
    "body" : "<p>We need to separate the legally relevant and non-relevant software features in our Android-based application. The legally relevant software is encapsulated in an Android Archive (AAR) and called based on a defined interface from the rest of the system. This would enable us to update the rest of the system and only trigger an audit of the legally relevant software when there is a change to this one module (AAR).</p>\n<p>We now have to validate the integrity of the software module at runtime (not only at build time), for example using a checksum. In Java, I have access to the JAR file and the bytecode, which I can use to calculate a checksum on the Java bytecode. However, Android compiles the AAR with the DEX compiler, so the classic Java bytecode is no longer available.</p>\n<p>Calculating a checksum for the entire APK would not meet our requirements because we would then have to audit the entire system rather than just one module.</p>\n<p>Is there a way to access the bytecode of the module (aar) or all classes of the module at runtime to generate a checksum, or is there any other way to fulfil this requirement?</p>\n",
    "tags" : [ "java", "android" ],
    "owner" : {
      "account_id" : 1460485,
      "reputation" : 465,
      "user_id" : 1374945,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://i.sstatic.net/BdRX6.jpg?s=256",
      "display_name" : "Richard Liebmann",
      "link" : "https://stackoverflow.com/users/1374945/richard-liebmann"
    },
    "is_answered" : false,
    "view_count" : 50,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1758803709,
    "creation_date" : 1758803709,
    "link" : "https://stackoverflow.com/questions/79774822/android-software-module-checksum-for-integrity-validation",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140763686,
    "post_id" : 79774822,
    "body" : "The dynamic loading of the library is not required. It would be possible to load it statically in the code but I require to validate, that is was not changed. The usage of native code (C/C++) would be a greate method, I would consider. Currently I have a jar dependency witch I hat to check with the vendor if it would be possible to call it from C/C++ or convert it to native code. Thanky a lot for your help!",
    "score" : 0,
    "owner" : {
      "account_id" : 1460485,
      "reputation" : 465,
      "user_id" : 1374945,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://i.sstatic.net/BdRX6.jpg?s=256",
      "display_name" : "Richard Liebmann",
      "link" : "https://stackoverflow.com/users/1374945/richard-liebmann"
    },
    "creation_date" : 1758983044,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140763205,
    "post_id" : 79774822,
    "body" : "Unless this isn&#39;t a Play Store app.  In that case, you could download the dex files at runtime, checksum them, then load them dynamically.  But as I said, against the play store tos",
    "score" : 0,
    "owner" : {
      "account_id" : 1790714,
      "reputation" : 94810,
      "user_id" : 1631193,
      "user_type" : "registered",
      "accept_rate" : 71,
      "profile_image" : "https://www.gravatar.com/avatar/ac9dfee58394495fa69f12f58a928be3?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Gabe Sechan",
      "link" : "https://stackoverflow.com/users/1631193/gabe-sechan"
    },
    "creation_date" : 1758955631,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140763204,
    "post_id" : 79774822,
    "body" : "Why do this on the client instead of in your build system?  If the requirement is that you need to use a particular version of a library, make it an aar and have your build system check the checksum of the aar before using it, or fail the build.  Therefore you know released versions of the code must have the right version.  Doing it on the client only makes sense if you&#39;re afraid of clients altering it (which this would not really protect against anyone sophisticated enough to do this without a lot of other work), or if you were downloading it dynamically (which is against google play TOS).",
    "score" : 0,
    "owner" : {
      "account_id" : 1790714,
      "reputation" : 94810,
      "user_id" : 1631193,
      "user_type" : "registered",
      "accept_rate" : 71,
      "profile_image" : "https://www.gravatar.com/avatar/ac9dfee58394495fa69f12f58a928be3?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Gabe Sechan",
      "link" : "https://stackoverflow.com/users/1631193/gabe-sechan"
    },
    "creation_date" : 1758955570,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140759922,
    "post_id" : 79774822,
    "body" : "Other than a cloud API that Robert mentioned, would self hosting a maven repo containing the legally relevant AAR adequately cover the requirement (if trust chain), OR moving such code into C/C++ binary per ABI which would survive device deployment and thus be runtime checkable.",
    "score" : 0,
    "owner" : {
      "account_id" : 111736,
      "reputation" : 12346,
      "user_id" : 295004,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/a29d6038e4dcb7fac98ef41c002975e1?s=256&d=identicon&r=PG",
      "display_name" : "Morrison Chang",
      "link" : "https://stackoverflow.com/users/295004/morrison-chang"
    },
    "creation_date" : 1758814127,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140759862,
    "post_id" : 79774822,
    "body" : "In recent versions of Android dynamically loading JAR or DEX files (code objects you could verify) at run-time are no longer possible so what you want to do is no longer possible. You may reconsider the overall system design of your app. May be place the legally relevant parts on a central server and expose the functionality to the app in an API? Or alternatively don&#39;t use Java but native code and build an .so library from it. The .so files you upload to Google should not be changed, just the .so file with matching ABI will be placed in the final APK. The .so file you can verify at run-time.",
    "score" : 0,
    "owner" : {
      "account_id" : 50585,
      "reputation" : 43459,
      "user_id" : 150978,
      "user_type" : "registered",
      "accept_rate" : 78,
      "profile_image" : "https://www.gravatar.com/avatar/feadc214792e2581c3c750140e3eb2c7?s=256&d=identicon&r=PG",
      "display_name" : "Robert",
      "link" : "https://stackoverflow.com/users/150978/robert"
    },
    "creation_date" : 1758813070,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140759861,
    "post_id" : 79774822,
    "body" : "Repacking the code, especially the dex compiler, is one of the problems. A simple solution that works with desktop Java will not work here. The AAR is extracted in the AAB build process and will not exist.  The thread model is not the key issue, but the legal requirement is. We are allowed to change the main application without a reaudit, but if we change the AAR, which is legally relevant, we have to undergo a costly and time-intensive audit process. Therefore, we try to keep these two components separate to prevent the development process from becoming too bureaucratic.",
    "score" : 0,
    "owner" : {
      "account_id" : 1460485,
      "reputation" : 465,
      "user_id" : 1374945,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://i.sstatic.net/BdRX6.jpg?s=256",
      "display_name" : "Richard Liebmann",
      "link" : "https://stackoverflow.com/users/1374945/richard-liebmann"
    },
    "creation_date" : 1758813057,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140759603,
    "post_id" : 79774822,
    "body" : "Unclear if you understand how &#39;blended&#39; code and resources from various libraries are in an APK. Google Play now requires AAB files and what is delivered to the device may be repacked (remove unneeded per device resources), the diagram in <a href=\"https://developer.android.com/guide/app-bundle/app-bundle-format\" rel=\"nofollow noreferrer\">developer.android.com/guide/app-bundle/app-bundle-format</a> gives a sense of what is inside. You may wish to elaborate on the threat model that such a requirement is trying to cover.",
    "score" : 1,
    "owner" : {
      "account_id" : 111736,
      "reputation" : 12346,
      "user_id" : 295004,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/a29d6038e4dcb7fac98ef41c002975e1?s=256&d=identicon&r=PG",
      "display_name" : "Morrison Chang",
      "link" : "https://stackoverflow.com/users/295004/morrison-chang"
    },
    "creation_date" : 1758807846,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}