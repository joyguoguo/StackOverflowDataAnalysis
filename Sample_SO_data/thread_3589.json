{
  "question" : {
    "question_id" : 79538423,
    "title" : "Successfully deleted a record but the response triggers an NgRx Action Failure",
    "body" : "<p>I'm working on an Angular application using NgRx to manage state. I have an action that deletes a record through an API call. The deletion is successful (the record is removed), but the NgRx effect triggers the failure action instead of the success action because of the response it gets:</p>\n<pre><code>can't parse JSON. Raw result: cancellazione avvenuta correttamente\n</code></pre>\n<p>(translation: &quot;delete process successful&quot;)</p>\n<p>I've tried it on Swagger as well, and I get the very same response, here's the code related to the whole process:</p>\n<p>Actions:</p>\n<pre class=\"lang-typescript prettyprint-override\"><code>export const removeResourceAttachment = createAction(\n  '[Resource] Remove Resource Attachment',\n  props&lt;{ attachmentDto: AttachmentDto }&gt;(),\n);\nexport const removeResourceAttachmentSuccess = createAction(\n  '[Resource] Remove Resource Attachment Success',\n);\nexport const removeResourceAttachmentFailure = createAction(\n  '[Resource] Remove Resource Failure',\n  props&lt;{ error: any }&gt;(),\n);\n</code></pre>\n<p>Effects:</p>\n<pre class=\"lang-typescript prettyprint-override\"><code>  removeResourceAttachmentSuccess$ = createEffect(() =&gt;\n    this.actions$.pipe(\n      ofType(ResourceActions.removeResourceAttachmentSuccess),\n      concatLatestFrom(() =&gt; this.store.select(ResourceSelectors.selectIdResourceToEdit)),\n      mergeMap(([action, id]) =&gt;\n        of(ResourceActions.loadResourceAttachmentsById({ resourceId: id!.toString() })),\n      ),\n    ),\n  );\n\n  removeResourceAttachment = createEffect(() =&gt;\n    this.actions$.pipe(\n      ofType(ResourceActions.removeResourceAttachment),\n      mergeMap((action) =&gt;\n        this.resourceService\n          .deleteResourceAttachmentByAttachmentId(action.attachmentDto.idAttached!)\n          .pipe(\n            map((response) =&gt; ResourceActions.removeResourceAttachmentSuccess()),\n            catchError((error) =&gt; of(ResourceActions.removeResourceAttachmentFailure({ error }))),\n          ),\n      ),\n    ),\n  );\n</code></pre>\n<p>Front-end service:</p>\n<pre class=\"lang-typescript prettyprint-override\"><code>  deleteResourceAttachmentByAttachmentId(attachmentId: number): Observable&lt;any&gt; {\n    return this.http.delete&lt;any&gt;(`${this.attachmentApi}/delete/${attachmentId}`);\n  }\n\n</code></pre>\n<p>Back-end controller:</p>\n<pre class=\"lang-java prettyprint-override\"><code>  //Scarica il file desiderato tramite ID\n    @DeleteMapping(&quot;delete/{id_attached}&quot;)\n    @PreAuthorize(&quot;hasAnyAuthority('ROLE_ADMIN','ROLE_USER')&quot;)\n    @Operation(summary = &quot;Delete an attached file&quot;,\n            description = &quot;Delete an attached file&quot;,\n            operationId = &quot;DELETE_ATTACHED&quot;,\n            responses = {\n                    @ApiResponse(responseCode = &quot;201&quot;, description = &quot;Successfully deleted&quot;),\n                    @ApiResponse(responseCode = &quot;400&quot;, description = &quot;Invalid input provided&quot;),\n                    @ApiResponse(responseCode = &quot;500&quot;, description = &quot;Error deleting the attached file&quot;)\n            })\n    public ResponseEntity&lt;String&gt; deleteAttachedFile(@PathVariable(name = &quot;id_attached&quot;) Integer idAttached) {\n        attachedService.deleteFile(idAttached);\n        return ResponseEntity.ok().body(&quot;cancellazione avvenuta correttamente&quot;);\n    }\n\n</code></pre>\n<p>Back-end service:</p>\n<pre class=\"lang-java prettyprint-override\"><code>   @Override\n    public void deleteFile(Integer idAttached) {\n        AttachmentEntity allegato = attachedRepo.findById(idAttached).orElseThrow(()-&gt;new EntityNotFoundException(&quot; impossibile trovare l'allegato con id:  &quot; + idAttached));\n        attachedRepo.delete(allegato);\n        Path filePath = Path.of(allegato.getPath());\n        try {\n            Files.delete(filePath);\n            log.info(&quot;File cancellato in: {}&quot;, filePath);\n        } catch (IOException e) {\n            log.error(&quot;Errore durante la cancellazione del file: {}&quot;, filePath);\n            throw new RuntimeException(&quot;Errore durante la cancellazione del file: &quot;+ filePath);\n        }\n    }\n</code></pre>\n",
    "tags" : [ "java", "angular", "spring-boot", "ngrx" ],
    "owner" : {
      "account_id" : 32575762,
      "reputation" : 21,
      "user_id" : 25312538,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/3K0NpQCl.jpg?s=256",
      "display_name" : "Giaggipc",
      "link" : "https://stackoverflow.com/users/25312538/giaggipc"
    },
    "is_answered" : true,
    "view_count" : 52,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1743074031,
    "creation_date" : 1743068167,
    "link" : "https://stackoverflow.com/questions/79538423/successfully-deleted-a-record-but-the-response-triggers-an-ngrx-action-failure",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79538449,
    "question_id" : 79538423,
    "body" : "<p>You have two ways to fix this, I prefer the JAVA fix:</p>\n<h3>JAVA:</h3>\n<p>Return a json instead of plain text. Angular unless specified explicitly that the response is of type <code>text</code> does not handle text response properly.</p>\n<pre><code>  //Scarica il file desiderato tramite ID\n    @DeleteMapping(&quot;delete/{id_attached}&quot;)\n    @PreAuthorize(&quot;hasAnyAuthority('ROLE_ADMIN','ROLE_USER')&quot;)\n    @Operation(summary = &quot;Delete an attached file&quot;,\n            description = &quot;Delete an attached file&quot;,\n            operationId = &quot;DELETE_ATTACHED&quot;,\n            responses = {\n                    @ApiResponse(responseCode = &quot;201&quot;, description = &quot;Successfully deleted&quot;),\n                    @ApiResponse(responseCode = &quot;400&quot;, description = &quot;Invalid input provided&quot;),\n                    @ApiResponse(responseCode = &quot;500&quot;, description = &quot;Error deleting the attached file&quot;)\n            })\n    public ResponseEntity&lt;String&gt; deleteAttachedFile(@PathVariable(name = &quot;id_attached&quot;) Integer idAttached) {\n        attachedService.deleteFile(idAttached);\n        Map&lt;String, String&gt; response = new HashMap&lt;&gt;();\n        response.put(&quot;message&quot;, &quot;cancellazione avvenuta correttamente&quot;);\n        return ResponseEntity.ok().body(response);\n    }\n</code></pre>\n<h3>Angular:</h3>\n<p>Just set the response type in the http <code>delete</code> method second argument object.</p>\n<pre><code>deleteResourceAttachmentByAttachmentId(attachmentId: number): Observable&lt;any&gt; {\n  return this.http.delete&lt;any&gt;(`${this.attachmentApi}/delete/${attachmentId}`, { \n    responseType: 'text' \n  });\n}\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 7836845,
      "reputation" : 66226,
      "user_id" : 5924562,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/ea9d589e5f03856ee87f615ab80dda72?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Naren Murali",
      "link" : "https://stackoverflow.com/users/5924562/naren-murali"
    },
    "creation_date" : 1743068720,
    "last_activity_date" : 1743068720,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}