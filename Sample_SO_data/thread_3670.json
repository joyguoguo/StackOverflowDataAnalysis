{
  "question" : {
    "question_id" : 79532748,
    "title" : "Mockito not able to catch the exception thrown",
    "body" : "<p>I'm trying to write a test for failure scenario where I'm trying to catch an exception but all I'm receiving is AssertionError</p>\n<p>This is the exception I received.I've tried catching JsonProcessingException.</p>\n<p>If you have any suggestion to have better debug this I'm all ears?</p>\n<pre><code> exception: com.orgfoo.BarService.order.service.exception.ErrorJsonProcessingException\njava.lang.AssertionError: Expected exception: com.orgfoo.BarService.order.service.exception.ErrorJsonProcessingException\n</code></pre>\n<p>Test class is as follows:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Test(expected = ErrorJsonProcessingException.class)\npublic void testEmailOnBar_JsonProcessingException() throws Exception {\n        // Given\n  EmailOnBarRequest request = new EmailOnBarRequest();\n  HttpHeaders httpHeaders = getHttpHeaders();\n       when(BarServiceServiceConfig.getEmailOnBarUrl()).thenReturn(&quot;orgbar/rp-webapp-9-common/ecommerce/wireless/order/emailOnBar?lo=%s&amp;sc=%s&quot;);\n\n  BarResponse BarResponse = new BarResponse();\n  BarResponse.setMessage(&quot;testValue&quot;);\n\n  when(orgbarServiceConnector.getBiporgbarResponse(anyString(), any(HttpEntity.class), any(HttpHeaders.class), any(HttpMethod.class))).thenReturn(BarResponse);\n  when(mapper.readValue(anyString(), eq(ImplEmailOnBarOutput.class))).thenThrow(new JsonProcessingException(&quot;test&quot;) {});\n\n  // When\n  orderProcessor.emailOnBar(request, httpHeaders, &quot;salesChannel&quot;, &quot;lo&quot;);\n\n    }\n</code></pre>\n<p><em>SUT</em></p>\n<pre class=\"lang-java prettyprint-override\"><code>\n@InjectMocks\nprivate OrderProcessor orderProcessor;\n\n@Mock\nprivate orgbarServiceConnector orgbarServiceConnector;\n\n@Mock\nprivate BarServiceServiceConfig BarServiceServiceConfig;\n\n@Mock\nprivate ObjectMapper mapper;\n\n@Mock\nprivate ObjectWriter objectWriter;\n\n@Autowired\nprivate orgbarServiceConnector orgbarServiceConnector;\n\n@Autowired\nprivate BarServiceServiceConfig BarServiceServiceConfig;\n\n@Autowired\nprivate static ObjectMapper mapper;\n\n@Autowired\nprivate static ObjectWriter objectWriter;\n\nstatic {\n    if (mapper == null)\n        mapper = new ObjectMapper();\n    if (objectWriter == null)\n        objectWriter = mapper.writer().withDefaultPrettyPrinter();\n}\n\npublic ImplEmailOnBarOutput emailOnBar(EmailOnBarRequest input, HttpHeaders httpHeaders, String sc, String lo) {\n    try {\n        LOGGER.debug(&quot;Entering emailOnBar method with input: {}, lo: {}, salesChannel: {}&quot;, objectWriter.writeValueAsString(input), lo, sc);\n\n        String url = String.format(BarServiceServiceConfig.getEmailOnBarUrl(), lo, sc);\n        LOGGER.debug(&quot;Calling orgbar API with URI: {}&quot;, url);\n\n        BarResponse BarResponse = orgbarServiceConnector.getOrgbarResponse(url, new HttpEntity&lt;&gt;(input), httpHeaders, HttpMethod.POST);     mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);\n        return mapper.readValue(objectWriter.writeValueAsString(BarResponse), ImplEmailOnBarOutput.class);\n    } catch (JsonProcessingException e) {\n        LOGGER.error(&quot;Exception while calling orgbar-emailOnBar api exception={}&quot;, e);\n        throw new ErrorJsonProcessingException(e, JSON_PROCESSEING_ERROR_MSG, orgbar_SERVICE);\n    }\n}\n</code></pre>\n<p><strong>POJO</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>@NoArgsConstructor\n@AllArgsConstructor\n@JsonInclude(JsonInclude.Include.NON_NULL)\npublic class ImplEmailOnBarOutput {\n    @JsonProperty(&quot;__EmptyObject__&quot;)\n    private EmptyObject emptyObject;\n}\n\n@Data\n@NoArgsConstructor\n@JsonSerialize\npublic class EmptyObject {\n\n}\n</code></pre>\n",
    "tags" : [ "java", "spring", "unit-testing", "mockito" ],
    "owner" : {
      "account_id" : 140830,
      "reputation" : 567,
      "user_id" : 347422,
      "user_type" : "registered",
      "accept_rate" : 73,
      "profile_image" : "https://www.gravatar.com/avatar/7d01fcd2f10ed44ccc0abb5820f3d60e?s=256&d=identicon&r=PG",
      "display_name" : "yoda",
      "link" : "https://stackoverflow.com/users/347422/yoda"
    },
    "is_answered" : false,
    "view_count" : 81,
    "answer_count" : 1,
    "score" : -1,
    "last_activity_date" : 1742887381,
    "creation_date" : 1742879963,
    "link" : "https://stackoverflow.com/questions/79532748/mockito-not-able-to-catch-the-exception-thrown",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79532927,
    "question_id" : 79532748,
    "body" : "<p>You throwing <code>new JsonProcessingException(&quot;test&quot;) {}</code>. It is anonymous class.</p>\n<p>Try throwing <code>new JsonProcessingException(&quot;test&quot;)</code>.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 4497436,
      "reputation" : 20786,
      "user_id" : 3656904,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/8bdbd1f89f8907e8e8b15ab88c084c65?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "talex",
      "link" : "https://stackoverflow.com/users/3656904/talex"
    },
    "creation_date" : 1742887381,
    "last_activity_date" : 1742887381,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140263860,
    "post_id" : 79532748,
    "body" : "Once again trigger happy dude has downvoted this answer.",
    "score" : 0,
    "owner" : {
      "account_id" : 140830,
      "reputation" : 567,
      "user_id" : 347422,
      "user_type" : "registered",
      "accept_rate" : 73,
      "profile_image" : "https://www.gravatar.com/avatar/7d01fcd2f10ed44ccc0abb5820f3d60e?s=256&d=identicon&r=PG",
      "display_name" : "yoda",
      "link" : "https://stackoverflow.com/users/347422/yoda"
    },
    "creation_date" : 1742968423,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140259381,
    "post_id" : 79532748,
    "body" : "Assertion error says that it was expecting it to throw your error, but it <i>didnt</i> which is an error. As for why it didn&#39;t, I m not able to comment as the sample code is too messy. i.e. you have two ObjectMapper variables called mapper which shouldnt compile, and you have an @Autowire on a static variable? That doesnt work the way you think it does. Please reorganize your code into an <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>",
    "score" : 1,
    "owner" : {
      "account_id" : 21724606,
      "reputation" : 1431,
      "user_id" : 16034206,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/MRBdT.jpg?s=256",
      "display_name" : "pebble unit",
      "link" : "https://stackoverflow.com/users/16034206/pebble-unit"
    },
    "creation_date" : 1742882303,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79532927" : [ {
      "comment_id" : 140263890,
      "post_id" : 79532927,
      "body" : "If it is actually json class, you need to use either <code>JsonGenerationException</code> or  <code>JsonParseException</code>.",
      "score" : 0,
      "owner" : {
        "account_id" : 4497436,
        "reputation" : 20786,
        "user_id" : 3656904,
        "user_type" : "registered",
        "accept_rate" : 67,
        "profile_image" : "https://www.gravatar.com/avatar/8bdbd1f89f8907e8e8b15ab88c084c65?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "talex",
        "link" : "https://stackoverflow.com/users/3656904/talex"
      },
      "creation_date" : 1742969083,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140263879,
      "post_id" : 79532927,
      "body" : "But it called <code>com.orgfoo.BarService.order.service.exception.ErrorJsonProce&zwnj;&#8203;ssingException</code> in error message. Are you sure you importing right class?",
      "score" : 0,
      "owner" : {
        "account_id" : 4497436,
        "reputation" : 20786,
        "user_id" : 3656904,
        "user_type" : "registered",
        "accept_rate" : 67,
        "profile_image" : "https://www.gravatar.com/avatar/8bdbd1f89f8907e8e8b15ab88c084c65?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "talex",
        "link" : "https://stackoverflow.com/users/3656904/talex"
      },
      "creation_date" : 1742968903,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140263867,
      "post_id" : 79532927,
      "body" : "Its this class from the jackson <a href=\"https://www.javadoc.io/doc/com.fasterxml.jackson.core/jackson-core/2.1.3/com/fasterxml/jackson/core/JsonProcessingException.html\" rel=\"nofollow noreferrer\">javadoc.io/doc/com.fasterxml.jackson.core/jackson-core/2.1.3&zwnj;&#8203;/&hellip;</a> I throw a custom ErrorJsonrocessingException which is caught in controller advice. I&#39;m sorry I havent pasted that class",
      "score" : 0,
      "owner" : {
        "account_id" : 140830,
        "reputation" : 567,
        "user_id" : 347422,
        "user_type" : "registered",
        "accept_rate" : 73,
        "profile_image" : "https://www.gravatar.com/avatar/7d01fcd2f10ed44ccc0abb5820f3d60e?s=256&d=identicon&r=PG",
        "display_name" : "yoda",
        "link" : "https://stackoverflow.com/users/347422/yoda"
      },
      "creation_date" : 1742968612,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140261340,
      "post_id" : 79532927,
      "body" : "It is your class. Either make constructor public, use existing public constructor or create non anonymous sub class with public constructor and use it instead.",
      "score" : 0,
      "owner" : {
        "account_id" : 4497436,
        "reputation" : 20786,
        "user_id" : 3656904,
        "user_type" : "registered",
        "accept_rate" : 67,
        "profile_image" : "https://www.gravatar.com/avatar/8bdbd1f89f8907e8e8b15ab88c084c65?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "talex",
        "link" : "https://stackoverflow.com/users/3656904/talex"
      },
      "creation_date" : 1742913312,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140261242,
      "post_id" : 79532927,
      "body" : "This is giving a compilation error saying &#39;JsonProcessingException has protected access in &#39;com.fasterxml.jackson.core.JsonProcessingException",
      "score" : 0,
      "owner" : {
        "account_id" : 140830,
        "reputation" : 567,
        "user_id" : 347422,
        "user_type" : "registered",
        "accept_rate" : 73,
        "profile_image" : "https://www.gravatar.com/avatar/7d01fcd2f10ed44ccc0abb5820f3d60e?s=256&d=identicon&r=PG",
        "display_name" : "yoda",
        "link" : "https://stackoverflow.com/users/347422/yoda"
      },
      "creation_date" : 1742912001,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140261085,
      "post_id" : 79532927,
      "body" : "Javadoc doesn&#39;t say it explicitly but says &quot;exception of the specified class is thrown&quot;. Looks like exact match expected.",
      "score" : 0,
      "owner" : {
        "account_id" : 4497436,
        "reputation" : 20786,
        "user_id" : 3656904,
        "user_type" : "registered",
        "accept_rate" : 67,
        "profile_image" : "https://www.gravatar.com/avatar/8bdbd1f89f8907e8e8b15ab88c084c65?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "talex",
        "link" : "https://stackoverflow.com/users/3656904/talex"
      },
      "creation_date" : 1742909939,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140260912,
      "post_id" : 79532927,
      "body" : "Wow, I would have never spotted that. But since the anonymous class is a subclass, shouldn&#39;t it still match?",
      "score" : 0,
      "owner" : {
        "account_id" : 39208,
        "reputation" : 269387,
        "user_id" : 112968,
        "user_type" : "registered",
        "accept_rate" : 68,
        "profile_image" : "https://i.sstatic.net/zHTaT.png?s=256",
        "display_name" : "knittl",
        "link" : "https://stackoverflow.com/users/112968/knittl"
      },
      "creation_date" : 1742907399,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}