{
  "question" : {
    "question_id" : 79761042,
    "title" : "How to update Android cmdline-tools on a MacOS agent in Azure Pipelines",
    "body" : "<p>I have an Apache Cordova application for which I create an iOS and an Android build. For this purpose I have a build pipeline in Azure running on a MacOS agent. Up until recently this pipeline had been working, but a combination of expired certificates and updates to the agent itself broke the pipeline.</p>\n<p>I've just recently refreshed the certs and provisioning profiles for the iOS build, so that is done. Now I turn my attention to the Android build, which seems to be broken in an odd way. At the beginning of my pipeline I am installing OpenJDK 21 with the <code>JavaToolInstaller</code> task and installing my android build tools in a <code>CmdLine</code> task.</p>\n<pre><code># Update cmdline-tools\n$ANDROID_HOME/tools/bin/sdkmanager --install &quot;cmdline-tools;latest&quot; --verbose\n# Uninstall and Reinstall build-tools\n$ANDROID_HOME/tools/bin/sdkmanager --uninstall 'build-tools;35.0.0' --verbose\necho 'y'| $ANDROID_HOME/tools/bin/sdkmanager --install 'build-tools;35.0.0' --verbose      \n</code></pre>\n<p>My problem comes up when running this task. From the first invocation of <code>sdkmanager</code> there appears to be a java-related <code>NoClassDefFoundError</code> exception that I can't figure out how to address:</p>\n<pre><code>Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: javax/xml/bind/annotation/XmlSchema\n    at com.android.repository.api.SchemaModule$SchemaModuleVersion.&lt;init&gt;(SchemaModule.java:156)\n    at com.android.repository.api.SchemaModule.&lt;init&gt;(SchemaModule.java:75)\n    at com.android.sdklib.repository.AndroidSdkHandler.&lt;clinit&gt;(AndroidSdkHandler.java:81)\n    at com.android.sdklib.tool.sdkmanager.SdkManagerCli.main(SdkManagerCli.java:73)\n    at com.android.sdklib.tool.sdkmanager.SdkManagerCli.main(SdkManagerCli.java:48)\nCaused by: java.lang.ClassNotFoundException: javax.xml.bind.annotation.XmlSchema\n    at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:641)\n    at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:188)\n    at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:526)\n    ... 5 more\n</code></pre>\n<p>I suspect the <code>sdkmanager</code> may be too old for the current <code>java</code> version, but I can't fall back to java 8 with the <code>JavaToolInstaller</code>. Does anyone have experience with this issue in Azure?</p>\n",
    "tags" : [ "java", "android", "macos", "azure-devops", "continuous-integration" ],
    "owner" : {
      "account_id" : 3972054,
      "reputation" : 141,
      "user_id" : 3276388,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/32477f88dfd7a0b8747811f559c126d0?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Zachary",
      "link" : "https://stackoverflow.com/users/3276388/zachary"
    },
    "is_answered" : false,
    "view_count" : 22,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1757519622,
    "creation_date" : 1757519622,
    "link" : "https://stackoverflow.com/questions/79761042/how-to-update-android-cmdline-tools-on-a-macos-agent-in-azure-pipelines",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}