{
  "question" : {
    "question_id" : 79589100,
    "title" : "java java.net.http.HttpClient returns http status 403 while curl works fine",
    "body" : "<p>I'm trying to fetch a json string from a (GraphQL ?) server. The input is a json string + POST request and the ouput is a json document.</p>\n<p>When using <strong>curl</strong>, it works (well , let's be honest it works if you don't call the server too many times).</p>\n<pre><code> curl -v  'https://afb.ukbiobank.ac.uk/api' -X POST -H 'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:137.0) Gecko/20100101 Firefox/137.0' -H 'Accept: application/json, text/plain, */*' -H 'Accept-Language: en-US,en;q=0.5'  -H 'Content-Type: application/json' -H 'Origin: https://afb.ukbiobank.ac.uk' -H 'Connection: keep-alive' -H 'Referer: https://afb.ukbiobank.ac.uk/variant/chr3-38435047-A-G'  --data-raw '{&quot;query&quot;:&quot;\\nquery VariantSplitPopulationQuery($chrom: String!, $pos: Int!, $ref: String!, $alt: String!) {\\n    variant(chrom: $chrom, pos: $pos, ref: $ref, alt: $alt) {\\n      Chrom\\n      Pos\\n      Ref\\n      Alt\\n      alleleCount\\n      alleleNum\\n      alleleFreq\\n      nHomozygotes\\n      maxImpact\\n      maxConsequence\\n      HGVSp\\n      geneSymbol\\n      populationDetails {\\n        population\\n        alleleCount\\n        alleleNum\\n        alleleFreq\\n        nHomozygotes\\n        nHemiAlt\\n      }\\n    }\\n  } \\n&quot;,&quot;variables&quot;:{&quot;chrom&quot;:&quot;chr3&quot;,&quot;pos&quot;:38435047,&quot;ref&quot;:&quot;A&quot;,&quot;alt&quot;:&quot;G&quot;}}'\n(...)\n&gt; POST /api HTTP/2\n&gt; Host: afb.ukbiobank.ac.uk\n&gt; User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:137.0) Gecko/20100101 Firefox/137.0\n&gt; Accept: application/json, text/plain, */*\n&gt; Accept-Language: en-US,en;q=0.5\n&gt; Content-Type: application/json\n&gt; Origin: https://afb.ukbiobank.ac.uk\n&gt; Connection: keep-alive\n&gt; Referer: https://afb.ukbiobank.ac.uk/variant/chr3-38435047-A-G\n&gt; Content-Length: 596\n(..)\n&lt; \n{&quot;data&quot;:{&quot;variant&quot;:{&quot;Chrom&quot;:&quot;chr3&quot;,&quot;Pos&quot;:38435047,&quot;Ref&quot;:&quot;A&quot;,&quot;Alt&quot;:&quot;G&quot;,&quot;alleleCount&quot;:587506,&quot;alleleNum&quot;:980494,&quot;alleleFreq&quot;:0.5991938757401881,&quot;nHomozygotes&quot;:178020,&quot;maxImpact&quot;:&quot;LOWEST&quot;,&quot;maxConsequence&quot;:&quot;intergenic_variant&quot;,&quot;HGVSp&quot;:&quot;.&quot;,&quot;geneSymbol&quot;:&quot;XYLB&quot;,&quot;populationDetails&quot;:[{&quot;population&quot;:&quot;African&quot;,&quot;alleleCount&quot;:3779,&quot;alleleNum&quot;:18454,&quot;alleleFreq&quot;:0.20477945160940716,&quot;nHomozygotes&quot;:438,&quot;nHemiAlt&quot;:null},{&quot;population&quot;:&quot;Ashkenazi Jewish&quot;,&quot;alleleCount&quot;:3032,&quot;alleleNum&quot;:5714,&quot;alleleFreq&quot;:0.5306265313265663,&quot;nHomozygotes&quot;:796,&quot;nHemiAlt&quot;:null},{&quot;population&quot;:&quot;East Asian&quot;,&quot;alleleCount&quot;:2101,&quot;alleleNum&quot;:4484,&quot;alleleFreq&quot;:0.4685548617305977,&quot;nHomozygotes&quot;:507,&quot;nHemiAlt&quot;:null},{&quot;population&quot;:&quot;Non-Finnish European&quot;,&quot;alleleCount&quot;:558994,&quot;alleleNum&quot;:917198,&quot;alleleFreq&quot;:0.6094583721290278,&quot;nHomozygotes&quot;:170620,&quot;nHemiAlt&quot;:null},{&quot;population&quot;:&quot;Other&quot;,&quot;alleleCount&quot;:8312,&quot;alleleNum&quot;:15340,&quot;alleleFreq&quot;:0.5418513689700131,&quot;nHomozygotes&quot;:2309,&quot;nHemiAlt&quot;:null},{&quot;population&quot;:&quot;South Asian&quot;,&quot;alleleCount&quot;:11288,&quot;alleleNum&quot;:19304,&quot;alleleFreq&quot;:0.5847492747617075,&quot;nHomozygotes&quot;:3350,&quot;nHemiAlt&quot;:null}]}}}\n</code></pre>\n<p>but when I want to use a java client, it always returns a code 403 (and a HTML page instead of a json). Here is a minimal example which use the query above.</p>\n<pre><code>\nimport java.net.URI;\nimport java.net.http.HttpClient;\nimport java.net.http.HttpRequest;\nimport java.net.http.HttpResponse;\n\npublic class Test {\n\n    public static void main(final String[] args) {\n        try {\n            final String query=&quot;{\\n&quot; +\n                    &quot;    \\&quot;query\\&quot;: \\&quot;\\nquery VariantSplitPopulationQuery($chrom: String!, $pos: Int!, $ref: String!, $alt: String!) {\\n    variant(chrom: $chrom, pos: $pos, ref: $ref, alt: $alt) {\\n      Chrom\\n      Pos\\n      Ref\\n      Alt\\n      alleleCount\\n      alleleNum\\n      alleleFreq\\n      nHomozygotes\\n      maxImpact\\n      maxConsequence\\n      HGVSp\\n      geneSymbol\\n      populationDetails {\\n        population\\n        alleleCount\\n        alleleNum\\n        alleleFreq\\n        nHomozygotes\\n        nHemiAlt\\n      }\\n    }\\n  } \\n\\&quot;,\\n&quot; +\n                    &quot;    \\&quot;variables\\&quot;: {\\n&quot; +\n                    &quot;        \\&quot;chrom\\&quot;: \\&quot;chr3\\&quot;,\\n&quot; +\n                    &quot;        \\&quot;pos\\&quot;: 38435047,\\n&quot; +\n                    &quot;        \\&quot;ref\\&quot;: \\&quot;A\\&quot;,\\n&quot; +\n                    &quot;        \\&quot;alt\\&quot;: \\&quot;G\\&quot;\\n&quot; +\n                    &quot;    }\\n&quot; +\n                    &quot;}\\n&quot;;\n            HttpClient httpClient = HttpClient.newHttpClient();\n            \n        \n            HttpRequest.Builder hb= HttpRequest.newBuilder();\n            \n            hb.header(&quot;User-Agent&quot;,&quot;Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:137.0) Gecko/20100101 Firefox/137.0&quot;);\n            hb.header(&quot;Accept&quot;,&quot;application/json, text/plain, */*&quot;);\n            hb.header(&quot;Accept-Language&quot;,&quot;en-US,en;q=0.5&quot;);\n            hb.header(&quot;Content-Type&quot;,&quot;application/json&quot;);\n            hb.header(&quot;Origin&quot;,&quot;https://afb.ukbiobank.ac.uk&quot;);\n            hb.header(&quot;Referer&quot;,&quot;https://afb.ukbiobank.ac.uk/variant/chr3-38435047-A-G&quot;);\n            \n\n            hb.uri(URI.create(&quot;https://afb.ukbiobank.ac.uk/api&quot;));\n            hb.POST(HttpRequest.BodyPublishers.ofString(query));\n            HttpRequest request = hb.build();\n            \n            \n            HttpResponse&lt;String&gt; resp= httpClient.send(request, HttpResponse.BodyHandlers.ofString());\n            System.err.println(resp.body());\n            System.err.println(resp.statusCode());\n                \n        }\n        catch(Throwable err) {\n            err.printStackTrace();\n        }\n    }\n}\n</code></pre>\n<p>output is:</p>\n<pre><code>&lt;!DOCTYPE html&gt;&lt;h(...)\n403\n</code></pre>\n<p>How can I make the java program works ?\nThanks !</p>\n<p>EDIT: I also tested with '\\n' instead of '\\n' in the json string but got the Same result:</p>\n<pre><code>(...)\n&quot;    \\&quot;query\\&quot;: \\&quot;\\\\nquery VariantSplitPopulationQuery($chrom: String!, $pos: Int!, $ref: String!, $alt: String!) {\\\\n    variant(chrom: $chrom, pos: $pos, ref: $ref, alt: $alt) {\\\\n      Chrom\\\\n      Pos\\\\n      Ref\\\\n      Alt\\\\n      alleleCount\\\\n      alleleNum\\\\n      alleleFreq\\\\n      nHomozygotes\\\\n      maxImpact\\\\n      maxConsequence\\\\n      HGVSp\\\\n      geneSymbol\\\\n      populationDetails {\\\\n        population\\\\n        alleleCount\\\\n        alleleNum\\\\n        alleleFreq\\\\n        nHomozygotes\\\\n        nHemiAlt\\\\n      }\\\\n    }\\\\n  } \\\\n\\&quot;,\\n&quot; +\n\n(...)\n</code></pre>\n",
    "tags" : [ "java", "curl", "graphql", "java-http-client" ],
    "owner" : {
      "account_id" : 23234,
      "reputation" : 35412,
      "user_id" : 58082,
      "user_type" : "registered",
      "accept_rate" : 78,
      "profile_image" : "https://www.gravatar.com/avatar/61200477cf8983809ec152f484750204?s=256&d=identicon&r=PG",
      "display_name" : "Pierre",
      "link" : "https://stackoverflow.com/users/58082/pierre"
    },
    "is_answered" : true,
    "view_count" : 114,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1754644927,
    "creation_date" : 1745426784,
    "link" : "https://stackoverflow.com/questions/79589100/java-java-net-http-httpclient-returns-http-status-403-while-curl-works-fine",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79589411,
    "question_id" : 79589100,
    "body" : "<p>Just copied your body from curl to a one line Java String.</p>\n<pre><code>final String query= &quot;{\\&quot;query\\&quot;:\\&quot;\\\\nquery VariantSplitPopulationQuery($chrom: String!, $pos: Int!, $ref: String!, $alt: String!) {\\\\n    variant(chrom: $chrom, pos: $pos, ref: $ref, alt: $alt) {\\\\n      Chrom\\\\n      Pos\\\\n      Ref\\\\n      Alt\\\\n      alleleCount\\\\n      alleleNum\\\\n      alleleFreq\\\\n      nHomozygotes\\\\n      maxImpact\\\\n      maxConsequence\\\\n      HGVSp\\\\n      geneSymbol\\\\n      populationDetails {\\\\n        population\\\\n        alleleCount\\\\n        alleleNum\\\\n        alleleFreq\\\\n        nHomozygotes\\\\n        nHemiAlt\\\\n      }\\\\n    }\\\\n  } \\\\n\\&quot;,\\&quot;variables\\&quot;:{\\&quot;chrom\\&quot;:\\&quot;chr3\\&quot;,\\&quot;pos\\&quot;:38435047,\\&quot;ref\\&quot;:\\&quot;A\\&quot;,\\&quot;alt\\&quot;:\\&quot;G\\&quot;}}&quot;;\n</code></pre>\n<p>Works like charme</p>\n<p>btw. you should use HttpClient.newHttpClient() in a try block for using autoclose:</p>\n<pre><code>HttpResponse&lt;String&gt; resp;\nfinal String query = &quot;{\\&quot;query\\&quot;:\\&quot;\\\\nquery VariantSplitPopulationQuery($chrom: String!, $pos: Int!, $ref: String!, $alt: String!) {\\\\n    variant(chrom: $chrom, pos: $pos, ref: $ref, alt: $alt) {\\\\n      Chrom\\\\n      Pos\\\\n      Ref\\\\n      Alt\\\\n      alleleCount\\\\n      alleleNum\\\\n      alleleFreq\\\\n      nHomozygotes\\\\n      maxImpact\\\\n      maxConsequence\\\\n      HGVSp\\\\n      geneSymbol\\\\n      populationDetails {\\\\n        population\\\\n        alleleCount\\\\n        alleleNum\\\\n        alleleFreq\\\\n        nHomozygotes\\\\n        nHemiAlt\\\\n      }\\\\n    }\\\\n  } \\\\n\\&quot;,\\&quot;variables\\&quot;:{\\&quot;chrom\\&quot;:\\&quot;chr3\\&quot;,\\&quot;pos\\&quot;:38435047,\\&quot;ref\\&quot;:\\&quot;A\\&quot;,\\&quot;alt\\&quot;:\\&quot;G\\&quot;}}&quot;;\ntry (HttpClient httpClient = HttpClient.newHttpClient()) {\n  HttpRequest.Builder hb = HttpRequest.newBuilder();\n\n  hb.header(&quot;User-Agent&quot;, &quot;Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:137.0) Gecko/20100101 Firefox/137.0&quot;);\n  hb.header(&quot;Accept&quot;, &quot;application/json, text/plain, */*&quot;);\n  hb.header(&quot;Accept-Language&quot;, &quot;en-US,en;q=0.5&quot;);\n  hb.header(&quot;Content-Type&quot;, &quot;application/json&quot;);\n  hb.header(&quot;Origin&quot;, &quot;https://afb.ukbiobank.ac.uk&quot;);\n  hb.header(&quot;Referer&quot;, &quot;https://afb.ukbiobank.ac.uk/variant/chr3-38435047-A-G&quot;);\n\n  hb.uri(URI.create(&quot;https://afb.ukbiobank.ac.uk/api&quot;));\n  hb.POST(HttpRequest.BodyPublishers.ofString(query));\n  HttpRequest request = hb.build();\n\n  resp = httpClient.send(request, HttpResponse.BodyHandlers.ofString());\n  System.err.println(resp.body());\n  System.err.println(resp.statusCode());\n\n} catch (Throwable err) {\n  err.printStackTrace();\n}\n</code></pre>\n",
    "score" : 3,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 11555562,
      "reputation" : 569,
      "user_id" : 8466853,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/cd7f72b426ce3c46739900b8ba014e26?s=256&d=identicon&r=PG",
      "display_name" : "Arno",
      "link" : "https://stackoverflow.com/users/8466853/arno"
    },
    "creation_date" : 1745437809,
    "last_activity_date" : 1745437809,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79729581,
    "question_id" : 79589100,
    "body" : "<p>I had the same issue with httpClient, however, changing http version to <strong>HTTP version 1.1</strong> helped.</p>\n<pre><code>.version(HttpClient.Version.HTTP_1_1)\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 7286540,
      "reputation" : 11,
      "user_id" : 5554436,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-n8vcun1GlF8/AAAAAAAAAAI/AAAAAAAAAJI/Ds7EtkD0J-Y/s256-rj/photo.jpg",
      "display_name" : "Yakov Shmidt",
      "link" : "https://stackoverflow.com/users/5554436/yakov-shmidt"
    },
    "creation_date" : 1754644927,
    "last_activity_date" : 1754644927,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140362896,
    "post_id" : 79589100,
    "body" : "Try enabling Java SSL debug log and compare both requests.",
    "score" : 0,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1745437178,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140362868,
    "post_id" : 79589100,
    "body" : "@aled thanks, problem with a copy-n-paste (same result)",
    "score" : 0,
    "owner" : {
      "account_id" : 23234,
      "reputation" : 35412,
      "user_id" : 58082,
      "user_type" : "registered",
      "accept_rate" : 78,
      "profile_image" : "https://www.gravatar.com/avatar/61200477cf8983809ec152f484750204?s=256&d=identicon&r=PG",
      "display_name" : "Pierre",
      "link" : "https://stackoverflow.com/users/58082/pierre"
    },
    "creation_date" : 1745436645,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140362819,
    "post_id" : 79589100,
    "body" : "Not sure if it causes any issues but the call to <code>hb.uri(...)</code> is duplicated.",
    "score" : 0,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1745435665,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140362803,
    "post_id" : 79589100,
    "body" : "@aled the simple curl command above works without any special authorization, so I don&#39;t think there is any header to add.",
    "score" : 0,
    "owner" : {
      "account_id" : 23234,
      "reputation" : 35412,
      "user_id" : 58082,
      "user_type" : "registered",
      "accept_rate" : 78,
      "profile_image" : "https://www.gravatar.com/avatar/61200477cf8983809ec152f484750204?s=256&d=identicon&r=PG",
      "display_name" : "Pierre",
      "link" : "https://stackoverflow.com/users/58082/pierre"
    },
    "creation_date" : 1745435293,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140362794,
    "post_id" : 79589100,
    "body" : "HTTP error 403 indicates that access is forbidden. There is no authorization header in either request. Also we don&#39;t know how the server authenticates HTTP requests. Share that information in the question (use <a href=\"https://stackoverflow.com/posts/79589100/edit\">edit</a>).",
    "score" : 0,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1745435175,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140362753,
    "post_id" : 79589100,
    "body" : "I escaped the &#39;\\n&#39; but I get the same error.",
    "score" : 0,
    "owner" : {
      "account_id" : 23234,
      "reputation" : 35412,
      "user_id" : 58082,
      "user_type" : "registered",
      "accept_rate" : 78,
      "profile_image" : "https://www.gravatar.com/avatar/61200477cf8983809ec152f484750204?s=256&d=identicon&r=PG",
      "display_name" : "Pierre",
      "link" : "https://stackoverflow.com/users/58082/pierre"
    },
    "creation_date" : 1745434527,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140362729,
    "post_id" : 79589100,
    "body" : "Rhha, thanks again, I did those errors when I reduced my original code to a minimal example. In my original code the json string is validated with the gson library. But I&#39;ll try with the escaped &#39;\\n&#39;...",
    "score" : 0,
    "owner" : {
      "account_id" : 23234,
      "reputation" : 35412,
      "user_id" : 58082,
      "user_type" : "registered",
      "accept_rate" : 78,
      "profile_image" : "https://www.gravatar.com/avatar/61200477cf8983809ec152f484750204?s=256&d=identicon&r=PG",
      "display_name" : "Pierre",
      "link" : "https://stackoverflow.com/users/58082/pierre"
    },
    "creation_date" : 1745434074,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140362691,
    "post_id" : 79589100,
    "body" : "I see a typo in your request body:  <code>\\&quot;pos\\&quot;: :38435047\\&quot;,</code> But I would expect that to produce an HTTP 400, not an HTTP 403.  You also have a string value in your JSON which contains newlines.  I don’t think JSON allows that, but it does allow a two-character escape.  So, every <code>\\n</code> that follows <code>\\&quot;query\\&quot;:</code> should be changed from <code>\\n</code> (a literal linefeed character in a JSON string) to <code>\\\\n</code> (a two-character escape sequence in a JSON string).",
    "score" : 1,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44936,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1745433342,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140362628,
    "post_id" : 79589100,
    "body" : "@VGR thanks ! I&#39;ll update the code above but I still have the same error .",
    "score" : 0,
    "owner" : {
      "account_id" : 23234,
      "reputation" : 35412,
      "user_id" : 58082,
      "user_type" : "registered",
      "accept_rate" : 78,
      "profile_image" : "https://www.gravatar.com/avatar/61200477cf8983809ec152f484750204?s=256&d=identicon&r=PG",
      "display_name" : "Pierre",
      "link" : "https://stackoverflow.com/users/58082/pierre"
    },
    "creation_date" : 1745432159,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140362494,
    "post_id" : 79589100,
    "body" : "Don’t repeat the header name in a header value.  This is wrong:  <code>hb.header(&quot;Content-Type&quot;,&quot;Content-Type: application&#47;json&quot;);</code>  This is correct:  <code>hb.header(&quot;Content-Type&quot;, &quot;application&#47;json&quot;);</code>  Notice that “Content-Type” is in the first string argument, but not in the second argument.",
    "score" : 3,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44936,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1745429490,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79589411" : [ {
      "comment_id" : 140370589,
      "post_id" : 79589411,
      "body" : "@Pierre Be sure you are on the latest update. For Java 17 that is 17.0.15 according to <a href=\"https://adoptium.net/temurin/releases/?version=17\" rel=\"nofollow noreferrer\">Adoptium</a>.",
      "score" : 0,
      "owner" : {
        "account_id" : 322981,
        "reputation" : 346951,
        "user_id" : 642706,
        "user_type" : "registered",
        "accept_rate" : 58,
        "profile_image" : "https://i.sstatic.net/ZWEI3.jpg?s=256",
        "display_name" : "Basil Bourque",
        "link" : "https://stackoverflow.com/users/642706/basil-bourque"
      },
      "creation_date" : 1745614438,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140370359,
      "post_id" : 79589411,
      "body" : "@BasilBourque I don&#39;t know really understand what&#39;s happening. Currently the code above doesn&#39;t work with jdk17 but works with jdk23. So my last idea is that it is a bug in jdk17. But sometimes the server returns an error whatever the jdk is.",
      "score" : 0,
      "owner" : {
        "account_id" : 23234,
        "reputation" : 35412,
        "user_id" : 58082,
        "user_type" : "registered",
        "accept_rate" : 78,
        "profile_image" : "https://www.gravatar.com/avatar/61200477cf8983809ec152f484750204?s=256&d=identicon&r=PG",
        "display_name" : "Pierre",
        "link" : "https://stackoverflow.com/users/58082/pierre"
      },
      "creation_date" : 1745608492,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140369595,
      "post_id" : 79589411,
      "body" : "@Pierre That’s curious. The <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.net.http/java/net/http/HttpClient.html#version()\" rel=\"nofollow noreferrer\">Javadoc for 17 says</a> the default is <code>HttpClient.Version.HTTP_2</code>. So I wonder if you have some additional code in the mix.",
      "score" : 0,
      "owner" : {
        "account_id" : 322981,
        "reputation" : 346951,
        "user_id" : 642706,
        "user_type" : "registered",
        "accept_rate" : 58,
        "profile_image" : "https://i.sstatic.net/ZWEI3.jpg?s=256",
        "display_name" : "Basil Bourque",
        "link" : "https://stackoverflow.com/users/642706/basil-bourque"
      },
      "creation_date" : 1745594794,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140363057,
      "post_id" : 79589411,
      "body" : "AH ! I added <code>hb.version(Version.HTTP_2);</code> and it now works with jdk17 !",
      "score" : 3,
      "owner" : {
        "account_id" : 23234,
        "reputation" : 35412,
        "user_id" : 58082,
        "user_type" : "registered",
        "accept_rate" : 78,
        "profile_image" : "https://www.gravatar.com/avatar/61200477cf8983809ec152f484750204?s=256&d=identicon&r=PG",
        "display_name" : "Pierre",
        "link" : "https://stackoverflow.com/users/58082/pierre"
      },
      "creation_date" : 1745440721,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140363041,
      "post_id" : 79589411,
      "body" : "and now it works with the original code I&#39;m lost. I&#39;m going to validate your answer but there is something I don&#39;t understand.",
      "score" : 0,
      "owner" : {
        "account_id" : 23234,
        "reputation" : 35412,
        "user_id" : 58082,
        "user_type" : "registered",
        "accept_rate" : 78,
        "profile_image" : "https://www.gravatar.com/avatar/61200477cf8983809ec152f484750204?s=256&d=identicon&r=PG",
        "display_name" : "Pierre",
        "link" : "https://stackoverflow.com/users/58082/pierre"
      },
      "creation_date" : 1745440402,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140363028,
      "post_id" : 79589411,
      "body" : "I just tested with jdk23, , on another server, same error AND the try-with-resource and it works ! hum... puzzling...",
      "score" : 0,
      "owner" : {
        "account_id" : 23234,
        "reputation" : 35412,
        "user_id" : 58082,
        "user_type" : "registered",
        "accept_rate" : 78,
        "profile_image" : "https://www.gravatar.com/avatar/61200477cf8983809ec152f484750204?s=256&d=identicon&r=PG",
        "display_name" : "Pierre",
        "link" : "https://stackoverflow.com/users/58082/pierre"
      },
      "creation_date" : 1745440233,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140363021,
      "post_id" : 79589411,
      "body" : "I just tested with jdk23, on another server, same error.",
      "score" : 0,
      "owner" : {
        "account_id" : 23234,
        "reputation" : 35412,
        "user_id" : 58082,
        "user_type" : "registered",
        "accept_rate" : 78,
        "profile_image" : "https://www.gravatar.com/avatar/61200477cf8983809ec152f484750204?s=256&d=identicon&r=PG",
        "display_name" : "Pierre",
        "link" : "https://stackoverflow.com/users/58082/pierre"
      },
      "creation_date" : 1745440147,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140363007,
      "post_id" : 79589411,
      "body" : "Thanks. I&#39;m using jdk17. HttpClient which doesn&#39;t implement AutoCloseable <a href=\"https://docs.oracle.com/en/java/javase/17/docs/api/java.net.http/java/net/http/HttpClient.html\" rel=\"nofollow noreferrer\">docs.oracle.com/en/java/javase/17/docs/api/java.net.http/jav&zwnj;&#8203;a/&hellip;</a>  (but 22 do). On my side , the code above, without the try-with-resource , doesn&#39;t work. I still have a 403 while curl is still working.",
      "score" : 0,
      "owner" : {
        "account_id" : 23234,
        "reputation" : 35412,
        "user_id" : 58082,
        "user_type" : "registered",
        "accept_rate" : 78,
        "profile_image" : "https://www.gravatar.com/avatar/61200477cf8983809ec152f484750204?s=256&d=identicon&r=PG",
        "display_name" : "Pierre",
        "link" : "https://stackoverflow.com/users/58082/pierre"
      },
      "creation_date" : 1745439996,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}