{
  "question" : {
    "question_id" : 79588752,
    "title" : "React Native Android Native Component Events Not Reaching JavaScript",
    "body" : "<p>I'm building a custom React Native view that wraps a camera preview with QR code scanning functionality. The native Android component detects QR codes, but the events aren't reaching my JavaScript code. Here's my implementation:</p>\n<p>MyTestView.kt (Wrapper View)</p>\n<pre><code>package com.custman\n\nimport android.content.Context\nimport android.graphics.Color\nimport android.util.Log\nimport android.widget.FrameLayout\nimport android.widget.LinearLayout\nimport com.facebook.react.bridge.ReactContext\nimport com.facebook.react.uimanager.ThemedReactContext\n\nclass MyTestView(context: Context) : FrameLayout(context) {\n    val cameraView: CameraNewPreviiw\n\n    init {\n        cameraView = CameraNewPreviiw(context as ThemedReactContext)\n        cameraView.id = generateViewId()\n        Log.d(&quot;CameraNewPreviiw&quot;, cameraView.id.toString())\n        addView(cameraView, LayoutParams(LayoutParams.MATCH_PARENT, LayoutParams.MATCH_PARENT))\n    }\n</code></pre>\n<p>CustManUi.kt (View Manager)</p>\n<pre><code>package com.custman\n\nimport android.util.Log\nimport android.widget.FrameLayout\nimport com.facebook.drawee.backends.pipeline.Fresco\nimport com.facebook.react.bridge.ReactApplicationContext\nimport com.facebook.react.bridge.ReadableArray\nimport com.facebook.react.uimanager.SimpleViewManager\nimport com.facebook.react.uimanager.ThemedReactContext\nimport com.facebook.react.uimanager.annotations.ReactProp\nimport com.facebook.react.common.MapBuilder\n\nclass CustManUi(\n    private val callerContext: ReactApplicationContext\n) : SimpleViewManager&lt;MyTestView&gt;() {\n\n    override fun getName() = REACT_CLASS\n    \n    override fun createViewInstance(context: ThemedReactContext): MyTestView {\n        return MyTestView(context).apply {\n            layoutParams = FrameLayout.LayoutParams(\n                FrameLayout.LayoutParams.MATCH_PARENT,\n                FrameLayout.LayoutParams.MATCH_PARENT\n            )\n        }\n    }\n\n    override fun getExportedCustomBubblingEventTypeConstants(): Map&lt;String, Any&gt; {\n        return mapOf(\n            &quot;topChange&quot; to mapOf(\n                &quot;phasedRegistrationNames&quot; to mapOf(\n                    &quot;bubbled&quot; to &quot;onChange&quot;\n                )\n            )\n        )\n    }\n\n    override fun getExportedCustomDirectEventTypeConstants(): MutableMap&lt;String, Any&gt;? =\n        MapBuilder.builder&lt;String, Any&gt;()\n            .put(ReadCodeEvent.EVENT_NAME, MapBuilder.of(&quot;registrationName&quot;, &quot;onAverageFpsChanged&quot;))\n            .build()\n\n    companion object {\n        const val REACT_CLASS = &quot;MyTestView&quot;\n    }\n}\n</code></pre>\n<p>CameraNewPreviiw.kt (Camera Implementation)</p>\n<pre><code>// [Previous imports...]\n\nclass CameraNewPreviiw(context: ThemedReactContext) : FrameLayout(context), LifecycleObserver {\n    // [Other code...]\n\n    private fun sendQRCodeEvent(qrCodeData: String) {\n        val reactContext = context as ReactContext\n        val surfaceId = UIManagerHelper.getSurfaceId(this)\n        val dispatcher = UIManagerHelper.getEventDispatcherForReactTag(reactContext, id)\n        val event = Arguments.createMap().apply {\n            putString(&quot;message&quot;, &quot;MyMessage&quot;)\n        }\n        reactContext\n            .getJSModule(RCTEventEmitter::class.java)\n            .receiveEvent(id, &quot;topChange&quot;, event)\n        Log.d(&quot;CameraNewPreviiw&quot;, &quot;Dispatching ReadCodeEvent with value: $qrCodeData, view id: $id&quot;)\n        dispatcher?.dispatchEvent(ReadCodeEvent(surfaceId, id, qrCodeData))\n    }\n\n    // [Rest of the implementation...]\n}\n</code></pre>\n<p>ReadCodeEvent.kt (Custom Event)</p>\n<pre><code>\npackage com.custman\n\nimport com.facebook.react.bridge.Arguments\nimport com.facebook.react.bridge.WritableMap\nimport com.facebook.react.uimanager.events.Event\n\nclass ReadCodeEvent(\n    surfaceId: Int,\n    viewId: Int,\n    private val codeStringValue: String?,\n) : Event&lt;ReadCodeEvent&gt;(surfaceId, viewId) {\n    override fun getEventName(): String = EVENT_NAME\n\n    override fun getEventData(): WritableMap =\n        Arguments.createMap().apply {\n            putString(&quot;codeStringValue&quot;, codeStringValue)\n        }\n\n    companion object {\n        const val EVENT_NAME = &quot;onQRCodeScanned&quot;\n    }\n}\n\n</code></pre>\n<p>App.tsx (React Native Component)</p>\n<pre><code>function App(): React.JSX.Element {\n  return (\n    &lt;View style={{borderWidth: 1, borderColor: 'red', height: '100%'}}&gt;\n      &lt;MyTestView\n        onChange={value =&gt; {\n          console.log(value, 'kskskssksksksk');\n        }}\n        onAverageFpsChanged={value =&gt; {\n          console.log('kskssk');\n        }}\n        onQRCodeScanned={value =&gt; {\n          console.log(value.nativeEvent, 'SSSSS'); // Never gets called\n        }}\n        style={{flex: 1, height: '100%'}}\n      /&gt;\n    &lt;/View&gt;\n  );\n}\n\n</code></pre>\n<p><strong>The Problem:</strong>\nQR codes are detected in the native code (I see logs)</p>\n<p>The sendQRCodeEvent method is called with correct data</p>\n<p>But the onQRCodeScanned handler in React Native never fires</p>\n<p><strong>What I've Tried:</strong>\nVerified view IDs are properly set and propagated</p>\n<p>Tried both direct and bubbling events</p>\n<p>Confirmed the ReactContext is properly passed through</p>\n<p>Added extensive logging which shows events are being dispatched</p>\n<p><strong>The Problem:</strong>\nQR codes are detected in the native code (I see logs)</p>\n<p>The sendQRCodeEvent method is called with correct data</p>\n<p>But the onQRCodeScanned handler in React Native never fires</p>\n<p><strong>What I've Tried:</strong>\nVerified view IDs are properly set and propagated</p>\n<p>Tried both direct and bubbling events</p>\n<p>Confirmed the ReactContext is properly passed through</p>\n<p>Added extensive logging which shows events are being dispatched</p>\n",
    "tags" : [ "java", "android", "react-native", "kotlin" ],
    "owner" : {
      "account_id" : 20432995,
      "reputation" : 31,
      "user_id" : 14991537,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GhC6IvVSbiHPefhCDACBf8XSwmj-l2Z-a5eLqMd8w=k-s256",
      "display_name" : "Divit Rao",
      "link" : "https://stackoverflow.com/users/14991537/divit-rao"
    },
    "is_answered" : false,
    "view_count" : 28,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1745415901,
    "creation_date" : 1745415901,
    "link" : "https://stackoverflow.com/questions/79588752/react-native-android-native-component-events-not-reaching-javascript",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}