{
  "question" : {
    "question_id" : 79638478,
    "title" : "How to use libjpeg in Java",
    "body" : "<p>I want to use libjpeg in Spring Boot, but I cannot find an available dependency package, so could you help me?</p>\n<p>My attempt:</p>\n<p>Use ome.turbojpeg, I download the jar, and it has a .dylib file, but I can't use it. The error is UnsatisfiedLinkError.</p>\n<p>My device is an Apple Mac M2, and I also need to use libjpeg on Linux.</p>\n<p>jar path: /Users/lush/code/image-kit/image-kit-component/src/main/resources/turbojpeg-8.1.1.jar<br />\npom path: /Users/lush/code/image-kit/image-kit-component/pom.xml<br />\npom:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;dependency&gt;\n    &lt;groupId&gt;ome&lt;/groupId&gt;\n    &lt;artifactId&gt;turbojpeg&lt;/artifactId&gt;\n    &lt;version&gt;8.1.1&lt;/version&gt;\n    &lt;scope&gt;system&lt;/scope&gt;\n    &lt;systemPath&gt;${project.basedir}/src/main/resources/turbojpeg-8.1.1.jar&lt;/systemPath&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>My code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public static byte[] convertPngToJpeg(@NotNull BufferedImage bufferedImage, int quality) throws Exception {\n    BufferedImage rgbImage = new BufferedImage(\n            bufferedImage.getWidth(),\n            bufferedImage.getHeight(),\n            BufferedImage.TYPE_3BYTE_BGR\n    );\n    Graphics2D g = rgbImage.createGraphics();\n\n    g.setColor(Color.WHITE);\n    g.fillRect(0, 0, rgbImage.getWidth(), rgbImage.getHeight());\n    g.drawImage(bufferedImage, 0, 0, null);\n    g.dispose();\n    byte[] bgrData = ((DataBufferByte) rgbImage.getRaster().getDataBuffer()).getData();\n    int width = rgbImage.getWidth();\n    int height = rgbImage.getHeight();\n    int pitch = width * 3;\n\n    TJCompressor compressor = null;\n    try {\n        compressor = new TJCompressor();\n        compressor.setSubsamp(TJ.SAMP_420);\n        compressor.setJPEGQuality(quality);\n        compressor.setSourceImage(bgrData, 0, pitch, height, TJ.PF_BGR);\n        byte[] fullBuf = compressor.compress(TJ.FLAG_BOTTOMUP);\n        int actualSize = compressor.getCompressedSize();\n        return Arrays.copyOf(fullBuf, actualSize);\n    } finally {\n        if (compressor != null) {\n            compressor.close();\n        }\n    }\n}\n</code></pre>\n<p>I want to convert PNG to JPEG, and I need to use TJ.SAMP_420.</p>\n",
    "tags" : [ "java", "spring-boot", "libjpeg", "libjpeg-turbo" ],
    "owner" : {
      "account_id" : 35364655,
      "reputation" : 11,
      "user_id" : 27161059,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ea86ef19e626aacb528d7ee397afce40?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "shihui wei",
      "link" : "https://stackoverflow.com/users/27161059/shihui-wei"
    },
    "is_answered" : false,
    "view_count" : 89,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1748244690,
    "creation_date" : 1748244212,
    "link" : "https://stackoverflow.com/questions/79638478/how-to-use-libjpeg-in-java",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140458962,
    "post_id" : 79638478,
    "body" : "@seenukarthi They only seems to have an aarch64 build for Linux, not macOS.",
    "score" : 1,
    "owner" : {
      "account_id" : 213468,
      "reputation" : 110282,
      "user_id" : 466862,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d873f397779db38cd510d9ee5416fd43?s=256&d=identicon&r=PG",
      "display_name" : "Mark Rotteveel",
      "link" : "https://stackoverflow.com/users/466862/mark-rotteveel"
    },
    "creation_date" : 1748251186,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140458811,
    "post_id" : 79638478,
    "body" : "According to the site <a href=\"https://libjpeg-turbo.virtualgl.org/\" rel=\"nofollow noreferrer\">libjpeg-turbo.virtualgl.org</a>, libjpeg-turbo supports ARM systems. You may need to install the package.",
    "score" : 0,
    "owner" : {
      "account_id" : 551394,
      "reputation" : 8803,
      "user_id" : 916225,
      "user_type" : "registered",
      "accept_rate" : 69,
      "profile_image" : "https://www.gravatar.com/avatar/ba66e25b90b0c202ef0770f81391be97?s=256&d=identicon&r=PG",
      "display_name" : "seenukarthi",
      "link" : "https://stackoverflow.com/users/916225/seenukarthi"
    },
    "creation_date" : 1748248064,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140458704,
    "post_id" : 79638478,
    "body" : "It sounds like you need to ask whoever maintains TurboJPEG, to provide an ARM64 build of that dylib, right now you probably have an x86-64 (a.k.a. x64, a.k.a. AMD64) dylib.",
    "score" : 1,
    "owner" : {
      "account_id" : 213468,
      "reputation" : 110282,
      "user_id" : 466862,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d873f397779db38cd510d9ee5416fd43?s=256&d=identicon&r=PG",
      "display_name" : "Mark Rotteveel",
      "link" : "https://stackoverflow.com/users/466862/mark-rotteveel"
    },
    "creation_date" : 1748245414,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}