{
  "question" : {
    "question_id" : 79641501,
    "title" : "How to consistently retain an exact percentage of elements from a List in Java?",
    "body" : "<p>I'm currently filtering a Java List to keep approximately a percentage of its elements using a random approach:</p>\n<pre class=\"lang-java prettyprint-override\"><code>import java.util.List;\nimport java.util.Random;\n\npublic class Main {\n    public static void main(String[] args) {\n        List&lt;String&gt; list = List.of(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;10&quot;);\n\n        // Percentage of elements to retain (between 0 and 100)\n        int percentageToRetain = 30; // Change this value to adjust the percentage\n\n        Random random = new Random();\n        List&lt;String&gt; result = list.stream()\n                .filter(s -&gt; random.nextInt(100) &lt; percentageToRetain)\n                .toList();\n\n        System.out.println(result);\n    }\n}\n</code></pre>\n<p>While this works for approximating the percentage, each run produces different results, and the actual percentage retained can vary significantly from my target, especially with smaller lists.</p>\n<p>For example: When targeting 30% of a 10-element list, I might get 2 elements (20%) on one run and 4 elements (40%) on another.</p>\n<p>My question:\nHow can I modify my code to consistently retain exactly the specified percentage of elements from a List? Ideally, I'd like a solution that:</p>\n<ul>\n<li><p>Keeps exactly percentageToRetain percent of the elements (rounding on the lower as needed)</p>\n</li>\n<li><p>Still provides randomness in which specific elements are selected</p>\n</li>\n<li><p>Works efficiently for both small and large lists</p>\n</li>\n</ul>\n<p>How to handle this kind of &quot;exact percentage sampling&quot; problem?</p>\n",
    "tags" : [ "java", "arraylist", "sampling" ],
    "owner" : {
      "account_id" : 42233632,
      "reputation" : 53,
      "user_id" : 30654079,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/fc9a106b543709ab56eb7172027d7588?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "user30654079",
      "link" : "https://stackoverflow.com/users/30654079/user30654079"
    },
    "is_answered" : true,
    "view_count" : 170,
    "answer_count" : 3,
    "score" : 5,
    "last_activity_date" : 1748434726,
    "creation_date" : 1748406438,
    "link" : "https://stackoverflow.com/questions/79641501/how-to-consistently-retain-an-exact-percentage-of-elements-from-a-list-in-java",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79641715,
    "question_id" : 79641501,
    "body" : "<h1>Your Approach</h1>\n<p>@<a href=\"https://stackoverflow.com/users/20882864/marce-puente\">Marce Puente</a> correctly points outin the question comments that retaining an exact percentage of elements is impossible, at least for smaller list sizes.</p>\n<blockquote>\n<p>the idea of “exact percentage” is already wrong, imagine such a list: [ 10, 5, 1 ] and you want to keep it to *50%, what would you put, an item and a half, no, you have to set a tolerance, which will be determined by the number of item's.</p>\n</blockquote>\n<p>For larger input sizes the rounding error decreases.</p>\n<p>Another problem, as <a href=\"https://stackoverflow.com/users/11294831/the-busybee\">the busybee</a> pointed out, is that discarding elements with a chance is not guranteed to return a stable amount of elements.</p>\n<p>To illustrate that, here are 10 sets of random numbers between 0 and 100 (I noted the number of elements that would be retained given <code>percentageToRetain = 30</code> in brackets):</p>\n<pre class=\"lang-none prettyprint-override\"><code>0 64 93 11 77 13 82 87 8 68 (4 retains)\n77 60 39 97 64 46 33 42 87 79 (0 retains)\n26 91 0 32 49 31 15 7 2 7 (5 retains)\n95 90 38 10 70 37 32 17 82 98 (2 retains)\n11 43 96 58 10 40 30 4 40 54 (3 retains)\n2 66 86 87 17 88 92 64 10 79 (4 retains)\n3 86 75 51 30 37 2 96 49 89 (2 retains)\n9 10 23 84 52 28 32 14 12 33 (5 retains)\n53 91 54 66 28 61 67 35 45 70 (1 retains)\n3 77 79 24 37 60 6 80 8 39 (4 retains)\n</code></pre>\n<h1>My suggestion</h1>\n<ol>\n<li>calculate the.number of elements you wish to retain: <code>int numberOfElementsToRetain = (int) (source.size() * percentageToRetain / 100.0);</code></li>\n<li>make a copy of the input list to a known mutable type (you can skip this step if the input is guranteed to be mutable &amp; you don't mind ruining it)</li>\n<li><a href=\"https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/Collections.html#shuffle(java.util.List)\" rel=\"noreferrer\">shuffle it</a></li>\n<li>copy the first <code>numberOfElementsToRetain</code> elements to a new list &amp; return that.</li>\n</ol>\n<p>Thus we get:</p>\n<pre><code>public static &lt;E&gt; List&lt;E&gt; retainNumberOfElementsRandomly2(List&lt;E&gt; source, int percentageToRetain){\n    int numberOfElementsToRetain = (int) (source.size() * percentageToRetain / 100.0);\n    ArrayList&lt;E&gt; defcopy = new ArrayList&lt;&gt;(source);\n    \n    Random r = new Random();\n    \n    Collections.shuffle(defcopy, r);\n\n    List&lt;E&gt; result = new ArrayList&lt;&gt;(numberOfElementsToRetain);\n    \n    for(int i = 0; i &lt; numberOfElementsToRetain; i++){\n        result.add(defcopy.get(i));\n    }\n    \n    return result;\n}\n</code></pre>\n",
    "score" : 6,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 30223964,
      "reputation" : 252,
      "user_id" : 23162960,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2451acfac254a6fc75757ecf89d75f9a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jannik S.",
      "link" : "https://stackoverflow.com/users/23162960/jannik-s"
    },
    "creation_date" : 1748417531,
    "last_activity_date" : 1748417531,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79641884,
    "question_id" : 79641501,
    "body" : "<p>This algorithm preserves ordering of entries. The percentage to keep is adjusted by the number of items selected so far. Consider list size 10 and percentage 30.0 - this suggests retaining 3 elements. If first item was kept (with percent 30.0), the ratio of subsequent items needed is now <code>(retain - kept.size()) / (list.size() - 1)</code> =&gt; 22.22%. Whereas, if first item was not retained the second item choice is <code>(retain - kept.size()) / (list.size() - 1)</code> =&gt; 33.33% And so on:</p>\n<pre><code>List&lt;String&gt; list = List.of(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;10&quot;);\ndouble percentageToRetain = 30.0; // Change this value to adjust the percentage\ndouble retain = percentageToRetain / 100.0 * list.size();\n\nArrayList&lt;String&gt; result = new ArrayList&lt;&gt;((int)Math.ceil(retain));\nfor (int i = 0, sz = list.size(); i &lt; sz; i++) {\n    double pc =  (retain - result.size()) / (list.size()-i);\n    if (random.nextDouble() &lt; pc)\n        result.add(list.get(i));\n}\nSystem.out.println(percentageToRetain+&quot;% #&quot;+result.size()+&quot; = &quot;+result);\n</code></pre>\n<p>This leads to lists sized close to the rounded value of <code>retain</code>. However, it may not be quite as random as other methods - such as the shuffle approach - because it adjusts the selection based on the earlier results. If too many items are selected early, fewer of the tail are included, and vice versa.</p>\n",
    "score" : 2,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 5998820,
      "reputation" : 16283,
      "user_id" : 4712734,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f6e922a2cb7e2da59286f27b162aaca5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "DuncG",
      "link" : "https://stackoverflow.com/users/4712734/duncg"
    },
    "creation_date" : 1748423688,
    "last_activity_date" : 1748426798,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79641504,
    "question_id" : 79641501,
    "body" : "<p>I'm not a Java guy, but this is a fairly simple algorithm to implement.</p>\n<ol>\n<li>Calculate how many elements you want to save.  You can use the percentage for this of course, but we want an actual number at the end of the day.  Something along the lines of <code>var resultSize = list.size() * .3</code>.</li>\n<li>Start by copying the first <code>resultSize</code> elements into <code>result</code>.  This seeds your result with the number you want.</li>\n<li>Iterate over the remaining elements and roll a random number between 0 and <code>list.size()</code>.  If it's less than <code>resultSize</code>, you replace the existing value in <code>result[index]</code> (<code>List</code> probably lacks random access, so adjust as needed).  It ensures that every element has an equal chance of making it into the final result.</li>\n</ol>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 71330,
      "reputation" : 8028,
      "user_id" : 206404,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/JcgIf.png?s=256",
      "display_name" : "Stephen Newell",
      "link" : "https://stackoverflow.com/users/206404/stephen-newell"
    },
    "creation_date" : 1748406674,
    "last_activity_date" : 1748434726,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140464854,
    "post_id" : 79641501,
    "body" : "What are your constraints about list size, is the initial list a mutable one and so on? Calculating the required number of elements and rounding down is easy, but depending on the constraints you may use the standard library, or you may need to write your own algorithm.",
    "score" : 0,
    "owner" : {
      "account_id" : 23783500,
      "reputation" : 7109,
      "user_id" : 17795888,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Xay1V.jpg?s=256",
      "display_name" : "Chaosfire",
      "link" : "https://stackoverflow.com/users/17795888/chaosfire"
    },
    "creation_date" : 1748414855,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140464707,
    "post_id" : 79641501,
    "body" : "Random numbers are exactly that, random. With a set of 10 and therefore 10 rolls of the dice, you cannot expect equally spread results. For better understanding, write a little test program to print 10 random numbers in the range 0 to 99.",
    "score" : 1,
    "owner" : {
      "account_id" : 15654001,
      "reputation" : 13190,
      "user_id" : 11294831,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/M9BL5.png?s=256",
      "display_name" : "the busybee",
      "link" : "https://stackoverflow.com/users/11294831/the-busybee"
    },
    "creation_date" : 1748410948,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140464647,
    "post_id" : 79641501,
    "body" : "Hi user, welcome, the idea of “exact percentage” is already wrong, imagine such a list: <b>[ 10, 5, 1 ]</b> and you want to keep it to <i>*50%</i>, what would you put, an item and a half, no, you have to set a tolerance, which will be determined by the number of item&#39;s.",
    "score" : 1,
    "owner" : {
      "account_id" : 10843443,
      "reputation" : 916,
      "user_id" : 20882864,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/CCQCy.jpg?s=256",
      "display_name" : "Marce Puente",
      "link" : "https://stackoverflow.com/users/20882864/marce-puente"
    },
    "creation_date" : 1748408647,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79641715" : [ {
      "comment_id" : 140465386,
      "post_id" : 79641715,
      "body" : "Nice, could return <code>defcopy.subList(0, numberOfElementsToRetain)</code> or wrapped with <code>List.copyOf()</code>",
      "score" : 0,
      "owner" : {
        "account_id" : 5998820,
        "reputation" : 16283,
        "user_id" : 4712734,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/f6e922a2cb7e2da59286f27b162aaca5?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "DuncG",
        "link" : "https://stackoverflow.com/users/4712734/duncg"
      },
      "creation_date" : 1748424818,
      "content_license" : "CC BY-SA 4.0"
    } ],
    "79641504" : [ {
      "comment_id" : 140465924,
      "post_id" : 79641504,
      "body" : "@JannikS. - That&#39;s what I get for coming on stack overflow when I can&#39;t fall asleep.  Thanks, fixed.",
      "score" : 0,
      "owner" : {
        "account_id" : 71330,
        "reputation" : 8028,
        "user_id" : 206404,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/JcgIf.png?s=256",
        "display_name" : "Stephen Newell",
        "link" : "https://stackoverflow.com/users/206404/stephen-newell"
      },
      "creation_date" : 1748434767,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140465090,
      "post_id" : 79641504,
      "body" : "The third point should probbably be &quot;Iterate over the remaining elements and roll a random number between 0 and <code>list.size()</code> [...]&quot;. As written, 10 has a guranteed chance to make it into the list - *somewhere. *",
      "score" : 1,
      "owner" : {
        "account_id" : 30223964,
        "reputation" : 252,
        "user_id" : 23162960,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/2451acfac254a6fc75757ecf89d75f9a?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Jannik S.",
        "link" : "https://stackoverflow.com/users/23162960/jannik-s"
      },
      "creation_date" : 1748419700,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140464629,
      "post_id" : 79641504,
      "body" : "sounds good actually. May I ask if you have a snippet?",
      "score" : 0,
      "owner" : {
        "account_id" : 42233632,
        "reputation" : 53,
        "user_id" : 30654079,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/fc9a106b543709ab56eb7172027d7588?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "user30654079",
        "link" : "https://stackoverflow.com/users/30654079/user30654079"
      },
      "creation_date" : 1748407592,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}