{
  "question" : {
    "question_id" : 79539531,
    "title" : "How to switch to the new window which immediately throws an alert?",
    "body" : "<p>I'm trying to automate a scenario where I click on an action that launches a pop up window, but this new window doesn't load, because it throws a browser alert (that's expected).</p>\n<p><a href=\"https://i.sstatic.net/A2TtgXY8.png\" rel=\"nofollow noreferrer\">Alert</a></p>\n<p>I need to verify that this alert is presented. This is my code:</p>\n<pre><code>WebDriver driver = SeleniumSession.get().getWrappedDriver();\nList&lt;String&gt; handles = new ArrayList&lt;String&gt;(driver.getWindowHandles());\n\nint i = 0;\nfor (String handle : handles) {\n    if (i == 1) {\n        driver.switchTo().window(handle);\n        Alert alert = driver.switchTo().alert();\n        alert.accept();\n    }\n    i++;\n}\n</code></pre>\n<p>The problem I have is that I'm getting a TimeoutException on this line:</p>\n<p><code>List&lt;String&gt; handles = new ArrayList&lt;String&gt;(driver.getWindowHandles());</code></p>\n<p>Exception:</p>\n<p><code>org.openqa.selenium.TimeoutException: java.util.concurrent.TimeoutException</code></p>\n<p>The same problem was described in this <a href=\"https://stackoverflow.com/questions/57998546/how-do-i-access-an-alert-on-a-new-window-when-the-window-hasnt-loaded-anything\">thread</a>. Unfortunately, there was no solution to this issue and due to the lack of reputation I couldn't comment there.</p>\n<p>I tried multiple solutions.</p>\n<ul>\n<li>I inserted implicit wait before getting window handles to make sure the content is there.</li>\n<li>I tried try-catch block on the getWindowHandles to repeat the operation in the catch block.</li>\n<li>I tried to retrieve the alert without switching to the new window.</li>\n</ul>\n<p>Unfortunately each time I got the TimeoutException.</p>\n",
    "tags" : [ "java", "selenium-webdriver", "alert" ],
    "owner" : {
      "account_id" : 41022792,
      "reputation" : 11,
      "user_id" : 30081304,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/564384d2dbabfc25b520e3d61557bd6e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Tisaja",
      "link" : "https://stackoverflow.com/users/30081304/tisaja"
    },
    "is_answered" : false,
    "view_count" : 55,
    "answer_count" : 2,
    "score" : 1,
    "last_activity_date" : 1743161236,
    "creation_date" : 1743093746,
    "link" : "https://stackoverflow.com/questions/79539531/how-to-switch-to-the-new-window-which-immediately-throws-an-alert",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79539588,
    "question_id" : 79539531,
    "body" : "<p>From what you are describing, the new window never shows up so you can't switch to a new window if it doesn't exist. You should be able to confirm that the correct alert dialog is up, dismiss it, and end the test or whatever.</p>\n<p>Something like the below should work...</p>\n<pre><code>WebDriver driver = SeleniumSession.get().getWrappedDriver();\n// click the action\nWebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));\nAlert alert = wait.until(ExpectedConditions.alertIsPresent());\n// Assert alert.getText() to validate the alert message\n// alert.accept() the alert\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 2772450,
      "reputation" : 26443,
      "user_id" : 2386774,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/dea7da142cb7e85d5d5a8576e2625431?s=256&d=identicon&r=PG",
      "display_name" : "JeffC",
      "link" : "https://stackoverflow.com/users/2386774/jeffc"
    },
    "creation_date" : 1743095500,
    "last_activity_date" : 1743095500,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79541298,
    "question_id" : 79539531,
    "body" : "<p>I was able to make the test pass with this code:</p>\n<pre><code>boolean result = false;\n        \n        try {\n            WebDriver driver = SeleniumSession.get().getWrappedDriver();\n            ArrayList&lt;String&gt; handles = new ArrayList&lt;String&gt;(driver.getWindowHandles());\n            \n            int i = 0;\n            for (String handle : handles) {\n                if(i == 1 ) {\n                    driver.switchTo().window(handle);\n                    Alert alert  = driver.switchTo().alert();\n                    alert.accept();\n                    result = true;\n                }\n                \n                i++;\n            }         \n        } catch(TimeoutException | UnhandledAlertException e) {\n            result = true;\n        }\n</code></pre>\n<p>I don't like it, because I have to wait 160 seconds for the timeout to be thrown, but so far that's the only way to handle it.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 41022792,
      "reputation" : 11,
      "user_id" : 30081304,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/564384d2dbabfc25b520e3d61557bd6e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Tisaja",
      "link" : "https://stackoverflow.com/users/30081304/tisaja"
    },
    "creation_date" : 1743161236,
    "last_activity_date" : 1743161236,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140272942,
    "post_id" : 79539531,
    "body" : "I guess that&#39;s the only option :/ I don&#39;t like this solution, because it takes a lot of time until the TimeoutException is thrown. But I can make the test pass with this try-catch.",
    "score" : 0,
    "owner" : {
      "account_id" : 41022792,
      "reputation" : 11,
      "user_id" : 30081304,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/564384d2dbabfc25b520e3d61557bd6e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Tisaja",
      "link" : "https://stackoverflow.com/users/30081304/tisaja"
    },
    "creation_date" : 1743152529,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140271423,
    "post_id" : 79539531,
    "body" : "since the default unHandledPromptBehaviour is &quot;Dismiss and Notify&quot; (dismiss closes the alert, notify throws an exception) you can simply try/catch the next driver call. (in this case it&#39;s switching to the new tab/window) If you catch the unexpected alert exception, you know that there was an alert there. You can then switch to it again.  You could also change the unHandledPromptBehaviour of the driver so that it doesn&#39;t &quot;notify&quot; or &quot;dismiss&quot; if you wanted to interact with the alert instead.",
    "score" : 0,
    "owner" : {
      "account_id" : 6077817,
      "reputation" : 1362,
      "user_id" : 4744568,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/125cdb7d43927756913b920de016f420?s=256&d=identicon&r=PG",
      "display_name" : "browsermator",
      "link" : "https://stackoverflow.com/users/4744568/browsermator"
    },
    "creation_date" : 1743106784,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79539588" : [ {
      "comment_id" : 140271097,
      "post_id" : 79539588,
      "body" : "There is a Selenium discord channel. You might join and ask this question there. This might be a design issue that they need to address.",
      "score" : 0,
      "owner" : {
        "account_id" : 2772450,
        "reputation" : 26443,
        "user_id" : 2386774,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/dea7da142cb7e85d5d5a8576e2625431?s=256&d=identicon&r=PG",
        "display_name" : "JeffC",
        "link" : "https://stackoverflow.com/users/2386774/jeffc"
      },
      "creation_date" : 1743100623,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140271093,
      "post_id" : 79539588,
      "body" : "So you tried the code I posted and it didn&#39;t work? What was the error?",
      "score" : 0,
      "owner" : {
        "account_id" : 2772450,
        "reputation" : 26443,
        "user_id" : 2386774,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/dea7da142cb7e85d5d5a8576e2625431?s=256&d=identicon&r=PG",
        "display_name" : "JeffC",
        "link" : "https://stackoverflow.com/users/2386774/jeffc"
      },
      "creation_date" : 1743100541,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140271047,
      "post_id" : 79539588,
      "body" : "That&#39;s not quite the case. A new window is opened, just its content is not loaded. The content is not loaded, because the alert is shown in that new window. I tried to accept the alert without switching to the new window context, but it didn&#39;t work and tbh I&#39;m not surprised.",
      "score" : 0,
      "owner" : {
        "account_id" : 41022792,
        "reputation" : 11,
        "user_id" : 30081304,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/564384d2dbabfc25b520e3d61557bd6e?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Tisaja",
        "link" : "https://stackoverflow.com/users/30081304/tisaja"
      },
      "creation_date" : 1743099797,
      "content_license" : "CC BY-SA 4.0"
    } ],
    "79541298" : [ {
      "comment_id" : 140277620,
      "post_id" : 79541298,
      "body" : "JeffC - I have to wait 160 s, because that&#39;s the time after which the TimeoutException is thrown. I&#39;m catching also the UnexpectedAlertException, because very rarely (I guess when the new window opens very fast) I get this error, but in most cases I get the timeout. I&#39;m afraid this particular timeout value might be a result of the code which lies deeper in the methods we use, because unfortunately we do not operate on pure Selenium, but on some prewritten classes which I cannot even investigate.",
      "score" : 0,
      "owner" : {
        "account_id" : 41022792,
        "reputation" : 11,
        "user_id" : 30081304,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/564384d2dbabfc25b520e3d61557bd6e?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Tisaja",
        "link" : "https://stackoverflow.com/users/30081304/tisaja"
      },
      "creation_date" : 1743274048,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140275077,
      "post_id" : 79541298,
      "body" : "Make sure to try/catch only the switch call, and only to the new handle.  Catching the unexpected alert error is the only way to know there is an alert present.  The timeout would be for something else.   So be sure to get the current window handle, do the action that opens new tab/window, then get all handles, iterate through handles and check for the one that is not the current.  Then switch to that one only.  try/catch on the switch call...  check exception to be sure it&#39;s unhandled alert (not real sure if that tells you which window has the alert though)",
      "score" : 0,
      "owner" : {
        "account_id" : 6077817,
        "reputation" : 1362,
        "user_id" : 4744568,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/125cdb7d43927756913b920de016f420?s=256&d=identicon&r=PG",
        "display_name" : "browsermator",
        "link" : "https://stackoverflow.com/users/4744568/browsermator"
      },
      "creation_date" : 1743186228,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140274780,
      "post_id" : 79541298,
      "body" : "Why do you have to wait 160s? Also, you could very easily get a false positive here for any other <code>TimeoutException</code>, etc. that isn&#39;t the exact one you are expecting.",
      "score" : 0,
      "owner" : {
        "account_id" : 2772450,
        "reputation" : 26443,
        "user_id" : 2386774,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/dea7da142cb7e85d5d5a8576e2625431?s=256&d=identicon&r=PG",
        "display_name" : "JeffC",
        "link" : "https://stackoverflow.com/users/2386774/jeffc"
      },
      "creation_date" : 1743181293,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}