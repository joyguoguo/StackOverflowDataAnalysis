{
  "question" : {
    "question_id" : 79643706,
    "title" : "Creating authentication server endpoint compatible with spring.security.oauth2.resourceserver.jwt.jwk-set-uri",
    "body" : "<p>I have an authentication server that issues JWT tokens. It uses the <code>io.jsonwebtoken</code> library (a plain Security starter is also available).</p>\n<pre class=\"lang-xml prettyprint-override\"><code>    &lt;parent&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n        &lt;version&gt;3.2.2&lt;/version&gt;\n        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;\n    &lt;/parent&gt;\n\n&lt;!-- ... --&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;\n            &lt;artifactId&gt;jjwt-api&lt;/artifactId&gt;\n            &lt;version&gt;${jsonwebtoken.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;\n            &lt;artifactId&gt;jjwt-impl&lt;/artifactId&gt;\n            &lt;version&gt;${jsonwebtoken.version}&lt;/version&gt;\n            &lt;scope&gt;runtime&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;\n            &lt;artifactId&gt;jjwt-jackson&lt;/artifactId&gt;\n            &lt;version&gt;${jsonwebtoken.version}&lt;/version&gt;\n            &lt;scope&gt;runtime&lt;/scope&gt;\n        &lt;/dependency&gt;\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>import io.jsonwebtoken.Jwts;\nimport org.springframework.stereotype.Service;\n\nimport java.security.KeyPair;\nimport java.sql.Date;\nimport java.time.DayOfWeek;\nimport java.time.LocalDate;\n\n@Service\npublic class JwtTokenService implements TokenService {\n\n    private final KeyPair keyPair;\n\n    public JwtTokenService(KeyPair keyPair) {\n        this.keyPair = keyPair;\n    }\n\n    @Override\n    public String generateTokenFor(User user) {\n        return Jwts.builder()\n                .setSubject(user.getName())\n                .claim(AppClaims.USERID, user.getId())\n                .setExpiration(Date.valueOf(LocalDate.now()\n                        .plusDays(DayOfWeek.values().length)))\n                .signWith(keyPair.getPrivate())\n                .compact();\n    }\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>    @Bean\n    public KeyPair keyPair() {\n        return Keys.keyPairFor(SignatureAlgorithm.RS256);\n    }\n</code></pre>\n<p>I also have a client that relies on the Spring OAuth2 starter:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>    &lt;parent&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n        &lt;version&gt;3.4.5&lt;/version&gt;\n        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;\n    &lt;/parent&gt;\n\n&lt;!-- ... --&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-oauth2-resource-server&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n</code></pre>\n<p>At this point, the client knows the authentication server's private key and uses it to decode the server's JWTs. A better approach would be for the client to fetch the authentication server's public key and use it instead. My understanding is all I need to do on the client's side is to specify this property:</p>\n<pre class=\"lang-none prettyprint-override\"><code>spring.security.oauth2.resourceserver.jwt.jwk-set-uri = ${JWK_SET_URI:http://localhost:8100/oauth2/jwks}\n</code></pre>\n<p>Spring Boot, I believe, will create a <code>JwtDecoder</code> bean for me that would hit that endpoint (a <code>GET</code> with no params or path variables, I assume) and retrieve a public key to decode incoming JWTs.</p>\n<p>My authentication server doesn't have such an endpoint yet. But it is happy to.</p>\n<p>The question is, what is such an endpoint expected to return, and how do I create such an object, preferably using the already available <code>io.jsonwebtoken</code> dependency (as opposed to switching to <code>nimbusds</code>, etc.)?</p>\n<p>The <a href=\"https://auth0.com/docs/secure/tokens/json-web-tokens/json-web-key-sets\" rel=\"nofollow noreferrer\">doc</a> refers to <a href=\"https://datatracker.ietf.org/doc/html/rfc7517#section-3\" rel=\"nofollow noreferrer\">RFC-7517</a>. Apparently, my endpoint is supposed to return something like this:</p>\n<pre class=\"lang-json prettyprint-override\"><code>{\n  keys: [\n    {\n      &quot;kty&quot;:&quot;EC&quot;,\n      &quot;crv&quot;:&quot;P-256&quot;,\n      &quot;x&quot;:&quot;f83OJ3D2xF1Bg8vub9tLe1gHMzV76e8Tus9uPHvRVEU&quot;,\n      &quot;y&quot;:&quot;x_FEzRu9m36HLN_tue659LNpXW6pCyStikYjKIWI5a0&quot;,\n      &quot;kid&quot;:&quot;Public key used in JWS spec Appendix A.3 example&quot;\n    }\n  ]\n}\n</code></pre>\n",
    "tags" : [ "java", "spring", "spring-boot", "jwt", "spring-oauth2" ],
    "owner" : {
      "account_id" : 10187542,
      "reputation" : 2681,
      "user_id" : 20692967,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
      "display_name" : "Sergey Zolotarev",
      "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
    },
    "is_answered" : false,
    "view_count" : 39,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1748514703,
    "creation_date" : 1748512972,
    "link" : "https://stackoverflow.com/questions/79643706/creating-authentication-server-endpoint-compatible-with-spring-security-oauth2-r",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}