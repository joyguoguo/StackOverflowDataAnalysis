{
  "question" : {
    "question_id" : 79669192,
    "title" : "Annotate JUnit @Test case with custom aspect annotation",
    "body" : "<p>Spring beginner here.</p>\n<p>I am making two custom annotations @Satisfy and @Verify, meant to be used to track\nrequirements in code.</p>\n<ul>\n<li>@Satisfy denotes where the requirement is implemented</li>\n<li>@Verify denotes where the requirement is tested, e.g. in a junit test case</li>\n</ul>\n<p>Each of them have a corresponding @Aspect, which in this snippet just prints a message, but in reality they are used to POST update to gitlab API in order to label requirement issues in gitlab as &quot;satisfied&quot; or &quot;verified&quot;.</p>\n<p>The @Satisfy aspect is working, it is annotated in the class which implements the required code e.g. the class Addition.</p>\n<p>The @Verify aspect is not being called from the JUnit @Test case, as I don't know how to do this. I spent the entire day googling for solutions, and i suspect that aspects might not be able to be used in test cases ?</p>\n<p>To sum up:</p>\n<ul>\n<li>@Satisfy is called from program code, and works</li>\n<li>@Verify should be called in testcase, to validate the code annotated by @Satisfy\nbut it doesnt work.</li>\n</ul>\n<p>Satisfy:</p>\n<pre><code>package com.example.demo;\n\nimport java.lang.annotation.ElementType;\nimport java.lang.annotation.Retention;\nimport java.lang.annotation.RetentionPolicy;\nimport java.lang.annotation.Target;\n\n@Retention(RetentionPolicy.RUNTIME) // The annotation will be available at runtime\n@Target(ElementType.METHOD)         // This annotation can only be applied to methods\npublic @interface Satisfy\n{\n    String requirementId() default &quot;No requirementId provided&quot;;\n}\n</code></pre>\n<p>Verify:</p>\n<pre><code>package com.example.demo;\n\nimport java.lang.annotation.ElementType;\nimport java.lang.annotation.Retention;\nimport java.lang.annotation.RetentionPolicy;\nimport java.lang.annotation.Target;\n\n@Retention(RetentionPolicy.RUNTIME) // The annotation will be available at runtime\n@Target(ElementType.METHOD)         // This annotation can only be applied to methods\npublic @interface Verify\n{\n    String requirementId() default &quot;No requirementId provided&quot;;\n}\n</code></pre>\n<p>SatisfyAspect:</p>\n<pre><code>package com.example.demo;\n\nimport java.net.URI;\nimport java.net.http.HttpClient;\nimport java.net.http.HttpRequest;\nimport java.net.http.HttpResponse;\n\nimport org.aspectj.lang.ProceedingJoinPoint;\nimport org.aspectj.lang.annotation.Around;\nimport org.aspectj.lang.annotation.Aspect;\nimport org.aspectj.lang.reflect.MethodSignature;\nimport org.springframework.stereotype.Component;\n\nimport com.fasterxml.jackson.databind.JsonNode;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport com.fasterxml.jackson.databind.node.ArrayNode;\nimport com.fasterxml.jackson.databind.node.ObjectNode;\n\nimport java.lang.reflect.Method;\n\n\n\n@Aspect\n@Component\npublic class SatisfyAspect\n{\n    @Around(&quot;@annotation(com.example.demo.Satisfy)&quot;)\n    public Object logExecutionTime(ProceedingJoinPoint joinPoint) throws Throwable\n    {\n        System.out.println(&quot;ENTER SatisfyAspect&quot;);\n        Object proceed = joinPoint.proceed();\n        return proceed;\n    }\n}\n</code></pre>\n<p>VerifyAspect:</p>\n<pre><code>package com.example.demo;\n\nimport java.net.URI;\nimport java.net.http.HttpClient;\nimport java.net.http.HttpRequest;\nimport java.net.http.HttpResponse;\nimport org.aspectj.lang.ProceedingJoinPoint;\nimport org.aspectj.lang.annotation.Around;\nimport org.aspectj.lang.annotation.Aspect;\nimport org.aspectj.lang.reflect.MethodSignature;\nimport org.springframework.stereotype.Component;\nimport com.fasterxml.jackson.databind.JsonNode;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport com.fasterxml.jackson.databind.node.ArrayNode;\nimport com.fasterxml.jackson.databind.node.ObjectNode;\nimport java.lang.reflect.Method;\n\n@Aspect\n@Component\npublic class VerifyAspect\n{\n    @Around(&quot;@annotation(com.example.demo.Verify)&quot;)\n    public Object verify(ProceedingJoinPoint joinPoint) throws Throwable\n    {\n        System.out.println(&quot;ENTER VerifyAspect&quot;);\n        Object proceed = joinPoint.proceed();\n        return proceed;\n    }\n}\n</code></pre>\n<p>Addition class with add requirement:\nThe requirementId is composed of gilab projectid - issue iid</p>\n<pre><code>package com.example.demo;\n\nimport org.springframework.stereotype.Component;\n\n@Component\npublic class Addition\n{\n    @Satisfy(requirementId=&quot;12345678-1&quot;)    \n    int add(int a, int b)\n    {\n        return a + b;\n    }\n}\n</code></pre>\n<p>TestApplication:</p>\n<pre><code>package com.example.demo;\n\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\n\n@SpringBootTest\nclass DemoApplicationTests\n{\n    @Autowired\n    private Addition addition;\n\n    @Test\n    void contextLoads()\n    {\n    }\n\n    @Test\n    @Verify(requirementId=&quot;12345678-1&quot;)\n    void testAdd()\n    {\n        assert(addition.add(1, 2) == 3);\n    }\n}\n</code></pre>\n",
    "tags" : [ "java", "spring", "junit", "annotations", "aspect" ],
    "owner" : {
      "account_id" : 8759884,
      "reputation" : 13,
      "user_id" : 6550106,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c9f3475a85cde9af116f72dc6fb0eef9?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Kurt Andersen",
      "link" : "https://stackoverflow.com/users/6550106/kurt-andersen"
    },
    "is_answered" : true,
    "view_count" : 52,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1750172918,
    "creation_date" : 1750167547,
    "link" : "https://stackoverflow.com/questions/79669192/annotate-junit-test-case-with-custom-aspect-annotation",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79669340,
    "question_id" : 79669192,
    "body" : "<p>JUnit test classes are not Spring classes, their life cycles are not managed by Spring Boot but by JUnit.</p>\n<p>The way to do things like this in JUnit is with extensions and callbacks. In this case I think that a <code>BeforeEachCallback</code> and/or <code>AfterEachCallback</code> is probably the solution.</p>\n<p>The first thing to do is write the extension. For example:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class VerifyExtension implements BeforeEachCallback, AfterEachCallback {\n    @Override\n    public void beforeEach(ExtensionContext context) {\n        context.getTestMethod()\n                .map(method -&gt; method.getAnnotation(Verify.class))\n                .ifPresent(verify -&gt; System.out.printf(&quot;ENTER Verify: %s%n&quot;, verify.requirementId()));\n    }\n\n    @Override\n    public void afterEach(ExtensionContext context) {\n        context.getTestMethod()\n                .map(method -&gt; method.getAnnotation(Verify.class))\n                .ifPresent(verify -&gt; System.out.printf(&quot;EXIT Verify: %s%n&quot;, verify.requirementId()));\n    }\n}\n</code></pre>\n<p>The next thing to do is automatically activate the extension when a test method is annotated with <code>@Verify</code>. Otherwise users would have to explicitly annotate the class or method with <code>@ExtendWith(VerifyExtension.class)</code>.  That's easy enough to do: just add that annotation to <code>@Verify</code>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Retention(RetentionPolicy.RUNTIME)\n@Target(ElementType.METHOD)\n@ExtendWith(VerifyExtension.class)  // This line is new\npublic @interface Verify\n{\n    String requirementId() default &quot;No requirementId provided&quot;;\n}\n</code></pre>\n<p>There is a drawback though. Because the life cycles of Spring Boot and JUnit are not tied together, you can't inject anything in your extension class. Fortunately, <code>SpringExtension</code> exposes this method which should give you programmatic access to beans:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public static ApplicationContext getApplicationContext(ExtensionContext context)\n</code></pre>\n<p>This of course only works in combination with <code>SpringExtension</code>, but that's automatically activated when you use <code>@SpringBootTest</code>.</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 1211967,
      "reputation" : 9964,
      "user_id" : 1180351,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/pKB8y.png?s=256",
      "display_name" : "Rob Spoor",
      "link" : "https://stackoverflow.com/users/1180351/rob-spoor"
    },
    "creation_date" : 1750172918,
    "last_activity_date" : 1750172918,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79669340" : [ {
      "comment_id" : 140524571,
      "post_id" : 79669340,
      "body" : "You&#39;re welcome.",
      "score" : 0,
      "owner" : {
        "account_id" : 1211967,
        "reputation" : 9964,
        "user_id" : 1180351,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/pKB8y.png?s=256",
        "display_name" : "Rob Spoor",
        "link" : "https://stackoverflow.com/users/1180351/rob-spoor"
      },
      "creation_date" : 1750267646,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140522513,
      "post_id" : 79669340,
      "body" : "Thank you so much @rob-spoor, this solved my problem - very much appreciated !",
      "score" : 0,
      "owner" : {
        "account_id" : 8759884,
        "reputation" : 13,
        "user_id" : 6550106,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/c9f3475a85cde9af116f72dc6fb0eef9?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Kurt Andersen",
        "link" : "https://stackoverflow.com/users/6550106/kurt-andersen"
      },
      "creation_date" : 1750224837,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}