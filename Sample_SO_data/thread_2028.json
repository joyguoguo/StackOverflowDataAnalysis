{
  "question" : {
    "question_id" : 79653969,
    "title" : "Mule 4.9 JMS appender error: Modules javax.jms.api and jakarta.jms.api export package javax.jms to module org.eclipse.sisu.inject",
    "body" : "<p>I am new to mule and trying to push logs to activemq queue using jms appender. I was getting error while using jms appender with mule 4.3</p>\n<pre><code>2025-06-05T07:02:25.588889200Z WrapperListener_start_runner ERROR Could not create plugin of type class org.apache.logging.log4j.core.appender.mom.JmsAppender for element JMS: java.lang.NoClassDefFoundError: javax/jms/JMSException java.lang.reflect.InvocationTargetException\nat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\nat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\n2025-06-05T07:02:25.590884400Z WrapperListener_start_runner ERROR Unable to invoke factory method in class org.apache.logging.log4j.core.appender.mom.JmsAppender for element JMS: java.lang.IllegalStateException: No factory method found for class org.apache.logging.log4j.core.appender.mom.JmsAppender java.lang.IllegalStateException: No factory method found for class org.apache.logging.log4j.core.appender.mom.JmsAppender\nat org.apache.logging.log4j.core@2.24.2/org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.findFactoryMethod(PluginBuilder.java:268)\nat org.apache.logging.log4j.core@2.24.2/org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:140)\n</code></pre>\n<p>then i did some research and found the solution. The solution was to add javax.jms-api.2.0.1.jar to mule/lib/boot folder and the error got resolved.</p>\n<p>But after upgrading the mule app from 4.3 to 4.9 version i am getting another error</p>\n<pre><code>WrapperManager: Initializing...\n\nRunning Mule in testing mode\n\njava.lang.module.ResolutionException: Modules javax.jms.api and jakarta.jms.api export package javax.jms to module org.apache.maven.resolver.transport.wagon\n\n    at java.base/java.lang.module.Resolver.resolveFail(Resolver.java:901)\n\n    at java.base/java.lang.module.Resolver.failTwoSuppliers(Resolver.java:815)\n\n    at java.base/java.lang.module.Resolver.checkExportSuppliers(Resolver.java:736)\n</code></pre>\n<p>what i understood from this error that both javax.jms and jakarta.jms exporting the same package, but i am not using jakarta.jms dependency in my mule app. I don't know if mule 4.9 is adding during runtime.</p>\n<p>So If I am removing javax.jms-api jar from boot folder then i am getting NoClassDeFoundError but if I am adding javax.jms-api then I am getting the above error where javax conflicting with jakarta.</p>\n<p>So the solution wokring with mule 4.3 is not working with mule 4.9.</p>\n<p>example app:</p>\n<p>pom.xml</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n\n    &lt;groupId&gt;com.mycompany&lt;/groupId&gt;\n    &lt;artifactId&gt;test&lt;/artifactId&gt;\n    &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;\n    &lt;packaging&gt;mule-application&lt;/packaging&gt;\n\n    &lt;name&gt;test&lt;/name&gt;\n\n    &lt;properties&gt;\n        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;\n        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;\n\n        &lt;app.runtime&gt;4.4.0-20230320&lt;/app.runtime&gt;\n        &lt;mule.maven.plugin.version&gt;3.8.2&lt;/mule.maven.plugin.version&gt;\n    &lt;/properties&gt;\n\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                &lt;artifactId&gt;maven-clean-plugin&lt;/artifactId&gt;\n                &lt;version&gt;3.2.0&lt;/version&gt;\n            &lt;/plugin&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.mule.tools.maven&lt;/groupId&gt;\n                &lt;artifactId&gt;mule-maven-plugin&lt;/artifactId&gt;\n                &lt;version&gt;${mule.maven.plugin.version}&lt;/version&gt;\n                &lt;extensions&gt;true&lt;/extensions&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.mule.connectors&lt;/groupId&gt;\n            &lt;artifactId&gt;mule-http-connector&lt;/artifactId&gt;\n            &lt;version&gt;1.7.3&lt;/version&gt;\n            &lt;classifier&gt;mule-plugin&lt;/classifier&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.mule.connectors&lt;/groupId&gt;\n            &lt;artifactId&gt;mule-sockets-connector&lt;/artifactId&gt;\n            &lt;version&gt;1.2.3&lt;/version&gt;\n            &lt;classifier&gt;mule-plugin&lt;/classifier&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.activemq&lt;/groupId&gt;\n            &lt;artifactId&gt;activemq-all&lt;/artifactId&gt;\n            &lt;version&gt;5.16.0&lt;/version&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n\n    &lt;repositories&gt;\n        &lt;repository&gt;\n            &lt;id&gt;anypoint-exchange-v3&lt;/id&gt;\n            &lt;name&gt;Anypoint Exchange&lt;/name&gt;\n            &lt;url&gt;https://maven.anypoint.mulesoft.com/api/v3/maven&lt;/url&gt;\n            &lt;layout&gt;default&lt;/layout&gt;\n        &lt;/repository&gt;\n        &lt;repository&gt;\n            &lt;id&gt;mulesoft-releases&lt;/id&gt;\n            &lt;name&gt;MuleSoft Releases Repository&lt;/name&gt;\n            &lt;url&gt;https://repository.mulesoft.org/releases/&lt;/url&gt;\n            &lt;layout&gt;default&lt;/layout&gt;\n        &lt;/repository&gt;\n    &lt;/repositories&gt;\n\n    &lt;pluginRepositories&gt;\n        &lt;pluginRepository&gt;\n            &lt;id&gt;mulesoft-releases&lt;/id&gt;\n            &lt;name&gt;MuleSoft Releases Repository&lt;/name&gt;\n            &lt;layout&gt;default&lt;/layout&gt;\n            &lt;url&gt;https://repository.mulesoft.org/releases/&lt;/url&gt;\n            &lt;snapshots&gt;\n                &lt;enabled&gt;false&lt;/enabled&gt;\n            &lt;/snapshots&gt;\n        &lt;/pluginRepository&gt;\n    &lt;/pluginRepositories&gt;\n\n&lt;/project&gt;\n</code></pre>\n<p>jndi.properties</p>\n<pre><code>queue.testQueue=LogQueue2\njava.naming.provider.url=tcp://localhost:61616\n</code></pre>\n<p>log4j2.xml</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;Configuration&gt;\n\n    &lt;!--These are some of the loggers you can enable. \n        There are several more you can find in the documentation. \n        Besides this log4j configuration, you can also use Java VM environment variables\n        to enable other logs like network (-Djavax.net.debug=ssl or all) and \n        Garbage Collector (-XX:+PrintGC). These will be append to the console, so you will \n        see them in the mule_ee.log file. --&gt;\n\n    &lt;Appenders&gt;\n        &lt;JMS name=&quot;testJMS&quot; factoryName=&quot;org.apache.activemq.jndi.ActiveMQInitialContextFactory&quot; factoryBindingName=&quot;ConnectionFactory&quot; destinationBindingName=&quot;testQueue&quot;&gt;\n            &lt;!--  &lt;PatternLayout pattern=&quot;%-5p %d [%t] [processor: %X{processorPath}; event: %X{correlationId}] %c: %m%n&quot;/&gt;  --&gt;\n            &lt;JsonLayout compact=&quot;true&quot;&gt;\n                &lt;KeyValuePair key=&quot;correlationId&quot; value=&quot;${ctx:correlationId}&quot;/&gt;\n                &lt;KeyValuePair key=&quot;processorPath&quot; value=&quot;${ctx:attributes.requestUri}&quot;/&gt;\n            &lt;/JsonLayout&gt;\n        &lt;/JMS&gt;\n        &lt;RollingFile name=&quot;file&quot; fileName=&quot;${sys:mule.home}${sys:file.separator}logs${sys:file.separator}test.log&quot;\n                 filePattern=&quot;${sys:mule.home}${sys:file.separator}logs${sys:file.separator}test-%i.log&quot;&gt;\n            &lt;PatternLayout pattern=&quot;%-5p %d [%t] [processor: %X{processorPath}; event: %X{correlationId}] %c: %m%n&quot;/&gt;\n            &lt;SizeBasedTriggeringPolicy size=&quot;10 MB&quot;/&gt;\n            &lt;DefaultRolloverStrategy max=&quot;10&quot;/&gt;\n        &lt;/RollingFile&gt;\n    &lt;/Appenders&gt;\n\n    &lt;Loggers&gt;\n        &lt;!-- Http Logger shows wire traffic on DEBUG --&gt;\n        &lt;!--AsyncLogger name=&quot;org.mule.service.http.impl.service.HttpMessageLogger&quot; level=&quot;DEBUG&quot;/--&gt;\n        &lt;AsyncLogger name=&quot;org.mule.service.http&quot; level=&quot;WARN&quot;/&gt;\n        &lt;AsyncLogger name=&quot;org.mule.extension.http&quot; level=&quot;WARN&quot;/&gt;\n\n        &lt;!-- Mule logger --&gt;\n        &lt;AsyncLogger name=&quot;org.mule.runtime.core.internal.processor.LoggerMessageProcessor&quot; level=&quot;INFO&quot;/&gt;\n\n        &lt;AsyncRoot level=&quot;INFO&quot;&gt;\n            &lt;AppenderRef ref=&quot;file&quot;/&gt;\n        &lt;/AsyncRoot&gt;\n    &lt;/Loggers&gt;\n\n&lt;/Configuration&gt;\n</code></pre>\n<p>this much is enough to reproduce the issue. but create the app based on mule 4.9</p>\n<p>Can anyone guide me how can i resolve this issue?</p>\n<p>Thanks</p>\n",
    "tags" : [ "java", "jakarta-ee", "jms", "log4j2", "mule4" ],
    "owner" : {
      "account_id" : 42381643,
      "reputation" : 3,
      "user_id" : 30726760,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/62f4e676e9c4c3e33e5c8456b649e7da?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Aakash Giri",
      "link" : "https://stackoverflow.com/users/30726760/aakash-giri"
    },
    "is_answered" : true,
    "view_count" : 104,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1749137521,
    "creation_date" : 1749108082,
    "link" : "https://stackoverflow.com/questions/79653969/mule-4-9-jms-appender-error-modules-javax-jms-api-and-jakarta-jms-api-export-pa",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79654424,
    "question_id" : 79653969,
    "body" : "<p>The javax.jms API was deprecated and replaced by Jakarta JMS API years ago. Applications and libraries like log4j2 need to migrate to Jakarta JMS API.</p>\n<p>It seems to be a <a href=\"https://logging.apache.org/log4j/2.x/manual/appenders/message-queue.html#JmsAppender\" rel=\"nofollow noreferrer\">limitation</a> of the current version of log4j2:</p>\n<blockquote>\n<p>Due to breaking changes in the underlying API, the JMS Appender cannot be used with Jakarta Messaging API 3.0 or later.</p>\n</blockquote>\n<p>It seems that the support was developed for a future version of log4j2 but apparently has not been <a href=\"https://github.com/apache/logging-log4j2/issues/2995\" rel=\"nofollow noreferrer\">backported to log4j2 2.x</a> at this time. I'm not aware of an alternative.</p>\n<p>You might need to replace the usage of log4j2 JMS appender by a different appender. I personally believe that queues systems like JMS are not the best place to use for logging.</p>\n<p>Another alternative to keep using JMS is to write your own custom JMS appender for your application, using directly the Jakarta JMS API, or find one already created by someone else.</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1749126065,
    "last_activity_date" : 1749137521,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140490027,
    "post_id" : 79653969,
    "body" : "@aled I have added the app example code. let me know if you need any other details. According to my understanding mule 4.9 uses jakarta.jms-api for their internal functionality you can also find jakarta.jms-api inside mule/lib/opt folder and i am also adding javax.jms-api to boot folder in order to resolve NoClassDefFound error and these two creating the conflict as both export same package. and we need to use both jars as one used by mule and other one is needed by jms appender",
    "score" : 0,
    "owner" : {
      "account_id" : 42381643,
      "reputation" : 3,
      "user_id" : 30726760,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/62f4e676e9c4c3e33e5c8456b649e7da?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Aakash Giri",
      "link" : "https://stackoverflow.com/users/30726760/aakash-giri"
    },
    "creation_date" : 1749123454,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140489994,
    "post_id" : 79653969,
    "body" : "Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> in the question. Use <a href=\"https://stackoverflow.com/posts/79653969/edit\">edit</a> to update the question.",
    "score" : 0,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1749122698,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}