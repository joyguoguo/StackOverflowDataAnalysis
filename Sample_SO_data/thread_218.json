{
  "question" : {
    "question_id" : 79825183,
    "title" : "How do I get cloudwatch agent to send jmx metrics to cloud watch in ECS",
    "body" : "<p>I'm needing someone who actually has this working to weigh in as I'm really struggling to get this running...</p>\n<p>Here is my task definition in full:</p>\n<p>Superfluous and irrelevant bits have been removed.</p>\n<pre><code>{\n    &quot;compatibilities&quot;: [\n        &quot;EC2&quot;,\n        &quot;MANAGED_INSTANCES&quot;\n    ],\n    &quot;containerDefinitions&quot;: [\n        {\n            &quot;environment&quot;: [\n                {\n                    &quot;name&quot;: &quot;AWS_REGION&quot;,\n                    &quot;value&quot;: &quot;eu-west-1&quot;\n                }\n            ],\n            &quot;environmentFiles&quot;: [],\n            &quot;essential&quot;: false,\n            &quot;extraHosts&quot;: [],\n            &quot;image&quot;: &quot;public.ecr.aws/cloudwatch-agent/cloudwatch-agent:latest&quot;,\n            &quot;links&quot;: [],\n            &quot;logConfiguration&quot;: {\n                &quot;logDriver&quot;: &quot;awslogs&quot;,\n                &quot;options&quot;: {\n                    &quot;awslogs-group&quot;: &quot;xxxx&quot;,\n                    &quot;awslogs-region&quot;: &quot;eu-west-1&quot;,\n                    &quot;awslogs-stream-prefix&quot;: &quot;cwagent&quot;\n                },\n                &quot;secretOptions&quot;: []\n            },\n            &quot;memoryReservation&quot;: 128,\n            &quot;mountPoints&quot;: [],\n            &quot;name&quot;: &quot;CWAgent&quot;,\n            &quot;portMappings&quot;: [],\n            &quot;secrets&quot;: [\n                {\n                    &quot;name&quot;: &quot;CW_CONFIG_CONTENT&quot;,\n                    &quot;valueFrom&quot;: &quot;arn:aws:ssm:eu-west-1:xxxx:parameter/ecs/cwagent/jmx/config&quot;\n                }\n            ],\n        },\n        {\n            &quot;cpu&quot;: 512,\n            &quot;environment&quot;: [\n                {\n                    &quot;name&quot;: &quot;OTHER_ENV_VARS_REDACTED&quot;,\n                    &quot;value&quot;: &quot;redacted&quot;\n                },\n                {\n                    &quot;name&quot;: &quot;JAVA_TOOL_OPTIONS&quot;,\n                    &quot;value&quot;: &quot;-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=9012 -Dcom.sun.management.jmxremote.rmi.port=9012 -Dcom.sun.management.jmxremote.local.only=true -Djava.rmi.server.hostname=127.0.0.1 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.net.preferIPv4Stack=true&quot;\n                },\n            ],\n            &quot;essential&quot;: true,\n            &quot;image&quot;: &quot;xxxxx.dkr.ecr.eu-west-1.amazonaws.com/java-spring-app-docker&quot;,\n            &quot;logConfiguration&quot;: {\n                &quot;logDriver&quot;: &quot;awslogs&quot;,\n                &quot;options&quot;: {\n                    &quot;awslogs-group&quot;: &quot;redacted&quot;,\n                    &quot;awslogs-region&quot;: &quot;eu-west-1&quot;,\n                    &quot;awslogs-stream-prefix&quot;: &quot;ecs&quot;\n                },\n            },\n            &quot;memory&quot;: 900,\n            &quot;name&quot;: &quot;redacted&quot;,\n            &quot;portMappings&quot;: [\n                {\n                    &quot;containerPort&quot;: 8080,\n                    &quot;hostPort&quot;: 8080,\n                    &quot;name&quot;: &quot;8080&quot;,\n                    &quot;protocol&quot;: &quot;tcp&quot;\n                },\n                {\n                    &quot;containerPort&quot;: 9012,\n                    &quot;hostPort&quot;: 9012,\n                    &quot;name&quot;: &quot;jmx&quot;,\n                    &quot;protocol&quot;: &quot;tcp&quot;\n                }\n            ],\n            &quot;versionConsistency&quot;: &quot;disabled&quot;,\n        }\n    ],\n    &quot;executionRoleArn&quot;: &quot;arn:aws:iam::xxxxx:role/redacted&quot;,\n    &quot;family&quot;: &quot;redacted&quot;,\n    &quot;networkMode&quot;: &quot;awsvpc&quot;,\n    &quot;registeredAt&quot;: &quot;2025-11-20T06:26:22.591Z&quot;,\n    &quot;registeredBy&quot;: &quot;arn:aws:iam::xxxxx:user/xxxx&quot;,\n    ],\n    &quot;requiresCompatibilities&quot;: [\n        &quot;EC2&quot;\n    ],\n    &quot;revision&quot;: 17,\n    &quot;status&quot;: &quot;ACTIVE&quot;,\n    &quot;taskDefinitionArn&quot;: &quot;arn:aws:ecs:eu-west-1:xxxxx:task-definition/redacted:17&quot;,\n    &quot;taskRoleArn&quot;: &quot;arn:aws:iam::xxxxx:role/redacted&quot;,\n}\n</code></pre>\n<p>And here is the CW config file: provided from a secure parameter.</p>\n<pre><code>{\n    &quot;agent&quot;: {\n        &quot;metrics_collection_interval&quot;: 20,\n    },\n    &quot;metrics&quot;: {\n        &quot;namespace&quot;: &quot;JmxMetrics&quot;,\n        &quot;metrics_collected&quot;: {\n            &quot;jmx&quot;: [\n                {\n                    &quot;endpoint&quot;: &quot;localhost:9012&quot;,\n                    &quot;jvm&quot;: {\n                        &quot;measurement&quot;: [\n                            &quot;jvm.gc.collections.count&quot;,\n                            &quot;jvm.gc.collections.elapsed&quot;,\n                            &quot;jvm.memory.heap.used&quot;,\n                            &quot;jvm.memory.heap.max&quot;,\n                            &quot;jvm.memory.nonheap.used&quot;,\n                            &quot;jvm.memory.nonheap.max&quot;,\n                            &quot;jvm.memory.pool.used&quot;,\n                            &quot;jvm.threads.count&quot;\n                        ]\n                    }\n                }\n            ]\n        }\n    }\n}\n</code></pre>\n<p>When this starts up I get in the logs:</p>\n<pre><code>2025-11-20T06:44:05Z D! Profiler dump: \n[no stats is available...]\n</code></pre>\n<p>The thing is if I change the port in the endpoint config of the cw agent, nothing changes.</p>\n<p>I'm not actually sure where these metrics would appear in cloud watch but from what I've read, I can't see them.</p>\n<p>Do I maybe need to change security group settings? Maybe inbound? The only thing I think I could change it the endpoing from localhost but from all that I've read - localhost is correct when using awsvpc.</p>\n",
    "tags" : [ "java", "amazon-web-services", "amazon-ecs", "jmx" ],
    "owner" : {
      "account_id" : 40662,
      "reputation" : 21374,
      "user_id" : 117839,
      "user_type" : "registered",
      "accept_rate" : 74,
      "profile_image" : "https://www.gravatar.com/avatar/826b0d5f2ae42a48261b1bfe780596d6?s=256&d=identicon&r=PG",
      "display_name" : "Michael Wiles",
      "link" : "https://stackoverflow.com/users/117839/michael-wiles"
    },
    "is_answered" : false,
    "view_count" : 51,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1763621769,
    "creation_date" : 1763621769,
    "link" : "https://stackoverflow.com/questions/79825183/how-do-i-get-cloudwatch-agent-to-send-jmx-metrics-to-cloud-watch-in-ecs",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}