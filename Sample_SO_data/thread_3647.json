{
  "question" : {
    "question_id" : 79534692,
    "title" : "Java Reflection - Loading a field with dependency",
    "body" : "<p>I want to get the field names of a class through reflection, but one of the fields is from a class that is not in the jar file and was added with a dependency, and it throws <code>NoClassDefFoundError</code> exception.</p>\n<p>Is there a way I can skip that field or load it without needing that dependency?</p>\n<pre><code>@Nullable\npublic Class&lt;?&gt; loadClass(String name) {\n    try {\n        return Class.forName(name, false, classLoader);\n    } catch (ClassNotFoundException e) {\n        LOGGER.error(&quot;Class {} is not loaded.&quot;, name);\n        return null;\n    }\n}\n</code></pre>\n<pre><code>Class&lt;?&gt; clazz = mcLoader.loadClass(&quot;className&quot;);\nList&lt;String&gt; fieldNames = new ArrayList&lt;&gt;();\nfor (Field field: clazz.getDeclaredFields()) {\n    field.setAccessible(true);\n    fieldNames.add(field.getName() + &quot;:&quot; + field.getType().getName());\n}\n</code></pre>\n<p>try-catch didn't help because the exception is coming from <code>clazz.getDeclaredFields()</code> and if I use try-catch, non of fields will load as the field with dependency is the first field.</p>\n",
    "tags" : [ "java", "reflection" ],
    "owner" : {
      "account_id" : 31424715,
      "reputation" : 13,
      "user_id" : 24853758,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/ACg8ocL9SeQ84bu7INkRYBcqQ8M_WYDejet4xYc9f-88lesnLEwsss8=k-s256",
      "display_name" : "BaRiBoD",
      "link" : "https://stackoverflow.com/users/24853758/baribod"
    },
    "is_answered" : true,
    "view_count" : 84,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1742984424,
    "creation_date" : 1742931661,
    "link" : "https://stackoverflow.com/questions/79534692/java-reflection-loading-a-field-with-dependency",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79534783,
    "question_id" : 79534692,
    "body" : "<blockquote>\n<p>I want to get the field names of a class through reflection</p>\n</blockquote>\n<p>If you don't already have the field names, then your alternatives for getting them by reflection are <code>Class.getDeclaredFields()</code> and <code>Class.getFields()</code>, depending on whether you want to include inherited fields.</p>\n<blockquote>\n<p>try-catch didn't help because the exception is coming from <code>clazz.getDeclaredFields()</code> and if I use try-catch, non of fields will load as the field with dependency is the first field.</p>\n</blockquote>\n<p>These methods will attempt to load any unloaded classes representing the fields' data types, and if they cannot do so then they will throw instead of returning a result.  They return all the results at once, as an array, so there is no provision for selective or partial results, and a problem with any field will scuttle the whole thing.</p>\n<p>Overall, there's not much you can do with a <code>Class</code> object if you cannot load all the reflected class's dependencies.  Only when lazy linking is performed can you even get your hands on such an object in the first place.</p>\n<blockquote>\n<p>Is there a way I can skip that field or load it without needing that dependency?</p>\n</blockquote>\n<p>Not with reflection.  You could conceivably analyze the class file directly, without performing Java class loading at all, but that's a different thing. The Java standard library has no provision for it before Java 22, but there are third-party tools that might help.  Java 24 has has added a <a href=\"https://docs.oracle.com/en/java/javase/24/docs/api/java.base/java/lang/classfile/package-summary.html\" rel=\"nofollow noreferrer\">classfile API</a> (previewed starting in Java 22) that looks like  it provides an alternative to reflection for what you describe [thanks @Slaw].</p>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1742933964,
    "last_activity_date" : 1742984424,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140263351,
    "post_id" : 79534692,
    "body" : "Define &#39;added with a dependency&#39;. If it&#39;s available to the class loader that loaded the JAR file you mention there shouldn&#39;t be a problem, and if it isn&#39;t you have a much bigger problem anyway. Please provided the actual exception message in your question.",
    "score" : 0,
    "owner" : {
      "account_id" : 71739,
      "reputation" : 311869,
      "user_id" : 207421,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=256&d=identicon&r=PG",
      "display_name" : "user207421",
      "link" : "https://stackoverflow.com/users/207421/user207421"
    },
    "creation_date" : 1742948631,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140262944,
    "post_id" : 79534692,
    "body" : "@JohnBollinger Yes, I meant the data type of the field is a class type that has not been loaded.",
    "score" : 0,
    "owner" : {
      "account_id" : 31424715,
      "reputation" : 13,
      "user_id" : 24853758,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/ACg8ocL9SeQ84bu7INkRYBcqQ8M_WYDejet4xYc9f-88lesnLEwsss8=k-s256",
      "display_name" : "BaRiBoD",
      "link" : "https://stackoverflow.com/users/24853758/baribod"
    },
    "creation_date" : 1742938232,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140262722,
    "post_id" : 79534692,
    "body" : "A NoClassDefFoundError can occur if the class you are loading depends on other classes that are missing. The error should tell you which class is missing. Check that class and include the jar containing that class to fix the error.",
    "score" : 0,
    "owner" : {
      "account_id" : 5083689,
      "reputation" : 1141,
      "user_id" : 4079056,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/LfAQ3.jpg?s=256",
      "display_name" : "sanurah",
      "link" : "https://stackoverflow.com/users/4079056/sanurah"
    },
    "creation_date" : 1742934024,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140262669,
    "post_id" : 79534692,
    "body" : "Given you seem to only want the <i>name</i> of the field and the <i>name</i> of its type, perhaps you could inspect the byte-code instead of using reflection.",
    "score" : 0,
    "owner" : {
      "account_id" : 8532578,
      "reputation" : 49884,
      "user_id" : 6395627,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Slaw",
      "link" : "https://stackoverflow.com/users/6395627/slaw"
    },
    "creation_date" : 1742933034,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140262648,
    "post_id" : 79534692,
    "body" : "Did you try inspecting the class this way: <code>ClassLoader.getSystemClassLoader().loadClass(&quot;className&quot;).ge&zwnj;&#8203;tDeclaredFields()</code> ?",
    "score" : 0,
    "owner" : {
      "account_id" : 11555562,
      "reputation" : 569,
      "user_id" : 8466853,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/cd7f72b426ce3c46739900b8ba014e26?s=256&d=identicon&r=PG",
      "display_name" : "Arno",
      "link" : "https://stackoverflow.com/users/8466853/arno"
    },
    "creation_date" : 1742932668,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140262634,
    "post_id" : 79534692,
    "body" : "I&#39;m not sure I follow.  When you  say &quot;one of the fields is from a class that is not in the jar file&quot;, do you mean that <i>the data type</i> of the field is a class type, and that class has not been loaded? That would make some sense, but what you seem actually to have said is that you are trying to reflect a field <i>belonging to</i> a class that has not been loaded, and that&#39;s definitely impossible.",
    "score" : 1,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1742932437,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79534783" : [ {
      "comment_id" : 140266536,
      "post_id" : 79534783,
      "body" : "Agreed, @Holger.  As this answer already says, &quot;Only when lazy linking is performed can you even get your hands on such [a Class] object in the first place.&quot;",
      "score" : 1,
      "owner" : {
        "account_id" : 2792262,
        "reputation" : 190832,
        "user_id" : 2402272,
        "user_type" : "registered",
        "accept_rate" : 85,
        "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
        "display_name" : "John Bollinger",
        "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
      },
      "creation_date" : 1743016272,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140266303,
      "post_id" : 79534783,
      "body" : "It’s worth noting that the OP has been lucky to get that far to call <code>getDeclaredFields()</code>. A JVM implementation is free to throw on the <code>loadClass</code> call already when the class has references to non-existing classes. Parsing the bytecode without loading the class would be the only reliable way to do it.",
      "score" : 2,
      "owner" : {
        "account_id" : 3211603,
        "reputation" : 300981,
        "user_id" : 2711488,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/t2hoD.jpg?s=256",
        "display_name" : "Holger",
        "link" : "https://stackoverflow.com/users/2711488/holger"
      },
      "creation_date" : 1743012462,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140263085,
      "post_id" : 79534783,
      "body" : "Thanks @Slaw, that one had gone under my radar until now.  I&#39;ve updated this answer to mention it.",
      "score" : 1,
      "owner" : {
        "account_id" : 2792262,
        "reputation" : 190832,
        "user_id" : 2402272,
        "user_type" : "registered",
        "accept_rate" : 85,
        "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
        "display_name" : "John Bollinger",
        "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
      },
      "creation_date" : 1742941223,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140263070,
      "post_id" : 79534783,
      "body" : "&quot;<i>The Java standard library has no provision for it</i>&quot; – Note Java 24 added the <a href=\"https://docs.oracle.com/en/java/javase/24/docs/api/java.base/java/lang/classfile/package-summary.html\" rel=\"nofollow noreferrer\">Class-File API</a> (was a preview feature in Java 22 and 23).",
      "score" : 1,
      "owner" : {
        "account_id" : 8532578,
        "reputation" : 49884,
        "user_id" : 6395627,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Slaw",
        "link" : "https://stackoverflow.com/users/6395627/slaw"
      },
      "creation_date" : 1742940761,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}