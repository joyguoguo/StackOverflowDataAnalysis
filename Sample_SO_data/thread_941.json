{
  "question" : {
    "question_id" : 79758216,
    "title" : "Jackson `InvalidDefinitionException` with GraalVM native image: &quot;Cannot construct instance ... no delegate- or property-based Creator&quot;",
    "body" : "<p>I’m building a GraalVM native image for a Quarkus/Java 21 project, and running into Jackson deserialization issues that work fine on JVM.</p>\n<p>When my app starts, Jackson fails to deserialize YAML config into a Configuration POJO (this class comes from a dependency library, not my own code):</p>\n<pre><code>com.fasterxml.jackson.databind.exc.InvalidDefinitionException:\nCannot construct instance of `com.example.config.models.Configuration`:\ncannot deserialize from Object value (no delegate- or property-based Creator):\nthis appears to be a native image, in which case you may need to configure reflection\n at [Source: (ByteArrayInputStream); line: 1, column: 1]\n</code></pre>\n<p>Full stack trace excerpt:</p>\n<pre><code>com.fasterxml.jackson.databind.DeserializationContext.reportBadDefinition\ncom.fasterxml.jackson.databind.DatabindContext.reportBadDefinition\ncom.fasterxml.jackson.databind.DeserializationContext.handleMissingInstantiator\ncom.fasterxml.jackson.databind.deser.BeanDeserializerBase.deserializeFromObjectUsingNonDefault\ncom.fasterxml.jackson.databind.deser.BeanDeserializer.deserializeFromObject\ncom.fasterxml.jackson.databind.deser.BeanDeserializer.deserialize\ncom.fasterxml.jackson.databind.deser.DefaultDeserializationContext.readRootValue\ncom.fasterxml.jackson.databind.ObjectMapper._readMapAndClose\ncom.fasterxml.jackson.databind.ObjectMapper.readValue\ncom.example.config.ConfigurationLoader.loadConfigurationFromYaml\ncom.example.config.HttpConfigurationLoader.loadConfiguration\ncom.example.config.AppProps.initialize\n...\n</code></pre>\n<hr />\n<h3>What I tried</h3>\n<ul>\n<li>Added <code>reflect-config.json</code> under <code>src/main/resources/META-INF/native-image/</code> with entries like:</li>\n</ul>\n<pre class=\"lang-json prettyprint-override\"><code>[\n  {\n    &quot;name&quot;:&quot;com.example.config.models.Configuration&quot;,\n    &quot;allDeclaredFields&quot;:true,\n    &quot;queryAllDeclaredMethods&quot;:true,\n    &quot;queryAllDeclaredConstructors&quot;:true,\n    &quot;methods&quot;:[{&quot;name&quot;:&quot;&lt;init&gt;&quot;,&quot;parameterTypes&quot;:[&quot;java.util.Map&quot;] }]\n  },\n  {\n    &quot;name&quot;:&quot;com.example.config.models.Configuration$Destination&quot;,\n    &quot;allDeclaredFields&quot;:true,\n    &quot;queryAllDeclaredMethods&quot;:true,\n    &quot;queryAllDeclaredConstructors&quot;:true,\n    &quot;methods&quot;:[{&quot;name&quot;:&quot;&lt;init&gt;&quot;,&quot;parameterTypes&quot;:[&quot;java.lang.String&quot;,&quot;java.lang.String&quot;,&quot;int&quot;,&quot;java.lang.String&quot;,&quot;java.lang.String&quot;,&quot;java.lang.String&quot;,&quot;int&quot;,&quot;int&quot;,&quot;int&quot;,&quot;int&quot;] }]\n  },\n  {\n    &quot;name&quot;:&quot;com.example.config.models.Configuration$Environment&quot;,\n    &quot;allDeclaredFields&quot;:true,\n    &quot;queryAllDeclaredMethods&quot;:true,\n    &quot;queryAllDeclaredConstructors&quot;:true,\n    &quot;methods&quot;:[{&quot;name&quot;:&quot;&lt;init&gt;&quot;,&quot;parameterTypes&quot;:[&quot;com.example.config.models.Configuration$Destination&quot;] }]\n  },\n  {\n    &quot;name&quot;:&quot;com.example.config.HttpConfigurationLoader&quot;,\n    &quot;allDeclaredConstructors&quot;: true,\n    &quot;allDeclaredMethods&quot;: true,\n    &quot;allDeclaredFields&quot;: true\n  },\n  {\n    &quot;name&quot;: &quot;com.fasterxml.jackson.annotation.JsonCreator&quot;\n  }\n]\n\n\n</code></pre>\n<ul>\n<li>Verified the JSON structure is valid and placed under <code>META-INF/native-image</code>.</li>\n<li>Tried registering a Jackson <code>Module</code> via <code>META-INF/services/com.fasterxml.jackson.databind.Module</code>.</li>\n<li>Still getting the same <code>InvalidDefinitionException</code>.</li>\n</ul>\n<hr />\n<h3>Question</h3>\n<p>Since Configuration and related classes come from a third-party dependency (I cannot modify them to add annotations or constructors), how can I make Jackson + GraalVM native image deserialize them properly?</p>\n<p>Is there a way to generate reflection config automatically for dependency classes used by Jackson? I did auto generated the reflect-config.json and others via agent mode and placed them under <code>src\\main\\resources\\META-INF\\native-image\\</code></p>\n<p>Do I need to create my own mixin or custom deserializer?</p>\n<p>Or is there a recommended Quarkus/GraalVM way to handle third-party POJOs in native images?</p>\n<p>here is sample code from dependency lib</p>\n<pre class=\"lang-java prettyprint-override\"><code>// Dummy dependency-like classes (cannot modify these)\npackage com.example.dep.config.models;\n\nimport java.util.Map;\n\npublic class Configuration {\n    private Map&lt;String, Environment&gt; bootstrapConfig;\n\n    public Map&lt;String, Environment&gt; getBootstrapConfig() { return bootstrapConfig; }\n    public void setBootstrapConfig(Map&lt;String, Environment&gt; bootstrapConfig) { this.bootstrapConfig = bootstrapConfig; }\n\n    public static class Environment {\n        private Destination destination;\n        public Destination getDestination() { return destination; }\n        public void setDestination(Destination destination) { this.destination = destination; }\n    }\n\n    public static class Destination {\n        private String protocol;\n        private String host;\n        private int port;\n\n        public String getProtocol() { return protocol; }\n        public void setProtocol(String protocol) { this.protocol = protocol; }\n\n        public String getHost() { return host; }\n        public void setHost(String host) { this.host = host; }\n\n        public int getPort() { return port; }\n        public void setPort(int port) { this.port = port; }\n    }\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>// Loader that uses Jackson to read YAML\npackage com.example.dep.config;\n\nimport com.example.dep.config.models.Configuration;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n\nimport java.io.IOException;\nimport java.io.InputStream;\n\npublic class ConfigurationLoader {\n    private static final ObjectMapper MAPPER = new ObjectMapper(new YAMLFactory());\n\n    public Configuration loadConfiguration(String environment) throws IOException {\n        try (InputStream fileStream = Thread.currentThread()\n                .getContextClassLoader()\n                .getResourceAsStream(&quot;config.yaml&quot;)) {\n            return MAPPER.readValue(fileStream, Configuration.class);\n        }\n    }\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>// Utility class similar to AppProps in dependency lib\npackage com.example.dep.config;\n\nimport com.example.dep.config.models.Configuration;\nimport lombok.experimental.UtilityClass;\n\n@UtilityClass\npublic class AppProps {\n\n    private static Configuration configuration;\n    private static Configuration.Destination currentDestination;\n    private static ConfigurationLoader loader;\n\n    public static void initialize() throws IOException {\n        loader = new ConfigurationLoader();\n        configuration = loader.loadConfiguration(&quot;dev&quot;); // environment dummy\n    }\n\n    public static Configuration getConfiguration() {\n        return configuration;\n    }\n\n    public static Configuration.Destination getCurrentDestination() {\n        currentDestination = configuration.getBootstrapConfig().get(&quot;dev&quot;).getDestination();\n        return currentDestination;\n    }\n}\n</code></pre>\n",
    "tags" : [ "java", "quarkus", "graalvm", "graalvm-native-image" ],
    "owner" : {
      "account_id" : 16639518,
      "reputation" : 111,
      "user_id" : 12025408,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e117ffb85f60389c8bf78450dfa4d3a3?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "amkon",
      "link" : "https://stackoverflow.com/users/12025408/amkon"
    },
    "is_answered" : false,
    "view_count" : 103,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1757286964,
    "creation_date" : 1757261550,
    "link" : "https://stackoverflow.com/questions/79758216/jackson-invaliddefinitionexception-with-graalvm-native-image-cannot-construc",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140727713,
    "post_id" : 79758216,
    "body" : "You do not have an access neither to <code>new ObjectMapper(new YAMLFactory())</code> instance nor an input stream. Can you extend <code>ConfigurationLoader</code> class and use it instead? If not you probably have to modify <code>MAPPER</code> inside <code>ConfigurationLoader</code> using reflection.",
    "score" : 0,
    "owner" : {
      "account_id" : 21287,
      "reputation" : 38910,
      "user_id" : 51591,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://i.sstatic.net/TsvFC.jpg?s=256",
      "display_name" : "Michał Ziober",
      "link" : "https://stackoverflow.com/users/51591/micha%c5%82-ziober"
    },
    "creation_date" : 1757536354,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140720711,
    "post_id" : 79758216,
    "body" : "@geoand may i know what you are looking for specifically?",
    "score" : 0,
    "owner" : {
      "account_id" : 16639518,
      "reputation" : 111,
      "user_id" : 12025408,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e117ffb85f60389c8bf78450dfa4d3a3?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "amkon",
      "link" : "https://stackoverflow.com/users/12025408/amkon"
    },
    "creation_date" : 1757277025,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140720488,
    "post_id" : 79758216,
    "body" : "Do you have an example application I can look at?",
    "score" : 0,
    "owner" : {
      "account_id" : 2922228,
      "reputation" : 64842,
      "user_id" : 2504224,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/ACuxG.png?s=256",
      "display_name" : "geoand",
      "link" : "https://stackoverflow.com/users/2504224/geoand"
    },
    "creation_date" : 1757268802,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}