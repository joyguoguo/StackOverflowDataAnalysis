{
  "question" : {
    "question_id" : 79817122,
    "title" : "Helidon MP: how to cancel an expensive computation in a REST service on client disconnect?",
    "body" : "<p>We have some expensive REST services implemented in Helidon MP 4 that often take one minute until they are finished and the response is returned. It happens quite often that the client disconnects before the response is finished. How is it possible to cancel the computation when that happens? Is there any way to test whether the connection is still open?</p>\n<p>Context: The REST services are implemented with <a href=\"https://helidon.io/docs/v4/mp/jaxrs/jaxrs-applications\" rel=\"nofollow noreferrer\">Jakarta REST</a> and receive JSON requests and write JSON responses. I tried converting the service to AsyncResponse and register a ConnectionCallback, but the ConnectionCallback.onDisconnect is only called when the server tries to return the response to the client, and thus is completely worthless. Converting the endpoint to SSE and periodically write ping type messages would be thinkable, but I'd much prefer less intrusive options.<br />\nThanks so much!</p>\n",
    "tags" : [ "java", "rest", "microprofile", "helidon" ],
    "owner" : {
      "account_id" : 11209,
      "reputation" : 26136,
      "user_id" : 21499,
      "user_type" : "registered",
      "accept_rate" : 56,
      "profile_image" : "https://i.sstatic.net/Ykmgs.jpg?s=256",
      "display_name" : "Dr. Hans-Peter St&#246;rr",
      "link" : "https://stackoverflow.com/users/21499/dr-hans-peter-st%c3%b6rr"
    },
    "is_answered" : false,
    "view_count" : 48,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1763575715,
    "creation_date" : 1762895196,
    "link" : "https://stackoverflow.com/questions/79817122/helidon-mp-how-to-cancel-an-expensive-computation-in-a-rest-service-on-client-d",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79818683,
    "question_id" : 79817122,
    "body" : "<p>For long-running tasks it is usually better to split the request into a HTTP POST request that returns a [202 Accepted](<a href=\"https://www.rfc-editor.org/rfc/rfc9110.html#name-202-accepted\" rel=\"nofollow noreferrer\">https://www.rfc-editor.org/rfc/rfc9110.html#name-202-accepted</a>) response immediately that just confirms the receipt of the request and queues the processing task internally but as no result for the process is yet available the response will contain a <code>Location</code> URL the client can use to poll for status changes on the started process and may contain further payload to describe the current status of the process as well. See f.e. [here](<a href=\"https://restfulapi.net/http-status-202-accepted/\" rel=\"nofollow noreferrer\">https://restfulapi.net/http-status-202-accepted/</a>).</p>\n<p>A client can use the returned URL to issue HTTP GET requests in either instructed or reasonable intervalls to learn the current status of the process. While the process is still calculating the result the response should indicate that the prcoess is still running. Once the request finished calculating the result, a GET request sent to that URL should return the final result of the calculation. This URL should make use of caching directives, f.e. disable caching while the process is still running and enable caching of the response once a final result is available to server clients with the current state and reuse the actual result on consecutive requests once the process is done.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1464652,
      "reputation" : 12984,
      "user_id" : 1377895,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/08b21d815dc9a832a99bf93b6f28f01b?s=256&d=identicon&r=PG",
      "display_name" : "Roman Vottner",
      "link" : "https://stackoverflow.com/users/1377895/roman-vottner"
    },
    "creation_date" : 1763027279,
    "last_activity_date" : 1763027279,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79819523,
    "question_id" : 79817122,
    "body" : "<p>You asked about a disconnection, which the other answer doesn't really seem to address.</p>\n<p>What release of Helidon are you using? Release 3 and earlier used Netty for the webserver. Helidon 4 includes its own webserver based on Java virtual threads, so the ultimate answer to your question might be different depending on which release is in play.</p>\n<p>Update: I had thought there <em>might</em> be a way in Helidon SE to detect client disconnects apart from an attempt to write the response (or read more of the request, in fact), but others on the team have confirmed there is not.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 16909678,
      "reputation" : 241,
      "user_id" : 12229062,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AAuE7mC54WmzNSsmFEnyPInhIMbiIjLg_hFFdDKR8pOQ=k-s256",
      "display_name" : "Tim Quinn",
      "link" : "https://stackoverflow.com/users/12229062/tim-quinn"
    },
    "creation_date" : 1763076107,
    "last_activity_date" : 1763128826,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}