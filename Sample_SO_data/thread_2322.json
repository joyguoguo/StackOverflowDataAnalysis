{
  "question" : {
    "question_id" : 79629760,
    "title" : "JavaFX serialization, inheritance and generic types",
    "body" : "<p>So I have a class that implements a JavaFX ObservableMap which maps Integers to a generic type T, and I want to serialize that, but it happens that this is an abstract class and what I will in fact serialize are the specializations of this class. I understand that I cannot serialize directly a JavaFX object, and because of that I specified the serialization methods.</p>\n<p>This is a minimum version of my code:</p>\n<pre><code>public abstract class DataBaseIncremental&lt;T&gt; {\n    protected transient ObservableMap&lt;Integer, T&gt; elementsMap;\n\n    protected void writeObject(ObjectOutputStream out) throws IOException{\n         out.defaultWriteObject();\n         Map&lt;Integer, T&gt; backupMap= new HashMap&lt;&gt;(elementsMap);\n         out.writeObject(backupMap);\n\n         writeAdditionalData(out);\n    }\n\n    protected void readObject(ObjectInputStream in) throws ClassNotFoundException, IOException{\n         in.defaultReadObject();\n         @SuppressWarnings(&quot;unchecked&quot;) // this bothered me a lot, I ended up putting this label cause I couldn't get rid of it\n         Map&lt;Integer, T&gt; backupMap= (Map&lt;Integer, T&gt;) in.readObject();\n         elementsMap= FXCollections.observableMap(backupMap);\n\n         readAdditionalData(in);\n    }\n\n    protected void writeAdditionalData(ObjectOutputStream out) throws IOException{}\n\n    protected void readAdditionalData(ObjectInputStream in) throws IOException{}\n}\n</code></pre>\n<p>Then, in my sublcasses that extends this class (i. e. <code>public class UserDataBase extends DataBaseIncremental&lt;User&gt; implements Serializable{...}</code>) I simply do nothing in the writeAdditionalData and readAdditionalData methods, cause I just have nothing to do with them now -but probably in the future I will. The problem is that, when I run it and try to serialize and deserialize an object, when it is loaded (deserialized) it happens to not contain anything in the ObservableMap, none of the contents it previously had when I serialized it (all of them are Serializable, I checked), yet it throws no errors. I could just not inherit the serialization methods and define it privately in each of the child classes, and in fact, doing this solves the problem, but that is not the point of inheritance. Then, what could I do if I want to effectively serialize the children objects?</p>\n",
    "tags" : [ "java", "javafx", "serialization", "deserialization" ],
    "owner" : {
      "account_id" : 22412187,
      "reputation" : 33,
      "user_id" : 16620767,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/pFx2e.jpg?s=256",
      "display_name" : "Satoshi",
      "link" : "https://stackoverflow.com/users/16620767/satoshi"
    },
    "is_answered" : false,
    "view_count" : 86,
    "answer_count" : 0,
    "score" : 2,
    "last_activity_date" : 1747713232,
    "creation_date" : 1747713232,
    "link" : "https://stackoverflow.com/questions/79629760/javafx-serialization-inheritance-and-generic-types",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140444224,
    "post_id" : 79629760,
    "body" : "For what it&#39;s worth, I have used a similar approach for JavaFX data objects—not with ObservableLists, but with Property values.  I had writeObject write the value and I had readObject read it and wrap it in a Property instance.  It does work.",
    "score" : 2,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44936,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1747776463,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140444221,
    "post_id" : 79629760,
    "body" : "For warnings on type casting, I didn&#39;t look at your issue in detail, but it is a common issue with Java.  There can be workarounds as shown here <a href=\"https://gafter.blogspot.com/2006/12/super-type-tokens.html\" rel=\"nofollow noreferrer\">super type tokens and gafter&#39;s gadget</a>, Spring <a href=\"https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/asm/TypeReference.html\" rel=\"nofollow noreferrer\">TypeReference</a>, Gson <a href=\"https://www.javadoc.io/doc/com.google.code.gson/gson/2.6.2/com/google/gson/reflect/TypeToken.html\" rel=\"nofollow noreferrer\">TypeToken</a>, <a href=\"https://stackoverflow.com/questions/43117731/what-is-type-typetoken\">example</a>.",
    "score" : 0,
    "owner" : {
      "account_id" : 1180113,
      "reputation" : 160457,
      "user_id" : 1155209,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5192e7cbcf2f72a847d6fb0d1552f049?s=256&d=identicon&r=PG",
      "display_name" : "jewelsea",
      "link" : "https://stackoverflow.com/users/1155209/jewelsea"
    },
    "creation_date" : 1747776324,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140444129,
    "post_id" : 79629760,
    "body" : "You may be interested in <a href=\"https://openjdk.org/projects/amber/design-notes/towards-better-serialization\" rel=\"nofollow noreferrer\">Towards Better Serialization</a> by Brian Goetz.  Unfortunately, the work is still in the preliminary stage, so it will not assist you in the short-term.",
    "score" : 2,
    "owner" : {
      "account_id" : 1180113,
      "reputation" : 160457,
      "user_id" : 1155209,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/5192e7cbcf2f72a847d6fb0d1552f049?s=256&d=identicon&r=PG",
      "display_name" : "jewelsea",
      "link" : "https://stackoverflow.com/users/1155209/jewelsea"
    },
    "creation_date" : 1747774206,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140443910,
    "post_id" : 79629760,
    "body" : "(For clarity, I deleted one previous comment as it was incorrect.)",
    "score" : 0,
    "owner" : {
      "account_id" : 2518243,
      "reputation" : 210906,
      "user_id" : 2189127,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
      "display_name" : "James_D",
      "link" : "https://stackoverflow.com/users/2189127/james-d"
    },
    "creation_date" : 1747767983,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140443852,
    "post_id" : 79629760,
    "body" : "@VGR is correct here. When the subclass is [de]serialized, the superclass is also [de]serialized, so the (private) <code>readObject()</code> and <code>writeObject</code> methods in the superclass will be invoked. Make them private and it should work; there is no need to invoke them explicitly. Create and post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> if you still can&#39;t get it to work. (Again, though, I would strongly recommend not doing this at all, and using JSON or XML to persist the data.)",
    "score" : 0,
    "owner" : {
      "account_id" : 2518243,
      "reputation" : 210906,
      "user_id" : 2189127,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
      "display_name" : "James_D",
      "link" : "https://stackoverflow.com/users/2189127/james-d"
    },
    "creation_date" : 1747766655,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140443728,
    "post_id" : 79629760,
    "body" : "@James_D I cannot do what you propose, because if read/writeObject methods from DataBaseIncremental were protected (otherwise I could&#39;nt call them from the subclasses) it seems not to call them anyways (I checked with the logging and it never appears). I think it doesnt recognize inherited read/writeObject methods because they are declared protected, not private, but the fact is that they cannot be (for then, they couldn&#39;t inherit from DataBaseIncremental, and its visibility cannot be reduce anyways)",
    "score" : 0,
    "owner" : {
      "account_id" : 22412187,
      "reputation" : 33,
      "user_id" : 16620767,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/pFx2e.jpg?s=256",
      "display_name" : "Satoshi",
      "link" : "https://stackoverflow.com/users/16620767/satoshi"
    },
    "creation_date" : 1747763889,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140443689,
    "post_id" : 79629760,
    "body" : "This certainly should work.  No code should be needed in subclasses.  They do not inherit readObject and they don’t need to;  the DataBaseIncremental class is entirely responsible for managing the serialization of its own state.  As for @SuppressWarnings, the only way to avoid @SuppressWarnings is to have an instance field of type <code>Class&lt;T&gt;</code>, so you can safely cast your Map keys and values.",
    "score" : 1,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44936,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1747763182,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140442679,
    "post_id" : 79629760,
    "body" : "I would strongly recommend not using object serialization as it has a lot of complicated pitfalls. See Joshua Bloch&#39;s <i>Effective Java</i> for a good discussion of this. Consider using a JSON or XML based library instead (e.g. Jackson or GSON).",
    "score" : 5,
    "owner" : {
      "account_id" : 2518243,
      "reputation" : 210906,
      "user_id" : 2189127,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
      "display_name" : "James_D",
      "link" : "https://stackoverflow.com/users/2189127/james-d"
    },
    "creation_date" : 1747746624,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140441627,
    "post_id" : 79629760,
    "body" : "Classes that implement <a href=\"https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/io/Serializable.html\" rel=\"nofollow noreferrer\">Serializable</a> should declare a <code>serialVersionUID</code> class, member variable.",
    "score" : 0,
    "owner" : {
      "account_id" : 2485939,
      "reputation" : 20969,
      "user_id" : 2164365,
      "user_type" : "registered",
      "accept_rate" : 40,
      "profile_image" : "https://i.sstatic.net/RKSgV.png?s=256",
      "display_name" : "Abra",
      "link" : "https://stackoverflow.com/users/2164365/abra"
    },
    "creation_date" : 1747724433,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}