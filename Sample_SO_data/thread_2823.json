{
  "question" : {
    "question_id" : 79592204,
    "title" : "Could not reconfigure JMX java.lang.LinkageError",
    "body" : "<p>Java 8</p>\n<p>Maven 3.9,7</p>\n<p>I want to validate that a private method was called once.</p>\n<p>In my <code>pom.xml</code>:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.mockito&lt;/groupId&gt;\n    &lt;artifactId&gt;mockito-core&lt;/artifactId&gt;\n    &lt;version&gt;3.12.4&lt;/version&gt;\n    &lt;scope&gt;test&lt;/scope&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.mockito&lt;/groupId&gt;\n    &lt;artifactId&gt;mockito-inline&lt;/artifactId&gt;\n    &lt;version&gt;3.12.4&lt;/version&gt;\n    &lt;scope&gt;test&lt;/scope&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.powermock&lt;/groupId&gt;\n    &lt;artifactId&gt;powermock-module-junit4&lt;/artifactId&gt;\n    &lt;version&gt;2.0.2&lt;/version&gt;\n    &lt;scope&gt;test&lt;/scope&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.powermock&lt;/groupId&gt;\n    &lt;artifactId&gt;powermock-api-mockito2&lt;/artifactId&gt;\n    &lt;version&gt;2.0.2&lt;/version&gt;\n    &lt;scope&gt;test&lt;/scope&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>Here's my class:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class MyClass {\n    \n    @Override\n    public void handle(AttendantRequestEvent event) {\n        String eventId = UUID.randomUUID().toString();\n        myPrivateMethod(eventId, eventId);\n    }\n\n    private void myPrivateMethod(String eventId, String eventId2) {\n        System.out.println(&quot;myPrivateMethod, eventId = &quot; + eventId + &quot;, eventId2 = &quot; + eventId2);\n    }\n}\n</code></pre>\n<p>Here's the unit test:</p>\n<pre class=\"lang-java prettyprint-override\"><code>import static org.assertj.core.api.Assertions.assertThat;\nimport static org.junit.Assert.assertNotNull;\nimport static org.mockito.Answers.RETURNS_DEEP_STUBS;\nimport static org.mockito.ArgumentMatchers.any;\nimport static org.mockito.Mockito.*;\nimport org.junit.Before;\nimport org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.mockito.*;\nimport org.powermock.api.mockito.PowerMockito;\nimport org.powermock.core.classloader.annotations.PrepareForTest;\nimport org.powermock.modules.junit4.PowerMockRunner;\n\n@RunWith(PowerMockRunner.class)\n@PrepareForTest(MyClass.class)\npublic class MyClassTest {\n\n    @Test\n    public void shouldCallMyPrivateMethod() throws Exception {\n        try (MockedStatic&lt;UUID&gt; utilities = Mockito.mockStatic(UUID.class)) {\n            AssistanceRequestsHandler assistanceRequestsHandlerMock =\n                    PowerMockito.spy(new AssistanceRequestsHandler());\n            String fixedUuid = &quot;a1b2c3d4-e5f6-7890-1234-567890abcdef&quot;;\n            UUID uuidMock = mock(UUID.class);\n            utilities.when(UUID::randomUUID).thenReturn(uuidMock);\n            when(uuidMock.toString()).thenReturn(fixedUuid);\n\n            // Act\n            assistanceRequestsHandlerMock.handle(new InfoEvent(any()));\n\n            // Assert\n            PowerMockito.verifyPrivate(assistanceRequestsHandlerMock, times(1))\n                    .invoke(&quot;myPrivateMethod&quot;, fixedUuid, fixedUuid);\n        }\n    }\n}\n</code></pre>\n<p>And it's working just fine.\nHere's a result:</p>\n<pre class=\"lang-none prettyprint-override\"><code>myPrivateMethod, eventId = a1b2c3d4-e5f6-7890-1234-567890abcdef, eventId2 = a1b2c3d4-e5f6-7890-1234-567890abcdef\n</code></pre>\n<p>Nice.</p>\n<p>Now, I want to use a logger in my private method, e.g. something like this (in <code>MyClass.java</code>):</p>\n<pre class=\"lang-java prettyprint-override\"><code>private void myPrivateMethod(String eventId, String eventId2) {\n    Logger.info(this, &quot;myPrivateMethod, eventId_1 = {}, eventId_2 {}&quot;, eventId, eventId2);\n}\n</code></pre>\n<p>And the test was successfully passed, but it raised the next error:</p>\n<pre class=\"lang-none prettyprint-override\"><code>ScriptEngineManager providers.next(): javax.script.ScriptEngineFactory: Provider jdk.nashorn.api.scripting.NashornScriptEngineFactory not a subtype\n2025-04-25 12:12:15,086 main ERROR Could not reconfigure JMX java.lang.LinkageError: loader constraint violation: loader (instance of org/powermock/core/classloader/javassist/JavassistMockClassLoader) previously initiated loading for a different type with name &quot;javax/management/MBeanServer&quot;\n    at java.lang.ClassLoader.defineClass1(Native Method)\n    at java.lang.ClassLoader.defineClass(ClassLoader.java:757)\n    at org.powermock.core.classloader.javassist.JavassistMockClassLoader.loadUnmockedClass(JavassistMockClassLoader.java:90)\n    at org.powermock.core.classloader.MockClassLoader.loadClassByThisClassLoader(MockClassLoader.java:104)\n    at org.powermock.core.classloader.DeferSupportingClassLoader.loadClass1(DeferSupportingClassLoader.java:147)\n    at org.powermock.core.classloader.DeferSupportingClassLoader.loadClass(DeferSupportingClassLoader.java:98)\n    at java.lang.ClassLoader.loadClass(ClassLoader.java:352)\n    at org.apache.logging.log4j.core.jmx.Server.unregisterAllMatching(Server.java:337)\n</code></pre>\n",
    "tags" : [ "java", "mockito", "powermock" ],
    "owner" : {
      "account_id" : 9162277,
      "reputation" : 15965,
      "user_id" : 6813231,
      "user_type" : "registered",
      "accept_rate" : 56,
      "profile_image" : "https://i.sstatic.net/gy8Sg.jpg?s=256",
      "display_name" : "Alexei",
      "link" : "https://stackoverflow.com/users/6813231/alexei"
    },
    "is_answered" : false,
    "view_count" : 107,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1745615505,
    "creation_date" : 1745572723,
    "link" : "https://stackoverflow.com/questions/79592204/could-not-reconfigure-jmx-java-lang-linkageerror",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140370593,
    "post_id" : 79592204,
    "body" : "Following up on &quot;mocking UUID&quot;: you are not basically testing anything. If you change your verification to <code>verifyPrivate(&quot;myPrivateMethod&quot;, anyString(), anyString))</code>, it would be equally &quot;good&quot;. If you use two argument captors, you could even assert that both arguments are the same/equal.",
    "score" : 1,
    "owner" : {
      "account_id" : 39208,
      "reputation" : 269387,
      "user_id" : 112968,
      "user_type" : "registered",
      "accept_rate" : 68,
      "profile_image" : "https://i.sstatic.net/zHTaT.png?s=256",
      "display_name" : "knittl",
      "link" : "https://stackoverflow.com/users/112968/knittl"
    },
    "creation_date" : 1745614520,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140370584,
    "post_id" : 79592204,
    "body" : "Likely not your problem, but <code>assistanceRequestsHandlerMock.handle(new InfoEvent(any()));</code> is nonsense. <code>any()</code> must only be used when stubbing or verifying methods. It cannot be used as arguments to other methods and will corrupt Mockito&#39;s Matcher stack. That and it simply returns <code>null</code>, so the call is effectively <code>new InfoEvent(null)</code> (plus, as written: confusing Mockito by having unused matchers on its stack). I&#39;m really not sure if stubbing the static <code>UUID.randomUUID()</code> function is a good idea. And if I remember corectly, you cannot stub <code>toString()</code>, but I might be mistaken here",
    "score" : 1,
    "owner" : {
      "account_id" : 39208,
      "reputation" : 269387,
      "user_id" : 112968,
      "user_type" : "registered",
      "accept_rate" : 68,
      "profile_image" : "https://i.sstatic.net/zHTaT.png?s=256",
      "display_name" : "knittl",
      "link" : "https://stackoverflow.com/users/112968/knittl"
    },
    "creation_date" : 1745614356,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}