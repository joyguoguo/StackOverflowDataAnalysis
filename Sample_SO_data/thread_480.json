{
  "question" : {
    "question_id" : 79802303,
    "title" : "Issues setting up an Android Device Owner app with QR provisioning",
    "body" : "<p>I'm having some serious headaches over trying to make QR provisioning work on a mobile device that is supposed to run an app in kiosk mode.</p>\n<p>Here's some initial disclaimers in case you're asking:</p>\n<ul>\n<li>The target device is a Xiaomi Redmi 14C;</li>\n<li>It has no SIM Card inserted in any of the two slots (yet);</li>\n<li>I'm developing the app on Android Studio using Windows.</li>\n</ul>\n<h1><strong>The problem:</strong></h1>\n<p>The issue i'm having happens in the setup wizard as i try to make a qr provisioning of my app to set it as the device owner and enforce DPM policies, which simply throws back a generic &quot;Can't set up device. Contact your IT admin for help&quot;.</p>\n<p>The way I'm currently trying to do it is:</p>\n<ul>\n<li>Tapping 6 times on the setup wizard screen until the &quot;scanning for QR code&quot; screen comes up.</li>\n<li>Scanning the QR Code.</li>\n<li>Establishing a WiFi connection.</li>\n<li>The device loads for a bit, until the &quot;This device belongs to your organisation&quot; screen comes up. It gives me the only option to click on &quot;Next&quot;.</li>\n<li>On click, the screen does seem to change but a popup immediately shows up, stating &quot;Can't set up device. Contact your IT admin for help&quot;.</li>\n</ul>\n<p>Everything listed in the section below gave the same exact outcome.</p>\n<h1><strong>What I tried:</strong></h1>\n<p>Initially, I tried some other ways to get my custom app to run as the device owner.</p>\n<ul>\n<li>Trying to use adb:\nBoth</li>\n</ul>\n<pre class=\"lang-bash prettyprint-override\"><code>set-device-owner\n</code></pre>\n<p>and</p>\n<pre class=\"lang-bash prettyprint-override\"><code>set-profile-owner\n</code></pre>\n<p>are denied, returning a\n<code>&quot;Calling Identity is not authorized&quot;</code>\nerror. I've concluded that this likely happens because there already is an existing profile and/or device owner which is protecting the device.</p>\n<ul>\n<li><p>Trying to use adb (after a fresh factory reset):\nSimply unavailable. USB debug is a developer feature and requires manual activation <em>after</em> the setup wizard, which would present the same issues from the first point.</p>\n</li>\n<li><p>Trying to use Google Cloud's projects with Android Management API policy:\nPossibly the most modular solution, but impossible for me. The policy is only able to download and set policies over apps available on play Store, and my app will not set foot on that platform. It is still not clear for me if play Store apps can actually be made 'private' or 'unlisted', which is necessary for me because I'm doing this project for a small industry, and normal play Store users should not be able to access it, but only the manually approved devices. Either way, if there actually is such a feature, the Android Management API integration probably requires a Google Play Developer account for Organisations (not a personal one), which requires a D-U-N-S number which my company does not have (Of course, correct me if i'm wrong and if i can <em>actually</em> simply use a personal account).</p>\n</li>\n</ul>\n<h1><strong>What I did not (and will not) try:</strong></h1>\n<ul>\n<li>Rooting the android device to enable ADB by default on factory reset:\nThat is something i have never done and messing with system files is subject to significant risks i can't bring myself to take, from evading the device's warranty to completely bricking the device.</li>\n</ul>\n<h1><strong>My current setup:</strong></h1>\n<p>This is the current JSON payload that I'm using for the QR code provisioning:</p>\n<pre><code>{\n    &quot;android.app.extra.PROVISIONING_DEVICE_ADMIN_COMPONENT_NAME&quot;: &quot;com.mycompany.marcatempo/com.mycompany.marcatempo.MyDeviceAdminReceiver&quot;,\n    &quot;android.app.extra.PROVISIONING_DEVICE_ADMIN_PACKAGE_LOCATION&quot;: &quot;https://path-to-my.apk&quot;,\n    &quot;android.app.extra.PROVISIONING_DEVICE_ADMIN_PACKAGE_CHECKSUM&quot;: &quot;some-valid-checksum&quot;,\n    &quot;android.app.extra.PROVISIONING_SKIP_ENCRYPTION&quot;: true,\n\n    &quot;android.app.extra.PROVISIONING_LEAVE_ALL_SYSTEM_APPS_ENABLED&quot;: true,\n    &quot;android.app.extra.PROVISIONING_ADMIN_EXTRAS_BUNDLE&quot;: {\n    }\n}\n</code></pre>\n<p>This was very confusing for me, because many templates were actually different on different reference sites:</p>\n<p><strong>PROVISIONING_DEVICE_ADMIN_COMPONENT_NAME:</strong>\nI've tried both writing it like this</p>\n<pre><code>com.mycompany.marcatempo/com.mycompany.marcatempo.MyDeviceAdminReceiver\n</code></pre>\n<p>and like this</p>\n<pre><code>com.mycompany.marcatempo/.MyDeviceAdminReceiver\n</code></pre>\n<p>As some sites showed it written differently.</p>\n<p><strong>PROVISIONING_DEVICE_ADMIN_PACKAGE_CHECKSUM:</strong>\nI've generated this in different ways, as some sites showed this step differently as well. I tried to generate the checksum using Git Bash:</p>\n<pre><code>cat C:/path/to/app-release.apk | &quot;C:/Program Files/OpenSSL-Win64/bin/openssl.exe&quot; dgst -binary -sha256 | openssl base64 | tr '+/' '-_' | tr -d '='\n</code></pre>\n<p>And using Windows Powershell:</p>\n<pre class=\"lang-bash prettyprint-override\"><code>Get-FileHash -Path &quot;C:\\path\\to\\release-app.apk&quot; -Algorithm SHA256\n</code></pre>\n<p>Both gave me some very different results.</p>\n<p><strong>PROVISIONING_SKIP_ENCRYPTION:</strong>\nI've attempted to set this as true, false and even removing it completely.</p>\n<p><strong>PROVISIONING_LEAVE_ALL_SYSTEM_APPS_ENABLED | PROVISIONING_ADMIN_EXTRAS_BUNDLE:</strong>\nThese are extra options which <em>seem</em> harmless. I've included them because one of the templates did.</p>\n<p>According to <a href=\"https://stackoverflow.com/questions/71989742/device-owner-qr-stopped-working-on-android12-devices-getting-cant-set-up-devic\">this question</a>, on Android 12+ devices these kinds of apps require some extra classes and an extended manifest setup. I already did try to implement those things listed in the solution, but it was no use for me. Below I'll append the relevant files:</p>\n<p><strong>AndroidManifest.xml</strong></p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n    xmlns:tools=&quot;http://schemas.android.com/tools&quot;\n    package=&quot;com.mycompany.marcatempo&quot;&gt;\n\n    &lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;\n    &lt;uses-permission android:name=&quot;android.permission.NFC&quot; /&gt;\n    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;\n\n    &lt;uses-feature android:name=&quot;android.hardware.nfc.hce&quot; android:required=&quot;true&quot;/&gt;\n\n    &lt;uses-permission android:name=&quot;android.permission.VIBRATE&quot; /&gt;\n\n    &lt;application\n        android:testOnly=&quot;false&quot;\n        android:dataExtractionRules=&quot;@xml/data_extraction_rules&quot;\n        android:fullBackupContent=&quot;@xml/backup_rules&quot;\n        android:icon=&quot;@mipmap/ic_launcher&quot;\n        android:label=&quot;@string/app_name&quot;\n        android:roundIcon=&quot;@mipmap/ic_launcher_round&quot;\n        android:supportsRtl=&quot;true&quot;\n        android:theme=&quot;@style/Theme.SimpleNFC&quot;&gt;\n\n        &lt;service\n            android:name=&quot;com.mycompany.marcatempo.MyHceService&quot;\n            android:exported=&quot;true&quot;\n            android:permission=&quot;android.permission.BIND_NFC_SERVICE&quot;&gt;\n\n            &lt;intent-filter&gt;\n                &lt;action android:name=&quot;android.nfc.cardemulation.action.HOST_APDU_SERVICE&quot; /&gt;\n            &lt;/intent-filter&gt;\n\n            &lt;meta-data\n                android:name=&quot;android.nfc.cardemulation.host_apdu_service&quot;\n                android:resource=&quot;@xml/apduservice&quot; /&gt;\n        &lt;/service&gt;\n\n        &lt;activity\n            android:name=&quot;com.mycompany.marcatempo.MainActivity&quot;\n            android:launchMode=&quot;singleInstance&quot;\n            android:clearTaskOnLaunch=&quot;true&quot;\n            android:stateNotNeeded=&quot;true&quot;\n            android:exported=&quot;true&quot;\n            android:screenOrientation=&quot;portrait&quot;\n            tools:ignore=&quot;DiscouragedApi,LockedOrientationActivity&quot;&gt;\n\n            &lt;intent-filter&gt;\n                &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;\n                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;\n                &lt;category android:name=&quot;android.intent.category.HOME&quot; /&gt;\n                &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;\n            &lt;/intent-filter&gt;\n        &lt;/activity&gt;\n\n        &lt;activity\n            android:name=&quot;com.mycompany.marcatempo.AdminPolicyComplianceActivity&quot;\n            android:exported=&quot;true&quot;\n            android:enabled=&quot;@bool/provision_mode_compliance_enabled&quot;\n            android:theme=&quot;@style/Theme.AppCompat&quot;\n            android:permission=&quot;android.permission.BIND_DEVICE_ADMIN&quot;&gt;\n            &lt;intent-filter&gt;\n                &lt;action android:name=&quot;android.app.action.ADMIN_POLICY_COMPLIANCE&quot;/&gt;\n                &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;\n            &lt;/intent-filter&gt;\n        &lt;/activity&gt;\n\n        &lt;activity\n            android:name=&quot;com.mycompany.marcatempo.ProvisioningModeActivity&quot;\n            android:exported=&quot;true&quot;\n            android:enabled=&quot;@bool/provision_mode_compliance_enabled&quot;\n            android:theme=&quot;@style/Theme.AppCompat&quot;\n            android:permission=&quot;android.permission.BIND_DEVICE_ADMIN&quot;&gt;\n            &lt;intent-filter&gt;\n                &lt;action android:name=&quot;android.app.action.GET_PROVISIONING_MODE&quot; /&gt;\n                &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;\n            &lt;/intent-filter&gt;\n        &lt;/activity&gt;\n\n\n        &lt;receiver\n            android:name=&quot;com.mycompany.marcatempo.MyDeviceAdminReceiver&quot;\n            android:exported=&quot;true&quot;\n            android:permission=&quot;android.permission.BIND_DEVICE_ADMIN&quot;&gt;\n            &lt;meta-data\n                android:name=&quot;android.app.device_admin&quot;\n                android:resource=&quot;@xml/device_admin_receiver&quot; /&gt;\n            &lt;intent-filter&gt;\n                &lt;action android:name=&quot;android.app.action.DEVICE_ADMIN_ENABLED&quot; /&gt;\n            &lt;/intent-filter&gt;\n        &lt;/receiver&gt;\n\n        &lt;provider\n            android:name=&quot;androidx.core.content.FileProvider&quot;\n            android:authorities=&quot;${applicationId}.provider&quot;\n            android:exported=&quot;false&quot;\n            android:grantUriPermissions=&quot;true&quot;&gt;\n            &lt;meta-data\n                android:name=&quot;android.support.FILE_PROVIDER_PATHS&quot;\n                android:resource=&quot;@xml/file_paths&quot; /&gt;\n        &lt;/provider&gt;\n\n    &lt;/application&gt;\n\n&lt;/manifest&gt;\n</code></pre>\n<p><strong>AdminPolicyComplianceActivity.java</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>import android.content.Intent;\nimport android.os.Bundle;\nimport androidx.appcompat.app.AppCompatActivity;\n\n\n\npublic class AdminPolicyComplianceActivity extends AppCompatActivity {\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_policy_compliance);\n\n        Intent intent = getIntent();\n\n        setResult(RESULT_OK, intent);\n        finish();\n    }\n}\n</code></pre>\n<p><strong>ProvisioningModeActivity.java</strong></p>\n<pre><code>import static android.app.admin.DevicePolicyManager.EXTRA_PROVISIONING_ADMIN_EXTRAS_BUNDLE;\n\nimport android.content.Intent;\nimport android.os.Build;\nimport android.os.Bundle;\nimport android.os.PersistableBundle;\n\nimport androidx.appcompat.app.AppCompatActivity;\n\nimport java.util.List;\n\npublic class ProvisioningModeActivity extends AppCompatActivity {\n\n    private String EXTRA_PROVISIONING_ALLOWED_PROVISIONING_MODES = &quot;android.app.extra.PROVISIONING_ALLOWED_PROVISIONING_MODES&quot;;\n    private int PROVISIONING_MODE_FULLY_MANAGED_DEVICE = 1;\n    private int PROVISIONING_MODE_MANAGED_PROFILE = 2;\n    private String EXTRA_PROVISIONING_MODE = &quot;android.app.extra.PROVISIONING_MODE&quot;;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_get_provisioning_mode);\n\n        Intent intent = getIntent();\n        int provisioningMode = PROVISIONING_MODE_FULLY_MANAGED_DEVICE;\n        List&lt;Integer&gt; allowedProvisioningModes = intent.getIntegerArrayListExtra(EXTRA_PROVISIONING_ALLOWED_PROVISIONING_MODES);\n\n        if (allowedProvisioningModes != null) {\n            if (allowedProvisioningModes.contains(PROVISIONING_MODE_FULLY_MANAGED_DEVICE)) {\n                provisioningMode = PROVISIONING_MODE_FULLY_MANAGED_DEVICE;\n            } else if (allowedProvisioningModes.contains(PROVISIONING_MODE_MANAGED_PROFILE)) {\n                provisioningMode = PROVISIONING_MODE_MANAGED_PROFILE;\n            }\n        }\n        //grab the extras (might contain some needed values from QR code) and pass to AdminPolicyComplianceActivity\n        PersistableBundle extras = intent.getParcelableExtra(EXTRA_PROVISIONING_ADMIN_EXTRAS_BUNDLE);\n        Intent resultIntent = getIntent();\n\n        if (extras != null) {\n            if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {\n                resultIntent.putExtra(EXTRA_PROVISIONING_ADMIN_EXTRAS_BUNDLE, extras);\n            }\n        }\n        resultIntent.putExtra(EXTRA_PROVISIONING_MODE, provisioningMode);\n\n        setResult(RESULT_OK, resultIntent);\n        finish();\n    }\n}\n</code></pre>\n<p><strong>MyDeviceAdminReceiver.java</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>import android.app.admin.DeviceAdminReceiver;\nimport android.content.Context;\nimport android.content.Intent;\n\npublic class MyDeviceAdminReceiver extends DeviceAdminReceiver {\n    @Override\n    public void onEnabled(Context context, Intent intent) {\n        super.onEnabled(context, intent);\n    }\n\n    @Override\n    public void onDisabled(Context context, Intent intent) {\n        super.onDisabled(context, intent);\n    }\n}\n</code></pre>\n<p><strong>xml/device_admin_receiver.xml</strong></p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;device-admin xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;\n    &lt;uses-policies&gt;\n        &lt;limit-password /&gt;\n        &lt;watch-login /&gt;\n        &lt;reset-password /&gt;\n        &lt;force-lock /&gt;\n        &lt;wipe-data /&gt;\n    &lt;/uses-policies&gt;\n&lt;/device-admin&gt;\n</code></pre>\n<p><strong>layout/activity_get_provisioning_mode.xml</strong></p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n    xmlns:tools=&quot;http://schemas.android.com/tools&quot;\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;\n    tools:context=&quot;.ProvisioningModeActivity&quot;&gt;\n\n    &lt;TextView\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;Policy Compliance Screen&quot;/&gt;\n\n&lt;/LinearLayout&gt;\n</code></pre>\n<p><strong>layout/activity_policy_compliance.xml</strong></p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n    xmlns:tools=&quot;http://schemas.android.com/tools&quot;\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;\n    tools:context=&quot;.AdminPolicyComplianceActivity&quot;&gt;\n\n    &lt;TextView\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;Policy Compliance Screen&quot;/&gt;\n\n&lt;/LinearLayout&gt;\n</code></pre>\n<p><strong>values/bool.xml</strong></p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;resources&gt;\n    &lt;bool name=&quot;provision_mode_compliance_enabled&quot;&gt;false&lt;/bool&gt;\n&lt;/resources&gt;\n</code></pre>\n<p><strong>values-v31/bool.xml</strong></p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;resources&gt;\n    &lt;bool name=&quot;provision_mode_compliance_enabled&quot;&gt;true&lt;/bool&gt;\n&lt;/resources&gt;\n</code></pre>\n",
    "tags" : [ "java", "android", "android-12", "device-owner", "android-device-owner" ],
    "owner" : {
      "account_id" : 34403947,
      "reputation" : 21,
      "user_id" : 26550078,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6c4302c07eadd0d90a71122e0bdc8e75?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "fulvin",
      "link" : "https://stackoverflow.com/users/26550078/fulvin"
    },
    "is_answered" : true,
    "view_count" : 252,
    "answer_count" : 1,
    "score" : 2,
    "last_activity_date" : 1761743576,
    "creation_date" : 1761605184,
    "link" : "https://stackoverflow.com/questions/79802303/issues-setting-up-an-android-device-owner-app-with-qr-provisioning",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79803830,
    "question_id" : 79802303,
    "body" : "<h1>Update</h1>\n<p>I actually managed to figure it out for myself, and it was actually something extremely hard to guess from the things I've shared. For that, I apologize.\nMy setup was actually a fully working solution. The real issue that caused the QR provisioning to fail was actually a problem with the download link requiring an http auth.\nAlthough this was a pretty special case, I feel the need to let everyone know:\n<em>Do NOT use links requiring HTTP authentication</em> (&quot;https://username:password@your-domain.com&quot; format)<em>. Even if they work on each of your devices, they will not work on a QR provisioning setup</em></p>\n<p>Since my link seemed to work on many browsers and all my devices, i was sure it would've actually worked on my target device as well. Seems like it was not the case.</p>\n<p><strong>For anyone else struggling with this, here's an actually working setup to make a QR code for Android Provisioning:</strong></p>\n<pre><code>\n{\n    &quot;android.app.extra.PROVISIONING_DEVICE_ADMIN_COMPONENT_NAME&quot;: &quot;com.mycompany.myapp/.MyDeviceAdminReceiver&quot;,\n    &quot;android.app.extra.PROVISIONING_DEVICE_ADMIN_PACKAGE_DOWNLOAD_LOCATION&quot;: &quot;https://path/to/your/package.apk&quot;,\n    &quot;android.app.extra.PROVISIONING_DEVICE_ADMIN_PACKAGE_CHECKSUM&quot;: &quot;sha256-checksum&quot;,\n    &quot;android.app.extra.PROVISIONING_SKIP_ENCRYPTION&quot;: true,\n    &quot;android.app.extra.PROVISIONING_LEAVE_ALL_SYSTEM_APPS_ENABLED&quot;: true\n}\n</code></pre>\n<ul>\n<li>PROVISIONING_DEVICE_ADMIN_COMPONENT_NAME:</li>\n</ul>\n<p>This takes the admin receiver class. Something like this was enough for me:</p>\n<p><strong>AndroidManifext.xml</strong></p>\n<pre><code>&lt;receiver\n            android:name=&quot;com.mycompany.myapp.MyDeviceAdminReceiver&quot;\n            android:exported=&quot;true&quot;\n            android:permission=&quot;android.permission.BIND_DEVICE_ADMIN&quot;&gt;\n            &lt;meta-data\n                android:name=&quot;android.app.device_admin&quot;\n                android:resource=&quot;@xml/device_admin_receiver&quot; /&gt;\n            &lt;intent-filter&gt;\n                &lt;action android:name=&quot;android.app.action.DEVICE_ADMIN_ENABLED&quot; /&gt;\n            &lt;/intent-filter&gt;\n        &lt;/receiver&gt;\n</code></pre>\n<p><strong>MyDeviceAdminReceiver.java</strong></p>\n<pre><code>import android.app.admin.DeviceAdminReceiver;\nimport android.content.Context;\nimport android.content.Intent;\nimport android.util.Log;\n\npublic class MyDeviceAdminReceiver extends DeviceAdminReceiver {\n    private static final String TAG = &quot;DeviceAdminReceiver&quot;;\n\n    @Override\n    public void onEnabled(Context context, Intent intent) {\n        super.onEnabled(context, intent);\n        Log.d(TAG, &quot;Device Admin Enabled&quot;);\n    }\n\n    @Override\n    public void onProfileProvisioningComplete(Context context, Intent intent) {\n        super.onProfileProvisioningComplete(context, intent);\n        Log.d(TAG, &quot;Profile Provisioning Complete&quot;);\n    }\n}\n</code></pre>\n<p><strong>xml/device_admin_receiver.xml</strong></p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;device-admin xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;\n    &lt;uses-policies&gt;\n        &lt;limit-password /&gt;\n        &lt;watch-login /&gt;\n        &lt;reset-password /&gt;\n        &lt;force-lock /&gt;\n        &lt;wipe-data /&gt;\n    &lt;/uses-policies&gt;\n&lt;/device-admin&gt;\n</code></pre>\n<ul>\n<li><p>PROVISIONING_DEVICE_ADMIN_PACKAGE_DOWNLOAD_LOCATION:\nThis takes the URL towards the android package you want to fetch and set as device owner. As I said, it must be a publicly available link, with no inline HTTP authentication.</p>\n</li>\n<li><p>PROVISIONING_DEVICE_ADMIN_PACKAGE_CHECKSUM:\nThis takes the checksum of your package (not your .jks key). Make sure your package is properly signed with apksigner.bat (Usually located in <code>C:/Users/User/Local/Android/Sdk/build-tools/&lt;version&gt;/apksigner.bat</code>). Then, <strong>on Windows</strong>, you can use this batch script to generate a reliable checksum:</p>\n</li>\n</ul>\n<pre><code>@echo off\npowershell -NoExit -Command ^\n  &quot;$hash = (Get-FileHash -Path 'C:/path/to/your/app-release.apk' -Algorithm SHA256).Hash; &quot; ^\n  &quot;$hexBytes = $hash -replace '..', '0x$0 '; &quot; ^\n  &quot;$bytes = $hexBytes.Trim().Split(' ') | ForEach-Object { [Convert]::ToByte($_, 16) }; &quot; ^\n  &quot;$base64 = [Convert]::ToBase64String($bytes); &quot; ^\n  &quot;$base64 = $base64.Replace('+', '-').Replace('/', '_').Replace('=', ''); &quot; ^\n  &quot;Write-Output ($base64); &quot;\n</code></pre>\n<p>Copy everything that was printed and you can paste it in your PROVISIONING_DEVICE_ADMIN_PACKAGE_CHECKSUM field of the JSON payload.</p>\n<p>At this point you should be good to go. You can generate the QR code image in several ways. I did it using this little Python script:</p>\n<pre><code>import json\nimport qrcode\n\nwith open(&quot;provisioning.json&quot;, &quot;r&quot;) as f:\n    data = json.load(f)\n\njson_str = json.dumps(data, separators=(',', ':'))\n\nimg = qrcode.make(json_str)\n\nqr_image = &quot;provisioning_qr.png&quot;\n\nimg.save(qr_image)\n\nprint(&quot;QR code saved as &quot; + qr_image)\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 34403947,
      "reputation" : 21,
      "user_id" : 26550078,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6c4302c07eadd0d90a71122e0bdc8e75?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "fulvin",
      "link" : "https://stackoverflow.com/users/26550078/fulvin"
    },
    "creation_date" : 1761743152,
    "last_activity_date" : 1761743576,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140822877,
    "post_id" : 79802303,
    "body" : "Then perhaps try on a Google Pixel or one of the Samsung Galaxy series. IMHO, you need to be able to disambiguate between you doing something wrong and Xiaomi doing something wrong.",
    "score" : 0,
    "owner" : {
      "account_id" : 39846,
      "reputation" : 1011205,
      "user_id" : 115145,
      "user_type" : "registered",
      "accept_rate" : 84,
      "profile_image" : "https://i.sstatic.net/wDnd8.png?s=256",
      "display_name" : "CommonsWare",
      "link" : "https://stackoverflow.com/users/115145/commonsware"
    },
    "creation_date" : 1761662260,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140822825,
    "post_id" : 79802303,
    "body" : "I&#39;m trying but emulators do not seem to have a setup wizard at all. Most I can do on emulators is probably make and set profile owners, which is not the same thing, as profile owners cannot enforce kiosk mode policies.",
    "score" : 0,
    "owner" : {
      "account_id" : 34403947,
      "reputation" : 21,
      "user_id" : 26550078,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6c4302c07eadd0d90a71122e0bdc8e75?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "fulvin",
      "link" : "https://stackoverflow.com/users/26550078/fulvin"
    },
    "creation_date" : 1761661154,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140821478,
    "post_id" : 79802303,
    "body" : "Have you tried on anything other than this Xiaomi device, such as an emulator?",
    "score" : 0,
    "owner" : {
      "account_id" : 39846,
      "reputation" : 1011205,
      "user_id" : 115145,
      "user_type" : "registered",
      "accept_rate" : 84,
      "profile_image" : "https://i.sstatic.net/wDnd8.png?s=256",
      "display_name" : "CommonsWare",
      "link" : "https://stackoverflow.com/users/115145/commonsware"
    },
    "creation_date" : 1761605749,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}