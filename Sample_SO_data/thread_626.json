{
  "question" : {
    "question_id" : 79788082,
    "title" : "When should I use name resolution vs. RegisterNatives in JNI?",
    "body" : "<p>In <code>System.c</code>, the JVM function corresponding to Java’s <code>System.currentTimeMillis()</code> is registered using RegisterNatives.<br />\nIn contrast, <code>System.identityHashCode(Object)</code> calls a JVM function directly based on the naming convention.</p>\n<p><a href=\"https://github.com/openjdk/jdk/blob/9b99bc8ef53ad20c4f1cb5d26cffc64b0deb79ad/src/java.base/share/native/libjava/System.c#L39-L59\" rel=\"nofollow noreferrer\">https://github.com/openjdk/jdk/blob/9b99bc8ef53ad20c4f1cb5d26cffc64b0deb79ad/src/java.base/share/native/libjava/System.c#L39-L59</a></p>\n<pre class=\"lang-c prettyprint-override\"><code>/* Only register the performance-critical methods */\nstatic JNINativeMethod methods[] = {\n    {&quot;currentTimeMillis&quot;, &quot;()J&quot;,              (void *)&amp;JVM_CurrentTimeMillis},\n    {&quot;nanoTime&quot;,          &quot;()J&quot;,              (void *)&amp;JVM_NanoTime},\n    {&quot;arraycopy&quot;,     &quot;(&quot; OBJ &quot;I&quot; OBJ &quot;II)V&quot;, (void *)&amp;JVM_ArrayCopy},\n};\n\nJNIEXPORT void JNICALL\nJava_java_lang_System_registerNatives(JNIEnv *env, jclass cls)\n{\n    (*env)-&gt;RegisterNatives(env, cls,\n                            methods, sizeof(methods)/sizeof(methods[0]));\n}\n\nJNIEXPORT jint JNICALL\nJava_java_lang_System_identityHashCode(JNIEnv *env, jobject this, jobject x)\n{\n    return JVM_IHashCode(env, x);\n}\n</code></pre>\n<p>Both approaches are used, but what determines which one to use?</p>\n",
    "tags" : [ "java", "c", "java-native-interface" ],
    "owner" : {
      "account_id" : 2182945,
      "reputation" : 1737,
      "user_id" : 1932017,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e7616d89db29c9dd38b7ac21fdf302ff?s=256&d=identicon&r=PG",
      "display_name" : "YujiSoftware",
      "link" : "https://stackoverflow.com/users/1932017/yujisoftware"
    },
    "is_answered" : false,
    "view_count" : 458,
    "answer_count" : 0,
    "score" : 6,
    "last_activity_date" : 1762881426,
    "creation_date" : 1760193851,
    "link" : "https://stackoverflow.com/questions/79788082/when-should-i-use-name-resolution-vs-registernatives-in-jni",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140806472,
    "post_id" : 79788082,
    "body" : "Voting to reopen.  Objective answers are possible if there is a measurable performance difference between JNI calls made via <code>RegisterNatives()</code> and JNI calls made via name lookup.  Also adding the C tag, as JNI is a C interface.",
    "score" : 4,
    "owner" : {
      "account_id" : 6095312,
      "reputation" : 35086,
      "user_id" : 4756299,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6fe43a9d31f2308c4e64a62cf0c310d1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Andrew Henle",
      "link" : "https://stackoverflow.com/users/4756299/andrew-henle"
    },
    "creation_date" : 1760969053,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140794492,
    "post_id" : 79788082,
    "body" : "It’s a very early JVM initialization phase. It does not always work like in ordinary classes due to the circular dependencies of crucial classes. It still doesn’t mean it happens in the reference implementation, but the code is designed to keep working in environments where it happens.",
    "score" : 4,
    "owner" : {
      "account_id" : 3211603,
      "reputation" : 300981,
      "user_id" : 2711488,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/t2hoD.jpg?s=256",
      "display_name" : "Holger",
      "link" : "https://stackoverflow.com/users/2711488/holger"
    },
    "creation_date" : 1760434361,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140794484,
    "post_id" : 79788082,
    "body" : "@Holger I don&#39;t think that will happen. Because registerNatives is called from the static initializer. <a href=\"https://github.com/openjdk/jdk/blob/90cf3a2086cb0705dd519ff327be350e24a83af5/src/java.base/share/classes/java/lang/System.java#L107-L110\" rel=\"nofollow noreferrer\">github.com/openjdk/jdk/blob/&hellip;</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 2182945,
      "reputation" : 1737,
      "user_id" : 1932017,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e7616d89db29c9dd38b7ac21fdf302ff?s=256&d=identicon&r=PG",
      "display_name" : "YujiSoftware",
      "link" : "https://stackoverflow.com/users/1932017/yujisoftware"
    },
    "creation_date" : 1760433923,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140794428,
    "post_id" : 79788082,
    "body" : "I don’t think that this affects performance at all, as all four methods are actually handled as intrinsic. My guess is, this design accounts for the possibility that <code>identityHashCode(…)</code> might be called before <code>registerNatives()</code> in this JVM initialization phase.",
    "score" : 4,
    "owner" : {
      "account_id" : 3211603,
      "reputation" : 300981,
      "user_id" : 2711488,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/t2hoD.jpg?s=256",
      "display_name" : "Holger",
      "link" : "https://stackoverflow.com/users/2711488/holger"
    },
    "creation_date" : 1760432330,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140793720,
    "post_id" : 79788082,
    "body" : "@LouisWasserman Even with the identity hash code being stored in the object header (or <a href=\"https://wiki.openjdk.org/display/lilliput/Compact+Identity+Hashcode\" rel=\"nofollow noreferrer\">similar</a>), it is still necessary to perform that work natively (unless the JVM is written in Java). That being said, the current <a href=\"https://openjdk.org/jeps/401\" rel=\"nofollow noreferrer\">JEP draft on value classes and objects</a> would change <code>identityHashCode</code> to &quot;just&quot; use the contents of the objects and I&#39;d guess that caching that in object headers (yes, value objects sometimes have those) sounds like a bad idea.",
    "score" : 0,
    "owner" : {
      "account_id" : 15064163,
      "reputation" : 17100,
      "user_id" : 10871900,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/720202b6e19abc330dcd92e6a1254562?s=256&d=identicon&r=PG",
      "display_name" : "dan1st",
      "link" : "https://stackoverflow.com/users/10871900/dan1st"
    },
    "creation_date" : 1760388008,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140793592,
    "post_id" : 79788082,
    "body" : "I would not be shocked at all if <code>identityHashCode</code> required special handling.  Certainly I am under the impression that in at least some Java environments, identityHashCodes of objects are generated lazily, only for objects that explicitly request them.  That&#39;ll only get more relevant with Valhalla and value objects that don&#39;t even have identity.",
    "score" : 0,
    "owner" : {
      "account_id" : 465573,
      "reputation" : 200423,
      "user_id" : 869736,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/ae7bb06b9a23a4dd7eea69e853d47d12?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Louis Wasserman",
      "link" : "https://stackoverflow.com/users/869736/louis-wasserman"
    },
    "creation_date" : 1760383778,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140791550,
    "post_id" : 79788082,
    "body" : "You might also want to read <a href=\"https://meta.stackoverflow.com/a/323382\">Is asking &quot;why&quot; on language specifications still considered as &quot;primarily opinion-based&quot; if it can have official answers?</a> - I am not definitely saying your question is off-topic but that MSO post brings up a few points you might consider interesting.",
    "score" : 2,
    "owner" : {
      "account_id" : 15064163,
      "reputation" : 17100,
      "user_id" : 10871900,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/720202b6e19abc330dcd92e6a1254562?s=256&d=identicon&r=PG",
      "display_name" : "dan1st",
      "link" : "https://stackoverflow.com/users/10871900/dan1st"
    },
    "creation_date" : 1760289207,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140790992,
    "post_id" : 79788082,
    "body" : "I don&#39;t think Stack Overflow would be a good place to ask that as the only people who might be able to answer that would be the people writing/reviewing that code originally which was a long time ago (I think before the JDK was made Open Source).",
    "score" : 3,
    "owner" : {
      "account_id" : 15064163,
      "reputation" : 17100,
      "user_id" : 10871900,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/720202b6e19abc330dcd92e6a1254562?s=256&d=identicon&r=PG",
      "display_name" : "dan1st",
      "link" : "https://stackoverflow.com/users/10871900/dan1st"
    },
    "creation_date" : 1760257607,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140790977,
    "post_id" : 79788082,
    "body" : "@dan1st Why are only performance-critical methods registered? I think it would be better to register identityHashCode as well.",
    "score" : 0,
    "owner" : {
      "account_id" : 2182945,
      "reputation" : 1737,
      "user_id" : 1932017,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e7616d89db29c9dd38b7ac21fdf302ff?s=256&d=identicon&r=PG",
      "display_name" : "YujiSoftware",
      "link" : "https://stackoverflow.com/users/1932017/yujisoftware"
    },
    "creation_date" : 1760256444,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140790871,
    "post_id" : 79788082,
    "body" : "My guess would be it&#39;s about this comment &quot;Only register the performance-critical methods&quot; - Maybe <code>System.currentTimeMillis</code> is considered to be more performance-critical than <code>System.identityHashCode</code> in some way? Maybe for startup where <code>currentTimeMillis</code> might be needed a lot by the JVM itself?",
    "score" : 4,
    "owner" : {
      "account_id" : 15064163,
      "reputation" : 17100,
      "user_id" : 10871900,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/720202b6e19abc330dcd92e6a1254562?s=256&d=identicon&r=PG",
      "display_name" : "dan1st",
      "link" : "https://stackoverflow.com/users/10871900/dan1st"
    },
    "creation_date" : 1760248772,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}