{
  "question" : {
    "question_id" : 79681903,
    "title" : "How can i get updated ones with Entity Manager?",
    "body" : "<p>I am querying with 1000 entities at a time (bulk) and some of them are insert queries and some are update queries. I want to find which entity I query with is the update query and create a list of them. Like</p>\n<pre><code>final int[] updates = stmt.executeBatch();\n</code></pre>\n<p>in PreparedStatement. The updates array is an ordered array and if the value of the index is 1, we can get that's updated. I'm looking for something like this which can be applied with entity manager. Thank you.</p>\n",
    "tags" : [ "java", "hibernate", "entitymanager" ],
    "owner" : {
      "account_id" : 15548907,
      "reputation" : 71,
      "user_id" : 11217221,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-xYd8dwVT4fM/AAAAAAAAAAI/AAAAAAAAABc/OuYAmULMA1Y/s256-rj/photo.jpg",
      "display_name" : "Mert Karag&#246;z",
      "link" : "https://stackoverflow.com/users/11217221/mert-karag%c3%b6z"
    },
    "is_answered" : true,
    "view_count" : 56,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1751037058,
    "creation_date" : 1751025158,
    "link" : "https://stackoverflow.com/questions/79681903/how-can-i-get-updated-ones-with-entity-manager",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79682158,
    "question_id" : 79681903,
    "body" : "<p>JPA does not provide an API for batched queries per se.  It supports individual update and delete queries affecting multiple entities, but it does not define an interface to inserting new entities other than one at a time.  Overall, supporting bulk data operations such as you seem to want to perform was not a major design objective for JPA, and its facilities for such operations are limited.</p>\n<p>JPA does give some thought to performance, however.  For example, it does not, in general, insist that persistence operations on entities be matched 1:1 with DB queries, and implementations such as Hibernate (since you tag that) will batch queries automatically, within the the scope of the same transaction.  The Hibernate manual contains a discussion of <a href=\"https://docs.jboss.org/hibernate/orm/7.0/userguide/html_single/Hibernate_User_Guide.html#batch\" rel=\"nofollow noreferrer\">how to manage batch operations</a>.  Note well, however, that</p>\n<ol>\n<li><p>On the front end, this involves per-entity <code>persist()</code> or <code>merge()</code> operations for new entities, and per-entity fetch / update or <code>merge()</code> operations for updates.</p>\n</li>\n<li><p>Thus, only if you are assigning IDs manually (such that you can't distinguish new entity objects from others) <em>and</em> you use <code>merge()</code> operations for both new and existing entities do you not know beforehand how many of the operations are updates.</p>\n</li>\n<li><p>Multiple updates to the same entity during the same transaction may be coalesced naturally by the <code>EntityManager</code> into fewer queries against the DB, so you need to devote at least a little thought to what it is that you actually want to count.</p>\n</li>\n<li><p>You'll want to <a href=\"https://javaee.github.io/javaee-spec/javadocs/javax/persistence/Query.html#setFlushMode-javax.persistence.FlushModeType-\" rel=\"nofollow noreferrer\">set the <code>EntityManager</code>'s flush mode</a> appropriately, and if the persistence context is not participating in container-managed transactions then you'll need to <a href=\"https://javaee.github.io/javaee-spec/javadocs/javax/persistence/EntityManager.html#getTransaction--\" rel=\"nofollow noreferrer\">exercise manual control over transaction boundaries</a>.</p>\n</li>\n</ol>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1751037058,
    "last_activity_date" : 1751037058,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}