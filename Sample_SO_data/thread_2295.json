{
  "question" : {
    "question_id" : 79632253,
    "title" : "Cross-Site Request Forgery Vulnerability for DWR request calls",
    "body" : "<p>I have a java application running on wildfly 10 and using java 8.\nThe requests are sending as DWR requests and using the method as POST.</p>\n<p>We have contrast agent for security running over the application and it detect Cross-Site Request Forgery for the dwr calls. example savings, deleting.\nex : /DWR/call/plaincall/ABCService.saveConfig.dwr</p>\n<p>For a fix for this, I used following approach.</p>\n<ol>\n<li>Generate CSRF token before start the requests and save the token in the session.</li>\n<li>Get the token from the session before initiate the dwr request call.</li>\n<li>Then add the token as a request parameter to the request.</li>\n<li>Then read the token from the back and validate it against the token which is saved in the session and perform the action only it validated.</li>\n<li>But still the contrast agent detect vulnerability for the requests.</li>\n</ol>\n<p>How I fix this problem?\nDoes the contrast agent is compatible with the DWR calls and checking vulnerabilities on such requests?</p>\n<p>AbcService.saveConfiguration = function(csrfToken, configuration, callback) {\ndwr.engine._execute(AbcService._path, 'AbcService', 'saveConfiguration', csrfToken.token, configuration, callback);\n}</p>\n<p>And validate it in the backend like this</p>\n<pre><code>if (!CsrfTokenUtil.isValidCsrfToken(csrfToken,rquest.getSession()){\n   return;\n}\n</code></pre>\n",
    "tags" : [ "java", "security", "resteasy", "dwr" ],
    "owner" : {
      "account_id" : 1964182,
      "reputation" : 167,
      "user_id" : 1764850,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/WJ58o.jpg?s=256",
      "display_name" : "Linidu Praneeth Gunathilaka",
      "link" : "https://stackoverflow.com/users/1764850/linidu-praneeth-gunathilaka"
    },
    "is_answered" : false,
    "view_count" : 150,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1747925437,
    "creation_date" : 1747839357,
    "link" : "https://stackoverflow.com/questions/79632253/cross-site-request-forgery-vulnerability-for-dwr-request-calls",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79633799,
    "question_id" : 79632253,
    "body" : "<p>You can test it with posman first. Maybe it's a CSRF issue of web browsers.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 28910833,
      "reputation" : 1,
      "user_id" : 22143870,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/X8JMGdcg.jpg?s=256",
      "display_name" : "alex",
      "link" : "https://stackoverflow.com/users/22143870/alex"
    },
    "creation_date" : 1747918503,
    "last_activity_date" : 1747918503,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79634008,
    "question_id" : 79632253,
    "body" : "<p>Contrast looks for recognized industry standard patterns , it doesn't just check whether you're <em>doing CSRF validation. DWR's structure makes CSRF protection non-standard. if your app does not use a specific header(like x-csrf-token) , or if it (your app)</em> sends the token as parameter , or if it validates the token incorrectly or too late (in the request lifecycle), so contrast will likely flag it .</p>\n<p>so here is what you can do :<br />\n1- you can store csrf token in session, embed it in the page (in a js variable) , then send it via every ajax/dwr request .<br />\ncontrast expects this kind of setup(it matches secure framework like spring).</p>\n<p>i dont how to implement it in java . but u can do like this :<br />\n1- generate token in server side , send it to client (like in login as a variable) , then in fronted store it in a js variable.<br />\n2-Add the token as a custom header(like x-csrf-token) in DWR (before request sent).<br />\n3-Now in server side validate it .</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 19870200,
      "reputation" : 42,
      "user_id" : 14556548,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0c7decc7b407081d90a20061294794cd?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Mori",
      "link" : "https://stackoverflow.com/users/14556548/mori"
    },
    "creation_date" : 1747925437,
    "last_activity_date" : 1747925437,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140448988,
    "post_id" : 79632253,
    "body" : "Sure updated in the description itself",
    "score" : 0,
    "owner" : {
      "account_id" : 1964182,
      "reputation" : 167,
      "user_id" : 1764850,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/WJ58o.jpg?s=256",
      "display_name" : "Linidu Praneeth Gunathilaka",
      "link" : "https://stackoverflow.com/users/1764850/linidu-praneeth-gunathilaka"
    },
    "creation_date" : 1747910449,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140447119,
    "post_id" : 79632253,
    "body" : "Provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> for this issue.",
    "score" : 0,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1747854929,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79634008" : [ {
      "comment_id" : 140453981,
      "post_id" : 79634008,
      "body" : "Typically it uses instrumentation to look inside java method execution path , it expects: csrff token to be validated early , validation to apply to all risky endpoints (like delete) , sent via recognized headers(which ofc you did) , and token validation to be centralized . so if your csrf token validation is inside your dwr service class or controller(late in request lifecycle) , not global(like via filter),or not clearly using session-safe comparison . then contrast will still flag it .",
      "score" : 0,
      "owner" : {
        "account_id" : 19870200,
        "reputation" : 42,
        "user_id" : 14556548,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/0c7decc7b407081d90a20061294794cd?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Mori",
        "link" : "https://stackoverflow.com/users/14556548/mori"
      },
      "creation_date" : 1748031339,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140452744,
      "post_id" : 79634008,
      "body" : "I tried with x-csrf-token in the first attempt. And sent the token through the dwr header. But contrast complained for the vulnerability \tdwr.engine.setHeaders({ \t\t&quot;X-CSRF-TOKEN&quot;: token \t});",
      "score" : 0,
      "owner" : {
        "account_id" : 1964182,
        "reputation" : 167,
        "user_id" : 1764850,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/WJ58o.jpg?s=256",
        "display_name" : "Linidu Praneeth Gunathilaka",
        "link" : "https://stackoverflow.com/users/1764850/linidu-praneeth-gunathilaka"
      },
      "creation_date" : 1748005220,
      "content_license" : "CC BY-SA 4.0"
    } ],
    "79633799" : [ {
      "comment_id" : 140450218,
      "post_id" : 79633799,
      "body" : "Your answer could be improved with additional supporting information. Please <a href=\"https://stackoverflow.com/posts/79633799/edit\">edit</a> to add further details, such as citations or documentation, so that others can confirm that your answer is correct. You can find more information on how to write good answers <a href=\"/help/how-to-answer\">in the help center</a>.",
      "score" : 0,
      "owner" : {
        "account_id" : -1,
        "reputation" : 1,
        "user_id" : -1,
        "user_type" : "moderator",
        "profile_image" : "https://www.gravatar.com/avatar/a007be5a61f6aa8f3e85ae2fc18dd66e?s=256&d=identicon&r=PG",
        "display_name" : "Community",
        "link" : "https://stackoverflow.com/users/-1/community"
      },
      "creation_date" : 1747933250,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}