{
  "question" : {
    "question_id" : 79755286,
    "title" : "Skipping Drools rules with higher salience",
    "body" : "<p>I have a following Facts domain ProposedFare and Fare.\nThe idea here is <code>ProposedFare</code> could be a competitor fare and from that create/clone/update <code>Fare</code>.\nA rule can further update <code>Fare</code> which was already cloned.</p>\n<p>And my drl is as follows:</p>\n<pre><code>dialect &quot;mvel&quot;\n\nrule &quot;Set Carrier Code to AA&quot;\nsalience 100\nwhen\n    $prf : ProposedFare()\nthen\n    Fare fare = new Fare();\n    fare.setCarrierCode(&quot;AA&quot;);\n    fare.setOrigin($prf.getOrigin());\n    fare.setDestination($prf.getDestination());\n    fare.setTariffNumber($prf.getTariffNumber());\n    fare.setFareClassCode($prf.getFareClassCode());\n    fare.setFootnoteCode(&quot;3B&quot;);\n    fare.setFareAmount($prf.getFareAmount());\n    fare.setCurrencyCode($prf.getCurrencyCode());\n    fare.setRoundTripIndicator($prf.getRoundTripIndicator());\n    insert(fare);\nend\n\nrule &quot;Increase Fare Amount by double&quot;\nsalience 99\nwhen\n    $fare : Fare(origin==&quot;ABC&quot;, destination==&quot;XYZ&quot;)\nthen\n    modify($fare){\n        setFareAmount($fare.getFareAmount() * 2),\n        setFareClassCode(&quot;2X&quot;)\n    }\nend\n\nrule &quot;Change Fare ClassCode&quot;\nsalience 95\nwhen\n    $prf : ProposedFare(origin==&quot;ABC&quot;, destination==&quot;XYZ&quot;)\nthen\n    Fare fare = new Fare();\n    fare.setCarrierCode($prf.getCarrierCode());\n    fare.setOrigin($prf.getOrigin());\n    fare.setDestination($prf.getDestination());\n    fare.setTariffNumber($prf.getTariffNumber());\n    fare.setFareClassCode(&quot;1X&quot;);\n    fare.setFootnoteCode($prf.getFootnoteCode());\n    fare.setFareAmount($prf.getFareAmount());\n    fare.setCurrencyCode($prf.getCurrencyCode());\n    fare.setRoundTripIndicator($prf.getRoundTripIndicator());\n    insert(fare);\nend\n\nrule &quot;Change CarrierCode&quot;\nsalience 90\nwhen\n    $fare : Fare(origin==&quot;ABC&quot;, destination==&quot;XYZ&quot;, fareClassCode==&quot;1X&quot;)\nthen\n    modify($fare){\n        setCarrierCode(&quot;AB&quot;)\n    }\nend\n</code></pre>\n<p>For the new <code>Fare</code> that is inserted by <code>salience</code> 95, I do not want that fact to execute from rule 100, instead it should only execute rules where <code>salience</code> is &lt; 95.\n(Once new fact is inserted by any rule, only rules that have <code>salience</code> lower than that rule should be executed on that fact).\nHowever, when I insert the new <code>Fare</code> at <code>salience</code> 95, it starts getting executed from very first rule.</p>\n",
    "tags" : [ "java", "drools", "rules", "mvel" ],
    "owner" : {
      "account_id" : 1712888,
      "reputation" : 1255,
      "user_id" : 1570553,
      "user_type" : "registered",
      "accept_rate" : 71,
      "profile_image" : "https://i.sstatic.net/1kWNs.jpg?s=256",
      "display_name" : "vishalkin",
      "link" : "https://stackoverflow.com/users/1570553/vishalkin"
    },
    "is_answered" : false,
    "view_count" : 40,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1757054115,
    "creation_date" : 1756960488,
    "link" : "https://stackoverflow.com/questions/79755286/skipping-drools-rules-with-higher-salience",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140730335,
    "post_id" : 79755286,
    "body" : "That said you could easily keep the salience 100 rule from re-firing by updating the when to include a negative check for Fare ... eg <code>not(Fare())</code>. So as long as there&#39;s a Fare in working memory, the salience 100 rule won&#39;t fire.",
    "score" : 0,
    "owner" : {
      "account_id" : 183966,
      "reputation" : 15278,
      "user_id" : 419705,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://i.sstatic.net/cvuY8.png?s=256",
      "display_name" : "Roddy of the Frozen Peas",
      "link" : "https://stackoverflow.com/users/419705/roddy-of-the-frozen-peas"
    },
    "creation_date" : 1757623449,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140730334,
    "post_id" : 79755286,
    "body" : "By the time the fare is inserted from the salience 95 rule, the salience 100 rule has already been evaluated and (if a match) executed. But once you insert a new fact using <code>insert</code> (<i>not</i> <code>update</code>) all lower salience rules will be re-evaluated ... that&#39;s just how it works. If you&#39;re seeing something different, please provide a unit test/reproducer.",
    "score" : 0,
    "owner" : {
      "account_id" : 183966,
      "reputation" : 15278,
      "user_id" : 419705,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://i.sstatic.net/cvuY8.png?s=256",
      "display_name" : "Roddy of the Frozen Peas",
      "link" : "https://stackoverflow.com/users/419705/roddy-of-the-frozen-peas"
    },
    "creation_date" : 1757623375,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}