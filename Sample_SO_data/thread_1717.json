{
  "question" : {
    "question_id" : 79680578,
    "title" : "Random UTC timezone issues after moving to Spring Boot 3.3.10 while working with MySQL",
    "body" : "<p>I develop application that for a long time used UTC timezone for both server and database. Recently we tried to update past Spring Boot 3.3.9. It ended with tests failing randomly - all related to timezone issues (values moved by number of hours according to my timezone). Problems only appear on developer environments, for some reason CI server is running smoothly (it is using official docker MySQL image).</p>\n<p>Timezone is set in static block inside Spring Boot <code>@SpringBootApplication</code> class:</p>\n<pre><code>static { //this is loaded both for IT tests and application\n    TimeZone.setDefault(TimeZone.getTimeZone(&quot;UTC&quot;));\n    //other similar initializers here\n}\n</code></pre>\n<p>I've tried changing Hibernate, mysql-connector-j and tomcat-dbcp version. I have loaded timezone tables and made sure tests are running with <code>@@SESSION.time_zone</code> equal to <code>UTC</code>. Tried <code>connectionTimezone=UTC</code>. I have updated my MySQL instance. But unless I rollback to Spring Boot 3.3.9 I get failing integration tests.</p>\n<p>Most confusing part is the randomness. What can change during integration tests run that could change timezone behavior in Spring Boot-based system?</p>\n",
    "tags" : [ "java", "mysql", "spring", "spring-boot" ],
    "owner" : {
      "account_id" : 66967,
      "reputation" : 604,
      "user_id" : 196207,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c01c5b8834da35cbfbcf09c29d101600?s=256&d=identicon&r=PG",
      "display_name" : "Sankozi",
      "link" : "https://stackoverflow.com/users/196207/sankozi"
    },
    "is_answered" : true,
    "view_count" : 103,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1751007996,
    "creation_date" : 1750944363,
    "link" : "https://stackoverflow.com/questions/79680578/random-utc-timezone-issues-after-moving-to-spring-boot-3-3-10-while-working-with",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79681528,
    "question_id" : 79680578,
    "body" : "<p>@Hamza comment worked. I was really surprised so I investigated why my <code>TimeZone.setDefault</code> didn't worked (especially that I wanted to still use this method instead of JVM params).</p>\n<p>Through debugger I learned that Spring Boot changed way it initializes stuff during tests - some classes were initialized earlier after moving to Spring Boot 3.3.10. It was somewhat random.</p>\n<h3>My solution:</h3>\n<p>Move all JVM default initialization to another class in static method and call that class in my <code>@SpringBootApplication</code> and in base test classes as first line in static initializer block. That way I am 100% sure that <code>TimeZone.setDefault</code> will be called before any other important classes will use it.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 66967,
      "reputation" : 604,
      "user_id" : 196207,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c01c5b8834da35cbfbcf09c29d101600?s=256&d=identicon&r=PG",
      "display_name" : "Sankozi",
      "link" : "https://stackoverflow.com/users/196207/sankozi"
    },
    "creation_date" : 1751007659,
    "last_activity_date" : 1751007659,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140544699,
    "post_id" : 79680578,
    "body" : "Try adding -Duser.timezone=UTC in Edit Configurations --&gt; Modify Options --&gt; Add VM Options",
    "score" : 2,
    "owner" : {
      "account_id" : 25350771,
      "reputation" : 36,
      "user_id" : 19167671,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GjQpPCBvv6ucTti7Ytd7k6ZI6Ctg9kSoaTQcIbV3Q=k-s256",
      "display_name" : "Hamza Naceur",
      "link" : "https://stackoverflow.com/users/19167671/hamza-naceur"
    },
    "creation_date" : 1750949087,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79681528" : [ {
      "comment_id" : 140562235,
      "post_id" : 79681528,
      "body" : "@BasilBourque Yes, unfortunately, there are lots of hidden places where default time zone is used. I was trying to specify time zone in all libraries involved in flaky tests but it just didn&#39;t work. It often also required passing time zone in some messy string to string map API. Specifying default time zone seems easier and more future proof.",
      "score" : 0,
      "owner" : {
        "account_id" : 66967,
        "reputation" : 604,
        "user_id" : 196207,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/c01c5b8834da35cbfbcf09c29d101600?s=256&d=identicon&r=PG",
        "display_name" : "Sankozi",
        "link" : "https://stackoverflow.com/users/196207/sankozi"
      },
      "creation_date" : 1751551629,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140548692,
      "post_id" : 79681528,
      "body" : "By the way, even better would be writing code that does not rely on the JVMâ€™s current default time zone. Always pass the optional time zone arguments to the various <code>java.time</code> methods.",
      "score" : 2,
      "owner" : {
        "account_id" : 322981,
        "reputation" : 346951,
        "user_id" : 642706,
        "user_type" : "registered",
        "accept_rate" : 58,
        "profile_image" : "https://i.sstatic.net/ZWEI3.jpg?s=256",
        "display_name" : "Basil Bourque",
        "link" : "https://stackoverflow.com/users/642706/basil-bourque"
      },
      "creation_date" : 1751071356,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}