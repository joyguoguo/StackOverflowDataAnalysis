{
  "question" : {
    "question_id" : 79673221,
    "title" : "Make Java use framework.jar instead of android.jar in an Android Gradle module when both are on the bootstrapClasspath",
    "body" : "<p>I'm working on a multi-module Android project where one of the modules contains both Java and Kotlin packages. This module depends on a custom AOSP framework.jar, which contains hidden/internal APIs.</p>\n<p>I've added framework.jar using compileOnly, and it appears correctly in the classpath.</p>\n<p>What i have noticed is that Kotlin code can access the hidden methods.</p>\n<p>Java code fails to compile, with errors like cannot find symbol, because it's resolving the classes from android.jar, not from framework.jar.</p>\n<p>When I print the classpath in compileDebugJavaWithJavac, I see both android.jar and framework.jar, but android.jar comes first — so its definitions win.\nCan someone guide me on this ?</p>\n",
    "tags" : [ "java", "android", "kotlin" ],
    "owner" : {
      "account_id" : 2728361,
      "reputation" : 91,
      "user_id" : 10538614,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ccd299fa49632e1b75568b942ac4921b?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "smtrz",
      "link" : "https://stackoverflow.com/users/10538614/smtrz"
    },
    "is_answered" : false,
    "view_count" : 191,
    "answer_count" : 2,
    "score" : 1,
    "last_activity_date" : 1759613292,
    "creation_date" : 1750414919,
    "link" : "https://stackoverflow.com/questions/79673221/make-java-use-framework-jar-instead-of-android-jar-in-an-android-gradle-module-w",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79674482,
    "question_id" : 79673221,
    "body" : "<p>The issue occurred because, even after setting the bootClasspath to include the custom framework JAR containing hidden APIs, the Java compiler still failed to resolve them. This happened because a stripped-down version of the Android framework (such as android.jar or a renamed variant) was also present on the regular classpath. That stripped version doesn't include hidden APIs and was silently taking precedence during Java compilation. Kotlin was able to resolve the methods correctly because it relies on the full classpath, while Java strictly depends on bootClasspath and classpath. To resolve the issue, I explicitly removed the stripped framework JAR from the Java compiler’s classpath, ensuring that only my intended framework JAR was used. Once that was done, the hidden APIs were correctly recognized by the Java compiler. The key point is that setting bootClasspath is not enough, conflicting entries in the regular classpath must also be excluded to avoid shadowing.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 2728361,
      "reputation" : 91,
      "user_id" : 10538614,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ccd299fa49632e1b75568b942ac4921b?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "smtrz",
      "link" : "https://stackoverflow.com/users/10538614/smtrz"
    },
    "creation_date" : 1750514101,
    "last_activity_date" : 1759613292,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79775722,
    "question_id" : 79673221,
    "body" : "<p>I was facing quite the same issues with a custom framework that has new system service with a <code>CustomServiceManager</code>, and the <code>android.content.Context.java</code> class updated to add the '<code>CUSTOM_SERVICE</code>' string.</p>\n<p>The compile was failing on <code>getSystemService(Context.CUSTOM_SERVICE)</code> call which did not find the <code>Context.CUSTOM_SERVICE</code> symbol from framework.jar whereas the <code>CustomServiceManager</code> was correctly found as not conflicting with any class from SDK android.jar</p>\n<p>I was able to solve this issue by modifying root <code>build.gradle.kts</code> :</p>\n<pre><code>allprojects {\n\n    gradle.projectsEvaluated {\n        tasks.withType(JavaCompile::class.java) {\n            includes.add(&quot;android.content.Context&quot;)   // THIS LINE\n        }\n    }\n\n}\n</code></pre>\n<p>And in the module <code>build.gradle.kts</code>, the dependency in compileOnly :</p>\n<pre><code>dependencies {\n...\n    compileOnly(files(&quot;../libs/framework.jar&quot;))\n...\n}\n</code></pre>\n<p>Android Studio detect the <code>Context.CUSTOM_SERVICE</code> as an error, but the code is compiled without any error</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 4465323,
      "reputation" : 425,
      "user_id" : 3633128,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/HHMJM.jpg?s=256",
      "display_name" : "Snorky35",
      "link" : "https://stackoverflow.com/users/3633128/snorky35"
    },
    "creation_date" : 1758879438,
    "last_activity_date" : 1758879438,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140530207,
    "post_id" : 79673221,
    "body" : "simple android gradle project , with a module that has 2 packages one is in kotlin and other java.",
    "score" : 0,
    "owner" : {
      "account_id" : 2728361,
      "reputation" : 91,
      "user_id" : 10538614,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ccd299fa49632e1b75568b942ac4921b?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "smtrz",
      "link" : "https://stackoverflow.com/users/10538614/smtrz"
    },
    "creation_date" : 1750437536,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140530200,
    "post_id" : 79673221,
    "body" : "I would need more details about your project. Do you use project managers like maven or gradle? How do you declare dependencies?",
    "score" : 0,
    "owner" : {
      "account_id" : 1601399,
      "reputation" : 638,
      "user_id" : 1482356,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d6160b6e40d230fa92c6da8072b2f7e5?s=256&d=identicon&r=PG",
      "display_name" : "Peter Adrian",
      "link" : "https://stackoverflow.com/users/1482356/peter-adrian"
    },
    "creation_date" : 1750437395,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140530059,
    "post_id" : 79673221,
    "body" : "@PeterAdrian how ? i tried to set bootstrap classpath via javacompile task but it doesnot work for me.",
    "score" : 0,
    "owner" : {
      "account_id" : 2728361,
      "reputation" : 91,
      "user_id" : 10538614,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ccd299fa49632e1b75568b942ac4921b?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "smtrz",
      "link" : "https://stackoverflow.com/users/10538614/smtrz"
    },
    "creation_date" : 1750434258,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140530055,
    "post_id" : 79673221,
    "body" : "Good question, The java package code relies on Android framework classes like Context (from android.jar) and AndroidX classes like AppCompatActivity (from androidx.appcompat:appcompat). So I&#39;m not able to use a plain java-library module, because it wouldn&#39;t have access to Context, and AndroidX classes require the Android plugin context to resolve correctly, and applying the plugin injects android.jar and i dont know any correct way to overwrite it at compile time.",
    "score" : 0,
    "owner" : {
      "account_id" : 2728361,
      "reputation" : 91,
      "user_id" : 10538614,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ccd299fa49632e1b75568b942ac4921b?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "smtrz",
      "link" : "https://stackoverflow.com/users/10538614/smtrz"
    },
    "creation_date" : 1750434164,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140529690,
    "post_id" : 79673221,
    "body" : "Do you have direct control over how these dependencies are declared, i.e. scope and order? Naturally, Gradle would sort the classpath by order of definition in the build script. As the question of @PeterAdrian implies, do you need to depend on both at the same time for any individual module/subproject?",
    "score" : 0,
    "owner" : {
      "account_id" : 1355161,
      "reputation" : 2460,
      "user_id" : 1293709,
      "user_type" : "registered",
      "accept_rate" : 40,
      "profile_image" : "https://i.sstatic.net/HwxPn.jpg?s=256",
      "display_name" : "Thomas Hirsch",
      "link" : "https://stackoverflow.com/users/1293709/thomas-hirsch"
    },
    "creation_date" : 1750427128,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140529230,
    "post_id" : 79673221,
    "body" : "Have you tried to remove android.jar from the package?",
    "score" : 0,
    "owner" : {
      "account_id" : 1601399,
      "reputation" : 638,
      "user_id" : 1482356,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d6160b6e40d230fa92c6da8072b2f7e5?s=256&d=identicon&r=PG",
      "display_name" : "Peter Adrian",
      "link" : "https://stackoverflow.com/users/1482356/peter-adrian"
    },
    "creation_date" : 1750416753,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}