{
  "question" : {
    "question_id" : 79621623,
    "title" : "How to convert LONG to string in Oracle?",
    "body" : "<p>I'm trying to get the <code>search_condition</code> from <code>check_ddls</code> with read-only access in Oracle, and need to group these rows with a <code>;</code> delimiter.</p>\n<p>I've tried using <code>LIST_AGG</code>, but it seems that Oracle doesn’t support aggregation for <code>LONG</code> data types, and there is no easy way to convert a <code>LONG</code> to a string. However, if I could, somehow, group these bytes, and then convert them to a string using Java, that would be a great solution. But I haven’t found a suitable approach yet.</p>\n<p>I was trying to convert <code>LONG</code> many times.</p>\n",
    "tags" : [ "java", "sql", "oracle-database", "oracle10g" ],
    "owner" : {
      "account_id" : 30382589,
      "reputation" : 23,
      "user_id" : 23283324,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/uo1o9.jpg?s=256",
      "display_name" : "l_______",
      "link" : "https://stackoverflow.com/users/23283324/l"
    },
    "is_answered" : true,
    "view_count" : 170,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1747766857,
    "creation_date" : 1747230556,
    "link" : "https://stackoverflow.com/questions/79621623/how-to-convert-long-to-string-in-oracle",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79622075,
    "question_id" : 79621623,
    "body" : "<p>You need to use PL/SQL to convert short (&lt; 4000 bytes) <code>LONG</code>s in the dictionary to <code>varchar2</code>. PL/SQL recognizes the assignment of a <code>LONG</code> to a PL/SQL <code>varchar2</code> variable and does the conversion for you. Unfortunately you can't pass a <code>LONG</code> as a parameter so you have to have your procedure select the original row itself (redundantly). So you can do something like this:</p>\n<pre><code>CREATE OR REPLACE FUNCTION f_all_constraints_search_condition(in_owner IN varchar2, in_constraint_name IN varchar2)\n  RETURN varchar2\nAS\n  var_search_condition varchar2(4000);\n  var_search_condition_long long;\nBEGIN\n  SELECT search_condition\n    INTO var_search_condition_long\n    FROM all_constraints\n   WHERE owner = in_owner\n     AND constraint_name = in_constraint_name;\n\n   var_search_condition :=  var_search_condition_long; -- Oracle will convert the LONG here\n\n  RETURN var_search_condition;\nEND;  \n/\n</code></pre>\n<p>Now use it however you need. I'm not sure it's a good idea to listagg something like this or how meaningful it would be, but it works:</p>\n<pre><code>SELECT owner,table_name,LISTAGG(f_all_constraints_search_condition(owner,constraint_name),';' ON OVERFLOW TRUNCATE) WITHIN GROUP (ORDER BY constraint_name) constraints\n  FROM all_constraints c\n WHERE search_condition IS NOT NULL -- just for testing\n GROUP BY owner,table_name\n</code></pre>\n<p>If you ever need to work with a long that is &gt; 4000, you would need to convert them to a CLOB (which requires rather complex use of <code>dbms_sql</code>), but of course then you wouldn't be aggregating them (but you can search them). For certain dictionary fields like this one it is highly unlikely that the value will be &gt;4KB, so the above or something like it is a workable solution. You can also adapt this into a pipeline function with a view around it that replaces the original view entirely.</p>\n<p><strong>Update</strong>: if you don't have <code>create procedure</code> privs, in 19c you can use inline functions using the <code>WITH</code> clause (normally used for CTEs). Submit the following as one complete statement, which should work as long as your client supports it (older clients may not like the <code>;</code> character, as that normally indicates separation between individual statements):</p>\n<pre><code>WITH FUNCTION f_all_constraints_search_condition(in_owner IN varchar2, in_constraint_name IN varchar2)\n  RETURN varchar2\nAS\n  var_search_condition varchar2(4000);\n  var_search_condition_long long;\nBEGIN\n  SELECT search_condition\n    INTO var_search_condition_long\n    FROM all_constraints\n   WHERE owner = in_owner\n     AND constraint_name = in_constraint_name;\n\n   var_search_condition :=  var_search_condition_long; -- Oracle will convert the LONG here\n\n  RETURN var_search_condition;\nEND;  \nSELECT owner,table_name,LISTAGG(f_all_constraints_search_condition(owner,constraint_name),';' ON OVERFLOW TRUNCATE) WITHIN GROUP (ORDER BY constraint_name) constraints\n  FROM all_constraints c\n WHERE search_condition IS NOT NULL -- just for testing\n GROUP BY owner,table_name\n</code></pre>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 26978029,
      "reputation" : 12767,
      "user_id" : 20542862,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/57e3944ce39fc5b4ff00d4017cdf251e?s=256&d=identicon&r=PG",
      "display_name" : "Paul W",
      "link" : "https://stackoverflow.com/users/20542862/paul-w"
    },
    "creation_date" : 1747247125,
    "last_activity_date" : 1747395328,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79631006,
    "question_id" : 79621623,
    "body" : "<p>Connor McDonald recently did a video on how/why to convert long to CLOB. Its worth watching and having your DBA implement.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 22587722,
      "reputation" : 944,
      "user_id" : 16771377,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AATXAJxBSaZJX0txCYR9HqDk1-_rl64COBBUgEhWQ8lM=k-s256",
      "display_name" : "Pugzly",
      "link" : "https://stackoverflow.com/users/16771377/pugzly"
    },
    "creation_date" : 1747766857,
    "last_activity_date" : 1747766857,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140425659,
    "post_id" : 79621623,
    "body" : "Have you tried calling <code>ResultSet::getString</code>?",
    "score" : 0,
    "owner" : {
      "account_id" : 22124137,
      "reputation" : 4243,
      "user_id" : 16376827,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/1ImPw.png?s=256",
      "display_name" : "g00se",
      "link" : "https://stackoverflow.com/users/16376827/g00se"
    },
    "creation_date" : 1747237065,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79622075" : [ {
      "comment_id" : 140432022,
      "post_id" : 79622075,
      "body" : "@l_______, you can certain ask for &quot;create procedure&quot; privs. DBAs do grant such privs if there&#39;s a legit reason. Also, in 12c+ you can declare inline functions - I&#39;ve updated my answer with an example.",
      "score" : 0,
      "owner" : {
        "account_id" : 26978029,
        "reputation" : 12767,
        "user_id" : 20542862,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/57e3944ce39fc5b4ff00d4017cdf251e?s=256&d=identicon&r=PG",
        "display_name" : "Paul W",
        "link" : "https://stackoverflow.com/users/20542862/paul-w"
      },
      "creation_date" : 1747395342,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140431007,
      "post_id" : 79622075,
      "body" : "Unfortunately, I can&#39;t use this solution because I only have read permissions and can&#39;t create functions. Is grouping in Java the only option?",
      "score" : 0,
      "owner" : {
        "account_id" : 30382589,
        "reputation" : 23,
        "user_id" : 23283324,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/uo1o9.jpg?s=256",
        "display_name" : "l_______",
        "link" : "https://stackoverflow.com/users/23283324/l"
      },
      "creation_date" : 1747370569,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}