{
  "question" : {
    "question_id" : 79831810,
    "title" : "Losing MDC in Quarkus ManagedExecutor",
    "body" : "<p>I'm starting an async-process through a REST request. As soon as the REST requests returns, I'm losing the MDC context inside my async execution code. I tried to &quot;copy&quot; it over with ThreadContext but it does not work. Also, manually copying it over didn't do the trick. Somehow MDC gets cleared after the outer REST request returns.</p>\n<pre><code>Map&lt;String, String&gt; copyOfContextMap = MDC.getCopyOfContextMap();\n\nThreadContext threadContext = ThreadContext.builder()\n    .propagated(ThreadContext.ALL_REMAINING)\n    .cleared()\n    .build();\nRunnable runnable = threadContext.contextualRunnable(() -&gt; {\n  try {\n\n    MDC.setContextMap(copyOfContextMap);\n    latch.countDown();\n\n    for (int i = 0; i &lt; 10; i++) {\n      log.info(i + &quot;: Log inside async executor&quot;);\n      sleepQuietly();\n    }\n  } catch (Throwable e) {\n    log.error(&quot;Error during async execution&quot;, e);\n  }\n});\n\nexecutor.runAsync(runnable);\n</code></pre>\n<p>How can I preserve my MDC context from the asynchronous executed thread? I see it's there during the first log lines, when the outer request hasn't returned but afterwards seems to get cleared.</p>\n",
    "tags" : [ "java", "asynchronous", "quarkus", "mdc" ],
    "owner" : {
      "account_id" : 1118925,
      "reputation" : 906,
      "user_id" : 1107657,
      "user_type" : "registered",
      "accept_rate" : 53,
      "profile_image" : "https://www.gravatar.com/avatar/c14df8dbad134e6c0da86300b28d1352?s=256&d=identicon&r=PG",
      "display_name" : "Daniel",
      "link" : "https://stackoverflow.com/users/1107657/daniel"
    },
    "is_answered" : false,
    "view_count" : 37,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1764255014,
    "creation_date" : 1764255014,
    "link" : "https://stackoverflow.com/questions/79831810/losing-mdc-in-quarkus-managedexecutor",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140876540,
    "post_id" : 79831810,
    "body" : "What is MDC in this question?",
    "score" : 0,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26502,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1764267664,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}