{
  "question" : {
    "question_id" : 79839079,
    "title" : "Caused by: java.lang.ClassNotFoundException: org.mockito.internal.creation.bytebuddy.inject.MockMethodDispatcher",
    "body" : "<p>I have integration tests configured in my project with payara-micro-managed, arquillian, and junit5. Everything works fine until I use Mockito. I get this error:</p>\n<pre><code>[2025-12-05T14:58:04.760+0000] [] [&amp;amp#27;[1;93mWARNING&amp;amp#27;[0m] [] [&amp;amp#27;[1;94mjakarta.enterprise.web&amp;amp#27;[0m] [tid: _ThreadID=77 _ThreadName=http-thread-pool::http-listener(1)] [timeMillis: 1764946684760] [levelValue: 900] [[\n  StandardWrapperValve[ArquillianServletRunnerEE9]: Servlet.service() for servlet ArquillianServletRunnerEE9 threw exception\norg.jboss.weld.exceptions.WeldException\n    at org.jboss.weld.module.ejb.SessionBeanProxyInstantiator.newInstance(SessionBeanProxyInstantiator.java:69)\n    at org.jboss.weld.module.ejb.SessionBeanImpl.create(SessionBeanImpl.java:157)\n    at org.jboss.weld.contexts.unbound.DependentContextImpl.get(DependentContextImpl.java:64)\n    at org.jboss.weld.bean.ContextualInstanceStrategy$DefaultContextualInstanceStrategy.get(ContextualInstanceStrategy.java:106)\n    at org.jboss.weld.bean.ContextualInstance.get(ContextualInstance.java:50)\n    at org.jboss.weld.manager.BeanManagerImpl.getReference(BeanManagerImpl.java:706)\n    at org.jboss.weld.manager.BeanManagerImpl.getInjectableReference(BeanManagerImpl.java:813)\n    at org.jboss.weld.injection.FieldInjectionPoint.inject(FieldInjectionPoint.java:93)\n    at org.jboss.weld.util.Beans.injectBoundFields(Beans.java:357)\n    at org.jboss.weld.util.Beans.injectFieldsAndInitializers(Beans.java:368)\n    at org.jboss.weld.injection.producer.ResourceInjector$1.proceed(ResourceInjector.java:70)\n    at org.glassfish.weld.services.InjectionServicesImpl.aroundInject(InjectionServicesImpl.java:245)\n    at org.jboss.weld.injection.InjectionContextImpl.run(InjectionContextImpl.java:47)\n    at org.jboss.weld.injection.producer.ResourceInjector.inject(ResourceInjector.java:72)\n    at org.jboss.weld.injection.producer.BasicInjectionTarget.inject(BasicInjectionTarget.java:126)\n    at org.jboss.weld.bean.ManagedBean.create(ManagedBean.java:165)\n    at org.jboss.weld.contexts.AbstractContext.get(AbstractContext.java:96)\n    at org.jboss.weld.bean.ContextualInstanceStrategy$DefaultContextualInstanceStrategy.get(ContextualInstanceStrategy.java:106)\n    at org.jboss.weld.bean.ContextualInstanceStrategy$CachingContextualInstanceStrategy.get(ContextualInstanceStrategy.java:192)\n    at org.jboss.weld.bean.ContextualInstance.get(ContextualInstance.java:50)\n    at org.jboss.weld.bean.proxy.ContextBeanInstance.getInstance(ContextBeanInstance.java:101)\n    at org.jboss.weld.bean.proxy.ProxyMethodHandler.getInstance(ProxyMethodHandler.java:136)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:253)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:211)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:253)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:211)\n    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:257)\n    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:166)\n    at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:757)\n    at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:577)\n    at com.sun.enterprise.web.WebPipeline.invoke(WebPipeline.java:99)\n    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:158)\n    at org.apache.catalina.connector.CoyoteAdapter.doService(CoyoteAdapter.java:372)\n    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:239)\n    at com.sun.enterprise.v3.services.impl.ContainerMapper$HttpHandlerCallable.call(ContainerMapper.java:520)\n    at com.sun.enterprise.v3.services.impl.ContainerMapper.service(ContainerMapper.java:217)\n    at org.glassfish.grizzly.http.server.HttpHandler.runService(HttpHandler.java:174)\n    at org.glassfish.grizzly.http.server.HttpHandler.doHandle(HttpHandler.java:153)\n    at org.glassfish.grizzly.http.server.HttpServerFilter.handleRead(HttpServerFilter.java:196)\n    at org.glassfish.grizzly.filterchain.ExecutorResolver$9.execute(ExecutorResolver.java:88)\n    at org.glassfish.grizzly.filterchain.DefaultFilterChain.executeFilter(DefaultFilterChain.java:246)\n    at org.glassfish.grizzly.filterchain.DefaultFilterChain.executeChainPart(DefaultFilterChain.java:178)\n    at org.glassfish.grizzly.filterchain.DefaultFilterChain.execute(DefaultFilterChain.java:118)\n    at org.glassfish.grizzly.filterchain.DefaultFilterChain.process(DefaultFilterChain.java:96)\n    at org.glassfish.grizzly.ProcessorExecutor.execute(ProcessorExecutor.java:51)\n    at org.glassfish.grizzly.nio.transport.TCPNIOTransport.fireIOEvent(TCPNIOTransport.java:510)\n    at org.glassfish.grizzly.strategies.AbstractIOStrategy.fireIOEvent(AbstractIOStrategy.java:82)\n    at org.glassfish.grizzly.strategies.WorkerThreadIOStrategy.run0(WorkerThreadIOStrategy.java:83)\n    at org.glassfish.grizzly.strategies.WorkerThreadIOStrategy$WorkerThreadRunnable.run(WorkerThreadIOStrategy.java:101)\n    at org.glassfish.grizzly.threadpool.AbstractThreadPool$Worker.doWork(AbstractThreadPool.java:535)\n    at org.glassfish.grizzly.threadpool.AbstractThreadPool$Worker.run(AbstractThreadPool.java:515)\n    at java.base/java.lang.Thread.run(Thread.java:1583)\nCaused by: java.lang.reflect.InvocationTargetException\n    at java.base/jdk.internal.reflect.DirectConstructorHandleAccessor.newInstance(DirectConstructorHandleAccessor.java:74)\n    at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:502)\n    at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:486)\n    at org.jboss.weld.security.NewInstanceAction.run(NewInstanceAction.java:40)\n    at java.base/java.security.AccessController.doPrivileged(AccessController.java:571)\n    at org.jboss.weld.module.ejb.SessionBeanProxyInstantiator.newInstance(SessionBeanProxyInstantiator.java:55)\n    ... 55 more\nCaused by: java.lang.NoClassDefFoundError: org/mockito/internal/creation/bytebuddy/inject/MockMethodDispatcher\n    at java.base/jdk.internal.reflect.DirectConstructorHandleAccessor.newInstance(DirectConstructorHandleAccessor.java:62)\n    ... 60 more\nCaused by: java.lang.ClassNotFoundException: org.mockito.internal.creation.bytebuddy.inject.MockMethodDispatcher\n    ... 64 more\n</code></pre>\n<p>I don't understand why I get this error even though I have the mockito-core library.\nMy configuration looks like this:</p>\n<blockquote>\n<p>maven profile for building payara micro jar and running tests</p>\n</blockquote>\n<pre><code>    &lt;profile&gt;\n            &lt;id&gt;build-test-microbundle&lt;/id&gt;\n            &lt;build&gt;\n                &lt;plugins&gt;\n                    &lt;plugin&gt;\n                        &lt;groupId&gt;fish.payara.maven.plugins&lt;/groupId&gt;\n                        &lt;artifactId&gt;payara-micro-maven-plugin&lt;/artifactId&gt;\n                        &lt;executions&gt;\n                            &lt;execution&gt;\n                                &lt;id&gt;create-microbundle&lt;/id&gt;\n                                &lt;phase&gt;package&lt;/phase&gt;\n                                &lt;goals&gt;\n                                    &lt;goal&gt;bundle&lt;/goal&gt;\n                                &lt;/goals&gt;\n                            &lt;/execution&gt;\n                        &lt;/executions&gt;\n                        &lt;configuration&gt;\n                            &lt;payaraVersion&gt;${payaraVersion}&lt;/payaraVersion&gt;\n                            &lt;payaraMicroAbsolutePath&gt;\n                                target/microbundle.jar\n                            &lt;/payaraMicroAbsolutePath&gt;\n                            &lt;deployWar&gt;false&lt;/deployWar&gt;\n\n                            &lt;customJars&gt;\n                                &lt;artifactItem&gt;\n                                    &lt;groupId&gt;net.bytebuddy&lt;/groupId&gt;\n                                    &lt;artifactId&gt;byte-buddy-agent&lt;/artifactId&gt;\n                                &lt;/artifactItem&gt;\n                                &lt;artifactItem&gt;\n                                    &lt;groupId&gt;net.bytebuddy&lt;/groupId&gt;\n                                    &lt;artifactId&gt;byte-buddy&lt;/artifactId&gt;\n                                &lt;/artifactItem&gt;\n                                &lt;artifactItem&gt;\n                                    &lt;groupId&gt;org.mockito&lt;/groupId&gt;\n                                    &lt;artifactId&gt;mockito-core&lt;/artifactId&gt;\n                                &lt;/artifactItem&gt;\n                            &lt;/customJars&gt;\n                        &lt;/configuration&gt;\n                    &lt;/plugin&gt;\n                &lt;/plugins&gt;\n            &lt;/build&gt;\n        &lt;/profile&gt;\n        &lt;profile&gt;\n            &lt;id&gt;integration-test&lt;/id&gt;\n            &lt;build&gt;\n                &lt;plugins&gt;\n                    &lt;plugin&gt;\n                        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                        &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;\n                        &lt;configuration&gt;\n                            &lt;systemPropertyVariables&gt;\n                                &lt;arquillian.launch&gt;payara-micro-managed&lt;/arquillian.launch&gt;\n                            &lt;/systemPropertyVariables&gt;\n                            &lt;includes&gt;\n                                &lt;include&gt;**/*IntegrationTest.java&lt;/include&gt;\n                            &lt;/includes&gt;\n                        &lt;/configuration&gt;\n                    &lt;/plugin&gt;\n                &lt;/plugins&gt;\n            &lt;/build&gt;\n        &lt;/profile&gt;\n</code></pre>\n<blockquote>\n<p>arquillian.xml</p>\n</blockquote>\n<pre><code>&lt;arquillian xmlns=&quot;http://jboss.org/schema/arquillian&quot;\n                        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n                        xsi:schemaLocation=&quot;http://jboss.org/schema/arquillian\n            http://jboss.org/schema/arquillian/arquillian_1_0.xsd&quot;&gt;\n\n    &lt;container qualifier=&quot;payara-micro-managed&quot; default=&quot;true&quot;&gt;\n        &lt;configuration&gt;\n            &lt;property name=&quot;microJar&quot;&gt;target/microbundle.jar&lt;/property&gt;\n            &lt;property name=&quot;autoBindHttp&quot;&gt;true&lt;/property&gt;\n            &lt;property name=&quot;clusterEnabled&quot;&gt;false&lt;/property&gt;\n\n        &lt;/configuration&gt;\n    &lt;/container&gt;\n&lt;/arquillian&gt;\n</code></pre>\n<blockquote>\n<p>@Deployment method</p>\n</blockquote>\n<pre><code>    @Deployment\n    public static WebArchive getArchive() {\n        WebArchive war = ShrinkWrap.create(WebArchive.class, &quot;test.war&quot;);\n        war.addPackages(true, &quot;com.example&quot;);\n        war.addAsLibraries(Maven.resolver()\n                .loadPomFromFile(&quot;pom.xml&quot;)\n                .importDependencies(ScopeType.COMPILE, ScopeType.TEST)\n                .resolve()\n                .withTransitivity()\n                .asFile());\n\n        return war;\n    }\n</code></pre>\n<blockquote>\n<p>Test</p>\n</blockquote>\n<pre><code>    @Test\n    public void testResolveActionWithoutRedirectNavigationParameters() {\n        Action action = Mockito.mock(Action.class);\n        assertNotNull(action);\n    }\n\n</code></pre>\n<blockquote>\n<p>Dependencies</p>\n</blockquote>\n<pre><code>        &lt;dependency&gt;\n            &lt;groupId&gt;org.mockito&lt;/groupId&gt;\n            &lt;artifactId&gt;mockito-core&lt;/artifactId&gt;\n            &lt;version&gt;5.15.2&lt;version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;fish.payara.arquillian&lt;/groupId&gt;\n            &lt;artifactId&gt;arquillian-payara-micro-managed&lt;/artifactId&gt;\n            &lt;version&gt;4.0.alpha4&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.jboss.arquillian.junit5&lt;/groupId&gt;\n            &lt;artifactId&gt;arquillian-junit5-container&lt;/artifactId&gt;\n            &lt;version&gt;1.7.0.Final&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.jboss.arquillian.protocol&lt;/groupId&gt;\n            &lt;artifactId&gt;arquillian-protocol-servlet&lt;/artifactId&gt;\n            &lt;version&gt;1.7.0.Final&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n</code></pre>\n<blockquote>\n<p>Im using payara 6.2025.11</p>\n</blockquote>\n",
    "tags" : [ "java", "mockito", "junit5", "jboss-arquillian", "payara-micro" ],
    "owner" : {
      "account_id" : 26036770,
      "reputation" : 52,
      "user_id" : 19742116,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0b8eb1099efac9225080681c728f5c64?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Albert Albatros",
      "link" : "https://stackoverflow.com/users/19742116/albert-albatros"
    },
    "is_answered" : false,
    "view_count" : 44,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1764950125,
    "creation_date" : 1764950125,
    "link" : "https://stackoverflow.com/questions/79839079/caused-by-java-lang-classnotfoundexception-org-mockito-internal-creation-byteb",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140892096,
    "post_id" : 79839079,
    "body" : "maybe this warning has something to do with my error: <code>Mockito is currently self-attaching to enable the inline-mock-maker. This will no longer work in future releases of the JDK. Please add Mockito as an agent to your build as described in Mockito&#39;s documentation: https:&#47;&#47;javadoc.io&#47;doc&#47;org.mockito&#47;mockito-core&#47;latest&#47;org&#47;m&zwnj;&#8203;ockito&#47;Mockito.html#&zwnj;&#8203;0.3</code>",
    "score" : 0,
    "owner" : {
      "account_id" : 26036770,
      "reputation" : 52,
      "user_id" : 19742116,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0b8eb1099efac9225080681c728f5c64?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Albert Albatros",
      "link" : "https://stackoverflow.com/users/19742116/albert-albatros"
    },
    "creation_date" : 1765178009,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140891580,
    "post_id" : 79839079,
    "body" : "@AlbertAlbatros Can you please provide a minimum codebase to reproduce this?",
    "score" : 0,
    "owner" : {
      "account_id" : 11377012,
      "reputation" : 17227,
      "user_id" : 8340997,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/fQmuF6ta.png?s=256",
      "display_name" : "Anish B.",
      "link" : "https://stackoverflow.com/users/8340997/anish-b"
    },
    "creation_date" : 1765127676,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140891574,
    "post_id" : 79839079,
    "body" : "@RadoslavHusar I think my case is valid, I use mocks only for single objects not related to the purpose of a given test. I have read that issue which you linked, and a few others, but they didn&#39;t help me to fix this issue in my case.",
    "score" : 0,
    "owner" : {
      "account_id" : 26036770,
      "reputation" : 52,
      "user_id" : 19742116,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0b8eb1099efac9225080681c728f5c64?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Albert Albatros",
      "link" : "https://stackoverflow.com/users/19742116/albert-albatros"
    },
    "creation_date" : 1765127052,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140891567,
    "post_id" : 79839079,
    "body" : "@AnishB. yes i have bytebuddy in my dependecies as well",
    "score" : 0,
    "owner" : {
      "account_id" : 26036770,
      "reputation" : 52,
      "user_id" : 19742116,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/0b8eb1099efac9225080681c728f5c64?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Albert Albatros",
      "link" : "https://stackoverflow.com/users/19742116/albert-albatros"
    },
    "creation_date" : 1765126702,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140890801,
    "post_id" : 79839079,
    "body" : "There is a reported issue that seems to relate to this upstream, see <a href=\"https://github.com/mockito/mockito/issues/2203\" rel=\"nofollow noreferrer\">github.com/mockito/mockito/issues/2203</a>  Nevertheless, for a pure integration test, you typically want the entire deployed application to be running with its real dependencies. Using Mockito to mock a component inside the container defeats the purpose of an integration test for that specific component chain. Perhaps your use case is valid, but I would rethink this.",
    "score" : 1,
    "owner" : {
      "account_id" : 2067331,
      "reputation" : 194,
      "user_id" : 1842594,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/b553ef9a63f33f7c9c4deba362fff563?s=256&d=identicon&r=PG",
      "display_name" : "Radoslav Husar",
      "link" : "https://stackoverflow.com/users/1842594/radoslav-husar"
    },
    "creation_date" : 1765057417,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140890116,
    "post_id" : 79839079,
    "body" : "Please try <code>.importDependencies(ScopeType.COMPILE, ScopeType.TEST, ScopeType.RUNTIME)</code> as well",
    "score" : 0,
    "owner" : {
      "account_id" : 11377012,
      "reputation" : 17227,
      "user_id" : 8340997,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/fQmuF6ta.png?s=256",
      "display_name" : "Anish B.",
      "link" : "https://stackoverflow.com/users/8340997/anish-b"
    },
    "creation_date" : 1765007431,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140890113,
    "post_id" : 79839079,
    "body" : "Did you add ByteBuddy to the dependencies section? I don&#39;t see it.",
    "score" : 1,
    "owner" : {
      "account_id" : 11377012,
      "reputation" : 17227,
      "user_id" : 8340997,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/fQmuF6ta.png?s=256",
      "display_name" : "Anish B.",
      "link" : "https://stackoverflow.com/users/8340997/anish-b"
    },
    "creation_date" : 1765007343,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}