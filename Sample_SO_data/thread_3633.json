{
  "question" : {
    "question_id" : 79535698,
    "title" : "Repeat ir signal for NEC (button hold)",
    "body" : "<p>I want to send the infrared signal of the remote control to the CD player, and I am making an application for Android. The problem is that the button holding function does not work. This button has a dual function. When pressed once, it switches the track of the LG CD player, and when you hold the button, it rewinds the track. I am doing this for the NEC protocol. Here is my code. I would be very grateful for your help!\nPS. There is not much information about this\n<a href=\"https://catedu.github.io/rover-marciano-alphabot/5-control-remoto/51-como-funciona.html\" rel=\"nofollow noreferrer\">https://catedu.github.io/rover-marciano-alphabot/5-control-remoto/51-como-funciona.html</a></p>\n<pre><code>\npublic class MainActivity extends Activity {\n    private ConsumerIrManager irManager;\n    private Handler handler = new Handler();\n    private boolean isHolding = false;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.main);\n\n        irManager = (ConsumerIrManager) getSystemService(CONSUMER_IR_SERVICE);\n\n        // Устанавливаем обработчики для всех кнопок\n        setupButton(R.id.powerButton, 0x08087887, false);\n        setupButton(R.id.sleepButton, 0x080843BC, false);\n        setupButton(R.id.eqButton, 0x080802FD, false);\n        setupButton(R.id.upButton, 0x080848B7, false);\n        setupButton(R.id.downButton, 0x0808C837, false);\n        setupButton(R.id.bandButton, 0x08089A65, false);\n        setupButton(R.id.playPauseButton, 0x080820DF, false);\n        setupButton(R.id.stopButton, 0x0808A05F, false);\n        setupButton(R.id.progButton, 0x0808B24D, false);\n        setupButton(R.id.prevButton, 0x0808609F, false);\n        setupButton(R.id.nextButton, 0x0808E01F, true);\n        setupButton(R.id.repeatButton, 0x0808728D, false);\n        setupButton(R.id.volUpButton, 0x08086897, true);\n        setupButton(R.id.volDownButton, 0x0808E817, true);\n    }\n\n    private void setupButton(int buttonId, final int necCode, boolean isHoldable) {\n        Button button = findViewById(buttonId);\n        if (button != null) {\n            button.setOnClickListener(new View.OnClickListener() {\n                    @Override\n                    public void onClick(View v) {\n                        sendIrSignal(necCode);\n                    }\n                });\n\n            if (isHoldable) {\n                button.setOnTouchListener(new View.OnTouchListener() {\n                        @Override\n                        public boolean onTouch(View v, android.view.MotionEvent event) {\n                            switch (event.getAction()) {\n                                case android.view.MotionEvent.ACTION_DOWN:\n                                    isHolding = true;\n                                    sendIrSignal(necCode);  // Первая передача при нажатии\n                                    startHoldingSignal(necCode);  // Запуск повторных сигналов при удержании\n                                    return true;\n\n                                case android.view.MotionEvent.ACTION_UP:\n                                    isHolding = false;\n                                    handler.removeCallbacksAndMessages(null);  // Остановка повторных сигналов\n                                    return true;\n                            }\n                            return false;\n                        }\n                    });\n            }\n        }\n    }\n\n    private void startHoldingSignal(final int necCode) {\n        handler.postDelayed(new Runnable() {\n                @Override\n                public void run() {\n                    if (isHolding) {\n                        sendHoldingSignal();  // Отправка повторного сигнала\n                        handler.postDelayed(this, 110);  // Повтор через 110 мс\n                    }\n                }\n            }, 110);  // Начало через 110 мс после первого сигнала\n    }\n\n    private void sendIrSignal(int necCode) {\n        irManager.transmit(38000, encodeNEC(necCode));  // Первая передача сигнала\n    }\n\n    private void sendHoldingSignal() {\n        // Передача повторного сигнала (9мс, 2.25мс, 0.5625мс)\n        int[] signal = new int[] {9000, 2250, 562};  // Импульс 9 мс, пауза 2.25 мс, импульс 0.5625 мс\n        irManager.transmit(38000, signal);  // Отправка повторного сигнала\n    }\n\n    private int[] encodeNEC(int necCode) {\n        int[] encodedSignal = new int[68];\n        int i = 0;\n\n        // Начало сигнала (9 мс, 4.5 мс пауза)\n        encodedSignal[i++] = 9000;  // 9 мс\n        encodedSignal[i++] = 4500;  // 4.5 мс пауза\n\n        // Адрес и инверсия (27 мс для каждого бита)\n        for (int bit = 31; bit &gt;= 0; bit--) {\n            if ((necCode &amp; (1 &lt;&lt; bit)) != 0) {\n                encodedSignal[i++] = 560;  // 27 мс для бита 1\n                encodedSignal[i++] = 1690; // 27 мс для бита 1\n            } else {\n                encodedSignal[i++] = 560;  // 27 мс для бита 0\n                encodedSignal[i++] = 560;  // 27 мс для бита 0\n            }\n        }\n\n        // Конец сигнала (широкая пауза)\n        encodedSignal[i++] = 560;\n        encodedSignal[i++] = 39416;  // Пауза на завершение\n\n        return encodedSignal;\n    }\n}\n\n</code></pre>\n",
    "tags" : [ "javascript", "java", "android" ],
    "owner" : {
      "account_id" : 19703899,
      "reputation" : 1,
      "user_id" : 30065077,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14Ghlg3llVk1AXJosTL6so7-YV4KR2QAjEj2rUQh0=k-s256",
      "display_name" : "Кино Обзорчик",
      "link" : "https://stackoverflow.com/users/30065077/%d0%9a%d0%b8%d0%bd%d0%be-%d0%9e%d0%b1%d0%b7%d0%be%d1%80%d1%87%d0%b8%d0%ba"
    },
    "is_answered" : false,
    "view_count" : 36,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1742974619,
    "creation_date" : 1742974619,
    "link" : "https://stackoverflow.com/questions/79535698/repeat-ir-signal-for-nec-button-hold",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}