{
  "question" : {
    "question_id" : 79676281,
    "title" : "Java ServiceLoader loads in Java22, but not in Java23",
    "body" : "<p>I have a program that uses ServiceLoader, which works fine in Java22, but does not load anything in Java23.</p>\n<p>Where can I find out about differences in behaviour between the two different versions.</p>\n<p>And what is the best way to debug ServiceLoader.  At the moment I only know it's finding anything to load.</p>\n<p>The code looks like this.</p>\n<pre><code>public void loadPlugins() {\n    ServiceLoader&lt;EPlugBase&gt; serviceLoader = ServiceLoader.load(EPlugBase.class);\n    msgMainListener.Send(new EMsgData.Builder().setType(EMsgData.MsgType.DEBUG).setSender(this).setText(&quot;Service Loader: &quot; + serviceLoader.toString() + &quot;\\n&quot;).build());\n    Integer count = 0;\n\n    for (EPlugBase plugin : serviceLoader) {\n        LOG.log(Level.INFO, &quot;load plug {0}&quot;, plugin.getName());\n        count++;\n        msgMainListener.Send(new EMsgData.Builder().setType(EMsgData.MsgType.PLUGINLOAD).setSender(this).setData(new EPair(jarinfos.size(), count)).setText(plugin.getName()).build());\n        msgMainListener.Send(new EMsgData.Builder().setType(EMsgData.MsgType.DEBUG).setSender(this).setText(plugin.getName()).build());\n        plugins.add(plugin);\n        // set the message listener\n        plugin.setMsgListener((EMsgData msg) -&gt; msgListener(msg));\n        // init will return a List of listeners that are added to downlisteners\n        downlisteners.addAll(plugin.init(frame, datamodules));\n        // add any settings panels to the dialog\n        settingsDialog.addPanels(plugin.getSettingPanels());\n        // add menu stuff for this plugin\n        buildMenus(plugin);\n    }\n</code></pre>\n<p>This code is in a jar, that is called used by the main program jar.  At present I am running this in Netbeans IDE.</p>\n<p>I recompiled the code with Java23 to arrive at the issue.  When compiled with Java22 it works ok.</p>\n",
    "tags" : [ "java" ],
    "owner" : {
      "account_id" : 9298415,
      "reputation" : 29,
      "user_id" : 6904686,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2a101848eec575abd48f34e4e487bf05?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Tim Frost",
      "link" : "https://stackoverflow.com/users/6904686/tim-frost"
    },
    "is_answered" : true,
    "view_count" : 78,
    "closed_date" : 1750970680,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1750786317,
    "creation_date" : 1750686528,
    "link" : "https://stackoverflow.com/questions/79676281/java-serviceloader-loads-in-java22-but-not-in-java23",
    "closed_reason" : "Not suitable for this site"
  },
  "answers" : [ {
    "answer_id" : 79676401,
    "question_id" : 79676281,
    "body" : "<p>Given:</p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.timfrost.app;\n\npublic interface EPlugBase {}\n</code></pre>\n<p>then this: <code>ServiceLoader.load(EPlugBase.class);</code></p>\n<p>Does the equivalent of:</p>\n<pre class=\"lang-java prettyprint-override\"><code>var out = new ArrayList&lt;EPlugBase&gt;();\nEnumeration&lt;URL&gt; resourceUrls = EPlugBase.class.getClassLoader()\n   .getResources(&quot;/META-INF/services/com.timfrost.app.EPlugBase&quot;);\n\nwhile (resourceUrls.hasNextElement()) {\n  List&lt;String&gt; lines = readContentAsLines(resourceUrls.nextElement());\n  for (String line : lines) {\n    if (line.trim().isEmpty()) continue;\n    Class&lt;? extends EPlugBase&gt; c = EPlugBase.class.getClassLoader.loadClass(line);\n    out.add(c.newInstance());\n  }\n}\n\nreturn out;\n</code></pre>\n<p>In other words:</p>\n<ul>\n<li>find every <code>META-INF/services/fully.qualified.classname</code> file on each entry in the classpath, or the equivalent of that if using fancy classloaders.</li>\n<li>For each non-empty line in each such file, treat it as the fully qualified name of an implementation.</li>\n<li>load that, using some classloader (the way you called it, whatever loaded EPlugBase)</li>\n<li>instantiate it by calling its public no-args constructor.</li>\n<li>return all such created instances.</li>\n</ul>\n<p>Unless you're messing with classloaders, the system has only one relevant loader here - the app loader, which loads from whatever you passed as classpath when starting the JVM.</p>\n<p>To debug it, do the same steps, introspect every step.</p>\n<p>Most likely the issue lies in the classloader; the classloader of EPlugBase can't find your META-INF/services files. Exactly what you changed in your classloader / runtime modularization setup is not clear from your question, but its where I would be looking.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 401843,
      "reputation" : 107186,
      "user_id" : 768644,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/b13bedc5215730fbce5edff6c130988a?s=256&d=identicon&r=PG",
      "display_name" : "rzwitserloot",
      "link" : "https://stackoverflow.com/users/768644/rzwitserloot"
    },
    "creation_date" : 1750691760,
    "last_activity_date" : 1750691760,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140536322,
    "post_id" : 79676281,
    "body" : "also unclear how you execute the particular method / program , is it a jar ? running from an IDE ? running on an app server ?",
    "score" : 0,
    "owner" : {
      "account_id" : 4522916,
      "reputation" : 1262,
      "user_id" : 3675565,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/C1AWu.png?s=256",
      "display_name" : "AntJavaDev",
      "link" : "https://stackoverflow.com/users/3675565/antjavadev"
    },
    "creation_date" : 1750711083,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140535397,
    "post_id" : 79676281,
    "body" : "It&#39;s unclear whether you took classes compiled with JDK 22 and tried running them on a Java 23 VM, or whether you recompiled with JDK 23 and tried running the result on Java 23.  Whichever you did, it might be illuminating to try the other.  It might also be illuminating to try using JDK 23 to compile for Java 22, and then seeing how the result behaves on Java 22 (and maybe also on Java 23).",
    "score" : 0,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1750688432,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140535378,
    "post_id" : 79676281,
    "body" : "Requests for external resources are off topic here. Generally speaking, release notes and the docs of the particular class(es) involved are where one would ordinarily look for information about changes, especially breaking changes.",
    "score" : 1,
    "owner" : {
      "account_id" : 2792262,
      "reputation" : 190832,
      "user_id" : 2402272,
      "user_type" : "registered",
      "accept_rate" : 85,
      "profile_image" : "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=256&d=identicon&r=PG",
      "display_name" : "John Bollinger",
      "link" : "https://stackoverflow.com/users/2402272/john-bollinger"
    },
    "creation_date" : 1750688001,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79676401" : [ {
      "comment_id" : 140536292,
      "post_id" : 79676401,
      "body" : "That is only partially true. In case you are using modules, ServiceLoader will not scan <code>META-INF&#47;services&#47;fully.qualified.classname</code> but the module configurations.",
      "score" : 3,
      "owner" : {
        "account_id" : 1692034,
        "reputation" : 4140,
        "user_id" : 1554195,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/b67f6a3639e7924c531053212048be5c?s=256&d=identicon&r=PG",
        "display_name" : "tquadrat",
        "link" : "https://stackoverflow.com/users/1554195/tquadrat"
      },
      "creation_date" : 1750710223,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}