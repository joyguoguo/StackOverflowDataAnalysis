{
  "question" : {
    "question_id" : 79554836,
    "title" : "Map flat Entity to List with Mapstruct",
    "body" : "<p>I would like to map this flat entity:</p>\n<pre><code>@Entity\n@Table(name = &quot;vw_class_schedule&quot;)\n@Data\n@NoArgsConstructor\n@AllArgsConstructor\n@Builder\n@Immutable\n@IdClass(ClassViewEntityId.class)\nclass FlatEntityClassAndSchedule {\n\n   @Id\n    Integer classId;\n    String subject;\n\n    @Id\n    Integer scheduleId;\n    ZoneId timezoneId;\n    Datetime startTime;\n\n}\n</code></pre>\n<p>where id Class is:</p>\n<pre><code>public class ClassViewEntityId { \nprivate Integer classId;\n private Integer scheduleId; \n}\n</code></pre>\n<p>to this:</p>\n<pre><code>class Class { \nInteger classId; \nString subject; \nList&lt;Schedule&gt; schedules; \n}\n</code></pre>\n<p>where Schedule:</p>\n<pre><code>class Schedule{\n Integer scheduleId;\n ZoneId timezoneId; \nDatetime startTime; \n}\n</code></pre>\n<p>This is returned from a database view that joins class and schedule tables (one-to-many), hence no primary keys, and would expect multiple rows of the same class with each different schedule. I tried using MapStruct, but I encountered problems while doing so.</p>\n<p>How can I map it properly?</p>\n",
    "tags" : [ "java", "hibernate", "mapping", "mapstruct" ],
    "owner" : {
      "account_id" : 24804759,
      "reputation" : 21,
      "user_id" : 18686901,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14Gihifq4Zi7e17Ouw1wqguoGJwDh9n-AWHNc2Lfdkw=k-s256",
      "display_name" : "David Pietrocola",
      "link" : "https://stackoverflow.com/users/18686901/david-pietrocola"
    },
    "is_answered" : true,
    "view_count" : 72,
    "answer_count" : 1,
    "score" : 2,
    "last_activity_date" : 1745212875,
    "creation_date" : 1743755359,
    "link" : "https://stackoverflow.com/questions/79554836/map-flat-entity-to-list-with-mapstruct",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79581279,
    "question_id" : 79554836,
    "body" : "<p>You can use maptstruct to map properties to splitted classes. But the nesting has to be implemented manually as mapstruct cannot know the logic. It may look to something like this:</p>\n<pre><code>@Mapper\npublic interface ClassScheduleMapper {\n\n  ClassScheduleMapper INSTANCE = Mappers.getMapper(ClassScheduleMapper.class);\n\n  // Mapstruct instruction for Schedule\n  Schedule toSchedule(FlatEntityClassAndSchedule flat);\n\n  // Mapstruct instruction for ScheduleClass ignoring the schedules field\n  @Mapping(target = &quot;schedules&quot;, ignore = true /* going to be added in mapToClassList */)\n  ScheduleClass toScheduleClass(FlatEntityClassAndSchedule flat);\n\n  // Nested logic to split flatted records into single, nested classes\n  default List&lt;ScheduleClass&gt; mapToClassList(List&lt;FlatEntityClassAndSchedule&gt; flatList) {\n    Map&lt;Integer, ScheduleClass&gt; resultMap = new LinkedHashMap&lt;&gt;();\n\n    flatList.forEach(flat -&gt; {\n      ScheduleClass currentClass = resultMap.computeIfAbsent(flat.getClassId(), id -&gt; {\n        // create new ScheduleClass if not present in map\n        ScheduleClass newClass = toScheduleClass(flat); /* maps scheduleClass via mapstruct */\n        newClass.setSchedules(new ArrayList&lt;&gt;());\n        return newClass;\n      });\n      currentClass.getSchedules().add(toSchedule(flat) /* maps schedule via mapstruct and adds to current class */);\n    });\n\n    return new ArrayList&lt;&gt;(resultMap.values());\n  }\n}\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 11555562,
      "reputation" : 569,
      "user_id" : 8466853,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/cd7f72b426ce3c46739900b8ba014e26?s=256&d=identicon&r=PG",
      "display_name" : "Arno",
      "link" : "https://stackoverflow.com/users/8466853/arno"
    },
    "creation_date" : 1744988362,
    "last_activity_date" : 1744989273,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}