{
  "question" : {
    "question_id" : 79545564,
    "title" : "Get real time file size in java",
    "body" : "<p>There is an existing api which writes the file to particular location and the code snippet is like below:</p>\n<pre><code>            long lastUpdatedOn = System.currentTimeMillis();\n            try(BufferedOutputStream fileOutputStream = new BufferedOutputStream(new FileOutputStream(filePath, true))) {\n                byte[] buffer = new byte[4096];\n                int bytesRead;\n                while ((bytesRead = bufferedInputStream.read(buffer)) != -1) {\n                    fileOutputStream.write(buffer, 0, bytesRead);\n                    long now = System.currentTimeMillis();\n                    if (now - lastUpdatedOn &gt; 2 * 1000L) {\n                        fileOutputStream.flush();\n                        lastUpdatedOn = now;\n                    }\n                }\n</code></pre>\n<p>It is running in background. I want to have api(will hit on certain interval) which should return the real-time size of the file. Suppose filesize is 1GB. If 500MB file content is written at the moment when I hit the api then it should return that file-size.\nI have code like below:</p>\n<pre><code>java.nio.file.Path path = Paths.get(destinationFullFolderPath.toString());\n    if (Files.exists(path)) {\n                        resultMap.put(fileName, Files.size(path));\n                    }\n</code></pre>\n<p>But I am constantly hitting this api and getting empty result and I get the result once total file is written. I am confused that where should I make change. Whether to make change in the api which is writing file or in the api which should return real-time filesize.</p>\n",
    "tags" : [ "java", "java-io", "filesize" ],
    "owner" : {
      "account_id" : 24948833,
      "reputation" : 38,
      "user_id" : 18813886,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GjxwjRYh-IwnRo5O2_ORyqIoeV8x7joTw0qo0XW=k-s256",
      "display_name" : "Amit J.",
      "link" : "https://stackoverflow.com/users/18813886/amit-j"
    },
    "is_answered" : true,
    "view_count" : 146,
    "answer_count" : 1,
    "score" : -2,
    "last_activity_date" : 1744121886,
    "creation_date" : 1743400161,
    "link" : "https://stackoverflow.com/questions/79545564/get-real-time-file-size-in-java",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79562307,
    "question_id" : 79545564,
    "body" : "<p>When you get an empty map, the <code>Files.exists(path)</code> check must have resulted in <code>false</code>. The connection between your code fragments is not visible but it’s striking that you are writing to something determined by a variable <code>filePath</code> but querying a path given by <code>destinationFullFolderPath.toString()</code>. These names do not seem to refer to the same thing.</p>\n<p>But there’s also the possibility that the majority of the work is done before the copying loop even starts, e.g. by buffering the entire source data. That would also match the behavior of seeing that the file does not exist throughout most of the time, while writing the buffered data at the end takes almost no time, so you never see an intermediate state.</p>\n<p>There is no need to implement your own copy operation. When I use the following snippet, for example,</p>\n<pre class=\"lang-java prettyprint-override\"><code>String source = …, target = …;\n\nPath p = Paths.get(target);\n\nExecutorService background = Executors.newSingleThreadExecutor();\n\ntry(InputStream input = new URL(source).openStream()) {\n    System.out.println(&quot;writing to &quot; + p.toAbsolutePath());\n    Future&lt;?&gt; f = background.submit(() -&gt; Files.copy(input, p));\n    while(!f.isDone()) {\n        if(Files.exists(p)) System.out.println(Files.size(p));\n        Thread.sleep(30);\n    }\n    f.get();\n} finally {\n    background.shutdown();\n}\n</code></pre>\n<p>I get updated sizes without problems. Tested under Windows and Linux.</p>\n",
    "score" : 4,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 3211603,
      "reputation" : 300981,
      "user_id" : 2711488,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/t2hoD.jpg?s=256",
      "display_name" : "Holger",
      "link" : "https://stackoverflow.com/users/2711488/holger"
    },
    "creation_date" : 1744121886,
    "last_activity_date" : 1744121886,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140286075,
    "post_id" : 79545564,
    "body" : "I am susptecting a misapprehension here. When you read EOS on the input, you won&#39;t block until more data arrives: instead, <code>read()</code> will return -1. So you are probably looking at an output file that is always empty. But existent. More information required.",
    "score" : 0,
    "owner" : {
      "account_id" : 71739,
      "reputation" : 311869,
      "user_id" : 207421,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=256&d=identicon&r=PG",
      "display_name" : "user207421",
      "link" : "https://stackoverflow.com/users/207421/user207421"
    },
    "creation_date" : 1743498775,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140285299,
    "post_id" : 79545564,
    "body" : "Can you describe the system this is running in? What OS? Is it a cloud based application? I don&#39;t see why that wouldn&#39;t work in a &quot;regular Unix system.&quot;",
    "score" : 0,
    "owner" : {
      "account_id" : 1041463,
      "reputation" : 3917,
      "user_id" : 1047418,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/3deab5aa1be96fe145d3103251263523?s=256&d=identicon&r=PG",
      "display_name" : "Torben",
      "link" : "https://stackoverflow.com/users/1047418/torben"
    },
    "creation_date" : 1743483896,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140284735,
    "post_id" : 79545564,
    "body" : "You would be better off removing the timing check from the inner loop and letting the <code>BufferedOutputStream</code> auto-flush itself, which it does every 8k bytes, You&#39;re wasting time with this extra code. Are you really supposed to be appending to the file?",
    "score" : 0,
    "owner" : {
      "account_id" : 71739,
      "reputation" : 311869,
      "user_id" : 207421,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=256&d=identicon&r=PG",
      "display_name" : "user207421",
      "link" : "https://stackoverflow.com/users/207421/user207421"
    },
    "creation_date" : 1743464524,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140284732,
    "post_id" : 79545564,
    "body" : "The connection with <a href=\"https://stackoverflow.com/questions/tagged/jax-rs\">jax-rs</a> escapes me, and <a href=\"https://stackoverflow.com/questions/tagged/progress\">progress</a> is for questions about the Progress development tool. Don&#39;t tag indiscriminately.",
    "score" : 0,
    "owner" : {
      "account_id" : 71739,
      "reputation" : 311869,
      "user_id" : 207421,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=256&d=identicon&r=PG",
      "display_name" : "user207421",
      "link" : "https://stackoverflow.com/users/207421/user207421"
    },
    "creation_date" : 1743464407,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140283569,
    "post_id" : 79545564,
    "body" : "@AmitK. This implies that you are getting <code>Files.exists(filePath) == false</code> even when writing is taking a long time? That does not seem right, unless you are checking the wrong path.",
    "score" : 1,
    "owner" : {
      "account_id" : 5998820,
      "reputation" : 16283,
      "user_id" : 4712734,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f6e922a2cb7e2da59286f27b162aaca5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "DuncG",
      "link" : "https://stackoverflow.com/users/4712734/duncg"
    },
    "creation_date" : 1743440794,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140283554,
    "post_id" : 79545564,
    "body" : "@DuncG getting empty result means whenever I am hitting the api, I am getting empty map in the response",
    "score" : 0,
    "owner" : {
      "account_id" : 24948833,
      "reputation" : 38,
      "user_id" : 18813886,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GjxwjRYh-IwnRo5O2_ORyqIoeV8x7joTw0qo0XW=k-s256",
      "display_name" : "Amit J.",
      "link" : "https://stackoverflow.com/users/18813886/amit-j"
    },
    "creation_date" : 1743440577,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140282769,
    "post_id" : 79545564,
    "body" : "What do you mean by &quot;getting empty result&quot;?",
    "score" : 0,
    "owner" : {
      "account_id" : 5998820,
      "reputation" : 16283,
      "user_id" : 4712734,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f6e922a2cb7e2da59286f27b162aaca5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "DuncG",
      "link" : "https://stackoverflow.com/users/4712734/duncg"
    },
    "creation_date" : 1743429586,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140281547,
    "post_id" : 79545564,
    "body" : "Your code will need to be multi- threaded to do this. If you have a gui you can use <code>ProgessMonitorInputStream</code>",
    "score" : 0,
    "owner" : {
      "account_id" : 22124137,
      "reputation" : 4243,
      "user_id" : 16376827,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/1ImPw.png?s=256",
      "display_name" : "g00se",
      "link" : "https://stackoverflow.com/users/16376827/g00se"
    },
    "creation_date" : 1743411462,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140281496,
    "post_id" : 79545564,
    "body" : "There aren&#39;t any &#39;changes [that] need to be made in order to make it work&#39;. It <i>won&#39;t</i> work, and it <i>can&#39;t</i> work, for the reason I already gave, unless you can modify the existing API code to close the file periodically, or to update some variable elsewhere with the current write state.",
    "score" : 1,
    "owner" : {
      "account_id" : 71739,
      "reputation" : 311869,
      "user_id" : 207421,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=256&d=identicon&r=PG",
      "display_name" : "user207421",
      "link" : "https://stackoverflow.com/users/207421/user207421"
    },
    "creation_date" : 1743410670,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140281092,
    "post_id" : 79545564,
    "body" : "To achieve this function you need a manager that monitors the progress and from which you can receive the recorded data in real time. In the world of <i>java ee</i> (<i>jakarta ee</i>) this can be implemented with <code>EJB</code> / <code>CDI</code> bean and the communication with it can be direct or with <code>CDI event</code>. Also, you can use <code>sse</code> directly to notify the client about progress &quot;in real time&quot;.",
    "score" : 0,
    "owner" : {
      "account_id" : 6179310,
      "reputation" : 2907,
      "user_id" : 4815321,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c7f1efe4e3c5d007dc7c5cc7d5a64e95?s=256&d=identicon&r=PG",
      "display_name" : "mr mcwolf",
      "link" : "https://stackoverflow.com/users/4815321/mr-mcwolf"
    },
    "creation_date" : 1743401973,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140281091,
    "post_id" : 79545564,
    "body" : "@user207421 What changes need to made inorder to make it work?",
    "score" : 0,
    "owner" : {
      "account_id" : 24948833,
      "reputation" : 38,
      "user_id" : 18813886,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GjxwjRYh-IwnRo5O2_ORyqIoeV8x7joTw0qo0XW=k-s256",
      "display_name" : "Amit J.",
      "link" : "https://stackoverflow.com/users/18813886/amit-j"
    },
    "creation_date" : 1743401971,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140281075,
    "post_id" : 79545564,
    "body" : "true :(, then use the buffer size you provide for writing (actually, only the last block should be incomplete).",
    "score" : 0,
    "owner" : {
      "account_id" : 6179310,
      "reputation" : 2907,
      "user_id" : 4815321,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c7f1efe4e3c5d007dc7c5cc7d5a64e95?s=256&d=identicon&r=PG",
      "display_name" : "mr mcwolf",
      "link" : "https://stackoverflow.com/users/4815321/mr-mcwolf"
    },
    "creation_date" : 1743401613,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140281058,
    "post_id" : 79545564,
    "body" : "@mrmcwolf <code>BufferedOutputStream.write()</code> does not return the number of bytes written. It is <code>void</code>.",
    "score" : 1,
    "owner" : {
      "account_id" : 71739,
      "reputation" : 311869,
      "user_id" : 207421,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=256&d=identicon&r=PG",
      "display_name" : "user207421",
      "link" : "https://stackoverflow.com/users/207421/user207421"
    },
    "creation_date" : 1743401322,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140281056,
    "post_id" : 79545564,
    "body" : "Also, the operating system may defer updating the directory entry until the file is closed.",
    "score" : 0,
    "owner" : {
      "account_id" : 71739,
      "reputation" : 311869,
      "user_id" : 207421,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=256&d=identicon&r=PG",
      "display_name" : "user207421",
      "link" : "https://stackoverflow.com/users/207421/user207421"
    },
    "creation_date" : 1743401274,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140281054,
    "post_id" : 79545564,
    "body" : "@mr mcwolf How can I do that? certain code snippet could help better. And I am different api to fetch the real-time filesize of the file being written in background",
    "score" : 0,
    "owner" : {
      "account_id" : 24948833,
      "reputation" : 38,
      "user_id" : 18813886,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GjxwjRYh-IwnRo5O2_ORyqIoeV8x7joTw0qo0XW=k-s256",
      "display_name" : "Amit J.",
      "link" : "https://stackoverflow.com/users/18813886/amit-j"
    },
    "creation_date" : 1743401242,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140281043,
    "post_id" : 79545564,
    "body" : "I/O operations cache the data. That&#39;s why you only see the changes when you close the file. If you need progress feedback, use the data returned by <code>write</code> (number of bytes written).",
    "score" : 6,
    "owner" : {
      "account_id" : 6179310,
      "reputation" : 2907,
      "user_id" : 4815321,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c7f1efe4e3c5d007dc7c5cc7d5a64e95?s=256&d=identicon&r=PG",
      "display_name" : "mr mcwolf",
      "link" : "https://stackoverflow.com/users/4815321/mr-mcwolf"
    },
    "creation_date" : 1743400802,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}