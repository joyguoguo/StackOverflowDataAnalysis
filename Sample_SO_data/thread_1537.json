{
  "question" : {
    "question_id" : 79697049,
    "title" : "FEST Robot can&#39;t interact with GUI on CI server",
    "body" : "<p>Here's a FEST test. To make it truly minimal, I tried to make it as simple as possible.</p>\n<pre class=\"lang-java prettyprint-override\"><code>import org.fest.swing.core.BasicRobot;\nimport org.fest.swing.core.Robot;\nimport org.fest.swing.edt.GuiActionRunner;\nimport org.fest.swing.edt.GuiQuery;\nimport org.junit.jupiter.api.AfterEach;\nimport org.junit.jupiter.api.BeforeAll;\nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.Test;\n\nimport javax.swing.JFrame;\nimport javax.swing.JRadioButton;\nimport java.awt.EventQueue;\nimport java.awt.GraphicsEnvironment;\nimport java.awt.Toolkit;\n\nimport static org.junit.jupiter.api.Assertions.assertTrue;\nimport static org.junit.jupiter.api.Assumptions.assumeFalse;\nimport static org.junit.jupiter.api.Assumptions.assumeTrue;\n\npublic class SimpleRadioTest {\n\n    Robot robot;\n    JFrame frame;\n//    FrameFixture frame;\n    JRadioButton radio;\n\n    @BeforeAll\n    static void beforeAll() {\n        assumeFalse(GraphicsEnvironment.isHeadless(), &quot;Headless environment&quot;);\n    }\n\n    @BeforeEach\n    void setUp() {\n        robot = BasicRobot.robotWithCurrentAwtHierarchy();\n        frame = createFrame();\n        frame.setVisible(true);\n//        frame = new FrameFixture(robot, createFrame());\n//        frame.show();\n    }\n\n    @AfterEach\n    void tearDown() {\n        frame.setVisible(false);\n//        frame.cleanUp();\n    }\n\n    @Test\n    void whenRadioClicked_itGetsSelected() {\n        assumeTrue(frame.isShowing(), &quot;Frame not showing&quot;);\n        assumeTrue(radio.isShowing(), &quot;Radio not showing&quot;);\n        assumeTrue(radio.isEnabled(), &quot;Radio not enabled&quot;);\n        assumeFalse(radio.isSelected(), &quot;Radio already selected&quot;);\n        robot.click(radio);\n        robot.waitForIdle(); // redundant, since click() includes waitForIdle(), just to be explicit\n        assumeTrue(eventQueueEmpty()); // it's truly empty, no more events to process\n        assertTrue(radio.isSelected(), &quot;Radio not selected after click&quot;); // fails\n    }\n\n    private boolean eventQueueEmpty() {\n        EventQueue eventQueue = Toolkit.getDefaultToolkit().getSystemEventQueue();\n        return eventQueue.peekEvent() == null;\n    }\n\n    private JFrame createFrame() {\n        return GuiActionRunner.execute(new GuiQuery&lt;JFrame&gt;() {\n            protected JFrame executeInEDT() {\n                JFrame frame = new JFrame();\n                frame.add(createRadio());\n                frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n                frame.setSize(300, 200);\n                frame.setLocationRelativeTo(null);\n                return frame;\n            }\n        });\n    }\n\n    private JRadioButton createRadio() {\n        return radio = new JRadioButton();\n    }\n}\n</code></pre>\n<pre class=\"lang-xml prettyprint-override\"><code>        &lt;dependency&gt;\n            &lt;groupId&gt;org.easytesting&lt;/groupId&gt;\n            &lt;artifactId&gt;fest-swing&lt;/artifactId&gt;\n            &lt;version&gt;1.2.1&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n</code></pre>\n<p>It easily passes on my local machine.</p>\n<p>However, when I push it to a CI server (we use TeamCity), the test assertion fails.</p>\n<pre><code>org.opentest4j.AssertionFailedError: Radio not selected after click ==&gt; expected: &lt;true&gt; but was: &lt;false&gt;\n</code></pre>\n<p>Notice the assumptions I make in my test. The server has a graphic environment, and the components are both <code>visible</code> and <code>showing</code>. The event queue is depleted.</p>\n<p>I tried to operate through FEST's <code>FrameFixture</code> instead of <code>JFrame</code> directly (see the commented-out sections), but it didn't help.</p>\n<p>I even considered whether a physical mouse is required for clicks. However, the test passes locally even if I disconnect my mouse.</p>\n<p>The CI server is on Windows.</p>\n<p>Why is my <code>Robot</code> not working?</p>\n",
    "tags" : [ "java", "windows", "swing", "fest" ],
    "owner" : {
      "account_id" : 10187542,
      "reputation" : 2683,
      "user_id" : 20692967,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
      "display_name" : "Sergey Zolotarev",
      "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
    },
    "is_answered" : false,
    "view_count" : 45,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1752222849,
    "creation_date" : 1752150109,
    "link" : "https://stackoverflow.com/questions/79697049/fest-robot-cant-interact-with-gui-on-ci-server",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140581816,
    "post_id" : 79697049,
    "body" : "GPT says it may have to do with the session not being &quot;interactive&quot;, whatever that means. The CI server supposedly runs <i>&quot;as a service, or under a locked/“disconnected” RDP session&quot;</i>. I wonder if I can do something about it",
    "score" : 0,
    "owner" : {
      "account_id" : 10187542,
      "reputation" : 2683,
      "user_id" : 20692967,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
      "display_name" : "Sergey Zolotarev",
      "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
    },
    "creation_date" : 1752222781,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}