{
  "question" : {
    "question_id" : 79553204,
    "title" : "A Star Algorithm not finding single complete path",
    "body" : "<p>I have an implementation of Astar but it seems to plot an odd path to the target.\nIt appears to evaluate node correctly,  but I'm not sure if it is working right because the path list at the end contains nodes with equal G scores.</p>\n<p>Here is my code</p>\n<pre><code>startNode = getTile(new Point(3,6));\ntargetNode = getTile(new Point(1,4));\nArrayList&lt;Node&gt; closedList;\nvoid AStar() {\n    closedList = new ArrayList&lt;&gt;();\n    ArrayList&lt;Node&gt; openList = new ArrayList&lt;&gt;();\n    startNode.g = 0;\n    startNode.h = heuristic(startNode,targetNode);\n    startNode.f = startNode.g+startNode.h;\n    Log.d(&quot;COST&quot;,startNode.h+&quot;&quot;);\n    cost = startNode.h;\n    openList.add(startNode);\n    while (!openList.isEmpty()) {\n\n        //Find the node with the lowest f value\n        int lowestFcost = openList.get(0).f;\n        Node processNode = openList.get(0);\n        for(int i = 1;i&lt;openList.size();i++){\n            if(openList.get(i).f &lt; lowestFcost){\n                lowestFcost = openList.get(i).f;\n                processNode = openList.get(i);\n            }\n        }\n\n\n        if (processNode.equals(targetNode)) {\n            path(processNode);\n            return;\n        }\n        openList.remove(processNode);\n        closedList.add(processNode);\n\n        for (Node n:nextNodes(processNode)) {\n            //check if n is in the closed list\n            if(closedList.contains(n)){\n                // skip forloop once\n                Log.d(&quot;SKIPLOOP&quot;,&quot;true&quot;);\n            }else {\n\n\n                if (!openList.contains(n)) {\n                    openList.add(n);\n\n                } else {\n                    for (Node n2 : openList) {\n                        if (n2.equals(n)) {\n\n\n                            if (processNode.g&lt;n.g) {\n\n\n                                //better g score\n                                n2.g = heuristic(processNode,startNode);\n                                n2.h = heuristic(processNode,targetNode);\n                                n2.f = n2.g+n2.h;\n                                n2.parent = processNode;\n                                Log.d(&quot;NODE&quot;,&quot;XY:&quot;+n2.getPosition().toString()+&quot; Gcost:&quot;+n2.g+&quot; Fcost:&quot;+n2.f+&quot; Hcost:&quot;+n2.h);\n                                //n2.view.setBackgroundColor(getResources().getColor(R.color.primary_light,null));\n\n\n                            }\n                    }\n\n\n                    }\n\n\n                }\n\n            }\n        }\n\n    }\nnew ToastEasy(getApplicationContext(),&quot;Not Possible to reach Target&quot;);\n}\n\n\nprivate Node getTile(Point tilePosition){\n    Node tile = null;\n    for (Node t:MapTileList) {\n        if(tilePosition.equals(t.getPosition())){\n            tile = t;\n            break;\n        }\n    }\n    return tile;\n}\n\n\nprivate ArrayList&lt;Node&gt; nextNodes(Node node){\n\n    ArrayList&lt;Node&gt;NextNodeList = new ArrayList&lt;&gt;();\n    if(node.getPosition().x-1 &gt;= 0 ){\n        //Add a left Node\n        Node n = getTile(new Point(node.getPosition().x-1,node.getPosition().y));\n        //n.parent = node;\n        n.g = heuristic(n,startNode);\n        n.h = heuristic(n,targetNode);\n        n.f = n.g+n.h;\n        n.view.setBackgroundColor(getResources().getColor(R.color.green,null));\n        NextNodeList.add(n); //Left Node\n    }\n    if(node.getPosition().y-1 &gt;= 0){\n        //Add a top Node\n        Node n = getTile(new Point(node.getPosition().x,node.getPosition().y-1));\n\n        //n.parent = node;\n        n.g = heuristic(n,startNode);\n        n.h = heuristic(n,targetNode);\n        n.f = n.g+n.h;\n        n.view.setBackgroundColor(getResources().getColor(R.color.green,null));\n        NextNodeList.add(n); //Top Node\n    }\n    if(node.getPosition().x+1 &lt;= cols ){\n        //Add a Right Node\n        Node n = getTile(new Point(node.getPosition().x+1,node.getPosition().y));\n\n        //n.parent = node;\n        n.g = heuristic(n,startNode);\n        n.h = heuristic(n,targetNode);\n        n.f = n.g+n.h;\n        n.view.setBackgroundColor(getResources().getColor(R.color.green,null));\n        NextNodeList.add(n);\n    }\n    if(node.getPosition().y+1 &lt;= rows) {\n        //Add a Bottom Node\n        Node n = getTile(new Point(node.getPosition().x, node.getPosition().y + 1));\n\n        //n.parent = node;\n        n.g = heuristic(n,startNode);\n        n.h = heuristic(n,targetNode);\n        n.f = n.g+n.h;\n        n.view.setBackgroundColor(getResources().getColor(R.color.green,null));\n        NextNodeList.add(n);\n\n    }\n    return NextNodeList;\n}\nvoid path(Node node){\n    int lastCost = 0;\n    ArrayList&lt;Node&gt;Path = new ArrayList&lt;&gt;();\n    for (Node node1 : closedList) {\n       if(node1.parent != null){\n\n           node1.view.setBackgroundColor(getResources().getColor(R.color.black,null));\n           Path.add(node1);\n\n           //Log.d(&quot;PATHLIST&quot;,Path.get(i).getPosition()+&quot; Gcost&quot;+Path.get(i).g+&quot; Hcost&quot;+Path.get(i).h+&quot; Fcost&quot;+Path.get(i).f);\n       }\n\n    }\n\n    Log.d(&quot;PATHLIST&quot;,Path.size()+&quot;&quot;);\n\n}\n\nprivate int heuristic(Node node1, Node node2){\n\n\n    return Math.abs((node1.getPosition().x-node2.getPosition().x))\n            +\n            Math.abs((node1.getPosition().y-node2.getPosition().y));\n\n}\n</code></pre>\n<p>I'm following this tutorial here:\n<a href=\"https://algorithmsinsight.wordpress.com/graph-theory-2/a-star-in-general/implementing-astar-for-pathfinding\" rel=\"nofollow noreferrer\">https://algorithmsinsight.wordpress.com/graph-theory-2/a-star-in-general/implementing-astar-for-pathfinding</a>\nand here:\n<a href=\"https://algorithmsinsight.wordpress.com/graph-theory-2/a-star-in-general/\" rel=\"nofollow noreferrer\">https://algorithmsinsight.wordpress.com/graph-theory-2/a-star-in-general/</a></p>\n<p>Any help to confirm the correctness of this code would be greatly appreciated.</p>\n<p>Thanks!</p>\n<p>My Node Class</p>\n<pre><code>import android.graphics.Point;\nimport android.widget.ImageButton;\nimport android.widget.TextView;\n\npublic class Node {\n    Point position;\n    public int f,g,h;\n    public Node parent;\n    public ImageButton view;\n    public Node(Point position, int f, int g, int h, Node parent, ImageButton view) {\n        this.position = position;\n        this.f = f;\n        this.g = g;\n        this.h = h;\n        this.parent = parent;\n        this.view = view;\n    }\n    public Point getPosition(){\n\n        return this.position;\n\n\n    }\n}\n</code></pre>\n",
    "tags" : [ "java", "android", "algorithm", "a-star" ],
    "owner" : {
      "account_id" : 36787889,
      "reputation" : 51,
      "user_id" : 27917868,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/1f6a3767e90d8820c106ee9130b5ca5e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Brett Ezra",
      "link" : "https://stackoverflow.com/users/27917868/brett-ezra"
    },
    "is_answered" : true,
    "view_count" : 102,
    "answer_count" : 2,
    "score" : 2,
    "last_activity_date" : 1744121325,
    "creation_date" : 1743689845,
    "link" : "https://stackoverflow.com/questions/79553204/a-star-algorithm-not-finding-single-complete-path",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79562284,
    "question_id" : 79553204,
    "body" : "<p>So after a week of tinkering.  I do believe I have cracked the nut!</p>\n<p>The tutorial that I was trying to follow lead me around in circles and eventually I gave up on trying to update nodes G value as stated in the tutorials.  Instead,  I created a new hybrid cost value, I call the Bcost. Because I'm Brett ;P.  I wont post the entire code here, but I will post a link to the test session where you can launch it in Android Studio and try it for yourself.  The new Bcost makes the algorithm way more efficient and as you'll see,  it barely ever chooses a node that isnt the best next node.  I think it's probably 50-100% faster.  However,  my nextnodes() function is horribly bloated and if anyone wants to take a stab at making that method cleaner.  I would love to see how you accomplish that.</p>\n<p><a href=\"http://nexxiom.com/android/AstarTesting.zip\" rel=\"nofollow noreferrer\">http://nexxiom.com/android/AstarTesting.zip</a></p>\n",
    "score" : 3,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 36787889,
      "reputation" : 51,
      "user_id" : 27917868,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/1f6a3767e90d8820c106ee9130b5ca5e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Brett Ezra",
      "link" : "https://stackoverflow.com/users/27917868/brett-ezra"
    },
    "creation_date" : 1744121325,
    "last_activity_date" : 1744121325,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79557609,
    "question_id" : 79553204,
    "body" : "<p>The main problem as far as I see it is that you have a misunderstanding of what the A*-algorithm actually does. As far as I see it, you have some kind of rectangular field with discrete points on it and you want to have the shortest path between two points. Why do you use A* at all? You can just draw a horizontal and a vertical line and that's it.</p>\n<p>The main point of route planning algorithms is to find the shortest path in an environment where NOT all paths from source to target are actually valid. For example, you could insert obstacles onto your raster (=points that are inside your rectangle, but are invalid).</p>\n<p>Now to your code: You are computing the g-values incorrectly. g is actually the length of the path you have already taken. You cannot just use your heuristic-function here. You really have to build the correct sum. Also, you are using closedList.contains(n) and n2.equals(n), but your Node-class doesn't override hashCode() and equals(). These are the two major flaws I've found immediately. (There may be more...)</p>\n<p>Btw: Using a HashSet instead of a list for your closed nodes will greatly improve performance.</p>\n<p>Side note: Your code is very verbose. You could for example collapse all cases in your nextNodes()-method into one loop that has four iterations. I'm just suggesting that, because you may get more helpful answers in the future if your code is cleaner. Also please improve your formatting for better readability.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 2265646,
      "reputation" : 71,
      "user_id" : 1994405,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/61e5569c37f5657f8f9e80650dfb4eed?s=256&d=identicon&r=PG",
      "display_name" : "user1994405",
      "link" : "https://stackoverflow.com/users/1994405/user1994405"
    },
    "creation_date" : 1743894063,
    "last_activity_date" : 1743894613,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140312944,
    "post_id" : 79553204,
    "body" : "Your comment is invalid",
    "score" : 0,
    "owner" : {
      "account_id" : 36787889,
      "reputation" : 51,
      "user_id" : 27917868,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/1f6a3767e90d8820c106ee9130b5ca5e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Brett Ezra",
      "link" : "https://stackoverflow.com/users/27917868/brett-ezra"
    },
    "creation_date" : 1744132830,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140302230,
    "post_id" : 79553204,
    "body" : "and trincot,  I do see what you mean..  it should be rows -1  to account for the zero index.  Which explains why the code crashes is if use a start or target node at the edge of the map.  thanks",
    "score" : 0,
    "owner" : {
      "account_id" : 36787889,
      "reputation" : 51,
      "user_id" : 27917868,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/1f6a3767e90d8820c106ee9130b5ca5e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Brett Ezra",
      "link" : "https://stackoverflow.com/users/27917868/brett-ezra"
    },
    "creation_date" : 1743852549,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140302226,
    "post_id" : 79553204,
    "body" : "Trincot,  Ill get new code uploaded soon.  I got busy the other day and didnt get a chance to create a test activity for you.  And MrSmith42.  I do have a test..  Ill update the question with more info about the result on monday.",
    "score" : 0,
    "owner" : {
      "account_id" : 36787889,
      "reputation" : 51,
      "user_id" : 27917868,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/1f6a3767e90d8820c106ee9130b5ca5e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Brett Ezra",
      "link" : "https://stackoverflow.com/users/27917868/brett-ezra"
    },
    "creation_date" : 1743852461,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140298353,
    "post_id" : 79553204,
    "body" : "Did you create a test which failed, so you can start debugging?",
    "score" : 0,
    "owner" : {
      "account_id" : 2168743,
      "reputation" : 10181,
      "user_id" : 1921273,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/LREX2.png?s=256",
      "display_name" : "MrSmith42",
      "link" : "https://stackoverflow.com/users/1921273/mrsmith42"
    },
    "creation_date" : 1743755602,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140296126,
    "post_id" : 79553204,
    "body" : "You put the upper bound at <code>rows</code>, that means you have 0, 1, ... <code>rows-1</code> and <code>rows</code> as possible y coordinate values, so in total <code>rows+1</code> distinct y coordinates. That could be fine (I don&#39;t know, as there is no initialisation code), but it looks suspicious, as it is common practice to use the count of distinct coordinate values as boundary, and it is also what the name <code>rows</code> suggest.",
    "score" : 0,
    "owner" : {
      "account_id" : 7142980,
      "reputation" : 357178,
      "user_id" : 5459839,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/lUUgh.png?s=256",
      "display_name" : "trincot",
      "link" : "https://stackoverflow.com/users/5459839/trincot"
    },
    "creation_date" : 1743702273,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140296008,
    "post_id" : 79553204,
    "body" : "Maybe I did.  Its a check for the map bounds on the x axis to avoid a nullppinterexception. What were you thinking?",
    "score" : 0,
    "owner" : {
      "account_id" : 36787889,
      "reputation" : 51,
      "user_id" : 27917868,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/1f6a3767e90d8820c106ee9130b5ca5e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Brett Ezra",
      "link" : "https://stackoverflow.com/users/27917868/brett-ezra"
    },
    "creation_date" : 1743700353,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140295741,
    "post_id" : 79553204,
    "body" : "I think you misunderstood my comment about <code>rows</code>. And if you do provide more code, make sure it is <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">a Minimal, Reproducible Example</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 7142980,
      "reputation" : 357178,
      "user_id" : 5459839,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/lUUgh.png?s=256",
      "display_name" : "trincot",
      "link" : "https://stackoverflow.com/users/5459839/trincot"
    },
    "creation_date" : 1743696161,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140295536,
    "post_id" : 79553204,
    "body" : "rows and columns reference the map rows and columns.  I didnt include the map generation method because its a basic tilemap generation loop..  for within a for.  What I can do is send you the entire activity code,  then youll have the map generator too   Just give me a day cause Im away from my computer till tomorrow",
    "score" : 0,
    "owner" : {
      "account_id" : 36787889,
      "reputation" : 51,
      "user_id" : 27917868,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/1f6a3767e90d8820c106ee9130b5ca5e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Brett Ezra",
      "link" : "https://stackoverflow.com/users/27917868/brett-ezra"
    },
    "creation_date" : 1743693611,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140295439,
    "post_id" : 79553204,
    "body" : "Please make sure the code can compile and run and launches the AStar function with concrete input, showing what you said about the same g-scores. There are several variables in your current code that are undefined. I find <code>&lt;=rows</code> suspicious, as normally you would have rows indexed from 0 to <code>rows-1</code>.",
    "score" : 0,
    "owner" : {
      "account_id" : 7142980,
      "reputation" : 357178,
      "user_id" : 5459839,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/lUUgh.png?s=256",
      "display_name" : "trincot",
      "link" : "https://stackoverflow.com/users/5459839/trincot"
    },
    "creation_date" : 1743692255,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79562284" : [ {
      "comment_id" : 140312782,
      "post_id" : 79562284,
      "body" : "external links are not recommended - they can be changed, blocked, deleted... invalidating the answer",
      "score" : 1,
      "owner" : {
        "account_id" : 31180,
        "reputation" : 29752,
        "user_id" : 85421,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/kKvXH.gif?s=256",
        "display_name" : "user85421",
        "link" : "https://stackoverflow.com/users/85421/user85421"
      },
      "creation_date" : 1744130543,
      "content_license" : "CC BY-SA 4.0"
    } ],
    "79557609" : [ {
      "comment_id" : 140307526,
      "post_id" : 79557609,
      "body" : "Thanks for the tips.  I havent added an obsticle in yet because I wanted to be sure the code was in a working state,  which its not obviously.  The tutoritals I read and watched only said the G score is the distance from the starting node.  Also,  the hashmap I replaced with a list just to make it easier for my understanding.  And the Nextnode if statements are rough.  because Im hacking away at them constantly.    Can you provide any code samples?",
      "score" : 0,
      "owner" : {
        "account_id" : 36787889,
        "reputation" : 51,
        "user_id" : 27917868,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/1f6a3767e90d8820c106ee9130b5ca5e?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Brett Ezra",
        "link" : "https://stackoverflow.com/users/27917868/brett-ezra"
      },
      "creation_date" : 1744025804,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}