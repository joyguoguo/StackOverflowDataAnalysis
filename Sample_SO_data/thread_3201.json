{
  "question" : {
    "question_id" : 79565811,
    "title" : "Overriding the default font in Look-and-Feel (Nimbus) prevents handling of non-Latin UTF-8 characters in Java Swing",
    "body" : "<p>I recently upgraded my desktop OS to Ubuntu 24.04 which has a new default font. I want to change this to another one as the new one is too condensed and doesn't seem to anti-alias properly in swing.</p>\n<p>I was able to override the font just fine, however the components can no longer handle non-latin characters or others eg. emoji. There seems to be something missing when it tries to handle these characters, but only if the font is overridden. Leaving the Nimbus LAF as-it-is (Noto Sans font on my system) works fine, but if you override the default with the same font, Noto Sans, it also breaks. So there is some difference in the way it handles non-latin characters if you specify a defaultFont override.</p>\n<p>I tried to find out how the fonts are loaded in the sun packages but this just picks the first font found and beyond that it is in some native library.</p>\n<p>Any experience or ideas?</p>\n<p>Here's an example:</p>\n<pre><code>public class LafStyle extends JFrame {\n\n    /**\n     * Constructor.\n     */\n    public LafStyle() {\n        setDefaultCloseOperation(DISPOSE_ON_CLOSE);\n        getContentPane().add(createGui());\n        setMinimumSize(new Dimension(480, 360));\n        pack();\n        setVisible(true);\n    }\n\n    private JPanel createGui() {\n        final JPanel panel = new JPanel(new BorderLayout());\n\n        final JLabel lblText = new JLabel(&quot;AbcD - 度解析&quot;);\n        panel.add(lblText, BorderLayout.CENTER);\n\n        panel.add(new JButton(&quot;Close&quot;), BorderLayout.SOUTH);\n\n        return panel;\n    }\n\n    /**\n     * @param args\n     */\n    public static void main(final String[] args) {\n        // load font\n        Font font = null;\n//      font = new Font(&quot;Noto Sans&quot;, Font.PLAIN, 20);\n        font = new Font(&quot;DejaVu Sans&quot;, Font.PLAIN, 20);\n\n        // set laf\n        final NimbusLookAndFeel laf = new NimbusLookAndFeel();\n        if (font != null) {\n            laf.getDefaults().put(&quot;defaultFont&quot;, new FontUIResource(font));\n        }\n        try {\n            UIManager.setLookAndFeel(laf);\n        }\n        catch (final UnsupportedLookAndFeelException e) {\n            e.printStackTrace();\n        }\n\n        new LafStyle();\n    }\n\n}\n</code></pre>\n",
    "tags" : [ "java", "linux", "swing", "fonts", "awt" ],
    "owner" : {
      "account_id" : 10009472,
      "reputation" : 83,
      "user_id" : 7402698,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/D8lKf.png?s=256",
      "display_name" : "fivejeez",
      "link" : "https://stackoverflow.com/users/7402698/fivejeez"
    },
    "is_answered" : false,
    "view_count" : 119,
    "answer_count" : 0,
    "score" : 2,
    "last_activity_date" : 1744267773,
    "creation_date" : 1744263977,
    "link" : "https://stackoverflow.com/questions/79565811/overriding-the-default-font-in-look-and-feel-nimbus-prevents-handling-of-non-l",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140326414,
    "post_id" : 79565811,
    "body" : "It would be nice to have a way/understanding of how the JRE creates a composite font from the system so that I could set that just for the application I&#39;m running. However that seems to be all isolated in low-level sun packages that are not designed to be altered unfortunately...",
    "score" : 0,
    "owner" : {
      "account_id" : 10009472,
      "reputation" : 83,
      "user_id" : 7402698,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/D8lKf.png?s=256",
      "display_name" : "fivejeez",
      "link" : "https://stackoverflow.com/users/7402698/fivejeez"
    },
    "creation_date" : 1744409202,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140326406,
    "post_id" : 79565811,
    "body" : "I figured out a workaround. The package available in the Ubuntu repositories must be the limited version as there are no CJK characters. I was able to copy the /etc/fonts/conf.d/56-language-selector-prefer.conf file by creating a copy at 55-dejavu-override.conf and modifying the ordering. Now DejaVu is the first choice for latin characters and falls back to Noto... for other languages. This is a system-wide change unfortunately, but that&#39;s probably ok.",
    "score" : 0,
    "owner" : {
      "account_id" : 10009472,
      "reputation" : 83,
      "user_id" : 7402698,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/D8lKf.png?s=256",
      "display_name" : "fivejeez",
      "link" : "https://stackoverflow.com/users/7402698/fivejeez"
    },
    "creation_date" : 1744409084,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140323316,
    "post_id" : 79565811,
    "body" : "Be aware that <a href=\"https://dejavu-fonts.github.io/\" rel=\"nofollow noreferrer\"><i>DevaVu</i></a> fonts come in <a href=\"https://dejavu-fonts.github.io/Download.html\" rel=\"nofollow noreferrer\">two editions</a>: (a) broad, most scripts, and (b) limited, “LGC”, covering only Latin, Greek and Cyrillic scripts. If you see no CJK (Chinese, Japanese, Korean) characters, you must have installed the limited LGC edition.",
    "score" : 0,
    "owner" : {
      "account_id" : 322981,
      "reputation" : 346951,
      "user_id" : 642706,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://i.sstatic.net/ZWEI3.jpg?s=256",
      "display_name" : "Basil Bourque",
      "link" : "https://stackoverflow.com/users/642706/basil-bourque"
    },
    "creation_date" : 1744353493,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140322419,
    "post_id" : 79565811,
    "body" : "I&#39;m not sure how the JDK pulls in fonts from the OS as it&#39;s in a native library, but I imagine it somehow pulls together fonts from multiple files into a composite font that switches between definitions depending on the UTF-8 character code, as even for the default Noto Sans, there are multiple files for each character grouping under /usr/share/fonts/truetype/noto. It would be nice to know how this is done or how this could be resolved by simply adding a deb package with a complete font set.",
    "score" : 0,
    "owner" : {
      "account_id" : 10009472,
      "reputation" : 83,
      "user_id" : 7402698,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/D8lKf.png?s=256",
      "display_name" : "fivejeez",
      "link" : "https://stackoverflow.com/users/7402698/fivejeez"
    },
    "creation_date" : 1744321710,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140322413,
    "post_id" : 79565811,
    "body" : "I believe you are right, the DejaVu Sans doesn&#39;t have a complete UTF-8 charset, wlthough it does have some emoji. I was worried about this being an issue with the new version of Ubuntu. I&#39;m not sure how it was working in my previous version, but I didn&#39;t have to override anything and the font was definitely more clear and handled Chinese characters without any intervention or overrides.",
    "score" : 0,
    "owner" : {
      "account_id" : 10009472,
      "reputation" : 83,
      "user_id" : 7402698,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/D8lKf.png?s=256",
      "display_name" : "fivejeez",
      "link" : "https://stackoverflow.com/users/7402698/fivejeez"
    },
    "creation_date" : 1744321548,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140322405,
    "post_id" : 79565811,
    "body" : "Yes the redundant null check was only there for testing without any font override when you comment out setting any font.",
    "score" : 0,
    "owner" : {
      "account_id" : 10009472,
      "reputation" : 83,
      "user_id" : 7402698,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/D8lKf.png?s=256",
      "display_name" : "fivejeez",
      "link" : "https://stackoverflow.com/users/7402698/fivejeez"
    },
    "creation_date" : 1744321333,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140322053,
    "post_id" : 79565811,
    "body" : "Are you sure DejaVu Sans contains glyphs for the characters <code>度解析</code>? I believe Swing combines several fonts to get the most complete Unicode coverage possible.",
    "score" : 0,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44936,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1744315018,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140321997,
    "post_id" : 79565811,
    "body" : "Side note:  it is impossible for <code>new</code> to return null in Java.  Code never has to check for a null value after calling <code>new</code>.",
    "score" : 0,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44936,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1744313900,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}