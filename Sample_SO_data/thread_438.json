{
  "question" : {
    "question_id" : 79805441,
    "title" : "Why the inflation time for a custom view is so long in Android using java xml?",
    "body" : "<h3>problem</h3>\n<p>The time it takes to inflate is around <strong>15ms ~ 8ms</strong> for a custom view, which is super long.</p>\n<pre class=\"lang-java prettyprint-override\"><code>    long startTime = System.nanoTime();\n    LayoutInflater.from(context).inflate(R.layout.view_profile, this, true);\n    binding = ViewProfileBinding.bind(this);\n    long durationNanos = System.nanoTime() - startTime;        \n</code></pre>\n<p>The layout is just dead simple <code>ConstraintLayout</code> with <code>TextView</code>. (be it <code>ConstraintLayout</code> or <code>LinearLayout</code> the slowness is the same).</p>\n<p>This is just a dead simple hello world project generated with AI to just test the performance.</p>\n<p>What is wrong?</p>\n<h3>code</h3>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;merge xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;\n    xmlns:tools=&quot;http://schemas.android.com/tools&quot;\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;wrap_content&quot;\n    tools:parentTag=&quot;androidx.constraintlayout.widget.ConstraintLayout&quot;&gt;\n\n    &lt;!-- tools:parentTag is used for previewing the layout correctly in the IDE --&gt;\n\n    &lt;ImageView\n        android:id=&quot;@+id/profile_avatar_image&quot;\n        android:layout_width=&quot;64dp&quot;\n        android:layout_height=&quot;64dp&quot;\n        android:layout_marginStart=&quot;16dp&quot;\n        android:layout_marginTop=&quot;16dp&quot;\n        android:layout_marginBottom=&quot;16dp&quot;\n        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;\n        app:layout_constraintStart_toStartOf=&quot;parent&quot;\n        app:layout_constraintTop_toTopOf=&quot;parent&quot;\n        tools:src=&quot;@tools:sample/avatars&quot; /&gt;\n\n    &lt;TextView\n        android:id=&quot;@+id/profile_name_text&quot;\n        android:layout_width=&quot;0dp&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:layout_marginStart=&quot;16dp&quot;\n        android:layout_marginEnd=&quot;16dp&quot;\n        android:textAppearance=&quot;@style/TextAppearance.AppCompat.Large&quot;\n        app:layout_constraintBottom_toTopOf=&quot;@id/profile_email_text&quot;\n        app:layout_constraintEnd_toEndOf=&quot;parent&quot;\n        app:layout_constraintStart_toEndOf=&quot;@id/profile_avatar_image&quot;\n        app:layout_constraintTop_toTopOf=&quot;@id/profile_avatar_image&quot;\n        app:layout_constraintVertical_chainStyle=&quot;packed&quot;\n        tools:text=&quot;Your Name&quot; /&gt;\n\n    &lt;TextView\n        android:id=&quot;@+id/profile_email_text&quot;\n        android:layout_width=&quot;0dp&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:textAppearance=&quot;@style/TextAppearance.AppCompat.Body1&quot;\n        app:layout_constraintBottom_toBottomOf=&quot;@id/profile_avatar_image&quot;\n        app:layout_constraintEnd_toEndOf=&quot;@id/profile_name_text&quot;\n        app:layout_constraintStart_toStartOf=&quot;@id/profile_name_text&quot;\n        app:layout_constraintTop_toBottomOf=&quot;@id/profile_name_text&quot;\n        tools:text=&quot;your.name@example.com&quot; /&gt;\n\n&lt;/merge&gt;\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>package com.example.myapp;\n\nimport android.content.Context;\nimport android.content.res.TypedArray;\nimport android.graphics.drawable.Drawable;\nimport android.util.AttributeSet;\nimport android.util.Log;\nimport android.view.LayoutInflater;\nimport androidx.annotation.NonNull;\nimport androidx.annotation.Nullable;\nimport androidx.constraintlayout.widget.ConstraintLayout;\nimport com.example.myapp.databinding.ViewProfileBinding; // Generated class\n\npublic class ProfileView extends ConstraintLayout {\n\n    private static final String TAG = &quot;ProfileViewPerformance&quot;;\n\n    // The binding object for our layout\n    private ViewProfileBinding binding;\n\n    public ProfileView(@NonNull Context context) {\n        super(context);\n        init(context, null);\n    }\n\n    public ProfileView(@NonNull Context context, @Nullable AttributeSet attrs) {\n        super(context, attrs);\n        init(context, attrs);\n    }\n\n    public ProfileView(@NonNull Context context, @Nullable AttributeSet attrs, int defStyleAttr) {\n        super(context, attrs, defStyleAttr);\n        init(context, attrs);\n    }\n\n    private void init(Context context, AttributeSet attrs) {\n        // --- PERFORMANCE MEASUREMENT START ---\n        long startTime = System.nanoTime();\n\n        // Inflate the layout and attach it to this view (the 'true' parameter)\n        LayoutInflater.from(context).inflate(R.layout.view_profile, this, true);\n\n        // Use View Binding to get references to the child views\n        binding = ViewProfileBinding.bind(this);\n\n        // --- PERFORMANCE MEASUREMENT END ---\n        long durationNanos = System.nanoTime() - startTime;\n        Log.d(TAG, String.format(&quot;Inflation time: %,d ns (%.3f ms)&quot;,\n                durationNanos,\n                durationNanos / 1_000_000.0));\n\n        // If attributes were passed from XML, process them\n        if (attrs != null) {\n            TypedArray typedArray = context.getTheme().obtainStyledAttributes(\n                    attrs,\n                    R.styleable.ProfileView,\n                    0, 0);\n            try {\n                String name = typedArray.getString(R.styleable.ProfileView_profileName);\n                String email = typedArray.getString(R.styleable.ProfileView_profileEmail);\n                Drawable avatar = typedArray.getDrawable(R.styleable.ProfileView_profileAvatar);\n\n                if (name != null) {\n                    setProfileName(name);\n                }\n                if (email != null) {\n                    setProfileEmail(email);\n                }\n                if (avatar != null) {\n                    setProfileAvatar(avatar);\n                }\n            } finally {\n                // IMPORTANT: Always recycle the TypedArray.\n                typedArray.recycle();\n            }\n        }\n    }\n\n    // --- Public API Methods ---\n\n    public void setProfileName(String name) {\n        binding.profileNameText.setText(name);\n    }\n\n    public void setProfileEmail(String email) {\n        binding.profileEmailText.setText(email);\n    }\n\n    public void setProfileAvatar(Drawable drawable) {\n        binding.profileAvatarImage.setImageDrawable(drawable);\n    }\n\n    public void setProfileAvatar(int drawableResId) {\n        binding.profileAvatarImage.setImageResource(drawableResId);\n    }\n}\n\n</code></pre>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;\n    xmlns:tools=&quot;http://schemas.android.com/tools&quot;\n    android:id=&quot;@+id/main&quot;\n    android:layout_width=&quot;match_parent&quot;\n    android:layout_height=&quot;match_parent&quot;\n    android:orientation=&quot;vertical&quot;\n    android:padding=&quot;16dp&quot;\n    tools:context=&quot;.MainActivity&quot;&gt;\n\n    &lt;TextView\n        android:layout_width=&quot;wrap_content&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        android:text=&quot;User Profiles&quot;\n        android:textAppearance=&quot;@style/TextAppearance.AppCompat.Display1&quot;\n        android:layout_marginBottom=&quot;24dp&quot;/&gt;\n\n    &lt;!-- ProfileView configured via XML attributes --&gt;\n    &lt;com.example.myapp.ProfileView\n        android:id=&quot;@+id/profile_view_one&quot;\n        android:layout_width=&quot;match_parent&quot;\n        android:layout_height=&quot;wrap_content&quot;\n        app:profileAvatar=&quot;@drawable/ic_launcher_background&quot;\n        app:profileName=&quot;Jane Doe&quot;\n        app:profileEmail=&quot;jane.doe@example.com&quot; /&gt;\n\n    &lt;View\n        android:layout_width=&quot;match_parent&quot;\n        android:layout_height=&quot;1dp&quot;\n        android:background=&quot;?android:attr/listDivider&quot;\n        android:layout_marginVertical=&quot;16dp&quot;/&gt;\n\n    &lt;!-- A second ProfileView to be configured programmatically --&gt;\n    &lt;com.example.myapp.ProfileView\n        android:id=&quot;@+id/profile_view_two&quot;\n        android:layout_width=&quot;match_parent&quot;\n        android:layout_height=&quot;wrap_content&quot;/&gt;\n\n&lt;/LinearLayout&gt;\n</code></pre>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;resources&gt;\n    &lt;declare-styleable name=&quot;ProfileView&quot;&gt;\n        &lt;attr name=&quot;profileName&quot; format=&quot;string&quot; /&gt;\n        &lt;attr name=&quot;profileEmail&quot; format=&quot;string&quot; /&gt;\n        &lt;attr name=&quot;profileAvatar&quot; format=&quot;reference&quot; /&gt; &lt;!-- reference to a drawable --&gt;\n    &lt;/declare-styleable&gt;\n&lt;/resources&gt;\n</code></pre>\n<h3>comment</h3>\n<p>This slowness is not making any sense to me. Did I miss anything in Android world? (All the online Android resource are very limited, even for such common issue? AI explanation is also terrible due to the lack of learning resource.)</p>\n<p>If i have 3 custom views, the lag will be obvious.</p>\n<p>I cant move to Jetpack Compose or Kotlin. (This is a project and deals with lots java jni sdk.)</p>\n",
    "tags" : [ "java", "android", "performance", "android-layout", "layout-inflater" ],
    "owner" : {
      "account_id" : 13222953,
      "reputation" : 1605,
      "user_id" : 9549068,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Qyvl1.png?s=256",
      "display_name" : "Nor.Z",
      "link" : "https://stackoverflow.com/users/9549068/nor-z"
    },
    "is_answered" : false,
    "view_count" : 79,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1761900674,
    "creation_date" : 1761890241,
    "link" : "https://stackoverflow.com/questions/79805441/why-the-inflation-time-for-a-custom-view-is-so-long-in-android-using-java-xml",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140829877,
    "post_id" : 79805441,
    "body" : "Unclear if you read: <a href=\"https://developer.android.com/studio/profile/hierarchy-viewer\" rel=\"nofollow noreferrer\">developer.android.com/studio/profile/hierarchy-viewer</a> (you are using older xml so should apply).",
    "score" : 0,
    "owner" : {
      "account_id" : 111736,
      "reputation" : 12346,
      "user_id" : 295004,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/a29d6038e4dcb7fac98ef41c002975e1?s=256&d=identicon&r=PG",
      "display_name" : "Morrison Chang",
      "link" : "https://stackoverflow.com/users/295004/morrison-chang"
    },
    "creation_date" : 1761935668,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140829403,
    "post_id" : 79805441,
    "body" : "@Robert I dont have the metrics right now, but just assume my device is a decent or high end physical arm64 Android device. I tried in emulator with x86_64 in window 11 system with good CPU and GPU. Its not the device problem. \\ Or it could be just the problem from my understanding.",
    "score" : 0,
    "owner" : {
      "account_id" : 13222953,
      "reputation" : 1605,
      "user_id" : 9549068,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Qyvl1.png?s=256",
      "display_name" : "Nor.Z",
      "link" : "https://stackoverflow.com/users/9549068/nor-z"
    },
    "creation_date" : 1761919124,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140829391,
    "post_id" : 79805441,
    "body" : "@Robert Its for a single component. Not the whole page. A decent page may have 5 of that dead simple component plus some other things, it will probably go up to 100ms. \\  Im not an expert on Android. It just recently I found some of my pages are really laggy. \\ I tried to look at the Profiler, etc. Cant understand where those time are coming from. \\ If I was using Reactjs, even with 100 complex components, everything are still instant, I never need to think about this. \\ In Android world, I find so little info, except everyone is mention that 16ms per frame thing. Idk. Where are the guides",
    "score" : 0,
    "owner" : {
      "account_id" : 13222953,
      "reputation" : 1605,
      "user_id" : 9549068,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/Qyvl1.png?s=256",
      "display_name" : "Nor.Z",
      "link" : "https://stackoverflow.com/users/9549068/nor-z"
    },
    "creation_date" : 1761918870,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140829329,
    "post_id" : 79805441,
    "body" : "Why do you think 15ms loading time is too much? You also forgot to mention the phone model or CPU used to measure loading.",
    "score" : 0,
    "owner" : {
      "account_id" : 50585,
      "reputation" : 43459,
      "user_id" : 150978,
      "user_type" : "registered",
      "accept_rate" : 78,
      "profile_image" : "https://www.gravatar.com/avatar/feadc214792e2581c3c750140e3eb2c7?s=256&d=identicon&r=PG",
      "display_name" : "Robert",
      "link" : "https://stackoverflow.com/users/150978/robert"
    },
    "creation_date" : 1761917088,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}