{
  "question" : {
    "question_id" : 79541534,
    "title" : "after upgrading oracle driver ojdbc17 in tomcat server : SQLException: UCP-0: Unable to start the Universal Connection Pool",
    "body" : "<p>Recently upgraded oracle drivers from ojdbc8 to ojdbc17 and ucp17.jar, for tocmat server where a Java17 based application is deployed. But the database connection now showing following error. Other jars in classpath are</p>\n<pre><code>org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection; nested exception is java.sql.SQLException: UCP-0: Unable to start the Universal Connection Pool\n    at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:83)\n    at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:646)\n    at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:960)\n\nCaused by: java.lang.RuntimeException: java.lang.IllegalArgumentException: when l value specified, it must be less than bitlength(p)\n    at oracle.net.aso.DiffieHellman$DHJCEWrapper.getPublicKey(DiffieHellman.java:148)\n    at oracle.net.ano.DataIntegrityService.receiveServiceData(DataIntegrityService.java:253)\n    at oracle.net.ano.Service.receiveSelection(Service.java:360)\n\nAnd the last caused by is : \nCaused by: java.lang.IllegalArgumentException: when l value specified, it must be less than bitlength(p)\n    at org.bouncycastle.crypto.params.DHParameters.&lt;init&gt;(Unknown Source)\n    at org.bouncycastle.crypto.params.DHParameters.&lt;init&gt;(Unknown Source)\n    at org.bouncycastle.jce.provider.JDKKeyPairGenerator$DH.initialize(Unknown Source)\n    at java.base/java.security.KeyPairGenerator.initialize(KeyPairGenerator.java:436)\n</code></pre>\n<p>I had the old bouncy castle jar bcprov-jdk16:1.46. I upgraded it to bcprov-jdk18on. Still getting same error.\nAny help appreciated.</p>\n",
    "tags" : [ "java", "oracle-database", "jdbc", "bouncycastle", "ojdbc" ],
    "owner" : {
      "account_id" : 1617839,
      "reputation" : 346,
      "user_id" : 1495021,
      "user_type" : "registered",
      "accept_rate" : 75,
      "profile_image" : "https://www.gravatar.com/avatar/19de37e1799787d8695615d26ae2868d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "YS_NE",
      "link" : "https://stackoverflow.com/users/1495021/ys-ne"
    },
    "is_answered" : true,
    "view_count" : 513,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1743173636,
    "creation_date" : 1743167919,
    "link" : "https://stackoverflow.com/questions/79541534/after-upgrading-oracle-driver-ojdbc17-in-tomcat-server-sqlexception-ucp-0-un",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79541761,
    "question_id" : 79541534,
    "body" : "<p>This error comes from Bouncy Castle when initializing Diffie-Hellman parameters. This means that the initialization violates Diffie-Hellman spec.</p>\n<p>This typically happens when there is:</p>\n<ul>\n<li><p>Mismatched or outdated Bouncy Castle version</p>\n</li>\n<li><p>Conflict between multiple Bouncy Castle versions on the classpath</p>\n</li>\n<li><p>Invalid or unsupported Diffie-Hellman parameters passed from the Oracle driver or security layer</p>\n</li>\n</ul>\n<p>The steps that could help in a resolution of the error:</p>\n<ol>\n<li><p>Ensure Bouncy Castle is updated properly<br />\nFor Java 17 the recommended version is <code>bcprov-jdk18on:1.78</code> or later.</p>\n</li>\n<li><p>Ensure no other Bouncy Castle versions in classpath</p>\n<p>Even if you've upgraded the Bouncy Castle version, there may be other versions in the classpath which may be loaded before the upgraded version thus causing the error.</p>\n<p>Check <code>WEB-INF/lib</code> or any <code>classpath</code> includes.<br />\nFor Maven you can use <code>mvn dependency:tree | grep bcprov</code>.</p>\n</li>\n<li><p>Add required Oracle security jars: <code>oraclepki.jar</code>, <code>osdt_cert.jar</code>, <code>osdt_core.jar</code></p>\n<p>You can download them from <a href=\"https://www.oracle.com/database/technologies/appdev/jdbc-downloads.html\" rel=\"nofollow noreferrer\">Oracle JDBC download page</a> (Companion Jars)</p>\n</li>\n</ol>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 16043894,
      "reputation" : 913,
      "user_id" : 11579604,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/z1aaG.png?s=256",
      "display_name" : "Patrycja Wegrzynowicz",
      "link" : "https://stackoverflow.com/users/11579604/patrycja-wegrzynowicz"
    },
    "creation_date" : 1743173636,
    "last_activity_date" : 1743173636,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79541761" : [ {
      "comment_id" : 140280574,
      "post_id" : 79541761,
      "body" : "I see with bcprov-jdk18on:1.80, this error is not happening. c3p0 is still in classpath. I see ucp17 and bouncycastle not showing this issue. Thanks for your help.",
      "score" : 0,
      "owner" : {
        "account_id" : 1617839,
        "reputation" : 346,
        "user_id" : 1495021,
        "user_type" : "registered",
        "accept_rate" : 75,
        "profile_image" : "https://www.gravatar.com/avatar/19de37e1799787d8695615d26ae2868d?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "YS_NE",
        "link" : "https://stackoverflow.com/users/1495021/ys-ne"
      },
      "creation_date" : 1743378412,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140275745,
      "post_id" : 79541761,
      "body" : "Thanks @Patrycja Wegrzynowicz. I do have latest bcprov-jdk18on:1.78,  Also double checked there is no other bouncy castle.  However I see that I have another connection pooling jar c3p0.jar.  Could that cause  this issue?",
      "score" : 0,
      "owner" : {
        "account_id" : 1617839,
        "reputation" : 346,
        "user_id" : 1495021,
        "user_type" : "registered",
        "accept_rate" : 75,
        "profile_image" : "https://www.gravatar.com/avatar/19de37e1799787d8695615d26ae2868d?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "YS_NE",
        "link" : "https://stackoverflow.com/users/1495021/ys-ne"
      },
      "creation_date" : 1743201172,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}