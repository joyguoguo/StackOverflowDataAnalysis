{
  "question" : {
    "question_id" : 79621230,
    "title" : "Why I am getting {&quot;error&quot;:&quot;invalid_scope&quot;,&quot;error_description&quot;:&quot;Invalid OAuth scope or ID token audience provided.&quot;}?",
    "body" : "<p>I am facing this error when trying get <strong>the access token for OAuth 2.0</strong> to send a notification to another phone.</p>\n<p>The error:</p>\n<p><strong>com.google.auth.oauth2.GoogleAuthException: Error getting access token for service account: 400 Bad Request POST <a href=\"https://oauth2.googleapis.com/token\" rel=\"nofollow noreferrer\">https://oauth2.googleapis.com/token</a> {&quot;error&quot;:&quot;invalid_scope&quot;,&quot;error_description&quot;:&quot;Invalid OAuth scope or ID token audience provided.&quot;}</strong></p>\n<p>From the documentation: <a href=\"https://developers.google.com/identity/protocols/oauth2/scopes\" rel=\"nofollow noreferrer\">https://developers.google.com/identity/protocols/oauth2/scopes</a>, the scopes to request are correct.</p>\n<p>This is the <strong>AccessToken</strong> class:</p>\n<pre><code>public class AccessToken {\n\n    private static final String firebaseMessagingScope1 = &quot;https://www.googleapis.com/auth/firebase.messaging&quot;;\n    private static final String firebaseMessagingScope2 = &quot;https://www.googleapis.com/auth/cloud-platform&quot;;\n\n    public String getAccessToken() {\n        try {\n            String jsonString = &quot;{\\n&quot; +\n                    &quot;  \\&quot;type\\&quot;: \\&quot;service_account\\&quot;,\\n&quot; +\n                    &quot;  \\&quot;project_id\\&quot;: \\&quot;....\\&quot;,\\n&quot; +\n                    &quot;  \\&quot;private_key_id\\&quot;: \\&quot;.....\\&quot;,\\n&quot; +\n                    &quot;  \\&quot;private_key\\&quot;: \\&quot;.......\\\\n\\&quot;,\\n&quot; +\n                    &quot;  \\&quot;client_email\\&quot;: \\&quot;............\\&quot;,\\n&quot; +\n                    &quot;  \\&quot;client_id\\&quot;: \\&quot;..........\\&quot;,\\n&quot; +\n                    &quot;  \\&quot;auth_uri\\&quot;: \\&quot;https://accounts.google.com/o/oauth2/auth\\&quot;,\\n&quot; +\n                    &quot;  \\&quot;token_uri\\&quot;: \\&quot;https://oauth2.googleapis.com/token\\&quot;,\\n&quot; +\n                    &quot;  \\&quot;auth_provider_x509_cert_url\\&quot;: \\&quot;https://www.googleapis.com/oauth2/v1/certs\\&quot;,\\n&quot; +\n                    &quot;  \\&quot;client_x509_cert_url\\&quot;: \\&quot;https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-u71wo%40........iam.gserviceaccount.com\\&quot;,\\n&quot; +\n                    &quot;  \\&quot;universe_domain\\&quot;: \\&quot;googleapis.com\\&quot;\\n&quot; +\n                    &quot;}\\n&quot;;\n           \n            InputStream inputStream = new ByteArrayInputStream(jsonString.getBytes(StandardCharsets.UTF_8));\n\n            GoogleCredentials googleCredentials = GoogleCredentials.fromStream(inputStream);\n\n            googleCredentials.createScoped(Lists.newArrayList(firebaseMessagingScope1, firebaseMessagingScope2));\n\n            googleCredentials.refresh();\n\n            return googleCredentials.getAccessToken().getTokenValue();\n\n        } catch (IOException e) {\n            Log.e(&quot;error&quot;, e.toString());\n            return null;\n        }\n    }\n}\n</code></pre>\n<p>Can anyone help me with this issue? any help/suggestion is very appreciated.</p>\n",
    "tags" : [ "java", "android", "firebase", "oauth-2.0" ],
    "owner" : {
      "account_id" : 6142015,
      "reputation" : 406,
      "user_id" : 4789141,
      "user_type" : "registered",
      "accept_rate" : 70,
      "profile_image" : "https://www.gravatar.com/avatar/ab2a734e0b15c1655c9bb107f574de8c?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "carl",
      "link" : "https://stackoverflow.com/users/4789141/carl"
    },
    "is_answered" : true,
    "view_count" : 953,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1747221195,
    "creation_date" : 1747217413,
    "link" : "https://stackoverflow.com/questions/79621230/why-i-am-getting-errorinvalid-scope-error-descriptioninvalid-oauth-sco",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79621344,
    "question_id" : 79621230,
    "body" : "<p>You're creating the <code>GoogleCredentials</code> correctly, but <strong>you’re not actually assigning the scoped credentials</strong>.</p>\n<p>You’re calling:</p>\n<pre><code>googleCredentials.createScoped(...);\n</code></pre>\n<p>But <strong>you're not using the result</strong> of <code>createScoped(...)</code>. This method <strong>returns a new instance</strong> with the scopes applied — it doesn't mutate the original object.</p>\n<p>Update your code to assign the result of <code>createScoped(...)</code> to <code>googleCredentials</code>:</p>\n<pre><code>GoogleCredentials googleCredentials = GoogleCredentials.fromStream(inputStream)\n    .createScoped(Lists.newArrayList(firebaseMessagingScope1, firebaseMessagingScope2));\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 16264424,
      "reputation" : 299,
      "user_id" : 11744933,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c2a6b186c0cae5c1e679bfb495889428?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Syed",
      "link" : "https://stackoverflow.com/users/11744933/syed"
    },
    "creation_date" : 1747221195,
    "last_activity_date" : 1747221195,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140424649,
    "post_id" : 79621230,
    "body" : "Thanks! I’ve posted it as an answer now.",
    "score" : 0,
    "owner" : {
      "account_id" : 16264424,
      "reputation" : 299,
      "user_id" : 11744933,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c2a6b186c0cae5c1e679bfb495889428?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Syed",
      "link" : "https://stackoverflow.com/users/11744933/syed"
    },
    "creation_date" : 1747221307,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140424635,
    "post_id" : 79621230,
    "body" : "@Syed, Thanks...an oversight that creates a problem. If you make it properly, I&#39;ll  put it as a solution. Thanks again.",
    "score" : 0,
    "owner" : {
      "account_id" : 6142015,
      "reputation" : 406,
      "user_id" : 4789141,
      "user_type" : "registered",
      "accept_rate" : 70,
      "profile_image" : "https://www.gravatar.com/avatar/ab2a734e0b15c1655c9bb107f574de8c?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "carl",
      "link" : "https://stackoverflow.com/users/4789141/carl"
    },
    "creation_date" : 1747220925,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140424557,
    "post_id" : 79621230,
    "body" : "You&#39;re creating the GoogleCredentials correctly, but you’re not actually assigning the scoped credentials.  You’re calling:  googleCredentials.createScoped(...);  But you&#39;re not using the result of createScoped(...). This method returns a new instance with the scopes applied — it doesn&#39;t mutate the original object.  Update your code to assign the result of createScoped(...) to googleCredentials:  GoogleCredentials googleCredentials = GoogleCredentials.fromStream(inputStream)     .createScoped(Lists.newArrayList(firebaseMessagingScope1, firebaseMessagingScope2));",
    "score" : 0,
    "owner" : {
      "account_id" : 16264424,
      "reputation" : 299,
      "user_id" : 11744933,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c2a6b186c0cae5c1e679bfb495889428?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Syed",
      "link" : "https://stackoverflow.com/users/11744933/syed"
    },
    "creation_date" : 1747219289,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}