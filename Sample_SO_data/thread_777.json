{
  "question" : {
    "question_id" : 79767871,
    "title" : "Font rendering difference when app-loaded vs Windows-registered in Java Swing app",
    "body" : "<p>I am getting different rendering behavior of a font, &quot;DejaVu Sans Mono&quot;, in my Java Swing application if the application loads the font itself vs it being registered with Windows (installed under Windows\\Fonts):</p>\n<p><img src=\"https://i.sstatic.net/MNzSa4pB.png\" alt=\"Font Rendering Comparison\" /></p>\n<p>This difference in behavior is mainly noticeable if Windows display scale preference is at 100%, which is the case on my laptop's 1920x1080 display.  Do not get a difference (or at least see any significant difference) when I run the application on a 4K external display with 250% scaling under Windows Display settings.</p>\n<p>The font loading code is at the very start of the application, before any Swing/AWT components are created.  I am using the <code>Font.createFont()</code> method to load the font using the <em>fontFormat</em> parameter set to <code>Font.TRUETYPE_FONT</code>.</p>\n<p>I tried the different values for the <code>awt.useSystemAAFontSettings</code> system property, but the difference is still present, where rendering looks better when the font is installed on Windows vs being loaded via <code>Font.createFont()</code>.</p>\n<p><strong>Edit</strong>: What follows is the utility method in the application that loads the font, where the font file is included in the application's jar file:</p>\n<pre><code>  public static Font loadResourceFont(\n      String filename\n  ) {\n    String pathname = &quot;resources/fonts/&quot; + filename;\n    java.io.InputStream in = null;\n    try {\n      in = AppUIFonts.class.getResourceAsStream(pathname);\n      if (in == null) {\n        log.error(&quot;Unable to find resource \\&quot;&quot;+pathname+&quot;\\&quot;&quot;);\n        return null;\n      }\n      return Font.createFont(Font.TRUETYPE_FONT, in);\n\n    } catch (Exception e) {\n      log.error(&quot;Unable to load font \\&quot;&quot;+filename+&quot;\\&quot;: &quot;+\n          e.getLocalizedMessage(), e);\n\n    } finally {\n      IOUtil.closeQuietly(in);\n    }\n    return null;\n  }\n\n</code></pre>\n<p><strong>Edit:</strong> The font rendering difference is only observed when using smaller font sizes.  In the screenshot above, the font size is 13.  Not sure what the exact threshold is, but I think font sizes at 16 or larger do not exhibit the rendering problem.</p>\n<p><strong>Edit:</strong> Based on information provided by @gthanop, enabling debug font logging of the JVM, I see the difference in options set on the font when it is loaded by the application vs registered with the operating system.  The following is when the font is loaded by app (ignore the size value as I did the log capture when using 4k display at 250% scaling, so effective size is quite large):</p>\n<pre><code>INFO: Strike for ** TrueType Font: Family=DejaVu Sans Mono Name=DejaVu Sans Mono style=0 fileName=C:\\tmp\\+~JF2835760196081226032.tmp at size = 35 use natives = false useJavaRasteriser = true AAHint = 4 Has Embedded bitmaps = false\n</code></pre>\n<p>The following is when font is registered/installed to the system:</p>\n<pre><code>INFO: Strike for ** TrueType Font: Family=DejaVu Sans Mono Name=DejaVu Sans Mono style=0 fileName=C:\\Users\\user\\AppData\\Local\\Microsoft\\Windows\\Fonts\\DejaVuSansMono.ttf at size = 35 use natives = true useJavaRasteriser = false AAHint = 4 Has Embedded bitmaps = false\n</code></pre>\n<p>Notice the difference in the <code>use natives</code> option and the <code>useJavaRasteriser</code> option.  Not sure if possible to change these options at the application code level as it appears these options are controlled by internal Java classes.</p>\n",
    "tags" : [ "java", "windows", "swing", "fonts", "awt" ],
    "owner" : {
      "account_id" : 42124569,
      "reputation" : 105,
      "user_id" : 30604023,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e748f39a58e540552038c612ad0245f1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "ewh.eps",
      "link" : "https://stackoverflow.com/users/30604023/ewh-eps"
    },
    "is_answered" : false,
    "view_count" : 128,
    "answer_count" : 0,
    "score" : 4,
    "last_activity_date" : 1758303310,
    "creation_date" : 1758150360,
    "link" : "https://stackoverflow.com/questions/79767871/font-rendering-difference-when-app-loaded-vs-windows-registered-in-java-swing-ap",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140747874,
    "post_id" : 79767871,
    "body" : "@gthanop Thanks for the comments. The debug property also works for OpenJDK. Lot to sift thru. I do see a difference in rendering options logged for font when font is registered with the system vs loaded by app. I&#39;ve updated post to show such information since comment formatting limited to provide here.",
    "score" : 1,
    "owner" : {
      "account_id" : 42124569,
      "reputation" : 105,
      "user_id" : 30604023,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e748f39a58e540552038c612ad0245f1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "ewh.eps",
      "link" : "https://stackoverflow.com/users/30604023/ewh-eps"
    },
    "creation_date" : 1758303410,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140747545,
    "post_id" : 79767871,
    "body" : "With &quot;<i>evaluating equal</i>&quot; I mean with <code>equals</code> (for all 3 fonts). Also tried setting various <code>RenderingHints</code> while custom painting some text with these fonts, but the problem remains. As an aside, I used <code>System.setProperty(&quot;sun.java2d.debugfonts&quot;, &quot;true&quot;);</code> which enables logging for internal font implementing classes (using Oracle&#39;s JRE) and helped a bit, so it may be useful to take a look at this as a bird&#39;s eye view of what&#39;s going on internally. There should exist better methods to look into it than digging internals though. I can&#39;t look further into all of this for the time being, sorry.",
    "score" : 2,
    "owner" : {
      "account_id" : 9059972,
      "reputation" : 3471,
      "user_id" : 6746785,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/3zi2O.png?s=256",
      "display_name" : "gthanop",
      "link" : "https://stackoverflow.com/users/6746785/gthanop"
    },
    "creation_date" : 1758293605,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140747540,
    "post_id" : 79767871,
    "body" : "After trying size 13 I can see there is difference even in <code>PLAIN</code> style indeed. Tried to look at internals a bit of where the font is constructed when calling the constuctor and didn&#39;t manage to find out what&#39;s wrong (there are several internal classes involved and a registration process which reads fonts from JRE and Windows system directory). Tried to load the font (downloaded from your link) with <code>createFont</code> as well as the corresponding font in Windows system directory and these two have the same behaviour, but are different from the constructor&#39;s font, despite also evaluating as equal.",
    "score" : 2,
    "owner" : {
      "account_id" : 9059972,
      "reputation" : 3471,
      "user_id" : 6746785,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/3zi2O.png?s=256",
      "display_name" : "gthanop",
      "link" : "https://stackoverflow.com/users/6746785/gthanop"
    },
    "creation_date" : 1758293569,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140745584,
    "post_id" : 79767871,
    "body" : "@gthanop Forgot to mention, try a smaller font size.  I noticed that when the font size is larger, the rendering difference does not occur.  For example, the default font size I am using the application is 13.",
    "score" : 0,
    "owner" : {
      "account_id" : 42124569,
      "reputation" : 105,
      "user_id" : 30604023,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e748f39a58e540552038c612ad0245f1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "ewh.eps",
      "link" : "https://stackoverflow.com/users/30604023/ewh-eps"
    },
    "creation_date" : 1758217298,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140745571,
    "post_id" : 79767871,
    "body" : "@gthanop I provide an InputStream to createFont() as the font file is embedded within the application jar. The text shown in the screenshot is from text rendered in a JTable using the Metal theme, but I have observed the font difference using other themes and within other Swing components. Post updated to show the utility method used to load the font.  The DejaVu Sans Mono font is what is provided from (<a href=\"https://dejavu-fonts.github.io/Download.html\" rel=\"nofollow noreferrer\">dejavu-fonts.github.io/Download.html</a>).",
    "score" : 0,
    "owner" : {
      "account_id" : 42124569,
      "reputation" : 105,
      "user_id" : 30604023,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e748f39a58e540552038c612ad0245f1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "ewh.eps",
      "link" : "https://stackoverflow.com/users/30604023/ewh-eps"
    },
    "creation_date" : 1758216794,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140744206,
    "post_id" : 79767871,
    "body" : "Using a laptop with 1920x1080 display at 100% scaling does not reproduce the error for me, when using <code>new Font</code> vs <code>createFont</code> in <code>PLAIN</code> style, size 20. ClearType seems to be activated. On the other hand, changing to <code>BOLD</code> style indeed gives a different result.",
    "score" : 0,
    "owner" : {
      "account_id" : 9059972,
      "reputation" : 3471,
      "user_id" : 6746785,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/3zi2O.png?s=256",
      "display_name" : "gthanop",
      "link" : "https://stackoverflow.com/users/6746785/gthanop"
    },
    "creation_date" : 1758181284,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140744118,
    "post_id" : 79767871,
    "body" : "Can you please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> demonstrating the problem? This can answer questions such as how you use <code>createFont</code> (instead of descriptions), as well as what file path you give to <code>createFont</code>.",
    "score" : 2,
    "owner" : {
      "account_id" : 9059972,
      "reputation" : 3471,
      "user_id" : 6746785,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/3zi2O.png?s=256",
      "display_name" : "gthanop",
      "link" : "https://stackoverflow.com/users/6746785/gthanop"
    },
    "creation_date" : 1758179481,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140744116,
    "post_id" : 79767871,
    "body" : "The second image looks to me like ClearType is activated. This might only work in case the font is rendered by Window itself.",
    "score" : 0,
    "owner" : {
      "account_id" : 50585,
      "reputation" : 43459,
      "user_id" : 150978,
      "user_type" : "registered",
      "accept_rate" : 78,
      "profile_image" : "https://www.gravatar.com/avatar/feadc214792e2581c3c750140e3eb2c7?s=256&d=identicon&r=PG",
      "display_name" : "Robert",
      "link" : "https://stackoverflow.com/users/150978/robert"
    },
    "creation_date" : 1758179463,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}