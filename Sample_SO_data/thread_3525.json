{
  "question" : {
    "question_id" : 79543270,
    "title" : "How to get the script associated with a StackTrace element in groovy",
    "body" : "<p>Suppose I am creating a script in Groovy without creating a class, such as for example:</p>\n<pre><code>public int execute() {\n  String myString = null;\n  return myString.size();\n}\n</code></pre>\n<p>If I am setting this Script content in a String and doing:</p>\n<pre><code>String myString = &quot;public int execute() {...&quot;;\nCompilerConfiguration config = new CompilerConfiguration();\nconfig.setTargetByteCode(CompilerConfiguration.JDK8);\nGroovyClassLoader groovyLoader = new GroovyClassLoader(getClassLoader(), config);\nClass groovyClass = groovyLoader.parseClass(myString);\n</code></pre>\n<p>Then when I am calling my Groovy script I have an exception (here because I am trying to get the size of a <code>null</code> String), and the StackTrace elements will have the following kind of file names: <code>Script_e217abab4c0c685a881796ac61cc4b28.groovy</code></p>\n<p>This is exactly the same String as the <code>groovyClass.getSimpleName() + &quot;.groovy&quot;</code>, which allows me to know from which script the StackTrace element is coming. Note that it is not a &quot;real&quot; file name because the script has been created by a String (and not from a file).</p>\n<p>Now if I have the following kind of Script:</p>\n<pre><code> public class MyGroovyClass {\n    public int execute() {\n      String myString = null;\n      return myString.size();\n    }\n }\n</code></pre>\n<p>In this case  <code>groovyClass.getSimpleName() + &quot;.groovy&quot;</code> is <code>MyGroovyClass.groovy</code> but the StackTrace elements have still the same pattern as before, such as <code>Script_e217abab4c0c685a881796ac61cc4b28.groovy</code> for example.</p>\n<p>This causes me  a problem because I am using a scripting framework (wrapping groovy scripts), where I can call scripts from other scripts. All the scripts are created from Strings because I am modifying the content of the scripts defined in files by the user (kind of instrumentation). When I have a StackTrace, I am not able to know from which script the element is coming if the associated element is a groovy class.</p>\n<p>How could I do to get the proper script from the StackTrace element name?</p>\n",
    "tags" : [ "java", "groovy" ],
    "owner" : {
      "account_id" : 8204014,
      "reputation" : 619,
      "user_id" : 6174386,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/30e31a9502c73b2cfd007e80a58ba3d8?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Herv&#233; Girod",
      "link" : "https://stackoverflow.com/users/6174386/herv%c3%a9-girod"
    },
    "is_answered" : true,
    "view_count" : 38,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1743536128,
    "creation_date" : 1743252750,
    "link" : "https://stackoverflow.com/questions/79543270/how-to-get-the-script-associated-with-a-stacktrace-element-in-groovy",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79549014,
    "question_id" : 79543270,
    "body" : "<p>the stacktrace shows you a file name where class is defined.</p>\n<p>for dynamic classes it will show a random file name if you did not set it.</p>\n<p>just use the second parameter for parseClass to set a file name<br />\n<a href=\"https://docs.groovy-lang.org/latest/html/api/groovy/lang/GroovyClassLoader.html#parseClass(java.lang.String,java.lang.String)\" rel=\"nofollow noreferrer\">GroovyClassLoader.parseClass(text, fileName)</a></p>\n<pre><code>String myString = &quot;throw new Exception()&quot;;\nGroovyClassLoader groovyLoader = new GroovyClassLoader(this.getClass().getClassLoader());\nClass&lt;Script&gt; groovyClass = groovyLoader.parseClass(myString, &quot;TheNiceFileName.groovy&quot;);\nScript script = groovyClass.newInstance();\nprintln script.getClass();\nscript.run();\n</code></pre>\n<p>prints nice class name and throws exception with a nice file name</p>\n<pre class=\"lang-js prettyprint-override\"><code>class TheNiceFileName\n\njava.lang.Exception\n    at TheNiceFileName.run(TheNiceFileName.groovy:1)\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 1333316,
      "reputation" : 29017,
      "user_id" : 1276664,
      "user_type" : "registered",
      "accept_rate" : 17,
      "profile_image" : "https://www.gravatar.com/avatar/873470471a482071b8e085095cf89221?s=256&d=identicon&r=PG",
      "display_name" : "daggett",
      "link" : "https://stackoverflow.com/users/1276664/daggett"
    },
    "creation_date" : 1743535514,
    "last_activity_date" : 1743536128,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79543342,
    "question_id" : 79543270,
    "body" : "<p>I understood how to do it. I have to get the encoded name of the script in groovy which will be:</p>\n<pre><code>String name = groovyLoader.getEncodingString(myString);\nString fileName = &quot;Script_&quot; + name + &quot;.groovy&quot;;`\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 8204014,
      "reputation" : 619,
      "user_id" : 6174386,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/30e31a9502c73b2cfd007e80a58ba3d8?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Herv&#233; Girod",
      "link" : "https://stackoverflow.com/users/6174386/herv%c3%a9-girod"
    },
    "creation_date" : 1743256191,
    "last_activity_date" : 1743256191,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}