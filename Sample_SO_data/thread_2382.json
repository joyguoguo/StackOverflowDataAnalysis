{
  "question" : {
    "question_id" : 79624135,
    "title" : "someVoidMethod() does nothing the 1st time but throws an exception the 2nd time is called",
    "body" : "<p>I have a this unit test that fails when I have the following doNothing() for two calls inside the unit test</p>\n<pre><code>@Test\n    void storeStockPersist() {\n        Long idKey=1L;\n        String name = &quot;test&quot;;\n        Map params = Map.of(&quot;idKey&quot;,idKey,&quot;name&quot;,name);\n        StoreStockPersistRequest storeStockPersistRequest = new StoreStockPersistRequest(1L, &quot;Test&quot;, params);\n        doNothing().when(planKeyService).persistStoreStockKey(storeStockPersistRequest);\n        doNothing().when(actRestClient).persistStoreStockKey(storeStockPersistRequest);\n        ResponseEntity&lt;?&gt; successfulCreate = planKeyController.storeStockPersist(storeStockPersistRequest);\n        assertTrue(successfulCreate.getStatusCode() == HttpStatus.NO_CONTENT);\n    }\n</code></pre>\n<p>It throws this exception</p>\n<blockquote>\n<p>Only void methods can doNothing()! Example of correct use of\ndoNothing():\ndoNothing().\ndoThrow(new RuntimeException())\n.when(mock).someVoidMethod(); Above means: someVoidMethod() does nothing the 1st time but throws an exception the 2nd time is called\norg.mockito.exceptions.base.MockitoException:  Only void methods can\ndoNothing()! Example of correct use of doNothing():\ndoNothing().\ndoThrow(new RuntimeException())\n.when(mock).someVoidMethod(); Above means: someVoidMethod() does nothing the 1st time but throws an exception the 2nd time is called\nat\ncom.homedepot.kimsbff.controller.PlanKeyControllerTest.storeStockPersist(PlanKeyControllerTest.java:101)</p>\n</blockquote>\n<p>This is the controller code and service code</p>\n<pre><code>public class PlanKeyController {\n\nprivate final PlanKeyService planKeyService;\n\n\n    public PlanKeyController(PlanKeyService planKeyService) {\n        this.planKeyService = planKeyService;\n    }\n\n    public ResponseEntity&lt;?&gt; storeStockPersist(@RequestBody StoreStockPersistRequest storeStockPersistRequest) {\n            planKeyService.persistStoreStockKey(storeStockPersistRequest);\n            return ResponseEntity.noContent().build();\n        }\n}\n</code></pre>\n<p>here is the service class</p>\n<pre><code> public class planKeyService{\nprivate final ActRestClient actRestClient;\npublic PlanKeyServiceImpl(ActRestClient actRestClient) {\n           this.actRestClient = actRestClient;\n}\n    public void persistStoreStockKey(StoreStockPersistRequest storeStockPersistRequest) {\n            actRestClient.persistStoreStockKey(storeStockPersistRequest);\n        }\n}\n</code></pre>\n<p>Here is feign client</p>\n<pre><code> @FeignClient(value = &quot;kimsAct&quot;, url = &quot;${internal-service.kims-act.url}&quot;, configuration = KimsActFeignConfig.class)\n    public interface ActRestClient {\n    \n        ResponseEntity&lt;?&gt; persistStoreStockKey(@RequestBody StoreStockPersistRequest storeStockPersistRequest);\n    }\n</code></pre>\n",
    "tags" : [ "java", "spring-boot", "rest", "spring-cloud-feign" ],
    "owner" : {
      "account_id" : 12348065,
      "reputation" : 147,
      "user_id" : 10524769,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2e39c9a3f8ec39d2e23fdbd85ced7980?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "gcpdev",
      "link" : "https://stackoverflow.com/users/10524769/gcpdev"
    },
    "is_answered" : true,
    "view_count" : 156,
    "answer_count" : 2,
    "score" : 0,
    "last_activity_date" : 1747344044,
    "creation_date" : 1747341182,
    "link" : "https://stackoverflow.com/questions/79624135/somevoidmethod-does-nothing-the-1st-time-but-throws-an-exception-the-2nd-time",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79624196,
    "question_id" : 79624135,
    "body" : "<p><code>ActRestClient.persistStoreStockKey()</code> is declared to return a <code>ResponseEntity&lt;?&gt;</code>:</p>\n<pre><code>public interface ActRestClient {\n    \n    ResponseEntity&lt;?&gt; persistStoreStockKey(@RequestBody StoreStockPersistRequest storeStockPersistRequest);\n}\n</code></pre>\n<p>Therefore you cannot mock it using</p>\n<pre><code>    doNothing().when(actRestClient).persistStoreStockKey(storeStockPersistRequest);\n</code></pre>\n<p>you <strong>must</strong> mock it using something like</p>\n<pre><code>    doReturn(null).when(actRestClient).persistStoreStockKey(storeStockPersistRequest);\n</code></pre>\n",
    "score" : 3,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 7423601,
      "reputation" : 21950,
      "user_id" : 5646962,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/950788cd150c2e596944181dfd8421af?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Thomas Kl&#228;ger",
      "link" : "https://stackoverflow.com/users/5646962/thomas-kl%c3%a4ger"
    },
    "creation_date" : 1747344044,
    "last_activity_date" : 1747344044,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79624158,
    "question_id" : 79624135,
    "body" : "<p>Try to return null on mock!!</p>\n<pre class=\"lang-java prettyprint-override\"><code>doReturn(null).when(planKeyService).persistStoreStockKey(storeStockPersistRequest);\ndoReturn(null).when(actRestClient).persistStoreStockKey(storeStockPersistRequest);\n</code></pre>\n<p>The error say you only doNothing on &quot;void&quot; methods.</p>\n<p>Instead of &quot;doNothing&quot;, try to return null(nothing) on your mock requests.</p>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 3939868,
      "reputation" : 36,
      "user_id" : 3254747,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/7AuDn.jpg?s=256",
      "display_name" : "Alex William",
      "link" : "https://stackoverflow.com/users/3254747/alex-william"
    },
    "creation_date" : 1747342247,
    "last_activity_date" : 1747342247,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}