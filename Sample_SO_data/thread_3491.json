{
  "question" : {
    "question_id" : 79546230,
    "title" : "How not to show context menu on empty TableRow in JavaFX?",
    "body" : "<p>I have a table and I need to add a context menu for rows. The problem is that context menu is shown also for empty rows. To fix it I remove and add context menu using listener on empty property. But taking into consideration that virtual rows are updated very often I am not sure that it is a performance-efficient solution.</p>\n<p>This is my code:</p>\n<pre><code>public class NewMain1 extends Application {\n\n    public static class Person {\n        private final StringProperty firstName;\n        private final StringProperty lastName;\n\n        public Person(String firstName, String lastName) {\n            this.firstName = new SimpleStringProperty(firstName);\n            this.lastName = new SimpleStringProperty(lastName);\n        }\n\n        public StringProperty firstNameProperty() { return firstName; }\n        public StringProperty lastNameProperty() { return lastName; }\n    }\n\n    @Override\n    public void start(Stage primaryStage) {\n        TableView&lt;Person&gt; tableView = new TableView&lt;&gt;();\n        tableView.setEditable(true);\n\n        TableColumn&lt;Person, String&gt; firstNameCol = new TableColumn&lt;&gt;(&quot;First Name&quot;);\n        firstNameCol.setCellValueFactory(cellData -&gt; cellData.getValue().firstNameProperty());\n        firstNameCol.setCellFactory(TextFieldTableCell.forTableColumn());\n\n        TableColumn&lt;Person, String&gt; lastNameCol = new TableColumn&lt;&gt;(&quot;Last Name&quot;);\n        lastNameCol.setCellValueFactory(cellData -&gt; cellData.getValue().lastNameProperty());\n\n\n        tableView.getColumns().addAll(firstNameCol, lastNameCol);\n\n        ObservableList&lt;Person&gt; data = FXCollections.observableArrayList(\n            new Person(&quot;John&quot;, &quot;Smith&quot;),\n            new Person(&quot;Emily&quot;, &quot;Johnson&quot;),\n            new Person(&quot;Michael&quot;, &quot;Williams&quot;),\n            new Person(&quot;Sarah&quot;, &quot;Brown&quot;)\n        );\n        tableView.setItems(data);\n\n        tableView.setRowFactory(tv -&gt; {\n            TableRow&lt;Person&gt; row = new TableRow&lt;&gt;();\n            var contextMenu = new ContextMenu(new MenuItem(&quot;Show Salary&quot;));\n            row.emptyProperty().addListener((ov, oldV, newV) -&gt; {\n                if (newV) {\n                    row.setContextMenu(null);\n                } else {\n                    row.setContextMenu(contextMenu);\n                }\n            });\n            return row;\n        });\n\n        VBox root = new VBox(tableView);\n        Scene scene = new Scene(root, 400, 300);\n        primaryStage.setTitle(&quot;Editable Names Table&quot;);\n        primaryStage.setScene(scene);\n        primaryStage.show();\n    }\n\n    public static void main(String[] args) {\n        launch(args);\n    }\n}\n</code></pre>\n<p>Could anyone say if there is a better solution not to show context menu for empty rows?</p>\n",
    "tags" : [ "java", "javafx" ],
    "owner" : {
      "account_id" : 34599290,
      "reputation" : 1188,
      "user_id" : 26656564,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/882f996623517814360ba4bb403102e7?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "SilverCube",
      "link" : "https://stackoverflow.com/users/26656564/silvercube"
    },
    "is_answered" : true,
    "view_count" : 96,
    "answer_count" : 3,
    "score" : 3,
    "last_activity_date" : 1743601118,
    "creation_date" : 1743424117,
    "link" : "https://stackoverflow.com/questions/79546230/how-not-to-show-context-menu-on-empty-tablerow-in-javafx",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79546340,
    "question_id" : 79546230,
    "body" : "<p>Your idea is not bad in itself. But there are 2 points where you could optimize:</p>\n<ol>\n<li>Create only one context menu, use it throughout the rows</li>\n<li>Override the row's <code>updateItem</code> method instead of using a listener on the <code>empty</code> property</li>\n</ol>\n<pre class=\"lang-java prettyprint-override\"><code>public class NewMain1 extends Application {\n\n  public static class Person {\n    private final StringProperty firstName;\n    private final StringProperty lastName;\n\n    public Person(String firstName, String lastName) {\n        this.firstName = new SimpleStringProperty(firstName);\n        this.lastName = new SimpleStringProperty(lastName);\n    }\n\n    public StringProperty firstNameProperty() { return firstName; }\n    public StringProperty lastNameProperty() { return lastName; }\n  }\n\n  @Override\n  public void start(Stage primaryStage) {\n    TableView&lt;Person&gt; tableView = new TableView&lt;&gt;();\n    tableView.setEditable(true);\n\n    TableColumn&lt;Person, String&gt; firstNameCol = new TableColumn&lt;&gt;(&quot;First Name&quot;);\n    firstNameCol.setCellValueFactory(cellData -&gt; cellData.getValue().firstNameProperty());\n    firstNameCol.setCellFactory(TextFieldTableCell.forTableColumn());\n\n    TableColumn&lt;Person, String&gt; lastNameCol = new TableColumn&lt;&gt;(&quot;Last Name&quot;);\n    lastNameCol.setCellValueFactory(cellData -&gt; cellData.getValue().lastNameProperty());\n\n\n    tableView.getColumns().addAll(firstNameCol, lastNameCol);\n\n    ObservableList&lt;Person&gt; data = FXCollections.observableArrayList(\n        new Person(&quot;John&quot;, &quot;Smith&quot;),\n        new Person(&quot;Emily&quot;, &quot;Johnson&quot;),\n        new Person(&quot;Michael&quot;, &quot;Williams&quot;),\n        new Person(&quot;Sarah&quot;, &quot;Brown&quot;)\n    );\n    tableView.setItems(data);\n    \n\n    final var contextMenu = new ContextMenu(new MenuItem(&quot;Show Salary&quot;));\n\n    tableView.setRowFactory(tv -&gt; {\n        TableRow&lt;Person&gt; row = new TableRow&lt;&gt;() {\n          @Override\n          public void updateItem(Person item, boolean empty) {\n            super.updateItem(item, empty);\n            if (empty || item == null) {\n              setContextMenu(null);\n            } else {\n              setContextMenu(contextMenu);\n            }\n          }\n        };\n        return row;\n    });\n\n    VBox root = new VBox(tableView);\n    Scene scene = new Scene(root, 400, 300);\n    primaryStage.setTitle(&quot;Editable Names Table&quot;);\n    primaryStage.setScene(scene);\n    primaryStage.show();\n  }\n  \n  public static void main(String[] args) {\n      launch(args);\n  }\n\n}\n</code></pre>\n",
    "score" : 4,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 4160832,
      "reputation" : 2704,
      "user_id" : 3410989,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9528c992a1307ca42a925edbd36ae8b6?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "julien.giband",
      "link" : "https://stackoverflow.com/users/3410989/julien-giband"
    },
    "creation_date" : 1743427649,
    "last_activity_date" : 1743427649,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79547435,
    "question_id" : 79546230,
    "body" : "<p>I think this can be fixed easily. Override the method show() of ContextMenu and decide whether to show or not based on the row empty.</p>\n<pre><code>TableRow&lt;Person&gt; row = new TableRow&lt;&gt;();\nContextMenu contextMenu = new ContextMenu(new MenuItem(&quot;Show Salary&quot;)){\n    @Override\n    protected void show() {\n        if(!row.isEmpty()) {\n            super.show();\n        }\n    }\n};\nrow.setContextMenu(contextMenu);\n</code></pre>\n",
    "score" : 2,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 7717111,
      "reputation" : 10689,
      "user_id" : 5844477,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/801ce427cdcbac7f648471e75d6d818e?s=256&d=identicon&r=PG",
      "display_name" : "Sai Dandem",
      "link" : "https://stackoverflow.com/users/5844477/sai-dandem"
    },
    "creation_date" : 1743464230,
    "last_activity_date" : 1743464230,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79550804,
    "question_id" : 79546230,
    "body" : "<p>I'm a firm believer in not optimizing for performance unless there is a demonstrated issue, and trying foremost to write code that is clean and easy to read. The code in the OP is unlikely to cause performance issues, and is &quot;standard&quot; JavaFX code in that it uses standard features of the API (cell factories, bindings) in the way they are intended. Also note that the event handler for the menu item (which isn't shown in the OP) needs to access the item associated with the table row. This is much easier and cleaner if each row has its own context menu; of course this incurs a performance penalty as you create multiple context menus.</p>\n<p>That said, here is (yet) another solution. Like <a href=\"https://stackoverflow.com/a/79546340/2189127\">julien.giband's solution</a>, this creates a single context menu that is shared by all (non-empty) rows. This avoids changing the row's context menu property entirely; instead of setting that property, a listener for <code>contextMenuRequested</code> is registered with the row which displays the context menu only if the row is non-empty.</p>\n<p>As with any solution using a single context menu for all rows, the code for the handlers for the menu items becomes more complex than using a different context menu for each row. To emphasize, under the principle of not complexifying code for performance reasons unless it's demonstrated that it's necessary, I would probably err on the side of using a different context menu for each row for this reason, unless profiling indicated it was necessary. I show one way to manage the menu item event handler here.</p>\n<p>Here is the relevant code:</p>\n<pre><code>        var contextMenu = new ContextMenu() {\n            private Person person;\n            void show(Node node, double x, double y, Person person) {\n                this.person = person;\n                show(node, x, y);\n            }\n        };\n\n        MenuItem salaryItem = new MenuItem(&quot;Show Salary&quot;);\n        salaryItem.setOnAction( _ -&gt; \n                System.out.println(&quot;Salary for &quot;+contextMenu.person.firstNameProperty().get())\n        );\n        contextMenu.getItems().add(salaryItem);\n        \n        tableView.setRowFactory(tv -&gt; {\n            TableRow&lt;Person&gt; row = new TableRow&lt;&gt;();\n            row.setOnContextMenuRequested(evt -&gt; {\n                if (! row.isEmpty()) {\n                    contextMenu.show(row, evt.getScreenX(), evt.getScreenY(), row.getItem());\n                }\n            });\n            return row;\n        });\n</code></pre>\n<p>and the complete example:</p>\n<pre><code>public class NewMain1 extends Application {\n\n    public static class Person {\n        private final StringProperty firstName;\n        private final StringProperty lastName;\n\n        public Person(String firstName, String lastName) {\n            this.firstName = new SimpleStringProperty(firstName);\n            this.lastName = new SimpleStringProperty(lastName);\n        }\n\n        public StringProperty firstNameProperty() { return firstName; }\n        public StringProperty lastNameProperty() { return lastName; }\n    }\n\n    @Override\n    public void start(Stage primaryStage) {\n        TableView&lt;Person&gt; tableView = new TableView&lt;&gt;();\n        tableView.setEditable(true);\n\n        TableColumn&lt;Person, String&gt; firstNameCol = new TableColumn&lt;&gt;(&quot;First Name&quot;);\n        firstNameCol.setCellValueFactory(cellData -&gt; cellData.getValue().firstNameProperty());\n        firstNameCol.setCellFactory(TextFieldTableCell.forTableColumn());\n\n        TableColumn&lt;Person, String&gt; lastNameCol = new TableColumn&lt;&gt;(&quot;Last Name&quot;);\n        lastNameCol.setCellValueFactory(cellData -&gt; cellData.getValue().lastNameProperty());\n\n\n        tableView.getColumns().addAll(firstNameCol, lastNameCol);\n\n        ObservableList&lt;Person&gt; data = FXCollections.observableArrayList(\n                new Person(&quot;John&quot;, &quot;Smith&quot;),\n                new Person(&quot;Emily&quot;, &quot;Johnson&quot;),\n                new Person(&quot;Michael&quot;, &quot;Williams&quot;),\n                new Person(&quot;Sarah&quot;, &quot;Brown&quot;)\n        );\n        tableView.setItems(data);\n\n        var contextMenu = new ContextMenu() {\n            private Person person;\n            void show(Node node, double x, double y, Person person) {\n                this.person = person;\n                show(node, x, y);\n            }\n        };\n\n        MenuItem salaryItem = new MenuItem(&quot;Show Salary&quot;);\n        salaryItem.setOnAction( _ -&gt;\n            System.out.println(&quot;Salary for &quot;+contextMenu.person.firstNameProperty().get())\n        );\n        contextMenu.getItems().add(salaryItem);\n\n        tableView.setRowFactory(tv -&gt; {\n            TableRow&lt;Person&gt; row = new TableRow&lt;&gt;();\n            row.setOnContextMenuRequested(evt -&gt; {\n                if (! row.isEmpty()) {\n                    contextMenu.show(row, evt.getScreenX(), evt.getScreenY(), row.getItem());\n                }\n            });\n            return row;\n        });\n\n        VBox root = new VBox(tableView);\n        Scene scene = new Scene(root, 400, 300);\n        primaryStage.setTitle(&quot;Editable Names Table&quot;);\n        primaryStage.setScene(scene);\n        primaryStage.show();\n    }\n\n    public static void main(String[] args) {\n        launch(args);\n    }\n}\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 2518243,
      "reputation" : 210916,
      "user_id" : 2189127,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
      "display_name" : "James_D",
      "link" : "https://stackoverflow.com/users/2189127/james-d"
    },
    "creation_date" : 1743601118,
    "last_activity_date" : 1743601118,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140282718,
    "post_id" : 79546230,
    "body" : "I doubt that this solution would cause any performance issues. All you are doing is changing the value of a reference when a row becomes empty or not empty; no new UI elements are being created that aren&#39;t already created, and remember there are only a few <code>TableRow</code> instances anyway, no matter how many items there are in the table. You could profile this, but I doubt you will see any performance issues at all.",
    "score" : 1,
    "owner" : {
      "account_id" : 2518243,
      "reputation" : 210916,
      "user_id" : 2189127,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
      "display_name" : "James_D",
      "link" : "https://stackoverflow.com/users/2189127/james-d"
    },
    "creation_date" : 1743429002,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140282715,
    "post_id" : 79546230,
    "body" : "Have you noticed a slowdown in performance?",
    "score" : 2,
    "owner" : {
      "account_id" : 2819940,
      "reputation" : 14002,
      "user_id" : 2423906,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://i.sstatic.net/rkpYv.jpg?s=256",
      "display_name" : "SedJ601",
      "link" : "https://stackoverflow.com/users/2423906/sedj601"
    },
    "creation_date" : 1743428966,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140282689,
    "post_id" : 79546230,
    "body" : "Can you disable empty cells and set them transparent or invisible?",
    "score" : 0,
    "owner" : {
      "account_id" : 2819940,
      "reputation" : 14002,
      "user_id" : 2423906,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://i.sstatic.net/rkpYv.jpg?s=256",
      "display_name" : "SedJ601",
      "link" : "https://stackoverflow.com/users/2423906/sedj601"
    },
    "creation_date" : 1743428611,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79547435" : [ {
      "comment_id" : 140285504,
      "post_id" : 79547435,
      "body" : "That will avoid using a listener, but it will force you to create a different <code>ContextMenu</code> instance for each row, which is far from ideal",
      "score" : 2,
      "owner" : {
        "account_id" : 4160832,
        "reputation" : 2704,
        "user_id" : 3410989,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/9528c992a1307ca42a925edbd36ae8b6?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "julien.giband",
        "link" : "https://stackoverflow.com/users/3410989/julien-giband"
      },
      "creation_date" : 1743489492,
      "content_license" : "CC BY-SA 4.0"
    } ],
    "79546340" : [ {
      "comment_id" : 140290716,
      "post_id" : 79546340,
      "body" : "It occurred to me you can avoid both your approach (<code>updateItem()</code>) and the listener/binding simply by calling <code>ContextMenu::show</code> in a <code>contextMenuRequested</code> listener. This invokes the &quot;is empty&quot; logic only when the menu is requested, which will be more efficient than either. I added a solution with this approach.",
      "score" : 1,
      "owner" : {
        "account_id" : 2518243,
        "reputation" : 210916,
        "user_id" : 2189127,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
        "display_name" : "James_D",
        "link" : "https://stackoverflow.com/users/2189127/james-d"
      },
      "creation_date" : 1743601278,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140282933,
      "post_id" : 79546340,
      "body" : "That&#39;s a fair point, and optimization is often some kind of trade-off between memory consumption and compute time. There are <code>WeakListener</code>s that could be used to (try to) avoid the &quot;stale listener&quot; issue, at the cost of further complexity.",
      "score" : 0,
      "owner" : {
        "account_id" : 2518243,
        "reputation" : 210916,
        "user_id" : 2189127,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
        "display_name" : "James_D",
        "link" : "https://stackoverflow.com/users/2189127/james-d"
      },
      "creation_date" : 1743431935,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140282837,
      "post_id" : 79546340,
      "body" : "My reasoning was that a listener has some memory imprint on the system, and might not be released immediately when the TableRow is not in use anymore, both drawbacks being multiplied by the number of created rows. I won&#39;t argue with you on that though, as I suspect you probably have a way more in-depth knowledge of FX as I do.",
      "score" : 3,
      "owner" : {
        "account_id" : 4160832,
        "reputation" : 2704,
        "user_id" : 3410989,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/9528c992a1307ca42a925edbd36ae8b6?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "julien.giband",
        "link" : "https://stackoverflow.com/users/3410989/julien-giband"
      },
      "creation_date" : 1743430556,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140282749,
      "post_id" : 79546340,
      "body" : "I&#39;m not convinced about 2. here. The <code>updateItem</code> method can be called quite frequently (e.g. during scrolling) and it&#39;s fairly rare for a row to switch between being empty and non-empty. So I suspect <code>updateItem</code> is called significantly more often than the listener on the <code>empty</code> property is invoked. (It would require some profiling to know for sure.)",
      "score" : 1,
      "owner" : {
        "account_id" : 2518243,
        "reputation" : 210916,
        "user_id" : 2189127,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
        "display_name" : "James_D",
        "link" : "https://stackoverflow.com/users/2189127/james-d"
      },
      "creation_date" : 1743429340,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}