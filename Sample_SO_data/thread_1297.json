{
  "question" : {
    "question_id" : 79721791,
    "title" : "Created file with app not visible by phone but internal storage",
    "body" : "<p>I made an app that creates a PDF file. While the file is successfully generated, it doesn't appear in Google Files. The file, as a document, should appear in the documents section of Google Files, but it doesn't. Neither it does when looking for the file to send through WhatsApp. The only way to find it is going to the internal storage, an impractical way.</p>\n<p>The app doesn't show any error, so i don't have an error log. This doesn't happen in the emulator, only in real phones. I'm using Android 14.</p>\n<p>MainActivity.java:</p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.example.receiptgenerator;\n\nimport android.graphics.Bitmap;\nimport android.graphics.BitmapFactory;\nimport android.graphics.Canvas;\nimport android.graphics.Color;\nimport android.graphics.Paint;\nimport android.graphics.Typeface;\nimport android.graphics.pdf.PdfDocument;\nimport android.os.Bundle;\nimport android.os.Environment;\nimport android.util.Log;\nimport android.view.View;\nimport android.widget.Button;\nimport android.widget.EditText;\nimport android.widget.Toast;\n\nimport androidx.activity.EdgeToEdge;\nimport androidx.appcompat.app.AppCompatActivity;\nimport androidx.core.content.res.ResourcesCompat;\nimport androidx.core.graphics.Insets;\nimport androidx.core.view.ViewCompat;\nimport androidx.core.view.WindowInsetsCompat;\n\nimport java.io.File;\nimport java.io.FileNotFoundException;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\n\npublic class MainActivity extends AppCompatActivity {\n    Button createPDFButton;\n\n    //EditText spaces\n    EditText dateText;\n    EditText groupText;\n    EditText cycleText;\n    EditText termText;\n    EditText feeText;\n    EditText capitalText;\n    EditText interestText;\n    EditText moratoriumText;\n    EditText fileText;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        EdgeToEdge.enable(this);\n        setContentView(R.layout.activity_main);\n        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main), (v, insets) -&gt; {\n            Insets systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars());\n            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom);\n            return insets;\n        });\n\n        //Definition of EditText elements\n        dateText = findViewById(R.id.dateText);\n        groupText = findViewById(R.id.groupText);\n        cycleText = findViewById(R.id.cycleText);\n        termText = findViewById(R.id.termText);\n        feeText = findViewById(R.id.feeText);\n        capitalText = findViewById(R.id.capitalText);\n        interestText = findViewById(R.id.interestText);\n        moratoriumText = findViewById(R.id.moratoriumText);\n        fileText = findViewById(R.id.fileText);\n\n        createPDFButton = findViewById(R.id.button);\n        createPDFButton.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                createButtonAction();\n            }\n        });\n    }\n\n    private void createButtonAction() {\n        try {\n            CreatePDF();\n        } catch (Exception e) {\n            Log.d(&quot;mylog&quot;, e.toString());\n            Toast.makeText(this, e.toString(), Toast.LENGTH_SHORT).show();\n        }\n    }\n\n    private void CreatePDF() {\n        //This creates a PDFDocument\n        PdfDocument document = new PdfDocument();\n        PdfDocument.PageInfo pageInfo = new PdfDocument.PageInfo.Builder(378, 567, 1).create();\n        PdfDocument.Page page = document.startPage(pageInfo);\n\n        //This handles the drawing of things\n        Canvas canvas = page.getCanvas();\n        Typeface consoleFont = ResourcesCompat.getFont(getBaseContext(), R.font.inconsolata_regular);\n\n        //Paint1\n        Paint paint = new Paint();\n        paint.setColor(Color.BLACK);\n        paint.setTypeface(consoleFont);\n        paint.setTextSize(18);\n\n        //Paint2\n        Paint paint2 = new Paint();\n        paint2.setColor(Color.BLACK);\n        paint2.setTypeface(consoleFont);\n        paint2.setTextSize(18);\n        paint2.setTextAlign(Paint.Align.RIGHT);\n\n        //This handles the content\n        Bitmap background = BitmapFactory.decodeResource(getResources(), R.drawable.background);\n        Bitmap newBackground = Bitmap.createScaledBitmap(background, 378, 567, true);\n\n        //Text Strings\n        String dateTextString = dateText.getText().toString();\n        String groupTextString = groupText.getText().toString();\n        String cycleTextString = cycleText.getText().toString();\n        String termTextString = termText.getText().toString();\n        String feeTextString = feeText.getText().toString();\n        String capitalTextString = capitalText.getText().toString();\n        String interestTextString = interestText.getText().toString();\n        String moratoriumTextString = moratoriumText.getText().toString();\n\n        //Writes PDF content\n        canvas.drawBitmap(newBackground, 0, 0, new Paint(Color.WHITE));\n        canvas.drawText(dateTextString, 240, 145, paint);\n        canvas.drawText(groupTextString, 240, 170, paint);\n        canvas.drawText(cycleTextString, 240, 195, paint);\n        canvas.drawText(termTextString + &quot; Semanas&quot;, 240, 220, paint);\n        canvas.drawText(feeTextString + &quot;/&quot; + termText.getText().toString(), 210, 290, paint2);\n        if (capitalTextString.equals(&quot;&quot;) || interestTextString.equals(&quot;&quot;) || moratoriumTextString.equals(&quot;&quot;)) {\n\n        } else {\n            canvas.drawText(String.format(&quot;%.2f&quot;, Float.parseFloat(capitalTextString)), 350, 360, paint2);\n            canvas.drawText(String.format(&quot;%.2f&quot;, Float.parseFloat(interestTextString)), 350, 389, paint2);\n            canvas.drawText(String.format(&quot;%.2f&quot;, Float.parseFloat(moratoriumTextString)), 350, 418, paint2);\n\n            //totalText calc and writing\n            float total = Float.parseFloat(capitalText.getText().toString())\n                    + Float.parseFloat(interestText.getText().toString())\n                    + Float.parseFloat(moratoriumText.getText().toString());\n            canvas.drawText(String.format(&quot;%.2f&quot;, total), 350, 500, paint2);\n        }\n\n        document.finishPage(page);\n\n        File documentsDir = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DOCUMENTS);\n        String filename = fileText.getText().toString() + &quot;.pdf&quot;;\n        if (fileText.getText().toString().equals(&quot;&quot;)) {\n            Toast.makeText(this, &quot;Error: Write the file name.&quot;, Toast.LENGTH_SHORT).show();\n        } else if (dateTextString.equals(&quot;&quot;) || groupTextString.equals(&quot;&quot;) || cycleTextString.equals(&quot;&quot;)\n        || termTextString.equals(&quot;&quot;) || feeTextString.equals(&quot;&quot;) || capitalTextString.equals(&quot;&quot;)\n        || interestTextString.equals(&quot;&quot;) || moratoriumTextString.equals(&quot;&quot;)) {\n            Toast.makeText(this, &quot;Error: Fill all fields.&quot;, Toast.LENGTH_SHORT).show();\n        } else {\n            File file = new File(documentsDir, filename);\n            try {\n                FileOutputStream fos = new FileOutputStream(file);\n                document.writeTo(fos);\n                document.close();\n                fos.close();\n                Toast.makeText(this, &quot;Receipt created successfully.&quot;, Toast.LENGTH_SHORT).show();\n            } catch (FileNotFoundException e) {\n                Log.d(&quot;mylog&quot;, &quot;Receipt failed &quot; + e.toString());\n                throw new RuntimeException(e);\n            } catch (IOException e) {\n                throw new RuntimeException(e);\n            }\n        }\n\n    }\n}\n</code></pre>\n<p>I tried replacing getExternalStoragePublicDirectory() with getExternalFilesDir(), creating an specific directory for the app, but the file is still invisible for the rest.</p>\n",
    "tags" : [ "java", "android", "pdf-generation", "storage" ],
    "owner" : {
      "account_id" : 43230826,
      "reputation" : 9,
      "user_id" : 31147556,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/8c915c7b53ff540e04de45c45af1f2cf?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "GeniusRobot",
      "link" : "https://stackoverflow.com/users/31147556/geniusrobot"
    },
    "is_answered" : false,
    "view_count" : 63,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1754038416,
    "creation_date" : 1753992107,
    "link" : "https://stackoverflow.com/questions/79721791/created-file-with-app-not-visible-by-phone-but-internal-storage",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140634994,
    "post_id" : 79721791,
    "body" : "The reason is that  you directly create the file in file-system, without Android MediaStore involved. On most modern devices Android detects newly created files in the file-system automatically, but sometimes it doesn&#39;t work and then such files are not visible in other apps or on a connected PC via MTP: <a href=\"https://android.stackexchange.com/a/202739/2241\">android.stackexchange.com/a/202739/2241</a> The correct way to create a file is shown here: <a href=\"https://stackoverflow.com/q/59511147/150978\">stackoverflow.com/q/59511147/150978</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 50585,
      "reputation" : 43459,
      "user_id" : 150978,
      "user_type" : "registered",
      "accept_rate" : 78,
      "profile_image" : "https://www.gravatar.com/avatar/feadc214792e2581c3c750140e3eb2c7?s=256&d=identicon&r=PG",
      "display_name" : "Robert",
      "link" : "https://stackoverflow.com/users/150978/robert"
    },
    "creation_date" : 1754040869,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}