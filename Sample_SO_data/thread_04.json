{
  "question" : {
    "question_id" : 79843601,
    "title" : "Flink: Could not initialize class org.apache.flink.runtime.util.HadoopUtils (Error when creating catalog with iceberg type in Flink)",
    "body" : "<p>I am trying to run a very simple Flink (Java) job that:</p>\n<ul>\n<li>Creates an Iceberg JDBC catalog backed by PostgreSQL</li>\n<li>Sets the Iceberg warehouse to the Hadoop FileSystem</li>\n</ul>\n<p>The job is built successfully with Maven, but when I submit it to a local Flink (1.20.2) it fails during the CREATE CATALOG</p>\n<p>My current files\npom.xml</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;\n         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0\n                             http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n\n    &lt;groupId&gt;com.example&lt;/groupId&gt;\n    &lt;artifactId&gt;iceberg-s3-setup&lt;/artifactId&gt;\n    &lt;version&gt;1.0.0&lt;/version&gt;\n    &lt;packaging&gt;jar&lt;/packaging&gt;\n\n    &lt;name&gt;Iceberg S3 Setup Job&lt;/name&gt;\n\n    &lt;properties&gt;\n        &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt;\n        &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt;\n        &lt;flink.version&gt;1.20.2&lt;/flink.version&gt;\n        &lt;iceberg.version&gt;1.10.0&lt;/iceberg.version&gt;\n        &lt;hadoop.version&gt;3.3.6&lt;/hadoop.version&gt;\n    &lt;/properties&gt;\n\n    &lt;dependencies&gt;\n        &lt;!-- Flink core --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n            &lt;artifactId&gt;flink-java&lt;/artifactId&gt;\n            &lt;version&gt;${flink.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n            &lt;artifactId&gt;flink-streaming-java&lt;/artifactId&gt;\n            &lt;version&gt;${flink.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;!-- Flink Table API bridge (required for StreamTableEnvironment) --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;\n            &lt;artifactId&gt;flink-table-api-java-bridge&lt;/artifactId&gt;\n            &lt;version&gt;${flink.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;!-- Iceberg Flink runtime (matches Flink 1.18) --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.iceberg&lt;/groupId&gt;\n            &lt;artifactId&gt;iceberg-flink-runtime-1.20&lt;/artifactId&gt;\n            &lt;version&gt;${iceberg.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;!-- Iceberg AWS bundle (contains S3FileIO) --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.iceberg&lt;/groupId&gt;\n            &lt;artifactId&gt;iceberg-aws&lt;/artifactId&gt;\n            &lt;version&gt;${iceberg.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;!-- Hadoop AWS (for s3a://) --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;\n            &lt;artifactId&gt;hadoop-aws&lt;/artifactId&gt;\n            &lt;version&gt;${hadoop.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;!-- Shade plugin to create an uber-jar (optional but recommended) --&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;\n                &lt;version&gt;3.5.0&lt;/version&gt;\n                &lt;executions&gt;\n                    &lt;execution&gt;\n                        &lt;phase&gt;package&lt;/phase&gt;\n                        &lt;goals&gt;&lt;goal&gt;shade&lt;/goal&gt;&lt;/goals&gt;\n                        &lt;configuration&gt;\n                            &lt;createDependencyReducedPom&gt;false&lt;/createDependencyReducedPom&gt;\n                            &lt;filters&gt;\n                                &lt;filter&gt;\n                                    &lt;artifact&gt;*:*&lt;/artifact&gt;\n                                    &lt;excludes&gt;\n                                        &lt;exclude&gt;META-INF/*.SF&lt;/exclude&gt;\n                                        &lt;exclude&gt;META-INF/*.DSA&lt;/exclude&gt;\n                                        &lt;exclude&gt;META-INF/*.RSA&lt;/exclude&gt;\n                                    &lt;/excludes&gt;\n                                &lt;/filter&gt;\n                            &lt;/filters&gt;\n                            &lt;!-- Optional: make the jar runnable directly --&gt;\n                            &lt;transformers&gt;\n                                &lt;transformer implementation=&quot;org.apache.maven.plugins.shade.resource.ManifestResourceTransformer&quot;&gt;\n                                    &lt;mainClass&gt;com.example.IcebergS3SetupJava&lt;/mainClass&gt;\n                                &lt;/transformer&gt;\n                            &lt;/transformers&gt;\n                        &lt;/configuration&gt;\n                    &lt;/execution&gt;\n                &lt;/executions&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n&lt;/project&gt;\n</code></pre>\n<p>I produce mainClass = com.example.IcebergS3SetupJava (src/main/java/com/example/IcebergS3SetupJava.java)</p>\n<pre><code>package com.example;\nimport org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;\nimport org.apache.flink.table.api.EnvironmentSettings;\nimport org.apache.flink.table.api.bridge.java.StreamTableEnvironment;\npublic class IcebergS3SetupJava {\n    public static void main(String[] args) throws Exception {\n     StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n     env.enableCheckpointing(10_000L); // 10 seconds\n     EnvironmentSettings settings = EnvironmentSettings.newInstance()\n             .inStreamingMode()\n             .build();\n     StreamTableEnvironment tEnv = StreamTableEnvironment.create(env, settings);\n     // Create Iceberg JDBC catalog pointing to MinIO/S3\n     tEnv.executeSql(\n         &quot;CREATE CATALOG iceberg_catalog WITH (\\n&quot; +\n         &quot; 'type' = 'iceberg',\\n&quot; +\n         &quot; 'catalog-type' = 'jdbc',\\n&quot; +\n         &quot; 'catalog-impl' = 'org.apache.iceberg.jdbc.JdbcCatalog', \\n&quot; +\n         &quot; 'jdbc.uri' = 'jdbc:postgresql://&lt;postgres_ip&gt;:&lt;postgres_port&gt;/iceberg_catalog',\\n&quot; +\n         &quot; 'jdbc.user' = 'user',\\n&quot; +\n         &quot; 'jdbc.password' = 'pass',\\n&quot; +\n         &quot; 'warehouse' = 'hdfs://&lt;my_ip&gt;:8020/user/warehouse',\\n&quot; +\n         &quot;)&quot;\n     );\n     // Create sample table\n     tEnv.executeSql(\n         &quot;CREATE TABLE iceberg_catalog.default.sample (\\n&quot; +\n         &quot; id BIGINT COMMENT 'unique id',\\n&quot; +\n         &quot; data STRING\\n&quot; +\n         &quot;) WITH (\\n&quot; +\n         &quot; 'format-version' = '2'\\n&quot; +\n         &quot;)&quot;\n     );\n     System.out.println(&quot;Iceberg catalog and sample table created successfully on S3!&quot;);\n     // This job only does DDL â†’ execute to make it run\n     env.execute(&quot;Iceberg S3 Catalog &amp; Table Creation&quot;);\n }\n}\n</code></pre>\n<p>Environmen:</p>\n<p>Flink 1.20.2\nIceberg 1.10.0\nPostgreSQL 16\nJava 11</p>\n<p>Submit job</p>\n<p><code>flink run -c com.example.IcebergS3SetupJava target/iceberg-s3-setup-1.0.0.jar</code></p>\n<p>I submit and got error</p>\n<pre><code>java.lang.NoClassDefFoundError: Could not initialize class org.apache.flink.runtime.util.HadoopUtils\n</code></pre>\n",
    "tags" : [ "java", "apache-flink", "apache-iceberg" ],
    "owner" : {
      "account_id" : 11931655,
      "reputation" : 43,
      "user_id" : 9416835,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/s256-rj/photo.jpg",
      "display_name" : "Tai Lu",
      "link" : "https://stackoverflow.com/users/9416835/tai-lu"
    },
    "is_answered" : false,
    "view_count" : 20,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1765427795,
    "creation_date" : 1765427235,
    "link" : "https://stackoverflow.com/questions/79843601/flink-could-not-initialize-class-org-apache-flink-runtime-util-hadooputils-err",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}