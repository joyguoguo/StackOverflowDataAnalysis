{
  "question" : {
    "question_id" : 79683336,
    "title" : "CollisionShape 90 degrees out of sync with vehicle model and wheels VehicleControl jmonkeyengine",
    "body" : "<p>I am trying to make a driving game using jmonkeyengine based on the (<a href=\"https://github.com/jMonkeyEngine/jmonkeyengine/blob/master/jme3-examples/src/main/java/jme3test/bullet/TestFancyCar.java\" rel=\"nofollow noreferrer\">testFancyCar example</a>) with a different model, but the CollisionShape for the body of the car is offset by 90 degrees from the model used to generate it as seen below.</p>\n<p><a href=\"https://i.sstatic.net/trEwwXay.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/trEwwXay.png\" alt=\"enter image description here\" /></a></p>\n<p>I have tried to rotate and rerotate the model before and after generating the CollsionShape but this seems to have no effect. Furthermore, the wheels don't line up perfectly with the original model and spin the wrong way. The model I am using is <a href=\"https://sketchfab.com/3d-models/racecar-rc-14-8d2bea30457f462d98a91cd472d6035e\" rel=\"nofollow noreferrer\">this one</a> and this is my code:</p>\n<pre><code>public class Main extends SimpleApplication implements ActionListener {\nprivate BulletAppState bAppState;\nprivate Spatial car;\nprivate VehicleControl player;\n\nprivate float steeringValue = 0;\nprivate float accelerationValue = 0;\n\npublic static void main(String[] args) {\n    Main app = new Main();\n    app.start();\n}\n\nprivate void setupKeys() {\n    inputManager.addMapping(&quot;Lefts&quot;, new KeyTrigger(KeyInput.KEY_H));\n    inputManager.addMapping(&quot;Rights&quot;, new KeyTrigger(KeyInput.KEY_K));\n    inputManager.addMapping(&quot;Ups&quot;, new KeyTrigger(KeyInput.KEY_U));\n    inputManager.addMapping(&quot;Downs&quot;, new KeyTrigger(KeyInput.KEY_J));\n    inputManager.addMapping(&quot;Reset&quot;, new KeyTrigger(KeyInput.KEY_RETURN));\n    inputManager.addListener(this, &quot;Lefts&quot;);\n    inputManager.addListener(this, &quot;Rights&quot;);\n    inputManager.addListener(this, &quot;Ups&quot;);\n    inputManager.addListener(this, &quot;Downs&quot;);\n    inputManager.addListener(this, &quot;Reset&quot;);\n}\n\n@Override\npublic void simpleInitApp() {\n    bAppState = new BulletAppState();\n    stateManager.attach(bAppState);\n    bAppState.setDebugEnabled(true);\n    \n    viewPort.setBackgroundColor(new ColorRGBA(0.7f, 0.8f, 1f, 1f));\n    flyCam.setMoveSpeed(10);\n    \n    createCar();\n    createTrack();\n    setUpLights();\n    setupKeys();\n}\n\n@Override\npublic void simpleUpdate(float tpf) {\n     \n}\n\n@Override\npublic void simpleRender(RenderManager rm) {\n    \n}\n\nprivate void createTrack() {\n\n    \n    Material material = new Material(assetManager, &quot;Common/MatDefs/Misc/Unshaded.j3md&quot;);\n    material.setColor(&quot;Color&quot;, ColorRGBA.Blue);\n    Box floorBox = new Box(140, 0.25f, 140);\n    Geometry floorGeometry = new Geometry(&quot;Floor&quot;, floorBox);\n    floorGeometry.setMaterial(material);\n    floorGeometry.setLocalTranslation(0, -1, 0);\n    floorGeometry.addControl(new RigidBodyControl(0));\n    rootNode.attachChild(floorGeometry);\n    bAppState.getPhysicsSpace().add(floorGeometry);\n  \n}\n\n/**\n * Wheels are named &quot;FER_TIRE_LF_4&quot; &quot;FER_TIRE_LR_5&quot; &quot;FER_TIRE_RF_6&quot; &quot;FER_TIRE_RR_7&quot;\n */\nprivate void createCar() {\n    float stiffness = 120.0f;//200=f1 car\n    float compValue = 0.2f; //(lower than damp!)\n    float dampValue = 0.3f;\n    final float mass = 400;\n    \n    car = assetManager.loadModel(&quot;Models/racecar_rc-14/scene.gltf&quot;);\n    \n    \n    Spatial chassis = findSpatial(car, &quot;car_1&quot;);\n\n    CollisionShape carHull = CollisionShapeFactory.createDynamicMeshShape(chassis);\n\n    player = new VehicleControl(carHull, mass);\n    car.addControl(player);\n    \n\n    Vector3f wheelDirection = new Vector3f(0,-1,0);\n    Vector3f wheelAxle = new Vector3f(1, 0, 0);\n\n    Spatial wheel_fr = findSpatial(car, &quot;FER_TIRE_RF_6&quot;);\n\n    BoundingBox box = toRootBound(wheel_fr);\n    float wheelRadius = box.getYExtent();\n\n    player.addWheel(wheel_fr, wheel_fr.getLocalTranslation(),\n            wheelDirection, wheelAxle, 0.2f, wheelRadius, true);\n\n    Spatial wheel_fl = findSpatial(car, &quot;FER_TIRE_LF_4&quot;);\n    player.addWheel(wheel_fl, wheel_fl.getLocalTranslation(),\n            wheelDirection, wheelAxle, 0.2f, wheelRadius, true);\n\n    Spatial wheel_br = findSpatial(car, &quot;FER_TIRE_RR_7&quot;);\n    player.addWheel(wheel_br, wheel_br.getLocalTranslation(), \n            wheelDirection, wheelAxle, 0.2f, wheelRadius, false);\n\n    Spatial wheel_bl = findSpatial(car, &quot;FER_TIRE_LR_5&quot;);\n    player.addWheel(wheel_bl, wheel_bl.getLocalTranslation(),\n            wheelDirection, wheelAxle, 0.2f, wheelRadius, false);\n    \n    player.setSuspensionCompression(compValue * 2.0f * FastMath.sqrt(stiffness));\n    player.setSuspensionDamping(dampValue * 2.0f * FastMath.sqrt(stiffness));\n    player.setSuspensionStiffness(stiffness);\n    player.setMaxSuspensionForce(10000);\n\n    player.getWheel(2).setFrictionSlip(4);\n    player.getWheel(3).setFrictionSlip(4);\n    \n    player.setPhysicsLocation(new Vector3f(0, 0, 0));\n    player.setPhysicsRotation(new Matrix3f());\n\n    rootNode.attachChild(car);\n    bAppState.getPhysicsSpace().add(player);\n    \n}\n\nprivate void setUpLights() {\n    DirectionalLight l1 = new DirectionalLight();\n    l1.setDirection(new Vector3f(-0.1f, -0.7f, -1.0f).normalizeLocal());\n    rootNode.addLight(l1);\n    \n    DirectionalLight l2 = new DirectionalLight();\n    l2.setDirection(new Vector3f(1, 0, 0).normalizeLocal());\n    rootNode.addLight(l2);\n}\n\nprivate Spatial findSpatial(Spatial spatial, String name) {\n    if (spatial.getName().startsWith(name)) {\n            return spatial;\n        }\n    \n    if (spatial instanceof Node) {\n        Node node = (Node) spatial;\n        for (int i = 0; i &lt; node.getQuantity(); i++) {\n            Spatial child = node.getChild(i);\n            Spatial result = findSpatial(child, name);\n            if (result != null) {\n                return result;\n            }\n        }\n    }\n    \n    return null;\n}\n\nprivate BoundingBox toRootBound(Spatial spatial) {\n    if (spatial instanceof Node) {\n        Node node = (Node) spatial;\n        return toRootBound(node.getChild(0));\n    } else if (spatial instanceof Geometry) {\n        Geometry geom = (Geometry) spatial;\n        return (BoundingBox) geom.getModelBound();\n    }\n    \n    return null;\n}\n\n@Override\npublic void onAction(String binding, boolean value, float tpf) {\n    if (binding.equals(&quot;Lefts&quot;)) {\n        if (value) {\n            steeringValue += .5f;\n        } else {\n            steeringValue -= .5f;\n        }\n        player.steer(steeringValue);\n    } else if (binding.equals(&quot;Rights&quot;)) {\n        if (value) {\n            steeringValue -= .5f;\n        } else {\n            steeringValue += .5f;\n        }\n        player.steer(steeringValue);\n    } // Note that our fancy car actually goes backward.\n    else if (binding.equals(&quot;Ups&quot;)) {\n        if (value) {\n            accelerationValue -= 800;\n        } else {\n            accelerationValue += 800;\n        }\n        player.accelerate(accelerationValue);\n    } else if (binding.equals(&quot;Downs&quot;)) {\n        if (value) {\n            player.brake(40f);\n        } else {\n            player.brake(0f);\n        }\n    } else if (binding.equals(&quot;Reset&quot;)) {\n        if (value) {\n            System.out.println(&quot;Reset&quot;);\n            player.setPhysicsLocation(new Vector3f(0, 0, 0));\n            player.setPhysicsRotation(new Matrix3f());\n            player.setLinearVelocity(Vector3f.ZERO);\n            player.setAngularVelocity(Vector3f.ZERO);\n            player.resetSuspension();\n        }\n    }\n}\n}\n</code></pre>\n<p>I am quite new to jmonkeyengine and can't find helpful resources. What can I try next?</p>\n",
    "tags" : [ "java", "game-physics", "gltf", "jmonkeyengine" ],
    "owner" : {
      "account_id" : 18293531,
      "reputation" : 524,
      "user_id" : 13319888,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/cVXpN.jpg?s=256",
      "display_name" : "TheFluffDragon9",
      "link" : "https://stackoverflow.com/users/13319888/thefluffdragon9"
    },
    "is_answered" : false,
    "view_count" : 27,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1751151384,
    "creation_date" : 1751144850,
    "link" : "https://stackoverflow.com/questions/79683336/collisionshape-90-degrees-out-of-sync-with-vehicle-model-and-wheels-vehiclecontr",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}