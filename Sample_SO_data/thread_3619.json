{
  "question" : {
    "question_id" : 79536367,
    "title" : "Hibernate generates DDL with alter table before drop table causing errors with create-drop",
    "body" : "<p>I'm setting up a database with Hibernate and encountering issues with the schema creation script when using create or create-drop properties. Hibernate attempts to alter tables before dropping them, causing errors because the tables don't exist yet.\nProblem:</p>\n<p>When starting my application with spring.jpa.hibernate.ddl-auto=create or create-drop, I get errors like:</p>\n<pre><code>Error executing DDL &quot;alter table doctor_patient drop foreign key FKjda75ix2tcxtuemg6v1n0f453&quot; via JDBC [Table 'database.doctor_patient' doesn't exist]\n</code></pre>\n<p>This happens for every foreign key constraint. So I exported ddl script that Hibernate uses, here it is:</p>\n<pre><code>alter table doctor_patient drop foreign key FKjda75ix2tcxtuemg6v1n0f453;\nalter table doctor_patient drop foreign key FK9gfear64wbhtnnxgqqj5q94x6;\nalter table doctors drop foreign key FKe9pf5qtxxkdyrwibaevo9frtk;\nalter table files drop foreign key FK6ono3k65jirbu8wa70mvrt2ha;\nalter table files drop foreign key FK1fx82i1t9l0grfob7vdiir6pk;\nalter table notes drop foreign key FKrbrw0s0kri5g77162n7tayi1m;\nalter table notes drop foreign key FKm8gx0wn0astxp8h55ykwa4uk4;\nalter table patients drop foreign key FKuwca24wcd1tg6pjex8lmc0y7;\ndrop table if exists doctor_patient;\ndrop table if exists doctors;\ndrop table if exists files;\ndrop table if exists notes;\ndrop table if exists patients;\ndrop table if exists users;\ncreate table doctor_patient (doctor_id char(36) not null, patient_id char(36) not null, primary key (doctor_id, patient_id)) engine=InnoDB;\ncreate table doctors (version integer, user_id char(36) not null, license_number char(50) not null, specialty varchar(100) not null, primary key (user_id)) engine=InnoDB;\ncreate table files (version integer, created_date datetime(6), updated_date datetime(6), doctor_id char(36) not null, id varchar not null, patient_id char(36) not null, file_path varchar(255) not null, file_type varchar(255) not null, primary key (id)) engine=InnoDB;\ncreate table notes (version integer, created_date datetime(6), updated_date datetime(6), doctor_id char(36) not null, id varchar not null, patient_id char(36) not null, note_text TEXT(5000) not null, primary key (id)) engine=InnoDB;\ncreate table patients (date_of_birth date, version integer, user_id char(36) not null, medical_history TEXT(5000), primary key (user_id)) engine=InnoDB;\ncreate table users (version integer, created_date datetime(6), update_date datetime(6), id varchar not null, username varchar(50) not null, password_hash varchar(64) not null, email varchar(255) not null, first_name varchar(255) not null, last_name varchar(255) not null, phone_number varchar(255), role varchar(255) not null, primary key (id)) engine=InnoDB;\nalter table doctors add constraint UK1xu5x0jae737xae254t4rgcd1 unique (license_number);\nalter table doctor_patient add constraint FKjda75ix2tcxtuemg6v1n0f453 foreign key (patient_id) references patients (user_id);\nalter table doctor_patient add constraint FK9gfear64wbhtnnxgqqj5q94x6 foreign key (doctor_id) references doctors (user_id);\nalter table doctors add constraint FKe9pf5qtxxkdyrwibaevo9frtk foreign key (user_id) references users (id);\nalter table files add constraint FK6ono3k65jirbu8wa70mvrt2ha foreign key (doctor_id) references doctors (user_id);\nalter table files add constraint FK1fx82i1t9l0grfob7vdiir6pk foreign key (patient_id) references patients (user_id);\nalter table notes add constraint FKrbrw0s0kri5g77162n7tayi1m foreign key (doctor_id) references doctors (user_id);\nalter table notes add constraint FKm8gx0wn0astxp8h55ykwa4uk4 foreign key (patient_id) references patients (user_id);\nalter table patients add constraint FKuwca24wcd1tg6pjex8lmc0y7 foreign key (user_id) references users (id);\n</code></pre>\n<p>Using update instead of create-drop works, but I want to completely recreate the schema for testing purposes. I'm also sending my spring properties:</p>\n<pre><code>spring.datasource.url=jdbc:mysql://127.0.0.1:3306/database?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC\nspring.jpa.database=mysql\nspring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver\nspring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect\nspring.jpa.hibernate.ddl-auto=create-drop\n</code></pre>\n<p>Questions:</p>\n<ul>\n<li>How can I make Hibernate skip the alter table step when<br />\ndropping/recreating the schema?</li>\n<li>Is this behavior expected, or is<br />\nthere a way to configure it properly?</li>\n<li>(Optional) I also attached my\nER diagram. I'm not really confident in my db design. For instance, for my authentication setup, Iâ€™m using a users table with separate doctors and patients tables referencing it, but if I would need to find doctor or patient connected to that user I will need to scroll through the entire doctor and patients tables. This doesn't seem right to me.</li>\n</ul>\n<p><a href=\"https://i.sstatic.net/OlIN3Cv1.png\" rel=\"nofollow noreferrer\">ER diagram</a></p>\n",
    "tags" : [ "java", "spring", "hibernate" ],
    "owner" : {
      "account_id" : 26364405,
      "reputation" : 3,
      "user_id" : 20020122,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AFdZucryZ0TvbZe8wUtZie08yD2QmjwPwaeH7kV7vOHj=k-s256",
      "display_name" : "Erik Reiz",
      "link" : "https://stackoverflow.com/users/20020122/erik-reiz"
    },
    "is_answered" : false,
    "view_count" : 63,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1743029457,
    "creation_date" : 1742991298,
    "link" : "https://stackoverflow.com/questions/79536367/hibernate-generates-ddl-with-alter-table-before-drop-table-causing-errors-with-c",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}