{
  "question" : {
    "question_id" : 79568278,
    "title" : "MongoDB Java Driver returns all documents instead of matching filter in Java Servlet",
    "body" : "<p>I'm building an Expense Tracker web app using Java Servlets and MongoDB. I want to filter expense documents based on <code>user</code> and <code>category</code> (e.g., user: &quot;chir&quot;, category: &quot;education&quot;).</p>\n<p>However, when I run the code below, MongoDB returns <strong>all documents</strong> instead of just the ones that match the filter.</p>\n<p>Here’s the code I’m using in the servlet:</p>\n<pre class=\"lang-java prettyprint-override\"><code>protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n\n  response.setContentType(&quot;application/json&quot;);\n  response.setCharacterEncoding(&quot;UTF-8&quot;);\n  PrintWriter out = response.getWriter();\n\n  try {\n      String user = request.getParameter(&quot;username&quot;);\n      String category = request.getParameter(&quot;category&quot;);\n\n      if (user == null || user.isEmpty()) {\n          response.setStatus(HttpServletResponse.SC_BAD_REQUEST);\n          out.println(gson.toJson(new ResponseMessage(&quot;❌ User parameter is required&quot;)));\n          return;\n      }\n\n      // ✅ Build MongoDB query\n      Document query = new Document(&quot;user&quot;, user);\n      if (category != null &amp;&amp; !category.trim().isEmpty()) {\n          query.append(&quot;category&quot;, category.trim());\n      }\n\n      System.out.println(&quot;\uD83D\uDCE1 QUERY =&gt; &quot; + query.toJson());\n\n      List&lt;Document&gt; expensesList = new ArrayList&lt;&gt;();\n\n      // ✅ Double check this is correct collection!\n      try (MongoCursor&lt;Document&gt; cursor = expenseCollection.find(query).iterator()) {\n          while (cursor.hasNext()) {\n              Document doc = cursor.next();\n              System.out.println(&quot;✅ Found: &quot; + doc.toJson());\n              expensesList.add(doc);\n          }\n      }\n\n      response.setStatus(HttpServletResponse.SC_OK);\n      out.println(gson.toJson(expensesList));\n\n  } catch (Exception e) {\n      response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);\n      out.println(gson.toJson(new ResponseMessage(&quot;❌ Error fetching expenses: &quot; + e.getMessage())));\n  }\n}\n\n</code></pre>\n<p>Here’s an example document from my MongoDB collection:</p>\n<pre class=\"lang-json prettyprint-override\"><code>{\n  &quot;_id&quot;: { &quot;$oid&quot;: &quot;someid&quot; },\n  &quot;user&quot;: &quot;chir&quot;,\n  &quot;category&quot;: &quot;education&quot;,\n  &quot;amount&quot;: 1000\n}\n</code></pre>\n<p>Despite this, the query returns all documents. I've printed the filter and it looks correct. I also tested similar queries in MongoDB Compass and they work there.</p>\n<p>I expected the <code>find()</code> function to return only the documents that match both the <code>user</code> and <code>category</code>.</p>\n<p>I tried:</p>\n<ul>\n<li>Verifying the database connection</li>\n<li>Printing the query object (<code>filter.toJson()</code>)</li>\n<li>Hardcoding the filter values</li>\n<li>Running the same query in MongoDB Compass (works fine there)</li>\n</ul>\n<p>Still, the query from Java returns all documents regardless of the filter.</p>\n<p>Is there something I'm missing in how the Java MongoDB driver processes filters in a servlet?\n<strong>Environment:</strong></p>\n<ul>\n<li>Java 23</li>\n<li>MongoDB Driver: <code>org.mongodb:mongodb-driver-sync:4.11.1</code></li>\n<li>Servlet running on Apache Tomcat/10.1.39 (2)</li>\n</ul>\n",
    "tags" : [ "java", "mongodb", "tomcat", "servlets", "mongodb-query" ],
    "owner" : {
      "account_id" : 41336027,
      "reputation" : 1,
      "user_id" : 30241516,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/7ec63362e407018f68cd4b7af427c533?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "CHIRSMITA THAKUR",
      "link" : "https://stackoverflow.com/users/30241516/chirsmita-thakur"
    },
    "is_answered" : false,
    "view_count" : 51,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1749479832,
    "creation_date" : 1744357233,
    "link" : "https://stackoverflow.com/questions/79568278/mongodb-java-driver-returns-all-documents-instead-of-matching-filter-in-java-ser",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79659042,
    "question_id" : 79568278,
    "body" : "<p>Your query logic is solid. I tested it end-to-end and it returns filtered results correctly.</p>\n<p>If you're still getting all documents back, check:</p>\n<ul>\n<li><p>That <code>expenseCollection</code> is correctly initialized</p>\n</li>\n<li><p>That your MongoDB field names are spelled exactly as in the documents (MongoDB is case-sensitive)</p>\n</li>\n<li><p>That you're not mixing up databases or environments</p>\n</li>\n</ul>\n<p>And especially: <strong>check the actual values of <code>user</code> and <code>category</code> at runtime</strong>.<br />\nIn my test, I hardcoded both values directly like this:</p>\n<pre><code>String user = &quot;chir&quot;;\nString category = &quot;education&quot;; \n</code></pre>\n<p>It worked as expected.<br />\nSo make sure that the values you're getting from:</p>\n<pre><code>String user = request.getParameter(&quot;username&quot;);\nString category = request.getParameter(&quot;category&quot;); \n</code></pre>\n<p>are actually correct and not null or empty — otherwise, the query will not behave as expected. Log them to be sure.</p>\n",
    "score" : -1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 6694952,
      "reputation" : 35,
      "user_id" : 5163234,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/XIRgXTEc.jpg?s=256",
      "display_name" : "Ricardo Mello",
      "link" : "https://stackoverflow.com/users/5163234/ricardo-mello"
    },
    "creation_date" : 1749479832,
    "last_activity_date" : 1749479832,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140325747,
    "post_id" : 79568278,
    "body" : "Check the example at <a href=\"https://www.mongodb.com/docs/drivers/java/sync/v4.3/fundamentals/crud/read-operations/retrieve/#example\" rel=\"nofollow noreferrer\">mongodb.com/docs/drivers/java/sync/v4.3/fundamentals/crud/&hellip;</a> and also <a href=\"https://www.mongodb.com/docs/drivers/java/sync/v4.3/fundamentals/builders/filters/#filters-builders\" rel=\"nofollow noreferrer\">mongodb.com/docs/drivers/java/sync/v4.3/fundamentals/builder&zwnj;&#8203;s/&hellip;</a>.  It looks like collection.find() expects   <code>Filter</code> object",
    "score" : 1,
    "owner" : {
      "account_id" : 2638471,
      "reputation" : 29001,
      "user_id" : 2282634,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/46c5a01e93856e53a2f16eec3267a9b2?s=256&d=identicon&r=PG",
      "display_name" : "Joe",
      "link" : "https://stackoverflow.com/users/2282634/joe"
    },
    "creation_date" : 1744394752,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}