{
  "question" : {
    "question_id" : 79790181,
    "title" : "Change the preview icons of the dragged files when the source is the OS file system or another application",
    "body" : "<h2>Intro</h2>\n<p>When dragging item(s) from another application into the <code>DnD</code> Node in <code>JavaFX</code> The operating system or the source application handles the visual display of the dragged item(s) since it is the source of the file(s) being dragged.</p>\n<p>This is the case with this app: the user has the ability to drag and drop specific categories of files, and these files are only accepted based on their extensions (<code>.png</code>, <code>.jpeg</code>, etc., for images).</p>\n<h2>The code</h2>\n<p>The interface <code>DragAndDropBehavior</code> has a single method <code>handleDroppedFiles(List&lt;File&gt; files)</code>, which will handle the files after they are dropped.</p>\n<pre><code>import java.io.File;\nimport java.util.List;\n\npublic interface DragAndDropBehavior {\n    void handleDroppedFiles(List&lt;File&gt; files);\n}\n</code></pre>\n<p>The <code>BaseDropController</code> class implements <code>DragAndDropBehavior</code>. Its method <code>hasAllowedExtension(File f, String... extensions)</code> returns true only if the file's extension matches one of the specified extensions. The <code>notifyError(String message)</code> method prints an <code>error message</code> if an issue occurs.</p>\n<pre><code>import java.io.File;\n\npublic abstract class BaseDropController implements DragAndDropBehavior {\n    protected boolean hasAllowedExtension(File f, String... extensions) {\n        var name = f.getName().toLowerCase();\n        for (var ext : extensions)\n            if (name.endsWith(ext))\n                return true;\n\n        return false;\n    }\n    protected void notifyError(String message) {\n        System.err.println(message);\n    }\n}\n</code></pre>\n<p>The <code>ImageDropController</code> extends the <code>BaseDropController</code>, thus implementing the <code>handleDroppedFiles(List&lt;File&gt; files)</code> method from the <code>DragAndDropBehavior</code> interface. <code>handleDroppedFiles</code> is simply a handler used when files are dropped.</p>\n<pre><code>import java.io.File;\nimport java.util.List;\n\npublic class ImageDropController extends BaseDropController {\n    @Override\n    public void handleDroppedFiles(List&lt;File&gt; files) {\n        var image = files.stream().filter(f -&gt; hasAllowedExtension(f, &quot;.png&quot;, &quot;.jpg&quot;, &quot;.jpeg&quot;, &quot;.webp&quot;)).findFirst();\n        image.ifPresentOrElse(\n                file -&gt; {\n                    System.out.println(&quot;Dropped file: &quot; + file.getAbsoluteFile());\n                },\n                () -&gt; notifyError(&quot;No image file found.&quot;)\n        );\n    }\n}\n</code></pre>\n<p>The <code>DragAndDropPane</code> extends <a href=\"https://openjfx.io/javadoc/25/javafx.graphics/javafx/scene/layout/StackPane.html\" rel=\"noreferrer\">StackPane</a>. It represents the area where file(s) should be dragged and dropped. <code>ObjectProperty&lt;Set&lt;String&gt;&gt; acceptedExtensions</code> and <code>ObjectProperty&lt;Consumer&lt;List&lt;File&gt;&gt;&gt; onFilesDropped</code> both specify the accepted extensions and the handler for the files when they are dropped. Both will be set by their respective setter based on the type of files that should be dragged and dropped.</p>\n<pre><code>import javafx.beans.property.*;\nimport javafx.geometry.Pos;\nimport javafx.scene.control.Label;\nimport javafx.scene.image.Image;\nimport javafx.scene.image.ImageView;\nimport javafx.scene.input.*;\nimport javafx.scene.layout.StackPane;\n\nimport java.io.File;\nimport java.util.List;\nimport java.util.Objects;\nimport java.util.Set;\nimport java.util.function.Consumer;\n\npublic final class DragAndDropPane extends StackPane {\n    private final ObjectProperty&lt;Set&lt;String&gt;&gt; acceptedExtensions = new SimpleObjectProperty&lt;&gt;();\n    private final ObjectProperty&lt;Consumer&lt;List&lt;File&gt;&gt;&gt; onFilesDropped = new SimpleObjectProperty&lt;&gt;();\n    private final BooleanProperty highlight = new SimpleBooleanProperty(false);\n\n    public DragAndDropPane() {\n        getStyleClass().add(&quot;drop-pane&quot;);\n\n        var label = new Label(&quot;Drop files here&quot;);\n        setAlignment(label, Pos.CENTER);\n        getChildren().add(label);\n\n        setOnDragOver(e -&gt; {\n            if (e.getGestureSource() != this &amp;&amp; e.getDragboard().hasFiles()) {\n                if (acceptsAny(e.getDragboard().getFiles())) {\n                    e.acceptTransferModes(TransferMode.MOVE);\n                    highlight.set(true);\n                }\n            }\n            e.consume();\n        });\n\n        setOnDragExited(e -&gt; {\n            highlight.set(false);\n            e.consume();\n        });\n\n        setOnDragDropped(e -&gt; {\n            var dragBoard = e.getDragboard();\n            boolean success = false;\n            if (dragBoard.hasFiles() &amp;&amp; acceptsAny(dragBoard.getFiles())) {\n                var handler = getOnFilesDropped();\n                if (handler != null)\n                    handler.accept(dragBoard.getFiles());\n                success = true;\n            }\n            e.setDropCompleted(success);\n            e.consume();\n        });\n\n        highlight.addListener((_, _, hi) -&gt;\n                pseudoClassStateChanged(javafx.css.PseudoClass.getPseudoClass(&quot;active&quot;), hi));\n    }\n\n    private boolean acceptsAny(List&lt;File&gt; files) {\n        var extensions = getAcceptedExtensions();\n        if (extensions == null || extensions.isEmpty())\n            return true;\n        return files.stream().anyMatch(file -&gt;\n                extensions.stream().anyMatch(extension -&gt; file.getName().toLowerCase().endsWith(extension.toLowerCase()))\n        );\n    }\n\n    public void setAcceptedExtensions(Set&lt;String&gt; extensions) {\n        acceptedExtensions.set(extensions);\n    }\n\n    public void setOnFilesDropped(Consumer&lt;List&lt;File&gt;&gt; c) {\n        onFilesDropped.set(c);\n    }\n\n    public Set&lt;String&gt; getAcceptedExtensions() {\n        return acceptedExtensions.get();\n    }\n\n    public ObjectProperty&lt;Set&lt;String&gt;&gt; acceptedExtensionsProperty() {\n        return acceptedExtensions;\n    }\n\n    public Consumer&lt;List&lt;File&gt;&gt; getOnFilesDropped() {\n        return onFilesDropped.get();\n    }\n\n    public ObjectProperty&lt;Consumer&lt;List&lt;File&gt;&gt;&gt; onFilesDroppedProperty() {\n        return onFilesDropped;\n    }\n}\n</code></pre>\n<p>The <code>ImageDropView</code> simply contains the draggable area and the preview section for dropped files. It loads the appropriate <code>FXML</code> file (<code>ImageDropView</code> in this case) and binds the elements to its fields. It then uses the <code>ImageDropController</code> to set the handler when files are dropped to the <code>DragAndDropPane</code> with <code>drop.setOnFilesDropped(controller::handleDroppedFiles)</code>.</p>\n<pre><code>import javafx.fxml.FXML;\nimport javafx.fxml.FXMLLoader;\nimport javafx.scene.Parent;\nimport javafx.scene.layout.StackPane;\n\nimport java.io.IOException;\nimport java.util.Set;\n\npublic final class ImageDropView {\n    private final Parent root;\n    @FXML\n    private DragAndDropPane drop;\n    @FXML\n    private StackPane preview;\n\n    private final ImageDropController controller = new ImageDropController();\n\n    public ImageDropView() {\n        try {\n            var loader = new FXMLLoader(getClass().getResource(&quot;ImageDropView.fxml&quot;));\n            loader.setController(this);\n            this.root = loader.load();\n        } catch (IOException e) {\n            throw new RuntimeException(e);\n        }\n        drop.setAcceptedExtensions(Set.of(&quot;.png&quot;, &quot;.jpg&quot;, &quot;.jpeg&quot;, &quot;.webp&quot;));\n        drop.setOnFilesDropped(controller::handleDroppedFiles);\n    }\n\n    public Parent getRoot() {\n        return root;\n    }\n}\n</code></pre>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n\n&lt;?import javafx.scene.control.*?&gt;\n&lt;?import javafx.scene.layout.*?&gt;\n\n&lt;?import test.DragAndDropPane?&gt;\n&lt;VBox spacing=&quot;16&quot; xmlns=&quot;http://javafx.com/javafx&quot; xmlns:fx=&quot;http://javafx.com/fxml&quot;&gt;\n    &lt;Label text=&quot;Import Image&quot;/&gt;\n    &lt;DragAndDropPane fx:id=&quot;drop&quot; prefHeight=&quot;150&quot; style=&quot;-fx-background-color: #55ff00;&quot;/&gt;\n    &lt;StackPane fx:id=&quot;preview&quot; prefHeight=&quot;300&quot; style=&quot;-fx-background-color: #00dfff; -fx-background-radius: 8;&quot;/&gt;\n&lt;/VBox&gt;\n</code></pre>\n<p>The <code>DropViewFactory</code> class creates and returns the root element of the specified <code>MediaType</code>.</p>\n<pre><code>import javafx.scene.Parent;\n\npublic final class DropViewFactory {\n    public static Parent create(MediaType type) {\n        return switch (type) {\n            case IMAGE -&gt; new ImageDropView().getRoot();\n            case VIDEO -&gt; new VideoDropView().getRoot();\n        };\n    }\n}\n</code></pre>\n<pre><code>public enum MediaType {IMAGE, VIDEO}\n</code></pre>\n<p>These are the <code>Main Controller</code> and the <code>Main</code> classes respectively</p>\n<pre><code>import javafx.fxml.FXML;\nimport javafx.scene.Scene;\nimport javafx.scene.layout.BorderPane;\nimport javafx.stage.Modality;\nimport javafx.stage.Stage;\n\npublic class MainController {\n    @FXML\n    private BorderPane root;\n\n    public void openImageDialog() {\n        open(MediaType.IMAGE, &quot;Import Image&quot;);\n    }\n\n    public void openVideoDialog() {\n        open(MediaType.VIDEO, &quot;Import Video&quot;);\n    }\n\n    private void open(MediaType type, String title) {\n        var stage = new Stage();\n        stage.setTitle(title);\n        stage.initModality(Modality.APPLICATION_MODAL);\n        stage.setScene(new Scene(DropViewFactory.create(type), 900, 600));\n        stage.show();\n    }\n}\n</code></pre>\n<pre><code>import javafx.application.Application;\nimport javafx.stage.Stage;\nimport test.MainController;\n\npublic class Main extends Application {\n    @Override\n    public void start(Stage primaryStage) {\n        MainController mainController = new MainController();\n        mainController.openImageDialog();\n    }\n}\n</code></pre>\n<h2>What I want to do</h2>\n<p>When the file(s) are dragged onto the <code>DragAndDropPane</code>, the system sets the icon of the file(s). For example, if four files are dragged, the system will display the form with reduced opacity. I want to replace the icons with a single icon that displays the number of elements being dragged at the bottom-right corner.</p>\n<p>In those two similar questions (<a href=\"https://stackoverflow.com/questions/71732537/is-it-possible-to-change-the-white-file-icon-that-appears-when-dragging-a-node-w\">post1</a>, <a href=\"https://stackoverflow.com/questions/79679350/why-does-dragboardsetdragview-shrink-my-image-and-how-can-i-control-its-size\">post2</a>), both want the same thing, but both have a draggable element coming from within the JavaFX application. Also, in the <a href=\"https://openjfx.io/javadoc/25/javafx.graphics/javafx/scene/input/Dragboard.html#setDragView%28javafx.scene.image.Image%29\" rel=\"noreferrer\">setDragView</a> docs, it works only if the element's source is coming from the app.</p>\n",
    "tags" : [ "java", "javafx", "drag-and-drop" ],
    "owner" : {
      "account_id" : 12506291,
      "reputation" : 811,
      "user_id" : 9103039,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/TqlDK.jpg?s=256",
      "display_name" : "Starnec",
      "link" : "https://stackoverflow.com/users/9103039/starnec"
    },
    "is_answered" : true,
    "view_count" : 193,
    "answer_count" : 1,
    "score" : 5,
    "last_activity_date" : 1760701632,
    "creation_date" : 1760446079,
    "link" : "https://stackoverflow.com/questions/79790181/change-the-preview-icons-of-the-dragged-files-when-the-source-is-the-os-file-sys",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79793029,
    "question_id" : 79790181,
    "body" : "<p>There's no JavaFX API, public or private, that does what you want. This leaves two options:</p>\n<ol>\n<li><p>Try to drop down into native code to implement what you want.</p>\n</li>\n<li><p>Forgo this design goal and just update the JavaFX UI as appropriate to give the indicators you want.</p>\n</li>\n</ol>\n<p>Trying to go with option one appears to be non-trivial in this case. Not least because you'd have to find the unique way to do this on each platform supported by JavaFX if you want consistent behavior, then maintain the various platform-specific implementations. And that's assuming this is even possible on each platform.</p>\n<p>The general trend across operating systems seems to be that the drag image is &quot;owned&quot; by the <em>source</em> application, not the <em>target</em> application. Windows does offer <code>IDropTargetHelper::Show</code>, but note that method only controls whether the drag image is <em>shown</em>. It doesn't give the target application the ability to directly replace the drag image. On Linux, JavaFX relies on GTK (currently version 3, if I'm not mistaken). As far as I can tell, GTK doesn't even offer a way to hide the drag image from the target application, let alone let the target application use its own drag image. MacOS doesn't appear to be any different in this regard.</p>\n<p>So, only Windows offers something close to what you want (in a supported way, at least). But there's still a few potential problems.</p>\n<ul>\n<li><p>An <code>IDropTarget</code> is associated with an <em>entire window</em>, not just specific &quot;widgets&quot; in the window. Therefore you'd either need to add a way to optionally hide the drag image based on the JavaFX <code>Node</code> receiving the DnD events (and/or other conditions), or you'd need to accept hiding the drag image for all DnD events for a given window.</p>\n</li>\n<li><p>There's no supported way to query an existing <code>IDropTarget[Helper]</code> associated with a window. Meaning there's no way to try and to intercept calls while still relying on the existing behavior.</p>\n</li>\n<li><p>The changes to DnD drag image behavior would only be on Windows.</p>\n</li>\n</ul>\n<p>If you're okay with all that then see <a href=\"https://github.com/openjdk/jfx/blob/master/modules/javafx.graphics/src/main/native-glass/win/GlassDnD.cpp\" rel=\"nofollow noreferrer\">GlassDnD.cpp</a> for how JavaFX currently implements DnD on Windows. The easiest solution would probably be to fork JavaFX and insert:</p>\n<pre class=\"lang-cpp prettyprint-override\"><code>m_spDropTargetHelper-&gt;Show(false);\n</code></pre>\n<p>Where appropriate. Of course, now you have to maintain and ship your own fork of JavaFX. You could instead try to implement your own version of <code>IDropTarget</code> based on <code>GlassDropTarget</code>, then register your implementation with a window to replace the one registered by JavaFX. I don't know how easy/hard that would be, assuming it'd even be possible (properly interfacing with the Java side of JavaFX might rely on non-exported native code, not sure).</p>\n<hr />\n<p>This is really all to say that I personally think you should go with option two: <em>Forgo this design goal</em>. Trying to hide the drag image seems to be way more effort than it's worth. Just have the JavaFX UI update accordingly to display the indicators you want.</p>\n<p>Here's a small <em>proof-of-concept</em> that simply indicates whether the drop is accepted or rejected and, if it's accepted, how many files will be dropped. It simply puts the files into a <code>ListView</code> and accepts any files (i.e., it doesn't load images and doesn't filter for image files).</p>\n<pre class=\"lang-java prettyprint-override\"><code>import java.io.File;\nimport javafx.application.Application;\nimport javafx.beans.binding.Bindings;\nimport javafx.beans.property.IntegerProperty;\nimport javafx.beans.property.ObjectProperty;\nimport javafx.beans.property.SimpleIntegerProperty;\nimport javafx.beans.property.SimpleObjectProperty;\nimport javafx.scene.Scene;\nimport javafx.scene.control.Label;\nimport javafx.scene.control.ListView;\nimport javafx.scene.input.DragEvent;\nimport javafx.scene.input.TransferMode;\nimport javafx.scene.layout.Background;\nimport javafx.scene.layout.StackPane;\nimport javafx.scene.paint.Color;\nimport javafx.scene.text.Font;\nimport javafx.scene.text.FontWeight;\nimport javafx.stage.Stage;\n\npublic class App extends Application {\n\n  private final ObjectProperty&lt;DragState&gt; dragState = new SimpleObjectProperty&lt;&gt;(DragState.NONE);\n  private final IntegerProperty dragFileCount = new SimpleIntegerProperty();\n\n  private ListView&lt;File&gt; fileListView;\n\n  @Override\n  public void start(Stage primaryStage) {\n    fileListView = new ListView&lt;File&gt;();\n\n    var dndLabel = new Label();\n    dndLabel.setFont(Font.font(&quot;System&quot;, FontWeight.BOLD, 16));\n    dndLabel\n        .textProperty()\n        .bind(Bindings.when(dragState.isEqualTo(DragState.ACCEPT))\n            .then(dragFileCount.asString(&quot;Drop %,d files...&quot;))\n            .otherwise(&quot;Can only drop files!&quot;));\n\n    var dndOverlay = new StackPane(dndLabel);\n    dndOverlay.setMouseTransparent(true);\n    dndOverlay.visibleProperty().bind(dragState.isNotEqualTo(DragState.NONE));\n    dndOverlay\n        .backgroundProperty()\n        .bind(Bindings.when(dragState.isEqualTo(DragState.ACCEPT))\n            .then(Background.fill(Color.SEAGREEN))\n            .otherwise(Background.fill(Color.CRIMSON)));\n\n    var container = new StackPane(fileListView, dndOverlay);\n    container.setOnDragEntered(this::handleDragEntered);\n    container.setOnDragExited(this::handleDragExited);\n    container.setOnDragOver(this::handleDragOver);\n    container.setOnDragDropped(this::handleDragDropped);\n\n    primaryStage.setScene(new Scene(container, 600, 400));\n    primaryStage.show();\n  }\n\n  private void handleDragEntered(DragEvent e) {\n    if (e.getDragboard().hasFiles()) {\n      dragState.set(DragState.ACCEPT);\n      dragFileCount.set(e.getDragboard().getFiles().size());\n    } else {\n      dragState.set(DragState.REJECT);\n      dragFileCount.set(0);\n    }\n  }\n\n  private void handleDragExited(DragEvent e) {\n    e.consume();\n    dragState.set(DragState.NONE);\n    dragFileCount.set(0);\n  }\n\n  private void handleDragOver(DragEvent e) {\n    e.consume();\n    if (e.getDragboard().hasFiles()) {\n      e.acceptTransferModes(TransferMode.LINK);\n    }\n  }\n\n  private void handleDragDropped(DragEvent e) {\n    e.consume();\n    if (e.isAccepted()) {\n      fileListView.getItems().setAll(e.getDragboard().getFiles());\n      e.setDropCompleted(true);\n    }\n    dragState.set(DragState.NONE);\n    dragFileCount.set(0);\n  }\n\n  private enum DragState {\n    NONE,\n    ACCEPT,\n    REJECT\n  }\n}\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 8532578,
      "reputation" : 49884,
      "user_id" : 6395627,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Slaw",
      "link" : "https://stackoverflow.com/users/6395627/slaw"
    },
    "creation_date" : 1760701632,
    "last_activity_date" : 1760701632,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140796650,
    "post_id" : 79790181,
    "body" : "Thanks to both @James_D and @Slaw. After some searching, I discovered that the interface <a href=\"https://learn.microsoft.com/en-us/windows/win32/api/shobjidl_core/nn-shobjidl_core-idroptargethelper\" rel=\"nofollow noreferrer\">IDropTargetHelper</a> is responsible for the functionality in Windows OS: <b>&quot;Exposes methods that allow drop targets to display a drag image while the image is over the target window.&quot;</b> I was wondering if it is possible to use <code>IDropTargetHelper::Show</code> to hide the preview icons and display a custom one, positioning it to follow the cursor.",
    "score" : 0,
    "owner" : {
      "account_id" : 12506291,
      "reputation" : 811,
      "user_id" : 9103039,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/TqlDK.jpg?s=256",
      "display_name" : "Starnec",
      "link" : "https://stackoverflow.com/users/9103039/starnec"
    },
    "creation_date" : 1760519576,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140796186,
    "post_id" : 79790181,
    "body" : "Side note: Consider using <a href=\"https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/nio/file/Files.html#probeContentType(java.nio.file.Path)\" rel=\"nofollow noreferrer\"><code>Files::probeContentType(Path)</code></a>. That should provide more flexibility. It will use a system-dependent way to probe the content type by default. For instance, on Windows that seems to be looking up the extension in the Windows registry (at least for Java 25). But you can add implementations of <code>FileTypeDetector</code> for custom handling (e.g., one that does what you&#39;re currently doing, or one that checks for an image file signature, etc.).",
    "score" : 1,
    "owner" : {
      "account_id" : 8532578,
      "reputation" : 49884,
      "user_id" : 6395627,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/af0f9bfe593f36642a032cd7ea611e7d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Slaw",
      "link" : "https://stackoverflow.com/users/6395627/slaw"
    },
    "creation_date" : 1760498016,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140794940,
    "post_id" : 79790181,
    "body" : "This probably can&#39;t be done. As stated in the docs you linked, you have to set the drag view in the handler for the drag detected event and doing so elsewhere will have no effect (a quick test indicates this is the case in practice). Since in this scenario the drag detected event is effectively handled by the native OS and JavaFX libraries, there is no way to hook into that event. None of the properties of the dragboard are observable, so there&#39;s no mechanism to detect when those change. So I don&#39;t see any way to change the drag view in this case.",
    "score" : 1,
    "owner" : {
      "account_id" : 2518243,
      "reputation" : 210906,
      "user_id" : 2189127,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
      "display_name" : "James_D",
      "link" : "https://stackoverflow.com/users/2189127/james-d"
    },
    "creation_date" : 1760448756,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}