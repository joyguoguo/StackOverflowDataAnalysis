{
  "question" : {
    "question_id" : 79759114,
    "title" : "Autowire multiple beans into a Map",
    "body" : "<p>I’m working on a Spring Boot application where I have multiple implementations of a service interface, and I want to automatically wire them into a <code>Map</code> keyed by an enum type.</p>\n<p>Specifically, I have a <code>PaymentService</code> interface with different implementations for different payment types:</p>\n<pre><code>public interface PaymentService {\n    void processPayment();\n}\n</code></pre>\n<pre><code>@Slf4j\n@Service\n@PaymentHandler(PaymentType.CREDIT_CARD)\npublic class CreditCardPaymentService implements PaymentService {\n\n    @Override\n    public void processPayment() {\n        log.info(&quot;CreditCardPaymentService processPayment&quot;);\n    }\n}\n</code></pre>\n<pre><code>@Slf4j\n@Service\n@PaymentHandler(PaymentType.VENMO)\npublic class VenmoPaymentService implements PaymentService {\n\n    @Override\n    public void processPayment() {\n        log.info(&quot;VenmoPaymentService processPayment&quot;);\n    }\n}\n</code></pre>\n<pre><code>public enum PaymentType {\n    CREDIT_CARD, VENMO\n}\n</code></pre>\n<pre><code>@Target(ElementType.TYPE)\n@Retention(RetentionPolicy.RUNTIME)\n@Component\npublic @interface PaymentHandler {\n    PaymentType value();\n}\n</code></pre>\n<p>Currently, I’m manually creating a <code>Map&lt;PaymentType, PaymentService&gt;</code> in a configuration class using the <code>ApplicationContext</code>:</p>\n<pre><code>@Configuration\npublic class PaymentConfiguration {\n\n    @Bean\n    public Map&lt;PaymentType, PaymentService&gt; paymentServicesMap(final ApplicationContext applicationContext) {\n        return applicationContext.getBeansOfType(PaymentService.class).values().stream()\n                .flatMap(service -&gt;\n                        Optional.ofNullable(service.getClass().getAnnotation(PaymentHandler.class))\n                                .map(annotation -&gt; Map.entry(annotation.value(), service))\n                                .stream())\n                .collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue));\n    }\n}\n</code></pre>\n<pre><code>@Component\n@RequiredArgsConstructor\npublic class MyStartupRunner implements CommandLineRunner {\n    private final Map&lt;PaymentType, PaymentService&gt; paymentServices;\n\n    @Override\n    public void run(String... args) {\n        paymentServices.forEach((paymentType, paymentService) -&gt; paymentService.processPayment());\n    }\n}\n</code></pre>\n<p>This approach works, but it feels verbose and manual. I’d like to leverage Spring’s <code>@Qualifier</code> or some other feature to avoid having to define the <code>Map</code> bean explicitly. Ideally, I want Spring to automatically inject a <code>Map&lt;PaymentType, PaymentService&gt;</code> without additional boilerplate.</p>\n<p>I’ve tried approaches like using <code>@Qualifier</code> on individual beans, but it doesn’t seem to work cleanly when mapping multiple implementations to enum keys.</p>\n<p>My question:</p>\n<ul>\n<li>Is there a Spring feature or pattern that allows me to autowire a <code>Map&lt;Enum, Service&gt;</code> automatically?</li>\n<li>Can I avoid manually building the map in a <code>@Bean</code> method?</li>\n<li>Are there best practices for wiring multiple service implementations in this way?</li>\n</ul>\n<p>Any guidance or example implementations would be highly appreciated.</p>\n",
    "tags" : [ "java", "spring", "spring-bean" ],
    "owner" : {
      "account_id" : 25486283,
      "reputation" : 69,
      "user_id" : 19281826,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/034f6a6f92e9a4df635aa6f94972b926?s=256&d=identicon&r=PG",
      "display_name" : "yaroslav96",
      "link" : "https://stackoverflow.com/users/19281826/yaroslav96"
    },
    "is_answered" : true,
    "view_count" : 132,
    "answer_count" : 2,
    "score" : 2,
    "last_activity_date" : 1757396330,
    "creation_date" : 1757346802,
    "link" : "https://stackoverflow.com/questions/79759114/autowire-multiple-beans-into-a-map",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79759189,
    "question_id" : 79759114,
    "body" : "<p>You are basically asking multiple questions in a single question.</p>\n<ul>\n<li>Is there a Spring feature or pattern that allows me to autowire a Map&lt;Enum, Service&gt; automatically?</li>\n</ul>\n<p>No there isn't. Although you could improve on your <code>@Bean</code> method by injecting a <code>List&lt;PaymentProvider&gt;</code> and expose it as a <code>Map&lt;Enum, PaymentProvider&gt;</code>. But that is all the Spring can do for you.</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Bean\npublic Map&lt;PaymentType, PaymentService&gt; paymentServicesMap(List&lt;PaymentService&gt; services) {\n  var servicesMap = new HashMap&lt;PaymentType, PaymentService&gt;();\n  for (var service : services) {\n    var annot = AnnotationUtil.getAnnotation(PaymentType.class, service.getClass());\n    servicesMap.put(annot, service);\n  }\n  return servicesMap;\n}\n</code></pre>\n<ul>\n<li>Can I avoid manually building the map in an <code>@Bean</code> method?</li>\n</ul>\n<p>No. Spring by default can inject a <code>Collection&lt;Some-Type-Here&gt;</code> or a <code>Map&lt;String, Some-Type-Here&gt;</code>, where the collection will contain all beans of that type and the map will contain the name and the service.</p>\n<ul>\n<li>Are there best practices for wiring multiple service implementations in this way?</li>\n</ul>\n<p>As mentioned above only for collections and a specific type of map.</p>\n",
    "score" : 5,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126800,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1757352361,
    "last_activity_date" : 1757396330,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79759134,
    "question_id" : 79759114,
    "body" : "<p>Consider adding a method to the <code>PaymentService</code>:</p>\n<pre><code>PaymentType getPaymentType();\n</code></pre>\n<p>Multiple implementations will be available as an injectable <code>List&lt;PaymentService&gt;</code>.  So the configuration can then be simplified to:</p>\n<pre><code>@Configuration\npublic class PaymentConfiguration {\n\n    @Bean\n    public Map&lt;PaymentType, PaymentService&gt; getPaymentServices(final List&lt;PaymentService&gt; paymentServices) { // or AbstractPaymentService\n        return paymentServices.stream()\n           .collect(Collectors.toMap(PaymentService::getPaymentType, Function.identity()));\n}\n</code></pre>\n<p>}</p>\n<p>where a <code>PaymentService</code> implementation is managing itself.</p>\n<p>Having a <code>public getPaymentType()</code> might be a little awkward, so there could be an <code>AbstractPaymentService</code> with an <code>abstract public getPaymentType()</code> as the base class for each implementation.  <s>But this would require the configuration to be in the same package as the abstract class.</s></p>\n",
    "score" : 4,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 8909811,
      "reputation" : 2861,
      "user_id" : 6650475,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/fe85994d05ad7aaaa1c47d638b37bc45?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Andrew S",
      "link" : "https://stackoverflow.com/users/6650475/andrew-s"
    },
    "creation_date" : 1757348347,
    "last_activity_date" : 1757349453,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140722945,
    "post_id" : 79759114,
    "body" : "About your last question on best practices, the answer of @Andrew S makes more sense since it uses an interface method instead of annotations - at least that way you won’t forget to assign the payment type to the service, and you won’t have to deal with reflection in the configuration",
    "score" : 0,
    "owner" : {
      "account_id" : 18586978,
      "reputation" : 3850,
      "user_id" : 15000097,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/yFl4M.jpg?s=256",
      "display_name" : "Georgii Lvov",
      "link" : "https://stackoverflow.com/users/15000097/georgii-lvov"
    },
    "creation_date" : 1757363425,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140722622,
    "post_id" : 79759114,
    "body" : "That&#39;s three questions instead of one. Try to focus into one question per <a href=\"https://stackoverflow.com\">Stack Overflow</a> question. Also asking for general best practices is not specific, hence is off topic here.",
    "score" : 1,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1757352758,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140722563,
    "post_id" : 79759114,
    "body" : "1. NO (well instead of <code>ApplicationContext</code> you could do a <code>List&lt; PaymentService&gt;</code> instead of manual lookup) , 2. No, 3 no. Not the answer you want but the answer you get. Spring by default can inject a list of dependencies or a <code>Map&lt;String, Interface&gt;</code> but that is it.",
    "score" : 0,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126800,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1757351040,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79759134" : [ {
      "comment_id" : 140722942,
      "post_id" : 79759134,
      "body" : "What&#39;s the difference between forcing a method and forcing an annotation?",
      "score" : 1,
      "owner" : {
        "account_id" : 1888781,
        "reputation" : 2498,
        "user_id" : 1707427,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/4d1a2608ee35e2df7d2400a02e62bb20?s=256&d=identicon&r=PG",
        "display_name" : "S&#246;ren",
        "link" : "https://stackoverflow.com/users/1707427/s%c3%b6ren"
      },
      "creation_date" : 1757363237,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140722539,
      "post_id" : 79759134,
      "body" : "forcing getPaymentType() implementation",
      "score" : 0,
      "owner" : {
        "account_id" : 25486283,
        "reputation" : 69,
        "user_id" : 19281826,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/034f6a6f92e9a4df635aa6f94972b926?s=256&d=identicon&r=PG",
        "display_name" : "yaroslav96",
        "link" : "https://stackoverflow.com/users/19281826/yaroslav96"
      },
      "creation_date" : 1757350395,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140722528,
      "post_id" : 79759134,
      "body" : "What behavior needs to be prevented?",
      "score" : 0,
      "owner" : {
        "account_id" : 8909811,
        "reputation" : 2861,
        "user_id" : 6650475,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/fe85994d05ad7aaaa1c47d638b37bc45?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Andrew S",
        "link" : "https://stackoverflow.com/users/6650475/andrew-s"
      },
      "creation_date" : 1757349981,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140722501,
      "post_id" : 79759134,
      "body" : "This is the behavior I want to prevent by using annotations",
      "score" : 0,
      "owner" : {
        "account_id" : 25486283,
        "reputation" : 69,
        "user_id" : 19281826,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/034f6a6f92e9a4df635aa6f94972b926?s=256&d=identicon&r=PG",
        "display_name" : "yaroslav96",
        "link" : "https://stackoverflow.com/users/19281826/yaroslav96"
      },
      "creation_date" : 1757349058,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}