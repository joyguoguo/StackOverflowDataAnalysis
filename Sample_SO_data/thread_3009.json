{
  "question" : {
    "question_id" : 79578481,
    "title" : "Replicating the deferred body handler of java http client in curl",
    "body" : "<p>I have this Java code. It sends a http request to the server and based on certain conditions, and it reads the streaming response body.</p>\n<pre class=\"lang-java prettyprint-override\"><code>import java.io.InputStream;\nimport java.net.URI;\nimport java.net.http.HttpClient;\nimport java.net.http.HttpRequest;\nimport java.net.http.HttpResponse;\nimport java.nio.charset.StandardCharsets;\nimport java.util.Random;\n\npublic class StreamHttpResponseBodyApp {\n\n    private static final Random RANDOM = new Random();\n    public static void main(String[] args) throws Exception {\n\n        HttpClient client = HttpClient.newHttpClient();\n        HttpRequest request = HttpRequest.newBuilder()\n                .uri(URI.create(&quot;http://httpbin.org/json?x-abc=1234&quot;))\n                .build();\n        HttpResponse&lt;InputStream&gt; response = client.send(request,\n                HttpResponse.BodyHandlers.ofInputStream());\n        System.out.println(response.headers());\n        if (response.statusCode() == 200 &amp;&amp; RANDOM.nextBoolean()) {\n            String text = new String(response.body().readAllBytes(), StandardCharsets.UTF_8);\n            System.out.println(text);\n        }\n    }\n}\n</code></pre>\n<p>I would like to replicate the same behavior in curl for automating a task in bash script.</p>\n<p>What I did so far is this:</p>\n<pre class=\"lang-bash prettyprint-override\"><code>$ URL=http://httpbin.org/json?x-abc=1234\n\n$ response=$(curl -si -w --verbose --location $URL)\n\n$ echo $response\nHTTP/1.1 200 OK\nDate: Thu, 17 Apr 2025 04:21:00 GMT\nContent-Type: application/json\nContent-Length: 429\nConnection: keep-alive\nServer: gunicorn/19.9.0\nAccess-Control-Allow-Origin: *\nAccess-Control-Allow-Credentials: true\n\n{\n  &quot;slideshow&quot;: {\n    &quot;author&quot;: &quot;Yours Truly&quot;,\n    &quot;date&quot;: &quot;date of publication&quot;,\n    &quot;slides&quot;: [\n      {\n        &quot;title&quot;: &quot;Wake up to WonderWidgets!&quot;,\n        &quot;type&quot;: &quot;all&quot;\n      },\n      {\n        &quot;items&quot;: [\n          &quot;Why &lt;em&gt;WonderWidgets&lt;/em&gt; are great&quot;,\n          &quot;Who &lt;em&gt;buys&lt;/em&gt; WonderWidgets&quot;\n        ],\n        &quot;title&quot;: &quot;Overview&quot;,\n        &quot;type&quot;: &quot;all&quot;\n      }\n    ],\n    &quot;title&quot;: &quot;Sample Slide Show&quot;\n  }\n}\n</code></pre>\n<p>As you can see this always reads the response payload immediately.\nI don't know how can I check the condition and then read the response body?</p>\n",
    "tags" : [ "java", "curl" ],
    "owner" : {
      "account_id" : 2994486,
      "reputation" : 10565,
      "user_id" : 2541276,
      "user_type" : "registered",
      "accept_rate" : 55,
      "profile_image" : "https://graph.facebook.com/100001587714573/picture?type=large",
      "display_name" : "user51",
      "link" : "https://stackoverflow.com/users/2541276/user51"
    },
    "is_answered" : false,
    "view_count" : 35,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1744865456,
    "creation_date" : 1744864270,
    "link" : "https://stackoverflow.com/questions/79578481/replicating-the-deferred-body-handler-of-java-http-client-in-curl",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140368523,
    "post_id" : 79578481,
    "body" : "<i>&quot;As you can see this always reads the response payload immediately&quot;</i> - and that is a <i>problem</i>, because ...?",
    "score" : 0,
    "owner" : {
      "account_id" : 1530592,
      "reputation" : 97739,
      "user_id" : 1427878,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f6bd890954a792dbee22792c2402f13a?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "C3roe",
      "link" : "https://stackoverflow.com/users/1427878/c3roe"
    },
    "creation_date" : 1745574248,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}