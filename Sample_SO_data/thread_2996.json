{
  "question" : {
    "question_id" : 79579480,
    "title" : "Jenkins steps.load can&#39;t parse a script",
    "body" : "<p>I'm using a Jenkins shared library (stored on git) that has a <code>vars/loader.groovy</code> defined as:</p>\n<pre><code>void load(String libName, String path) {\n   setVariableInGlobalBinding(libName, steps.load(path)\n}\n\nprivate void setVariableInGlobalBinding(final String name, final Object value) {\n    CpsThread.current().execution.shell.context.setVariable(name, value)\n}\n</code></pre>\n<p>In my pipeline, I'm importing the common.groovy script as follows:</p>\n<pre><code>loader.load('common', 'common.groovy')\n\nfinal String FOO = common.FOO\n</code></pre>\n<p>which should load the <code>common</code> variable into the global context. However, when the <code>steps.load</code> function is called in the <code>load</code> function, this error is thrown:</p>\n<pre><code>groovy.lang.MissingPropertyException: No such property: common for class: groovy.lang.Binding\n    at groovy.lang.Binding.getVariable(Binding.java:63)\n    at PluginClassLoader for script-security//org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SandboxInterceptor.onGetProperty(SandboxInterceptor.java:285)\n    at PluginClassLoader for script-security//org.kohsuke.groovy.sandbox.impl.Checker$7.call(Checker.java:375)\n    at PluginClassLoader for script-security//org.kohsuke.groovy.sandbox.impl.Checker.checkedGetProperty(Checker.java:379)\n    at org.kohsuke.groovy.sandbox.impl.Checker$checkedGetProperty$1.callStatic(Unknown Source)\n    at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCallStatic(CallSiteArray.java:55)\n    at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callStatic(AbstractCallSite.java:197)\n    at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callStatic(AbstractCallSite.java:233)\n    at Script3.&lt;init&gt;(Script3.groovy:6)\n    at Script3.&lt;init&gt;(Script3.groovy)\n    at java.base/jdk.internal.reflect.DirectConstructorHandleAccessor.newInstance(DirectConstructorHandleAccessor.java:62)\n    at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:502)\n    at java.base/java.lang.reflect.ReflectAccess.newInstance(ReflectAccess.java:128)\n    at java.base/jdk.internal.reflect.ReflectionFactory.newInstance(ReflectionFactory.java:304)\n    at java.base/java.lang.Class.newInstance(Class.java:725)\n    at org.codehaus.groovy.runtime.InvokerHelper.newScript(InvokerHelper.java:490)\n    at PluginClassLoader for script-security//org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.GroovySandbox.checkedCreateScript(GroovySandbox.java:211)\n    at PluginClassLoader for script-security//org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.GroovySandbox$Scope.parse(GroovySandbox.java:164)\n    at PluginClassLoader for workflow-cps//org.jenkinsci.plugins.workflow.cps.CpsGroovyShell.doParse(CpsGroovyShell.java:190)\n    at PluginClassLoader for workflow-cps//org.jenkinsci.plugins.workflow.cps.CpsGroovyShell.parse(CpsGroovyShell.java:161)\n    at groovy.lang.GroovyShell.parse(GroovyShell.java:725)\n    at groovy.lang.GroovyShell.parse(GroovyShell.java:716)\n    at PluginClassLoader for workflow-cps//org.jenkinsci.plugins.workflow.cps.steps.LoadStepExecution.start(LoadStepExecution.java:49)\n    at PluginClassLoader for workflow-cps//org.jenkinsci.plugins.workflow.cps.DSL.invokeStep(DSL.java:323)\n    at PluginClassLoader for workflow-cps//org.jenkinsci.plugins.workflow.cps.DSL.invokeMethod(DSL.java:196)\n    at org.codehaus.groovy.runtime.callsite.PogoMetaClassSite.call(PogoMetaClassSite.java:47)\n    at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCall(CallSiteArray.java:47)\n    at org.codehaus.groovy.runtime.callsite.AbstractCallSite.call(AbstractCallSite.java:116)\n    at PluginClassLoader for workflow-cps//com.cloudbees.groovy.cps.sandbox.DefaultInvoker.methodCall(DefaultInvoker.java:20)\n    at PluginClassLoader for workflow-cps//org.jenkinsci.plugins.workflow.cps.LoggingInvoker.methodCall(LoggingInvoker.java:117)\n    at loader.load(loader.groovy:128)\n    at com.cloudbees.groovy.cps.CpsDefaultGroovyMethods.callClosureForMapEntry(CpsDefaultGroovyMethods:5361)\n    at com.cloudbees.groovy.cps.CpsDefaultGroovyMethods.each(CpsDefaultGroovyMethods:2202)\n    at loader.load(loader.groovy:107)\n    at ___cps.transform___(Native Method)\n    at PluginClassLoader for workflow-cps//com.cloudbees.groovy.cps.impl.ContinuationGroup.methodCall(ContinuationGroup.java:90)\n    at PluginClassLoader for workflow-cps//com.cloudbees.groovy.cps.impl.FunctionCallBlock$ContinuationImpl.dispatchOrArg(FunctionCallBlock.java:116)\n</code></pre>\n<p>To verify that the <code>load</code> function is doing what I expect, this is what the global context looks like prior to running the <code>steps.load</code> step:</p>\n<pre><code>{steps=org.jenkinsci.plugins.workflow.cps.DSL@10a38021, PIPELINES_BRANCH_NAME=my-branch-name, loader=loader@15d70f22, common=Script2@f3f7ed5}\n</code></pre>\n<p>Does anyone understand why the <code>steps.load</code> function is complaining about the <code>common</code> variable, since it should be loaded in the global context?</p>\n<p>TIA!</p>\n",
    "tags" : [ "java", "jenkins", "groovy", "jenkins-pipeline", "cicd" ],
    "owner" : {
      "account_id" : 13597229,
      "reputation" : 53,
      "user_id" : 9808910,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-GBmdBGfiQNc/AAAAAAAAAAI/AAAAAAAAAZU/vMv5xnM_wCg/s256-rj/photo.jpg",
      "display_name" : "Jared",
      "link" : "https://stackoverflow.com/users/9808910/jared"
    },
    "is_answered" : false,
    "view_count" : 70,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1744900265,
    "creation_date" : 1744899898,
    "link" : "https://stackoverflow.com/questions/79579480/jenkins-steps-load-cant-parse-a-script",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140374221,
    "post_id" : 79579480,
    "body" : "In your example, <code>setVariableInGlobalBinding(libName, steps.load(path)</code> is missing a <code>)</code> at the end.",
    "score" : 0,
    "owner" : {
      "account_id" : 2335086,
      "reputation" : 7004,
      "user_id" : 2047614,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/4ab539541e2207aa691d3c4566b9b2b6?s=256&d=identicon&r=PG",
      "display_name" : "MaratC",
      "link" : "https://stackoverflow.com/users/2047614/maratc"
    },
    "creation_date" : 1745775682,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140354649,
    "post_id" : 79579480,
    "body" : "<code>at Script3.&lt;init&gt;(Script3.groovy:6)</code> looks suspicious. what do you have in <code>common.groovy</code> ? try to put something simple inside common.groovy...",
    "score" : 0,
    "owner" : {
      "account_id" : 1333316,
      "reputation" : 29017,
      "user_id" : 1276664,
      "user_type" : "registered",
      "accept_rate" : 17,
      "profile_image" : "https://www.gravatar.com/avatar/873470471a482071b8e085095cf89221?s=256&d=identicon&r=PG",
      "display_name" : "daggett",
      "link" : "https://stackoverflow.com/users/1276664/daggett"
    },
    "creation_date" : 1745245085,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140346048,
    "post_id" : 79579480,
    "body" : "Are you calling this from within another vars/ script, or a pipeline?",
    "score" : 0,
    "owner" : {
      "account_id" : 92548,
      "reputation" : 2861,
      "user_id" : 253594,
      "user_type" : "registered",
      "accept_rate" : 50,
      "profile_image" : "https://www.gravatar.com/avatar/c3369b185a499e3f07496dc8f14c86b9?s=256&d=identicon&r=PG",
      "display_name" : "Vetsin",
      "link" : "https://stackoverflow.com/users/253594/vetsin"
    },
    "creation_date" : 1744919468,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140345070,
    "post_id" : 79579480,
    "body" : "If you are referring to using the vars directory, yes I could do that. However, I&#39;m trying to keep things neat and organize in directories based on project, etc",
    "score" : 0,
    "owner" : {
      "account_id" : 13597229,
      "reputation" : 53,
      "user_id" : 9808910,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-GBmdBGfiQNc/AAAAAAAAAAI/AAAAAAAAAZU/vMv5xnM_wCg/s256-rj/photo.jpg",
      "display_name" : "Jared",
      "link" : "https://stackoverflow.com/users/9808910/jared"
    },
    "creation_date" : 1744902582,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140344997,
    "post_id" : 79579480,
    "body" : "Could you auto-load the global var method as part of a shared library import instead? That would be much easier and work automatically, but I do not what authorization/permissions you have for the server.",
    "score" : 0,
    "owner" : {
      "account_id" : 3330925,
      "reputation" : 29569,
      "user_id" : 5343387,
      "user_type" : "registered",
      "accept_rate" : 86,
      "profile_image" : "https://www.gravatar.com/avatar/f459904f745c6646b0ef1ea72ca564cc?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Matthew Schuchard",
      "link" : "https://stackoverflow.com/users/5343387/matthew-schuchard"
    },
    "creation_date" : 1744901493,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}