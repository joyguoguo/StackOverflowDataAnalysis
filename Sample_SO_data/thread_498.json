{
  "question" : {
    "question_id" : 79799257,
    "title" : "Mockito spying on a class which contains a static method which calls another static method",
    "body" : "<p>I am trying to get a unit test to work using Mockito 5.14.2. The method I am trying to unit test is a static method (<code>m1</code>). Within the same class <code>Myclass1</code> there is another static method (<code>m2</code>) which returns a string and is called by <code>m1</code>. This seems like the case for using a spy. However, it does not work as I expect.</p>\n<pre class=\"lang-java prettyprint-override\"><code>class Myclass1 {\n    public static String m1() {\n        // do stuff\n        return m2();\n    }\n\n    public static String m2() {\n        // do stuff\n        return &quot;a string&quot;;\n    }\n}\n</code></pre>\n<p>tried:</p>\n<pre class=\"lang-java prettyprint-override\"><code>class Myclass1Test {\n    @Test \n    void testM1() {\n        try (MockedStatic&lt;Myclass1) myclass1Mock = mockStatic(Myclass1.class)) {\n            myclass1Mock.when(Myclass1::m2).thenReturn(&quot;a result&quot;);\n            String result = Myclass1.m1();\n            assertEquals(&quot;a result&quot;, result);\n        }\n    }\n}\n</code></pre>\n<p>the return of <code>Myclass1.m1()</code> is always <code>null</code>.</p>\n<p>also tried</p>\n<pre class=\"lang-java prettyprint-override\"><code>class Myclass1Test {\n    @Spy    \n    Myclass1 ut;\n\n    @Test \n    void testM1() {\n        doReturn(&quot;a result&quot;).when(ut).m2();\n        String result = ut.m1();\n    }\n}\n</code></pre>\n<p>but this would not even compile.</p>\n<p>My question is how to spy on a class that has a static method that calls another static method within the same class? Or what do I need to do to unit test method <code>Myclass1.m1</code>?</p>\n",
    "tags" : [ "java", "unit-testing", "static", "mockito" ],
    "owner" : {
      "account_id" : 13508220,
      "reputation" : 418,
      "user_id" : 9745488,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/FHcmY.jpg?s=256",
      "display_name" : "Oxnard",
      "link" : "https://stackoverflow.com/users/9745488/oxnard"
    },
    "is_answered" : true,
    "view_count" : 90,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1764190278,
    "creation_date" : 1761352100,
    "link" : "https://stackoverflow.com/questions/79799257/mockito-spying-on-a-class-which-contains-a-static-method-which-calls-another-sta",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79799451,
    "question_id" : 79799257,
    "body" : "<p>When mocking a class with <code>mockStatic</code> (or an object with &quot;regular&quot; mocking), you are in fact directing Mockito to apply a default <code>Answer</code> (behavior) to all the static methods of the class except for those you explicitly defined a different behavior with <code>when</code>, or similar methods.</p>\n<p>The default default behavior, if you excuse the clunkiness of that definition is <a href=\"https://javadoc.io/doc/org.mockito/mockito-core/latest/org.mockito/org/mockito/Mockito.html#RETURNS_DEFAULTS\" rel=\"nofollow noreferrer\"><code>RETUNRS_DEFAULTS</code></a> - i.e., return some default, empty value (<code>null</code> for objects, <code>0</code> for <code>int</code>s, etc).</p>\n<p>In this case, you want to mock away <code>m2</code>, but call the real <code>m1</code> method. You can achieve this by changing the detault answer to <a href=\"https://javadoc.io/doc/org.mockito/mockito-core/latest/org.mockito/org/mockito/Mockito.html#CALLS_REAL_METHODS\" rel=\"nofollow noreferrer\"><code>CALLS_REAL_METHODS</code></a>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>try (MockedStatic&lt;Myclass1&gt; myclass1Mock = \n     mockStatic(Myclass1.class, Mockito.CALLS_REAL_METHODS)) {\n     // Here -------------------^\n\n     // Rest of the test goes here, unchanged...\n</code></pre>\n<p>Alternatively, if you want to control this is a more granular way, and have <code>m1</code> as the only method that executes its real code, you can set that directly with a <code>when</code> call:</p>\n<pre class=\"lang-java prettyprint-override\"><code>try (MockedStatic&lt;Myclass1&gt; myclass1Mock = mockStatic(Myclass1.class)) {\n     myclass1Mock.when(Myclass1::m2).thenReturn(&quot;a result&quot;);\n     myclass1Mock.when(Myclass1::m1).thenCallRealMethod(); // Here! \n\n     // Rest of the test....\n</code></pre>\n",
    "score" : 2,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 2818342,
      "reputation" : 315967,
      "user_id" : 2422776,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2353050223ebecb113741c29458de4b2?s=256&d=identicon&r=PG",
      "display_name" : "Mureinik",
      "link" : "https://stackoverflow.com/users/2422776/mureinik"
    },
    "creation_date" : 1761389325,
    "last_activity_date" : 1764190278,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}