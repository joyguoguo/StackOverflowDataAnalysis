{
  "question" : {
    "question_id" : 79747671,
    "title" : "Why does Map Struct sometimes generate the wrong mapper, and how can I fix it?",
    "body" : "<p>I'm using Java 8, Spring Boot 2.3.4.RELEASE version, Maven as the build tool and IntelliJ as my IDE.</p>\n<p>I have two DTO's called <code>VehicleMasterDto</code> and <code>VehicleDetailDto</code></p>\n<p>Using MapStruct, I created the following interface.</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Mapper(componentModel = &quot;spring&quot;, nullValuePropertyMappingStrategy = NullValuePropertyMappingStrategy.IGNORE)\npublic interface MapStructVehicleMapper {\n    Vehicle toVehicle(VehicleMasterDto dto);\n    void updateVehicleFromDto(@MappingTarget Vehicle vehicle, VehicleDetailDto vehicleDetailDto);\n}\n</code></pre>\n<p>Given below are the dependencies that I used.</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;!-- MapStruct --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;\n    &lt;artifactId&gt;mapstruct&lt;/artifactId&gt;\n    &lt;version&gt;1.5.5.Final&lt;/version&gt;\n&lt;/dependency&gt;\n\n&lt;!-- MapStruct processor --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;\n    &lt;artifactId&gt;mapstruct-processor&lt;/artifactId&gt;\n    &lt;version&gt;1.5.5.Final&lt;/version&gt;\n    &lt;scope&gt;provided&lt;/scope&gt;\n&lt;/dependency&gt;\n\n&lt;plugin&gt;\n    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n    &lt;version&gt;3.11.0&lt;/version&gt;\n    &lt;configuration&gt;\n        &lt;source&gt;${java.version}&lt;/source&gt;\n        &lt;target&gt;${java.version}&lt;/target&gt;\n        &lt;annotationProcessorPaths&gt;\n            &lt;!-- MapStruct processor --&gt;\n            &lt;path&gt;\n                &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;\n                &lt;artifactId&gt;mapstruct-processor&lt;/artifactId&gt;\n                &lt;version&gt;1.5.5.Final&lt;/version&gt;\n            &lt;/path&gt;\n            &lt;!-- Lombok --&gt;\n            &lt;path&gt;\n                &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n                &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n                &lt;version&gt;1.18.30&lt;/version&gt;\n            &lt;/path&gt;\n        &lt;/annotationProcessorPaths&gt;\n    &lt;/configuration&gt;\n&lt;/plugin&gt;\n</code></pre>\n<p>The issue I'm facing is, when the mapstruct impl is generating in compile time, sometimes it generates the correct implementation, but sometimes it does not.</p>\n<p>Given below is the correct implementation which is supposed to auto generate.</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Generated(\n\n    value = &quot;org.mapstruct.ap.MappingProcessor&quot;,\n    date = &quot;2025-08-25T19:01:41+0530&quot;,\n    comments =\n        &quot;version: 1.5.5.Final, compiler: javac, environment: Java 1.8.0_462 &quot;\n        &quot;(Private Build)&quot;\n    )\n\n    @Component\n\n    public class MapStructVehicleMapperImpl implements MapStructVehicleMapper {\n    @Override\n    public Vehicle toVehicle(VehicleMasterDto dto) {\n    if (dto == null) {\n      return null;\n    }\n\n    Vehicle vehicle = new Vehicle();\n    vehicle.setVehicleNo(dto.getVehicleNo());\n    vehicle.setDriverMobileNo(dto.getDriverMobileNo());\n    vehicle.setDriverEmail(dto.getDriverEmail());\n    vehicle.setMaxWeight(dto.getMaxWeight());\n    vehicle.setMaxCapacity(dto.getMaxCapacity());\n\n    return vehicle;\n  }\n\n  @Override\n  public void updateVehicleFromDto(Vehicle vehicle, VehicleDetailDto vehicleDetailDto) {\n    if (vehicleDetailDto == null) {\n      return;\n    }\n\n    if (vehicleDetailDto.getDriverMobileNo() != null) {\n      vehicle.setDriverMobileNo(vehicleDetailDto.getDriverMobileNo());\n    }\n\n    if (vehicleDetailDto.getDriverEmail() != null) {\n      vehicle.setDriverEmail(vehicleDetailDto.getDriverEmail());\n    }\n\n    if (vehicleDetailDto.getMaxWeight() != null) {\n      vehicle.setMaxWeight(vehicleDetailDto.getMaxWeight());\n    }\n\n    vehicle.setMaxCapacity(vehicleDetailDto.getMaxCapacity());\n  }\n}\n</code></pre>\n<p>Sometimes, it generates the following mapper which is incorrect:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Generated(\n\n    value = &quot;org.mapstruct.ap.MappingProcessor&quot;,\n\n    date = &quot;2025-08-26T09:43:06+0530&quot;,\n\n    comments =\n        &quot;version: 1.5.5.Final, compiler: javac, environment: Java 1.8.0_462 &quot;\n        &quot;(Private Build)&quot;\n\n    )\n\n  @Component\n\n  public class VehicleMapperMapStructImpl implements VehicleMapperMapStruct {\n  @Override\n  public Vehicle toVehicle(VehicleMasterDto dto) {\n    if (dto == null) {\n      return null;\n    }\n\n    Vehicle vehicle = new Vehicle();\n\n    return vehicle;\n  }\n\n  @Override\n  public void updateVehicleFromDto(Vehicle vehicle, VehicleDetailDto vehicleDetailDto) {\n    if (vehicleDetailDto == null) {\n      return;\n    }\n  }\n}\n</code></pre>\n<p>Because of this random behavior, I can't trust Map Struct in our production environment. Thus I had to create a manual mapper. Can someone help me to understand the underlying issue here?</p>\n",
    "tags" : [ "java", "spring-boot", "mapstruct" ],
    "owner" : {
      "account_id" : 10059455,
      "reputation" : 89,
      "user_id" : 7512954,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-Dlpfmz6fJvA/AAAAAAAAAAI/AAAAAAAADSA/jEekeSsgvhA/s256-rj/photo.jpg",
      "display_name" : "Arunoda Gunawardana",
      "link" : "https://stackoverflow.com/users/7512954/arunoda-gunawardana"
    },
    "is_answered" : true,
    "view_count" : 188,
    "answer_count" : 1,
    "score" : 3,
    "last_activity_date" : 1756623266,
    "creation_date" : 1756280089,
    "link" : "https://stackoverflow.com/questions/79747671/why-does-map-struct-sometimes-generate-the-wrong-mapper-and-how-can-i-fix-it",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79748702,
    "question_id" : 79747671,
    "body" : "<p>You need to put lombok first in <code>annotationProcessorPaths</code>.</p>\n<p><strong>EDIT</strong>\nIt may not work. You can specify <code>annotationProcessor</code> wich in turn isn't guarantee result either.</p>\n<p>Only sure way is to use <code>lombok</code> - <code>mapstruct</code> integration.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 4497436,
      "reputation" : 20786,
      "user_id" : 3656904,
      "user_type" : "registered",
      "accept_rate" : 67,
      "profile_image" : "https://www.gravatar.com/avatar/8bdbd1f89f8907e8e8b15ab88c084c65?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "talex",
      "link" : "https://stackoverflow.com/users/3656904/talex"
    },
    "creation_date" : 1756361772,
    "last_activity_date" : 1756450218,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140695761,
    "post_id" : 79747671,
    "body" : "@MarkRotteveel This is a legacy project that I&#39;m working. I would love to upgrade to SpringBoot 3 and atleast for Java 17. But that&#39;s not in my hand :)",
    "score" : 0,
    "owner" : {
      "account_id" : 10059455,
      "reputation" : 89,
      "user_id" : 7512954,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-Dlpfmz6fJvA/AAAAAAAAAAI/AAAAAAAADSA/jEekeSsgvhA/s256-rj/photo.jpg",
      "display_name" : "Arunoda Gunawardana",
      "link" : "https://stackoverflow.com/users/7512954/arunoda-gunawardana"
    },
    "creation_date" : 1756295648,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140695756,
    "post_id" : 79747671,
    "body" : "@M.Deinum This works. Thank you so much for pointing out. I was clueless.",
    "score" : 0,
    "owner" : {
      "account_id" : 10059455,
      "reputation" : 89,
      "user_id" : 7512954,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/-Dlpfmz6fJvA/AAAAAAAAAAI/AAAAAAAADSA/jEekeSsgvhA/s256-rj/photo.jpg",
      "display_name" : "Arunoda Gunawardana",
      "link" : "https://stackoverflow.com/users/7512954/arunoda-gunawardana"
    },
    "creation_date" : 1756295594,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140695248,
    "post_id" : 79747671,
    "body" : "Why are you still using Spring Boot 2.3? Even if you don&#39;t want to take the leap to Spring Boot 3 (which you really should, as not even Spring Boot 2.7.x is still supported), you should at least have upgraded to 2.7.x.",
    "score" : 4,
    "owner" : {
      "account_id" : 213468,
      "reputation" : 110282,
      "user_id" : 466862,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d873f397779db38cd510d9ee5416fd43?s=256&d=identicon&r=PG",
      "display_name" : "Mark Rotteveel",
      "link" : "https://stackoverflow.com/users/466862/mark-rotteveel"
    },
    "creation_date" : 1756282073,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140695206,
    "post_id" : 79747671,
    "body" : "You are using lombok but not the lombok mapstruct integration. So not it depends on which annotation processor runs first. Lombok First, then mapstruct OK, other way round, NOK because mapstruct doesn&#39;t see the getters/setters yet as those aren&#39;t there. See <a href=\"https://mapstruct.org/documentation/stable/reference/html/#lombok\" rel=\"nofollow noreferrer\">mapstruct.org/documentation/stable/reference/html/#lombok</a>",
    "score" : 7,
    "owner" : {
      "account_id" : 3192259,
      "reputation" : 126800,
      "user_id" : 2696260,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/qHEzx.png?s=256",
      "display_name" : "M. Deinum",
      "link" : "https://stackoverflow.com/users/2696260/m-deinum"
    },
    "creation_date" : 1756281159,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79748702" : [ {
      "comment_id" : 140700704,
      "post_id" : 79748702,
      "body" : "@ArunodaGunawardana Yes. looks like you need to specify <code>annotationProcessor</code> and even that is not guarantee result because it may be compiler specific.",
      "score" : 1,
      "owner" : {
        "account_id" : 4497436,
        "reputation" : 20786,
        "user_id" : 3656904,
        "user_type" : "registered",
        "accept_rate" : 67,
        "profile_image" : "https://www.gravatar.com/avatar/8bdbd1f89f8907e8e8b15ab88c084c65?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "talex",
        "link" : "https://stackoverflow.com/users/3656904/talex"
      },
      "creation_date" : 1756450118,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140700453,
      "post_id" : 79748702,
      "body" : "Maven does not guarantee the execution order of annotation processors within the same &lt;annotationProcessorPaths&gt; section. So the answer is using lombok mapstruct integration as @M.Denium said.",
      "score" : 1,
      "owner" : {
        "account_id" : 10059455,
        "reputation" : 89,
        "user_id" : 7512954,
        "user_type" : "registered",
        "profile_image" : "https://lh3.googleusercontent.com/-Dlpfmz6fJvA/AAAAAAAAAAI/AAAAAAAADSA/jEekeSsgvhA/s256-rj/photo.jpg",
        "display_name" : "Arunoda Gunawardana",
        "link" : "https://stackoverflow.com/users/7512954/arunoda-gunawardana"
      },
      "creation_date" : 1756439563,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}