{
  "question" : {
    "question_id" : 79583818,
    "title" : "Write and run unit tests after a concurrent execution by multiple threads without writing all the concurrent calls and pool creation myself",
    "body" : "<p>I have a class method that updates the state of the object in a thread-safe manner.</p>\n<p>I want to add some basic unit testing to show that upon concurrent execution certain invariants still hold in order to confirm that the method is indeed functioning correctly when called by multiple threads.</p>\n<p>Maybe the way to unit test is by writing code and the spawning of threads and the test of the outcome in one unit test.</p>\n<p>Maybe <a href=\"https://en.wikipedia.org/wiki/JUnit\" rel=\"nofollow noreferrer\">JUnit</a> offers a way to run parallel tests out of the box and check the result in the end.</p>\n<p>How can I unit test my class method that updates the state of the object in a thread-safe manner in JUnit without writing all the code myself?</p>\n",
    "tags" : [ "java", "multithreading", "unit-testing", "junit" ],
    "owner" : {
      "account_id" : 12434767,
      "reputation" : 4529,
      "user_id" : 9055634,
      "user_type" : "registered",
      "accept_rate" : 22,
      "profile_image" : "https://www.gravatar.com/avatar/66aeb9b65c8086a48787435b2dbc09a0?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jim",
      "link" : "https://stackoverflow.com/users/9055634/jim"
    },
    "is_answered" : true,
    "view_count" : 499,
    "closed_date" : 1745251611,
    "answer_count" : 1,
    "score" : -3,
    "last_activity_date" : 1751734308,
    "creation_date" : 1745188524,
    "link" : "https://stackoverflow.com/questions/79583818/write-and-run-unit-tests-after-a-concurrent-execution-by-multiple-threads-withou",
    "closed_reason" : "Needs details or clarity"
  },
  "answers" : [ {
    "answer_id" : 79584687,
    "question_id" : 79583818,
    "body" : "<p>Testing for thread safety is a dubious proposition. The problem is, the behavior of a thread-unsafe program will depend on environmental conditions that are beyond your control.</p>\n<p>I worked on one large system in which somebody introduced a thread-unsafe routine, and the problem went undetected for <em>years</em> until we started using a different compiler version for our builds. Even then, it did not become apparent until six months later when it caused a crash on a client's machine. We only discovered the cause by examining core dumps and diagnostic logs from the client system, because we never were able to reproduce the bad behavior on our own machines.</p>\n<p>The only sure way to determine whether a program is free from threading-related bugs is by inspection of the source code.* (I'm out of the loop these days, so I don't know what automated tools might be available to help with that inspection.)</p>\n<hr />\n<p>* For <em>some</em> programming languages, there are tools like <a href=\"https://valgrind.org/docs/manual/hg-manual.html\" rel=\"nofollow noreferrer\"><em>Helgrind</em></a> that can flag multi-threading problems by watching what your code actually does when it runs. I don't know what's available for Java, and I don't know whether any such tool can guarantee to find every violation of multi-threading rules.</p>\n",
    "score" : 5,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 422870,
      "reputation" : 27582,
      "user_id" : 801894,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=256&d=identicon&r=PG",
      "display_name" : "Solomon Slow",
      "link" : "https://stackoverflow.com/users/801894/solomon-slow"
    },
    "creation_date" : 1745240690,
    "last_activity_date" : 1745858748,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140507764,
    "post_id" : 79583818,
    "body" : "Try <a href=\"https://github.com/vmlens/vmlens\" rel=\"nofollow noreferrer\">github.com/vmlens/vmlens</a>. It executes all thread interleavings during a unit test making it possible to test multithreaded Java. Data races are checked afterwards using happens-before relation",
    "score" : 0,
    "owner" : {
      "account_id" : 3303574,
      "reputation" : 1643,
      "user_id" : 2779079,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/YTwvE.jpg?s=256",
      "display_name" : "Thomas Krieger",
      "link" : "https://stackoverflow.com/users/2779079/thomas-krieger"
    },
    "creation_date" : 1749715747,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140374433,
    "post_id" : 79583818,
    "body" : "<b>Clarify via edits, not comments; delete &amp; flag obsolete comments.</b>",
    "score" : 0,
    "owner" : {
      "account_id" : 4151902,
      "reputation" : 15210,
      "user_id" : 3404097,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ec24a4fbe284c5379ba108a58a13fe8f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "philipxy",
      "link" : "https://stackoverflow.com/users/3404097/philipxy"
    },
    "creation_date" : 1745783507,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140374431,
    "post_id" : 79583818,
    "body" : "Decide what is your 1 specific researched non-duplicate question &amp; don&#39;t ask multiple questions implicitly by saying what you wonder or don&#39;t know.",
    "score" : 0,
    "owner" : {
      "account_id" : 4151902,
      "reputation" : 15210,
      "user_id" : 3404097,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ec24a4fbe284c5379ba108a58a13fe8f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "philipxy",
      "link" : "https://stackoverflow.com/users/3404097/philipxy"
    },
    "creation_date" : 1745783473,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140373614,
    "post_id" : 79583818,
    "body" : "This question has been discussed on meta: <a href=\"https://meta.stackoverflow.com/q/433682\">meta.stackoverflow.com/q/433682</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 4993527,
      "reputation" : 55632,
      "user_id" : 4014959,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/GdqQJ.jpg?s=256",
      "display_name" : "PM 2Ring",
      "link" : "https://stackoverflow.com/users/4014959/pm-2ring"
    },
    "creation_date" : 1745755678,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140356957,
    "post_id" : 79583818,
    "body" : "Clarify via edits, not comments; delete &amp; flag obsolete comments.",
    "score" : 0,
    "owner" : {
      "account_id" : 4151902,
      "reputation" : 15210,
      "user_id" : 3404097,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ec24a4fbe284c5379ba108a58a13fe8f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "philipxy",
      "link" : "https://stackoverflow.com/users/3404097/philipxy"
    },
    "creation_date" : 1745310385,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140355826,
    "post_id" : 79583818,
    "body" : "@Mureinik: Same comment as above",
    "score" : 0,
    "owner" : {
      "account_id" : 12434767,
      "reputation" : 4529,
      "user_id" : 9055634,
      "user_type" : "registered",
      "accept_rate" : 22,
      "profile_image" : "https://www.gravatar.com/avatar/66aeb9b65c8086a48787435b2dbc09a0?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jim",
      "link" : "https://stackoverflow.com/users/9055634/jim"
    },
    "creation_date" : 1745269867,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140355825,
    "post_id" : 79583818,
    "body" : "@RohitGupta: These (I think) are not relevant since I understand them are about running unit tests in pararallel while my question is about executing a single unit test in a multithreaded fashion.",
    "score" : 0,
    "owner" : {
      "account_id" : 12434767,
      "reputation" : 4529,
      "user_id" : 9055634,
      "user_type" : "registered",
      "accept_rate" : 22,
      "profile_image" : "https://www.gravatar.com/avatar/66aeb9b65c8086a48787435b2dbc09a0?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jim",
      "link" : "https://stackoverflow.com/users/9055634/jim"
    },
    "creation_date" : 1745269859,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140355816,
    "post_id" : 79583818,
    "body" : "@LouisWasserman:I can understand that but there should be some unit testing for  testing methods/structures that are meant to be thread safe, no?",
    "score" : 0,
    "owner" : {
      "account_id" : 12434767,
      "reputation" : 4529,
      "user_id" : 9055634,
      "user_type" : "registered",
      "accept_rate" : 22,
      "profile_image" : "https://www.gravatar.com/avatar/66aeb9b65c8086a48787435b2dbc09a0?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Jim",
      "link" : "https://stackoverflow.com/users/9055634/jim"
    },
    "creation_date" : 1745269726,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140354957,
    "post_id" : 79583818,
    "body" : "This question is similar to: <a href=\"https://stackoverflow.com/questions/50586201/parallel-test-case-execution-with-junit-5\">Parallel test case execution with JUnit 5</a>. If you believe it’s different, please <a href=\"https://stackoverflow.com/posts/79583818/edit\">edit</a> the question, make it clear how it’s different and/or how the answers on that question are not helpful for your problem.",
    "score" : 1,
    "owner" : {
      "account_id" : 6128339,
      "reputation" : 4277,
      "user_id" : 4779472,
      "user_type" : "registered",
      "accept_rate" : 89,
      "profile_image" : "https://www.gravatar.com/avatar/2c3cae7cf943d84f4f6e300f01cf4b2a?s=256&d=identicon&r=PG",
      "display_name" : "Rohit Gupta",
      "link" : "https://stackoverflow.com/users/4779472/rohit-gupta"
    },
    "creation_date" : 1745251611,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140354162,
    "post_id" : 79583818,
    "body" : "This may help <a href=\"https://stackoverflow.com/questions/50586201/parallel-test-case-execution-with-junit-5\" title=\"parallel test case execution with junit 5\">stackoverflow.com/questions/50586201/&hellip;</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 2818342,
      "reputation" : 315967,
      "user_id" : 2422776,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/2353050223ebecb113741c29458de4b2?s=256&d=identicon&r=PG",
      "display_name" : "Mureinik",
      "link" : "https://stackoverflow.com/users/2422776/mureinik"
    },
    "creation_date" : 1745234050,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140353312,
    "post_id" : 79583818,
    "body" : "Thread safety feels to me like it should be tested at the integration or system level.  For certain operations, we&#39;d design long running tests (overnight or longer) that would pump tons data through a system.  If the data out was always correct, then the system was assumed to be thread safe (among other things).",
    "score" : 3,
    "owner" : {
      "account_id" : 2709823,
      "reputation" : 11069,
      "user_id" : 2338547,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/QT3fG.png?s=256",
      "display_name" : "markspace",
      "link" : "https://stackoverflow.com/users/2338547/markspace"
    },
    "creation_date" : 1745197017,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140353263,
    "post_id" : 79583818,
    "body" : "No unit test can reliably check that a method is thread-safe, but you might investigate <a href=\"https://github.com/JetBrains/lincheck\" rel=\"nofollow noreferrer\">Lincheck</a>.",
    "score" : 7,
    "owner" : {
      "account_id" : 465573,
      "reputation" : 200423,
      "user_id" : 869736,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/ae7bb06b9a23a4dd7eea69e853d47d12?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Louis Wasserman",
      "link" : "https://stackoverflow.com/users/869736/louis-wasserman"
    },
    "creation_date" : 1745194146,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79584687" : [ {
      "comment_id" : 140355637,
      "post_id" : 79584687,
      "body" : "@Robert, I&#39;d say that differently. I&#39;d say, if your code has a race condition, sometimes a test will reveal it. Sometimes, but not all the time, and not every race condition.",
      "score" : 4,
      "owner" : {
        "account_id" : 422870,
        "reputation" : 27582,
        "user_id" : 801894,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=256&d=identicon&r=PG",
        "display_name" : "Solomon Slow",
        "link" : "https://stackoverflow.com/users/801894/solomon-slow"
      },
      "creation_date" : 1745265737,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140355070,
      "post_id" : 79584687,
      "body" : "Testing for thread safety is not necessarily dubious. Sometimes you can write a test that shows a race condition, before you fix it. It can be tricky, especially if the code under test is large and poorly structured. I&#39;ve done this in previous jobs in both C++ and Java.",
      "score" : 3,
      "owner" : {
        "account_id" : 1535561,
        "reputation" : 9056,
        "user_id" : 1431720,
        "user_type" : "registered",
        "accept_rate" : 89,
        "profile_image" : "https://www.gravatar.com/avatar/f5a1388d4d3b2bf03b11bb5658c68c29?s=256&d=identicon&r=PG",
        "display_name" : "Robert",
        "link" : "https://stackoverflow.com/users/1431720/robert"
      },
      "creation_date" : 1745254101,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}