{
  "question" : {
    "question_id" : 79593103,
    "title" : "How to bypass or auto-accept Chrome&#39;s file editing permission dialog triggered by window.showDirectoryPicker() in Playwright?",
    "body" : "<p>I trying to download a file into a folder that is not in the list of managed permissions of Playwright.</p>\n<p>The reason I need to test this particular download is because I am dealing with a websockets binary protocol that receives compressed chunks in parallel and and re-builds the file client side. So this is not a typical download</p>\n<p>The app that I am testing opens the windows file choose with the <code>window.showDirectoryPicker()</code> JS method, then with (Autoit) I select the folder in the file explorer window and click on &quot;Select Folder&quot; button, after that in the browser a permission dialog is triggered asking the user for file editing permission. I am not able to click on the &quot;Edit files&quot; button with Playwright. This is what the dialog looks like:</p>\n<p><a href=\"https://i.sstatic.net/cWd8RNwg.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/cWd8RNwg.png\" alt=\"enter image description here\" /></a></p>\n<p>This is an example of what my app do, I want to download into a folder in my machine during my playwrite tests.</p>\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=&quot;en&quot;&gt;\n&lt;head&gt;\n  &lt;meta charset=&quot;UTF-8&quot;&gt;\n  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;\n  &lt;title&gt;Create and Save File in Directory&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;h1&gt;Create and Save File in Directory&lt;/h1&gt;\n  &lt;p&gt;Click the button below to select a directory and save a file directly to it.&lt;/p&gt;\n  &lt;button id=&quot;saveFileButton&quot;&gt;Save File&lt;/button&gt;\n\n  &lt;script&gt;\n    document.getElementById(&quot;saveFileButton&quot;).addEventListener(&quot;click&quot;, async () =&gt; {\n      try {\n        // Open the directory picker\n        const directoryHandle = await window.showDirectoryPicker({mode: &quot;readwrite&quot;});\n\n        // Create a new file in the selected directory\n        const fileHandle = await directoryHandle.getFileHandle(&quot;test-file.txt&quot;, {\n          create: true, // Create the file if it doesn't exist\n        });\n\n        // Create a writable stream to write to the file\n        const writable = await fileHandle.createWritable();\n\n        // Write some content to the file\n        await writable.write(&quot;This is a test file created and saved in the selected directory.&quot;);\n\n        // Close the writable stream\n        await writable.close();\n\n        alert(&quot;File saved successfully in the selected directory!&quot;);\n      } catch (error) {\n        console.error(&quot;Error saving file:&quot;, error);\n        alert(&quot;An error occurred while saving the file.&quot;);\n      }\n    });\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n<p>This is the code that will test the above page</p>\n<pre><code>package com.example.demo;\n\nimport com.microsoft.playwright.*;\n\nimport org.junit.jupiter.api.*;\n\n\npublic class TestExample {\n    static Playwright playwright;\n    static Browser browser;\n    BrowserContext context;\n    Page page;\n\n    @BeforeAll\n    static void setupClass() {\n        playwright = Playwright.create();\n        browser = playwright.chromium().launch(new BrowserType.LaunchOptions().setHeadless(false));\n    }\n\n    @AfterAll\n    static void tearDownClass() {\n        browser.close();\n        playwright.close();\n    }\n\n    @BeforeEach\n    void setup() {\n        context = browser.newContext();\n        page = context.newPage();\n    }\n\n    @AfterEach\n    void tearDown() {\n        context.close();\n    }\n\n    @Test\n    void testSaveFileWithAutoIt() throws Exception {\n        // Navigate to your HTML file\n        page.navigate(&quot;file:///C:/path/test-save-with-picker.html&quot;);\n\n\n        // Listen for the alert dialog of file saved sucessfully\n        page.onceDialog(dialog -&gt; {\n            System.out.println(&quot;Dialog message: &quot; + dialog.message());\n            dialog.accept();\n        });\n\n\n\n        // Run the AutoIt script to set the file download path\n        Process process = Runtime.getRuntime().exec(&quot;C:\\\\autoit\\\\set-file-download-path.exe&quot;);\n        page.waitForTimeout(3000);\n\n        // Click the button to open the directory picker\n        page.click(&quot;#saveFileButton&quot;);\n        page.waitForTimeout(20000);\n\n        int exitCode = process.waitFor(); // Wait for the AutoIt script to complete\n        if (exitCode == 0) {\n            System.out.println(&quot;AutoIt script executed successfully.&quot;);\n        } else {\n            System.out.println(&quot;AutoIt script failed with exit code: &quot; + exitCode);\n        }\n\n        // I need to auto accept the permission dialog here &lt;========\n\n\n        //Check if the file was created in C:\\TestDirectory\n        java.nio.file.Path filePath = java.nio.file.Paths.get(&quot;C:\\\\TestDirectory&quot;);\n        Assertions.assertTrue(java.nio.file.Files.exists(filePath), &quot;File was not created!&quot;);\n\n    }\n}\n</code></pre>\n<p>And the Autoit script</p>\n<pre><code>WinWaitActive(&quot;Select where this site can save changes&quot;)\nControlSetText(&quot;Select where this site can save changes&quot;, &quot;&quot;,&quot;Edit1&quot;,  &quot;C:\\TestDirectory&quot;)\nSleep(1000)\nControlClick(&quot;Select where this site can save changes&quot;, &quot;Select Folder&quot;, &quot;Button1&quot;)\n</code></pre>\n",
    "tags" : [ "java", "automated-tests", "playwright", "autoit", "playwright-java" ],
    "owner" : {
      "account_id" : 22910708,
      "reputation" : 78,
      "user_id" : 17048019,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GgAGMk3PKfe-p9k7GOxOyJKvPVofKpe8RZiD7FBoN0=k-s256",
      "display_name" : "Alan Barrientos",
      "link" : "https://stackoverflow.com/users/17048019/alan-barrientos"
    },
    "is_answered" : false,
    "view_count" : 265,
    "answer_count" : 0,
    "score" : 2,
    "last_activity_date" : 1745939060,
    "creation_date" : 1745604596,
    "link" : "https://stackoverflow.com/questions/79593103/how-to-bypass-or-auto-accept-chromes-file-editing-permission-dialog-triggered-b",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140399736,
    "post_id" : 79593103,
    "body" : "<a href=\"https://chatgpt.com/share/6819dd59-4bf4-8004-b76b-16c9580bc4f8\" rel=\"nofollow noreferrer\">can you take a look at this</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 1066374,
      "reputation" : 31804,
      "user_id" : 1066828,
      "user_type" : "registered",
      "accept_rate" : 95,
      "profile_image" : "https://www.gravatar.com/avatar/8785d8636d0dc68405fee1e9aa41728a?s=256&d=identicon&r=PG",
      "display_name" : "Fahim Parkar",
      "link" : "https://stackoverflow.com/users/1066828/fahim-parkar"
    },
    "creation_date" : 1746525763,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140397121,
    "post_id" : 79593103,
    "body" : "<a href=\"https://github.com/microsoft/playwright/issues/18267\" rel=\"nofollow noreferrer\">github.com/microsoft/playwright/issues/18267</a>",
    "score" : 1,
    "owner" : {
      "account_id" : 384206,
      "reputation" : 54356,
      "user_id" : 740553,
      "user_type" : "registered",
      "accept_rate" : 46,
      "profile_image" : "https://i.sstatic.net/s5cOX.jpg?s=256",
      "display_name" : "Mike &#39;Pomax&#39; Kamermans",
      "link" : "https://stackoverflow.com/users/740553/mike-pomax-kamermans"
    },
    "creation_date" : 1746454113,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140397101,
    "post_id" : 79593103,
    "body" : "@Mike&#39;Pomax&#39;Kamermans Although you are right, what I want is to test the javascript SPA that does that in a running browser. If you have an autoritative that that can&#39;t be done, then I will go with that.",
    "score" : 0,
    "owner" : {
      "account_id" : 17730,
      "reputation" : 5575,
      "user_id" : 39998,
      "user_type" : "registered",
      "accept_rate" : 73,
      "profile_image" : "https://i.sstatic.net/Riurn.jpg?s=256",
      "display_name" : "David Hofmann",
      "link" : "https://stackoverflow.com/users/39998/david-hofmann"
    },
    "creation_date" : 1746453698,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140397095,
    "post_id" : 79593103,
    "body" : "@cyberbrain I have tried several of those options. none of them worked.",
    "score" : 0,
    "owner" : {
      "account_id" : 17730,
      "reputation" : 5575,
      "user_id" : 39998,
      "user_type" : "registered",
      "accept_rate" : 73,
      "profile_image" : "https://i.sstatic.net/Riurn.jpg?s=256",
      "display_name" : "David Hofmann",
      "link" : "https://stackoverflow.com/users/39998/david-hofmann"
    },
    "creation_date" : 1746453578,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140381604,
    "post_id" : 79593103,
    "body" : "You could launch the browser with commandline options (<a href=\"https://playwright.dev/java/docs/api/class-browsertype#browser-type-launch-option-args\" rel=\"nofollow noreferrer\"><code>BrowserType.LaunchOptions().setArgs</code></a>, the docs page contains a <a href=\"https://peter.sh/experiments/chromium-command-line-switches/\" rel=\"nofollow noreferrer\">link to a list of Chrome launch options</a>). I don&#39;t know which is the correct option for you or if one exists at all, so I cannot write a complete answer here, but you probably figure that out quickly.",
    "score" : 0,
    "owner" : {
      "account_id" : 3391382,
      "reputation" : 5360,
      "user_id" : 2846138,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/2sp68.png?s=256",
      "display_name" : "cyberbrain",
      "link" : "https://stackoverflow.com/users/2846138/cyberbrain"
    },
    "creation_date" : 1745955446,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140380838,
    "post_id" : 79593103,
    "body" : "So do that as a unit test. You don&#39;t need a browser for that, you just need another websocket which you can build in Node/Deno/bun/etc. just fine, and make that send the data using the same logic that you&#39;re using in the browser (as websockets are universally implemented), by making sure it doesn&#39;t care where it&#39;s being imported (e.g. if the function relies on FileReader, make that a <code>doStuff(...,. .., reader = FileReader) {...}</code> argument that your tests can explicitly assign a mock for, but your browser-use doesn&#39;t ever even need to know about because it already works).",
    "score" : 0,
    "owner" : {
      "account_id" : 384206,
      "reputation" : 54356,
      "user_id" : 740553,
      "user_type" : "registered",
      "accept_rate" : 46,
      "profile_image" : "https://i.sstatic.net/s5cOX.jpg?s=256",
      "display_name" : "Mike &#39;Pomax&#39; Kamermans",
      "link" : "https://stackoverflow.com/users/740553/mike-pomax-kamermans"
    },
    "creation_date" : 1745941461,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140376882,
    "post_id" : 79593103,
    "body" : "@Mike&#39;Pomax&#39;Kamermans in my particular case I do need to check if the download happens and it happens completelly. I am dealing with a websockets binary protocol that receives compressed chunks in parallel and and re-builds the file client side. So this is not a typical download.",
    "score" : 0,
    "owner" : {
      "account_id" : 17730,
      "reputation" : 5575,
      "user_id" : 39998,
      "user_type" : "registered",
      "accept_rate" : 73,
      "profile_image" : "https://i.sstatic.net/Riurn.jpg?s=256",
      "display_name" : "David Hofmann",
      "link" : "https://stackoverflow.com/users/39998/david-hofmann"
    },
    "creation_date" : 1745851486,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140370864,
    "post_id" : 79593103,
    "body" : "your integration tests should not test &quot;whether HTML works&quot;. It does, you know it does, that&#39;s the whole point of the browser. There is no value in a test that checks whether file downloads work (of course they do, it&#39;s a browser), or even if the data makes it over correctly (of course it does, nothing work would if it didn&#39;t), test what needs to happen when you <i>have</i> that data. You don&#39;t need the actual &quot;downloading a file&quot; for that, you can start your test with the data already in place and take it from there.",
    "score" : 3,
    "owner" : {
      "account_id" : 384206,
      "reputation" : 54356,
      "user_id" : 740553,
      "user_type" : "registered",
      "accept_rate" : 46,
      "profile_image" : "https://i.sstatic.net/s5cOX.jpg?s=256",
      "display_name" : "Mike &#39;Pomax&#39; Kamermans",
      "link" : "https://stackoverflow.com/users/740553/mike-pomax-kamermans"
    },
    "creation_date" : 1745625151,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140370403,
    "post_id" : 79593103,
    "body" : "It didn&#39;t work for me, and even if it did in your example, the dialog for user permission is not the same thing, you are not supposed to bypass that kind of confirmation with avascript. Its a security issue, chrome won&#39;t let that happen.",
    "score" : 1,
    "owner" : {
      "account_id" : 17730,
      "reputation" : 5575,
      "user_id" : 39998,
      "user_type" : "registered",
      "accept_rate" : 73,
      "profile_image" : "https://i.sstatic.net/Riurn.jpg?s=256",
      "display_name" : "David Hofmann",
      "link" : "https://stackoverflow.com/users/39998/david-hofmann"
    },
    "creation_date" : 1745609597,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140370348,
    "post_id" : 79593103,
    "body" : "Are you sure? I just did it in the devtools console for this page <a href=\"https://www.w3schools.com/jsref/tryit.asp?filename=tryjsref_confirm\" rel=\"nofollow noreferrer\">javascript confirm</a> and it worked.",
    "score" : 0,
    "owner" : {
      "account_id" : 3340027,
      "reputation" : 699,
      "user_id" : 2806502,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ba0cf1a14a1bd6f2ea3d77bc6ede5460?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "garbb",
      "link" : "https://stackoverflow.com/users/2806502/garbb"
    },
    "creation_date" : 1745608237,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140370289,
    "post_id" : 79593103,
    "body" : "@garbb Chrome will not let javascript override that. It is supposed to be something the user has to explicitly accept, not something the web application can override.",
    "score" : 3,
    "owner" : {
      "account_id" : 17730,
      "reputation" : 5575,
      "user_id" : 39998,
      "user_type" : "registered",
      "accept_rate" : 73,
      "profile_image" : "https://i.sstatic.net/Riurn.jpg?s=256",
      "display_name" : "David Hofmann",
      "link" : "https://stackoverflow.com/users/39998/david-hofmann"
    },
    "creation_date" : 1745606700,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140370253,
    "post_id" : 79593103,
    "body" : "Can you just overwrite the javascript confirm function? <code>window.confirm = function(s){return true}</code>",
    "score" : 0,
    "owner" : {
      "account_id" : 3340027,
      "reputation" : 699,
      "user_id" : 2806502,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ba0cf1a14a1bd6f2ea3d77bc6ede5460?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "garbb",
      "link" : "https://stackoverflow.com/users/2806502/garbb"
    },
    "creation_date" : 1745606000,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}