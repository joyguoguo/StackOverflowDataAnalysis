{
  "question" : {
    "question_id" : 79593583,
    "title" : "Spring AI Getting &quot;unable to find valid certification path to requested target&quot; while using custom LLM model endpoint hosted by our company",
    "body" : "<p>I am using Spring Boot AI for LLM base application. My company hosted its LLM models at <a href=\"https://dummy-server.xyz.com/\" rel=\"nofollow noreferrer\">https://dummy-server.xyz.com/</a>. To test how it works, I have taken an example from Spring AI official site and tried from locally. But getting the below error. I have tried to bypass the SSL certificate validation, but that is also not working. Any idea how to resolve it? Please find the error message and my code.</p>\n<pre><code>@RestController\npublic class ChatController {\n\n    private final OpenAiChatModel chatModel;\n\n    @Autowired\n    public ChatController(@Qualifier(&quot;openAiChatModel&quot;) OpenAiChatModel chatModel) {\n        this.chatModel = chatModel;\n    }\n\n    @GetMapping(&quot;/ai/generate&quot;)\n    public Map&lt;String,String&gt; generate(@RequestParam(value = &quot;message&quot;, defaultValue = &quot;Tell me a joke&quot;) String message) {\n        return Map.of(&quot;generation&quot;, this.chatModel.call(message));\n    }\n\n    @GetMapping(&quot;/ai/generateStream&quot;)\n    public Flux&lt;ChatResponse&gt; generateStream(@RequestParam(value = &quot;message&quot;, defaultValue = &quot;Tell me a joke&quot;) String message) {\n        Prompt prompt = new Prompt(new UserMessage(message));\n        return this.chatModel.stream(prompt);\n    }\n}\n\n@Configuration\npublic class ChatClientConfig {\n\n    @Bean\n    public OpenAiChatModel openAiChatModel(@Qualifier(&quot;unsafeWebClientBuilder&quot;) WebClient unsafeWebClientBuilder) {\n        OpenAiApi openAiApi = new OpenAiApi(&quot;https://dummy-server.xyz.com/&quot;,&quot;OTBjZWUxMjAtYWZkNi00Mm5sdsGH&quot;, RestClient.builder(),unsafeWebClientBuilder.mutate());\n        return new OpenAiChatModel(openAiApi);\n    }\n}\n\n@Configuration\npublic class UnsafeWebClientConfig {\n    @Bean\n    public WebClient unsafeWebClientBuilder() throws NoSuchAlgorithmException, KeyManagementException {\n        HttpClient httpClient = HttpClient.create()\n                .secure(sslContextSpec -&gt; {\n                    try {\n                        sslContextSpec.sslContext(SslContextBuilder.forClient()\n                                .trustManager(InsecureTrustManagerFactory.INSTANCE)\n                                .build());\n                    } catch (SSLException e) {\n                        throw new RuntimeException(&quot;Failed to create SSL context&quot;, e);\n                    }\n                });\n\n        return WebClient.builder()\n                .clientConnector(new ReactorClientHttpConnector(httpClient))\n                .build();\n\n    }\n}\n</code></pre>\n<p>To bypass certificate I tried other methods also available on the web, like &quot;X509Certificate&quot;</p>\n<p>Error:</p>\n<pre><code>org.springframework.web.client.ResourceAccessException: I/O error on POST request for &quot;https://dummy-server.xyz.com/v1/v1/chat/completions&quot;: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target\n    \norg.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'chatController' defined in file [C:\\Users\\Administrator\\Documents\\spring-ai-multi-llm-chat-svc-main\\spring-ai-multi-llm-chat-svc-main\\target\\classes\\com\\raj\\nola\\llm\\chat\\controller\\ChatController.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'openAiChatModel' defined in class path resource [com/raj/nola/llm/chat/controller/OpenAiClientConfig.class]: Unsatisfied dependency expressed through method 'openAiChatModel' parameter 0: Error creating bean with name 'openAiApi' defined in class path resource [com/raj/nola/llm/chat/controller/OpenAiClientConfig.class]: Failed to instantiate [org.springframework.ai.openai.api.OpenAiApi]: Factory method 'openAiApi' threw exception with message: class org.springframework.web.reactive.function.client.DefaultWebClient cannot be cast to class org.springframework.web.reactive.function.client.WebClient$Builder (org.springframework.web.reactive.function.client.DefaultWebClient and org.springframework.web.reactive.function.client.WebClient$Builder are in unnamed module of loader 'app')\n</code></pre>\n<p>The interesting thing is same endpoint I can use from Python. I tried this simple code and it works like a charm.</p>\n<pre><code>httpx_client = httpx.Client(verify=False) \nllm = OpenAI(\n             base_url=&quot;https://dummy-server.xyz.com/v1&quot;,\n             model_name=model_name,\n             temperature=0.9, \n             api_key='API_KEY',\n             http_client=httpx_client\n    )\n</code></pre>\n<p>I am not sure how to resolve this issue. So if anyone can help.</p>\n",
    "tags" : [ "java", "spring-boot", "openapi", "java-security", "spring-ai" ],
    "owner" : {
      "account_id" : 2397018,
      "reputation" : 11,
      "user_id" : 2095633,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f0369113cad54ba1b41c940505879b21?s=256&d=identicon&r=PG",
      "display_name" : "saikat sadhukhan",
      "link" : "https://stackoverflow.com/users/2095633/saikat-sadhukhan"
    },
    "is_answered" : false,
    "view_count" : 47,
    "closed_date" : 1745656666,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1745648445,
    "creation_date" : 1745642809,
    "link" : "https://stackoverflow.com/questions/79593583/spring-ai-getting-unable-to-find-valid-certification-path-to-requested-target",
    "closed_reason" : "Duplicate"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140371613,
    "post_id" : 79593583,
    "body" : "you did not &quot;bypass&quot; anything just by using python. Python apparently does something differently than java, its your job to figure out what it does. It might use a pre installed certificate on your computer, for example. python does not magically &quot;not use TLS&quot;",
    "score" : 0,
    "owner" : {
      "account_id" : 2064278,
      "reputation" : 15073,
      "user_id" : 1840146,
      "user_type" : "registered",
      "accept_rate" : 86,
      "profile_image" : "https://i.sstatic.net/JXdxm.png?s=256",
      "display_name" : "Toerktumlare",
      "link" : "https://stackoverflow.com/users/1840146/toerktumlare"
    },
    "creation_date" : 1745666157,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140371514,
    "post_id" : 79593583,
    "body" : "Yes, I don&#39;t have the certificate, but is it possible to bypass like I did for Python. This is just for testing purpose",
    "score" : 0,
    "owner" : {
      "account_id" : 2397018,
      "reputation" : 11,
      "user_id" : 2095633,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f0369113cad54ba1b41c940505879b21?s=256&d=identicon&r=PG",
      "display_name" : "saikat sadhukhan",
      "link" : "https://stackoverflow.com/users/2095633/saikat-sadhukhan"
    },
    "creation_date" : 1745661771,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140371387,
    "post_id" : 79593583,
    "body" : "Sounds like that internal server uses a self-signed certificate, or a certificate signed by a CA that is not in Java&#39;s CA or trust store.",
    "score" : 0,
    "owner" : {
      "account_id" : 213468,
      "reputation" : 110282,
      "user_id" : 466862,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d873f397779db38cd510d9ee5416fd43?s=256&d=identicon&r=PG",
      "display_name" : "Mark Rotteveel",
      "link" : "https://stackoverflow.com/users/466862/mark-rotteveel"
    },
    "creation_date" : 1745656634,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}