{
  "question" : {
    "question_id" : 79610916,
    "title" : "google auth2 with multi-user failed in refreshing a token, 401 Unauthorized",
    "body" : "<p>I've application connected to google calendar with multiple keys or users in accessing the oauth2 token. All users can register(using Servlet) and send the calendar event in around one hour after registered.\nAfter 1 hour, only one(the same person) of them can get the refresh/update token once it expired and can send calendar event. The rest users can't get the refresh token or can't send calendar event out; error log shows as the following:</p>\n<pre><code>    com.google.api.client.auth.oauth2.TokenResponseException: 401 Unauthorized\nPOST https://oauth2.googleapis.com/token\n        at com.google.api.client.auth.oauth2.TokenResponseException.from(TokenResponseException.java:103)\n        at com.google.api.client.auth.oauth2.TokenRequest.executeUnparsed(TokenRequest.java:308)\n        at com.google.api.client.googleapis.auth.oauth2.GoogleAuthorizationCodeTokenRequest.execute(GoogleAuthorizationCodeTokenRequest.java:166)\n        at com.google.api.client.googleapis.auth.oauth2.GoogleAuthorizationCodeTokenRequest.execute(GoogleAuthorizationCodeTokenRequest.java:72)\n        at com.google.api.client.extensions.servlet.auth.oauth2.jakarta.AbstractAuthorizationCodeCallbackServlet.doGet(AbstractAuthorizationCodeCallbackServlet.java:122)...\n</code></pre>\n<p>My codes to validate &amp; refresh token are:</p>\n<pre><code>String keys = googleCal.getCredential();//get credential from datastore based on a user key\n InputStream stream = new ByteArrayInputStream(keys.getBytes(Charset.forName(&quot;UTF-8&quot;)));\n GoogleClientSecrets clientSecrets = GoogleClientSecrets.load(JSON_FACTORY, new InputStreamReader(stream));\n DataStoreFactory dataStore = new JPADataStoreFactory(repository);\n NetHttpTransport HTTP_TRANSPORT = GoogleNetHttpTransport.newTrustedTransport();\n GoogleAuthorizationCodeFlow flow = new GoogleAuthorizationCodeFlow.Builder(\n  HTTP_TRANSPORT, JSON_FACTORY, clientSecrets, SCOPES)\n  .setDataStoreFactory(dataStore) \n  .setApprovalPrompt(&quot;force&quot;)\n  .setAccessType(&quot;offline&quot;)\n  .build();\n                \n</code></pre>\n<p>Note: users are less than 10 and my app was not sent to verify yet.</p>\n<p>Any suggestion would be appreciated.</p>\n",
    "tags" : [ "java", "oauth-2.0", "google-oauth", "google-calendar-api", "refresh-token" ],
    "owner" : {
      "account_id" : 4354295,
      "reputation" : 109,
      "user_id" : 3553476,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/9dc0e0c9e139d9080201c5ea79761438?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "PeterL355",
      "link" : "https://stackoverflow.com/users/3553476/peterl355"
    },
    "is_answered" : false,
    "view_count" : 144,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1747534308,
    "creation_date" : 1746631938,
    "link" : "https://stackoverflow.com/questions/79610916/google-auth2-with-multi-user-failed-in-refreshing-a-token-401-unauthorized",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}