{
  "question" : {
    "question_id" : 79674325,
    "title" : "AAPT2 Link Error: Theme.AppCompat.Light.NoActionBar not found when building Android app manually",
    "body" : "<p>I'm trying to create an Android AppCompat application entirely manually, without using Gradle for the build process. I'm compiling resources using <code>aapt2 compile</code> and then attempting to link them using <code>aapt2 link</code>.</p>\n<p>However, when I try to link the compiled resources and generate R.java, I'm encountering an aapt2 error related to the AppCompat theme not being found.</p>\n<p><strong>The command I'm running for linking is:</strong></p>\n<pre><code>aapt2 link -o ./linked_apks/com.example.helloworld.apk -I ./lib/android.jar --manifest ./compiled_res/main/AndroidManifest.xml --java ./build/gen --custom-package com.example.helloworld --auto-add-overlay -R ./compiled_res/main/com.example.helloworld.zip\n</code></pre>\n<p><strong>And this is the error message I receive:</strong></p>\n<pre><code>error: resource style/Theme.AppCompat.Light.NoActionBar (aka com.example.helloworld:style/Theme.AppCompat.Light.NoActionBar) not found.\nerror: failed linking references\n</code></pre>\n<p><strong>My <code>AndroidManifest.xml</code> snippet related to the theme is:</strong></p>\n<pre><code>&lt;application\n    android:allowBackup=&quot;true&quot;\n    android:icon=&quot;@mipmap/ic_launcher&quot;\n    android:label=&quot;@string/app_name&quot;\n    android:roundIcon=&quot;@mipmap/ic_launcher_round&quot;\n    android:supportsRtl=&quot;true&quot;\n    android:theme=&quot;@style/Theme.AppCompat.Light.NoActionBar&quot;&gt;\n    &lt;/application&gt;\n</code></pre>\n<p><strong>How I'm handling <code>R.java</code> files:</strong></p>\n<p>My current process for <code>R.java</code> generation and management is a bit unconventional due to the manual build:</p>\n<p>Initial <code>R.java</code> and APK generation: I first run <code>aapt2 link</code> to generate a single <code>R.java</code> file for all application resources. This step also generates the unsigned APK (without <code>classes.dex</code> yet).</p>\n<p>Individual Library <code>R.java</code> generation: After that, I generate individual <code>R.java</code> files for each library that contains resources (e.g., AppCompat libraries).</p>\n<p>Value Alignment with Python Script: The resource IDs in the individual library <code>R.java</code> files do not map correctly with the <code>resources.arsc</code> inside the APK generated in step 1. To resolve this, I have a Python script that takes the final resource ID values from the single <code>R.java</code> (generated in step 1) and propagates them into the corresponding individual <code>R.java</code> files for the libraries. This ensures consistency.</p>\n<p><strong>My question is:</strong></p>\n<p>Given this <code>aapt2 link</code> error related to <code>Theme.AppCompat.Light.NoActionBar</code> not found, how can I successfully generate individual <code>R.java</code> files for my app and its libraries? Is there a way to configure <code>aapt2</code> to ignore this specific error during the <code>R.java</code> generation phase, perhaps if the final resource IDs are reconciled later? More broadly, how does Gradle handle the generation of <code>R.java</code> files for libraries and the main application, especially concerning external resource dependencies like AppCompat, to avoid such linking errors?</p>\n<p>Any guidance on the manual build process for AppCompat apps would be greatly appreciated!</p>\n",
    "tags" : [ "java", "android" ],
    "owner" : {
      "account_id" : 42651085,
      "reputation" : 26,
      "user_id" : 30856992,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/684a858070a185e5ab7cb26bc5312931?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Rahil",
      "link" : "https://stackoverflow.com/users/30856992/rahil"
    },
    "is_answered" : true,
    "view_count" : 56,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1750563529,
    "creation_date" : 1750498540,
    "link" : "https://stackoverflow.com/questions/79674325/aapt2-link-error-theme-appcompat-light-noactionbar-not-found-when-building-andr",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79674875,
    "question_id" : 79674325,
    "body" : "<p><strong>How to Fix It (Manually)</strong></p>\n<p>1. <strong>Extract AppCompat AAR</strong></p>\n<p>You need to include AppCompat's resources and manifest in your linking process.</p>\n<p>Download the AAR manually (for example, for AppCompat 1.6.1):</p>\n<pre><code>https://repo1.maven.org/maven2/androidx/appcompat/appcompat/1.6.1/appcompat-1.6.1.aar \n</code></pre>\n<p>Unzip it:</p>\n<pre><code>unzip appcompat-1.6.1.aar -d ./external/appcompat\n</code></pre>\n<p>This will give you:</p>\n<ul>\n<li><p><code>res/</code></p>\n</li>\n<li><p><code>AndroidManifest.xml</code></p>\n</li>\n<li><p><code>classes.jar</code></p>\n</li>\n<li><p><code>R.txt</code></p>\n</li>\n<li><p>and others</p>\n</li>\n</ul>\n<h4>2. <strong>Compile AppCompatâ€™s Resources</strong></h4>\n<pre><code>aapt2 compile -o ./compiled_res/appcompat/ -v \\   ./external/appcompat/res/**/*.xml \n</code></pre>\n<p>(Adjust path pattern depending on your OS / shell.)</p>\n<h4>3. <strong>Link With AppCompat Resources</strong></h4>\n<p>Now, include those in your <code>aapt2 link</code> call:</p>\n<pre><code>aapt2 link \\\n  -o ./linked_apks/com.example.helloworld.apk \\\n  -I ./lib/android.jar \\\n  --manifest ./compiled_res/main/AndroidManifest.xml \\\n  --java ./build/gen \\\n  --custom-package com.example.helloworld \\\n  --auto-add-overlay \\\n  -R ./compiled_res/main/com.example.helloworld.zip \\\n  -R ./compiled_res/appcompat/*.flat\n</code></pre>\n<p>That should resolve the missing theme reference...</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1709533,
      "reputation" : 2221,
      "user_id" : 1567855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/VqBsq.jpg?s=256",
      "display_name" : "Bashu",
      "link" : "https://stackoverflow.com/users/1567855/bashu"
    },
    "creation_date" : 1750563529,
    "last_activity_date" : 1750563529,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79674875" : [ {
      "comment_id" : 140532607,
      "post_id" : 79674875,
      "body" : "But this would generate R.java with the resource ids of appcompat as well and I am trying to generate R.java only for com.example.helloworld.",
      "score" : 0,
      "owner" : {
        "account_id" : 42651085,
        "reputation" : 26,
        "user_id" : 30856992,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/684a858070a185e5ab7cb26bc5312931?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Rahil",
        "link" : "https://stackoverflow.com/users/30856992/rahil"
      },
      "creation_date" : 1750578471,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}