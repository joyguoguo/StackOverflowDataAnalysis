{
  "question" : {
    "question_id" : 79679063,
    "title" : "InvalidDataAccessApiUsageException: org.hibernate.TransientObjectException: persistent instance references an unsaved transient instance",
    "body" : "<p>I have the following Hibernate tables in Spring Boot 3.5.0 application:</p>\n<pre><code>    import com.fasterxml.jackson.annotation.JsonIgnore;\n\n    import org.hibernate.annotations.NotFound;\n    import org.hibernate.annotations.NotFoundAction;\n\n    import java.util.UUID;\n\n    import jakarta.persistence.CascadeType;\n    import jakarta.persistence.Column;\n    import jakarta.persistence.Entity;\n    import jakarta.persistence.Id;\n    import jakarta.persistence.JoinColumn;\n    import jakarta.persistence.ManyToOne;\n    import jakarta.persistence.OneToOne;\n    import jakarta.persistence.Table;\n\n    import lombok.Getter;\n    import lombok.Setter;\n\n    @Entity\n    @Table(name = &quot;available_routes&quot;)\n    @Getter\n    @Setter\n    public class AvailableRoutes {\n\n      @Id\n      @Column(name = &quot;id&quot;, nullable = false)\n      private UUID id;\n\n      @ManyToOne\n      @JoinColumn(name = &quot;account_group_internal_id&quot;)\n      @JsonIgnore\n      private AccountGroup accountGroup;\n\n      @Column(name = &quot;city_id&quot;)\n      private String cityId;\n\n      @OneToOne(cascade = {CascadeType.PERSIST})\n      @JoinColumn(name = &quot;account_config_internal_id&quot;, nullable = true)\n      @NotFound(action = NotFoundAction.IGNORE)\n      private AccountConfiguration accountConfiguration;\n    }\n\n\n\n    import java.util.UUID;\n\n    import jakarta.persistence.Column;\n    import jakarta.persistence.Entity;\n    import jakarta.persistence.Id;\n    import jakarta.persistence.Table;\n\n    import lombok.Getter;\n    import lombok.Setter;\n\n    @Entity\n    @Table(name = &quot;account_configurations&quot;)\n    @Getter\n    @Setter\n    public class AccountConfiguration {\n\n      @Id\n      @Column(name = &quot;internal_id&quot;, nullable = false)\n      private Long internalId;\n\n      @Column(name = &quot;id&quot;, nullable = false)\n      private UUID id;\n\n      @Transient\n      AvailableRoutes availableRoutes;  \n    }\n\n\n\n@Entity\n@Table(name = &quot;account_groups&quot;)\n@Getter\n@Setter\npublic class AccountGroup {\n\n  @Id\n  @Column(name = &quot;internal_id&quot;, nullable = false)\n  private Long internalId;\n\n  @Column(name = &quot;id&quot;, nullable = false)\n  private UUID id;\n\n  @OneToOne(fetch = FetchType.LAZY, mappedBy = &quot;accountGroup&quot;)\n  private TravelConfiguration TravelConfiguration;\n\n}\n\n\n\nimport com.fasterxml.jackson.annotation.JsonIgnore;\n\nimport java.util.UUID;\n\nimport jakarta.persistence.Column;\nimport jakarta.persistence.Entity;\nimport jakarta.persistence.Id;\nimport jakarta.persistence.JoinColumn;\nimport jakarta.persistence.OneToOne;\nimport jakarta.persistence.Table;\n\nimport lombok.Getter;\nimport lombok.Setter;\n\n@Entity\n@Table(name = &quot;travel_configurations&quot;)\n@Getter\n@Setter\npublic class TravelConfiguration {\n\n  @Id\n  @Column(name = &quot;internal_id&quot;, nullable = false)\n  private Long internalId;\n\n  @Column(name = &quot;id&quot;, nullable = false)\n  private UUID id;\n\n  @OneToOne\n  @JoinColumn(name = &quot;account_group_internal_id&quot;)\n  @JsonIgnore\n  private AccountGroup accountGroup;\n\n}\n</code></pre>\n<p>When I try to delete entry into AvailableRoutes I get error:</p>\n<pre><code>org.springframework.dao.InvalidDataAccessApiUsageException: org.hibernate.TransientObjectException: persistent instance references an unsaved transient instance of 'com.domain.AvailableRoutes' (save the transient instance before flushing)\n        at org.springframework.orm.jpa.EntityManagerFactoryUtils.convertJpaAccessExceptionIfPossible(EntityManagerFactoryUtils.java:368) ~[spring-orm-6.2.7.jar!/:6.2.\n.......\n    Caused by: org.hibernate.TransientObjectException: persistent instance references an unsaved transient instance of 'com.domain.AvailableRoutes' (save the transient instance before flushing)\n</code></pre>\n<p>Do you know how I can fix this issue?</p>\n",
    "tags" : [ "java", "hibernate", "spring-data-jpa", "hibernate-mapping" ],
    "owner" : {
      "account_id" : 965625,
      "reputation" : 914,
      "user_id" : 1103606,
      "user_type" : "registered",
      "accept_rate" : 51,
      "profile_image" : "https://www.gravatar.com/avatar/0d93cc650b93939ea91066fcb5aefae0?s=256&d=identicon&r=PG",
      "display_name" : "Peter Penzov",
      "link" : "https://stackoverflow.com/users/1103606/peter-penzov"
    },
    "is_answered" : false,
    "view_count" : 235,
    "answer_count" : 2,
    "score" : 2,
    "last_activity_date" : 1751972272,
    "creation_date" : 1750855717,
    "link" : "https://stackoverflow.com/questions/79679063/invaliddataaccessapiusageexception-org-hibernate-transientobjectexception-pers",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79681612,
    "question_id" : 79679063,
    "body" : "<pre><code>@OneToOne(cascade = CascadeType.ALL)\n\n@JoinColumn(name = &quot;account_config_internal_id&quot;, nullable = true)\n\n@NotFound(action = NotFoundAction.IGNORE)\n\nprivate AccountConfiguration accountConfiguration;\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 27982614,
      "reputation" : 1,
      "user_id" : 21370102,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a/AGNmyxa7_tgzej_4rwneWe8Fjl41WywXUZIKWr_jkCqe=k-s256",
      "display_name" : "zhong yi",
      "link" : "https://stackoverflow.com/users/21370102/zhong-yi"
    },
    "creation_date" : 1751012034,
    "last_activity_date" : 1751037082,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79694124,
    "question_id" : 79679063,
    "body" : "<h4>1. Save the Referenced Object First</h4>\n<p>The most direct approach is to explicitly save the <code>AvailableRoutes</code> object before you save the entity that references it. This makes the <code>AvailableRoutes</code> object <strong>persistent</strong>, giving it a database ID that Hibernate can use.</p>\n<h4>2. Use Cascade Operations</h4>\n<p>A cleaner, more common solution is to tell Hibernate to automatically save the child object whenever the parent is saved. You do this using the <code>cascade</code> attribute on the relationship annotation in the parent entity.</p>\n<p>Modify the parent entity (the one that contains the <code>AvailableRoutes</code> field) to include <code>cascade = CascadeType.PERSIST</code> or <code>cascade = CascadeType.ALL</code>.</p>\n<ul>\n<li><p><strong><code>CascadeType.PERSIST</code></strong>: When the parent is saved, the associated child is saved too.</p>\n</li>\n<li><p><strong><code>CascadeType.ALL</code></strong>: Propagates all operations (save, update, delete, etc.) from the parent to the child. This is useful when the child's lifecycle is completely dependent on the parent.</p>\n</li>\n</ul>\n<p>With cascading enabled, your original code will work without errors because saving the <code>Trip</code> will now automatically save the <code>AvailableRoutes</code> object first.</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 11164402,
      "reputation" : 574,
      "user_id" : 8193521,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-yEpN-_ecvcw/AAAAAAAAAAI/AAAAAAAAC8A/r33hYEOeSGE/s256-rj/photo.jpg",
      "display_name" : "olgunyldz",
      "link" : "https://stackoverflow.com/users/8193521/olgunyldz"
    },
    "creation_date" : 1751972272,
    "last_activity_date" : 1751972272,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140575995,
    "post_id" : 79679063,
    "body" : "Remove <code>cascade</code> from <code>@OneToOne(cascade = {CascadeType.PERSIST})</code> and try... it will be just <code>@OneToOne</code>",
    "score" : 0,
    "owner" : {
      "account_id" : 1066374,
      "reputation" : 31804,
      "user_id" : 1066828,
      "user_type" : "registered",
      "accept_rate" : 95,
      "profile_image" : "https://www.gravatar.com/avatar/8785d8636d0dc68405fee1e9aa41728a?s=256&d=identicon&r=PG",
      "display_name" : "Fahim Parkar",
      "link" : "https://stackoverflow.com/users/1066828/fahim-parkar"
    },
    "creation_date" : 1752047222,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140546395,
    "post_id" : 79679063,
    "body" : "Try looking at <a href=\"https://stackoverflow.com/a/1045426\">stackoverflow.com/a/1045426</a>",
    "score" : 1,
    "owner" : {
      "account_id" : 40864244,
      "reputation" : 632,
      "user_id" : 30001713,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f59ea01a76709335047f0cee269d788e?s=256&d=identicon&r=PG",
      "display_name" : "biggujo",
      "link" : "https://stackoverflow.com/users/30001713/biggujo"
    },
    "creation_date" : 1751007275,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79681612" : [ {
      "comment_id" : 140561872,
      "post_id" : 79681612,
      "body" : "I tested the proposed solution but it&#39;s not working. Other ideas?",
      "score" : 0,
      "owner" : {
        "account_id" : 965625,
        "reputation" : 914,
        "user_id" : 1103606,
        "user_type" : "registered",
        "accept_rate" : 51,
        "profile_image" : "https://www.gravatar.com/avatar/0d93cc650b93939ea91066fcb5aefae0?s=256&d=identicon&r=PG",
        "display_name" : "Peter Penzov",
        "link" : "https://stackoverflow.com/users/1103606/peter-penzov"
      },
      "creation_date" : 1751544574,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140546583,
      "post_id" : 79681612,
      "body" : "Your answer could be improved with additional supporting information. Please <a href=\"https://stackoverflow.com/posts/79681612/edit\">edit</a> to add further details, such as citations or documentation, so that others can confirm that your answer is correct. You can find more information on how to write good answers <a href=\"/help/how-to-answer\">in the help center</a>.",
      "score" : 0,
      "owner" : {
        "account_id" : -1,
        "reputation" : 1,
        "user_id" : -1,
        "user_type" : "moderator",
        "profile_image" : "https://www.gravatar.com/avatar/a007be5a61f6aa8f3e85ae2fc18dd66e?s=256&d=identicon&r=PG",
        "display_name" : "Community",
        "link" : "https://stackoverflow.com/users/-1/community"
      },
      "creation_date" : 1751012806,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}