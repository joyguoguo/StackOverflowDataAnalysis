{
  "question" : {
    "question_id" : 79807926,
    "title" : "Strange evaluation order of Spring Statemachine",
    "body" : "<p>This is my psvm:</p>\n<pre class=\"lang-java prettyprint-override\"><code>sendEvent(sm, &quot;not, tomorrah!&quot;);\nsendEvent(sm, &quot;not, tomorrah!&quot;);\nsendEvent(sm, &quot;not, tomorrah!&quot;);\nsendEvent(sm, &quot;tomorrow&quot;);\n\nprivate static void sendEvent(StateMachine&lt;String, String&gt; stateMachine, String event) {\n    stateMachine.sendEvent(MessageBuilder.withPayload(&quot;!&quot;).setHeader(&quot;event&quot;, event).build());\n}\n</code></pre>\n<p>There is config of statemachine. I have multiple transitions from D state:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@SneakyThrows\nprivate static StateMachine&lt;String, String&gt; toStateMachine(java.util.Set&lt;String&gt; states, List&lt;? extends Transition&gt; transitions) {\n    AtomicInteger i = new AtomicInteger();\n    StateMachineBuilder.Builder&lt;String, String&gt; builder = StateMachineBuilder.builder();\n    builder.configureStates().withStates().initial(&quot;D&quot;).states(states);\n    builder.configureTransitions().withExternal().source(&quot;D&quot;).target(&quot;D+&quot;).event(&quot;!&quot;).guard(ctx -&gt; {\n        System.out.println(&quot;evaluating DATE...&quot;);\n        return &quot;tomorrow&quot;.equals(ctx.getMessage().getHeaders().get(&quot;event&quot;));\n    });\n    builder.configureTransitions().withExternal().source(&quot;D&quot;).target(&quot;RETRY&quot;).event(&quot;!&quot;).guard(_ -&gt; {\n        System.out.println(&quot;evaluating RETRY...&quot;);\n        return i.getAndIncrement() &lt;= 2;\n    });\n    builder.configureTransitions().withExternal().source(&quot;D&quot;).target(&quot;OPERATOR&quot;).event(&quot;!&quot;).guard(_ -&gt; {\n        System.out.println(&quot;evaluating ANY...&quot;);\n        return true;\n    });\n    builder.configureTransitions().withExternal().source(&quot;RETRY&quot;).target(&quot;D&quot;);\n    return builder.build();\n}\n</code></pre>\n<p>I've got these logs:</p>\n<pre class=\"lang-none prettyprint-override\"><code>evaluating RETRY...\nState changed from RETRY to D\nState changed from D to RETRY\nevaluating DATE...\nevaluating RETRY...\nState changed from RETRY to D\nState changed from D to RETRY\nevaluating DATE...\nevaluating RETRY...\nevaluating ANY...\nState changed from D to OPERATOR\n</code></pre>\n<p>But I need to eval DATE first. I  want to get this, if less errors</p>\n<pre class=\"lang-none prettyprint-override\"><code>State changed from null to D\nevaluating DATE...\nevaluating RETRY...\nState changed from RETRY to D\nState changed from D to RETRY\nevaluating DATE...\nevaluating RETRY...\nState changed from RETRY to D\nState changed from D to RETRY\nevaluating DATE...\nState changed from D to D+\n</code></pre>\n<p>I don't understand the order of evaluation.</p>\n",
    "tags" : [ "java", "spring", "spring-statemachine" ],
    "owner" : {
      "account_id" : 21293776,
      "reputation" : 11,
      "user_id" : 15670595,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AOh14GhuPcFpx3_2gUQnhz2uexbXF5UN_Xv4FgFi1ZZwGA=k-s256",
      "display_name" : "Denys Patsera",
      "link" : "https://stackoverflow.com/users/15670595/denys-patsera"
    },
    "is_answered" : false,
    "view_count" : 92,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1762196448,
    "creation_date" : 1762177606,
    "link" : "https://stackoverflow.com/questions/79807926/strange-evaluation-order-of-spring-statemachine",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}