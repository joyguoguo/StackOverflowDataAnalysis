{
  "question" : {
    "question_id" : 79787056,
    "title" : "Spring Security: AccessDeniedException with redirecting to the login page without OAuth 2 authentication",
    "body" : "<p>I follow the book Pro Spring Security 6 and try to make a simple OAuth 2 authentication. My configuration:</p>\n<pre><code>@Configuration\n@EnableWebSecurity\npublic class SpringSecurityConfiguration {\n\n    @Bean\n    SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n        return http\n                .authorizeHttpRequests(auth -&gt; auth\n                        .requestMatchers(&quot;/&quot;).permitAll()\n                        .requestMatchers(&quot;/welcome&quot;).permitAll()\n                        .anyRequest().authenticated())\n                .oauth2Client(Customizer.withDefaults())\n                .formLogin(Customizer.withDefaults())\n                .build();\n    }\n}\n</code></pre>\n<p>My application.properties:</p>\n<pre><code>spring.application.name=OAuth2SecurityLogin\n\n# GitHub Login\nspring.security.oauth2.client.registration.github.client-id=x\nspring.security.oauth2.client.registration.github.client-secret=x\n\nlogging.level.org.springframework.security=TRACE\n</code></pre>\n<p>The endpoints / and /welcome are working fine and everyone can access them. But when trying to access the other secured endpoint I get this error:</p>\n<pre><code>org.springframework.security.access.AccessDeniedException: Access Denied\n    at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:98) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.oauth2.client.web.OAuth2AuthorizationCodeGrantFilter.doFilterInternal(OAuth2AuthorizationCodeGrantFilter.java:183) ~[spring-security-oauth2-client-6.1.3.jar:6.1.3]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.authentication.ui.DefaultLogoutPageGeneratingFilter.doFilterInternal(DefaultLogoutPageGeneratingFilter.java:58) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.authentication.ui.DefaultLoginPageGeneratingFilter.doFilter(DefaultLoginPageGeneratingFilter.java:188) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.authentication.ui.DefaultLoginPageGeneratingFilter.doFilter(DefaultLoginPageGeneratingFilter.java:174) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:227) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:221) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.oauth2.client.web.OAuth2AuthorizationRequestRedirectFilter.doFilterInternal(OAuth2AuthorizationRequestRedirectFilter.java:181) ~[spring-security-oauth2-client-6.1.3.jar:6.1.3]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.csrf.CsrfFilter.doFilterInternal(CsrfFilter.java:117) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191) ~[spring-security-web-6.1.3.jar:6.1.3]\n    at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:166) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:341) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:894) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1740) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n    at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) ~[tomcat-embed-core-10.1.12.jar:10.1.12]\n</code></pre>\n<p>Then I'm redirected to the login page where there is no OAuth 2 authentication method. Just username and password.\n<a href=\"https://i.sstatic.net/cWGG2CWg.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/cWGG2CWg.png\" alt=\"The login page\" /></a></p>\n<p>My controller</p>\n<pre><code>@Controller\npublic class UserController {\n\n    @GetMapping(&quot;/&quot;)\n    public String homePage() {\n        return &quot;welcome&quot;;\n    }\n\n    @GetMapping(&quot;/welcome&quot;)\n    public String welcomePage() {\n        return &quot;welcome&quot;;\n    }\n\n    @GetMapping(&quot;/authenticated&quot;)\n    public String authenticatedPage() {\n        return &quot;authenticated&quot;;\n    }\n\n    @GetMapping(&quot;/logout&quot;)\n    public String logoutPage() {\n        return &quot;redirect:/welcome&quot;;\n    }\n}\n</code></pre>\n<p>I tried to change the version of Spring Boot by switching the newest version 3.5.6 with the version from the book 3.1.3 but it didn't help. I also tried to access the secured endpoint from the incognito mode.</p>\n",
    "tags" : [ "java", "spring", "spring-boot", "spring-security", "oauth-2.0" ],
    "owner" : {
      "account_id" : 20433810,
      "reputation" : 45,
      "user_id" : 14992170,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-D4sRNibiW_8/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucmKDOFIgD9xYg6o6h5cMYUFfe22Kg/s96-c/s256-rj/photo.jpg",
      "display_name" : "Arkadi",
      "link" : "https://stackoverflow.com/users/14992170/arkadi"
    },
    "is_answered" : true,
    "view_count" : 94,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1760115055,
    "creation_date" : 1760078486,
    "link" : "https://stackoverflow.com/questions/79787056/spring-security-accessdeniedexception-with-redirecting-to-the-login-page-withou",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79787553,
    "question_id" : 79787056,
    "body" : "<p>Use <a href=\"https://docs.spring.io/spring-security/reference/servlet/oauth2/login/core.html\" rel=\"nofollow noreferrer\"><code>oauth2Login</code></a>, not <code>formLogin</code></p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 308139,
      "reputation" : 13879,
      "user_id" : 619830,
      "user_type" : "registered",
      "accept_rate" : 75,
      "profile_image" : "https://www.gravatar.com/avatar/f4d00b0a82e9307b1d68b29867fee4e5?s=256&d=identicon&r=PG",
      "display_name" : "ch4mp",
      "link" : "https://stackoverflow.com/users/619830/ch4mp"
    },
    "creation_date" : 1760115055,
    "last_activity_date" : 1760115055,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140790011,
    "post_id" : 79787056,
    "body" : "@ozkanpakdil yes. Client id and client secret are valid",
    "score" : 0,
    "owner" : {
      "account_id" : 20433810,
      "reputation" : 45,
      "user_id" : 14992170,
      "user_type" : "registered",
      "profile_image" : "https://lh4.googleusercontent.com/-D4sRNibiW_8/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucmKDOFIgD9xYg6o6h5cMYUFfe22Kg/s96-c/s256-rj/photo.jpg",
      "display_name" : "Arkadi",
      "link" : "https://stackoverflow.com/users/14992170/arkadi"
    },
    "creation_date" : 1760186007,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140789065,
    "post_id" : 79787056,
    "body" : "have you created clientid and secrets as described <a href=\"https://www.baeldung.com/spring-security-5-oauth2-login\" rel=\"nofollow noreferrer\">here</a> oauth requires one more backend to do the authentication, looks like your setup is missing that.",
    "score" : 0,
    "owner" : {
      "account_id" : 58650,
      "reputation" : 4945,
      "user_id" : 175554,
      "user_type" : "registered",
      "accept_rate" : 40,
      "profile_image" : "https://i.sstatic.net/KmFczdGy.jpg?s=256",
      "display_name" : "ozkanpakdil",
      "link" : "https://stackoverflow.com/users/175554/ozkanpakdil"
    },
    "creation_date" : 1760119713,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79787553" : [ {
      "comment_id" : 140790407,
      "post_id" : 79787553,
      "body" : "Notwithstanding you have already mentioned it, after hours of inspection I found out that I was using oauth2Client instead of oauth2Login. My silly mistake. Thank you though.",
      "score" : 0,
      "owner" : {
        "account_id" : 20433810,
        "reputation" : 45,
        "user_id" : 14992170,
        "user_type" : "registered",
        "profile_image" : "https://lh4.googleusercontent.com/-D4sRNibiW_8/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucmKDOFIgD9xYg6o6h5cMYUFfe22Kg/s96-c/s256-rj/photo.jpg",
        "display_name" : "Arkadi",
        "link" : "https://stackoverflow.com/users/14992170/arkadi"
      },
      "creation_date" : 1760209351,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140789963,
      "post_id" : 79787553,
      "body" : "Without formLogin it gives me &quot;HTTP ERROR 403&quot; when accessing a secured endpoint and the same error message persists.",
      "score" : 0,
      "owner" : {
        "account_id" : 20433810,
        "reputation" : 45,
        "user_id" : 14992170,
        "user_type" : "registered",
        "profile_image" : "https://lh4.googleusercontent.com/-D4sRNibiW_8/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucmKDOFIgD9xYg6o6h5cMYUFfe22Kg/s96-c/s256-rj/photo.jpg",
        "display_name" : "Arkadi",
        "link" : "https://stackoverflow.com/users/14992170/arkadi"
      },
      "creation_date" : 1760183531,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}