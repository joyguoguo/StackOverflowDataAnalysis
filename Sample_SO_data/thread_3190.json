{
  "question" : {
    "question_id" : 79566327,
    "title" : "Cannot read request body from HttpServletRequest when Content-Type is multipart/mixed",
    "body" : "<p>Below code handles the incoming API calls:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@RequestMapping(value = &quot;**&quot;)\nvoid process(HttpServletRequest request, HttpServletResponse response) throws IOException {\n    if (request.getInputStream().available() &gt; 0) {\n        System.out.println(&quot;Input Stream data present&quot;);\n    }\n}\n</code></pre>\n<p>I run my API call from Postman like below:</p>\n<pre class=\"lang-bash prettyprint-override\"><code>curl --location --request POST 'http://localhost:8084/api/v1/inv/$batch' \\\n--header 'Content-Type: multipart/mixed;boundary=abc123;' \\\n--data-raw '--abc123\nContent-Type: application/http\nContent-Transfer-Encoding: binary\n\nGET http://localhost:8084/api/v1/inv/Port_Type HTTP/1.1\n\n--abc123\nContent-Type: application/http\nContent-Transfer-Encoding: binary\n\nGET http://localhost:8084/api/v1/inv/Device_Type HTTP/1.1\n\n--abc123--\n'\n</code></pre>\n<p><code>request.getInputStream().available()</code> always returns 0 but it returns a non-zero value when the <code>Content-Type</code> is <strong>not</strong> <code>multipart/mixed</code>.</p>\n<p>One interesting thing I noticed is that when I modify the code to read the request body using a <code>BufferedReader</code>,<br />\nI get an exception saying that <code>getInputStream() has already been called for this request</code></p>\n<pre><code>public void process(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {\n    BufferedReader reader = request.getReader();\n}\n</code></pre>\n<p>Looks like <code>getInputStream()</code> is being invoked even before reaching the controller.</p>\n",
    "tags" : [ "java", "spring-boot", "microservices", "multipart" ],
    "owner" : {
      "account_id" : 5448022,
      "reputation" : 1232,
      "user_id" : 4333846,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/74ae80b9e04de579919599c45d9a1726?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Harish R",
      "link" : "https://stackoverflow.com/users/4333846/harish-r"
    },
    "is_answered" : true,
    "view_count" : 171,
    "answer_count" : 1,
    "score" : 5,
    "last_activity_date" : 1744730809,
    "creation_date" : 1744279159,
    "link" : "https://stackoverflow.com/questions/79566327/cannot-read-request-body-from-httpservletrequest-when-content-type-is-multipart",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79573210,
    "question_id" : 79566327,
    "body" : "<p>You need to get the part and then read its input stream.\nTry the following:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public void process(HttpServletRequest request, HttpServletResponse response) throws Exception {\n    for (Part part : request.getParts()) {\n        if (part.getInputStream().available() &gt; 0) {\n            System.out.println(&quot;Input Stream data present&quot;);\n        }\n    }\n}\n</code></pre>\n<p>And following changes are needed in the <strong>curl</strong> command:</p>\n<ul>\n<li>add <code>Content-Disposition: form-data; name=&quot;part_name&quot;</code></li>\n<li>add <code>\\r\\n</code> between lines</li>\n<li>add <code>$</code> to make bash to interpret the <code>\\r</code> and \\n</li>\n</ul>\n<p>So the <strong>curl</strong> command will look like:</p>\n<pre class=\"lang-bash prettyprint-override\"><code>curl --location --request POST 'http://localhost:8084/api/v1/inv/$batch' \\\n--header 'Content-Type: multipart/mixed;boundary=abc123;' \\\n--data-raw $'--abc123\\r\\nContent-Type: application/http\\r\\nContent-Disposition: form-data; name=&quot;part1&quot;\\r\\nContent-Transfer-Encoding: binary\\r\\n\\r\\nGET http://localhost:8084/api/v1/inv/Port_Type HTTP/1.1\\r\\n\\r\\n--abc123\\r\\nContent-Type: application/http\\r\\nContent-Disposition: form-data; name=&quot;part2&quot;\\r\\nContent-Transfer-Encoding: binary\\r\\n\\r\\nGET http://localhost:8084/api/v1/inv/Device_Type HTTP/1.1\\r\\n\\r\\n--abc123--\\r\\n'\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 10320634,
      "reputation" : 3398,
      "user_id" : 7613649,
      "user_type" : "registered",
      "accept_rate" : 25,
      "profile_image" : "https://www.gravatar.com/avatar/c95137fce225c304ac42743da3816d6c?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Geba",
      "link" : "https://stackoverflow.com/users/7613649/geba"
    },
    "creation_date" : 1744635586,
    "last_activity_date" : 1744705522,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140339192,
    "post_id" : 79566327,
    "body" : "Cool. thank you :)",
    "score" : 0,
    "owner" : {
      "account_id" : 5448022,
      "reputation" : 1232,
      "user_id" : 4333846,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/74ae80b9e04de579919599c45d9a1726?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Harish R",
      "link" : "https://stackoverflow.com/users/4333846/harish-r"
    },
    "creation_date" : 1744773235,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140337526,
    "post_id" : 79566327,
    "body" : "Hi! I have made few edits of your question (e.g. remove the <b>OpenAPI</b> annotations (<code>@Operation</code>, <code>@ApiResponses</code>)) They don&#39;t affect the issue, and I&#39;d like to make your question more general.   This would help others who encounter similar problems with <code>Spring Boot</code> and <code>multipart&#47;mixed</code> more easily.  Thank you for accepting my answer \uD83D\uDE42",
    "score" : 0,
    "owner" : {
      "account_id" : 10320634,
      "reputation" : 3398,
      "user_id" : 7613649,
      "user_type" : "registered",
      "accept_rate" : 25,
      "profile_image" : "https://www.gravatar.com/avatar/c95137fce225c304ac42743da3816d6c?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Geba",
      "link" : "https://stackoverflow.com/users/7613649/geba"
    },
    "creation_date" : 1744730876,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140323318,
    "post_id" : 79566327,
    "body" : "I&#39;m saying that <i>multipart</i> requests are treated differently than <i>form-urlencoded</i> in the <code>java ee</code> (<code>jakarta ee</code>) servlet. Since <code>spring-boot</code> largely follows the EE specification, you may need to specify that you will be handling a <i>multipart</i> request to access its body.",
    "score" : 0,
    "owner" : {
      "account_id" : 6179310,
      "reputation" : 2907,
      "user_id" : 4815321,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c7f1efe4e3c5d007dc7c5cc7d5a64e95?s=256&d=identicon&r=PG",
      "display_name" : "mr mcwolf",
      "link" : "https://stackoverflow.com/users/4815321/mr-mcwolf"
    },
    "creation_date" : 1744353543,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140323225,
    "post_id" : 79566327,
    "body" : "@mrmcwolf sorry, I didn&#39;t get what you are trying to convey",
    "score" : 0,
    "owner" : {
      "account_id" : 5448022,
      "reputation" : 1232,
      "user_id" : 4333846,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/74ae80b9e04de579919599c45d9a1726?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Harish R",
      "link" : "https://stackoverflow.com/users/4333846/harish-r"
    },
    "creation_date" : 1744351715,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140323128,
    "post_id" : 79566327,
    "body" : "In javaee (jakartaee) a servlet that handles a multipart request must be explicitly declared as such. Check if there is no similar requirement in springboot.",
    "score" : 0,
    "owner" : {
      "account_id" : 6179310,
      "reputation" : 2907,
      "user_id" : 4815321,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/c7f1efe4e3c5d007dc7c5cc7d5a64e95?s=256&d=identicon&r=PG",
      "display_name" : "mr mcwolf",
      "link" : "https://stackoverflow.com/users/4815321/mr-mcwolf"
    },
    "creation_date" : 1744349544,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140321396,
    "post_id" : 79566327,
    "body" : "@Vijay it&#39;s still empty",
    "score" : 0,
    "owner" : {
      "account_id" : 5448022,
      "reputation" : 1232,
      "user_id" : 4333846,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/74ae80b9e04de579919599c45d9a1726?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Harish R",
      "link" : "https://stackoverflow.com/users/4333846/harish-r"
    },
    "creation_date" : 1744301980,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140321229,
    "post_id" : 79566327,
    "body" : "Instead of alling .available(), try calling below. String body = new BufferedReader(new InputStreamReader(request.getInputStream()))                  .lines().collect(Collectors.joining(&quot;\\n&quot;)); System.out.println(&quot;BODY: &quot; + body);",
    "score" : 0,
    "owner" : {
      "account_id" : 7645025,
      "reputation" : 440,
      "user_id" : 5795975,
      "user_type" : "registered",
      "profile_image" : "https://lh6.googleusercontent.com/-6KwPUS4RnyA/AAAAAAAAAAI/AAAAAAAAC8w/auZqreI45x0/s256-rj/photo.jpg",
      "display_name" : "Vijay",
      "link" : "https://stackoverflow.com/users/5795975/vijay"
    },
    "creation_date" : 1744299465,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140320045,
    "post_id" : 79566327,
    "body" : "Please put that information in the question - along with where <code>IOUtils</code> comes from (there must be hundreds of classes called that).",
    "score" : 1,
    "owner" : {
      "account_id" : 11683,
      "reputation" : 1520872,
      "user_id" : 22656,
      "user_type" : "registered",
      "accept_rate" : 86,
      "profile_image" : "https://www.gravatar.com/avatar/6d8ebb117e8d83d74ea95fbdd0f87e13?s=256&d=identicon&r=PG",
      "display_name" : "Jon Skeet",
      "link" : "https://stackoverflow.com/users/22656/jon-skeet"
    },
    "creation_date" : 1744283643,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140319899,
    "post_id" : 79566327,
    "body" : "Tried the code: <code>String myString = IOUtils.toString(request.getInputStream(), &quot;UTF-8&quot;);</code> Getting empty string",
    "score" : 0,
    "owner" : {
      "account_id" : 5448022,
      "reputation" : 1232,
      "user_id" : 4333846,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/74ae80b9e04de579919599c45d9a1726?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Harish R",
      "link" : "https://stackoverflow.com/users/4333846/harish-r"
    },
    "creation_date" : 1744281111,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140319845,
    "post_id" : 79566327,
    "body" : "Have you tried reading from the stream even though <code>available()</code> returns 0? <code>available()</code> only tells you how much data is <i>immediately</i> available without blocking.",
    "score" : 0,
    "owner" : {
      "account_id" : 11683,
      "reputation" : 1520872,
      "user_id" : 22656,
      "user_type" : "registered",
      "accept_rate" : 86,
      "profile_image" : "https://www.gravatar.com/avatar/6d8ebb117e8d83d74ea95fbdd0f87e13?s=256&d=identicon&r=PG",
      "display_name" : "Jon Skeet",
      "link" : "https://stackoverflow.com/users/22656/jon-skeet"
    },
    "creation_date" : 1744280123,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79573210" : [ {
      "comment_id" : 140336512,
      "post_id" : 79573210,
      "body" : "Thanks a lot! It worked after giving <code>Content-Disposition</code>",
      "score" : 0,
      "owner" : {
        "account_id" : 5448022,
        "reputation" : 1232,
        "user_id" : 4333846,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/74ae80b9e04de579919599c45d9a1726?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Harish R",
        "link" : "https://stackoverflow.com/users/4333846/harish-r"
      },
      "creation_date" : 1744717033,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140335864,
      "post_id" : 79573210,
      "body" : "try edited curl. I have tested, it works in my environment",
      "score" : 0,
      "owner" : {
        "account_id" : 10320634,
        "reputation" : 3398,
        "user_id" : 7613649,
        "user_type" : "registered",
        "accept_rate" : 25,
        "profile_image" : "https://www.gravatar.com/avatar/c95137fce225c304ac42743da3816d6c?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Geba",
        "link" : "https://stackoverflow.com/users/7613649/geba"
      },
      "creation_date" : 1744706022,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140335260,
      "post_id" : 79573210,
      "body" : "Nope. It&#39;s not even entering inside the <code>for</code> loop. <code>request.getParts()</code> returning an empty list",
      "score" : 0,
      "owner" : {
        "account_id" : 5448022,
        "reputation" : 1232,
        "user_id" : 4333846,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/74ae80b9e04de579919599c45d9a1726?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "Harish R",
        "link" : "https://stackoverflow.com/users/4333846/harish-r"
      },
      "creation_date" : 1744689798,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}