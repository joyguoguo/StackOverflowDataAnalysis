{
  "question" : {
    "question_id" : 79708726,
    "title" : "How to get the real coordinates of the gradient graphics in PDF",
    "body" : "<p>My code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>PDColorSpace colorSpace = getGraphicsState().getNonStrokingColorSpace();\nif (colorSpace instanceof PDPattern) {\n    PDPattern patternSpace = (PDPattern) colorSpace;\n    try {\n        PDAbstractPattern basePattern = patternSpace.getPattern(getGraphicsState().getNonStrokingColor());\n    \n        if (basePattern instanceof PDShadingPattern) {\n            PDShadingPattern shadingPattern = (PDShadingPattern) basePattern;\n            PDShading shading = shadingPattern.getShading();\n    \n            int shadingType = shading.getShadingType();\n            if (shadingType == PDShading.SHADING_TYPE2) { // Axial shading\n    \n                if (shading instanceof PDShadingType2) {\n    \n                    COSArray extendArray = (COSArray) shading.getCOSObject().getDictionaryObject(COSName.EXTEND);\n                    path.setExtend(String.valueOf(extendArray.size()));\n    \n                    PDShadingType2 axial = (PDShadingType2) shading;\n                    COSArray coords = axial.getCoords();\n    \n                    if (coords != null &amp;&amp; coords.size() &gt;= 4) {\n                        float x0 = ((COSNumber) coords.get(0)).floatValue();\n                        float y0 = ((COSNumber) coords.get(1)).floatValue();\n                        float x1 = ((COSNumber) coords.get(2)).floatValue();\n                        float y1 = ((COSNumber) coords.get(3)).floatValue();\n</code></pre>\n<p>The obtained x0, x1, y0, y1 do not seem to be the real first and last coordinates of the gradient shape in PDF. How can I calculate to get the real coordinates?</p>\n<p>My gradient shape is a vertical gradient, but the two x values I get are the different. Shouldn't the x value remain unchanged while the y value changes?</p>\n",
    "tags" : [ "java", "pdfbox" ],
    "owner" : {
      "account_id" : 21131086,
      "reputation" : 45,
      "user_id" : 15536335,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d6e65a42c48370f90430bb5785c6887b?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Serendipity",
      "link" : "https://stackoverflow.com/users/15536335/serendipity"
    },
    "is_answered" : true,
    "view_count" : 79,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1753240566,
    "creation_date" : 1753084214,
    "link" : "https://stackoverflow.com/questions/79708726/how-to-get-the-real-coordinates-of-the-gradient-graphics-in-pdf",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79711269,
    "question_id" : 79708726,
    "body" : "<pre><code>shadingPattern matrix:\n\nMatrix patternMatrix = shadingPattern.getMatrix();\nAffineTransform transform = patternMatrix.createAffineTransform();\n\nPoint2D.Float p0 = new Point2D.Float(x0, y0);\nPoint2D.Float p1 = new Point2D.Float(x1, y1);\nPoint2D.Float deviceP0 = (Point2D.Float) transform.transform(p0, null);\nPoint2D.Float deviceP1 = (Point2D.Float) transform.transform(p1, null);\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 21131086,
      "reputation" : 45,
      "user_id" : 15536335,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d6e65a42c48370f90430bb5785c6887b?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Serendipity",
      "link" : "https://stackoverflow.com/users/15536335/serendipity"
    },
    "creation_date" : 1753240511,
    "last_activity_date" : 1753240511,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140610641,
    "post_id" : 79708726,
    "body" : "Thank you very much, I solved the problem perfectly, hope you have a nice day!",
    "score" : 1,
    "owner" : {
      "account_id" : 21131086,
      "reputation" : 45,
      "user_id" : 15536335,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d6e65a42c48370f90430bb5785c6887b?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Serendipity",
      "link" : "https://stackoverflow.com/users/15536335/serendipity"
    },
    "creation_date" : 1753240361,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140608379,
    "post_id" : 79708726,
    "body" : "<i>&quot;How do I get the pattern matrix&quot;</i> - your <code>basePattern</code>/<code>shadingPattern</code> object has a <code>getMatrix</code> method to retrieve the matrix of that pattern. <i>&quot;... and apply it?&quot;</i> - see ISO 32000-2 section 8.7.2, in particular: <i>If a pattern is used on a page, the pattern appears in the Pattern subdictionary of that page’s resource dictionary, and the pattern matrix maps pattern space to the default (initial) coordinate space of the page. Changes to the page’s transformation matrix that occur within the page’s content stream, such as rotation and scaling, have no effect on the pattern</i>.",
    "score" : 1,
    "owner" : {
      "account_id" : 1916831,
      "reputation" : 97003,
      "user_id" : 1729265,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/VMMeP.jpg?s=256",
      "display_name" : "mkl",
      "link" : "https://stackoverflow.com/users/1729265/mkl"
    },
    "creation_date" : 1753175846,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140607805,
    "post_id" : 79708726,
    "body" : "@mkl How do I get the pattern matrix and apply it? Is there any example?",
    "score" : 0,
    "owner" : {
      "account_id" : 21131086,
      "reputation" : 45,
      "user_id" : 15536335,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d6e65a42c48370f90430bb5785c6887b?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Serendipity",
      "link" : "https://stackoverflow.com/users/15536335/serendipity"
    },
    "creation_date" : 1753163242,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140607707,
    "post_id" : 79708726,
    "body" : "@Tilman <i>&quot;This is a text using a shading pattern as a color, so you&#39;d just need the text position&quot;</i> - not exactly. The text is visibly drawn using vector graphics instructions (path building and fills) with the pattern color. Over that then a text showing instruction is used to paint fully transparent text for text extraction. Ah, and the reflection is a bitmap...",
    "score" : 1,
    "owner" : {
      "account_id" : 1916831,
      "reputation" : 97003,
      "user_id" : 1729265,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/VMMeP.jpg?s=256",
      "display_name" : "mkl",
      "link" : "https://stackoverflow.com/users/1729265/mkl"
    },
    "creation_date" : 1753158255,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140607700,
    "post_id" : 79708726,
    "body" : "<i>&quot;In the code above, I applied the matrix&quot;</i> - I might miss something but I only see you applying the current transformation matrix (at an unclear processing moment) and not the pattern matrix.",
    "score" : 0,
    "owner" : {
      "account_id" : 1916831,
      "reputation" : 97003,
      "user_id" : 1729265,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/VMMeP.jpg?s=256",
      "display_name" : "mkl",
      "link" : "https://stackoverflow.com/users/1729265/mkl"
    },
    "creation_date" : 1753157857,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140607579,
    "post_id" : 79708726,
    "body" : "@mkl In the code above, I applied the matrix, but after using the matrix, the value of x is still not equal. The vertical gradient should be equal to the value of x0 and x1, and the value of y0 and y1 is different, but what I get is the opposite",
    "score" : 0,
    "owner" : {
      "account_id" : 21131086,
      "reputation" : 45,
      "user_id" : 15536335,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d6e65a42c48370f90430bb5785c6887b?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Serendipity",
      "link" : "https://stackoverflow.com/users/15536335/serendipity"
    },
    "creation_date" : 1753150251,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140607539,
    "post_id" : 79708726,
    "body" : "@Tilman Hausherr This document contains text, but some other documents are purely drawn with paths, so I can&#39;t get the position of the text, so I want to use <code>coords</code> to get the position.",
    "score" : 0,
    "owner" : {
      "account_id" : 21131086,
      "reputation" : 45,
      "user_id" : 15536335,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d6e65a42c48370f90430bb5785c6887b?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Serendipity",
      "link" : "https://stackoverflow.com/users/15536335/serendipity"
    },
    "creation_date" : 1753147702,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140605595,
    "post_id" : 79708726,
    "body" : "<i>&quot;My gradient shape is a vertical gradient, but the two x values I get are the same. Shouldn&#39;t the x value remain unchanged while the y value changes?&quot;</i> - you also should take the pattern matrix into account. In case of your pattern that matrix is both translating and rotating.",
    "score" : 1,
    "owner" : {
      "account_id" : 1916831,
      "reputation" : 97003,
      "user_id" : 1729265,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/VMMeP.jpg?s=256",
      "display_name" : "mkl",
      "link" : "https://stackoverflow.com/users/1729265/mkl"
    },
    "creation_date" : 1753091935,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}