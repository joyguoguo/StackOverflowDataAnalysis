{
  "question" : {
    "question_id" : 79698992,
    "title" : "JasperReports ExtensionsEnvironment initialization fails with NoClassDefFoundError in OSGi/CXF environment",
    "body" : "<p>I'm getting a NoClassDefFoundError for net.sf.jasperreports.extensions.ExtensionsEnvironment when compiling JasperReports templates in an OSGi environment (using Pax Web/Jetty) with Apache CXF 3.5.5. The error occurs specifically when calling JasperCompileManager.compileReportToFile().</p>\n<p>Error Trace:</p>\n<p>Caused by: java.lang.NoClassDefFoundError: Could not initialize class net.sf.jasperreports.extensions.ExtensionsEnvironment\nat net.sf.jasperreports.engine.DefaultJasperReportsContext.getExtensions(DefaultJasperReportsContext.java:273)\n...\nCaused by: java.lang.ExceptionInInitializerError:\nat net.sf.jasperreports.engine.util.ClassUtils.instantiateClass(ClassUtils.java:81)\nat net.sf.jasperreports.extensions.ExtensionsEnvironment.createDefaultRegistry(ExtensionsEnvironment.java:91)\nat net.sf.jasperreports.extensions.ExtensionsEnvironment.(ExtensionsEnvironment.java:78)</p>\n<p>codeï¼š</p>\n<pre><code>public static void compile(String reportKey) throws JRException {\n    ClassLoader originalClassLoader = Thread.currentThread().getContextClassLoader();\n    try {\n        // Using service implementation's classloader\n        Thread.currentThread().setContextClassLoader(ExtensionsEnvironment.class.getClassLoader());\n        \n        File mainReportFile = new File(REPORT_PATH, reportKey + &quot;.xml&quot;);\n        File destFileParent = new File(REPORT_PATH + &quot;compiled/&quot;);\n        \n        JasperCompileManager.compileReportToFile( // Fails here\n            mainReportFile.getAbsolutePath(),\n            new File(destFileParent, reportKey + &quot;.jasper&quot;).getAbsolutePath()\n        );\n    } finally {\n        Thread.currentThread().setContextClassLoader(originalClassLoader);\n    }\n}\n</code></pre>\n<p>Environment:</p>\n<p>JasperReports: 7.0.3 (from stack trace)</p>\n<p>OSGi container (Karaf/Fuse)</p>\n<p>Java 17</p>\n<p>Apache CXF 3.5.5</p>\n<p>Running in Jetty via Pax Web</p>\n<p>I want to konw:</p>\n<ol>\n<li><p>Why does ExtensionsEnvironment fail to initialize during static init\nin OSGi?</p>\n</li>\n<li><p>Are there known compatibility issues between JasperReports 7.0.3 and\nCXF 3.5.5 in OSGi?</p>\n</li>\n</ol>\n",
    "tags" : [ "java", "jasper-reports", "osgi", "cxf", "noclassdeffounderror" ],
    "owner" : {
      "account_id" : 21412852,
      "reputation" : 1,
      "user_id" : 15772654,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/6d01347dc61bb6776f68c7ef0bac5198?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Arlen-Dong",
      "link" : "https://stackoverflow.com/users/15772654/arlen-dong"
    },
    "is_answered" : false,
    "view_count" : 90,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1752292965,
    "creation_date" : 1752292477,
    "link" : "https://stackoverflow.com/questions/79698992/jasperreports-extensionsenvironment-initialization-fails-with-noclassdeffounderr",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140585234,
    "post_id" : 79698992,
    "body" : "Seems like a classpath issue. There are probably two different versions of ExtensionsEnvironment. See <a href=\"https://stackoverflow.com/questions/34413/why-am-i-getting-a-noclassdeffounderror-in-java\" title=\"why am i getting a noclassdeffounderror in java\">stackoverflow.com/questions/34413/&hellip;</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 372682,
      "reputation" : 26512,
      "user_id" : 721855,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/vZiox.png?s=256",
      "display_name" : "aled",
      "link" : "https://stackoverflow.com/users/721855/aled"
    },
    "creation_date" : 1752353870,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}