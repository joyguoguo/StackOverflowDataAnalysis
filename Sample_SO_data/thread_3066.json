{
  "question" : {
    "question_id" : 79573850,
    "title" : "Multiple IgniteDataStreamer Instances",
    "body" : "<p>IgniteDataStreamer's <a href=\"https://ignite.apache.org/releases/latest/javadoc/org/apache/ignite/IgniteDataStreamer.html#addData(K,V)\" rel=\"nofollow noreferrer\">addData</a> method states that &quot;This method can be called from multiple threads in parallel to speed up streaming if needed.&quot; I'd like to know, is it also safe to use multiple IgniteDataStreamer instances to stream data into the same cache concurrently?</p>\n<p>My use case is that I'm trying to optimize the pre-load of a large cache after my Ignite cluster starts up. I'm starting from something like this:</p>\n<pre><code>try (IgniteDataStreamer&lt;K, V&gt; streamer = ignite.dataStreamer(&quot;MyCache&quot;)) {\n    try (Stream&lt;Map.Entry&lt;K, V&gt;&gt; stream = jdbcTemplate.queryForStream(\n            &quot;select * from foo where '2020-01-01'&lt;=foo.time and foo.time&lt;'2026-01-01'&quot;,\n            MY_ROW_MAPPER)) {\n        stream.forEach(entry -&gt; streamer.addData(entry.getKey(), entry.getValue()));\n    }\n}\n</code></pre>\n<p>What I'd like to do is split this up into N jobs (IgniteRunnables), each responsible for loading/streaming (e.g.) one month's worth of data into the cache. Then I would distribute the jobs evenly across my cluster by submitting them to Ignite's compute API, and wait until they all finish.</p>\n<p>My initial attempt seems to work mostly ok, except for the fact that <em>sometimes</em> I see warnings in my logs like this after the cache pre-load has finished:</p>\n<blockquote>\n<p>(Log4J2Logger.java:523) Partition states validation has failed for group: MyCache, msg: Partitions update counters are inconsistent for Part...</p>\n</blockquote>\n<p>From what I can tell, this logging is triggered by a partition map exchange (PME) event that happens when an unrelated IgniteAtomicLong gets initialized for the first time.</p>\n",
    "tags" : [ "java", "ignite" ],
    "owner" : {
      "account_id" : 8648861,
      "reputation" : 13,
      "user_id" : 6475253,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/27714d04cd1c05c0a5c7d32dc41244dd?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "jvfullam",
      "link" : "https://stackoverflow.com/users/6475253/jvfullam"
    },
    "is_answered" : true,
    "view_count" : 75,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1744658749,
    "creation_date" : 1744657547,
    "link" : "https://stackoverflow.com/questions/79573850/multiple-ignitedatastreamer-instances",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79573880,
    "question_id" : 79573850,
    "body" : "<p>There should not be any reason that you cannot run separate instances on separate hosts all streaming 1 portion of the overall data set to the same cache. The limiting factor in this proposed architecture will most likely be the network interface of the database that you are retrieving data from. Hope that helps.</p>\n",
    "score" : 3,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 27719614,
      "reputation" : 219,
      "user_id" : 21160483,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/1e4fe00ec749dcaca40ae71fc0e94d86?s=256&d=identicon&r=PG",
      "display_name" : "user21160483",
      "link" : "https://stackoverflow.com/users/21160483/user21160483"
    },
    "creation_date" : 1744658749,
    "last_activity_date" : 1744658749,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79573880" : [ {
      "comment_id" : 140334477,
      "post_id" : 79573880,
      "body" : "Thanks, this confirms my expectation (based on the lack of documentation to indicate otherwise), and answers the core of my question.  The inconsistent partition update counters I&#39;m seeing are a bit concerning (especially since I&#39;m warned of the issue only because there happens to be a PME some time later), but I&#39;ll have to dig into this part of it more.",
      "score" : 0,
      "owner" : {
        "account_id" : 8648861,
        "reputation" : 13,
        "user_id" : 6475253,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/27714d04cd1c05c0a5c7d32dc41244dd?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "jvfullam",
        "link" : "https://stackoverflow.com/users/6475253/jvfullam"
      },
      "creation_date" : 1744662824,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}