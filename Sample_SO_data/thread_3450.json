{
  "question" : {
    "question_id" : 79548781,
    "title" : "Spring MongoClientFactoryBean ignores connection pool listeners",
    "body" : "<p>I am trying to add a MongoDB JMXConnectionPoolListener to my MongoClient via Spring's MongoClientFactoryBean.  However the factory bean ignores the listener.</p>\n<p>Code looks like this:</p>\n<pre><code>    MongoClientSettings settings = MongoClientSettings.builder().applyToConnectionPoolSettings(s -&gt; s.addConnectionPoolListener(new JMXConnectionPoolListener())).build();\n    MongoClientFactoryBean factoryBean = new MongoClientFactoryBean();\n    factoryBean.setMongoClientSettings(settings);\n</code></pre>\n<p>Using the debugger, I can see that the listener gets added to the settings object that I create.  However when the factory bean actually goes to create the MongoClient, a method called <a href=\"https://github.com/spring-projects/spring-data-mongodb/blob/4886eded0e591ef4277f14146a18d50ebc104f06/spring-data-mongodb/src/main/java/org/springframework/data/mongodb/core/MongoClientFactoryBean.java#L155\" rel=\"nofollow noreferrer\">computeClientSettings</a> is called.  That method creates a new MongoClientSettings.Builder and copies over some of my settings, but not the connection pool listener.</p>\n<p>There is something like a copy constructor in MongoClientSettings.Builder, but the factory bean does not use it.</p>\n<p>Is there a way to make the factory bean preserve the connection pool listener?  I know I can do MongoClients.create(settings), but I would like to have Spring's exception translation also.</p>\n",
    "tags" : [ "java", "spring", "mongodb", "connection-pooling", "jmx" ],
    "owner" : {
      "account_id" : 4673039,
      "reputation" : 195,
      "user_id" : 3784352,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/95797b4abe040a56d82541dba47ecfd9?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "John Gregg",
      "link" : "https://stackoverflow.com/users/3784352/john-gregg"
    },
    "is_answered" : false,
    "view_count" : 20,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1743514074,
    "creation_date" : 1743514074,
    "link" : "https://stackoverflow.com/questions/79548781/spring-mongoclientfactorybean-ignores-connection-pool-listeners",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ ],
  "answer_comments" : { }
}