{
  "question" : {
    "question_id" : 79749306,
    "title" : "takeWhile equivalent for Kotlin maps",
    "body" : "<p>My Kotlin project needs to parse files and keep track of the outcome:</p>\n<pre><code>fun parseFiles(dp:MyDataProvider, files:List&lt;String&gt;)\n{\n    //store the status of each processed file\n    val statusMap = mutableMapOf&lt;String, MutableMap&lt;String, List&lt;ProcessingStatus&gt;&gt;&gt;()\n    files.takeWhile{ currentFileNameToProcess -&gt;\n        val statuses = processFile(currentFileNameToProcess)\n\n        //each group of files has a corresponding 'service' document\n        //serviceName() generates that group name based on the file name\n        statusMap.getOrPut(currentFileNameToProcess.serviceName(), ::mutableMapOf).putAll(mapOf( currentFileNameToProcess to statuses))\n\n        //This function will be part of an AWS lambda.\n        //To make sure we aren't running out of time,\n        //check the run time of the function against a threshold\n        !dp.thresholdExceeded.value()\n    }\n}\n</code></pre>\n<p>I want to make this code conform to functional coding. I also want the map initialized with all the file names even if the loop ends early. I can do both by using <code>groupBy()</code> to transform my list of file names into a map before iterating:</p>\n<pre><code>files.groupBy{ it.serviceName() }\n</code></pre>\n<p>Kotlin Map&lt;K,V&gt; doesn't have a <code>takeWhile()</code> function. Since this function is run by AWS Lambda I use <code>takeWhile()</code> to exit the loop when a time threshold is reached to avoid timeout errors. Is there some other Kotlin function for iterating a map until a condition is detected?</p>\n<p>Code without <code>takeWhile()</code>:</p>\n<pre><code>internal enum class ProcessingStatus {\n    AlreadyProcessed, Sent, Pending, Error, Ignored\n}\n\n@Test\nfun `test file mapping status`()\n{\n    val fileNames = listOf(&quot;idoc_images_2050_131031_001_2324.zip&quot;,&quot;idoc_images_2050_131031_002_2324.zip&quot;, &quot;idoc_images_2050_222031_001_2324.zip&quot;)\n\n    fun String.parseCbSeqNumber(): String {\n        return this.substring(24, 27)\n    }\n\n    fun String.serviceName():String\n    {\n        //we need to transform the name of the image file into a matching filename of the service file\n        //replace the 'images' substring with 'service' and strip out the three digit batch code\n        return this.replace(&quot;images&quot;, &quot;service&quot;).replace(Regex(&quot;(.*)(_\\\\d{3}_)(.*.zip)$&quot;), &quot;$1_$3&quot;)\n    }\n\n    val serviceMap = fileNames.groupBy { it.serviceName() }.mapValues {\n        it.value.associateWith { listOf&lt;ProcessingStatus&gt;() }\n    }.mapValues { serviceEntry-&gt;\n        serviceEntry.value.mapValues {\n            fileEntry-&gt;\n\n            if(fileEntry.key.parseCbSeqNumber() == &quot;001&quot;)\n            {\n                listOf(ProcessingStatus.Pending, ProcessingStatus.AlreadyProcessed)\n            }\n            else if(fileEntry.key.parseCbSeqNumber() == &quot;002&quot;)\n            {\n                listOf(ProcessingStatus.Sent, ProcessingStatus.Ignored)\n            }\n            else{\n                listOf(ProcessingStatus.Error)\n            }\n        }\n\n    }\n\n    println(serviceMap)\n    assertThat(serviceMap.keys.size).isEqualTo(2)\n}\n</code></pre>\n",
    "tags" : [ "java", "kotlin", "aws-lambda", "iteration" ],
    "owner" : {
      "account_id" : 2090213,
      "reputation" : 1839,
      "user_id" : 1860222,
      "user_type" : "registered",
      "accept_rate" : 52,
      "profile_image" : "https://www.gravatar.com/avatar/dcd9cf0881ee1e7a5f28175308628e25?s=256&d=identicon&r=PG",
      "display_name" : "pbuchheit",
      "link" : "https://stackoverflow.com/users/1860222/pbuchheit"
    },
    "is_answered" : true,
    "view_count" : 117,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1756412601,
    "creation_date" : 1756394787,
    "link" : "https://stackoverflow.com/questions/79749306/takewhile-equivalent-for-kotlin-maps",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79749417,
    "question_id" : 79749306,
    "body" : "<p>The iteration order of maps is ill-defined, and makes <code>takeWhile</code> make little sense.  In addition, even if you wrote one, it would not work well for your use case, which is not applying <code>takeWhile</code> to any particular property of the keys and values but to a specific passage of time.</p>\n<p>Frankly, explicit mutation is probably the right thing to do here for code clarity.  If you must do something like this, consider doing it in lists and flattened collections first, using <code>takeWhile</code> appropriately, and then grouping into a map as part of the second phase after that.</p>\n",
    "score" : 5,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 465573,
      "reputation" : 200423,
      "user_id" : 869736,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/ae7bb06b9a23a4dd7eea69e853d47d12?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Louis Wasserman",
      "link" : "https://stackoverflow.com/users/869736/louis-wasserman"
    },
    "creation_date" : 1756401364,
    "last_activity_date" : 1756401364,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140699207,
    "post_id" : 79749306,
    "body" : "maps do not guarantee any order, so I&#39;m not sure how much sense takeWhile will have here. If you want to, you can access the entries of the map, and takeWhile will be available there, so basically <code>myMap.entries.takeWhile { it.key == &quot;fizz&quot; || it.value == &quot;buzz&quot;)</code>. Obviously use whatever predicate makes sense.",
    "score" : 2,
    "owner" : {
      "account_id" : 13774089,
      "reputation" : 2991,
      "user_id" : 9940820,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/AOJ27.jpg?s=256",
      "display_name" : "AlexT",
      "link" : "https://stackoverflow.com/users/9940820/alext"
    },
    "creation_date" : 1756397283,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140699201,
    "post_id" : 79749306,
    "body" : "Implement it yourself mutably.  What is the signature?  It&#39;s not actually clear how you expect the semantics to behave.",
    "score" : 0,
    "owner" : {
      "account_id" : 465573,
      "reputation" : 200423,
      "user_id" : 869736,
      "user_type" : "registered",
      "accept_rate" : 82,
      "profile_image" : "https://www.gravatar.com/avatar/ae7bb06b9a23a4dd7eea69e853d47d12?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Louis Wasserman",
      "link" : "https://stackoverflow.com/users/869736/louis-wasserman"
    },
    "creation_date" : 1756397209,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}