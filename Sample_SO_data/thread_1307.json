{
  "question" : {
    "question_id" : 79720589,
    "title" : "Spring Cloud OpenFeign: global configuration not being applied",
    "body" : "<p>I'm working on a project using Java 21, Spring Cloud OpenFeign, and Apache HttpClient 5. I'm trying to create a global configuration for all Feign clients and allow client-specific behaviors via individual configurations.</p>\n<p>However, it seems that the global configuration is not being applied.</p>\n<p><strong>Global configuration class:</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>@Configuration\npublic class GlobalFeignConfiguration {\n    @Value(&quot;${spring.cloud.openfeign.client.config.default.maxTotalConnections}&quot;)\n    public int maxTotalConnections;\n\n    @Value(&quot;${spring.cloud.openfeign.client.config.default.defaultMaxPerRoute}&quot;)\n    public int defaultMaxPerRoute;\n\n    @Value(&quot;${spring.cloud.openfeign.client.config.default.validateAfterInactivity}&quot;)\n    public int validateAfterInactivity;\n\n    @Value(&quot;${spring.cloud.openfeign.client.config.default.keepAlive}&quot;)\n    public int keepAlive;\n\n    @Bean\n    public CloseableHttpClient httpClient() {\n\n        PoolingHttpClientConnectionManager connectionManager = new PoolingHttpClientConnectionManager();\n        connectionManager.setMaxTotal(maxTotalConnections);\n        connectionManager.setDefaultMaxPerRoute(defaultMaxPerRoute);\n\n        RequestConfig requestConfig = RequestConfig.custom()\n                .setConnectionRequestTimeout(1, TimeUnit.MILLISECONDS)\n                .setResponseTimeout(1, TimeUnit.MILLISECONDS)\n                .setConnectionKeepAlive(TimeValue.ofMilliseconds(keepAlive))\n                .build();\n\n        return HttpClients.custom()\n                .setDefaultRequestConfig(requestConfig)\n                .evictIdleConnections(TimeValue.ofMilliseconds(validateAfterInactivity))\n                .setKeepAliveStrategy((response, context) -&gt; TimeValue.ofMilliseconds(keepAlive))\n                .evictExpiredConnections()\n                .setConnectionManager(connectionManager)\n                .build();\n    }\n\n    @Bean\n    @Primary\n    public Client feignClient(CloseableHttpClient httpClient) {\n        return new ApacheHttp5Client(httpClient);\n    }\n}\n</code></pre>\n<p><strong>Client-specific configuration:</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>@FeignClient(name = &quot;test-client&quot;, configuration = TestClientConfig.class, contextId = &quot;test-client&quot;)\npublic interface ITestClientService {\n    // ...\n}\n</code></pre>\n<p><strong>How I'm testing:</strong></p>\n<p>I set both connectionRequestTimeout and responseTimeout to 1ms to force a timeout. However, no timeout occurs, which suggests that the custom ApacheHttp5Client is not being used.</p>\n<p>It works if I set the timeout in parameters like below:</p>\n<pre class=\"lang-ini prettyprint-override\"><code>spring.cloud.openfeign.client.config.test-client.connectTimeout=1\n</code></pre>\n<p>This confirms that the default configuration is being ignored:</p>\n<p><strong>I also tried:</strong></p>\n<ul>\n<li>Adding <code>@EnableFeignClients(defaultConfiguration = GlobalFeignConfiguration.class)</code></li>\n<li>Using <code>configuration = {TestClientConfig.class, GlobalFeignConfiguration.class}</code> in the <code>@FeignClient</code></li>\n</ul>\n<p>Still, the global configuration is not applied.</p>\n<p><strong>Dependencies:</strong></p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt;\n    &lt;artifactId&gt;feign-hc5&lt;/artifactId&gt; &lt;!-- Apache HttpClient 5 integration --&gt;\n    &lt;version&gt;12.2&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.httpcomponents.client5&lt;/groupId&gt;\n    &lt;artifactId&gt;httpclient5&lt;/artifactId&gt;\n    &lt;version&gt;5.2&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n",
    "tags" : [ "java", "spring-cloud", "spring-cloud-feign", "apache-httpclient-5.x" ],
    "owner" : {
      "account_id" : 3405565,
      "reputation" : 924,
      "user_id" : 2856694,
      "user_type" : "registered",
      "accept_rate" : 30,
      "profile_image" : "https://i.sstatic.net/UfWHK.jpg?s=256",
      "display_name" : "Victor Soares",
      "link" : "https://stackoverflow.com/users/2856694/victor-soares"
    },
    "is_answered" : false,
    "view_count" : 83,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1753948115,
    "creation_date" : 1753913452,
    "link" : "https://stackoverflow.com/questions/79720589/spring-cloud-openfeign-global-configuration-not-being-applied",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140646516,
    "post_id" : 79720589,
    "body" : "No it&#39;s not duplicated. That question don&#39;t solve my problem.",
    "score" : 0,
    "owner" : {
      "account_id" : 3405565,
      "reputation" : 924,
      "user_id" : 2856694,
      "user_type" : "registered",
      "accept_rate" : 30,
      "profile_image" : "https://i.sstatic.net/UfWHK.jpg?s=256",
      "display_name" : "Victor Soares",
      "link" : "https://stackoverflow.com/users/2856694/victor-soares"
    },
    "creation_date" : 1754490306,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140632042,
    "post_id" : 79720589,
    "body" : "seems to be duplicate of: <a href=\"https://stackoverflow.com/questions/67896483/how-to-inject-custom-http-client-to-spring-cloud-openfeign\" title=\"how to inject custom http client to spring cloud openfeign\">stackoverflow.com/questions/67896483/&hellip;</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 16657879,
      "reputation" : 4340,
      "user_id" : 12038714,
      "user_type" : "registered",
      "profile_image" : "https://lh3.googleusercontent.com/a-/AAuE7mAgRe8u2G_kzJJ-KZ2yZwAD1E4kxs9eRlqnY45BUw=k-s256",
      "display_name" : "asgarov1",
      "link" : "https://stackoverflow.com/users/12038714/asgarov1"
    },
    "creation_date" : 1753948215,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}