{
  "question" : {
    "question_id" : 79739536,
    "title" : "Avoid SAXBuilder to validate document type DTD",
    "body" : "<p>I am trying to build a <code>org.jdom2.Document</code> from a String which I get returned from a <code>org.jfree.graphics2d.svg.SVGGraphics2D</code>. This works neatly as long as my computer is online, but when offline it fails and an <code>UnknownHostException</code> is thrown.</p>\n<pre><code>try{\n  svgString = svgGraphics.getSVGDocument();\n  SAXBuilder builder = new SAXBuilder(XMLReaders.NONVALIDATING);\n  svgXMLDocument = builder.build(new ByteArrayInputStream(svgString.getBytes()));\n} catch (IOException | JDOMException e) { ... }\n</code></pre>\n<p>Even though creating the <code>SAXBuilder</code>with the parameter <code>XMLReaders.NONVALIDATING</code>, the builder checks the Doctype and raises an exception when he cannot reach <a href=\"http://www.w3.org\" rel=\"nofollow noreferrer\">www.w3.org</a>.</p>\n<p>Is there a way to really avoid the doctype to be checked? Another Builder to be used?</p>\n<p>So far my workaround is to catch the exception, remove the Doctype declaration using String-operations and then repeat the build process.</p>\n",
    "tags" : [ "java", "jdom-2", "unknown-host" ],
    "owner" : {
      "account_id" : 12448976,
      "reputation" : 473,
      "user_id" : 9064287,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/731f1bf7c821cb7c18a9e3dae3685cf2?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "nhaggen",
      "link" : "https://stackoverflow.com/users/9064287/nhaggen"
    },
    "is_answered" : true,
    "view_count" : 50,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1755617126,
    "creation_date" : 1755586438,
    "link" : "https://stackoverflow.com/questions/79739536/avoid-saxbuilder-to-validate-document-type-dtd",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79740123,
    "question_id" : 79739536,
    "body" : "<p>Processing XML has evolved, and nowadays the &quot;correct&quot; way is to not allow the XML processor to download any external resources, e.g. schema files and DTDs. So you either have to &quot;cache&quot; the external DTD locally or bypass the loading of the DTD. For any of these alternatives, you need to create a special EntityResolver; even if validation is turned off, the parser will try to load the DTD, but it will fail since loading an external resource is forbidden.</p>\n<p>Here is one method to achieve processing the XML while also bypassing the DTD loading:</p>\n<pre><code>private static class MyFactory implements XMLReaderJDOMFactory , EntityResolver{\n    @Override\n    public XMLReader createXMLReader() throws JDOMException {\n        try {\n            SAXParserFactory f = SAXParserFactory.newDefaultNSInstance();\n            f.setValidating(false);\n            f.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);\n            XMLReader r = f.newSAXParser().getXMLReader();\n            r.setEntityResolver(this);\n            return r;\n        } catch (Exception e) {\n            throw new JDOMException(&quot;error&quot;, e);\n        }\n    }\n\n    @Override\n    public boolean isValidating() {\n        return false;\n    }\n    @Override\n    public InputSource resolveEntity(String publicId, String systemId) throws SAXException, IOException {\n        return new InputSource(new ByteArrayInputStream(&quot;&quot;.getBytes()));\n    }\n}\n\npublic static void main(String[] args) throws Exception {\n\n    SAXBuilder builder = new SAXBuilder(new MyFactory());\n\n    Document doc = builder.build(...));\n\n}\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 116746,
      "reputation" : 12898,
      "user_id" : 306030,
      "user_type" : "registered",
      "accept_rate" : 70,
      "profile_image" : "https://i.sstatic.net/y053l.jpg?s=256",
      "display_name" : "forty-two",
      "link" : "https://stackoverflow.com/users/306030/forty-two"
    },
    "creation_date" : 1755617126,
    "last_activity_date" : 1755617126,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140678153,
    "post_id" : 79739536,
    "body" : "Doing the validation is usually a good thing.",
    "score" : 0,
    "owner" : {
      "account_id" : 8362430,
      "reputation" : 856,
      "user_id" : 6280255,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/579e86ed5089abcb535b4e05ead3f6f6?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Just another Java programmer",
      "link" : "https://stackoverflow.com/users/6280255/just-another-java-programmer"
    },
    "creation_date" : 1755667632,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140676331,
    "post_id" : 79739536,
    "body" : "Well, this is still not keeping the Builder from doing the validation, but it could prevent the  Exception.",
    "score" : 0,
    "owner" : {
      "account_id" : 12448976,
      "reputation" : 473,
      "user_id" : 9064287,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/731f1bf7c821cb7c18a9e3dae3685cf2?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "nhaggen",
      "link" : "https://stackoverflow.com/users/9064287/nhaggen"
    },
    "creation_date" : 1755609617,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140676034,
    "post_id" : 79739536,
    "body" : "Is this a help for you? <a href=\"https://stackoverflow.com/questions/51051627/how-to-cache-a-dtd-file-when-parsing-xml-in-java\" title=\"how to cache a dtd file when parsing xml in java\">stackoverflow.com/questions/51051627/&hellip;</a>",
    "score" : 1,
    "owner" : {
      "account_id" : 8362430,
      "reputation" : 856,
      "user_id" : 6280255,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/579e86ed5089abcb535b4e05ead3f6f6?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Just another Java programmer",
      "link" : "https://stackoverflow.com/users/6280255/just-another-java-programmer"
    },
    "creation_date" : 1755602068,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79740123" : [ {
      "comment_id" : 140686366,
      "post_id" : 79740123,
      "body" : "The DTD has other purposes than just validation, entity expansion for example (which is also considered insecure)",
      "score" : 0,
      "owner" : {
        "account_id" : 116746,
        "reputation" : 12898,
        "user_id" : 306030,
        "user_type" : "registered",
        "accept_rate" : 70,
        "profile_image" : "https://i.sstatic.net/y053l.jpg?s=256",
        "display_name" : "forty-two",
        "link" : "https://stackoverflow.com/users/306030/forty-two"
      },
      "creation_date" : 1755931271,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140684977,
      "post_id" : 79740123,
      "body" : "thanks this works. I still think that the SAXBuilder should not load the DTD when told not to validate, but if this is the only workaround to prevent it...",
      "score" : 0,
      "owner" : {
        "account_id" : 12448976,
        "reputation" : 473,
        "user_id" : 9064287,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/731f1bf7c821cb7c18a9e3dae3685cf2?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name" : "nhaggen",
        "link" : "https://stackoverflow.com/users/9064287/nhaggen"
      },
      "creation_date" : 1755873099,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}