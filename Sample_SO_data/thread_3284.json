{
  "question" : {
    "question_id" : 79559325,
    "title" : "How to let JPA know what it has to do when you configure DataSource manually",
    "body" : "<p>I am configuring my spring boot app to have a second datasource for some reason, the main one which is annotated as <code>@Primary</code> looks like this</p>\n<pre class=\"lang-none prettyprint-override\"><code>@Configuration\n@EnableJpaRepositories(basePackages = &quot;com.x.y.z.repository&quot;, entityManagerFactoryRef = &quot;primaryEntityManagerFactory&quot;, transactionManagerRef = &quot;primaryTransactionManager&quot;)\npublic class PrimaryDataSourceConfig {\n\n  @FlywayDataSource\n  @Primary\n  @Bean(name = &quot;primaryDataSource&quot;)\n  @ConfigurationProperties(prefix = &quot;spring.datasource&quot;)\n  public DataSource dataSource() {\n    return DataSourceBuilder.create().build();\n  }\n\n  @Primary\n  @Bean(name = &quot;primaryEntityManagerFactory&quot;)\n  public LocalContainerEntityManagerFactoryBean entityManagerFactory(\n      EntityManagerFactoryBuilder builder,\n      @Qualifier(&quot;primaryDataSource&quot;) DataSource dataSource) {\n\n    Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();\n    /*properties.put(&quot;hibernate.hbm2ddl.auto&quot;, &quot;update&quot;);\n    properties.put(&quot;hibernate.dialect&quot;, &quot;org.hibernate.dialect.PostgreSQL10Dialect&quot;);\n    properties.put(&quot;hibernate.jdbc.lob.non_contextual_creation&quot;, true);\n    properties.put(&quot;hibernate.temp.use_jdbc_metadata_defaults&quot;, false);\n    properties.put(&quot;hibernate.types.print.banner&quot;, false);\n    properties.put(&quot;hibernate.types.db.structure&quot;, true);\n    properties.put(&quot;spring.jpa.open-in-view&quot;, false);\n    properties.put(&quot;spring.jpa.database-platform&quot;, &quot;org.hibernate.dialect.PostgreSQL10Dialect&quot;);\n    properties.put(&quot;spring.jpa.properties.javax.persistence.query.timeout&quot;, 9000);\n    properties.put(&quot;spring.jpa.properties.hibernate.query.in_clause_parameter_padding&quot;, true);*/\n\n    return builder\n        .dataSource(dataSource)\n        .packages(&quot;com.x.y.z.model&quot;)\n        .properties(properties)\n        .build();\n  }\n\n  @Primary\n  @Bean(name = &quot;primaryTransactionManager&quot;)\n  public PlatformTransactionManager transactionManager(\n      @Qualifier(&quot;primaryEntityManagerFactory&quot;) LocalContainerEntityManagerFactoryBean entityManagerFactory) {\n    return new JpaTransactionManager(entityManagerFactory.getObject());\n  }\n}\n</code></pre>\n<p>Also I have unittests and cucumber tests(integration tests), unittests run with no problem, but the cucumber tests fail with a message like <code>could not extract ResultSet; SQL [n/a]; nested exception is org.hibernate.exception.SQLGrammarException: could not extract ResultSet</code>.\nIn the stack trace I see that this error <code>aused by: org.postgresql.util.PSQLException: ERROR: relation &quot;mytable&quot; does not exist</code> which actually it really does not exists but <code>my_table</code> exists meaning that FlyWay did its job by creating the database and all tables as expected but JPA is not correctly working its magic which is to map <code>MyTable</code> entity to <code>my_table</code> table which normally before configuring the <code>DataSource</code> manually.</p>\n<p>I tried to add the properties in <code>entityManagerFactory</code> function in order to configure EntityManagerFactory. but with those lines uncommented I get another set of errors.</p>\n<p>I am not sure if something is missing or the configuration in <code>entityManagerFactory</code> is right or not.</p>\n<p>Does anyone know whats wrong and what has to be done ?</p>\n",
    "tags" : [ "java", "spring-boot", "jpa", "spring-data-jpa" ],
    "owner" : {
      "account_id" : 1688846,
      "reputation" : 1662,
      "user_id" : 1551608,
      "user_type" : "registered",
      "accept_rate" : 58,
      "profile_image" : "https://www.gravatar.com/avatar/4e5d02b92008f673d4662d77b6a0cfa9?s=256&d=identicon&r=PG",
      "display_name" : "Bahram",
      "link" : "https://stackoverflow.com/users/1551608/bahram"
    },
    "is_answered" : false,
    "view_count" : 53,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1744011595,
    "creation_date" : 1744011595,
    "link" : "https://stackoverflow.com/questions/79559325/how-to-let-jpa-know-what-it-has-to-do-when-you-configure-datasource-manually",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140308203,
    "post_id" : 79559325,
    "body" : "Spring at it again. JPA specification does not &#39;automagically&#39; map entity &#39;MyTable&#39; into anything other than table &quot;MYTABLE&quot;. Spring injecting configuration into hibernate though does (but only for Hibernate). Personally, I wouldn&#39;t rely on it and specify the table names you want to use in your entities. Otherwise, you can set hibernate&#39;s naming (renaming) strategies as outlined here <a href=\"https://stackoverflow.com/a/25681802/496099\">stackoverflow.com/a/25681802/496099</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 231721,
      "reputation" : 21335,
      "user_id" : 496099,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/efa7510cf47d7bd79e80486246e7e39e?s=256&d=identicon&r=PG",
      "display_name" : "Chris",
      "link" : "https://stackoverflow.com/users/496099/chris"
    },
    "creation_date" : 1744035982,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}