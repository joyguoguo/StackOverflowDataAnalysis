{
  "question" : {
    "question_id" : 79692616,
    "title" : "Cannot resolve rule/ruleset reference &#39;upstream.xml&#39;. Make sure the resource is a valid file or URL and is on the CLASSPATH",
    "body" : "<p>I am confused about where PMD looks for ruleset files. I have some rulesets I am trying to reuse from an old project in a set of mavan projects. In that project the ruleset was referenced through a http url, but now I am trying to make one maven project to contain the rulesets, and reference it. I get the error in the title, however when I am looking at the classpath in the debug output of maven, it does not contain the place of the standard rulesets which resolve okay, and does contain the place where I am trying to put my ruleset.</p>\n<p>my pmd.xml:</p>\n<pre><code>&lt;ruleset name=&quot;Kode Konveyor WAR&quot;\n    xmlns=&quot;http://pmd.sourceforge.net/ruleset/2.0.0&quot;\n    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n    xsi:schemaLocation=&quot;http://pmd.sourceforge.net/ruleset/2.0.0 https://pmd.sourceforge.io/ruleset_2_0_0.xsd&quot;&gt;\n&lt;description&gt;PMD rules of Kode Konveyor&lt;/description&gt;\n&lt;rule ref=&quot;category/java/bestpractices.xml&quot;/&gt;\n&lt;rule ref=&quot;upstream.xml&quot;/&gt;\n&lt;rule ref=&quot;konveyor.xml&quot;/&gt;\n&lt;/ruleset&gt;\n</code></pre>\n<p>the output of <code>mvn pmd:pmd --debug</code> contains:</p>\n<pre><code>[DEBUG] Using aux classpath: [/home/mag/project/civitas-ng/data/target/test-classes, /home/mag/project/civitas-ng/data/target/classes, /home/mag/.m2/repository/org/projectlombok/lombok/1.18.36/lombok-1.18.36.jar, /home/mag/.m2/repository/org/springframework/data/spring-data-keyvalue/4.0.0-M3/spring-data-keyvalue-4.0.0-M3.jar, /home/mag/.m2/repository/org/springframework/data/spring-data-commons/4.0.0-M3/spring-data-commons-4.0.0-M3.jar, /home/mag/.m2/repository/org/springframework/spring-core/7.0.0-M5/spring-core-7.0.0-M5.jar, /home/mag/.m2/repository/commons-logging/commons-logging/1.3.5/commons-logging-1.3.5.jar, /home/mag/.m2/repository/org/jspecify/jspecify/1.0.0/jspecify-1.0.0.jar, /home/mag/.m2/repository/org/springframework/spring-beans/7.0.0-M5/spring-beans-7.0.0-M5.jar, /home/mag/.m2/repository/org/springframework/spring-context/7.0.0-M5/spring-context-7.0.0-M5.jar, /home/mag/.m2/repository/org/springframework/spring-aop/7.0.0-M5/spring-aop-7.0.0-M5.jar, /home/mag/.m2/repository/org/springframework/spring-expression/7.0.0-M5/spring-expression-7.0.0-M5.jar, /home/mag/.m2/repository/io/micrometer/micrometer-observation/1.15.0/micrometer-observation-1.15.0.jar, /home/mag/.m2/repository/io/micrometer/micrometer-commons/1.15.0/micrometer-commons-1.15.0.jar, /home/mag/.m2/repository/org/springframework/spring-tx/7.0.0-M5/spring-tx-7.0.0-M5.jar, /home/mag/.m2/repository/org/slf4j/slf4j-api/2.0.2/slf4j-api-2.0.2.jar, /home/mag/.m2/repository/jakarta/xml/bind/jakarta.xml.bind-api/4.0.2/jakarta.xml.bind-api-4.0.2.jar, /home/mag/.m2/repository/jakarta/activation/jakarta.activation-api/2.1.3/jakarta.activation-api-2.1.3.jar, /home/mag/.m2/repository/io/github/magwas/konveyor-pmdrules/0.0.2-3-g5b9385b/konveyor-pmdrules-0.0.2-3-g5b9385b.jar]\n[INFO] PMD version: 7.14.0\n[DEBUG] Using language java+version:17\n[DEBUG] Adding classpath entry: &lt;/home/mag/project/civitas-ng/data/target/test-classes&gt;\n[DEBUG] Adding classpath entry: &lt;/home/mag/project/civitas-ng/data/target/classes&gt;\n[DEBUG] Adding classpath entry: &lt;/home/mag/.m2/repository/org/projectlombok/lombok/1.18.36/lombok-1.18.36.jar&gt;\n[DEBUG] Adding classpath entry: &lt;/home/mag/.m2/repository/org/springframework/data/spring-data-keyvalue/4.0.0-M3/spring-data-keyvalue-4.0.0-M3.jar&gt;\n[DEBUG] Adding classpath entry: &lt;/home/mag/.m2/repository/org/springframework/data/spring-data-commons/4.0.0-M3/spring-data-commons-4.0.0-M3.jar&gt;\n[DEBUG] Adding classpath entry: &lt;/home/mag/.m2/repository/org/springframework/spring-core/7.0.0-M5/spring-core-7.0.0-M5.jar&gt;\n[DEBUG] Adding classpath entry: &lt;/home/mag/.m2/repository/commons-logging/commons-logging/1.3.5/commons-logging-1.3.5.jar&gt;\n[DEBUG] Adding classpath entry: &lt;/home/mag/.m2/repository/org/jspecify/jspecify/1.0.0/jspecify-1.0.0.jar&gt;\n[DEBUG] Adding classpath entry: &lt;/home/mag/.m2/repository/org/springframework/spring-beans/7.0.0-M5/spring-beans-7.0.0-M5.jar&gt;\n[DEBUG] Adding classpath entry: &lt;/home/mag/.m2/repository/org/springframework/spring-context/7.0.0-M5/spring-context-7.0.0-M5.jar&gt;\n[DEBUG] Adding classpath entry: &lt;/home/mag/.m2/repository/org/springframework/spring-aop/7.0.0-M5/spring-aop-7.0.0-M5.jar&gt;\n[DEBUG] Adding classpath entry: &lt;/home/mag/.m2/repository/org/springframework/spring-expression/7.0.0-M5/spring-expression-7.0.0-M5.jar&gt;\n[DEBUG] Adding classpath entry: &lt;/home/mag/.m2/repository/io/micrometer/micrometer-observation/1.15.0/micrometer-observation-1.15.0.jar&gt;\n[DEBUG] Adding classpath entry: &lt;/home/mag/.m2/repository/io/micrometer/micrometer-commons/1.15.0/micrometer-commons-1.15.0.jar&gt;\n[DEBUG] Adding classpath entry: &lt;/home/mag/.m2/repository/org/springframework/spring-tx/7.0.0-M5/spring-tx-7.0.0-M5.jar&gt;\n[DEBUG] Adding classpath entry: &lt;/home/mag/.m2/repository/org/slf4j/slf4j-api/2.0.2/slf4j-api-2.0.2.jar&gt;\n[DEBUG] Adding classpath entry: &lt;/home/mag/.m2/repository/jakarta/xml/bind/jakarta.xml.bind-api/4.0.2/jakarta.xml.bind-api-4.0.2.jar&gt;\n[DEBUG] Adding classpath entry: &lt;/home/mag/.m2/repository/jakarta/activation/jakarta.activation-api/2.1.3/jakarta.activation-api-2.1.3.jar&gt;\n[DEBUG] Adding classpath entry: &lt;/home/mag/.m2/repository/io/github/magwas/konveyor-pmdrules/0.0.2-3-g5b9385b/konveyor-pmdrules-0.0.2-3-g5b9385b.jar&gt;\n</code></pre>\n<p>the contents of <code>/home/mag/.m2/repository/io/github/magwas/konveyor-pmdrules/0.0.2-3-g5b9385b/konveyor-pmdrules-0.0.2-3-g5b9385b.jar</code>:</p>\n<pre><code>Archive:  /home/mag/.m2/repository/io/github/magwas/konveyor-pmdrules/0.0.2-3-g5b9385b/konveyor-pmdrules-0.0.2-3-g5b9385b.jar\n  Length      Date    Time    Name\n---------  ---------- -----   ----\n        0  2025-07-07 10:17   META-INF/\n      127  2025-07-07 10:17   META-INF/MANIFEST.MF\n    15920  2025-07-07 10:17   konveyor.xml\n      420  2025-07-07 10:17   pmd.xml\n     3642  2025-07-07 10:17   upstream.xml\n        0  2025-07-07 10:17   META-INF/maven/\n        0  2025-07-07 10:17   META-INF/maven/io.github.magwas/\n        0  2025-07-07 10:17   META-INF/maven/io.github.magwas/konveyor-pmdrules/\n      612  2025-07-07 10:15   META-INF/maven/io.github.magwas/konveyor-pmdrules/pom.xml\n      130  2025-07-07 10:15   META-INF/maven/io.github.magwas/konveyor-pmdrules/pom.properties\n---------                     -------\n    20851                     10 files\n</code></pre>\n<p>I also tried to  put upstream.xml into <code>target/classes/upstream.xml</code> directly with the same result.</p>\n<p>the relevant parts of my <code>pom.xml</code>:</p>\n<pre><code>        &lt;/dependency&gt;\n                &lt;dependency&gt;\n            &lt;groupId&gt;io.github.magwas&lt;/groupId&gt;\n            &lt;artifactId&gt;konveyor-pmdrules&lt;/artifactId&gt;\n            &lt;version&gt;${project.version}&lt;/version&gt;\n            &lt;/dependency&gt;\n\n    &lt;/dependencies&gt;\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                &lt;artifactId&gt;maven-pmd-plugin&lt;/artifactId&gt;\n                &lt;version&gt;3.27.0&lt;/version&gt;\n                &lt;configuration&gt;\n                    &lt;minimumTokens&gt;25&lt;/minimumTokens&gt;\n                    &lt;ignoreAnnotations&gt;true&lt;/ignoreAnnotations&gt;\n                    &lt;includeTests&gt;true&lt;/includeTests&gt;\n                    &lt;rulesets&gt;\n                        &lt;ruleset&gt;pmd.xml&lt;/ruleset&gt;\n                    &lt;/rulesets&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n&lt;/build&gt;\n</code></pre>\n<p>The debug output also contains this:</p>\n<pre><code>[DEBUG]   (f) typeResolution = true\n[DEBUG] -- end configuration --\n</code></pre>\n<p>So as I understand the project's compile/test classpath should be passed to PMD, which is may or may not relevant here.</p>\n<p>How do I make pmd find the referenced <code>upstream.xml</code> from the other project?</p>\n",
    "tags" : [ "java", "maven", "pmd" ],
    "owner" : {
      "account_id" : 1029918,
      "reputation" : 1506,
      "user_id" : 1038447,
      "user_type" : "registered",
      "accept_rate" : 31,
      "profile_image" : "https://www.gravatar.com/avatar/2b2c8669d88a7265252b6ede2f0ec677?s=256&d=identicon&r=PG",
      "display_name" : "&#193;rp&#225;d Magos&#225;nyi",
      "link" : "https://stackoverflow.com/users/1038447/%c3%81rp%c3%a1d-magos%c3%a1nyi"
    },
    "is_answered" : true,
    "view_count" : 63,
    "answer_count" : 1,
    "score" : 1,
    "last_activity_date" : 1752222204,
    "creation_date" : 1751880512,
    "link" : "https://stackoverflow.com/questions/79692616/cannot-resolve-rule-ruleset-reference-upstream-xml-make-sure-the-resource-is",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79698036,
    "question_id" : 79692616,
    "body" : "<p>The jar-file konveyor-pmdrules-0.0.2-3-g5b9385b.jar looks fine. However, there are multiple different isolated classloaders in use, and you need to add the dependency to the correct classpath:</p>\n<p>When PMD is executing as part of the maven-pmd-plugin, it itself runs within the classloader for that plugin and sees only those dependencies - and not your application's dependencies. This is the classpath that is used to load the rulesets. That's the &quot;runtime classpath&quot;.</p>\n<p>For analyzing your application, PMD also needs access to all the other application's dependencies - this is called the &quot;auxiliary classpath&quot; (auxclasspath). But this is not used to load the rulesets.</p>\n<p>So, you need to move the dependency io.github.magwas:konveyor-pmdrules to the plugin, like so:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                &lt;artifactId&gt;maven-pmd-plugin&lt;/artifactId&gt;\n                &lt;version&gt;3.27.0&lt;/version&gt;\n                &lt;configuration&gt;\n                    &lt;minimumTokens&gt;25&lt;/minimumTokens&gt;\n                    &lt;ignoreAnnotations&gt;true&lt;/ignoreAnnotations&gt;\n                    &lt;includeTests&gt;true&lt;/includeTests&gt;\n                    &lt;rulesets&gt;\n                        &lt;ruleset&gt;pmd.xml&lt;/ruleset&gt;\n                    &lt;/rulesets&gt;\n                &lt;/configuration&gt;\n                &lt;dependencies&gt;\n                    &lt;dependency&gt;\n                        &lt;groupId&gt;io.github.magwas&lt;/groupId&gt;\n                        &lt;artifactId&gt;konveyor-pmdrules&lt;/artifactId&gt;\n                        &lt;version&gt;${project.version}&lt;/version&gt;\n                    &lt;/dependency&gt;\n                &lt;/dependencies&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n</code></pre>\n<p>See also <a href=\"https://maven.apache.org/plugins/maven-pmd-plugin/examples/multi-module-config.html#Configure_the_other_projects_to_use_it\" rel=\"nofollow noreferrer\">https://maven.apache.org/plugins/maven-pmd-plugin/examples/multi-module-config.html#Configure_the_other_projects_to_use_it</a> for a more complex example.</p>\n",
    "score" : 1,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 1198859,
      "reputation" : 1975,
      "user_id" : 1169968,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/af7e65f861c7ceda33ecfe7153702dad?s=256&d=identicon&r=PG",
      "display_name" : "adangel",
      "link" : "https://stackoverflow.com/users/1169968/adangel"
    },
    "creation_date" : 1752222204,
    "last_activity_date" : 1752222204,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}