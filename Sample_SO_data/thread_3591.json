{
  "question" : {
    "question_id" : 79538212,
    "title" : "Where does this Mongo stacktrace come from in a Spring Boot app?",
    "body" : "<p>I have a Spring Boot 3.4.2 app, which has several databases and services configured, including MongoDB. There are 2 connections to MongoDB, each with their own credentials and database they access.</p>\n<p>This stacktrace comes from a <code>@SpringBootTest</code> where I'm running MongoDB using TestContainers.</p>\n<p>The app works and connects just fine when MongoDB is started via Docker Compose. I'm using the same config for the TestContainers version was for the Docker Compose version.</p>\n<p>I can't work out from where the origin of this stacktrace is. It doesn't appear when the main app is booted for manual testing and exercising.</p>\n<pre><code>2025-03-27T07:58:36.305Z  INFO 110184 --- [my-app] [localhost:27017] org.mongodb.driver.cluster               : Exception in monitor thread while connecting to server localhost:27017\n\ncom.mongodb.MongoSocketOpenException: Exception opening socket\n    at com.mongodb.internal.connection.SocketStream.lambda$open$0(SocketStream.java:85) ~[mongodb-driver-core-5.2.1.jar:na]\n    at java.base/java.util.Optional.orElseThrow(Optional.java:403) ~[na:na]\n    at com.mongodb.internal.connection.SocketStream.open(SocketStream.java:85) ~[mongodb-driver-core-5.2.1.jar:na]\n    at com.mongodb.internal.connection.InternalStreamConnection.open(InternalStreamConnection.java:233) ~[mongodb-driver-core-5.2.1.jar:na]\n    at com.mongodb.internal.connection.DefaultServerMonitor$ServerMonitor.lookupServerDescription(DefaultServerMonitor.java:219) ~[mongodb-driver-core-5.2.1.jar:na]\n    at com.mongodb.internal.connection.DefaultServerMonitor$ServerMonitor.run(DefaultServerMonitor.java:176) ~[mongodb-driver-core-5.2.1.jar:na]\nCaused by: java.net.ConnectException: Connection refused\n    at java.base/sun.nio.ch.Net.pollConnect(Native Method) ~[na:na]\n    at java.base/sun.nio.ch.Net.pollConnectNow(Net.java:682) ~[na:na]\n    at java.base/sun.nio.ch.NioSocketImpl.timedFinishConnect(NioSocketImpl.java:542) ~[na:na]\n    at java.base/sun.nio.ch.NioSocketImpl.connect(NioSocketImpl.java:592) ~[na:na]\n    at java.base/java.net.SocksSocketImpl.connect(SocksSocketImpl.java:327) ~[na:na]\n    at java.base/java.net.Socket.connect(Socket.java:751) ~[na:na]\n    at com.mongodb.internal.connection.SocketStreamHelper.initialize(SocketStreamHelper.java:76) ~[mongodb-driver-core-5.2.1.jar:na]\n    at com.mongodb.internal.connection.SocketStream.initializeSocket(SocketStream.java:104) ~[mongodb-driver-core-5.2.1.jar:na]\n    at com.mongodb.internal.connection.SocketStream.open(SocketStream.java:79) ~[mongodb-driver-core-5.2.1.jar:na]\n    ... 3 common frames omitted\n</code></pre>\n",
    "tags" : [ "java", "mongodb", "spring-boot", "database-connection", "testcontainers" ],
    "owner" : {
      "account_id" : 55989,
      "reputation" : 19037,
      "user_id" : 167745,
      "user_type" : "registered",
      "accept_rate" : 76,
      "profile_image" : "https://i.sstatic.net/wBebv.jpg?s=256",
      "display_name" : "Stewart",
      "link" : "https://stackoverflow.com/users/167745/stewart"
    },
    "is_answered" : false,
    "view_count" : 50,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1743063000,
    "creation_date" : 1743063000,
    "link" : "https://stackoverflow.com/questions/79538212/where-does-this-mongo-stacktrace-come-from-in-a-spring-boot-app",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140273201,
    "post_id" : 79538212,
    "body" : "@Joe TestContainers uses Docker under the hood, and you nominate one or more exposed ports when you boot up a container.",
    "score" : 0,
    "owner" : {
      "account_id" : 55989,
      "reputation" : 19037,
      "user_id" : 167745,
      "user_type" : "registered",
      "accept_rate" : 76,
      "profile_image" : "https://i.sstatic.net/wBebv.jpg?s=256",
      "display_name" : "Stewart",
      "link" : "https://stackoverflow.com/users/167745/stewart"
    },
    "creation_date" : 1743157018,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140272529,
    "post_id" : 79538212,
    "body" : "That stack indicates the driver is trying to open a connection, but it is getting &quot;connection refused&quot;.  How does the network config differ for the test containers?",
    "score" : 0,
    "owner" : {
      "account_id" : 2638471,
      "reputation" : 29001,
      "user_id" : 2282634,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/46c5a01e93856e53a2f16eec3267a9b2?s=256&d=identicon&r=PG",
      "display_name" : "Joe",
      "link" : "https://stackoverflow.com/users/2282634/joe"
    },
    "creation_date" : 1743144509,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140269446,
    "post_id" : 79538212,
    "body" : "Is there a profile being used as part of the @SpringBootTest?  Port 27017 looks like the default port - perhaps one of the mongo connections is missing some configuration when running in a test context?",
    "score" : 0,
    "owner" : {
      "account_id" : 8909811,
      "reputation" : 2861,
      "user_id" : 6650475,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/fe85994d05ad7aaaa1c47d638b37bc45?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Andrew S",
      "link" : "https://stackoverflow.com/users/6650475/andrew-s"
    },
    "creation_date" : 1743079521,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}