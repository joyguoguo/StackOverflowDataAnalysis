{
  "question" : {
    "question_id" : 79838436,
    "title" : "Swing tutorial: InputVerifier setup",
    "body" : "<p>Below you find the example code for an <a href=\"https://docs.oracle.com/javase/tutorial/displayCode.html?code=https://docs.oracle.com/javase/tutorial/uiswing/examples/misc/InputVerificationDialogDemoProject/src/misc/InputVerificationDialogDemo.java\" rel=\"nofollow noreferrer\">InputVerifier from the swing tutorial</a>, slightly modified to compile error-free under java 25.\nThe code creates an InputVerifer (<code>class MyVerifier</code>), which is set to the four JTextFields. Nowhere in the code the InputVerifier is &quot;removed&quot; (set to null), but in its <code>shouldYieldFocus(...)</code> method it is set anew with every verification (<code>input.setInputVerifier(this)</code>). Commenting out this line shows no different behaviour on my side. So is this line at least recommendable or maybe even necessary for reasons I cannot figure out?</p>\n<pre><code>//package misc;\n \nimport java.util.Set;\nimport java.util.HashSet;\n \nimport java.awt.*;\nimport java.awt.event.*;\n \nimport javax.swing.*;\nimport javax.swing.event.*;\nimport javax.swing.text.*;\n \nimport java.beans.PropertyChangeListener;\nimport java.beans.PropertyChangeEvent;\n \nimport java.text.*;\n \n/**\n * InputVerificationDialogDemo.java is a 1.4 example that\n * requires no other files.\n *\n * Yet another mortgage calculator.\n * However, instead of using a formatted text field,\n * as shown in FormattedTextFieldDemo, this example\n * uses input verification to validate user input.\n * This one uses a dialog to warn people when their input is bad.\n */\npublic class InputVerificationDialogDemo extends JPanel {\n    //Default values\n    private static double DEFAULT_AMOUNT = 100000;\n    private static double DEFAULT_RATE = 7.5;  //7.5 %\n    private static int DEFAULT_PERIOD = 30;\n \n    //Labels to identify the text fields\n    private JLabel amountLabel;\n    private JLabel rateLabel;\n    private JLabel numPeriodsLabel;\n    private JLabel paymentLabel;\n \n    //Strings for the labels\n    private static String amountString = &quot;Loan Amount (10,000 - 10,000,000): &quot;;\n    private static String rateString = &quot;APR (&gt;= 0%): &quot;;\n    private static String numPeriodsString = &quot;Years (1-40): &quot;;\n    private static String paymentString = &quot;Monthly Payment: &quot;;\n \n    //Text fields for data entry\n    private JTextField amountField;\n    private JTextField rateField;\n    private JTextField numPeriodsField;\n    private JTextField paymentField;\n \n    //Formats to format and parse numbers\n    private NumberFormat moneyFormat;\n    private NumberFormat percentFormat;\n    private DecimalFormat decimalFormat;\n    private DecimalFormat paymentFormat;\n    private NumberFormat integerFormat;\n    private MyVerifier verifier = new MyVerifier();\n \n    public InputVerificationDialogDemo() {\n        super(new BorderLayout());\n        setUpFormats();\n        double payment = computePayment(DEFAULT_AMOUNT,\n                                        DEFAULT_RATE,\n                                        DEFAULT_PERIOD);\n \n        //Create the labels.\n        amountLabel = new JLabel(amountString);\n        rateLabel = new JLabel(rateString);\n        numPeriodsLabel = new JLabel(numPeriodsString);\n        paymentLabel = new JLabel(paymentString);\n \n        //Create the text fields and set them up.\n        amountField = new JTextField(moneyFormat.format(DEFAULT_AMOUNT), 10);\n        amountField.setInputVerifier(verifier);\n \n        rateField = new JTextField(percentFormat.format(DEFAULT_RATE), 10);\n        rateField.setInputVerifier(verifier);\n \n        numPeriodsField = new JTextField(decimalFormat.format(DEFAULT_PERIOD), 10);\n        numPeriodsField.setInputVerifier(verifier);\n \n        paymentField = new JTextField(paymentFormat.format(payment), 10);\n        paymentField.setInputVerifier(verifier);\n        paymentField.setEditable(false);\n        //Remove this component from the focus cycle.\n        paymentField.setFocusable(false); \n        paymentField.setForeground(Color.red);\n \n        //Register an action listener to handle Return.\n        amountField.addActionListener(verifier);\n        rateField.addActionListener(verifier);\n        numPeriodsField.addActionListener(verifier);\n \n        //Tell accessibility tools about label/textfield pairs.\n        amountLabel.setLabelFor(amountField);\n        rateLabel.setLabelFor(rateField);\n        numPeriodsLabel.setLabelFor(numPeriodsField);\n        paymentLabel.setLabelFor(paymentField);\n \n        //Lay out the labels in a panel.\n        JPanel labelPane = new JPanel(new GridLayout(0,1));\n        labelPane.add(amountLabel);\n        labelPane.add(rateLabel);\n        labelPane.add(numPeriodsLabel);\n        labelPane.add(paymentLabel);\n \n        //Layout the text fields in a panel.\n        JPanel fieldPane = new JPanel(new GridLayout(0,1));\n        fieldPane.add(amountField);\n        fieldPane.add(rateField);\n        fieldPane.add(numPeriodsField);\n        fieldPane.add(paymentField);\n \n        //Put the panels in this panel, labels on left,\n        //text fields on right.\n        setBorder(BorderFactory.createEmptyBorder(20, 20, 20, 20));\n        add(labelPane, BorderLayout.CENTER);\n        add(fieldPane, BorderLayout.LINE_END);\n    }\n \n    class MyVerifier extends InputVerifier \n                     implements ActionListener {\n        double MIN_AMOUNT = 10000.0;\n        double MAX_AMOUNT = 10000000.0;\n        double MIN_RATE = 0.0;\n        int MIN_PERIOD = 1;\n        int MAX_PERIOD = 40;\n        String message = null;\n \n        public boolean shouldYieldFocus(JComponent input, JComponent target) {\n            boolean inputOK = verify(input);\n            makeItPretty(input);\n            updatePayment();\n \n            if (inputOK) {\n                return true;\n            }\n \n \n            //Beep and then tell whoever called us that we don't\n            //want to yield focus.\n            Toolkit.getDefaultToolkit().beep();\n            //Pop up the message dialog.\n            message += &quot;.\\nPlease try again.&quot;;\n            JOptionPane.showMessageDialog(null, //no owner frame\n                                          message, //text to display\n                                          &quot;Invalid Value&quot;, //title\n                                          JOptionPane.WARNING_MESSAGE);\n// vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv\n            //Reinstall the input verifier. - - WHY??\n//            input.setInputVerifier(this);\n// ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n/* Following lines moved up, to beep with the error message, not after closing the OptionPane.\n            //Beep and then tell whoever called us that we don't\n            //want to yield focus.\n            Toolkit.getDefaultToolkit().beep();\n*/\n            return false;\n        }\n \n        protected void updatePayment() {\n            double amount = DEFAULT_AMOUNT;\n            double rate = DEFAULT_RATE;\n            int numPeriods = DEFAULT_PERIOD;\n            double payment = 0.0;\n \n            //Parse the values.\n            try {\n                amount = moneyFormat.parse(amountField.getText()).\n                                 doubleValue();\n            } catch (ParseException pe) {}\n            try {\n                rate = percentFormat.parse(rateField.getText()).\n                                 doubleValue();\n            } catch (ParseException pe) {}\n            try {\n                numPeriods = decimalFormat.parse(numPeriodsField.getText()).\n                    intValue();\n            } catch (ParseException pe) {}\n \n            //Calculate the result and update the GUI.\n            payment = computePayment(amount, rate, numPeriods);\n            paymentField.setText(paymentFormat.format(payment));\n        }\n \n        //This method checks input, but should cause no side effects.\n        public boolean verify(JComponent input) {\n            return checkField(input, false);\n        }\n \n        protected void makeItPretty(JComponent input) {\n            checkField(input, true);\n        }\n \n        protected boolean checkField(JComponent input, boolean changeIt) {\n            if (input == amountField) {\n                return checkAmountField(changeIt);\n            } else if (input == rateField) {\n                return checkRateField(changeIt);\n            } else if (input == numPeriodsField) {\n                return checkNumPeriodsField(changeIt);\n            } else {\n                return true; //shouldn't happen\n            }\n        }\n \n        //Checks that the amount field is valid.  If it is valid,\n        //it returns true, otherwise it sets the message field and\n        //returns false.  If the change argument is true,  set\n        //the textfield to the parsed number so that it looks\n        //good -- no letters, for example.\n        public boolean checkAmountField(boolean change) {\n            boolean wasValid = true;\n            double amount = DEFAULT_AMOUNT;\n \n            //Parse the value.\n            try {\n                amount = moneyFormat.parse(amountField.getText()).\n                                     doubleValue();\n            } catch (ParseException pe) {\n                message = &quot;Invalid money format in Loan Amount field&quot;;\n                return false;\n            }\n \n            //Value was invalid.\n            if ((amount &lt; MIN_AMOUNT) || (amount &gt; MAX_AMOUNT)) {\n                wasValid = false;\n                if (amount &lt; MIN_AMOUNT) {\n                    message = &quot;Loan Amount was &lt; &quot;\n                              + integerFormat.format(MIN_AMOUNT);\n                } else { //amount is greater than MAX_AMOUNT\n                    message = &quot;Loan Amount was &gt; &quot;\n                              + integerFormat.format(MAX_AMOUNT);\n                }\n            }\n \n            //Whether value was valid or not, format it nicely.\n            if (change) {\n                amountField.setText(moneyFormat.format(amount));\n                amountField.selectAll();\n            }\n        return wasValid;\n        }\n \n        //Checks that the rate field is valid.  If it is valid,\n        //it returns true, otherwise it sets the message field and\n        //returns false. If the change argument is true, set the\n        //textfield to the parsed number so that it looks good -- no \n        //letters, for example.\n        public boolean checkRateField(boolean change) {\n            boolean wasValid = true;\n            double rate = DEFAULT_RATE;\n \n            //Parse the value.\n            try {\n                rate = percentFormat.parse(rateField.getText()).\n                                     doubleValue();\n            } catch (ParseException pe) {\n                message = &quot;Invalid percent format in APR field&quot;;\n                return false;\n            }\n \n            //Value was invalid.\n            if (rate &lt; MIN_RATE) {\n                wasValid = false;\n                message = &quot;Bad value: APR was &lt; &quot; + MIN_RATE;\n            }\n \n            //Whether value was valid or not, format it nicely.\n            if (change) {\n                rateField.setText(percentFormat.format(rate));\n                rateField.selectAll();\n            }\n \n            return wasValid;\n        }\n     \n        //Checks that the numPeriods field is valid.  If it is valid,\n        //it returns true, otherwise it sets the message field and\n        //returns false. If the change argument is true, set the \n        //textfield to the parsed number so that it looks good -- no\n        //letters, for example.\n        public boolean checkNumPeriodsField(boolean change) {\n            boolean wasValid = true;\n            int numPeriods = DEFAULT_PERIOD;\n \n            //Parse the value.\n            try {\n                numPeriods = decimalFormat.parse(numPeriodsField.getText()).\n                                           intValue();\n            } catch (ParseException pe) {\n                message = &quot;Invalid decimal format in Years field&quot;;\n                return false;\n            }\n           \n            //Value was invalid.\n            if (numPeriods &lt; MIN_PERIOD) {\n                wasValid = false;\n                message = &quot;Bad value: Number of years was &lt; &quot;\n                          + integerFormat.format(MIN_PERIOD);\n            } else if (numPeriods &gt; MAX_PERIOD) {\n                wasValid = false;\n                message = &quot;Bad value: Number of years was &gt; &quot;\n                          + integerFormat.format(MAX_PERIOD);\n            }\n \n            //Whether value was valid or not, format it nicely.\n            if (change) {\n                numPeriodsField.setText(decimalFormat.format(numPeriods));\n                numPeriodsField.selectAll();\n            }\n \n            return wasValid;\n        }\n \n        public void actionPerformed(ActionEvent e) {\n            JTextField source = (JTextField)e.getSource();\n            shouldYieldFocus(source); //ignore return value\n            source.selectAll();\n        }\n    }\n \n    /**\n     * Create the GUI and show it.  For thread safety,\n     * this method should be invoked from the\n     * event-dispatching thread.\n     */\n    private static void createAndShowGUI() {\n        //Create and set up the window.\n        JFrame frame = new JFrame(&quot;InputVerificationDialogDemo&quot;);\n        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n        JComponent newContentPane = new InputVerificationDialogDemo();\n        newContentPane.setOpaque(true); //content panes must be opaque\n        frame.setContentPane(newContentPane);\n \n        //Display the window.\n        frame.pack();\n        frame.setVisible(true);\n    }\n \n    public static void main(String[] args) {\n    /* Use an appropriate Look and Feel */\n        try {\n            //UIManager.setLookAndFeel(&quot;com.sun.java.swing.plaf.windows.WindowsLookAndFeel&quot;);\n            //UIManager.setLookAndFeel(&quot;com.sun.java.swing.plaf.gtk.GTKLookAndFeel&quot;);\n            UIManager.setLookAndFeel(&quot;javax.swing.plaf.metal.MetalLookAndFeel&quot;);\n        } catch (UnsupportedLookAndFeelException ex) {\n            ex.printStackTrace();\n        } catch (IllegalAccessException ex) {\n            ex.printStackTrace();\n        } catch (InstantiationException ex) {\n            ex.printStackTrace();\n        } catch (ClassNotFoundException ex) {\n            ex.printStackTrace();\n        }\n        /* Turn off metal's use of bold fonts */\n        UIManager.put(&quot;swing.boldMetal&quot;, Boolean.FALSE);\n         \n        //Schedule a job for the event-dispatching thread:\n        //creating and showing this application's GUI.\n        javax.swing.SwingUtilities.invokeLater(new Runnable() {\n            public void run() {\n                createAndShowGUI();\n            }\n        });\n    }\n \n    //Compute the monthly payment based on the loan amount,\n    //APR, and length of loan.\n    double computePayment(double loanAmt, double rate, int numPeriods) {\n        double I, partial1, denominator, answer;\n \n        numPeriods *= 12;        //get number of months\n        if (rate &gt; 0.01) {  \n            I = rate / 100.0 / 12.0;         //get monthly rate from annual\n            partial1 = Math.pow((1 + I), (0.0 - numPeriods));\n            denominator = (1 - partial1) / I;\n        } else { //rate ~= 0\n            denominator = numPeriods;\n        }\n        answer = (-1 * loanAmt) / denominator;\n        return answer;\n    }\n \n    //Create and set up number formats. These objects also\n    //parse numbers input by user.\n    private void setUpFormats() {\n        moneyFormat = (NumberFormat)NumberFormat.getNumberInstance();\n \n        percentFormat = NumberFormat.getNumberInstance();\n        percentFormat.setMinimumFractionDigits(3);\n \n        decimalFormat = (DecimalFormat)NumberFormat.getNumberInstance();\n        decimalFormat.setParseIntegerOnly(true);\n \n        paymentFormat = (DecimalFormat)NumberFormat.getNumberInstance();\n        paymentFormat.setMaximumFractionDigits(2);\n        paymentFormat.setNegativePrefix(&quot;(&quot;);\n        paymentFormat.setNegativeSuffix(&quot;)&quot;);\n \n        integerFormat = NumberFormat.getIntegerInstance();\n    }\n}\n</code></pre>\n",
    "tags" : [ "java", "swing", "inputverifier" ],
    "owner" : {
      "account_id" : 11415665,
      "reputation" : 341,
      "user_id" : 8368531,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e0971307b6d3fa7d038cc2b998554fea?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "J&#246;rg",
      "link" : "https://stackoverflow.com/users/8368531/j%c3%b6rg"
    },
    "is_answered" : true,
    "view_count" : 64,
    "answer_count" : 3,
    "score" : 3,
    "last_activity_date" : 1764926500,
    "creation_date" : 1764890910,
    "link" : "https://stackoverflow.com/questions/79838436/swing-tutorial-inputverifier-setup",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79838623,
    "question_id" : 79838436,
    "body" : "<p>There was a <a href=\"https://docs.oracle.com/javase/7/docs/technotes/guides/swing/1.4/SwingChanges.html#bug4532517\" rel=\"nofollow noreferrer\">known bug</a> a long time ago where popping a <code>JOptionPane</code> would not properly transfer focus back to the component when the dialog was closed, and the suggested workaround was to uninstall the <code>InputVerifier</code> before popping the modal dialog and reinstalling after the dialog was closed.</p>\n<p>The <code>InputVerificationDialogDemo</code> code pops a <code>JOptionPane</code> inside <code>shouldYieldFocus</code> and then immediately reinstalls the <code>InputVerifier</code>. So it may be the case (or, rather, a wild guess) that when the bug was fixed, then <code>InputVerificationDialogDemo</code> was not properly updated to remove both uninstall and reinstall statements.</p>\n<p>I don't know if we can find the history of <code>InputVerificationDialogDemo.java</code> somewhere publicly though, nor testing in the buggy version should be worth it, just to verify this wild guess.</p>\n<p>Seems the bug existed around version 1.4.<em>something</em>, because of the initial link in my reply. We could find the runtime environments (<a href=\"https://www.oracle.com/java/technologies/java-archive-javase-v14-downloads.html\" rel=\"nofollow noreferrer\">here</a>) but they would not include the demo I believe, nor decompiling it to Java is worth it I guess. The source code of 1.4 is not published, according to <a href=\"https://unix.stackexchange.com/a/256119\">another SE answer</a>, so it doesn't sound much promising looking for it of course.</p>\n",
    "score" : 2,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 9059972,
      "reputation" : 3471,
      "user_id" : 6746785,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/3zi2O.png?s=256",
      "display_name" : "gthanop",
      "link" : "https://stackoverflow.com/users/6746785/gthanop"
    },
    "creation_date" : 1764919486,
    "last_activity_date" : 1764926500,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79838528,
    "question_id" : 79838436,
    "body" : "<p>Good question.  I cannot imagine why that line would be needed.</p>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44971,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1764906904,
    "last_activity_date" : 1764906904,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "answer_id" : 79838656,
    "question_id" : 79838436,
    "body" : "<p>Thanks for your replies. Now I'm calm again. ;-)</p>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 11415665,
      "reputation" : 341,
      "user_id" : 8368531,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/e0971307b6d3fa7d038cc2b998554fea?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "J&#246;rg",
      "link" : "https://stackoverflow.com/users/8368531/j%c3%b6rg"
    },
    "creation_date" : 1764921699,
    "last_activity_date" : 1764921699,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}