{
  "question" : {
    "question_id" : 79621907,
    "title" : "Power BI import PBIX file with quarkus-rest-client",
    "body" : "<p>I am currently facing an issue to call the <a href=\"https://learn.microsoft.com/en-us/rest/api/power-bi/imports/post-import-in-group\" rel=\"nofollow noreferrer\">&quot;POST import&quot;</a> endpoint of Power BI Rest API.</p>\n<p>I have to import a pbix file (that is far less than 1GB so that's good for that).</p>\n<p>My application uses quarkus-rest-client to generate client code.\nAs a result I configured this endpoint:</p>\n<pre class=\"lang-java prettyprint-override\"><code>    @POST\n    @Consumes(MediaType.MULTIPART_FORM_DATA)\n    @Path(&quot;/groups/{groupId}/imports&quot;)\n    @Produces(MediaType.APPLICATION_JSON)\n    ImportResp importLightReport(\n        @HeaderParam(&quot;Authorization&quot;) String bearerToken,\n        @PathParam(&quot;groupId&quot;) String groupId,\n        @QueryParam(&quot;datasetDisplayName&quot;) String datasetDisplayName,\n        @QueryParam(&quot;nameConflict&quot;) String nameConflict,\n        @QueryParam(&quot;overrideModelLabel&quot;) boolean overrideModelLabel,\n        @QueryParam(&quot;overrideReportLabel&quot;) boolean overrideReportLabel,\n        @QueryParam(&quot;skipReport&quot;) boolean skipReport,\n        FileUpload file\n    );\n</code></pre>\n<p>Then, I try to call it like that:</p>\n<pre class=\"lang-java prettyprint-override\"><code>FormData data = new FormData(1);\nCaseInsensitiveMap&lt;String&gt; headers = new CaseInsensitiveMap&lt;&gt;();\nheaders.add(&quot;Content-Type&quot;, &quot;application/octet-stream&quot;);\ndata.add(&quot;file&quot;, path, newReportName, headers);\nFileUpload fileUpload = new DefaultFileUpload(&quot;file&quot;, data.getFirst(&quot;file&quot;));\nimportResp = reportClient.importLightReport(\nbuildBearerToken(accessToken), targetId, newReportName,\noverwrite ? &quot;Overwrite&quot; : &quot;Abort&quot;, true, true, false, fileUpload);\n</code></pre>\n<p>But the API always answer me</p>\n<pre class=\"lang-json prettyprint-override\"><code>{&quot;error&quot;:{&quot;code&quot;:&quot;PowerBIInvalidOrCorruptPbixFileError&quot;,&quot;pbi.error&quot;:{&quot;code&quot;:&quot;PowerBIInvalidOrCorruptPbixFileError&quot;,&quot;parameters&quot;:{},&quot;details&quot;:[],&quot;exceptionCulprit&quot;:1}}}\n</code></pre>\n<p>I don't understand why. Of course I tested my reports are valid pbix, I tested them.</p>\n<p>For information, I tested putting &quot;@RestForm&quot; on the client, but there is another error that appears &quot;invalid size&quot;. What am I doing wrong here?</p>\n",
    "tags" : [ "java", "powerbi", "quarkus", "powerbi-rest-api" ],
    "owner" : {
      "account_id" : 1290055,
      "reputation" : 3703,
      "user_id" : 1242324,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/83cee414a2e4d392814266af39dfafd3?s=256&d=identicon&r=PG",
      "display_name" : "artragis",
      "link" : "https://stackoverflow.com/users/1242324/artragis"
    },
    "is_answered" : true,
    "view_count" : 89,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1747484551,
    "creation_date" : 1747239946,
    "link" : "https://stackoverflow.com/questions/79621907/power-bi-import-pbix-file-with-quarkus-rest-client",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79626370,
    "question_id" : 79621907,
    "body" : "<p>With a colleague we investigated further on what's wrong with the OP code and why the errors were happening.</p>\n<p>TL;DR: it is <strong>impossible</strong> to call this specific endpoint of the Power BI API with quarkus-rest-client, we have to implement the call with native http client.</p>\n<h1>The configuration</h1>\n<p>With quarkus-rest-client, the <code>@RestForm(&quot;file&quot;)</code> is <strong>mandatory</strong>. If you do not put it, the payload is not even sent, hence the &quot;corrupted file&quot; error that triggered the OP.</p>\n<p>However, like I said, if we put this annotation we have a <code>InvalidFileSizeError</code> from microsoft.</p>\n<p>After some research we found that the <code>Content-Length</code> header was mandatory. But quarkus-rest-client <strong>does</strong> send it. So we did not understand what was happening.</p>\n<p>After some try-and-fail experiment, my colleague reached this conclusion: Microsoft expects the <code>Content-Length</code> header to exactly match the raw file size. On the opposite, quarkus-rest-client sends the http body size (i.e including the boundary, part headers...) and it is <strong>impossible</strong> to change this behaviour.</p>\n<p>The only way we found was to use the native java HTTP client: <code>ClientConnection connection=new URI(url).toURL().openConnection()</code> then build the boundaries and part by hand and valuate the <code>Content-Length</code> with the file size <code>connection.setRequestProperty(&quot;Content-Length&quot;, path.toFile().length())</code>.</p>\n<p>Regards</p>\n",
    "score" : 0,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 1290055,
      "reputation" : 3703,
      "user_id" : 1242324,
      "user_type" : "registered",
      "accept_rate" : 100,
      "profile_image" : "https://www.gravatar.com/avatar/83cee414a2e4d392814266af39dfafd3?s=256&d=identicon&r=PG",
      "display_name" : "artragis",
      "link" : "https://stackoverflow.com/users/1242324/artragis"
    },
    "creation_date" : 1747473570,
    "last_activity_date" : 1747484551,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : { }
}