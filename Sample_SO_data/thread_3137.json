{
  "question" : {
    "question_id" : 79569684,
    "title" : "Java Stream API: Incompatible types: List&lt;ArrayList&gt;&gt; cannot be converted to List&lt;List&gt;",
    "body" : "<p>My intention was to replace the following snippet:</p>\n<pre><code>List&lt;List&lt;String&gt;&gt; lists;\nfor (int i = 0; i &lt; n; i++)\n    lists.add(new ArrayList&lt;String&gt;());\n</code></pre>\n<p>with Stream API one-liner:</p>\n<pre><code>List&lt;List&lt;String&gt;&gt; lists = Stream.generate(ArrayList&lt;String&gt;::new).limit(n).toList();\n</code></pre>\n<p>but I stumbled upon the following error:</p>\n<pre><code>error: incompatible types: List&lt;ArrayList&lt;String&gt;&gt; cannot be converted to List&lt;List&lt;String&gt;&gt;\n</code></pre>\n<p>Change of field declaration to:</p>\n<pre><code>List&lt;ArrayList&lt;String&gt;&gt;\n</code></pre>\n<p>fixes the error, but I don't really want to break convention to specify only interfaces on lefthand side.</p>\n<p>Any ideas what's wrong with the Stream snippet? Or may be suggest your variant.</p>\n",
    "tags" : [ "java", "generics", "interface", "java-stream" ],
    "owner" : {
      "account_id" : 1018998,
      "reputation" : 41,
      "user_id" : 1029915,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/916b19c2f7599a4ae724750d0793eb20?s=256&d=identicon&r=PG",
      "display_name" : "Alex G",
      "link" : "https://stackoverflow.com/users/1029915/alex-g"
    },
    "is_answered" : true,
    "view_count" : 92,
    "answer_count" : 1,
    "score" : 2,
    "last_activity_date" : 1744408351,
    "creation_date" : 1744404029,
    "link" : "https://stackoverflow.com/questions/79569684/java-stream-api-incompatible-types-listarraylist-cannot-be-converted-to-lis",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79569700,
    "question_id" : 79569684,
    "body" : "<p>Seems like the type inference trips up on <code>toList()</code>. It works fine with the old <code>collect()</code> termination:</p>\n<pre><code>List&lt;List&lt;String&gt;&gt; lists = Stream.generate(ArrayList&lt;String&gt;::new)\n        .limit(n)\n        .collect(Collectors.toList());\n</code></pre>\n",
    "score" : 4,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 1691630,
      "reputation" : 51067,
      "user_id" : 1553851,
      "user_type" : "registered",
      "accept_rate" : 73,
      "profile_image" : "https://www.gravatar.com/avatar/ad333c218c8f2fb917cf506919fc95f4?s=256&d=identicon&r=PG",
      "display_name" : "shmosel",
      "link" : "https://stackoverflow.com/users/1553851/shmosel"
    },
    "creation_date" : 1744404943,
    "last_activity_date" : 1744404943,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140326456,
    "post_id" : 79569684,
    "body" : "In Java, <code>List&lt;T&gt;</code> is said to be <i>invariant</i> [in <code>T</code>] -- <code>List&lt;T&gt;</code> cannot be used where <code>List&lt;U&gt;</code> is expected, even if <code>T</code> is a subclass of <code>U</code> or <code>U</code> is a sub-class of <code>T</code>. So even though an <code>ArrayList&lt;String&gt;</code> <i>is</i> a <code>List&lt;String&gt;</code>, a <code>List&lt;ArrayList&lt;String&gt;&gt;</code> is not a <code>List&lt;List&lt;String&gt;&gt;</code>. Although <a href=\"https://stackoverflow.com/a/79569700/254343\">@shmosel&#39;s answer</a> does give you a solution in your specific case, I thought you&#39;d be interested in the general cause at play here. See also <a href=\"https://en.wikipedia.org/wiki/Covariance_and_contravariance_(computer_science)\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/&hellip;</a>.",
    "score" : 0,
    "owner" : {
      "account_id" : 92878,
      "reputation" : 9270,
      "user_id" : 254343,
      "user_type" : "registered",
      "accept_rate" : 64,
      "profile_image" : "https://i.sstatic.net/iEaBt.jpg?s=256",
      "display_name" : "Armen Michaeli",
      "link" : "https://stackoverflow.com/users/254343/armen-michaeli"
    },
    "creation_date" : 1744410479,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79569700" : [ {
      "comment_id" : 140326338,
      "post_id" : 79569700,
      "body" : "It also works with type hint <code>Stream.&lt;List&lt;String&gt;&gt;generate(ArrayList&lt;String&gt;::new)</code> etc.",
      "score" : 7,
      "owner" : {
        "account_id" : 318670,
        "reputation" : 16467,
        "user_id" : 636009,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/IIQJV.jpg?s=256",
        "display_name" : "David Conrad",
        "link" : "https://stackoverflow.com/users/636009/david-conrad"
      },
      "creation_date" : 1744407070,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}