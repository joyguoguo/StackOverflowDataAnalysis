{
  "question" : {
    "question_id" : 79638969,
    "title" : "Explicitly referencing other mappers in MapStruct mapper",
    "body" : "<p>What if I need another mapper to create a mapping method implementation?</p>\n<p>Since Java interfaces don't allow instance fields (nor should they), my mapper declaration must be an abstract class. However, it didn't help me much.</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Mapper(uses = EmailMapper.class,\n        componentModel = &quot;spring&quot;,\n        injectionStrategy = InjectionStrategy.CONSTRUCTOR)\npublic abstract class UserMapper {\n\n    private final EmailMapper emailMapper; // another mapper\n\n    protected UserMapper(EmailMapper emailMapper) {\n        this.emailMapper = emailMapper;\n    }\n\n    public User toUser(UpdateUserRequestDto dto) {\n        User user = new User();\n        user.setId(dto.getId());\n        // referencing another mapper\n        user.setEmailData(emailMapper.toEmailDatas(dto.getEmailData(), user));\n        return user;\n    }\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>@Mapper(componentModel = &quot;spring&quot;,\n        injectionStrategy = InjectionStrategy.CONSTRUCTOR)\npublic interface EmailMapper {\n\n    @Mapping(source = &quot;email&quot;, target = &quot;email&quot;)\n    @Mapping(source = &quot;user&quot;, target = &quot;user&quot;)\n    EmailData toEmailData(String email, User user);\n\n    default List&lt;EmailData&gt; toEmailDatas(List&lt;String&gt; emails, User user) {\n        List&lt;EmailData&gt; emailData = emails.stream()\n                .map(e -&gt; toEmailData(e, user))\n                .toList();\n        return emailData;\n    }\n}\n</code></pre>\n<p>Here's what MapStruct generated:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Component\npublic class UserMapperImpl extends UserMapper {\n\n    private final EmailMapper emailMapper;\n\n    @Autowired\n    public UserMapperImpl(EmailMapper emailMapper) {\n\n        this.emailMapper = emailMapper;\n    }\n</code></pre>\n<p>It declared its own field instead of passing the mapper to <code>super()</code> as I intended.</p>\n<p>So how do I reference other mappers in my mapping method implementations?</p>\n",
    "tags" : [ "java", "mapstruct" ],
    "owner" : {
      "account_id" : 10187542,
      "reputation" : 2681,
      "user_id" : 20692967,
      "user_type" : "registered",
      "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
      "display_name" : "Sergey Zolotarev",
      "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
    },
    "is_answered" : true,
    "view_count" : 71,
    "answer_count" : 1,
    "score" : 2,
    "last_activity_date" : 1748329769,
    "creation_date" : 1748264634,
    "link" : "https://stackoverflow.com/questions/79638969/explicitly-referencing-other-mappers-in-mapstruct-mapper",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79639965,
    "question_id" : 79638969,
    "body" : "<p>One solution is to declare the dependency mapper using setter instead of constructor.</p>\n<p>If you are using Lombok, you can write it like this:</p>\n<pre><code>@Mapper(componentModel = &quot;spring&quot;)\npublic abstract class UserMapper {\n\n    @Setter(onMethod_ = @Autowired)\n    private EmailMapper emailMapper; // another mapper\n\n    ...\n}\n</code></pre>\n<p>Or, without Lombok:</p>\n<pre><code>@Mapper(componentModel = &quot;spring&quot;)\npublic abstract class UserMapper {\n\n    private EmailMapper emailMapper; // another mapper\n\n    @Autowired\n    public void setEmailMapper(EmailMapper emailMapper) {\n        this.emailMapper = emailMapper;\n    }\n\n    ...\n}\n</code></pre>\n",
    "score" : 2,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 2714938,
      "reputation" : 6448,
      "user_id" : 2342529,
      "user_type" : "registered",
      "accept_rate" : 98,
      "profile_image" : "https://i.sstatic.net/SSkK4.jpg?s=256",
      "display_name" : "Alexandru Severin",
      "link" : "https://stackoverflow.com/users/2342529/alexandru-severin"
    },
    "creation_date" : 1748329769,
    "last_activity_date" : 1748329769,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79639965" : [ {
      "comment_id" : 140462624,
      "post_id" : 79639965,
      "body" : "I agree with you but Mapstruct doesn&#39;t seem to support calling super constructors. While double checking I found this question which has more details in answers: <a href=\"https://stackoverflow.com/q/58451618/2342529\">stackoverflow.com/q/58451618/2342529</a>",
      "score" : 1,
      "owner" : {
        "account_id" : 2714938,
        "reputation" : 6448,
        "user_id" : 2342529,
        "user_type" : "registered",
        "accept_rate" : 98,
        "profile_image" : "https://i.sstatic.net/SSkK4.jpg?s=256",
        "display_name" : "Alexandru Severin",
        "link" : "https://stackoverflow.com/users/2342529/alexandru-severin"
      },
      "creation_date" : 1748352532,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140462563,
      "post_id" : 79639965,
      "body" : "Yeah, you&#39;re right, it was a silly question. However, I&#39;m not 100% comfortable with mandatory dependencies being injected through setters (which are typically designated for optional dependencies)",
      "score" : 0,
      "owner" : {
        "account_id" : 10187542,
        "reputation" : 2681,
        "user_id" : 20692967,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
        "display_name" : "Sergey Zolotarev",
        "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
      },
      "creation_date" : 1748351472,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140462064,
      "post_id" : 79639965,
      "body" : "@SergeyZolotarev , You can use the implementation without Spring. To do this, just create an instance and call the setter to set the dependency",
      "score" : 1,
      "owner" : {
        "account_id" : 2714938,
        "reputation" : 6448,
        "user_id" : 2342529,
        "user_type" : "registered",
        "accept_rate" : 98,
        "profile_image" : "https://i.sstatic.net/SSkK4.jpg?s=256",
        "display_name" : "Alexandru Severin",
        "link" : "https://stackoverflow.com/users/2342529/alexandru-severin"
      },
      "creation_date" : 1748340549,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140461913,
      "post_id" : 79639965,
      "body" : "Thank you. Does it mean I now can&#39;t initialize the mapper without Spring, for example for my unit-tests?",
      "score" : 0,
      "owner" : {
        "account_id" : 10187542,
        "reputation" : 2681,
        "user_id" : 20692967,
        "user_type" : "registered",
        "profile_image" : "https://i.sstatic.net/NZSXm.jpg?s=256",
        "display_name" : "Sergey Zolotarev",
        "link" : "https://stackoverflow.com/users/20692967/sergey-zolotarev"
      },
      "creation_date" : 1748337820,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}