{
  "question" : {
    "question_id" : 79778955,
    "title" : "Trying to marshall a `Double` into `&lt;Value xsi:type=&quot;xsd:double&quot;&gt;12.34&lt;/Value&gt;` with JAXB",
    "body" : "<p>First of all, I am pretty new to Java so most of what I am trying to do is likely to be wrong and I dont understand a lot of the stuff I am dealing with. I have been trying to solve this exact problem for about 3 or 4 workdays (spread over the last two weeks) and have developed quite the frustration for JAXB. Java itself and most other projects seem to be more or less fine, but JAXB especially seems to exist solely to prevent me from getting work done. This has been a messy path up to my current situation for this problem (I also had problems with other things like <code>wsimport</code>, which I could solve), but I try to describe my attempts at solving this particual problem in a more or less straightforward way.</p>\n<p>Installed Packages:</p>\n<pre><code>org.springframework.boot:spring-boot-starter-web-services\ncom.sun.xml.ws:jaxws-rt:4.0.2\ncom.sun.xml.bind:jaxb-xjc:4.0.5\ncom.sun.xml.bind:jaxb-impl:4.0.5\norg.jvnet.jaxb:jaxb-tools-project:4.0.11\nwsdl4j:wsdl4j\n</code></pre>\n<p>We have a project which connects to a SOAP service of several external endpoints and downloads information from these endpoints. That software seems to work, but I want to write integration-tests using a self-written test-server-implementation for this project.</p>\n<p>(This means that I do not want to modify the actual productive client / the unmarshaller in that client.)</p>\n<p>I have a WSDL file (a <code>*.asmx</code> file, to be precise) which is provided by an external party (not the webservice-providers themself, but a few levels &quot;above&quot; them). I want to write my test-server an an SOAP-Webservice using <a href=\"https://spring.io/projects/spring-ws\" rel=\"nofollow noreferrer\">Spring-WebServices</a> using that WSDL. I have created Java Classes from that WSDL (the extracted XSD Schema) using <code>wsimport</code> and defined my Spring <code>@Endpoint</code>, which I have confirmed is working.</p>\n<p>The XSD Schema of the WSDL file contains a <code>Value</code> element without any type in one of it's complex-types, like this:</p>\n<pre><code>  ...\n  &lt;s:element minOccurs=&quot;0&quot; maxOccurs=&quot;1&quot; name=&quot;Value&quot; /&gt;\n  ...\n</code></pre>\n<p>This <code>Value</code> tag can have many different shapes, most of which are not specified inside of the WSDL schema (I am not even sure they can be specified using XSD/WSDL, but maybe I have to try if all else fails). I cannot really modify the WSDL file easily, as we will be getting new versions of that file in the future by said external party. Manually changing the generated classes is also something which I would like to avoid, although I have been doing it while searching for a solution to this problem, using patch-files in the build-process. In my current situation, I have a patchfile applied during the build that changes the generated <code>@XmlElement(name = &quot;Value&quot;)</code> into <code>@XmlAnyElement(lax = true)</code> for that generated property (which is of type <code>Object</code> in the generated Java, by the way).</p>\n<p>My current &quot;milestone&quot; target for that <code>Value</code> tag is to have a Java <code>Double</code> object be marshalled into the piece of XML from the title: <code>&lt;Value xsi:type=&quot;xsd:double&quot;&gt;12.34&lt;/Value&gt;</code>, with the namespace aliases correctly corresponding to the namespace aliases that JAXB will be generating later when marshalling the SOAP response. I need it to be a lot more flexible in the future to support all kinds of data-types and structures, but as a first step <code>Double</code> would be enough (it would be at least <em>some</em> progress).</p>\n<h2>What I have tried so far:</h2>\n<h4>1.: Using external JAXB-Binding <code>*.xjb</code> files</h4>\n<p>My first attempt was to define an external binding file to tell JAXB to map <code>Double</code> into the desired piece of XML, while still preserving the polymorphic nature of that tag, using something like this:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;\n&lt;jaxb:bindings xmlns:jaxb=&quot;https://jakarta.ee/xml/ns/jaxb&quot;\n               xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n               xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;\n               xsi:schemaLocation=&quot;https://jakarta.ee/xml/ns/jaxb https://jakarta.ee/xml/ns/jaxb/bindingschema_3_0.xsd&quot;\n               version=&quot;3.0&quot;\n&gt;\n    &lt;jaxb:bindings schemaLocation=&quot;Schema.xsd&quot; node=&quot;/xsd:schema&quot;&gt;\n        &lt;jaxb:bindings node=&quot;//xsd:complexType[@name='Parent']//xsd:element[@name='Value']&quot;&gt;\n            &lt;jaxb:property&gt;\n                &lt;jaxb:baseType&gt;\n                    &lt;jaxb:javaType\n                            name=&quot;java.lang.Object&quot;\n                            parseMethod=&quot;foo.bar.XmlValueAdapter.parseMethod&quot;\n                            printMethod=&quot;foo.bar.XmlValueAdapter.printMethod&quot;\n                    /&gt;\n                &lt;/jaxb:baseType&gt;\n            &lt;/jaxb:property&gt;\n        &lt;/jaxb:bindings&gt;\n    &lt;/jaxb:bindings&gt;\n&lt;/jaxb:bindings&gt;\n</code></pre>\n<p>With static mapping methods like <code>parseMethod</code> and <code>printMethod</code>. Unfortunately this does not work:</p>\n<pre><code>parsing a schema...\n[ERROR] compiler was unable to honor this javaType customization. It is attached to a wrong place, or its inconsistent with other bindings.\n  line 22 of file:/home/user/git/foo/bar/src/main/resources/wsdl/binding.xjb\n\n[ERROR] (the above customization is attached to the following location in the schema)\n  line 195 of file:/home/user/git/foo/bar/test-server/src/main/resources/wsdl/Schema.xsd\n\nFailed to parse a schema.\n</code></pre>\n<p>I am not entirely sure why this javaType binding seems to be in the wrong place, but my working theory is that bindings like these\ncan only be applied to types (<code>simpleType</code> / <code>complexType</code>) and not to tags without a type.\nThe example I have seen online has applied this javaType bindung to the <code>simpleType</code> tag in the schema,\nwhich is not something I can do here because this tag has no type.</p>\n<p>By the way, I also tried this variant (with an <code>jakarta.xml.bind.annotation.adapters.XmlAdapter.XmlAdapter&lt;Object, Object&gt;</code>) but got the same error:</p>\n<pre><code>...\n  xmlns:xjc=&quot;http://java.sun.com/xml/ns/jaxb/xjc&quot;\n...\n      &lt;xjc:javaType\n          name=&quot;java.lang.Object&quot;\n          adapter=&quot;foo.bar.XmlValueAdapter&quot;\n      /&gt;\n...\n</code></pre>\n<p>And I also tried it without the <code>&lt;jaxb:property&gt;</code> and <code>&lt;jaxb:baseType&gt;</code> tags and many many other variations, with no change to the error message.</p>\n<h4>2.: Using JAXBElement</h4>\n<p>My next attempt was to put an instance of <code>JAXBElement</code> into the object-graph like this:</p>\n<pre><code>JAXBElement&lt;Double&gt; element = new JAXBElement&lt;Double&gt;(new QName(NAMESPACE, &quot;Value&quot;), Double.class, inputDouble);\nelement.setValue(inputDouble.toString());\nreturn element;\n</code></pre>\n<p>... while appling <code>marshaller.setSupportJaxbElementClass(true)</code> to the marshaller.</p>\n<p>This seems to somewhat work, but fails because:</p>\n<ul>\n<li>A) the <code>xsi:type=&quot;xsd:double&quot;</code> part is missing from the generated XML tag, and</li>\n<li>B) the unmarshaller in the client resolved this into an instance of <code>com.sun.org.apache.xerces.internal.dom.ElementNSImpl</code> (with <code>type=null</code>), instead of into a <code>Double</code> object directly. When using the client with a &quot;real&quot; external service, a <code>Double</code> is produced directly at that place (by JAXB, maybe because of that missing <code>type</code> information?).</li>\n</ul>\n<p>There also seems to be no way of setting an <code>xsi:type=&quot;xsd:double&quot;</code> attribute using <code>JAXBElement</code>, so I dont think that this will work.</p>\n<h4>3.: Using <code>@XmlAnyElement</code> with <code>org.w3c.dom.Document.createElementNS</code></h4>\n<p>At this point I have became somewhat desperate and have added the above mentioned patch-file to my build-process and tried to create the element (somewhat) like this:</p>\n<pre><code>import javax.xml.parsers.DocumentBuilderFactory;\nimport org.w3c.dom.Document;\nimport org.w3c.dom.Element;\n\nDocument doc = DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument()\nElement element = doc.createElementNS(NAMESPACE, &quot;Value&quot;);\nelement.setAttributeNS(XSI_NS, &quot;type&quot;, &quot;xsd:double&quot;);\nelement.setTextContent(input.toString());\nreturn element;\n</code></pre>\n<p>This has the obvious drawback that the <code>xsd:</code> prefix is hardcoded, which will break as soon as JASX will decide to use a different prefix for that namespace. But if it would work, I would have at least <em>some</em> working solution.</p>\n<p>Unfortunately this does also not work because the created Element is written as a root tag with it's own namespaces in the resulting XML structure, which the client is unable to parse.</p>\n<p>(As a sidenote: An obvious way to provide this via the DOM-API would have been to allow QName as a value to <code>setAttributeNS</code> and have the JASX figure out the correct namespace alias later, but sadly the DOM-API does not support that.)</p>\n",
    "tags" : [ "java", "spring", "soap", "jaxb", "xjb" ],
    "owner" : {
      "account_id" : 44146551,
      "reputation" : 11,
      "user_id" : 31601259,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/ac49657865913a5e0c06145faefd0e87?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "user31601259",
      "link" : "https://stackoverflow.com/users/31601259/user31601259"
    },
    "is_answered" : false,
    "view_count" : 39,
    "answer_count" : 0,
    "score" : 1,
    "last_activity_date" : 1759317668,
    "creation_date" : 1759225627,
    "link" : "https://stackoverflow.com/questions/79778955/trying-to-marshall-a-double-into-value-xsitype-xsddouble12-34-value",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140768547,
    "post_id" : 79778955,
    "body" : "Please trim your code to make it easier to find your problem. Follow these guidelines to create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>.",
    "score" : 0,
    "owner" : {
      "account_id" : -1,
      "reputation" : 1,
      "user_id" : -1,
      "user_type" : "moderator",
      "profile_image" : "https://www.gravatar.com/avatar/a007be5a61f6aa8f3e85ae2fc18dd66e?s=256&d=identicon&r=PG",
      "display_name" : "Community",
      "link" : "https://stackoverflow.com/users/-1/community"
    },
    "creation_date" : 1759229917,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}