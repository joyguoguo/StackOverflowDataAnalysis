{
  "question" : {
    "question_id" : 79690290,
    "title" : "Configure Jackson default deserialization subtype using `JsonMapper.Builder`",
    "body" : "<p>Let's say there is an existing abstract subclass that I want Jackson to always deserialize as a certain other class, but I didn't create the parent class so I can't add an annotation to the parent class. For example let's say that the requested type is <code>java.lang.Number</code>, but I always want Jackson to deserialize the value as a <code>java.math.BigDecimal</code>.</p>\n<p>My actual use case involves an interface I always want to have deserialized as a concrete class I have created. If there is a <code>com.example.thirdparty.Person</code> interface someone has created, when some deserialization scenario arises for <code>Person</code> I want Jackson to deserialize to a <code>com.example.mycustom.Neighbor</code> record that I have created which implements <code>Person</code>.</p>\n<p>I am using a Jackson <code>JsonMapper.Builder</code> to create an <code>ObjectMapper</code>. How can I tell the <code>JsonMapper.Builder</code> to do the following?</p>\n<ul>\n<li>&quot;When a <code>java.lang.Number</code> is requested, deserialize the value as if <code>java.math.BigDecimal</code> were requested.&quot;</li>\n<li>&quot;When a <code>com.example.thirdparty.Person</code> is requested, deserialize the value as if <code>com.example.mycustom.Neighbor</code> were requested.&quot;</li>\n</ul>\n<p>I assume what I want is similar to the effects of <code>@JsonDeserialize(as=ValueImpl.class)</code>, but I want to configure this on an <code>ObjectMapper</code> level using <code>JsonMapper.Builder</code> for <code>java.lang.Number</code> and <code>com.example.thirdparty.Person</code> regardless of the context; i.e. regardless of which classes have those types as fields. (In my use case these requested types won't even be fields anyway, but that's another story.)</p>\n",
    "tags" : [ "java", "json", "jackson" ],
    "owner" : {
      "account_id" : 184786,
      "reputation" : 22234,
      "user_id" : 421049,
      "user_type" : "registered",
      "accept_rate" : 50,
      "profile_image" : "https://www.gravatar.com/avatar/4b9b843fe8e233b2f70e0f2a8e7db4e8?s=256&d=identicon&r=PG",
      "display_name" : "Garret Wilson",
      "link" : "https://stackoverflow.com/users/421049/garret-wilson"
    },
    "is_answered" : true,
    "view_count" : 86,
    "answer_count" : 1,
    "score" : 3,
    "last_activity_date" : 1751638983,
    "creation_date" : 1751637028,
    "link" : "https://stackoverflow.com/questions/79690290/configure-jackson-default-deserialization-subtype-using-jsonmapper-builder",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79690312,
    "question_id" : 79690290,
    "body" : "<h1>Using <code>AbstractTypeResolver</code></h1>\n<p>You can use <code>AbstractTypeResolver</code> to add rules on what desired class to instantiate on deserialization.</p>\n<p>Let's set a rule to always deserialize <code>Number</code> as <code>BigDecimal</code>. You can create the <code>ObjectMapper</code> like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>var builder = JsonMapper.builder();\n\nvar resolver = new SimpleAbstractTypeResolver();\nresolver.addMapping(Number.class, BigDecimal.class);\nresolver.addMapping(...);\nresolver.addMapping(...);\n\nvar module = new SimpleModule();\nmodule.setAbstractTypes(resolver);\n\nbuilder.addModule(module);\n\nreturn builder.build();\n</code></pre>\n<h1>Using <code>Module</code> only</h1>\n<p>If you don't have a need to add an additional layer of abstraction, simply add type mapping on the <code>Module</code> itself the following way:</p>\n<pre class=\"lang-java prettyprint-override\"><code>var builder = JsonMapper.builder();\n\nvar module = new SimpleModule();\nmodule.addAbstractTypeMapping(Number.class, BigDecimal.class);\n\nbuilder.addModule(module);\n\nreturn builder.build();\n</code></pre>\n<h1>Test</h1>\n<pre class=\"lang-java prettyprint-override\"><code>@Test\nvoid shouldDeserializeAsBigInteger() throws JsonProcessingException {\n  Integer a = 2;\n\n  var serialized = objectMapper.writeValueAsString(a);\n  var deserialized = objectMapper.readValue(serialized, Number.class);\n\n  assertThat(deserialized).isInstanceOf(BigDecimal.class);\n}\n</code></pre>\n",
    "score" : 4,
    "is_accepted" : true,
    "owner" : {
      "account_id" : 40864244,
      "reputation" : 632,
      "user_id" : 30001713,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/f59ea01a76709335047f0cee269d788e?s=256&d=identicon&r=PG",
      "display_name" : "biggujo",
      "link" : "https://stackoverflow.com/users/30001713/biggujo"
    },
    "creation_date" : 1751637845,
    "last_activity_date" : 1751638983,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ ],
  "answer_comments" : {
    "79690312" : [ {
      "comment_id" : 140565232,
      "post_id" : 79690312,
      "body" : "@GarretWilson , I added both solutions, depending on whether we need additional abstraction or not.",
      "score" : 1,
      "owner" : {
        "account_id" : 40864244,
        "reputation" : 632,
        "user_id" : 30001713,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/f59ea01a76709335047f0cee269d788e?s=256&d=identicon&r=PG",
        "display_name" : "biggujo",
        "link" : "https://stackoverflow.com/users/30001713/biggujo"
      },
      "creation_date" : 1751639012,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140565215,
      "post_id" : 79690312,
      "body" : "Conceptually this looks like exactly what I need ! But will <code>module..setAbstractTypes(…)</code> completely override the module mappings? Is this a concern—does a module by default come with some mappings I don&#39;t want to discard? Looking at the source code, I see there is a <code>SimpleModule.addAbstractTypeMapping(Class&lt;T&gt; superType, Class&lt;? extends T&gt; subType)</code> which seems to do what you suggest, but in an additive way. Wouldn&#39;t that be better? I did some testing, and indeed <code>SimpleModule.addAbstractTypeMapping(…)</code> works like a charm! Looks like exactly what I needed. Thanks!!",
      "score" : 0,
      "owner" : {
        "account_id" : 184786,
        "reputation" : 22234,
        "user_id" : 421049,
        "user_type" : "registered",
        "accept_rate" : 50,
        "profile_image" : "https://www.gravatar.com/avatar/4b9b843fe8e233b2f70e0f2a8e7db4e8?s=256&d=identicon&r=PG",
        "display_name" : "Garret Wilson",
        "link" : "https://stackoverflow.com/users/421049/garret-wilson"
      },
      "creation_date" : 1751638646,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}