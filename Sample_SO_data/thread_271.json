{
  "question" : {
    "question_id" : 79821616,
    "title" : "How do I specify a &quot;q&quot; parameter for www.googleapis.com/drive/v3/files",
    "body" : "<p>In the <a href=\"https://developers.google.com/workspace/slides/api/samples/presentation#list-presentations\" rel=\"nofollow noreferrer\">Google Slides API sample</a>, it says to do a <code>GET</code> request:</p>\n<pre class=\"lang-http prettyprint-override\"><code>GET https://www.googleapis.com/drive/v3/files?q=&quot;mimeType=application/vnd.google-apps.presentation&quot;&amp;fields=files(id,name,webViewLink)\n</code></pre>\n<ul>\n<li><p>I tried without <code>q</code> and <code>fields</code> parameters and I get the default fields of all files just fine.</p>\n</li>\n<li><p>I tried without a <code>q</code> parameter, but with a <code>fields</code> parameter, and I get the specified fields of all files just fine.</p>\n</li>\n</ul>\n<p>My program is written in Java (Tomcat) and for historical reasons it just does:</p>\n<pre class=\"lang-java prettyprint-override\"><code>HttpRequest.newBuilder().uri(URI.create(uri)).header(&quot;Authorization&quot;, &quot;Bearer &quot; + result.getString(&quot;access_token&quot;)).build();\n</code></pre>\n<p>to make requests.</p>\n<p>The double quotes in the <code>q=&quot;mimeType=application/vnd.google-apps.presentation&quot;</code> clearly require escaping via URL encoding; without doing that one gets:</p>\n<pre><code>java.lang.IllegalArgumentException: Illegal character in query at index 44: https://www.googleapis.com/drive/v3/files?q=&quot;mimeType=application/vnd.google-apps.presentation&quot;&amp;fields=files(id,name,webViewLink)&amp;key=mykey\n    java.base/java.net.URI.create(URI.java:906)\n</code></pre>\n<p>Fully URL encoding <code>&quot;mimeType=application/vnd.google-apps.presentation&quot;</code> and passing that as the value of the <code>q</code> parameter results in a URI of:\n<code>https://www.googleapis.com/drive/v3/files?q=mimeType%3Dapplication%2Fvnd.google-apps.presentation&amp;fields=files(id,name,webViewLink)&amp;key=mykey</code>\nand gives a 400 error with:</p>\n<pre class=\"lang-json prettyprint-override\"><code>{\n  &quot;error&quot;: {\n    &quot;code&quot;: 400,\n    &quot;message&quot;: &quot;Invalid Value&quot;,\n    &quot;errors&quot;: [\n      {\n        &quot;message&quot;: &quot;Invalid Value&quot;,\n        &quot;domain&quot;: &quot;global&quot;,\n        &quot;reason&quot;: &quot;invalid&quot;,\n        &quot;location&quot;: &quot;q&quot;,\n        &quot;locationType&quot;: &quot;parameter&quot;\n      }\n    ]\n  }\n}\n</code></pre>\n<p>So how do I specify the <code>q</code> parameter?</p>\n",
    "tags" : [ "java", "http", "tomcat", "google-drive-api", "google-slides-api" ],
    "owner" : {
      "account_id" : 22925447,
      "reputation" : 27,
      "user_id" : 21287547,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/aa58d946216b5eb43d957589d243bf82?s=256&d=identicon&r=PG",
      "display_name" : "Alan",
      "link" : "https://stackoverflow.com/users/21287547/alan"
    },
    "is_answered" : false,
    "view_count" : 85,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1763496667,
    "creation_date" : 1763313162,
    "link" : "https://stackoverflow.com/questions/79821616/how-do-i-specify-a-q-parameter-for-www-googleapis-com-drive-v3-files",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79822909,
    "question_id" : 79821616,
    "body" : "<p>@VGR 's comment to not use URLEncoder was completely wrong.</p>\n<p>It turns out that the solution is:</p>\n<pre><code>String q = URLEncoder.encode(&quot;mimeType=\\&quot;application/vnd.google-apps.presentation\\&quot;&quot;, StandardCharsets.UTF_8);                      String f = URLEncoder.encode(&quot;files(id,name,webViewLink)&quot;, StandardCharsets.UTF_8);             \n\nThen to pass\nString uri = &quot;https://www.googleapis.com/drive/v3/files?q=&quot; + q + &quot;&amp;fields=&quot; + f + &quot;&amp;key=mykey&quot;\nto\n\nHttpRequest httpreq = HttpRequest.newBuilder().uri(URI.create(uri)).header(&quot;Authorization&quot;, &quot;Bearer &quot; + result.getString(&quot;access_token&quot;)).build();\n</code></pre>\n<p>The key is the escaped &quot; (double quotes) around the mimeType:</p>\n<pre><code>\\&quot;application/vnd.google-apps.presentation\\&quot;\nand to URL encode all of it as well as the fields value.\n\nTest program:\n\nimport java.net.*;\nimport java.nio.charset.StandardCharsets;\n\npublic class t {\n    public static void main(String[] args) {\n\n    String client_secret = &quot;mykey&quot;;\n    String mimeType = &quot;mimeType=\\&quot;application/vnd.google-apps.presentation\\&quot;&quot;;\n    String fields = &quot;files(id,name,webViewLink)&quot;;\n    String q = URLEncoder.encode(mimeType, StandardCharsets.UTF_8);\n    String f = URLEncoder.encode(fields, StandardCharsets.UTF_8);\n    URI goodUri = URI.create(&quot;https://www.googleapis.com/drive/v3/files?q=&quot;\n        + q + &quot;&amp;fields=&quot; + f + &quot;&amp;key=&quot; + client_secret);\n    System.out.println(&quot;Correct:\\n&quot; + goodUri.toString());\n    try {\n        URI badUri = new URI(&quot;https&quot;, &quot;www.googleapis.com&quot;, &quot;/drive/v3/files&quot;,\n        &quot;q=&quot; + mimeType + &quot;&amp;fields=&quot; + fields + &quot;&amp;key=&quot; + client_secret, null);\n        System.out.println(&quot;\\nIncorrect:\\n&quot; + badUri.toString());\n\n    } catch (URISyntaxException e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre>\n",
    "score" : 0,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 22925447,
      "reputation" : 27,
      "user_id" : 21287547,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/aa58d946216b5eb43d957589d243bf82?s=256&d=identicon&r=PG",
      "display_name" : "Alan",
      "link" : "https://stackoverflow.com/users/21287547/alan"
    },
    "creation_date" : 1763426504,
    "last_activity_date" : 1763496667,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140858958,
    "post_id" : 79821616,
    "body" : "Changed the URI to <a href=\"https://www.googleapis.com/drive/v3/files?q=&#39;mimeType=application/vnd.google-apps.presentation&#39;&amp;fields=files(id,name,webViewLink)&amp;key=mykey\" rel=\"nofollow noreferrer\">googleapis.com/drive/v3/files?q=&#39;mimeType=application/&hellip;</a>  Still gets the same 400 error.  Has anybody actually used this?  How do I specify the q parameter???",
    "score" : 0,
    "owner" : {
      "account_id" : 22925447,
      "reputation" : 27,
      "user_id" : 21287547,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/aa58d946216b5eb43d957589d243bf82?s=256&d=identicon&r=PG",
      "display_name" : "Alan",
      "link" : "https://stackoverflow.com/users/21287547/alan"
    },
    "creation_date" : 1763406345,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140857241,
    "post_id" : 79821616,
    "body" : "Slide recommendation notwithstanding, <a href=\"https://developers.google.com/workspace/drive/api/guides/search-files\" rel=\"nofollow noreferrer\">developers.google.com/workspace/drive/api/guides/search-file&zwnj;&#8203;s</a> appears to require that you use single quotes (<code>&#39;</code>) rather than double quotes.",
    "score" : 0,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44936,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1763333494,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140857118,
    "post_id" : 79821616,
    "body" : "Okay, I changed to using new URI, no more URL encoding.  Still gets the same 400 error.  The URI now looks like: <a href=\"https://www.googleapis.com/drive/v3/files?q=%22mimeType=application/vnd.google-apps.presentation%22&amp;fields=files(id,name,webViewLink)&amp;key=mykey\" rel=\"nofollow noreferrer\">googleapis.com/drive/v3/files?q=%22mimeType=application/&hellip;</a>    So how do I specify the q parameter???",
    "score" : 0,
    "owner" : {
      "account_id" : 22925447,
      "reputation" : 27,
      "user_id" : 21287547,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/aa58d946216b5eb43d957589d243bf82?s=256&d=identicon&r=PG",
      "display_name" : "Alan",
      "link" : "https://stackoverflow.com/users/21287547/alan"
    },
    "creation_date" : 1763323875,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140857055,
    "post_id" : 79821616,
    "body" : "“Full URL encoding”  Do not use URLEncoder for this.  URLEncoder, despite its name, is for <a href=\"https://html.spec.whatwg.org/#submit-mutate-action\" rel=\"nofollow noreferrer\">HTML form parameter encoding</a>.  For URI encoding, use any constructor of the URI class which takes more than one argument.  (This is mentioned in the <a href=\"https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/net/URI.html#escaped-octets-quotation-encoding-and-decoding-heading\" rel=\"nofollow noreferrer\">java.net.URI documentation</a>.)",
    "score" : 0,
    "owner" : {
      "account_id" : 2053598,
      "reputation" : 44936,
      "user_id" : 1831987,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
      "display_name" : "VGR",
      "link" : "https://stackoverflow.com/users/1831987/vgr"
    },
    "creation_date" : 1763318452,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79822909" : [ {
      "comment_id" : 140862863,
      "post_id" : 79822909,
      "body" : "How about giving my answer an up vote?  Better than 0.  Thanks.",
      "score" : 0,
      "owner" : {
        "account_id" : 22925447,
        "reputation" : 27,
        "user_id" : 21287547,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/aa58d946216b5eb43d957589d243bf82?s=256&d=identicon&r=PG",
        "display_name" : "Alan",
        "link" : "https://stackoverflow.com/users/21287547/alan"
      },
      "creation_date" : 1763573891,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140861060,
      "post_id" : 79822909,
      "body" : "Ah, I see.  That makes sense.  The <code>=</code> does need to be URI-encoded.  And the URI class won&#39;t do that since it&#39;s normally safe to leave it in a URI as is.  I guess URLEncoder is kind of a workaround, but it&#39;s still the wrong tool for the job.  Sadly, URI still has no way to do build query parameters properly, so you have to either make do with URLEncoder or encode it yourself (which actually isn&#39;t all that difficult).",
      "score" : 0,
      "owner" : {
        "account_id" : 2053598,
        "reputation" : 44936,
        "user_id" : 1831987,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
        "display_name" : "VGR",
        "link" : "https://stackoverflow.com/users/1831987/vgr"
      },
      "creation_date" : 1763497336,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140861046,
      "post_id" : 79822909,
      "body" : "@VGR See the test program I appended to my answer (it was too large for a &quot;reply&quot;.",
      "score" : 0,
      "owner" : {
        "account_id" : 22925447,
        "reputation" : 27,
        "user_id" : 21287547,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/aa58d946216b5eb43d957589d243bf82?s=256&d=identicon&r=PG",
        "display_name" : "Alan",
        "link" : "https://stackoverflow.com/users/21287547/alan"
      },
      "creation_date" : 1763496708,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140861042,
      "post_id" : 79822909,
      "body" : "@VGR Without URLencode, the &quot;=&quot; following &quot;mimeType&quot; is not URLencoded.  It needs to be (along with parens and commas in the fields parm).  I URLencode the values of the q and fields parms and then use URI.create on the full uri string to create a working uri.",
      "score" : 1,
      "owner" : {
        "account_id" : 22925447,
        "reputation" : 27,
        "user_id" : 21287547,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/aa58d946216b5eb43d957589d243bf82?s=256&d=identicon&r=PG",
        "display_name" : "Alan",
        "link" : "https://stackoverflow.com/users/21287547/alan"
      },
      "creation_date" : 1763496611,
      "content_license" : "CC BY-SA 4.0"
    }, {
      "comment_id" : 140860656,
      "post_id" : 79822909,
      "body" : "Um... that is exactly what <a href=\"https://stackoverflow.com/questions/79821616/how-do-i-specify-a-q-parameter-for-www-googleapis-com-drive-v3-files?noredirect=1#comment140857118_79821616\">you yourself told me in a comment</a> that using the URI constructor produced.  I fail to see why you had to use URLEncoder for this (which really is wrong), when the URI class did it properly.",
      "score" : 0,
      "owner" : {
        "account_id" : 2053598,
        "reputation" : 44936,
        "user_id" : 1831987,
        "user_type" : "registered",
        "profile_image" : "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
        "display_name" : "VGR",
        "link" : "https://stackoverflow.com/users/1831987/vgr"
      },
      "creation_date" : 1763481667,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}