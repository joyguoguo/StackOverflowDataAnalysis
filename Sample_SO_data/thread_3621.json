{
  "question" : {
    "question_id" : 79536211,
    "title" : "MediaRecorder fails to properly transition to second video file",
    "body" : "<p>I'm trying to use an Android MediaRecorder to record video.  In order to limit the size of the file I want to periodically start a new video file, and just like the built-in Camera app I don't want to lose any frames.  However, I am not reaching the point where I can even successfully test if frames are lost.  Here is my workflow:</p>\n<p>handler gets run after specified delay:</p>\n<pre><code>File videoFile = ...; // here is where i set the next file to output to\nmediaRecorder.reset();   // i also tried calling stop() first, but the state machine diagram says this is not necessary\nmediaRecorder.setAudioSource(MediaRecorder.AudioSource.MIC);\nmediaRecorder.setVideoSource(MediaRecorder.VideoSource.SURFACE);\nmediaRecorder.setOutputFormat(MediaRecorder.OutputFormat.MPEG_4);\nmediaRecorder.setOutputFile(videoFile.getAbsolutePath());\n\n// Set video resolution and adjust size and bitrate\nmediaRecorder.setVideoSize(sharedPreferencesManager.getCameraResolution().getWidth(), sharedPreferencesManager.getCameraResolution().getHeight());\nmediaRecorder.setVideoEncodingBitRate(getVideoBitrate());\n\n// Set frame rate and capture rate\nmediaRecorder.setVideoFrameRate(sharedPreferencesManager.getVideoFrameRate());\nmediaRecorder.setCaptureRate(sharedPreferencesManager.getVideoFrameRate());\n\n// Audio settings: high-quality audio\nmediaRecorder.setAudioEncodingBitRate(384000);\nmediaRecorder.setAudioSamplingRate(48000);\nmediaRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AAC);\n\nVideoCodec videoCodec = sharedPreferencesManager.getVideoCodec();\nmediaRecorder.setVideoEncoder(videoCodec.getEncoder());\n\n// Set orientation based on camera selection\nif (sharedPreferencesManager.getCameraSelection().equals(CameraType.FRONT)) {\n    mediaRecorder.setOrientationHint(270);\n} else {\n    mediaRecorder.setOrientationHint(90);\n}\n\n// Prepare MediaRecorder\nmediaRecorder.prepare();\nmediaRecorder.start();\nbackgroundHandler.postDelayed(this, intervalMillis);\n</code></pre>\n<p>The first video file created is playable.  However, I can't get the second video file to even work.  If I wait until the third video file is created I get a playable second video file that is the correct length but empty (black output, no sound, minimal size), but if I manually stop during recording of the second video I get an exception trying to call stop() telling me that stop was called while neither recording nor paused.</p>\n<p>Yet I plainly called start(), so it's not clear to me why it's not recording.</p>\n<p>This is running under Android 14.</p>\n",
    "tags" : [ "java", "android", "video-capture" ],
    "owner" : {
      "account_id" : 260365,
      "reputation" : 9511,
      "user_id" : 543873,
      "user_type" : "registered",
      "accept_rate" : 72,
      "profile_image" : "https://www.gravatar.com/avatar/22e04916412de31c2f7531634fc56f55?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "Michael",
      "link" : "https://stackoverflow.com/users/543873/michael"
    },
    "is_answered" : false,
    "view_count" : 38,
    "answer_count" : 0,
    "score" : 0,
    "last_activity_date" : 1742987163,
    "creation_date" : 1742987163,
    "link" : "https://stackoverflow.com/questions/79536211/mediarecorder-fails-to-properly-transition-to-second-video-file",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ ],
  "question_comments" : [ {
    "comment_id" : 140266403,
    "post_id" : 79536211,
    "body" : "Similar to: <a href=\"https://stackoverflow.com/q/58745599/295004\">Save video in every 5 second interval while video recoding is ON (Android OS)</a>",
    "score" : 0,
    "owner" : {
      "account_id" : 111736,
      "reputation" : 12346,
      "user_id" : 295004,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/a29d6038e4dcb7fac98ef41c002975e1?s=256&d=identicon&r=PG",
      "display_name" : "Morrison Chang",
      "link" : "https://stackoverflow.com/users/295004/morrison-chang"
    },
    "creation_date" : 1743013672,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : { }
}