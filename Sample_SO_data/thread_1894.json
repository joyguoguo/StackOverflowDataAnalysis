{
  "question" : {
    "question_id" : 79666971,
    "title" : "PDF.js unable to render certain symbols properly",
    "body" : "<p>I have pdfs that I've generated using PDFBox, and when viewed using firefox browser/ pdf.js certain symbols (in textfields) like backtick (`) and single quote (') are not rendered correctly, meanwhile they are rendered correctly when using acrobat and chrome browser.</p>\n<p><a href=\"https://github.com/user-attachments/files/20621461/test-blank---Copy.1.pdf\" rel=\"nofollow noreferrer\">sample pdf 1</a> (Poppins embedded)</p>\n<p><a href=\"https://github.com/user-attachments/files/20621463/test-blank---Copy.2.pdf\" rel=\"nofollow noreferrer\">sample pdf 2</a> (Arial embedded)</p>\n<p>Both pdfs have embedded font files, and both showed the same the same behavior.</p>\n<p>on acrobat:</p>\n<p><a href=\"https://i.sstatic.net/xVmSFyZi.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/xVmSFyZi.png\" alt=\"enter image description here\" /></a></p>\n<p>on pdf.js:</p>\n<p><a href=\"https://i.sstatic.net/KPqpFHtG.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/KPqpFHtG.png\" alt=\"enter image description here\" /></a></p>\n<p>I am not sure if this is a limitation on pdf.js, I just want to make sure that the pdfs that I have generated are not at fault.</p>\n<p>Thanks.</p>\n<pre><code>public static void createTextbox(PDDocument doc, int pageIndex, PDRectangle rect, String fieldName, String fontPath) throws Exception {\n    PDPage page = doc.getPage(pageIndex);\n\n    // Add a new AcroForm and add that to the document\n    PDAcroForm acroForm = doc.getDocumentCatalog().getAcroForm();\n    if (acroForm == null) {\n        acroForm = new PDAcroForm(doc);\n        doc.getDocumentCatalog().setAcroForm(acroForm);\n    }\n    \n    if(acroForm.getFields() instanceof AbstractList){\n        acroForm.setFields(new ArrayList&lt;&gt;());\n    }\n    \n    PDResources resources = new PDResources();\n    acroForm.setDefaultResources(resources);\n\n    // set custom font here, else the non embeded HELV will be used when u call to setNeedAppearances(true)\n    PDType0Font f = PDType0Font.load(doc, new File(fontPath));\n    String customFontNameToMatch = f.getFontDescriptor().getFontName();\n\n    String fontName = null;\n    PDFont customFont = null;\n\n    Iterator&lt;COSName&gt; fontIte = acroForm.getDefaultResources().getFontNames().iterator();\n    while(fontIte.hasNext()){\n        COSName fcn = fontIte.next();\n        if(acroForm.getDefaultResources().getFont(fcn).getName().equals(customFontNameToMatch)){\n            fontName = fcn.getName();\n            customFont = acroForm.getDefaultResources().getFont(fcn);\n            break;\n        }\n    }\n\n    // font not embedded, embed it\n    if (fontName == null){\n        customFont = PDTrueTypeFont.load(doc, new File(fontPath), StandardEncoding.INSTANCE);\n        fontName = acroForm.getDefaultResources().add(customFont).getName();\n    }\n\n    String defApp = String.format(&quot;/%s 0 Tf 0 0 0 rg&quot;, fontName);\n    \n    // Add a form field to the form.\n    PDTextField textBox = new PDTextField(acroForm);\n    textBox.setPartialName(fieldName);\n    textBox.setReadOnly(true);\n    textBox.setDefaultAppearance(defApp);\n    textBox.setMultiline(true);\n\n    // Specify the widget annotation associated with the field\n    PDAnnotationWidget widget = textBox.getWidgets().get(0);\n    widget.setRectangle(rect);\n    widget.setPage(page);\n    widget.getCOSObject().setNeedToBeUpdated(true);\n    \n    acroForm.setNeedAppearances(true);\n\n    // make sure the widget annotation is visible on screen and paper\n    widget.setPrinted(true);\n\n    // Add the widget annotation to the page\n    page.getAnnotations().add(widget);\n    // set the alignment (&quot;quadding&quot;)\n    textBox.setQ(PDVariableText.QUADDING_LEFT);\n    \n    textBox.setDoNotScroll(true);\n    \n    textBox.getCOSObject().setNeedToBeUpdated(true);\n\n    acroForm.getFields().add(textBox);\n    acroForm.getCOSObject().setNeedToBeUpdated(true);\n    \n    page.getCOSObject().setNeedToBeUpdated(true);\n}\n</code></pre>\n<p>&quot;doc.saveIncremental(baos);&quot; is then called after createTextbox()</p>\n<pre><code>public static void fillTextBox(PDDocument doc, String fieldName, String fontPath, String text) throws Exception {\n    // get the document catalog\n    PDAcroForm acroForm = doc.getDocumentCatalog().getAcroForm();\n    \n    // as there might not be an AcroForm entry a null check is necessary\n    if (acroForm != null) {\n        // Retrieve an individual field and set its value.\n        PDTextField field = (PDTextField) acroForm.getField(fieldName);\n        \n        // set custom font\n        PDType0Font f = PDType0Font.load(doc, new File(fontPath));\n        String customFontNameToMatch = f.getFontDescriptor().getFontName();\n\n        String fontName = null;\n        PDFont customFont = null;\n\n        Iterator&lt;COSName&gt; fontIte = acroForm.getDefaultResources().getFontNames().iterator();\n        while(fontIte.hasNext()){\n            COSName fcn = fontIte.next();\n            if(acroForm.getDefaultResources().getFont(fcn).getName().equals(customFontNameToMatch)){\n                fontName = fcn.getName();\n                customFont = acroForm.getDefaultResources().getFont(fcn);\n                break;\n            }\n        }\n\n        // font not embedded, embed it\n        if (fontName == null){\n            customFont = PDTrueTypeFont.load(doc, new File(fontPath), StandardEncoding.INSTANCE);\n            fontName = acroForm.getDefaultResources().add(customFont).getName();\n        }\n\n        String defApp = String.format(&quot;/%s 0 Tf 0 0 0 rg&quot;, fontName);\n\n        field.setDefaultAppearance(defApp);\n        field.setMultiline(true);\n        field.setReadOnly(true);\n        field.setValue(text);\n        \n        PDAnnotationWidget widget = field.getWidgets().get(0);\n        widget.setReadOnly(true);\n        widget.setLocked(true);\n        widget.getCOSObject().setNeedToBeUpdated(true);\n    }\n}\n</code></pre>\n<p>&quot;doc.saveIncremental(baos);&quot; is called after fillTextBox()</p>\n<p>pdfbox version (maven) : 3.0.4\njava version : 21</p>\n<p><a href=\"https://fileport.io/mUscqspDdA8R\" rel=\"nofollow noreferrer\">pdf file with poppins embedded with subset set to false, font file</a></p>\n",
    "tags" : [ "java", "pdf", "pdfbox", "pdf.js" ],
    "owner" : {
      "account_id" : 19849834,
      "reputation" : 23,
      "user_id" : 14540557,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d165330cef67f164e528f6c98ce9dede?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "rec7y33",
      "link" : "https://stackoverflow.com/users/14540557/rec7y33"
    },
    "is_answered" : true,
    "view_count" : 100,
    "answer_count" : 1,
    "score" : 0,
    "last_activity_date" : 1750065713,
    "creation_date" : 1750037209,
    "link" : "https://stackoverflow.com/questions/79666971/pdf-js-unable-to-render-certain-symbols-properly",
    "content_license" : "CC BY-SA 4.0"
  },
  "answers" : [ {
    "answer_id" : 79667347,
    "question_id" : 79666971,
    "body" : "<p>Thanks to @TilmanHausherr for his suggestions, i had to use this function while embedding the font to the pdf</p>\n<pre><code>PDType0Font.load(doc, new FileInputStream(fontPath), false);\n</code></pre>\n",
    "score" : 1,
    "is_accepted" : false,
    "owner" : {
      "account_id" : 19849834,
      "reputation" : 23,
      "user_id" : 14540557,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d165330cef67f164e528f6c98ce9dede?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "rec7y33",
      "link" : "https://stackoverflow.com/users/14540557/rec7y33"
    },
    "creation_date" : 1750065713,
    "last_activity_date" : 1750065713,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "question_comments" : [ {
    "comment_id" : 140516397,
    "post_id" : 79666971,
    "body" : "@TilmanHausherr thanks the text gets rendered properly on firefox now. thanks!",
    "score" : 1,
    "owner" : {
      "account_id" : 19849834,
      "reputation" : 23,
      "user_id" : 14540557,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d165330cef67f164e528f6c98ce9dede?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "rec7y33",
      "link" : "https://stackoverflow.com/users/14540557/rec7y33"
    },
    "creation_date" : 1750060673,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140516258,
    "post_id" : 79666971,
    "body" : "Please try replacing <code>PDTrueTypeFont.load</code> with <code>PDType0Font.load</code> with 3 parameters so that no subsetting is done.",
    "score" : 1,
    "owner" : {
      "account_id" : 255529,
      "reputation" : 19234,
      "user_id" : 535646,
      "user_type" : "registered",
      "accept_rate" : 40,
      "profile_image" : "https://i.sstatic.net/yGyps.jpg?s=256",
      "display_name" : "Tilman Hausherr",
      "link" : "https://stackoverflow.com/users/535646/tilman-hausherr"
    },
    "creation_date" : 1750057622,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140516246,
    "post_id" : 79666971,
    "body" : "@TilmanHausherr Hi Tilman I have updated my post, thanks.",
    "score" : 0,
    "owner" : {
      "account_id" : 19849834,
      "reputation" : 23,
      "user_id" : 14540557,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d165330cef67f164e528f6c98ce9dede?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "rec7y33",
      "link" : "https://stackoverflow.com/users/14540557/rec7y33"
    },
    "creation_date" : 1750057316,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140515964,
    "post_id" : 79666971,
    "body" : "Please share the code you used to create the font in the acroform default resources and mention the PDFBox version.",
    "score" : 0,
    "owner" : {
      "account_id" : 255529,
      "reputation" : 19234,
      "user_id" : 535646,
      "user_type" : "registered",
      "accept_rate" : 40,
      "profile_image" : "https://i.sstatic.net/yGyps.jpg?s=256",
      "display_name" : "Tilman Hausherr",
      "link" : "https://stackoverflow.com/users/535646/tilman-hausherr"
    },
    "creation_date" : 1750045146,
    "content_license" : "CC BY-SA 4.0"
  }, {
    "comment_id" : 140515940,
    "post_id" : 79666971,
    "body" : "@KJ i forgot to mention that copy2 is embedded with Arial font and the texts are slightly different but it was included to show that other fonts exhibits similar problem. so what u saw there are totally expected. also i have just tried with my edge browser and it renders the pdf without problem. may i ask how do you make your edge &quot;acrobat based&quot;? besides, im not flattening the texts because our app allows multiple users to sign and input texts on a document, so if flattening is done the previously signed signatures will become invalid with error &quot;document altered&quot;.",
    "score" : 0,
    "owner" : {
      "account_id" : 19849834,
      "reputation" : 23,
      "user_id" : 14540557,
      "user_type" : "registered",
      "profile_image" : "https://www.gravatar.com/avatar/d165330cef67f164e528f6c98ce9dede?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name" : "rec7y33",
      "link" : "https://stackoverflow.com/users/14540557/rec7y33"
    },
    "creation_date" : 1750043876,
    "content_license" : "CC BY-SA 4.0"
  } ],
  "answer_comments" : {
    "79667347" : [ {
      "comment_id" : 140517021,
      "post_id" : 79667347,
      "body" : "some context: the original line would only bring the characters supported by StandardEncoding. The new code line supports all characters supported by the font.",
      "score" : 1,
      "owner" : {
        "account_id" : 255529,
        "reputation" : 19234,
        "user_id" : 535646,
        "user_type" : "registered",
        "accept_rate" : 40,
        "profile_image" : "https://i.sstatic.net/yGyps.jpg?s=256",
        "display_name" : "Tilman Hausherr",
        "link" : "https://stackoverflow.com/users/535646/tilman-hausherr"
      },
      "creation_date" : 1750073585,
      "content_license" : "CC BY-SA 4.0"
    } ]
  }
}