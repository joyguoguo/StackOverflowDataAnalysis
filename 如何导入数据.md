# å¦‚ä½•å¯¼å…¥æ•°æ®åˆ° PostgreSQL æ•°æ®åº“

> **é‡è¦è¯´æ˜**ï¼šæœ¬å·¥å…·æ˜¯å°† `Sample_SO_data` ç›®å½•ä¸­**å·²æœ‰çš„ JSON æ–‡ä»¶**å¯¼å…¥åˆ° PostgreSQL æ•°æ®åº“ï¼Œ**ä¸æ˜¯**ä» Stack Overflow API é‡æ–°æ‹‰å–æ•°æ®ã€‚

## ğŸ“‹ åŠŸèƒ½è¯´æ˜

- âœ… **ä»æœ¬åœ° JSON æ–‡ä»¶å¯¼å…¥**ï¼šè¯»å– `Sample_SO_data` ç›®å½•ä¸­çš„ `thread_*.json` æ–‡ä»¶
- âœ… **å¯¼å…¥åˆ° PostgreSQL**ï¼šå°†æ•°æ®å†™å…¥ `stackoverflow_java` æ•°æ®åº“
- âŒ **ä¸ä¼šä» API æ‹‰å–æ•°æ®**ï¼šè¿™æ˜¯çº¯æœ¬åœ°æ•°æ®å¯¼å…¥å·¥å…·

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šä½¿ç”¨å¯¼å…¥è„šæœ¬ï¼ˆæœ€ç®€å•ï¼Œæ¨èï¼‰

#### Windows ç”¨æˆ·

```cmd
# å¯¼å…¥ Sample_SO_data ç›®å½•ä¸­çš„æ•°æ®
import-data.bat Sample_SO_data

# æˆ–è€…å¯¼å…¥å…¶ä»–ç›®å½•
import-data.bat Sample_SO_data2
```

#### Linux/Mac ç”¨æˆ·

```bash
# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
chmod +x import-data.sh

# å¯¼å…¥æ•°æ®
./import-data.sh Sample_SO_data
```

### æ–¹å¼äºŒï¼šä½¿ç”¨ Maven å‘½ä»¤

```bash
# Windows
mvnw.cmd spring-boot:run -Dspring-boot.run.arguments="--import.data=true --import.directory=Sample_SO_data"

# Linux/Mac
./mvnw spring-boot:run -Dspring-boot.run.arguments="--import.data=true --import.directory=Sample_SO_data"
```

### æ–¹å¼ä¸‰ï¼šä½¿ç”¨ JAR åŒ…

```bash
# å…ˆæ„å»ºé¡¹ç›®
mvnw.cmd clean package

# è¿è¡Œå¯¼å…¥
java -jar target/FinalProject_demo-0.0.1-SNAPSHOT.jar \
    --import.data=true \
    --import.directory=Sample_SO_data
```

### æ–¹å¼å››ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡

```bash
# Windows
set IMPORT_DATA=true
set IMPORT_DIRECTORY=Sample_SO_data
mvnw.cmd spring-boot:run

# Linux/Mac
export IMPORT_DATA=true
export IMPORT_DIRECTORY=Sample_SO_data
./mvnw spring-boot:run
```

## ğŸ“‹ å‰ç½®æ¡ä»¶

1. **æ•°æ®åº“å·²åˆ›å»º**
   ```sql
   CREATE DATABASE stackoverflow_java;
   ```

2. **æ•°æ®åº“é…ç½®æ­£ç¡®**
   
   æ£€æŸ¥ `src/main/resources/application.properties`ï¼š
   ```properties
   spring.datasource.url=jdbc:postgresql://localhost:5432/stackoverflow_java
   spring.datasource.username=postgres
   spring.datasource.password=ä½ çš„å¯†ç 
   ```

3. **æ•°æ®åº“è¡¨å·²åˆ›å»º**
   
   åº”ç”¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨è¿è¡Œ Flyway è¿ç§»è„šæœ¬åˆ›å»ºè¡¨ç»“æ„ã€‚

## ğŸ“ è¯¦ç»†æ­¥éª¤

### æ­¥éª¤ 1ï¼šç¡®è®¤æ•°æ®åº“è¿æ¥

ç¼–è¾‘ `src/main/resources/application.properties`ï¼Œç¡®ä¿æ•°æ®åº“è¿æ¥ä¿¡æ¯æ­£ç¡®ï¼š

```properties
spring.datasource.url=jdbc:postgresql://localhost:5432/stackoverflow_java
spring.datasource.username=postgres
spring.datasource.password=ä½ çš„å¯†ç 
```

### æ­¥éª¤ 2ï¼šç¡®è®¤æ•°æ®æ–‡ä»¶å­˜åœ¨

ç¡®ä¿ `Sample_SO_data` ç›®å½•ä¸­æœ‰ JSON æ–‡ä»¶ï¼ˆå¦‚ `thread_01.json`, `thread_02.json` ç­‰ï¼‰ã€‚

### æ­¥éª¤ 3ï¼šè¿è¡Œå¯¼å…¥

ä½¿ç”¨ä¸Šé¢ä»»æ„ä¸€ç§æ–¹å¼è¿è¡Œå¯¼å…¥å·¥å…·ã€‚

### æ­¥éª¤ 4ï¼šæŸ¥çœ‹å¯¼å…¥ç»“æœ

å¯¼å…¥å®Œæˆåï¼Œä¼šæ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ï¼š
- Success: æˆåŠŸå¯¼å…¥çš„çº¿ç¨‹æ•°
- Failed: å¤±è´¥çš„çº¿ç¨‹æ•°
- Skipped: è·³è¿‡çš„çº¿ç¨‹æ•°

## ğŸ” éªŒè¯å¯¼å…¥ç»“æœ

### ä½¿ç”¨ SQL æŸ¥è¯¢

```sql
-- è¿æ¥åˆ°æ•°æ®åº“
psql -U postgres -d stackoverflow_java

-- æŸ¥çœ‹ç»Ÿè®¡
SELECT COUNT(*) as total_questions FROM questions;
SELECT COUNT(*) as total_answers FROM answers;
SELECT COUNT(*) as total_comments FROM comments;
SELECT COUNT(*) as total_users FROM users;
SELECT COUNT(*) as total_tags FROM tags;

-- æŸ¥çœ‹ç¤ºä¾‹æ•°æ®
SELECT question_id, title, score, answer_count 
FROM questions 
ORDER BY creation_date DESC 
LIMIT 10;

-- æŸ¥çœ‹æ ‡ç­¾ç»Ÿè®¡
SELECT t.name, COUNT(*) as question_count
FROM tags t
JOIN question_tags qt ON t.name = qt.tag_name
GROUP BY t.name
ORDER BY question_count DESC
LIMIT 10;
```

### ä½¿ç”¨åº”ç”¨ API

å¯¼å…¥å®Œæˆåï¼Œå¯ä»¥å¯åŠ¨åº”ç”¨å¹¶è®¿é—®ï¼š

```
http://localhost:8080/api/metadata/status
```

æŸ¥çœ‹æ•°æ®ç»Ÿè®¡ä¿¡æ¯ã€‚

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: å¯¼å…¥æ—¶å‡ºç°æ•°æ®åº“è¿æ¥é”™è¯¯

**A**: 
- æ£€æŸ¥ PostgreSQL æ˜¯å¦è¿è¡Œï¼š`pg_isready`
- æ£€æŸ¥æ•°æ®åº“è¿æ¥é…ç½®æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å·²åˆ›å»º

### Q2: å¯¼å…¥é€Ÿåº¦æ…¢

**A**:
- è¿™æ˜¯æ­£å¸¸çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éœ€è¦å¤šæ¬¡æ•°æ®åº“æ“ä½œ
- 1000 ä¸ªçº¿ç¨‹å¤§çº¦éœ€è¦ 5-10 åˆ†é’Ÿ
- å¯ä»¥é€šè¿‡å¢åŠ  JVM å†…å­˜æå‡æ€§èƒ½ï¼š`-Xmx2g`

### Q3: å¯¼å…¥åæ•°æ®ä¸å®Œæ•´

**A**:
- æ£€æŸ¥æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
- ç¡®è®¤ JSON æ–‡ä»¶æ ¼å¼æ­£ç¡®
- é‡å¤å¯¼å…¥ä¸ä¼šåˆ›å»ºé‡å¤æ•°æ®ï¼ˆå¹‚ç­‰æ“ä½œï¼‰

### Q4: å¦‚ä½•é‡æ–°å¯¼å…¥

**A**:
- å¦‚æœæ•°æ®å·²å­˜åœ¨ï¼Œé‡å¤å¯¼å…¥ä¼šè·³è¿‡ï¼ˆå¹‚ç­‰ï¼‰
- å¦‚æœè¦é‡æ–°å¯¼å…¥ï¼Œéœ€è¦å…ˆæ¸…ç©ºæ•°æ®åº“è¡¨æˆ–åˆ é™¤æ•°æ®åº“é‡å»º

### Q5: å¯¼å…¥éƒ¨åˆ†æ•°æ®

**A**:
- å¯ä»¥å°†éƒ¨åˆ† JSON æ–‡ä»¶æ”¾åˆ°å•ç‹¬çš„ç›®å½•
- ç„¶åå¯¼å…¥è¯¥ç›®å½•ï¼š`import-data.bat my_partial_data`

## ğŸ“Š å¯¼å…¥è¿›åº¦

å¯¼å…¥è¿‡ç¨‹ä¸­ä¼šæ˜¾ç¤ºè¿›åº¦ä¿¡æ¯ï¼š

```
=== Starting Data Import ===
Import directory: Sample_SO_data
Starting data import from directory: Sample_SO_data
Found 1000 JSON files to import
...
Import completed. Success: 1000, Failed: 0, Skipped: 0
=== Import Summary ===
Success: 1000
Failed: 0
Skipped: 0
```

## ğŸ¯ å¯¼å…¥åçš„ä¸‹ä¸€æ­¥

å¯¼å…¥å®Œæˆåï¼Œä½ å¯ä»¥ï¼š

1. **å¯åŠ¨åº”ç”¨**ï¼šæ­£å¸¸å¯åŠ¨ Spring Boot åº”ç”¨
2. **è®¿é—® API**ï¼šä½¿ç”¨ REST API æŸ¥è¯¢æ•°æ®
3. **æŸ¥çœ‹å‰ç«¯**ï¼šè®¿é—® `http://localhost:8080` æŸ¥çœ‹å¯è§†åŒ–
4. **æ›´æ–°æœåŠ¡å±‚**ï¼šå°†ç°æœ‰æœåŠ¡æ”¹ä¸ºä»æ•°æ®åº“è¯»å–æ•°æ®

---

**æç¤º**ï¼šå¯¼å…¥å®Œæˆåï¼Œå»ºè®®éªŒè¯æ•°æ®å®Œæ•´æ€§åå†ç»§ç»­å¼€å‘ã€‚

